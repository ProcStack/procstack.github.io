var Os=Object.create;var bt=Object.defineProperty;var Gs=Object.getOwnPropertyDescriptor;var js=Object.getOwnPropertyNames;var Ws=Object.getPrototypeOf,zs=Object.prototype.hasOwnProperty;var Yt=o=>e=>{var t=o[e];if(t)return t();throw new Error("Module not found in bundle: "+e)};var we=(o,e)=>()=>(o&&(e=o(o=0)),e);var Qs=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports),re=(o,e)=>{for(var t in e)bt(o,t,{get:e[t],enumerable:!0})},Ns=(o,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of js(e))!zs.call(o,s)&&s!==t&&bt(o,s,{get:()=>e[s],enumerable:!(i=Gs(e,s))||i.enumerable});return o};var Ks=(o,e,t)=>(t=o!=null?Os(Ws(o)):{},Ns(e||!o||!o.__esModule?bt(t,"default",{value:o,enumerable:!0}):t,o));var Mi={};re(Mi,{ExtensionBase:()=>pe});var pe,et=we(()=>{pe=class{constructor(){this.active=!1,this.verbose=!1,this.callbacks={}}init(){}start(){this.active=!0}pause(){this.stop()}stop(){this.active=!1}subscribe(e,t){this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t)}unsubscribe(e,t){this.callbacks[e]&&(this.callbacks[e]=this.callbacks[e].filter(i=>i!==t))}emit(e,t){this.callbacks[e]&&this.callbacks[e].forEach(i=>i(t))}destroy(){this.disable()}}});var Li={};re(Li,{default:()=>gt});var gt,Ri=we(()=>{et();gt=class extends pe{constructor(e){this.status=!1,this.accessToken="",this.jwtToken="",this.socket=io("https://www.www.com",{transports:["websocket"]})}init(){socket.on("event",e=>{console.log(e)}),socket.on("connect",onConnect),socket.on("disconnect",onDisconnect),socket.on("authenticated",onAuthenticated),socket.on("unauthorized",console.error)}onConnect(){console.log("Successfully connected to the websocket"),socket.emit("authenticate",{method:"jwt",token:this.jwtToken})}onDisconnect(){console.log("Disconnected from websocket"),this.status=!1,onConnect()}onAuthenticated(e){let{channelId:t}=e;console.log(`Successfully connected to channel ${t}`),this.status=!0}}});var Ai={};re(Ai,{PoseEngine:()=>Ut});var Ut,ki=we(()=>{et();Ut=class extends pe{constructor(e){switch(this.active=!1,this.verbose=!1,e){case"MediaPipe":this.model=new MediaPipePose;break;default:throw new Error("Unknown pose estimation '"+e+"' model")}}async estimatePose(e){return await this.model.estimate(e)}}});var Ii={};re(Ii,{MediaPipePlugin:()=>Ht});var Ht,Bi=we(()=>{Ht=class o{constructor(){this.workerScriptUrl="./PoseEngine_worker.js",this.worker=null,this.booted=!1}static async loadScriptWithProgress(e,t){return new Promise((i,s)=>{let r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="text",r.onprogress=l=>{if(l.lengthComputable&&typeof t=="function"){let u=Math.round(l.loaded/l.total*100);t(u)}},r.onload=()=>{if(r.status===200){let l=document.createElement("script");l.textContent=r.responseText,document.head.appendChild(l),i()}else s(new Error(`Failed to load script: ${e}`))},r.onerror=()=>s(new Error(`Network error while loading: ${e}`)),r.send()})}async init(e){let t="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js";try{console.log("Loading MediaPipe..."),await o.loadScriptWithProgress(t,e),this.worker=new Worker(this.workerScriptUrl),this.booted=!0,console.log("MediaPipe Plugin Initialized")}catch(i){console.error("Error initializing MediaPipePlugin:",i)}}sendMessage(e){if(!this.booted){console.warn("MediaPipePlugin is not initialized.");return}this.worker.postMessage(e)}onMessage(e){if(!this.worker){console.warn("WebWorker not initialized.");return}this.worker.onmessage=t=>e(t.data)}terminateWorker(){this.worker&&(this.worker.terminate(),this.worker=null,console.log("WebWorker terminated."))}}});var Ui=Qs(()=>{self.onmessage=async o=>{let{type:e,data:t}=o.data;switch(e){case"processFrame":let i=await poseModel.estimate(imageData);self.postMessage({type:"result",pose:i});break;default:console.warn("Unknown message type:",e)}}});var Hi={};re(Hi,{WebCamera:()=>_t});var _t,_i=we(()=>{et();_t=class extends pe{constructor(){this.video=document.createElement("video"),this.stream=null,this.isInitialized=!1,this.active=!1}init(e){navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(t=>{this.stream=t,this.video.srcObject=this.stream,this.video.play(),this.isInitialized=!0,console.log("WebCamera Initialized"),e&&e(null)}).catch(t=>{console.error("Error initializing WebCamera:",t),e&&e(t)})}start(e){this.isInitialized?(this.active=!0,console.log("WebCamera Started"),e&&e(null)):(console.error("WebCamera is not initialized"),e&&e(new Error("WebCamera is not initialized")))}pause(e){this.stop(e)}stop(e){this.stream?(this.stream.getTracks().forEach(t=>t.stop()),this.video.srcObject=null,this.isInitialized=!1,console.log("WebCamera Stopped"),this.active=!1,e&&e(null)):e&&e(new Error("WebCamera is not initialized"))}}});var Ur,Ft=we(()=>{Ur=Yt({"./ExtensionBase.js":()=>Promise.resolve().then(()=>(et(),Mi)),"./Extensions.js":()=>Promise.resolve().then(()=>(Vt(),Fi)),"./Networking.js":()=>Promise.resolve().then(()=>(Ri(),Li)),"./PoseEngine.js":()=>Promise.resolve().then(()=>(ki(),Ai)),"./PoseEngine/MediaPipe.js":()=>Promise.resolve().then(()=>(Bi(),Ii)),"./PoseEngine/PoseEngine_worker.js":()=>Promise.resolve().then(()=>Ks(Ui())),"./WebCam.js":()=>Promise.resolve().then(()=>(_i(),Hi))})});var Fi={};re(Fi,{Extensions:()=>Be});var Hr,Be,Vt=we(()=>{Ft();Hr=["PoseEngine"],Be=class{constructor(){this.plugins={},this.verbose=!1}init(e,t,i,s=!1){!this.plugins[e]||s?this.load(e,(r,l)=>{r?i?i(r):this.verbose&&console.error(r):t&&t(l)}):(this.verbose&&console.log(`Extension ${e} already booted, skipping...`),t&&t(this.plugins[e]))}async load(e,t){if(Hr.includes(e))try{let i=await Ur(`./${e}.js`),s=new i.default;try{this.boot(e,s)}catch(r){console.error(`Error (2) Booting extension '${e}':`,r)}t&&t(null,s)}catch(i){console.error(`Error (1) Importing / Parsing extension '${e}':`,i),t&&t(err,null)}else{let i=new Error(`Extension ${e} not found`);console.error(i),t&&t(i,null)}}start(e){let t=this.get(e);t&&t.start()}pause(e){let t=this.get(e);t&&t.pause()}stop(e){let t=this.get(e);t&&t.stop()}status(e){let t=this.get(e);return t?t.active:!1}boot(e,t){this.plugins[e]=t,t.init()}get(e){return this.plugins[e]?this.plugins[e]:(console.warn(`Extension ${e} not found`),null)}unload(e){let t=this.get(e);t&&(t.destroy(),delete this.plugins[e])}}});import*as V from"./three.module.js";import*as ne from"./three.module.js";var W=ne.Vector2,q=ne.Vector3,$t=ne.Vector4;var ae={NONE:0,ERROR:1,WARN:2,INFO:3},Me={OFF:0,LOW:1,MEDIUM:2,HIGH:3},Le={verbose:ae.NONE,staticCamera:!1,autoCamera:!1,antiAliasing:Me.LOW,LoadEnvAssetFile:!1};import*as Q from"./three.module.js";var He=class{constructor(e="images/assets/",t){this.assetRoot=e,this.mobile=t,this.pxlTimer=null,this.verboseLoading=!1,this.texLoader=new Q.ImageLoader,this.textLoaderArray=[],this.channelFormats=[Q.AlphaFormat,Q.RedFormat,Q.RGFormat,Q.RGBFormat,Q.RGBAFormat,Q.LuminanceFormat,Q.DepthFormat]}get curMS(){return this.pxlTimer.curMS}setDependencies(e){this.pxlTimer=e.pxlTimer}updateUrl(e,t={},i=""){window.history.replaceState?window.history.replaceState(t,i,e):window.history.pushState(t,i,e)}copyRoomUrl(){let e=window.location,t=document.activeElement,i=document.createElement("textarea");i.value=e,document.body.appendChild(i),i.focus(),i.select();let s=!1;try{s=document.execCommand("copy")?"successful":"unsuccessful"}catch{}return document.body.removeChild(i),t.focus(),s}checkInt(e){return e%1==0}degToRad(e){return e*(Math.PI/180)}toHundreths(e){if(!e)return 0;if(Number.isInteger(e))return e;{let t=(e+"").split(".");return parseFloat(t[0]+"."+t[1].substr(0,2))}}toTenths(e){if(!e)return 0;if(Number.isInteger(e))return e;{let t=(e+"").split(".");return parseFloat(t[0]+"."+t[1].substr(0,1))}}getDateTime(){let e=new Date,t=(e.getFullYear()+"").padStart(2,"0")+"-"+(e.getMonth()+1+"").padStart(2,"0")+"-"+(e.getDate()+"").padStart(2,"0"),i=(e.getHours()+"").padStart(2,"0")+":"+(e.getMinutes()+"").padStart(2,"0")+":"+(e.getSeconds()+"").padStart(2,"0");return[t,i]}cleanStrict(e){let t=document.createElement("div");t.innerHTML=e,t=t.innerText;let i=t.match(/([a-zA-Z0-9])\w+/g);return i&&(t=i.join(" ")),t}cleanBasic(e){let t=document.createElement("div");t.innerHTML=e,t=t.innerText;let i=t.match(/([a-zA-Z0-9\s\w-+()\[\]])+/g);return i&&(t=i.join("")),t}cleanString(e){let t=document.createElement("div");return t.innerHTML=e,t=t.innerText,t}randomFloat(e,t){return Math.random()*(t-e)+e}componentToHex(e){var t=e.toString(16);return t.padStart(2,"0")}rgbToHex(e,t,i){return"#"+this.componentToHex(Math.min(255,Math.max(0,Math.round(e))))+this.componentToHex(Math.min(255,Math.max(0,Math.round(t))))+this.componentToHex(Math.min(255,Math.max(0,Math.round(i))))}hexToRgb(e){e[0]=="#"?e=e.substr(1,6):e=e.substr(0,6);let i,s,r;return e.length==3?(i=e[0]+e[0],s=e[1]+e[1],r=e[2]+e[2]):(i=e[0]+e[1],s=e[2]+e[3],r=e[4]+e[5]),i=parseInt(i,16),s=parseInt(s,16),r=parseInt(r,16),[i,s,r]}stringToRgb(e,t=null,i=!1){let s=[255,0,0];if(e){let r=e.length,l="";for(let v=0;v<r;++v)l+=e[r-1-v].charCodeAt(0).toString(16);let u=l.length;if(u>6){let v=1;e=="tussin"?v=0:e=="fexofenadine"&&(v=-1);let p=Math.max(0,parseInt((u-6)/2+v));l=l.substr(p,6)}s=this.hexToRgb(l)}if(t!=null){let r=Math.max(...s),l=Math.min(...s),u=r*t;s[0]=parseInt(Math.min(255,(s[0]-l)/(r-l)*255+u)),s[1]=parseInt(Math.min(255,(s[1]-l)/(r-l)*255+u)),s[2]=parseInt(Math.min(255,(s[2]-l)/(r-l)*255+u))}return i==!0&&(s[0]=s[0]/255,s[1]=s[1]/255,s[2]=s[2]/255),s}randomizeArray(e){let t=[...e],i=[];for(;t.length>0;){let s=t.length==1?0:parseInt(Math.random()*21*t.length)%t.length;i.push(t.splice(s,1)[0])}return i}getRandom(e,t=1.14){let i=Math.floor(Math.random(t)*e.length);return e[i]}applyTransformList(e,t){var i=t.r;e.rotateX(i[0]),e.rotateY(i[1]),e.rotateZ(i[2]),typeof t.rOrder<"u"&&(e.rotation.order=t.rOrder);var s=t.t;e.position.set(s[0],s[1],s[2]);var r=t.s;e.scale.set(r[0],r[1],r[2]),e.matrixAutoUpdate=!1,e.updateMatrix()}vec2(e=null,t=null){return new W(e,t)}vec3(e=0,t=0,i=0){return new q(e,t,i)}loadTexture(e,t=null,i={}){if(typeof this.textLoaderArray[e]<"u")s=this.textLoaderArray[e];else{var s=new Q.Texture;this.texLoader.load(e,r=>{t!=null&&(s.format=this.channelFormats[t]),s.image=r,s.needsUpdate=!0,i.length>0&&Object.keys(i).forEach(u=>{s[u]=i[u]})}),this.textLoaderArray[e]=s}return s}getVideoTexture(e){let t=new Q.VideoTexture(e);return t.minFilter=Q.LinearFilter,t.magFilter=Q.LinearFilter,t.format=Q.RGBFormat,t}getCanvasTexture(e){let t=new Q.CanvasTexture(e),i=new Q.MeshBasicMaterial({map:t});return{texture:t,material:i}}};import*as H from"./three.module.js";import{AmbientLight as qs,AnimationClip as er,Bone as di,BufferAttribute as tr,BufferGeometry as nt,ClampToEdgeWrapping as mi,Color as ye,DirectionalLight as ir,EquirectangularReflectionMapping as sr,Euler as Oe,FileLoader as rr,Float32BufferAttribute as Ae,Group as fi,Line as ar,LineBasicMaterial as or,Loader as vi,LoaderUtils as Rt,MathUtils as he,Matrix3 as lr,Matrix4 as K,Mesh as nr,MeshLambertMaterial as ur,MeshPhongMaterial as At,NumberKeyframeTrack as hr,Object3D as kt,OrthographicCamera as cr,PerspectiveCamera as dr,PointLight as gi,PropertyBinding as ut,Quaternion as ht,QuaternionKeyframeTrack as pr,RepeatWrapping as xi,Skeleton as mr,SkinnedMesh as fr,SpotLight as vr,Texture as yi,TextureLoader as gr,Uint16BufferAttribute as xr,Vector3 as ct,Vector4 as yr,VectorKeyframeTrack as br,sRGBEncoding as dt}from"./three.module.js";var li={},ie=void 0,Xs=li;function St(o,e){var t=o.split("."),i=Xs;!(t[0]in i)&&i.execScript&&i.execScript("var "+t[0]);for(var s;t.length&&(s=t.shift());)!t.length&&e!==ie?i[s]=e:i=i[s]?i[s]:i[s]={}}var Y=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u"&&typeof DataView<"u";function Se(o){var e=o.length,t=0,i=Number.POSITIVE_INFINITY,s,r,l,u,v,p,g,m,C,y;for(m=0;m<e;++m)o[m]>t&&(t=o[m]),o[m]<i&&(i=o[m]);for(s=1<<t,r=new(Y?Uint32Array:Array)(s),l=1,u=0,v=2;l<=t;){for(m=0;m<e;++m)if(o[m]===l){for(p=0,g=u,C=0;C<l;++C)p=p<<1|g&1,g>>=1;for(y=l<<16|m,C=p;C<s;C+=v)r[C]=y;++u}++l,u<<=1,v<<=1}return[r,t,i]}function ge(o,e){switch(this.g=[],this.h=32768,this.d=this.f=this.a=this.l=0,this.input=Y?new Uint8Array(o):o,this.m=!1,this.i=rt,this.r=!1,(e||!(e={}))&&(e.index&&(this.a=e.index),e.bufferSize&&(this.h=e.bufferSize),e.bufferType&&(this.i=e.bufferType),e.resize&&(this.r=e.resize)),this.i){case Dt:this.b=32768,this.c=new(Y?Uint8Array:Array)(32768+this.h+258);break;case rt:this.b=0,this.c=new(Y?Uint8Array:Array)(this.h),this.e=this.z,this.n=this.v,this.j=this.w;break;default:throw Error("invalid inflate mode")}}var Dt=0,rt=1,Zt={t:Dt,s:rt};ge.prototype.k=function(){for(;!this.m;){var o=oe(this,3);switch(o&1&&(this.m=!0),o>>>=1,o){case 0:var e=this.input,t=this.a,i=this.c,s=this.b,r=e.length,l=ie,u=ie,v=i.length,p=ie;if(this.d=this.f=0,t+1>=r)throw Error("invalid uncompressed block header: LEN");if(l=e[t++]|e[t++]<<8,t+1>=r)throw Error("invalid uncompressed block header: NLEN");if(u=e[t++]|e[t++]<<8,l===~u)throw Error("invalid uncompressed block header: length verify");if(t+l>e.length)throw Error("input buffer is broken");switch(this.i){case Dt:for(;s+l>i.length;){if(p=v-s,l-=p,Y)i.set(e.subarray(t,t+p),s),s+=p,t+=p;else for(;p--;)i[s++]=e[t++];this.b=s,i=this.e(),s=this.b}break;case rt:for(;s+l>i.length;)i=this.e({p:2});break;default:throw Error("invalid inflate mode")}if(Y)i.set(e.subarray(t,t+l),s),s+=l,t+=l;else for(;l--;)i[s++]=e[t++];this.a=t,this.b=s,this.c=i;break;case 1:this.j(Ys,$s);break;case 2:for(var g=oe(this,5)+257,m=oe(this,5)+1,C=oe(this,4)+4,y=new(Y?Uint8Array:Array)(Ct.length),f=ie,w=ie,b=ie,P=ie,S=ie,L=ie,T=ie,U=ie,k=ie,U=0;U<C;++U)y[Ct[U]]=oe(this,3);if(!Y)for(U=C,C=y.length;U<C;++U)y[Ct[U]]=0;for(f=Se(y),P=new(Y?Uint8Array:Array)(g+m),U=0,k=g+m;U<k;)switch(S=Ve(this,f),S){case 16:for(T=3+oe(this,2);T--;)P[U++]=L;break;case 17:for(T=3+oe(this,3);T--;)P[U++]=0;L=0;break;case 18:for(T=11+oe(this,7);T--;)P[U++]=0;L=0;break;default:L=P[U++]=S}w=Se(Y?P.subarray(0,g):P.slice(0,g)),b=Se(Y?P.subarray(g):P.slice(g)),this.j(w,b);break;default:throw Error("unknown BTYPE: "+o)}}return this.n()};var Jt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Ct=Y?new Uint16Array(Jt):Jt,qt=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],ni=Y?new Uint16Array(qt):qt,ei=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],at=Y?new Uint8Array(ei):ei,ti=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],ui=Y?new Uint16Array(ti):ti,ii=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],ot=Y?new Uint8Array(ii):ii,Pt=new(Y?Uint8Array:Array)(288),Ee,si;Ee=0;for(si=Pt.length;Ee<si;++Ee)Pt[Ee]=143>=Ee?8:255>=Ee?9:279>=Ee?7:8;var Ys=Se(Pt),wt=new(Y?Uint8Array:Array)(30),st,ri;st=0;for(ri=wt.length;st<ri;++st)wt[st]=5;var $s=Se(wt);function oe(o,e){for(var t=o.f,i=o.d,s=o.input,r=o.a,l=s.length,u;i<e;){if(r>=l)throw Error("input buffer is broken");t|=s[r++]<<i,i+=8}return u=t&(1<<e)-1,o.f=t>>>e,o.d=i-e,o.a=r,u}function Ve(o,e){for(var t=o.f,i=o.d,s=o.input,r=o.a,l=s.length,u=e[0],v=e[1],p,g;i<v&&!(r>=l);)t|=s[r++]<<i,i+=8;if(p=u[t&(1<<v)-1],g=p>>>16,g>i)throw Error("invalid code length: "+g);return o.f=t>>g,o.d=i-g,o.a=r,p&65535}ge.prototype.j=function(o,e){var t=this.c,i=this.b;this.o=o;for(var s=t.length-258,r,l,u,v;(r=Ve(this,o))!==256;)if(256>r)i>=s&&(this.b=i,t=this.e(),i=this.b),t[i++]=r;else for(l=r-257,v=ni[l],0<at[l]&&(v+=oe(this,at[l])),r=Ve(this,e),u=ui[r],0<ot[r]&&(u+=oe(this,ot[r])),i>=s&&(this.b=i,t=this.e(),i=this.b);v--;)t[i]=t[i++-u];for(;8<=this.d;)this.d-=8,this.a--;this.b=i};ge.prototype.w=function(o,e){var t=this.c,i=this.b;this.o=o;for(var s=t.length,r,l,u,v;(r=Ve(this,o))!==256;)if(256>r)i>=s&&(t=this.e(),s=t.length),t[i++]=r;else for(l=r-257,v=ni[l],0<at[l]&&(v+=oe(this,at[l])),r=Ve(this,e),u=ui[r],0<ot[r]&&(u+=oe(this,ot[r])),i+v>s&&(t=this.e(),s=t.length);v--;)t[i]=t[i++-u];for(;8<=this.d;)this.d-=8,this.a--;this.b=i};ge.prototype.e=function(){var o=new(Y?Uint8Array:Array)(this.b-32768),e=this.b-32768,t,i,s=this.c;if(Y)o.set(s.subarray(32768,o.length));else for(t=0,i=o.length;t<i;++t)o[t]=s[t+32768];if(this.g.push(o),this.l+=o.length,Y)s.set(s.subarray(e,e+32768));else for(t=0;32768>t;++t)s[t]=s[e+t];return this.b=32768,s};ge.prototype.z=function(o){var e,t=this.input.length/this.a+1|0,i,s,r,l=this.input,u=this.c;return o&&(typeof o.p=="number"&&(t=o.p),typeof o.u=="number"&&(t+=o.u)),2>t?(i=(l.length-this.a)/this.o[2],r=258*(i/2)|0,s=r<u.length?u.length+r:u.length<<1):s=u.length*t,Y?(e=new Uint8Array(s),e.set(u)):e=u,this.c=e};ge.prototype.n=function(){var o=0,e=this.c,t=this.g,i,s=new(Y?Uint8Array:Array)(this.l+(this.b-32768)),r,l,u,v;if(t.length===0)return Y?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);for(r=0,l=t.length;r<l;++r)for(i=t[r],u=0,v=i.length;u<v;++u)s[o++]=i[u];for(r=32768,l=this.b;r<l;++r)s[o++]=e[r];return this.g=[],this.buffer=s};ge.prototype.v=function(){var o,e=this.b;return Y?this.r?(o=new Uint8Array(e),o.set(this.c.subarray(0,e))):o=this.c.subarray(0,e):(this.c.length>e&&(this.c.length=e),o=this.c),this.buffer=o};function Tt(o,e){var t,i;switch(this.input=o,this.a=0,(e||!(e={}))&&(e.index&&(this.a=e.index),e.verify&&(this.A=e.verify)),t=o[this.a++],i=o[this.a++],t&15){case ai:this.method=ai;break;default:throw Error("unsupported compression method")}if(((t<<8)+i)%31!==0)throw Error("invalid fcheck flag:"+((t<<8)+i)%31);if(i&32)throw Error("fdict flag is not supported");this.q=new ge(o,{index:this.a,bufferSize:e.bufferSize,bufferType:e.bufferType,resize:e.resize})}Tt.prototype.k=function(){var o=this.input,e,t;if(e=this.q.k(),this.a=this.q.a,this.A){t=(o[this.a++]<<24|o[this.a++]<<16|o[this.a++]<<8|o[this.a++])>>>0;var i=e;if(typeof i=="string"){var s=i.split(""),r,l;for(r=0,l=s.length;r<l;r++)s[r]=(s[r].charCodeAt(0)&255)>>>0;i=s}for(var u=1,v=0,p=i.length,g,m=0;0<p;){g=1024<p?1024:p,p-=g;do u+=i[m++],v+=u;while(--g);u%=65521,v%=65521}if(t!==(v<<16|u)>>>0)throw Error("invalid adler-32 checksum")}return e};var ai=8;St("Zlib.Inflate",Tt);St("Zlib.Inflate.prototype.decompress",Tt.prototype.k);var Et={ADAPTIVE:Zt.s,BLOCK:Zt.t},_e,Fe,Re,oi;if(Object.keys)_e=Object.keys(Et);else for(Fe in _e=[],Re=0,Et)_e[Re++]=Fe;Re=0;for(oi=_e.length;Re<oi;++Re)Fe=_e[Re],St("Zlib.Inflate.BufferType."+Fe,Et[Fe]);var Mt=li.Zlib;import{Curve as hi,Vector3 as ci,Vector4 as Js}from"./three.module.js";import{Vector3 as Zs,Vector4 as lt}from"./three.module.js";var Lt={findSpan:function(o,e,t){var i=t.length-o-1;if(e>=t[i])return i-1;if(e<=t[o])return o;for(var s=o,r=i,l=Math.floor((s+r)/2);e<t[l]||e>=t[l+1];)e<t[l]?r=l:s=l,l=Math.floor((s+r)/2);return l},calcBasisFunctions:function(o,e,t,i){var s=[],r=[],l=[];s[0]=1;for(var u=1;u<=t;++u){r[u]=e-i[o+1-u],l[u]=i[o+u]-e;for(var v=0,p=0;p<u;++p){var g=l[p+1],m=r[u-p],C=s[p]/(g+m);s[p]=v+g*C,v=m*C}s[u]=v}return s},calcBSplinePoint:function(o,e,t,i){for(var s=this.findSpan(o,i,e),r=this.calcBasisFunctions(s,i,o,e),l=new lt(0,0,0,0),u=0;u<=o;++u){var v=t[s-o+u],p=r[u],g=v.w*p;l.x+=v.x*g,l.y+=v.y*g,l.z+=v.z*g,l.w+=v.w*p}return l},calcBasisFunctionDerivatives:function(o,e,t,i,s){for(var r=[],l=0;l<=t;++l)r[l]=0;for(var u=[],l=0;l<=i;++l)u[l]=r.slice(0);for(var v=[],l=0;l<=t;++l)v[l]=r.slice(0);v[0][0]=1;for(var p=r.slice(0),g=r.slice(0),m=1;m<=t;++m){p[m]=e-s[o+1-m],g[m]=s[o+m]-e;for(var C=0,G=0;G<m;++G){var y=g[G+1],f=p[m-G];v[m][G]=y+f;var w=v[G][m-1]/v[m][G];v[G][m]=C+y*w,C=f*w}v[m][m]=C}for(var m=0;m<=t;++m)u[0][m]=v[m][t];for(var G=0;G<=t;++G){for(var b=0,P=1,S=[],l=0;l<=t;++l)S[l]=r.slice(0);S[0][0]=1;for(var L=1;L<=i;++L){var T=0,k=G-L,U=t-L;G>=L&&(S[P][0]=S[b][0]/v[U+1][k],T=S[P][0]*v[k][U]);for(var j=k>=-1?1:-k,N=G-1<=U?L-1:t-G,m=j;m<=N;++m)S[P][m]=(S[b][m]-S[b][m-1])/v[U+1][k+m],T+=S[P][m]*v[k+m][U];G<=U&&(S[P][L]=-S[b][L-1]/v[U+1][G],T+=S[P][L]*v[G][U]),u[L][G]=T;var m=b;b=P,P=m}}for(var G=t,L=1;L<=i;++L){for(var m=0;m<=t;++m)u[L][m]*=G;G*=t-L}return u},calcBSplineDerivatives:function(o,e,t,i,s){for(var r=s<o?s:o,l=[],u=this.findSpan(o,i,e),v=this.calcBasisFunctionDerivatives(u,i,o,r,e),p=[],g=0;g<t.length;++g){var m=t[g].clone(),C=m.w;m.x*=C,m.y*=C,m.z*=C,p[g]=m}for(var y=0;y<=r;++y){for(var m=p[u-o].clone().multiplyScalar(v[y][0]),f=1;f<=o;++f)m.add(p[u-o+f].clone().multiplyScalar(v[y][f]));l[y]=m}for(var y=r+1;y<=s+1;++y)l[y]=new lt(0,0,0);return l},calcKoverI:function(o,e){for(var t=1,i=2;i<=o;++i)t*=i;for(var s=1,i=2;i<=e;++i)s*=i;for(var i=2;i<=o-e;++i)s*=i;return t/s},calcRationalCurveDerivatives:function(o){for(var e=o.length,t=[],i=[],s=0;s<e;++s){var r=o[s];t[s]=new Zs(r.x,r.y,r.z),i[s]=r.w}for(var l=[],u=0;u<e;++u){for(var v=t[u].clone(),s=1;s<=u;++s)v.sub(l[u-s].clone().multiplyScalar(this.calcKoverI(u,s)*i[s]));l[u]=v.divideScalar(i[0])}return l},calcNURBSDerivatives:function(o,e,t,i,s){var r=this.calcBSplineDerivatives(o,e,t,i,s);return this.calcRationalCurveDerivatives(r)},calcSurfacePoint:function(o,e,t,i,s,r,l,u){for(var v=this.findSpan(o,r,t),p=this.findSpan(e,l,i),g=this.calcBasisFunctions(v,r,o,t),m=this.calcBasisFunctions(p,l,e,i),C=[],y=0;y<=e;++y){C[y]=new lt(0,0,0,0);for(var f=0;f<=o;++f){var w=s[v-o+f][p-e+y].clone(),b=w.w;w.x*=b,w.y*=b,w.z*=b,C[y].add(w.multiplyScalar(g[f]))}}for(var P=new lt(0,0,0,0),y=0;y<=e;++y)P.add(C[y].multiplyScalar(m[y]));P.divideScalar(P.w),u.set(P.x,P.y,P.z)}};var xe=function(o,e,t,i,s){hi.call(this),this.degree=o,this.knots=e,this.controlPoints=[],this.startKnot=i||0,this.endKnot=s||this.knots.length-1;for(var r=0;r<t.length;++r){var l=t[r];this.controlPoints[r]=new Js(l.x,l.y,l.z,l.w)}};xe.prototype=Object.create(hi.prototype);xe.prototype.constructor=xe;xe.prototype.getPoint=function(o,e){var t=e||new ci,i=this.knots[this.startKnot]+o*(this.knots[this.endKnot]-this.knots[this.startKnot]),s=Lt.calcBSplinePoint(this.degree,this.knots,this.controlPoints,i);return s.w!=1&&s.divideScalar(s.w),t.set(s.x,s.y,s.z)};xe.prototype.getTangent=function(o,e){var t=e||new ci,i=this.knots[0]+o*(this.knots[this.knots.length-1]-this.knots[0]),s=Lt.calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,i,1);return t.copy(s[1]).normalize(),t};var Ge=function(){var o,e,t;function i(a){vi.call(this,a)}i.prototype=Object.assign(Object.create(vi.prototype),{constructor:i,load:function(a,n,h,d){var c=this,x=c.path===""?Rt.extractUrlBase(a):c.path,E=new rr(this.manager);E.setPath(c.path),E.setResponseType("arraybuffer"),E.load(a,function(D){try{n(c.parse(D,x))}catch(R){setTimeout(function(){d&&d(R),c.manager.itemError(a)},0)}},h,d)},parse:function(a,n){if(m(a))o=new v().parse(a);else{var h=U(a);if(!C(h))throw new Error("THREE.FBXLoader: Unknown format.");if(y(h)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+y(h));o=new u().parse(h)}var d=new gr(this.manager).setPath(this.resourcePath||n).setCrossOrigin(this.crossOrigin);return new s(d,this.manager).parse(o)}});function s(a,n){this.textureLoader=a,this.manager=n}s.prototype={constructor:s,parse:function(){e=this.parseConnections();var a=this.parseImages(),n=this.parseTextures(a),h=this.parseMaterials(n),d=this.parseDeformers(),c=new r().parse(d);return this.parseScene(d,c,h),t},parseConnections:function(){var a=new Map;if("Connections"in o){var n=o.Connections.connections;n.forEach(function(h){var d=h[0],c=h[1],x=h[2];a.has(d)||a.set(d,{parents:[],children:[]});var E={ID:c,relationship:x};a.get(d).parents.push(E),a.has(c)||a.set(c,{parents:[],children:[]});var D={ID:d,relationship:x};a.get(c).children.push(D)})}return a},parseImages:function(){var a={},n={};if("Video"in o.Objects){var h=o.Objects.Video;for(var d in h){var c=h[d],x=parseInt(d);if(a[x]=c.RelativeFilename||c.Filename,"Content"in c){var E=c.Content instanceof ArrayBuffer&&c.Content.byteLength>0,D=typeof c.Content=="string"&&c.Content!=="";if(E||D){var R=this.parseImage(h[d]);n[c.RelativeFilename||c.Filename]=R}}}}for(var x in a){var B=a[x];n[B]!==void 0?a[x]=n[B]:a[x]=a[x].split("\\").pop()}return a},parseImage:function(a){var n=a.Content,h=a.RelativeFilename||a.Filename,d=h.slice(h.lastIndexOf(".")+1).toLowerCase(),c;switch(d){case"bmp":c="image/bmp";break;case"jpg":case"jpeg":c="image/jpeg";break;case"png":c="image/png";break;case"tif":c="image  iff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",h),c="image  ga";break;default:console.warn('FBXLoader: Image type "'+d+'" is not supported.');return}if(typeof n=="string")return"data:"+c+";base64,"+n;var x=new Uint8Array(n);return window.URL.createObjectURL(new Blob([x],{type:c}))},parseTextures:function(a){var n=new Map;if("Texture"in o.Objects){var h=o.Objects.Texture;for(var d in h){var c=this.parseTexture(h[d],a);n.set(parseInt(d),c)}}return n},parseTexture:function(a,n){var h=this.loadTexture(a,n);h.ID=a.id,h.name=a.attrName;var d=a.WrapModeU,c=a.WrapModeV,x=d!==void 0?d.value:0,E=c!==void 0?c.value:0;if(h.wrapS=x===0?xi:mi,h.wrapT=E===0?xi:mi,"Scaling"in a){var D=a.Scaling.value;h.repeat.x=D[0],h.repeat.y=D[1]}return h},loadTexture:function(a,n){var h,d=this.textureLoader.path,c=e.get(a.id).children;c!==void 0&&c.length>0&&n[c[0].ID]!==void 0&&(h=n[c[0].ID],(h.indexOf("blob:")===0||h.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));var x,E=a.FileName.slice(-3).toLowerCase();if(E==="tga"){var D=this.manager.getHandler(".tga");D===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",a.RelativeFilename),x=new yi):x=D.load(h)}else E==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",a.RelativeFilename),x=new yi):x=this.textureLoader.load(h);return this.textureLoader.setPath(d),x},parseMaterials:function(a){var n=new Map;if("Material"in o.Objects){var h=o.Objects.Material;for(var d in h){var c=this.parseMaterial(h[d],a);c!==null&&n.set(parseInt(d),c)}}return n},parseMaterial:function(a,n){var h=a.id,d=a.attrName,c=a.ShadingModel;if(typeof c=="object"&&(c=c.value),!e.has(h))return null;var x=this.parseParameters(a,n,h),E;switch(c.toLowerCase()){case"phong":E=new At;break;case"lambert":E=new ur;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',c),E=new At;break}return E.setValues(x),E.name=d,E},parseParameters:function(a,n,h){var d={};a.BumpFactor&&(d.bumpScale=a.BumpFactor.value),a.Diffuse?d.color=new ye().fromArray(a.Diffuse.value):a.DiffuseColor&&a.DiffuseColor.type==="Color"&&(d.color=new ye().fromArray(a.DiffuseColor.value)),a.DisplacementFactor&&(d.displacementScale=a.DisplacementFactor.value),a.Emissive?d.emissive=new ye().fromArray(a.Emissive.value):a.EmissiveColor&&a.EmissiveColor.type==="Color"&&(d.emissive=new ye().fromArray(a.EmissiveColor.value)),a.EmissiveFactor&&(d.emissiveIntensity=parseFloat(a.EmissiveFactor.value)),a.Opacity&&(d.opacity=parseFloat(a.Opacity.value)),d.opacity<1&&(d.transparent=!0),a.ReflectionFactor&&(d.reflectivity=a.ReflectionFactor.value),a.Shininess&&(d.shininess=a.Shininess.value),a.Specular?d.specular=new ye().fromArray(a.Specular.value):a.SpecularColor&&a.SpecularColor.type==="Color"&&(d.specular=new ye().fromArray(a.SpecularColor.value));var c=this;return e.get(h).children.forEach(function(x){var E=x.relationship;switch(E){case"Bump":d.bumpMap=c.getTexture(n,x.ID);break;case"Maya|TEX_ao_map":d.aoMap=c.getTexture(n,x.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":d.map=c.getTexture(n,x.ID),d.map.encoding=dt;break;case"DisplacementColor":d.displacementMap=c.getTexture(n,x.ID);break;case"AmbientColor":case"EmissiveColor":d.emissiveMap=c.getTexture(n,x.ID),d.emissiveMap.encoding=dt;break;case"NormalMap":case"Maya|TEX_normal_map":d.normalMap=c.getTexture(n,x.ID);break;case"ReflectionColor":d.envMap=c.getTexture(n,x.ID),d.envMap.mapping=sr,d.envMap.encoding=dt;break;case"SpecularColor":d.specularMap=c.getTexture(n,x.ID),d.specularMap.encoding=dt;break;case"TransparentColor":case"TransparencyFactor":d.alphaMap=c.getTexture(n,x.ID),d.transparent=!0;break;case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",E);break}}),d},getTexture:function(a,n){return"LayeredTexture"in o.Objects&&n in o.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),n=e.get(n).children[0].ID),a.get(n)},parseDeformers:function(){var a={},n={};if("Deformer"in o.Objects){var h=o.Objects.Deformer;for(var d in h){var c=h[d],x=e.get(parseInt(d));if(c.attrType==="Skin"){var E=this.parseSkeleton(x,h);E.ID=d,x.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),E.geometryID=x.parents[0].ID,a[d]=E}else if(c.attrType==="BlendShape"){var D={id:d};D.rawTargets=this.parseMorphTargets(x,h),D.id=d,x.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),n[d]=D}}}return{skeletons:a,morphTargets:n}},parseSkeleton:function(a,n){var h=[];return a.children.forEach(function(d){var c=n[d.ID];if(c.attrType==="Cluster"){var x={ID:d.ID,indices:[],weights:[],transformLink:new K().fromArray(c.TransformLink.a)};"Indexes"in c&&(x.indices=c.Indexes.a,x.weights=c.Weights.a),h.push(x)}}),{rawBones:h,bones:[]}},parseMorphTargets:function(a,n){for(var h=[],d=0;d<a.children.length;d++){var c=a.children[d],x=n[c.ID],E={name:x.attrName,initialWeight:x.DeformPercent,id:x.id,fullWeights:x.FullWeights.a};if(x.attrType!=="BlendShapeChannel")return;E.geoID=e.get(parseInt(c.ID)).children.filter(function(D){return D.relationship===void 0})[0].ID,h.push(E)}return h},parseScene:function(a,n,h){t=new fi;var d=this.parseModels(a.skeletons,n,h),c=o.Objects.Model,x=this;d.forEach(function(D){var R=c[D.ID];x.setLookAtProperties(D,R);var B=e.get(D.ID).parents;B.forEach(function(M){var _=d.get(M.ID);_!==void 0&&_.add(D)}),D.parent===null&&t.add(D)}),this.bindSkeleton(a.skeletons,n,d),this.createAmbientLight(),this.setupMorphMaterials(),t.traverse(function(D){if(D.userData.transformData){D.parent&&(D.userData.transformData.parentMatrixWorld=D.parent.matrix);var R=L(D.userData.transformData);D.applyMatrix4(R)}});var E=new l().parse();t.children.length===1&&t.children[0].isGroup&&(t.children[0].animations=E,t=t.children[0]),t.animations=E},parseModels:function(a,n,h){var d=new Map,c=o.Objects.Model,x=["Culling","DefaultAttributeIndex","InheritType","Lcl_Translation","Lcl_Rotation","Lcl_Scaling","RotationPivot","ScalingPivot","RotationActive","ScalingMax","RotationOffset","fbx_node_path","Shading","Version","attrName","attrType","currentUVSet","id","name","propertyList","singleProperty"];for(var E in c){var D=parseInt(E),R=c[E],B=e.get(D),M=this.buildSkeleton(B,a,D,R.attrName);if(!M){switch(R.attrType){case"Camera":M=this.createCamera(B);break;case"Light":M=this.createLight(B);break;case"Mesh":M=this.createMesh(B,n,h);break;case"NurbsCurve":M=this.createCurve(B,n);break;case"LimbNode":case"Root":M=new di;break;case"Null":default:M=new fi;break}M.name=R.attrName?ut.sanitizeNodeName(R.attrName):"",M.ID=D}Object.keys(R).forEach(F=>{x.includes(F)||(M.userData[F]=R[F].value)}),this.getTransformData(M,R),d.set(D,M)}return d},buildSkeleton:function(a,n,h,d){var c=null;return a.parents.forEach(function(x){for(var E in n){var D=n[E];D.rawBones.forEach(function(R,B){if(R.ID===x.ID){var M=c;c=new di,c.matrixWorld.copy(R.transformLink),c.name=d?ut.sanitizeNodeName(d):"",c.ID=h,D.bones[B]=c,M!==null&&c.add(M)}})}}),c},createCamera:function(a){var n,h;if(a.children.forEach(function(_){var F=o.Objects.NodeAttribute[_.ID];F!==void 0&&(h=F)}),h===void 0)n=new kt;else{var d=0;h.CameraProjectionType!==void 0&&h.CameraProjectionType.value===1&&(d=1);var c=1;h.NearPlane!==void 0&&(c=h.NearPlane.value/1e3);var x=1e3;h.FarPlane!==void 0&&(x=h.FarPlane.value/1e3);var E=window.innerWidth,D=window.innerHeight;h.AspectWidth!==void 0&&h.AspectHeight!==void 0&&(E=h.AspectWidth.value,D=h.AspectHeight.value);var R=E/D,B=45;h.FieldOfView!==void 0&&(B=h.FieldOfView.value);var M=h.FocalLength?h.FocalLength.value:null;switch(d){case 0:n=new dr(B,R,c,x),M!==null&&n.setFocalLength(M);break;case 1:n=new cr(-E/2,E/2,D/2,-D/2,c,x);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+d+"."),n=new kt;break}}return n},createLight:function(a){var n,h;if(a.children.forEach(function(M){var _=o.Objects.NodeAttribute[M.ID];_!==void 0&&(h=_)}),h===void 0)n=new kt;else{var d;h.LightType===void 0?d=0:d=h.LightType.value;var c=16777215;h.Color!==void 0&&(c=new ye().fromArray(h.Color.value));var x=h.Intensity===void 0?1:h.Intensity.value/100;h.CastLightOnObject!==void 0&&h.CastLightOnObject.value===0&&(x=0);var E=0;h.FarAttenuationEnd!==void 0&&(h.EnableFarAttenuation!==void 0&&h.EnableFarAttenuation.value===0?E=0:E=h.FarAttenuationEnd.value);var D=1;switch(d){case 0:n=new gi(c,x,E,D);break;case 1:n=new ir(c,x);break;case 2:var R=Math.PI/3;h.InnerAngle!==void 0&&(R=he.degToRad(h.InnerAngle.value));var B=0;h.OuterAngle!==void 0&&(B=he.degToRad(h.OuterAngle.value),B=Math.max(B,1)),n=new vr(c,x,E,R,B,D);break;default:console.warn("THREE.FBXLoader: Unknown light type "+h.LightType.value+", defaulting to a PointLight."),n=new gi(c,x);break}h.CastShadows!==void 0&&h.CastShadows.value===1&&(n.castShadow=!0)}return n},createMesh:function(a,n,h){var d,c=null,x=null,E=[];return a.children.forEach(function(D){n.has(D.ID)&&(c=n.get(D.ID)),h.has(D.ID)&&E.push(h.get(D.ID))}),E.length>1?x=E:E.length>0?x=E[0]:(x=new At({color:13421772}),E.push(x)),"color"in c.attributes&&E.forEach(function(D){D.vertexColors=!0}),c.FBX_Deformer?(E.forEach(function(D){D.skinning=!0}),d=new fr(c,x),d.normalizeSkinWeights()):d=new nr(c,x),d},createCurve:function(a,n){var h=a.children.reduce(function(c,x){return n.has(x.ID)&&(c=n.get(x.ID)),c},null),d=new or({color:3342591,linewidth:1});return new ar(h,d)},getTransformData:function(a,n){var h={};"InheritType"in n&&(h.inheritType=parseInt(n.InheritType.value)),"RotationOrder"in n?h.eulerOrder=T(n.RotationOrder.value):h.eulerOrder="ZYX","Lcl_Translation"in n&&(h.translation=n.Lcl_Translation.value),"PreRotation"in n&&(h.preRotation=n.PreRotation.value),"Lcl_Rotation"in n&&(h.rotation=n.Lcl_Rotation.value),"PostRotation"in n&&(h.postRotation=n.PostRotation.value),"Lcl_Scaling"in n&&(h.scale=n.Lcl_Scaling.value),"ScalingOffset"in n&&(h.scalingOffset=n.ScalingOffset.value),"ScalingPivot"in n&&(h.scalingPivot=n.ScalingPivot.value),"RotationOffset"in n&&(h.rotationOffset=n.RotationOffset.value),"RotationPivot"in n&&(h.rotationPivot=n.RotationPivot.value),a.userData.transformData=h},setLookAtProperties:function(a,n){if("LookAtProperty"in n){var h=e.get(a.ID).children;h.forEach(function(d){if(d.relationship==="LookAtProperty"){var c=o.Objects.Model[d.ID];if("Lcl_Translation"in c){var x=c.Lcl_Translation.value;a.target!==void 0?(a.target.position.fromArray(x),t.add(a.target)):a.lookAt(new ct().fromArray(x))}}})}},bindSkeleton:function(a,n,h){var d=this.parsePoseNodes();for(var c in a){var x=a[c],E=e.get(parseInt(x.ID)).parents;E.forEach(function(D){if(n.has(D.ID)){var R=D.ID,B=e.get(R);B.parents.forEach(function(M){if(h.has(M.ID)){var _=h.get(M.ID);_.bind(new mr(x.bones),d[M.ID])}})}})}},parsePoseNodes:function(){var a={};if("Pose"in o.Objects){var n=o.Objects.Pose;for(var h in n)if(n[h].attrType==="BindPose"){var d=n[h].PoseNode;Array.isArray(d)?d.forEach(function(c){a[c.Node]=new K().fromArray(c.Matrix.a)}):a[d.Node]=new K().fromArray(d.Matrix.a)}}return a},createAmbientLight:function(){if("GlobalSettings"in o&&"AmbientColor"in o.GlobalSettings){var a=o.GlobalSettings.AmbientColor.value,n=a[0],h=a[1],d=a[2];if(n!==0||h!==0||d!==0){var c=new ye(n,h,d);t.add(new qs(c,1))}}},setupMorphMaterials:function(){var a=this;t.traverse(function(n){n.isMesh&&n.geometry.morphAttributes.position&&n.geometry.morphAttributes.position.length&&(Array.isArray(n.material)?n.material.forEach(function(h,d){a.setupMorphMaterial(n,h,d)}):a.setupMorphMaterial(n,n.material))})},setupMorphMaterial:function(a,n,h){var d=a.uuid,c=n.uuid,x=!1;if(t.traverse(function(D){D.isMesh&&(Array.isArray(D.material)?D.material.forEach(function(R){R.uuid===c&&D.uuid!==d&&(x=!0)}):D.material.uuid===c&&D.uuid!==d&&(x=!0))}),x===!0){var E=n.clone();E.morphTargets=!0,h===void 0?a.material=E:a.material[h]=E}else n.morphTargets=!0}};function r(){}r.prototype={constructor:r,parse:function(a){var n=new Map;if("Geometry"in o.Objects){var h=o.Objects.Geometry;for(var d in h){var c=e.get(parseInt(d)),x=this.parseGeometry(c,h[d],a);n.set(parseInt(d),x)}}return n},parseGeometry:function(a,n,h){switch(n.attrType){case"Mesh":return this.parseMeshGeometry(a,n,h);case"NurbsCurve":return this.parseNurbsGeometry(n)}},parseMeshGeometry:function(a,n,h){var d=h.skeletons,c=[],x=a.parents.map(function(M){return o.Objects.Model[M.ID]});if(x.length!==0){var E=a.children.reduce(function(M,_){return d[_.ID]!==void 0&&(M=d[_.ID]),M},null);a.children.forEach(function(M){h.morphTargets[M.ID]!==void 0&&c.push(h.morphTargets[M.ID])});var D=x[0],R={};"RotationOrder"in D&&(R.eulerOrder=T(D.RotationOrder.value)),"InheritType"in D&&(R.inheritType=parseInt(D.InheritType.value)),"GeometricTranslation"in D&&(R.translation=D.GeometricTranslation.value),"GeometricRotation"in D&&(R.rotation=D.GeometricRotation.value),"GeometricScaling"in D&&(R.scale=D.GeometricScaling.value);var B=L(R);return this.genGeometry(n,E,c,B)}},genGeometry:function(a,n,h,d){var c=new nt;a.attrName&&(c.name=a.attrName);var x=this.parseGeoNode(a,n),E=this.genBuffers(x),D=new Ae(E.vertex,3);if(D.applyMatrix4(d),c.setAttribute("position",D),E.colors.length>0&&c.setAttribute("color",new Ae(E.colors,3)),n&&(c.setAttribute("skinIndex",new xr(E.weightsIndices,4)),c.setAttribute("skinWeight",new Ae(E.vertexWeights,4)),c.FBX_Deformer=n),E.normal.length>0){var R=new lr().getNormalMatrix(d),B=new Ae(E.normal,3);B.applyNormalMatrix(R),c.setAttribute("normal",B)}if(E.uvs.forEach(function(ee,$){var J="uv"+($+1).toString();$===0&&(J="uv"),c.setAttribute(J,new Ae(E.uvs[$],2))}),x.material&&x.material.mappingType!=="AllSame"){var M=E.materialIndex[0],_=0;if(E.materialIndex.forEach(function(ee,$){ee!==M&&(c.addGroup(_,$-_,M),M=ee,_=$)}),c.groups.length>0){var F=c.groups[c.groups.length-1],z=F.start+F.count;z!==E.materialIndex.length&&c.addGroup(z,E.materialIndex.length-z,M)}c.groups.length===0&&c.addGroup(0,E.materialIndex.length,E.materialIndex[0])}return this.addMorphTargets(c,a,h,d),c},parseGeoNode:function(a,n){var h={};if(h.vertexPositions=a.Vertices!==void 0?a.Vertices.a:[],h.vertexIndices=a.PolygonVertexIndex!==void 0?a.PolygonVertexIndex.a:[],a.LayerElementColor&&(h.color=this.parseVertexColors(a.LayerElementColor[0])),a.LayerElementMaterial&&(h.material=this.parseMaterialIndices(a.LayerElementMaterial[0])),a.LayerElementNormal&&(h.normal=this.parseNormals(a.LayerElementNormal[0])),a.LayerElementUV){h.uv=[];for(var d=0;a.LayerElementUV[d];)h.uv.push(this.parseUVs(a.LayerElementUV[d])),d++}if(a.LayerElementUserData){h.userAttrs=[];for(var d=0;a.LayerElementUserData[d];)d++}return h.weightTable={},n!==null&&(h.skeleton=n,n.rawBones.forEach(function(c,x){c.indices.forEach(function(E,D){h.weightTable[E]===void 0&&(h.weightTable[E]=[]),h.weightTable[E].push({id:x,weight:c.weights[D]})})})),h},genBuffers:function(a){var n={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},h=0,d=0,c=!1,x=[],E=[],D=[],R=[],B=[],M=[],_=this;return a.vertexIndices.forEach(function(F,z){var ee=!1;F<0&&(F=F^-1,ee=!0);var $=[],J=[];if(x.push(F*3,F*3+1,F*3+2),a.color){var se=b(z,h,F,a.color);D.push(se[0],se[1],se[2])}if(a.skeleton){if(a.weightTable[F]!==void 0&&a.weightTable[F].forEach(function(fe){J.push(fe.weight),$.push(fe.id)}),J.length>4){c||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),c=!0);var me=[0,0,0,0],De=[0,0,0,0];J.forEach(function(fe,le){var ve=fe,it=$[le];De.forEach(function(Xt,yt,Fs){if(ve>Xt){Fs[yt]=ve,ve=Xt;var Vs=me[yt];me[yt]=it,it=Vs}})}),$=me,J=De}for(;J.length<4;)J.push(0),$.push(0);for(var Te=0;Te<4;++Te)B.push(J[Te]),M.push($[Te])}if(a.normal){var se=b(z,h,F,a.normal);E.push(se[0],se[1],se[2])}if(a.material&&a.material.mappingType!=="AllSame")var xt=b(z,h,F,a.material)[0];a.uv&&a.uv.forEach(function(fe,le){var ve=b(z,h,F,fe);R[le]===void 0&&(R[le]=[]),R[le].push(ve[0]),R[le].push(ve[1])}),d++,ee&&(_.genFace(n,a,x,xt,E,D,R,B,M,d),h++,d=0,x=[],E=[],D=[],R=[],B=[],M=[])}),n},genFace:function(a,n,h,d,c,x,E,D,R,B){for(var M=2;M<B;M++)a.vertex.push(n.vertexPositions[h[0]]),a.vertex.push(n.vertexPositions[h[1]]),a.vertex.push(n.vertexPositions[h[2]]),a.vertex.push(n.vertexPositions[h[(M-1)*3]]),a.vertex.push(n.vertexPositions[h[(M-1)*3+1]]),a.vertex.push(n.vertexPositions[h[(M-1)*3+2]]),a.vertex.push(n.vertexPositions[h[M*3]]),a.vertex.push(n.vertexPositions[h[M*3+1]]),a.vertex.push(n.vertexPositions[h[M*3+2]]),n.skeleton&&(a.vertexWeights.push(D[0]),a.vertexWeights.push(D[1]),a.vertexWeights.push(D[2]),a.vertexWeights.push(D[3]),a.vertexWeights.push(D[(M-1)*4]),a.vertexWeights.push(D[(M-1)*4+1]),a.vertexWeights.push(D[(M-1)*4+2]),a.vertexWeights.push(D[(M-1)*4+3]),a.vertexWeights.push(D[M*4]),a.vertexWeights.push(D[M*4+1]),a.vertexWeights.push(D[M*4+2]),a.vertexWeights.push(D[M*4+3]),a.weightsIndices.push(R[0]),a.weightsIndices.push(R[1]),a.weightsIndices.push(R[2]),a.weightsIndices.push(R[3]),a.weightsIndices.push(R[(M-1)*4]),a.weightsIndices.push(R[(M-1)*4+1]),a.weightsIndices.push(R[(M-1)*4+2]),a.weightsIndices.push(R[(M-1)*4+3]),a.weightsIndices.push(R[M*4]),a.weightsIndices.push(R[M*4+1]),a.weightsIndices.push(R[M*4+2]),a.weightsIndices.push(R[M*4+3])),n.color&&(a.colors.push(x[0]),a.colors.push(x[1]),a.colors.push(x[2]),a.colors.push(x[(M-1)*3]),a.colors.push(x[(M-1)*3+1]),a.colors.push(x[(M-1)*3+2]),a.colors.push(x[M*3]),a.colors.push(x[M*3+1]),a.colors.push(x[M*3+2])),n.material&&n.material.mappingType!=="AllSame"&&(a.materialIndex.push(d),a.materialIndex.push(d),a.materialIndex.push(d)),n.normal&&(a.normal.push(c[0]),a.normal.push(c[1]),a.normal.push(c[2]),a.normal.push(c[(M-1)*3]),a.normal.push(c[(M-1)*3+1]),a.normal.push(c[(M-1)*3+2]),a.normal.push(c[M*3]),a.normal.push(c[M*3+1]),a.normal.push(c[M*3+2])),n.uv&&n.uv.forEach(function(_,F){a.uvs[F]===void 0&&(a.uvs[F]=[]),a.uvs[F].push(E[F][0]),a.uvs[F].push(E[F][1]),a.uvs[F].push(E[F][(M-1)*2]),a.uvs[F].push(E[F][(M-1)*2+1]),a.uvs[F].push(E[F][M*2]),a.uvs[F].push(E[F][M*2+1])})},addMorphTargets:function(a,n,h,d){if(h.length!==0){a.morphTargetsRelative=!0,a.morphAttributes.position=[];var c=this;h.forEach(function(x){x.rawTargets.forEach(function(E){var D=o.Objects.Geometry[E.geoID];D!==void 0&&c.genMorphGeometry(a,n,D,d,E.name)})})}},genMorphGeometry:function(a,n,h,d,c){for(var x=n.PolygonVertexIndex!==void 0?n.PolygonVertexIndex.a:[],E=h.Vertices!==void 0?h.Vertices.a:[],D=h.Indexes!==void 0?h.Indexes.a:[],R=a.attributes.position.count*3,B=new Float32Array(R),M=0;M<D.length;M++){var _=D[M]*3;B[_]=E[M*3],B[_+1]=E[M*3+1],B[_+2]=E[M*3+2]}var F={vertexIndices:x,vertexPositions:B},z=this.genBuffers(F),ee=new Ae(z.vertex,3);ee.name=c||h.attrName,ee.applyMatrix4(d),a.morphAttributes.position.push(ee)},parseNormals:function(a){var n=a.MappingInformationType,h=a.ReferenceInformationType,d=a.Normals.a,c=[];return h==="IndexToDirect"&&("NormalIndex"in a?c=a.NormalIndex.a:"NormalsIndex"in a&&(c=a.NormalsIndex.a)),{dataSize:3,buffer:d,indices:c,mappingType:n,referenceType:h}},parseUVs:function(a){var n=a.MappingInformationType,h=a.ReferenceInformationType,d=a.UV.a,c=[];return h==="IndexToDirect"&&(c=a.UVIndex.a),{dataSize:2,buffer:d,indices:c,mappingType:n,referenceType:h}},parseVertexColors:function(a){var n=a.MappingInformationType,h=a.ReferenceInformationType,d=a.Colors.a,c=[];return h==="IndexToDirect"&&(c=a.ColorIndex.a),{dataSize:4,buffer:d,indices:c,mappingType:n,referenceType:h}},parseMaterialIndices:function(a){var n=a.MappingInformationType,h=a.ReferenceInformationType;if(n==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:h};for(var d=a.Materials.a,c=[],x=0;x<d.length;++x)c.push(x);return{dataSize:1,buffer:d,indices:c,mappingType:n,referenceType:h}},parseNurbsGeometry:function(a){if(xe===void 0)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new nt;var n=parseInt(a.Order);if(isNaN(n))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",a.Order,a.id),new nt;for(var h=n-1,d=a.KnotVector.a,c=[],x=a.Points.a,E=0,D=x.length;E<D;E+=4)c.push(new yr().fromArray(x,E));var R,B;if(a.Form==="Closed")c.push(c[0]);else if(a.Form==="Periodic"){R=h,B=d.length-1-R;for(var E=0;E<h;++E)c.push(c[E])}var M=new xe(h,d,c,R,B),_=M.getPoints(c.length*7),F=new Float32Array(_.length*3);_.forEach(function(ee,$){ee.toArray(F,$*3)});var z=new nt;return z.setAttribute("position",new tr(F,3)),z}};function l(){}l.prototype={constructor:l,parse:function(){var a=[],n=this.parseClips();if(n!==void 0)for(var h in n){var d=n[h],c=this.addClip(d);a.push(c)}return a},parseClips:function(){if(o.Objects.AnimationCurve!==void 0){var a=this.parseAnimationCurveNodes();this.parseAnimationCurves(a);var n=this.parseAnimationLayers(a),h=this.parseAnimStacks(n);return h}},parseAnimationCurveNodes:function(){var a=o.Objects.AnimationCurveNode,n=new Map;for(var h in a){var d=a[h];if(d.attrName.match(/S|R|T|DeformPercent/)!==null){var c={id:d.id,attr:d.attrName,curves:{}};n.set(c.id,c)}}return n},parseAnimationCurves:function(a){var n=o.Objects.AnimationCurve;for(var h in n){var d={id:n[h].id,times:n[h].KeyTime.a.map(f),values:n[h].KeyValueFloat.a},c=e.get(d.id);if(c!==void 0){var x=c.parents[0].ID,E=c.parents[0].relationship;E.match(/X/)?a.get(x).curves.x=d:E.match(/Y/)?a.get(x).curves.y=d:E.match(/Z/)?a.get(x).curves.z=d:E.match(/d|DeformPercent/)&&a.has(x)&&(a.get(x).curves.morph=d)}}},parseAnimationLayers:function(a){var n=o.Objects.AnimationLayer,h=new Map;for(var d in n){var c=[],x=e.get(parseInt(d));if(x!==void 0){var E=x.children;E.forEach(function(D,R){if(a.has(D.ID)){var B=a.get(D.ID);if(B.curves.x!==void 0||B.curves.y!==void 0||B.curves.z!==void 0){if(c[R]===void 0){var M=e.get(D.ID).parents.filter(function(J){return J.relationship!==void 0})[0].ID;if(M!==void 0){var _=o.Objects.Model[M.toString()],F={modelName:_.attrName?ut.sanitizeNodeName(_.attrName):"",ID:_.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};t.traverse(function(J){J.ID===_.id&&(F.transform=J.matrix,J.userData.transformData&&(F.eulerOrder=J.userData.transformData.eulerOrder))}),F.transform||(F.transform=new K),"PreRotation"in _&&(F.preRotation=_.PreRotation.value),"PostRotation"in _&&(F.postRotation=_.PostRotation.value),c[R]=F}}c[R]&&(c[R][B.attr]=B)}else if(B.curves.morph!==void 0){if(c[R]===void 0){var z=e.get(D.ID).parents.filter(function(De){return De.relationship!==void 0})[0].ID,ee=e.get(z).parents[0].ID,$=e.get(ee).parents[0].ID,M=e.get($).parents[0].ID,_=o.Objects.Model[M],F={modelName:_.attrName?ut.sanitizeNodeName(_.attrName):"",morphName:o.Objects.Deformer[z].attrName};c[R]=F}c[R][B.attr]=B}}}),h.set(parseInt(d),c)}}return h},parseAnimStacks:function(a){var n=o.Objects.AnimationStack,h={};for(var d in n){var c=e.get(parseInt(d)).children;c.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var x=a.get(c[0].ID);h[d]={name:n[d].attrName,layer:x}}return h},addClip:function(a){var n=[],h=this;return a.layer.forEach(function(d){n=n.concat(h.generateTracks(d))}),new er(a.name,-1,n)},generateTracks:function(a){var n=[],h=new ct,d=new ht,c=new ct;if(a.transform&&a.transform.decompose(h,d,c),h=h.toArray(),d=new Oe().setFromQuaternion(d,a.eulerOrder).toArray(),c=c.toArray(),a.T!==void 0&&Object.keys(a.T.curves).length>0){var x=this.generateVectorTrack(a.modelName,a.T.curves,h,"position");x!==void 0&&n.push(x)}if(a.R!==void 0&&Object.keys(a.R.curves).length>0){var E=this.generateRotationTrack(a.modelName,a.R.curves,d,a.preRotation,a.postRotation,a.eulerOrder);E!==void 0&&n.push(E)}if(a.S!==void 0&&Object.keys(a.S.curves).length>0){var D=this.generateVectorTrack(a.modelName,a.S.curves,c,"scale");D!==void 0&&n.push(D)}if(a.DeformPercent!==void 0){var R=this.generateMorphTrack(a);R!==void 0&&n.push(R)}return n},generateVectorTrack:function(a,n,h,d){var c=this.getTimesForAllAxes(n),x=this.getKeyframeTrackValues(c,n,h);return new br(a+"."+d,c,x)},generateRotationTrack:function(a,n,h,d,c,x){n.x!==void 0&&(this.interpolateRotations(n.x),n.x.values=n.x.values.map(he.degToRad)),n.y!==void 0&&(this.interpolateRotations(n.y),n.y.values=n.y.values.map(he.degToRad)),n.z!==void 0&&(this.interpolateRotations(n.z),n.z.values=n.z.values.map(he.degToRad));var E=this.getTimesForAllAxes(n),D=this.getKeyframeTrackValues(E,n,h);d!==void 0&&(d=d.map(he.degToRad),d.push(x),d=new Oe().fromArray(d),d=new ht().setFromEuler(d)),c!==void 0&&(c=c.map(he.degToRad),c.push(x),c=new Oe().fromArray(c),c=new ht().setFromEuler(c).inverse());for(var R=new ht,B=new Oe,M=[],_=0;_<D.length;_+=3)B.set(D[_],D[_+1],D[_+2],x),R.setFromEuler(B),d!==void 0&&R.premultiply(d),c!==void 0&&R.multiply(c),R.toArray(M,_/3*4);return new pr(a+".quaternion",E,M)},generateMorphTrack:function(a){var n=a.DeformPercent.curves.morph,h=n.values.map(function(c){return c/100}),d=t.getObjectByName(a.modelName).morphTargetDictionary[a.morphName];return new hr(a.modelName+".morphTargetInfluences["+d+"]",n.times,h)},getTimesForAllAxes:function(a){var n=[];return a.x!==void 0&&(n=n.concat(a.x.times)),a.y!==void 0&&(n=n.concat(a.y.times)),a.z!==void 0&&(n=n.concat(a.z.times)),n=n.sort(function(h,d){return h-d}).filter(function(h,d,c){return c.indexOf(h)==d}),n},getKeyframeTrackValues:function(a,n,h){var d=h,c=[],x=-1,E=-1,D=-1;return a.forEach(function(R){if(n.x&&(x=n.x.times.indexOf(R)),n.y&&(E=n.y.times.indexOf(R)),n.z&&(D=n.z.times.indexOf(R)),x!==-1){var B=n.x.values[x];c.push(B),d[0]=B}else c.push(d[0]);if(E!==-1){var M=n.y.values[E];c.push(M),d[1]=M}else c.push(d[1]);if(D!==-1){var _=n.z.values[D];c.push(_),d[2]=_}else c.push(d[2])}),c},interpolateRotations:function(a){for(var n=1;n<a.values.length;n++){var h=a.values[n-1],d=a.values[n]-h,c=Math.abs(d);if(c>=180){for(var x=c/180,E=d/x,D=h+E,R=a.times[n-1],B=a.times[n]-R,M=B/x,_=R+M,F=[],z=[];_<a.times[n];)F.push(_),_+=M,z.push(D),D+=E;a.times=G(a.times,n,F),a.values=G(a.values,n,z)}}}};function u(){}u.prototype={constructor:u,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(a){this.nodeStack.push(a),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(a,n){this.currentProp=a,this.currentPropName=n},parse:function(a){this.currentIndent=0,this.allNodes=new g,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var n=this,h=a.split(/[\r\n]+/);return h.forEach(function(d,c){var x=d.match(/^[\s\t]*;/),E=d.match(/^[\s\t]*$/);if(!(x||E)){var D=d.match("^\\t{"+n.currentIndent+"}(\\w+):(.*){",""),R=d.match("^\\t{"+n.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),B=d.match("^\\t{"+(n.currentIndent-1)+"}}");D?n.parseNodeBegin(d,D):R?n.parseNodeProperty(d,R,h[++c]):B?n.popStack():d.match(/^[^\s\t}]/)&&n.parseNodePropertyContinued(d)}}),this.allNodes},parseNodeBegin:function(a,n){var h=n[1].trim().replace(/^"/,"").replace(/"$/,""),d=n[2].split(",").map(function(D){return D.trim().replace(/^"/,"").replace(/"$/,"")}),c={name:h},x=this.parseNodeAttr(d),E=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(h,c):h in E?(h==="PoseNode"?E.PoseNode.push(c):E[h].id!==void 0&&(E[h]={},E[h][E[h].id]=E[h]),x.id!==""&&(E[h][x.id]=c)):typeof x.id=="number"?(E[h]={},E[h][x.id]=c):h!=="Properties70"&&(h==="PoseNode"?E[h]=[c]:E[h]=c),typeof x.id=="number"&&(c.id=x.id),x.name!==""&&(c.attrName=x.name),x.type!==""&&(c.attrType=x.type),this.pushStack(c)},parseNodeAttr:function(a){var n=a[0];a[0]!==""&&(n=parseInt(a[0]),isNaN(n)&&(n=a[0]));var h="",d="";return a.length>1&&(h=a[1].replace(/^(\w+)::/,""),d=a[2]),{id:n,name:h,type:d}},parseNodeProperty:function(a,n,h){var d=n[1].replace(/^"/,"").replace(/"$/,"").trim(),c=n[2].replace(/^"/,"").replace(/"$/,"").trim();d==="Content"&&c===","&&(c=h.replace(/"/g,"").replace(/,$/,"").trim());var x=this.getCurrentNode(),E=x.name;if(E==="Properties70"){this.parseNodeSpecialProperty(a,d,c);return}if(d==="C"){var D=c.split(",").slice(1),R=parseInt(D[0]),B=parseInt(D[1]),M=c.split(",").slice(3);M=M.map(function(_){return _.trim().replace(/^"/,"")}),d="connections",c=[R,B],j(c,M),x[d]===void 0&&(x[d]=[])}d==="Node"&&(x.id=c),d in x&&Array.isArray(x[d])?x[d].push(c):d!=="a"?x[d]=c:x.a=c,this.setCurrentProp(x,d),d==="a"&&c.slice(-1)!==","&&(x.a=k(c))},parseNodePropertyContinued:function(a){var n=this.getCurrentNode();n.a+=a,a.slice(-1)!==","&&(n.a=k(n.a))},parseNodeSpecialProperty:function(a,n,h){var d=h.split('",').map(function(B){return B.trim().replace(/^\"/,"").replace(/\s/,"_")}),c=d[0],x=d[1],E=d[2],D=d[3],R=d[4];switch(x){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":R=parseFloat(R);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":R=k(R);break}this.getPrevNode()[c]={type:x,type2:E,flag:D,value:R},this.setCurrentProp(this.getPrevNode(),c)}};function v(){}v.prototype={constructor:v,parse:function(a){var n=new p(a);n.skip(23);for(var h=n.getUint32(),d=new g;!this.endOfContent(n);){var c=this.parseNode(n,h);c!==null&&d.add(c.name,c)}return d},endOfContent:function(a){return a.size()%16===0?(a.getOffset()+160+16&-16)>=a.size():a.getOffset()+160+16>=a.size()},parseNode:function(a,n){var h={},d=n>=7500?a.getUint64():a.getUint32(),c=n>=7500?a.getUint64():a.getUint32();n>=7500?a.getUint64():a.getUint32();var x=a.getUint8(),E=a.getString(x);if(d===0)return null;for(var D=[],R=0;R<c;R++)D.push(this.parseProperty(a));var B=D.length>0?D[0]:"",M=D.length>1?D[1]:"",_=D.length>2?D[2]:"";for(h.singleProperty=c===1&&a.getOffset()===d;d>a.getOffset();){var F=this.parseNode(a,n);F!==null&&this.parseSubNode(E,h,F)}return h.propertyList=D,typeof B=="number"&&(h.id=B),M!==""&&(h.attrName=M),_!==""&&(h.attrType=_),E!==""&&(h.name=E),h},parseSubNode:function(a,n,h){if(h.singleProperty===!0){var d=h.propertyList[0];Array.isArray(d)?(n[h.name]=h,h.a=d):n[h.name]=d}else if(a==="Connections"&&h.name==="C"){var c=[];h.propertyList.forEach(function(_,F){F!==0&&c.push(_)}),n.connections===void 0&&(n.connections=[]),n.connections.push(c)}else if(h.name==="Properties70"){var x=Object.keys(h);x.forEach(function(_){n[_]=h[_]})}else if(a==="Properties70"&&h.name==="P"){var E=h.propertyList[0],D=h.propertyList[1],R=h.propertyList[2],B=h.propertyList[3],M;E.indexOf("Lcl ")===0&&(E=E.replace("Lcl ","Lcl_")),D.indexOf("Lcl ")===0&&(D=D.replace("Lcl ","Lcl_")),D==="Color"||D==="ColorRGB"||D==="Vector"||D==="Vector3D"||D.indexOf("Lcl_")===0?M=[h.propertyList[4],h.propertyList[5],h.propertyList[6]]:M=h.propertyList[4],n[E]={type:D,type2:R,flag:B,value:M}}else n[h.name]===void 0?typeof h.id=="number"?(n[h.name]={},n[h.name][h.id]=h):n[h.name]=h:h.name==="PoseNode"?(Array.isArray(n[h.name])||(n[h.name]=[n[h.name]]),n[h.name].push(h)):n[h.name][h.id]===void 0&&(n[h.name][h.id]=h)},parseProperty:function(a){var n=a.getString(1);switch(n){case"C":return a.getBoolean();case"D":return a.getFloat64();case"F":return a.getFloat32();case"I":return a.getInt32();case"L":return a.getInt64();case"R":var h=a.getUint32();return a.getArrayBuffer(h);case"S":var h=a.getUint32();return a.getString(h);case"Y":return a.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var d=a.getUint32(),c=a.getUint32(),x=a.getUint32();if(c===0)switch(n){case"b":case"c":return a.getBooleanArray(d);case"d":return a.getFloat64Array(d);case"f":return a.getFloat32Array(d);case"i":return a.getInt32Array(d);case"l":return a.getInt64Array(d)}typeof Mt>"u"&&console.error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var E=new Mt.Inflate(new Uint8Array(a.getArrayBuffer(x))),D=new p(E.decompress().buffer);switch(n){case"b":case"c":return D.getBooleanArray(d);case"d":return D.getFloat64Array(d);case"f":return D.getFloat32Array(d);case"i":return D.getInt32Array(d);case"l":return D.getInt64Array(d)}default:throw new Error("THREE.FBXLoader: Unknown property type "+n)}}};function p(a,n){this.dv=new DataView(a),this.offset=0,this.littleEndian=n!==void 0?n:!0}p.prototype={constructor:p,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(a){this.offset+=a},getBoolean:function(){return(this.getUint8()&1)===1},getBooleanArray:function(a){for(var n=[],h=0;h<a;h++)n.push(this.getBoolean());return n},getUint8:function(){var a=this.dv.getUint8(this.offset);return this.offset+=1,a},getInt16:function(){var a=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,a},getInt32:function(){var a=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,a},getInt32Array:function(a){for(var n=[],h=0;h<a;h++)n.push(this.getInt32());return n},getUint32:function(){var a=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,a},getInt64:function(){var a,n;return this.littleEndian?(a=this.getUint32(),n=this.getUint32()):(n=this.getUint32(),a=this.getUint32()),n&2147483648?(n=~n&4294967295,a=~a&4294967295,a===4294967295&&(n=n+1&4294967295),a=a+1&4294967295,-(n*4294967296+a)):n*4294967296+a},getInt64Array:function(a){for(var n=[],h=0;h<a;h++)n.push(this.getInt64());return n},getUint64:function(){var a,n;return this.littleEndian?(a=this.getUint32(),n=this.getUint32()):(n=this.getUint32(),a=this.getUint32()),n*4294967296+a},getFloat32:function(){var a=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,a},getFloat32Array:function(a){for(var n=[],h=0;h<a;h++)n.push(this.getFloat32());return n},getFloat64:function(){var a=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,a},getFloat64Array:function(a){for(var n=[],h=0;h<a;h++)n.push(this.getFloat64());return n},getArrayBuffer:function(a){var n=this.dv.buffer.slice(this.offset,this.offset+a);return this.offset+=a,n},getString:function(a){for(var n=[],h=0;h<a;h++)n[h]=this.getUint8();var d=n.indexOf(0);return d>=0&&(n=n.slice(0,d)),Rt.decodeText(new Uint8Array(n))}};function g(){}g.prototype={constructor:g,add:function(a,n){this[a]=n}};function m(a){var n="Kaydara FBX Binary  \0";return a.byteLength>=n.length&&n===U(a,0,n.length)}function C(a){var n=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],h=0;function d(E){var D=a[E-1];return a=a.slice(h+E),h++,D}for(var c=0;c<n.length;++c){var x=d(1);if(x===n[c])return!1}return!0}function y(a){var n=/FBXVersion: (\d+)/,h=a.match(n);if(h){var d=parseInt(h[1]);return d}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function f(a){return a/46186158e3}var w=[];function b(a,n,h,d){var c;switch(d.mappingType){case"ByPolygonVertex":c=a;break;case"ByPolygon":c=n;break;case"ByVertice":c=h;break;case"AllSame":c=d.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+d.mappingType)}d.referenceType==="IndexToDirect"&&(c=d.indices[c]);var x=c*d.dataSize,E=x+d.dataSize;return N(w,d.buffer,x,E)}var P=new Oe,S=new ct;function L(a){var n=new K,h=new K,d=new K,c=new K,x=new K,E=new K,D=new K,R=new K,B=new K,M=new K,_=new K,F=a.inheritType?a.inheritType:0;if(a.translation&&n.setPosition(S.fromArray(a.translation)),a.preRotation){var z=a.preRotation.map(he.degToRad);z.push(a.eulerOrder),h.makeRotationFromEuler(P.fromArray(z))}if(a.rotation){var z=a.rotation.map(he.degToRad);z.push(a.eulerOrder),d.makeRotationFromEuler(P.fromArray(z))}if(a.postRotation){var z=a.postRotation.map(he.degToRad);z.push(a.eulerOrder),c.makeRotationFromEuler(P.fromArray(z))}a.scale&&x.scale(S.fromArray(a.scale)),a.scalingOffset&&D.setPosition(S.fromArray(a.scalingOffset)),a.scalingPivot&&E.setPosition(S.fromArray(a.scalingPivot)),a.rotationOffset&&R.setPosition(S.fromArray(a.rotationOffset)),a.rotationPivot&&B.setPosition(S.fromArray(a.rotationPivot)),a.parentMatrixWorld&&(M=a.parentMatrixWorld);var ee=h.multiply(d).multiply(c),$=new K;M.extractRotation($);var J=new K;J.copyPosition(M);var se=new K;se.getInverse($).multiply(M);var me=new K;if(F===0)me.copy($).multiply(ee).multiply(se).multiply(x);else if(F===1)me.copy($).multiply(se).multiply(ee).multiply(x);else{var De=new K().getInverse(x),Te=new K().multiply(se).multiply(De);me.copy($).multiply(ee).multiply(Te).multiply(x)}var xt=new K().getInverse(B),fe=new K().getInverse(E),le=new K;le.copy(n).multiply(R).multiply(B).multiply(h).multiply(d).multiply(c).multiply(xt).multiply(D).multiply(E).multiply(x).multiply(fe);var ve=new K().copyPosition(le),it=new K().copy(M).multiply(ve);return _.copyPosition(it),le=new K().multiply(_).multiply(me),le}function T(a){a=a||0;var n=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return a===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),n[0]):n[a]}function k(a){var n=a.split(",").map(function(h){return parseFloat(h)});return n}function U(a,n,h){return n===void 0&&(n=0),h===void 0&&(h=a.byteLength),Rt.decodeText(new Uint8Array(a,n,h))}function j(a,n){for(var h=0,d=a.length,c=n.length;h<c;h++,d++)a[d]=n[h]}function N(a,n,h,d){for(var c=h,x=0;c<d;c++,x++)a[x]=n[c];return a}function G(a,n,h){return a.slice(0,n).concat(h).concat(a.slice(n))}return i}();var ce=class{constructor(e={}){this.pxlTimer=null,this.pxlUtils=null,this.pxlQuality=null,this.pxlVideo=null,this.pxlCamera=null,this.pxlAutoCam=null,this.pxlUser=null,this.pxlEnv=null,this.pxlAnim=null,this.pxlDevice=null,this.pxlShaders=null,this.runDebugger=!1,this.assetRoot=this.findInDict(e,"assetRoot","images/assets/"),this.guiRoot=this.findInDict(e,"guiRoot","images/GUI/"),this.roomRoot=this.findInDict(e,"roomRoot","images/rooms/"),this.vidRoot=this.findInDict(e,"vidRoot","images/screenContent/"),this.workerList=[]}setDependencies(e){this.pxlTimer=e.pxlTimer,this.pxlUtils=e.pxlUtils,this.pxlQuality=e.pxlQuality,this.pxlVideo=e.pxlVideo,this.pxlCamera=e.pxlCamera,this.pxlAutoCam=e.pxlAutoCam,this.pxlUser=e.pxlUser,this.pxlEnv=e.pxlEnv,this.pxlAnim=e.pxlAnim,this.pxlDevice=e.pxlDevice,this.pxlShaders=e.pxlShaders}log(...e){this.runDebugger&&(console.log("---"),e.forEach(t=>{console.log(t)}))}findInDict(e,t,i){return e.hasOwnProperty(t)?e[t]:(e[t]=i,i)}checkForUserData(e,t,i){if(i.hasOwnProperty("userData")){if(i.hasOwnProperty("material")&&(i.userData.hasOwnProperty("doubleSided")&&i.userData.doubleSided?i.material.side=H.DoubleSide:i.material.side=H.FrontSide),i.userData.hasOwnProperty("GlowPass")&&i.userData.GlowPass&&(e.geoList.GlowPass||(e.geoList.GlowPass=[]),e.geoList.GlowPass.push(i)),i.userData.hasOwnProperty("GlowPassMask")&&i.userData.GlowPass&&(e.geoList.GlowPassMask||(e.geoList.GlowPassMask=[]),e.geoList.GlowPassMask.push(i)),i.userData.hasOwnProperty("castShadow")&&i.userData.castShadow&&(i.castShadow=!0),i.userData.hasOwnProperty("receiveShadow")&&i.userData.receiveShadow&&(i.receiveShadow=!0),i.userData.hasOwnProperty("Shader")&&i.userData.Shader!=""){let s=i.userData.Shader.trim();e.shaderGeoList||(e.shaderGeoList={}),e.shaderGeoList[i.name]=i}i.userData.hasOwnProperty("Emitter")&&i.userData.Emitter!=""&&(e.emitterList||(e.emitterList={}),e.emitterList[i.userData.Emitter]||(e.emitterList[i.userData.Emitter]={},e.emitterList[i.userData.Emitter].Emitter=[],e.emitterList[i.userData.Emitter].Particles=[]),e.emitterList[i.userData.Emitter].Emitter.push(i)),i.userData.hasOwnProperty("Hover")&&i.userData.Hover&&(e.hoverableExists=!0,e.hoverableList.push(i)),i.userData.hasOwnProperty("Click")&&i.userData.Click&&(e.clickableExists=!0,e.clickableList.push(i)),this.checkObjectInstancing(e,t,i),i.userData.hasOwnProperty("Scripted")&&(e.geoList.hasOwnProperty("Scripted")||(e.geoList.Scripted={}),e.geoList.Scripted[i.name]=i,i.children.forEach(r=>{if(r.name.includes("Geo")){let l=i.position,u=i.rotation,v=i.scale;r.position.set(l.x,l.y,l.z),r.rotation.set(u.x,u.y,u.z),r.scale.set(v.x,v.y,v.z),r.updateMatrix(),r.children.forEach(g=>{this.checkForUserData(e,t,g),g.type=="Group"&&(g.position.set(l.x+g.position.x,l.y+g.position.y,l.z+g.position.z),g.rotation.set(u.x,u.y,u.z),g.scale.set(v.x,v.y,v.z)),g.updateMatrix()})}else if(r.name.includes("Colliders")){let l=i.position,u=i.rotation,v=i.scale;r.position.set(l.x,l.y,l.z),r.rotation.set(u.x,u.y,u.z),r.scale.set(v.x,v.y,v.z),r.updateMatrix(),r.visible=!1}}))}}canAppendChildren(e,t){if(t.type!="Group")return!1;let i=!0;return e.geoList.hasOwnProperty("Scripted")&&e.geoList.Scripted.hasOwnProperty(t.name)&&(console.log(e.geoList.Scripted,e.geoList.Scripted.hasOwnProperty(t.name),t.name),i=!1),i}canAddToScene(e,t){let i=!0;return t.hasOwnProperty("userData")&&t.userData.hasOwnProperty("Instance")&&e.hasOwnProperty("baseInstancesNames")&&e.baseInstancesNames.hasOwnProperty(t.userData.Instance)&&(i=!1),i}checkIsGlassLiquid(e,t,i,s){let r=!1;if(i.userData.hasOwnProperty("isGlass")&&i.userData.isGlass&&(r=!0),i.userData.hasOwnProperty("isLiquid")&&i.userData.isLiquid&&(r=!0),!r)return!1;if(this.log("Glass Detected - ",i.name),!e.glassGroup){let y=new H.Group;e.glassGroup=y,t.add(y)}let l=i.material.clone();i.material=l,i.material.transparent=!0,i.material.opacity=.5,i.material.shininess=20,i.material.specular=i.material.color.clone(),i.material.specular.r=i.material.specular.r*.5+.1,i.material.specular.g=i.material.specular.g*.5+.1,i.material.specular.b=i.material.specular.b*.5+.1,i.material.side=H.BackSide,i.material.depthWrite=!1,i.matrixAutoUpdate=!1,i.renderOrder=1,e.glassList.push(i),e.glassGroup.add(i);let u=i.geometry.clone(),v=i.material.clone();v.copy(i.material);let p=new H.Mesh(u,v);p.name=i.name+"_Front",p.material.shininess=40,p.material.side=H.FrontSide,p.matrixAutoUpdate=!1,p.renderOrder=2;let g=i.position,m=i.rotation,C=i.scale;return p.rotation.set(m.x,m.y,m.z),p.position.set(g.x,g.y,g.z),p.scale.set(C.x,C.y,C.z),p.updateMatrix(),i.parent.add(p),e.glassList.push(p),e.glassGroup.add(p),r}checkObjectInstancing(e,t,i){if(!e.hasOwnProperty("baseInstancesNames")||!e.hasOwnProperty("baseInstancesList"))return!1;if(i.hasOwnProperty("userData")&&i.userData.hasOwnProperty("Instance")&&e.baseInstancesList.hasOwnProperty(i.userData.Instance)){let s=i.name;this.log("Generate Instance - ",s),e.geoList.hasOwnProperty("InstanceObjects")||(e.geoList.InstanceObjects={});let r=i.position,l=i.rotation,u=i.scale,v=e.baseInstancesList[i.userData.Instance];if(i.type=="Mesh"){let p=new H.InstancedMesh(v.geometry,v.material,i.geometry.attributes.position.count);p.instanceMatrix.setUsage(H.DynamicDrawUsage),p.name=s+"Geo";let g=new H.Matrix4,m=new H.Vector3,C=new H.Vector3,y=new H.Quaternion,f=new H.Vector3(1,1,1),w=i.geometry.attributes.hasOwnProperty("color"),b={};for(let P=0;P<i.geometry.attributes.position.count;P++){m.fromBufferAttribute(i.geometry.attributes.position,P);let S=m.toArray();if(S=S.join(","),!b.hasOwnProperty(S)){C.fromBufferAttribute(i.geometry.attributes.normal,P);let L=new H.Euler(0,Math.random()*2*Math.PI,0);y.setFromEuler(L);let T=f;if(w){let k=i.geometry.attributes.color.getX(P);T=new H.Vector3(k,k,k)}g.compose(m,y,T),p.setMatrixAt(P,g),b[S]=!0}}p.visible=!0,p.updateMatrix(),e.geoList.InstanceObjects[s]=p,i.parent.add(p),i.visible=!1,i.parent.remove(i)}else{let p=new H.InstancedMesh(v.geometry,v.material,1);p.instanceMatrix.setUsage(H.DynamicDrawUsage),p.name=s+"Geo";let g=!1;if(i.userData.hasOwnProperty("fixInstMatrix")&&(g=!!i.userData.fixInstMatrix),g)p.rotation.set(l.x,l.y,l.z),p.position.set(r.x,r.y,r.z),p.scale.set(u.x,u.y,u.z);else{let m=new H.Matrix4;m.compose(r,new H.Quaternion().setFromEuler(l),u),p.setMatrixAt(0,m)}p.visible=!0,p.updateMatrix(),e.geoList.InstanceObjects[s]=p,i.parent.add(p),i.visible=!1,i.parent.remove(i)}}}loadSceneFBX(e,t,i,s,r,l){r!=""&&(this.pxlEnv.geoLoadListComplete=0,this.pxlEnv.geoLoadList[r]=0);let u=0,v=0;var p=new Ge;return p.load(e,g=>{let m=g.children,C={},y=[];m.forEach((f,w)=>{y.push(f.name),C[f.name]=w}),y.forEach(f=>{if(f.includes("Camera")&&(m[C[f]].children.forEach((b,P)=>{if(b.matrixAutoUpdate=!1,b.name.includes("Position")){let S=b.position.clone();this.pxlCamera.cameraPrevPos=S.clone(),this.pxlCamera.camera.position.copy(S),this.pxlCamera.cameraPos.copy(S),this.pxlCamera.camera.updateMatrixWorld(),this.pxlCamera.cameraBooted=!0,this.pxlEnv.camInitPos=S,this.pxlEnv.camThumbPos=this.pxlEnv.camThumbPos.clone().add(S.clone())}else if(b.name.includes("LookAt")){let S=b.position.clone();this.pxlCamera.cameraAimTarget.position.copy(S),this.pxlCamera.camera.lookAt(S),this.pxlCamera.camera.updateMatrixWorld(),this.pxlCamera.cameraPrevLookAt=new q,this.pxlEnv.camInitLookAt=S,this.pxlEnv.camThumbLookAt=this.pxlEnv.camThumbLookAt.clone().add(S.clone())}else if(b.name.includes("ReturnPosition")){let S=b.position.clone();this.pxlEnv.camReturnPos=S}else if(b.name.includes("ReturnLookAt")){let S=b.position.clone();this.pxlEnv.camReturnLookAt=S}}),this.pxlDevice.touchMouseData.initialQuat=this.pxlCamera.camera.quaternion.clone()),f.includes("Items")){let w=m[C[f]].children,b=null,P=null,S=null,L=null,T=null;for(;w.length>0;){let k=w.pop();k.type=="Group"&&(k.children.forEach(j=>{j.name.includes("Item")?(k.name.includes("LowGravity")?(P==null&&(P=new H.ShaderMaterial({uniforms:{color:{value:j.material.emissive.clone()},alphaMap:{type:"t",value:j.material.map},cloudNoise:{type:"t",value:this.pxlEnv.cloud3dTexture},time:{value:this.pxlTimer.msRunner},intensity:{type:"f",value:1.5},rate:{type:"f",value:this.pxlUser.itemRotateRate}},vertexShader:this.pxlShaders.objects.itemVert(),fragmentShader:this.pxlShaders.objects.itemFrag(),transparent:!0,side:H.DoubleSide,depthTest:!0,depthWrite:!1})),j.material=P):k.name.includes("LizardKing")?(S==null&&(S=j.material.clone(),S.emissiveMap=S.map,S.emissive=new H.Color(8421504)),j.material=S):k.name.includes("StarField")||k.name.includes("InfinityZoom")&&(L==null&&(L=new H.ShaderMaterial({uniforms:{color:{value:j.material.map},cloudNoise:{type:"t",value:this.pxlEnv.cloud3dTexture},time:{value:this.pxlTimer.msRunner},intensity:{type:"f",value:1},rate:{type:"f",value:this.pxlUser.itemRotateRate}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.objects.itemZoomFrag(),transparent:!0,side:H.DoubleSide,depthTest:!0,depthWrite:!0})),j.material=L),this.pxlUser.itemList[k.name]=j):j.name.includes("ItemBase")&&(b==null&&(b=new H.ShaderMaterial({uniforms:{color:{value:j.material.emissive.clone()},alphaMap:{type:"t",value:j.material.map},cloudNoise:{type:"t",value:this.pxlEnv.cloud3dTexture},time:{value:this.pxlTimer.msRunner},intensity:{type:"f",value:1.5},rate:{type:"f",value:this.pxlUser.itemBaseRotateRate}},vertexShader:this.pxlShaders.objects.itemBaseVert(),fragmentShader:this.pxlShaders.objects.itemBaseFrag(),transparent:!0,side:H.DoubleSide,depthTest:!0,depthWrite:!1})),j.material=b,this.pxlUser.itemBaseList.push(j))}),l[0].add(k),this.pxlUser.itemGroupList[k.name]=k,this.pxlUser.itemListNames.push(k.name))}}}),r!=""&&(this.pxlEnv.geoList[r]=g,this.pxlEnv.geoLoadList[r]=1),this.pxlEnv.geoLoadList[r]=1},void 0,g=>{r!=""&&(this.pxlEnv.geoLoadList[r]=1)}),p}loadRoomFBX(e,t,i,s){i==""&&(i=e.roomName),this.pxlEnv.geoLoadListComplete=0,this.pxlEnv.geoLoadList[i]=0;let r=0,l=e.scene;var u=new Ge;return u.load(t,v=>{let p=v.children,g={},m=[];p.forEach((y,f)=>{let w=y.name.split("_")[0];m.push(w),g[w]=f});let C=0;if(m.indexOf("Camera")>-1){let y=[];this.log("Camera - ",p[g.Camera]);let f=!1;p[g.Camera].children.forEach((P,S)=>{P.name.includes("Position")||P.name.includes("LookAt")||P.name.includes("ReturnPosition")||P.name.includes("ReturnLookAt")?(y.push(P),f=!0):P.children.length>0&&y.push(...P.children)}),y.forEach((P,S)=>{P.matrixAutoUpdate=!1;let L=P.parent.name;if(L==p[g.Camera].name&&(L="Default"),e.camLocation.hasOwnProperty(L)||(e.camLocation[L]={},e.camLocation[L].Position=new q(0,0,-10),e.camLocation[L].LookAt=new q(0,0,0)),P.name.includes("PositionMobile")){let T=P.position.clone();e.cameraBooted=!0,e.camInitPos=T,e.camLocation[L].PositionMobile=T}else if(P.name.includes("LookAtMobile")){let T=P.position.clone();e.camInitLookAt=T,e.camLocation[L].LookAtMobile=T}else if(P.name.includes("Position")){let T=P.position.clone();e.cameraBooted=!0,e.camInitPos=T,e.camLocation[L].Position=T}else if(P.name.includes("LookAt")){let T=P.position.clone();e.camInitLookAt=T,e.camLocation[L].LookAt=T}else if(P.name.includes("ReturnPosition")){let T=P.position.clone();e.camReturnPos=T,e.camLocation[L].ReturnPosition=T}else if(P.name.includes("ReturnLookAt")){let T=P.position.clone();e.camReturnLookAt=T,e.camLocation[L].ReturnLookAt=T}}),Object.keys(e.camLocation).forEach(P=>{let S=e.camLocation[P];S.hasOwnProperty("PositionMobile")||(S.PositionMobile=S.Position),S.hasOwnProperty("LookAtMobile")||(S.LookAtMobile=S.LookAt)})}if(m.indexOf("AutoCamPaths")>-1){let y=p[g.AutoCamPaths].children;for(this.log("AutoCamPaths - ",p[g.AutoCamPaths]),this.pxlAutoCam.autoCamPaths[e.roomName]=[];y.length>0;){let f=y.pop();if(f.type=="Group"){let w={};f.children.forEach(P=>{P.matrixAutoUpdate=!1,w[P.name]=P}),f.visible=!1,f.matrixAutoUpdate=!1,l.add(f),this.pxlAutoCam.autoCamPaths[e.roomName].push(w)}}}if(m.indexOf("Instances")>-1&&this.pxlQuality.detailLimit==0){let y=[...p[g.Instances].children];if(this.log("Instances - ",p[g.Instances]),y.length>0){e.hasOwnProperty("baseInstancesNames")||(e.baseInstancesNames=[]),e.hasOwnProperty("baseInstancesList")||(e.baseInstancesList={});let f=[];y.forEach((w,b)=>{if(this.checkForUserData(e,l,w),s.hasOwnProperty(w.name)){let P=null;w.material.map&&(P=w.material.map),w.material=s[w.name],P&&(w.material.uniforms.hasOwnProperty("diffuse")&&(w.material.uniforms.diffuse.value=P),w.material.hasOwnProperty("emissiveMap")&&(w.material.emissiveMap=P,w.material.emissive.r>0&&(w.material.emissiveIntensity=w.material.emissive.r))),w.matrixAutoUpdate=!1}e.baseInstancesNames.push(w),e.baseInstancesList[w.name]=w})}}if(m.indexOf("Lights")>-1){let y=p[g.Lights].children;for(this.log("Lights - ",p[g.Lights]);y.length>0;){let f=y.pop();y.push(...f.children),f.type.includes("Light")&&(e.hasOwnProperty("lightList")||(e.lightList={}),e.geoList.hasOwnProperty("lights")||(e.geoList.lights=[]),f.type=="PointLight"&&(f.decay=3,f.distance=20*f.intensity,f.intensity=2),e.lightList.hasOwnProperty(f.type)||(e.lightList[f.type]=[]),e.lightList[f.type].push(f),e.geoList.lights.push(f),f.matrixAutoUpdate=!1,l.add(f))}}if(m.includes("Scene")||m.includes("MainScene")){let y=g.Scene||g.MainScene,f=p[y].children;this.log("MainScene - ",p[y]);let w=-1;for(;w<f.length&&(w++,!(w>=f.length));){let b=f[w];if(this.checkForUserData(e,l,b),b.isMesh){b.userData.hasOwnProperty("Show")&&(!b.userData.Show||b.userData.Show==0)&&(b.visible=!1),e.geoList[b.name]=b;let P=H.FrontSide;if(b.userData.doubleSided&&(P=H.DoubleSide),s.hasOwnProperty(b.name)){let S=null;b.material.map&&(S=b.material.map),b.material=s[b.name],S&&(b.material.uniforms.hasOwnProperty("diffuse")&&(b.material.uniforms.diffuse.value=S),b.material.hasOwnProperty("emissiveMap")&&(b.material.emissiveMap=S,b.material.emissive.r>0&&(b.material.emissiveIntensity=b.material.emissive.r))),b.matrixAutoUpdate=!1}else{let S=b.material;Array.isArray(b.material)||(S=[b.material]),this.checkIsGlassLiquid(e,l,b,S)||S.forEach(L=>{L.map&&!L.emissiveMap&&L.emissive.r>0&&(L.emissiveMap=L.map,L.emissiveIntensity=L.emissive.r,L.emissive=new H.Color(16777215)),L.side=P})}}else if(b.type.includes("Light"))e.lightList.hasOwnProperty(b.type)||(e.lightList[b.type]=[]),e.lightList[b.type].push(b);else if(b.type=="Group"){let P=!0;if(e.geoList.hasOwnProperty("Scripted")){let S=Object.keys(e.geoList.Scripted)}P&&f.push(...b.children)}}l.add(p[y])}if(m.indexOf("Glass")>-1){let y=p[g.Glass].children;if(this.log("Glass - ",p[g.Glass]),y.length>0){if(!e.glassGroup){let f=new H.Group;e.glassGroup=f,l.add(f)}for(;y.length>0;){let f=y.pop();if(y.push(...f.children),f.isMesh){this.checkForUserData(e,l,f);let w=f.material.clone();f.material=w,f.material.transparent=!0,f.material.opacity=.5,f.material.shininess=20,f.material.specular=f.material.color.clone(),f.material.specular.r=f.material.specular.r*.5+.1,f.material.specular.g=f.material.specular.g*.5+.1,f.material.specular.b=f.material.specular.b*.5+.1,f.material.side=H.BackSide,f.material.depthWrite=!1,f.matrixAutoUpdate=!1,f.renderOrder=1,e.glassList.push(f),e.glassGroup.add(f);let b=f.geometry.clone(),P=f.material.clone();P.copy(f.material);let S=new H.Mesh(b,P);S.material.shininess=40,S.material.side=H.FrontSide,S.matrixAutoUpdate=!1,S.renderOrder=2;let L=f.position,T=f.rotation,k=f.scale;S.rotation.set(T.x,T.y,T.z),S.position.set(L.x,L.y,L.z),S.scale.set(k.x,k.y,k.z),S.updateMatrix(),l.add(S),e.glassList.push(S),e.glassGroup.add(S)}}}}if(m.indexOf("Colliders")>-1){let y=p[g.Colliders];this.log("Colliders - ",p[g.Colliders]);let f=y.children;e.collidersExist=f.length>0;for(let w=0;w<f.length;++w){let b=f[w].name,P=f[w].children;for(;P.length>0;){let S=P.pop();if(P.push(...S.children),S.isMesh){S.visible=!1;let L="noAxis";S.userData.checkX&&S.userData.checkZ&&(L=~~(S.userData.checkX>0)+(~~(S.userData.checkZ>0)+"")),b=="ColliderWalls"?(e.antiColliderActive=!0,e.antiColliderList[L].push(S)):b=="ColliderTops"?(e.antiColliderTopActive=!0,e.antiColliderTopList[L].push(S)):(b=="RoomWarpZone"&&e.roomWarp.push(S),e.colliderActive=!0,e.colliderList[L].push(S)),S.matrixAutoUpdate=!1,l.add(S),e.geoList[S.name]=S}}}}if(m.indexOf("PortalExit")>-1){let y=p[g.PortalExit].children;for(this.log("PortalExit - ",p[g.PortalExit]);y.length>0;){let f=y.pop();f.matrixAutoUpdate=!1,e.portalList[f.name]=f}}if(m.indexOf("FlatColor")>-1){let y=p[g.FlatColor].children;for(this.log("FlatColor - ",p[g.FlatColor]);y.length>0;){let f=y.pop();if(y.push(...f.children),f.isMesh){this.checkForUserData(e,l,f);let w=new H.MeshBasicMaterial({color:f.material.color.clone()});w.side=H.FrontSide,w.flatShading=!0,f.material=w,f.matrixAutoUpdate=!1,l.add(f)}}}if(m.indexOf("LambertColor")>-1){let y=p[g.LambertColor].children;for(this.log("LambertColor - ",p[g.LambertColor]);y.length>0;){let f=y.pop();if(y.push(...f.children),f.isMesh){this.checkForUserData(e,l,f);let w=new H.MeshLambertMaterial;if(f.material.map){let b=f.material.map.clone();w.map=b,w.emissiveMap=b,w.emissiveIntensity=.5,f.material=w}else w.color=f.material.color.clone(),w.emissive=f.material.emissive.clone(),w.side=H.FrontSide,w.flatShading=!0,f.material=w;f.matrixAutoUpdate=!1,l.add(f)}}}if(m.indexOf("Sky")>-1){let y=p[g.Sky].children;for(this.log("Sky - ",p[g.Sky]);y.length>0;){let f=y.pop();if(y.push(...f.children),f.isMesh){let w=new H.ShaderMaterial({uniforms:{diffuse:{type:"t",value:f.material.map},envDiffuse:{type:"t",value:null},noiseTexture:{type:"t",value:this.pxlEnv.cloud3dTexture},fogColor:{value:l.fog.color},time:{value:this.pxlTimer.msRunner},camNear:{type:"f",value:e.camera.near},camFar:{type:"f",value:e.camera.far*.85},resUV:{value:this.pxlDevice.screenRes}},vertexShader:this.pxlShaders.scene.skyObjectVert(),fragmentShader:this.pxlShaders.scene.skyObjectFrag()});f.geometry.computeFaceNormals(),f.geometry.computeVertexNormals(),f.material=w,f.matrixAutoUpdate=!1,f.frustumCulled=!1,f.layers.set(this.pxlEnv.renderLayerEnum.SKY),e.geoList[f.name]=f,e.textureList[f.name]=w,l.add(f)}}}if(m.indexOf("AnimatedTextures")>-1){let y=p[g.AnimatedTextures].children;for(this.log("AnimatedTextures - ",p[g.AnimatedTextures]);y.length>0;){let f=y.pop();if(y.push(...f.children),f.isMesh){this.checkForUserData(e,l,f);let w={time:{value:this.pxlTimer.msRunner},glowTexture:{type:"t",value:f.material.map},cloudNoise:{type:"t",value:this.pxlEnv.cloud3dTexture},glowColor:{value:new q(.01,.35,.55)},intensity:{type:"f",value:.35},rate:{type:"f",value:2},freq:{type:"f",value:1}},b=this.pxlShaders.animated.animTextureVert(),P=this.pxlShaders.animated.animTextureFrag(),S=new H.ShaderMaterial({uniforms:w,vertexShader:b,fragmentShader:P,transparent:!0,side:H.FrontSide});f.geometry.computeFaceNormals(),f.geometry.computeVertexNormals(),f.material=S,f.matrixAutoUpdate=!1,l.add(f)}}}if(m.indexOf("ScrollingTextures")>-1){let y=p[g.ScrollingTextures].children;this.log("ScrollingTextures - ",p[g.ScrollingTextures]);let f=1;for(;y.length>0;){f+=1;let w=y.pop();if(y.push(...w.children),w.isMesh){this.checkForUserData(e,l,w);let b=w.name,P=.05;b.indexOf("_")>-1&&(P=b.split("_")[1],P=parseInt(P)*.01);let S=new H.ShaderMaterial({uniforms:{scrollTexture:{type:"t",value:w.material.map},time:{value:this.pxlTimer.msRunner},speed:{value:P},seed:{type:"f",value:f*1.1423},boostPerc:{value:1}},vertexShader:this.pxlShaders.animated.scrollingTextureVert(),fragmentShader:this.pxlShaders.animated.scrollingTextureFrag(),transparent:!0,side:H.FrontSide});w.geometry.computeFaceNormals(),w.geometry.computeVertexNormals(),w.material=S,w.matrixAutoUpdate=!1,l.add(w)}}}if(m.indexOf("UserScreens")>-1){let y=p[g.UserScreens].children;this.log("UserScreens - ",p[g.UserScreens]);let f=0,w=[new q(1,0,0),new q(0,1,0),new q(0,0,1)],b=[this.assetRoot+"DJ_Vector_Masks_1.jpg",this.assetRoot+"DJ_Vector_Masks_2.jpg",this.assetRoot+"DJ_Vector_Masks_3.jpg"],P=0,S=0,L=w.length;for(;y.length>0;){let T=y.pop();if(y.push(...T.children),T.isMesh){let k=new H.ShaderMaterial({uniforms:{camExists:{type:"f",value:0},time:{value:this.pxlTimer.msRunner},seed:{type:"f",value:f*1.1423},alpha:{type:"f",value:1},boostPerc:{value:e.userScreenIntensity},scale:{value:new W(100,100)},ratio:{value:new W(1,1)},videoFeed:{type:"t",value:null},cloudNoise:{type:"t",value:this.pxlEnv.cloud3dTexture},maskChannel:{value:w[P]},maskMap:{type:"t",value:this.pxlUtils.loadTexture(b[S])}},vertexShader:e.userScreenVert,fragmentShader:e.userScreenFrag,transparent:!0,side:H.FrontSide});T.geometry.computeFaceNormals(),T.geometry.computeVertexNormals(),T.material=k,T.matrixAutoUpdate=!1,e.pxlEnv.camScreenData.screenGeoList.push(T),l.add(T),f+=1,P=f%L,S=Math.floor(f/3)%L}}}if(m.indexOf("Items")>-1){let y=p[g.Items].children;for(this.log("Items - ",p[g.Items]);y.length>0;){let f=y.pop();if(f.type=="Group"){let w=f.children;w.length>0&&(w.forEach(b=>{if(b.name.includes("Item")){let P=new H.ShaderMaterial({uniforms:{color:{value:b.material.emissive.clone()},alphaMap:{type:"t",value:b.material.map},cloudNoise:{type:"t",value:this.cloud3dTexture},time:{value:this.pxlTimer.msRunner},intensity:{type:"f",value:1.5},rate:{type:"f",value:this.pxlUser.itemRotateRate}},vertexShader:this.pxlShaders.objects.itemVert(),fragmentShader:this.pxlShaders.objects.itemFrag(),transparent:!0,side:H.DoubleSide,depthTest:!0,depthWrite:!1});b.material=P,this.pxlUser.itemList[f.name]=b}else if(b.name.includes("Base")){let P=new H.ShaderMaterial({uniforms:{color:{value:b.material.emissive.clone()},alphaMap:{type:"t",value:b.material.map},cloudNoise:{type:"t",value:this.cloud3dTexture},time:{value:this.pxlTimer.msRunner},intensity:{type:"f",value:1.5},rate:{type:"f",value:this.pxlUser.itemBaseRotateRate}},vertexShader:this.pxlShaders.objects.itemBaseVert(),fragmentShader:this.pxlShaders.objects.itemBaseFrag(),transparent:!0,side:H.DoubleSide,depthTest:!0,depthWrite:!1});b.material=P,this.pxlUser.itemBaseList.push(b)}}),l.add(f),this.pxlUser.itemGroupList[f.name]=f,this.pxlUser.itemListNames.push(f.name))}}}if(m.includes("Scripted")){let y=p[g.Scripted].children;for(this.log("Scripted - ",p[g.Scripted]);y.length>0;){let f=y.pop();f.isMesh&&(e.geoList[f.name]=f,l.add(f))}}if(m.includes("Clickable")){let y=p[g.Clickable];this.log("Clickable - ",p[g.Clickable]);let f=y.children;for(let w=0;w<f.length;++w){let b=f[w].name,P=f[w].children;for(;P.length>0;){let S=P.pop();if(P.push(...S.children),S.isMesh){let L=new H.MeshBasicMaterial;L.color=new H.Color(16777215),S.material.emissive=new H.Color(4473924),S.material.emissiveMap=S.material.map,S.matrixAutoUpdate=!1,e.objectClickableObjectList[S.name]||(e.objectClickableObjectList[S.name]={}),e.objectClickableObjectList[S.name][b]=S,e.objectClickable.push(S),l.add(S),b=="Hover"&&(S.visible=!1)}}}}if(m.includes("Markers")){let y=p[g.Markers].children;for(this.log("Markers - ",p[g.Markers]);y.length>0;){let f=y.pop();e.marker[f.name]=f.position}}this.pxlEnv.geoList[i]=v,this.pxlEnv.geoLoadList[i]=1,e.fbxPostLoad()},null,v=>{i!=""&&(this.pxlEnv.geoLoadList[i]=1)}),u}loadAnimFBX(e,t,i,s,r){t==""&&(t=e.roomName),this.pxlEnv.geoLoadListComplete=0,this.pxlEnv.geoLoadList[t]=0;let l=0,u=e.scene;var v=new Ge;return v.load(i,p=>{let g=p.children,m={},C=[];g.forEach((b,P)=>{let S=b.name.split("_")[0];C.push(S),m[S]=P}),p.traverse(b=>{this.checkForUserData(e,u,b),b.userData.hasOwnProperty("doubleSided")&&b.userData.doubleSided&&(b.material.side=H.DoubleSide)}),this.pxlAnim.initObject(t,p),this.log("Animation FBX - ",C[0]),u.add(p),p.frustumCulled=!1;var y=new Ge;let f=[];Object.keys(s).forEach(b=>{let P=s[b],S=new Promise((L,T)=>{y.load(P,k=>{k.animations.length==0&&(this.log("No animations found in file",P),this.log(k),L()),this.pxlAnim.addClips(t,b,k),this.log("Animation Loaded",b),L()},null,k=>{this.log("Animation Load Error"),this.log(k),T(k)})});f.push(S)}),Promise.all(f).then(()=>{this.pxlAnim.setStateConnections(t,r),e.geoList[t]=p,this.pxlEnv.geoLoadList[t]=1,e.animPostLoad(t)}).catch(b=>{this.log("Error loading animations",b)})},null,p=>{t!=""&&(this.pxlEnv.geoLoadList[t]=1)}),v}pxlShaderBuilder(e,t,i,s=null){var r,l={diffuse:{type:"t",value:null},time:{value:this.pxlTimer.msRunner}};e!=null&&(l=Object.assign({},l,e));let u={uniforms:l,vertexShader:t,fragmentShader:i};return s&&(u.defines=s),r=new H.ShaderMaterial(u),r.transparent=!0,r.depthTest=!0,r}removeChildren(e){for(var t=0,i=e.children,s=0;s<i.length;++s)i[s].type=="Group"&&(e.remove(i[s]),t++);return t}findMesh(e){for(var t=null,i=e.children,s=0;s<i.length;++s)if(i[s].type=="Mesh"){t=i[s];break}return t}getBBoxCentroid(e){try{var t=new H.Box3().setFromObject(e),i=t.min,s=t.max,r=new q().addVectors(s,i).multiplyScalar(.5);e.userData={bbox:t,centroid:r},mapBookHelper?.update()}catch(l){console.log("- - - - - - - - ERROR - - - - - - - -"),console.log(`     Object does not exist.
           - Error Info -`),console.log(l),console.log("- - - - - - - - - - - - - - - - - - -")}}loadScript(e){return new Promise((t,i)=>{let s=document.createElement("script");s.type="text/javascript",s.src=e,s.async=!0,s.onreadystatechange=()=>{t(!0)},s.onload=()=>{t(!0)},document.head.appendChild(s)})}xmlHttp(){return window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")}static getURLContent(e){return new Promise((t,i)=>{let s=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");s.open("GET",e),s.onload=r=>{s.readyState==4&&s.status>=200&&s.status<300?t(s.response):t(s.statusText)},s.onerror=()=>i(s.statusText),s.send()})}getExternalHTML(e,t){if(!window.XMLHttpRequest){window.open(e,"_blank");return}let i=this.xmlHttp();i.onreadystatechange=function(){this.readyState==4&&this.status==200&&t&&typeof t=="function"&&t(i.responseText)},i.open("GET",e,!0),i.responceType="document",i.send()}fetchURLStatus(e,t,i){fetch(e,{method:"HEAD"}).then(s=>{t(s.status,i)}).catch(s=>{t(404,i)})}urlExistsFallback(e){return new Promise((t,i)=>{let s=this.xmlHttp();s.open("HEAD",e,!0),s.send(),console.log(s),s.onreadystatechange=function(){this.readyState==this.DONE&&t(this.status<400)},s.onerror=r=>{t(!1)},s.ontimeout=r=>{t(!1)}})}urlExists(e){var t;return Worker&&(t=new Worker("js/pxlBase/webWorkers/FileWorkerIO.js")),new Promise((i,s)=>{if(t)t.onmessage=function(r){i(r.data.data)},t.onerror=function(r){i(!1)},t.postMessage({type:"urlExists",data:e});else{let r=this.urlExistsFallback(e).then(l=>{i(l)})}}).then(i=>(t&&t.terminate(),i)).catch(i=>(t&&t.terminate(),!1))}};var je=class{constructor(e,t=!1,i={}){this.pxlTimer=null,this.pxlCookie=null,this.pxlDevice=null,this.pxlEnv=null,this.msLog=0,this.prevMS=new Date().getTime()*.001,this.autoQuality=!1,this.percent=1,this.verbose=e,this.screenResPerc=1,this.mBlurPercMult=t?.65:1,this.bloomPercMult=t?.65:1,this.bufferPercMult=1,this.renderTargetScale=10,this.percentSteps=[.3,.45,.85],this.fpsCounter=new q(30,0,new Date().getTime()*.001),this.countAtLevel=0,this.shiftRate=.01,this.moduleQualityList=[],this.qualityStep=-1,this.qualityMaxSteps=3,this.qualityStepValues=[.25,.5,.75,1],this.benchmarkStart=-1,this.benchmarkTime=-1,this.benchmarkRating=-1,this.benchmarkTimes=[9,17],this.setFromBenchmark=!0,this.benchmarkQuality=1,this.benchmarkQualityRange=[.25,1],this.settingsQualityChoice=null,this.detailLimitOverride=Object.keys(i).includes("dlimit")?i.dlimit:0,this.detailLimit=this.detailLimitOverride!=null?this.detailLimitOverride:0,this.settings={leftRight:!0,mouse:!0,graphics:2,resolution:1,fog:2,bloom:!0,motion:!1},this.settingsLow={resolution:.5,fog:0,bloom:!1,motion:!1},this.settingsMedium={resolution:.75,fog:1,bloom:!0,motion:!1},this.settingsHigh={resolution:1,fog:2,bloom:!0,motion:!1},this.settingsCustom=null}setDependencies(e){this.pxlTimer=e.pxlTimer,this.pxlCookie=e.pxlCookie,this.pxlDevice=e.pxlDevice,this.pxlEnv=e.pxlEnv}init(){this.detailLimitOverride!=null?this.detailLimit=this.detailLimitOverride:this.pxlCookie.hasCookie("detailLimit")&&(this.detailLimit=this.pxlCookie.parseCookie("detailLimit")),this.verbose>=ae.INFO&&console.log("Graphics Limiting is set to level ",this.detailLimit),this.setFromBenchmark=!this.pxlCookie.parseDict(this.settings),this.pxlCookie.hasCookie("leftRight")&&(this.settings.leftRight=this.pxlCookie.parseCookie("leftRight")),this.pxlCookie.hasCookie("mouse")&&(this.settings.mouse=this.pxlCookie.parseCookie("mouse"));let e=Object.keys(this.settingsHigh);if(this.pxlCookie.hasCookie("qualitySetting")){let t=this.pxlCookie.parseCookie("qualitySetting");this.settings.graphics=t,this.settingsQualityChoice=t}}step(){this.mapFpsQualitCheck()}attachModule(e=null){e&&this.moduleQualityList.push(e)}startBenchmark(){this.pxlTimer.step(),this.benchmarkStart=this.pxlTimer.curMS}endBenchmark(){this.pxlTimer.step();let e=this.pxlTimer.curMS-this.benchmarkStart;this.benchmarkTime=e,this.benchmarkRating=1-Math.min(1,Math.max(0,(e-this.benchmarkTimes[0])/(this.benchmarkTimes[1]-this.benchmarkTimes[0]))),this.benchmarkQuality=this.benchmarkRating*(this.benchmarkQualityRange[1]-this.benchmarkQualityRange[0])+this.benchmarkQualityRange[0];let t=Math.min(1,Math.max(0,this.benchmarkRating));if(t=Math.ceil(Math.max(.05,t)*this.qualityMaxSteps)-1,this.qualityStep=t,this.setFromBenchmark){let i=["Low","Medium","High"][this.qualityStep];this.setQualityLevel(this.qualityStep)}else this.settingsQualityChoice==null&&(this.settingsQualityChoice=3),this.settingsCustom={},Object.keys(this.settingsHigh).forEach(s=>{this.settingsCustom[s]=this.settings[s]});this.setDependentSettings()}mapFpsQualitCheck(){if(this.pxlTimer.curMS-this.fpsCounter.z>1){this.fpsCounter.x=this.fpsCounter.y,this.fpsCounter.y=0,this.fpsCounter.z=this.pxlTimer.curMS;let e=1;this.fpsCounter.x<15&&(e=-1);let t=Math.min(1,Math.max(0,this.percent+this.shiftRate*e));this.autoQuality&&this.mapAutoQualityUpdate(t,!1)}this.fpsCounter.y+=1,this.pxlTimer.prevMS=this.pxlTimer.curMS}mapAutoQualityUpdate(e=null,t=!1){let i=Math.min(1,Math.max(0,e));i=Math.ceil(Math.max(.05,i)*this.qualityMaxSteps)-1,this.qualityStep=i}setGraphicsSettings(e=null,t=3){if(e==null)if(this.qualityStep==0)e=this.settingsLow;else if(this.qualityStep==1)e=this.settingsMedium;else if(this.qualityStep==2)e=this.settingsHigh;else return;t==3&&this.checkCustomDict(),Object.keys(e).forEach(s=>{this.setComponentQuality(s,e[s]),this.settings[s]=e[s],t==3&&(this.settingsCustom[s]=e[s])}),this.setDependentSettings(),this.colliderPrevObjHit=null,t!=null&&(this.settings.graphics=t)}reapplySettings(){Object.keys(this.settingsLow).forEach(t=>{this.setComponentQuality(t,this.settings[t],!1)}),this.setDependentSettings()}setQualityLevel(e){this.pxlDevice.mobile&&(e=1),this.setQualityCookie(e),e==0?this.setLowQuality():e==1?this.setMediumQuality():e==2?this.setHighQuality():e==3&&this.setCustomQuality()}setLowQuality(){this.settingsQualityChoice=0,this.setGraphicsSettings(this.settingsLow,0)}setMediumQuality(){this.settingsQualityChoice=1,this.setGraphicsSettings(this.settingsMedium,1)}setHighQuality(){this.settingsQualityChoice=2,this.setGraphicsSettings(this.settingsHigh,2)}setCustomQuality(){this.checkCustomDict(),this.settingsQualityChoice=3,this.setGraphicsSettings(this.settingsCustom)}checkCustomDict(){if(this.settingsCustom==null){this.settingsCustom={};let e=this.settingsHigh;this.settingsQualityChoice&&(this.settingsQualityChoice==0?e=this.settingsLow:this.settingsQualityChoice==1?e=this.settingsMedium:this.settingsQualityChoice==2&&(e=this.settingsHigh)),Object.assign(this.settingsCustom,e)}}setQualityCookie(e){this.pxlCookie.setCookie("qualitySetting",e)}setComponentQuality(e,t,i=!0){switch(e){case"leftRight":this.settings[e]=t;break;case"mouse":this.settings[e]=t;break;case"resolution":this.screenResPerc=t,this.pxlDevice.resizeRenderResolution(),this.settings[e]=t,this.pxlEnv.geoList.snow&&this.pxlEnv.geoList.snow.material&&(this.pxlEnv.geoList.snow.material.uniforms.pointScale.value=this.pxlEnv.geoList.snow.pBaseScale*t);break;case"fog":this.pxlEnv.mapOverlayHeavyPass.enabled=t==2,this.pxlEnv.mapOverlayPass.enabled=t==1,this.pxlEnv.mapOverlaySlimPass.enabled=t==0,this.pxlEnv.mapBoxAAPass.enabled=t==2,this.pxlEnv.mapCrossAAPass.enabled=t==1,this.pxlEnv.portaluserScreenIntensity.x=1,this.pxlEnv.userScreenIntensity.x=.65,this.pxlEnv.userScreenIntensity.y=0,this.pxlEnv.geoList.HDRView&&(this.pxlEnv.geoList.HDRView.material.uniforms.cdMult.value=t==0?.7:.3),this.settings[e]=t;break;case"bloom":this.pxlEnv.portaluserScreenIntensity.x=t?.4:1,this.pxlEnv.mapGlowPass.enabled=t,this.pxlEnv.roomBloomPass.enabled=t,this.pxlEnv.roomGlowPass.enabled=t,this.pxlEnv.userScreenIntensity.x=t?.65:.8,this.pxlEnv.userScreenIntensity.y=t?0:.8,this.pxlEnv.geoList.HDRView&&(this.pxlEnv.geoList.HDRView.material.uniforms.cdMult.value=t==0?.7:.3),this.pxlEnv.mapMotionBlurPass.enabled=t,this.settings[e]=t;break;case"motion":this.pxlEnv.mapMotionBlurPass.enabled=t,this.settings[e]=t;break;default:break}i&&this.pxlCookie.setCookie(e,t)}setDependentSettings(){let e=1,t=1,i=0,s=.6;this.settings.fog==2?(this.pxlEnv.mapMotionBlurPass.enabled=!1,this.pxlEnv.mapOverlayHeavyPass.enabled=!0,this.pxlEnv.mapOverlayPass.enabled=!1,this.pxlEnv.mapOverlaySlimPass.enabled=!1,this.pxlEnv.mapBoxAAPass.enabled=!0,this.pxlEnv.mapCrossAAPass.enabled=!1,e=1,t=.5):this.settings.fog==1?(this.pxlEnv.mapMotionBlurPass.enabled=!1,this.pxlEnv.mapOverlayHeavyPass.enabled=!1,this.pxlEnv.mapOverlayPass.enabled=!0,this.pxlEnv.mapOverlaySlimPass.enabled=!1,this.pxlEnv.mapBoxAAPass.enabled=!1,this.pxlEnv.mapCrossAAPass.enabled=!0,e=1.15,t=.5):(this.pxlEnv.mapMotionBlurPass.enabled=!1,this.pxlEnv.mapOverlayPass.enabled=!1,this.pxlEnv.mapOverlaySlimPass.enabled=!0,this.pxlEnv.mapBoxAAPass.enabled=!1,this.pxlEnv.mapCrossAAPass.enabled=!1,e=1,t=.4),this.settings.bloom?(this.pxlEnv.mapGlowPass.enabled=!0,this.pxlEnv.roomBloomPass.enabled=!0,this.pxlEnv.roomGlowPass.enabled=!0,this.pxlEnv.userScreenIntensity.x=.65,this.pxlEnv.userScreenIntensity.y=0,i=1,s=.25):(this.pxlEnv.mapGlowPass.enabled=!1,this.pxlEnv.roomBloomPass.enabled=!1,this.pxlEnv.roomGlowPass.enabled=!1,this.pxlEnv.engine.setRenderTarget(this.pxlEnv.mapComposerGlow.renderTarget2),this.pxlEnv.engine.clear(),this.pxlEnv.engine.setRenderTarget(this.pxlEnv.roomGlowPass.renderTarget2),this.pxlEnv.engine.clear(),this.pxlEnv.engine.setRenderTarget(null),this.pxlEnv.userScreenIntensity.x=.8,this.pxlEnv.userScreenIntensity.y=0,t=1,i=0,s=.5);let r=this.pxlEnv.geoList.Circular_Gate;r&&(r.material.uniforms.bloomBoost.value=i),this.pxlEnv.geoList.HDRView&&(this.pxlEnv.geoList.HDRView.material.uniforms.cdMult.value=this.settings.bloom?.3:.7);let l=this.pxlEnv.geoList.CirculateGateVideoSphere;l&&(l.material.color.r=s,l.material.color.g=s,l.material.color.b=s),this.pxlEnv.portaluserScreenIntensity.x=t,this.pxlEnv.pxlCamera.colliderCurObjHit=null}};var We=class{constructor(e="pxlNav-",t="/",i=30){let s=e.substring(-1)=="-"?e:e+"-";this.prepend=s,this.exp=i,this.path="path="+t,this.deleteDate="expires=Thu, 01 Jan 1970 00:00:01 GMT;",this.sub="_%_"}pullData(){let e=document.cookie}getExpiration(){let e=new Date;return e.setTime(e.getTime()+this.exp*24*60*60*1e3),"expires="+e.toGMTString()+";"}valueToString(e){let t=typeof e;return isNaN(Number(e))?t=="string"?"'"+e+"'":t=="boolean"?e?"true":"false":e==null?"null":isNaN(Number(e))?"NaN":e:e}variableToString(e){return Array.isArray(e)?"["+e.map(i=>Array.isArray(i)?this.variableToString(i):this.valueToString(i)).join(",")+"]":this.valueToString(e)}hasCookie(e){return document.cookie.includes(this.prepend+e)}readCookie(e){if(this.hasCookie(e)){let t=new RegExp("(?="+this.prepend+e+").*?((?=;)|(?=$))","g");return document.cookie.match(t)[0].split("=")[1].replace(this.prepend,"").replace(this.sub,";")}return null}parseCookie(e){if(this.hasCookie(e)){let t=new RegExp("(?="+this.prepend+e+").*?((?=;)|(?=$))","g"),i=document.cookie.match(t)[0].split("=")[1].replace(this.prepend,"").replace(this.sub,";");return i=="true"?i=!0:i=="false"?i=!1:parseInt(i)==i?i=parseInt(i):parseFloat(i)==i&&(i=parseFloat(i)),i}return null}isEqual(e){return this.hasCookie(e)?(console.log(e),this.readCookie(e)==this.variableToString(e)):!1}evalCookie(e){if(e){if(this.hasCookie(e)){let t=new RegExp("(?="+this.prepend+e+").*?((?=;)|(?=$))","g");return console.log("Eval Cookie has been limited, responce is: "),console.log(document.cookie.match(t)[0].replace(this.prepend,"").replace(this.sub,";")),!0}return!1}else{let t=new RegExp("(?="+this.prepend+").*?((?=;)|(?=$))","g");return console.log("Eval Cookie has been limited, may error."),document.cookie.match(t).forEach(i=>{i.replace(this.prepend,"").replace(this.sub,";")}),!0}}setCookie(e,t){t=this.variableToString(t),t.replace&&t.replace(";",this.sub),document.cookie=this.prepend+e+"="+t+";"+this.getExpiration()+this.path}addDictionary(e){let t=Object.keys(e);for(let i=0;i<t.length;++i){let s=e[t[i]];s=this.variableToString(s),s.replace&&s.replace(";",this.sub),document.cookie=this.prepend+t[i]+"="+s+";"+this.getExpiration()+this.path}}parseDict(e){let t=Object.keys(e),i=!1;return t.forEach(s=>{this.hasCookie(s)&&(e[s]=this.parseCookie(s),i=!0)}),i}clearCookie(e){if(e)typeof e=="string"&&(e=[e]),e.forEach(t=>{document.cookie=t+"=;"+this.deleteDate+this.path});else{let t=new RegExp("(?="+this.prepend+").*?(?==)","g");document.cookie.match(t).forEach(s=>{document.cookie=s+"=;"+this.deleteDate+this.path})}}};var ze=class{constructor(){this.active=!1,this.msRunner=new W(0,0),this.msLog=0,this.fpsStats=-1;let e=new Date().getTime()*.001;this._bootMS=e,this._curMS=e,this._prevMS=e,this.videoFeeds=[]}init(){this.prevMS=this.curMS,this.msRunner.x=0,this.msRunner.y=0,this.step()}get runtime(){return this._curMS-this._bootMS}get curMS(){return this._curMS}updateTime(){this._curMS=new Date().getTime()*.001}get prevMS(){return this._prevMS}set prevMS(e){this._prevMS=e}start(){this.play()}pause(){return this.active=!this.active,this.active}play(){return this.active=!0,this.active}stop(){return this.active=!1,this.active}toggleMSLog(){this.msLog=(this.msLog+1)%2}step(){this.prevMS=this._curMS,this.updateTime(),this.fpsStats!=-1&&this.fpsStats.update();let e=this.curMS-this.prevMS;this.msRunner.x+=e>0?e:0,this.msRunner.y=(this.msRunner.y+e)*.5}};var Qe=class{constructor(e=null){this.id=null,this.jitsiUserId=null,this.jmaActive=!1,this.jmaConnectObj=!1,this.jmaServer=!1,this.jmaRoom=!1,this.jmaUserId=null,this.jmaUserName=null,this.jmaTempUserIdActive=!1,this.pxlEnv=null,this.welcome=!1,this.tankStrafe=!1,this.invertMouse=!1,this.renderSettingsCookie="settings_renderSettings",this.controlModeCookie="settings_controlMode",this.tankStrageCookie="settings_tankStrage",this.invertMouseCookie="settings_invertMouse",this.rootUserCookie="data_userEnlil",this.adminUserCookie="data_userNanna",this.localUserMoved=!1,this.localUserTurned=!1,this.itemRunTime=60,this.itemGroupList=[],this.itemList={},this.itemListNames=[],this.itemBaseList=[],this.itemActiveList=[],this.itemInactiveCmd=[],this.itemActiveTimer=[],this.itemRotateRate=.65,this.itemBaseRotateRate=.1,this.itemBobRate=.35,this.itemBobMag=0,this.mPick=[],this.activeEffects={},this.lowGrav=0,this.lKing=0,this.lKingInactive=[.025,.018],this.lKingActive=[.35,.25],this.lKingWarp=0,this.lKingPass=null,this.sField=0,this.sFieldWarp=0,this.sFieldPass=null,this.iZoom=0,this.iZoomWarp=0,this.iZoomPass=null}checkItemWearOff(e){return this.itemActiveList.length>0&&this.itemActiveTimer[0]-e<=0?(this.itemInactiveCmd.shift()(),this.itemActiveTimer.shift(),this.itemActiveList.shift(),!0):!1}checkItemPickUp(e){if(e=="LowGravity")return this.lowGrav==0?(this.lowGrav=1,!0):!1;if(e=="LizardKing")return this.lKing==0?(this.lKing=1,this.lKingWarp.set(...this.lKingActive),this.lKingPass.enabled=!0,!0):!1;if(e=="StarField")return this.sField==0?(this.sField=1,this.sFieldPass.enabled=!0,!0):!1;if(e=="InfinityZoom")return this.iZoom==0?(this.iZoom=1,this.iZoomPass.enabled=!0,!0):!1}toggleTankRotate(e=null){this.tankStrafe=e??!this.tankStrafe,this.tankStrageText=this.tankStrafe?"Left/Right Rotation":"Left/Right Strafe"}toggleMouseInf(e=null){this.invertMouse=e??!this.invertMouse,this.invertMouseText=this.invertMouse?"Revert Mouse":"Invert Mouse"}toggleFpsStats(){pxlTimer.fpsStats==-1?(pxlTimer.fpsStats=new Stats,document.body.appendChild(pxlTimer.fpsStats.domElement),pxlTimer.fpsStats.update(),this.fpsDisplayText="Hide FPS Stats"):(pxlTimer.fpsStats.domElement.remove(),pxlTimer.fpsStats=-1,this.fpsDisplayText="Display FPS Stats")}};import*as bi from"./three.module.js";var Ne=class{constructor(e,t,i){this.projectTitle=e,this.pxlCore=t,this.pxlEnv=null,this.pxlTimer=null,this.pxlAudio=null,this.pxlUser=null,this.pxlCamera=null,this.pxlAutoCam=null,this.pxlGuiDraws=null,this.pxlQuality=null,this.allowCursorSwap=!1,this.longTouchLength=.75;let s=window.innerWidth,r=window.innerHeight;this.sW=s,this.sH=r,this.touchScreen=!1,this.x=s*.5,this.y=r*.5,this.screenRes=new W(1/s,1/r),this.screenAspect=new W(1,1),this.screenRatio=new W(s/r,r/s),this.origRes=new W(s,r),this.screenResDeltaPerc=new W(1,1),this.mapW=1,this.mapH=1,this.gammaCorrection=new q(1,1,1),this.lightShift=new W(1,1),this.firefox=/Firefox/i.test(navigator.userAgent),this.mobile=i,this.button=0,this.inputActive=!1,this.startPos=[0,0],this.endPos=[0,0],this.dragCount=0,this.dragTotal=0,this.latched=!1,this.windowHidden=!1,this.mouseX=s/2,this.mouseY=r/2,this.keyDownCount=[0,0,0],this.directionKeyDown=!1,this.directionKeysPressed=[0,0,0,0],this.shiftBoost=1,this.controlKey=!1,this.objectPercList=[],this.objectPercFuncList={},this.objectPerc={active:!1,object:null,left:0,top:0,width:0,height:0,startX:0,startY:0,offsetX:0,offsetY:0,percX:0,percY:0,offsetPercX:0,offsetPercY:0},this.canCursorLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,this.cursorLockActive=!1,this.cursorRightButtonLockActive=!1,this.gyroGravity=[0,0,0],this.touchMouseData={active:!1,lock:!1,mode:0,updated:0,button:0,dragCount:0,dragTotal:0,startPos:null,moveMult:new W(1,1),velocityEase:new W(0,0),velocityEasePrev:null,velocity:new W(0,0),mBlurVelInf:new W(2*this.screenRes.x,2*this.screenRes.y),prevDeltaPos:[0,0,0],endPos:null,latchMatrix:null,netDistance:new W(0,0),netDistYPerc:0,curDistance:new W(0,0),curFadeOut:new W(0,0),curStepDistance:new W(0,0),initialQuat:new bi.Quaternion,releaseTime:0},this.subscriptableEvents=["keydown","keyup","resize"],this.callbackList={},this.init()}setDependencies(e){this.pxlEnv=e.pxlEnv,this.pxlTimer=e.pxlTimer,this.pxlAudio=e.pxlAudio,this.pxlUser=e.pxlUser,this.pxlCamera=e.pxlCamera,this.pxlAutoCam=e.pxlAutoCam,this.pxlGuiDraws=e.pxlGuiDraws,this.pxlQuality=e.pxlQuality}init(){this.setGammaCorrection();let e=this;document.addEventListener("mousedown",i=>{e.onmousedown(e,i)},!1),document.addEventListener("mousemove",i=>{e.onmousemove(e,i)},!1),document.addEventListener("mouseup",i=>{e.onmouseup(e,i)},!1),document.addEventListener("contextmenu",i=>{e.oncontextmenu(i)},!1),window.addEventListener("resize",i=>{e.resizeRenderResolution()},!1),document.addEventListener("touchstart",function(i){e.touchstart(e,i)},{passive:!0}),document.addEventListener("touchmove",function(i){e.touchmove(e,i)},{passive:!0}),document.addEventListener("touchend",function(i){e.touchend(e,i)},{passive:!0}),document.onkeydown=i=>{e.onkeydown(e,i)},document.onkeyup=i=>{e.onkeyup(e,i)};let t=this;document.addEventListener("visibilitychange",function(i){t.windowHidden=document.hidden,t.directionKeysPressed=[0,0,0,0],t.directionKeyDown=!1,t.shiftBoost=1,t.pxlCamera.workerFunc("focus",!document.hidden),t.runHiddenCalcs()}),typeof window.onblur=="object"&&(window.onblur=i=>{t.resetUserInput(i)}),window.addEventListener("beforeunload",i=>{if(t.controlKey==!0)return i.preventDefault(),i.returnValue="Close tab?",t.controlKey=!1,t.mapLockCursor(!1,0),"Close tab?"})}setGammaCorrection(e=null){if(e!=null){this.gammaCorrection.x=1/e,this.gammaCorrection.y=e,this.gammaCorrection.z=e;return}let t=1.5,i=1.1,s=1.2,r=.5;if(window&&window.navigator&&window.navigator.userAgent){let l=window.navigator.userAgent.match(/(windows|win32|win64|wince)/i);if(l&&l.length>0)t=2.2,i=.95,s=1,r=0;else{let u=window.navigator.userAgent.match(/(macintosh|macintel|macppc|mac68k|iphone|ipad|ipod)/i);u&&u.length>0?(t=1.8,i=.9,s=.97,r=.1):(t=1.8,i=.7,s=.96,r=.1)}}this.gammaCorrection.x=1/t,this.gammaCorrection.y=s,this.gammaCorrection.z=r,this.lightShift.x=i}runHiddenCalcs(){this.windowHidden&&setTimeout(()=>{this.runHiddenCalcs()},100)}resetUserInput(e){this.directionKeysPressed=[0,0,0,0],this.directionKeyDown=!1,this.shiftBoost=1,this.mapLockCursor(!1,0),this.pxlCamera.camJumpKey(!1),this.pxlCamera.deviceKey("space",!1),this.touchMouseData.active&&(this.touchScreen?this.endTouch(e):this.mapOnUp(e))}onmousemove(e,t){e.mapOnMove(t)}onmousedown(e,t){e.mapOnDown(t)}onmouseup(e,t){e.mapOnUp(t)}oncontextmenu(e){return e.preventDefault(),!1}touchstart(e,t){e.startTouch(t)}touchmove(e,t){e.doTouch(t)}touchend(e,t){e.endTouch(t)}onkeydown(e,t){e.keyDownCall(t)}onkeyup(e,t){e.keyUpCall(t)}get active(){return this.inputActive}set active(e){this.inputActive=!!e}preventDefault(e){e=e||window.event,e.preventDefault(e)&&e.preventDefault(e)(),e.returnValue=!1}setCursor(e){if(this.allowCursorSwap){if(e=="activeLatch"){let t=["grab","grabbing","all-scroll"][this.touchMouseData.button]}document.body.style.cursor=e}}getMouseXY(e){if(this.mobile)try{touch=e.touches[0],this.mouseX=touch.pageX,this.mouseY=touch.pageY}catch{}else{let t=this.pxlQuality.settings.mouse?-1:1;this.cursorLockActive?(this.mouseX+=(e.movementX||e.mozMovementX||e.webkitMovementX||0)*t,this.mouseY+=(e.movementY||e.mozMovementY||e.webkitMovementY||0)*t):(this.mouseX=e.clientX,this.mouseY=e.clientY)}}mapLockCursor(e=!1,t){this.canCursorLock&&!this.mobile&&(t==2?(!e&&this.cursorRightButtonLockActive?this.cursorRightButtonLockActive=!1:!e&&!this.cursorRightButtonLockActive&&(this.cursorRightButtonLockActive=!0),e=e||this.cursorRightButtonLockActive):e||(this.cursorRightButtonLockActive=e),e==!0?(this.pxlGuiDraws.pxlNavCanvas.focus(),this.pxlGuiDraws.pxlNavCanvas.requestPointerLock().catch(i=>{})):document.pointerLockElement&&document.exitPointerLock(),this.cursorLockActive=e)}mapOnDown(e){let t=e.target;t.getAttribute&&t.getAttribute("id")==this.pxlCore&&this.pxlTimer.active&&(this.pxlGuiDraws.chatMessageInput&&this.pxlGuiDraws.chatMessageInput.blur(),this.pxlGuiDraws.pxlNavCanvas.focus(),this.preventDefault(e),this.touchMouseData.button=e.which,this.touchMouseData.active=!0,this.touchMouseData.mode=this.touchMouseData.button,this.touchMouseData.startPos=new W(this.mouseX,this.mouseY),this.touchMouseData.endPos=new W(this.mouseX,this.mouseY),this.touchMouseData.curDistance=new W(0,0),this.touchMouseData.curStepDistance=new W(0,0),this.touchMouseData.dragCount=0,this.pxlAutoCam.touchBlender=!1,this.setCursor("grabbing"),this.mapLockCursor(!0,e.button))}mapOnMove(e){let t=e.target;if(t.getAttribute&&t.getAttribute("id")==this.pxlCore&&this.pxlTimer.active||this.cursorLockActive)if(this.preventDefault(e),this.getMouseXY(e),(this.touchMouseData.active||this.cursorLockActive)&&this.touchMouseData.startPos){this.touchMouseData.dragCount++;let i=this.touchMouseData.endPos.clone();this.touchMouseData.endPos=new W(this.mouseX,this.mouseY),this.touchMouseData.curDistance=this.touchMouseData.startPos.clone().sub(this.touchMouseData.endPos),this.touchMouseData.curStepDistance=this.touchMouseData.endPos.clone().sub(i),this.touchMouseData.netDistance.add(this.touchMouseData.curStepDistance.clone());let s=this.touchMouseData.velocity.clone();this.touchMouseData.velocity=this.touchMouseData.velocity.clone().multiplyScalar(3).add(this.touchMouseData.curStepDistance).multiplyScalar(.25),this.touchMouseData.netDistYPerc=(this.touchMouseData.netDistance.y+this.touchMouseData.curDistance.y+250)*8e-4,this.touchMouseData.curFadeOut.add(i.sub(this.touchMouseData.endPos))}else this.pxlEnv.hoverUserDetect()}mapOnUp(e){let t=e.target;if(this.pxlAudio.djVolumeParentObj&&(this.pxlAudio.djVolumeParentObj.down=!1),t.getAttribute&&t.getAttribute("id")==this.pxlCore)if(this.pxlGuiDraws.checkFocus(t.getAttribute("id"),!0),this.mobile)this.pxlAutoCam.getNextPath(!1,1);else return this.preventDefault(e),this.touchMouseData.dragCount++,this.touchMouseData.dragTotal+=this.touchMouseData.dragCount,this.touchMouseData.active=!1,this.touchMouseData.releaseTime=this.pxlTimer.curMS,this.pxlAutoCam.touchBlender=!0,this.pxlAutoCam.setNextTrigger(),this.touchMouseData.dragCount<9&&this.pxlEnv.clickUserDetect(),this.touchMouseData.endPos=new W(this.mouseX,this.mouseY),this.touchMouseData.netDistYPerc=(this.touchMouseData.netDistance.y+250)/1250,this.setCursor("grab"),this.mapLockCursor(!1,e.button),e.preventDefault(),!1}startTouch(e){let t=e.target;if(!(t.getAttribute&&t.getAttribute("id")==this.pxlCore&&this.pxlTimer.active))return;this.touchScreen=!0;var s=e.touches[0];this.mouseX=s.pageX,this.mouseY=s.pageY,this.touchMouseData.active=!0,this.touchMouseData.mode=this.touchMouseData.button,this.touchMouseData.startPos=new W(this.mouseX,this.mouseY),this.touchMouseData.endPos=new W(this.mouseX,this.mouseY),this.touchMouseData.curDistance=new W(0,0),this.touchMouseData.curStepDistance=new W(0,0),this.touchMouseData.dragCount=0,this.pxlAutoCam.touchBlender=!1,this.touchMouseData.releaseTime=this.pxlTimer.curMS;let r=t.getAttribute("id");if(this.objectPercList.includes(r)){r=="djPlayerVolume"&&(t=this.pxlAudio.djVolumeParentObj,r=t.getAttribute("id"));let l=t.getBoundingClientRect();this.objectPerc.active=!0,this.objectPerc.object=t,this.objectPerc.left=l.left,this.objectPerc.top=l.top,this.objectPerc.width=l.width,this.objectPerc.height=l.height,this.objectPerc.startX=this.mouseX-l.left,this.objectPerc.startY=this.mouseY-l.top,this.objectPerc.percX=(this.mouseX-this.objectPerc.left)/this.objectPerc.width,this.objectPerc.percY=(this.mouseY-this.objectPerc.top)/this.objectPerc.height,this.objectPerc.offsetX=0,this.objectPerc.offsetY=0,this.objectPerc.offsetPercX=0,this.objectPerc.offsetPercY=0,this.objectPercFuncList[r]&&this.objectPercFuncList[r](e)}}doTouch(e){if(!this.touchMouseData.active)return;let t=e.target;var i=e.touches[0];if(this.mouseX=i.pageX,this.mouseY=i.pageY,this.touchMouseData.active){if(this.touchMouseData.dragCount++,typeof e.touches[1]<"u"){var s=e.touches[1];e.touches.length>1&&this.touchMouseData.dragCount>10&&(this.touchMouseData.lock=!0,i=e.touches[1],this.pxlEnv.setFogHue([this.mouseX,this.mouseY],[i.pageX,i.pageY]));return}let r=this.touchMouseData.endPos.clone();this.touchMouseData.endPos=new W(this.mouseX,this.mouseY),this.touchMouseData.curDistance=this.touchMouseData.startPos.clone().sub(this.touchMouseData.endPos),this.touchMouseData.curStepDistance=this.touchMouseData.endPos.clone().sub(r),this.touchMouseData.netDistance.add(this.touchMouseData.curStepDistance.clone()),this.touchMouseData.velocity.add(this.touchMouseData.curStepDistance).multiplyScalar(.5),this.touchMouseData.velocityEase.add(this.touchMouseData.curStepDistance).multiplyScalar(.5),this.touchMouseData.netDistYPerc=(this.touchMouseData.netDistance.y+this.touchMouseData.curDistance.y+250)/1250,this.touchMouseData.curFadeOut.add(r.sub(this.touchMouseData.endPos))}this.objectPerc.active&&(this.objectPerc.percX=(this.mouseX-this.objectPerc.left)/this.objectPerc.width,this.objectPerc.percY=(this.mouseY-this.objectPerc.top)/this.objectPerc.height,this.objectPerc.offsetX=this.mouseX-this.objectPerc.startX,this.objectPerc.offsetY=this.mouseY-this.objectPerc.startY,this.objectPerc.offsetPercX=this.objectPerc.offsetX/this.objectPerc.width,this.objectPerc.offsetPercY=this.objectPerc.offsetY/this.objectPerc.height)}endTouch(e){if(!this.touchMouseData.active)return;if(this.touchScreen=!1,this.touchMouseData.dragCount++,this.touchMouseData.dragTotal+=this.touchMouseData.dragCount,this.touchMouseData.active=!1,this.touchMouseData.endPos=new W(this.mouseX,this.mouseY),this.touchMouseData.netDistYPerc=(this.touchMouseData.netDistance.y+250)/1250,this.touchMouseData.curDistance.multiplyScalar(0),this.touchMouseData.curStepDistance.multiplyScalar(0),this.touchMouseData.releaseTime=this.pxlTimer.curMS,this.touchMouseData.lock){this.touchMouseData.lock=!1;return}this.pxlAutoCam.touchBlender=!0,this.pxlAutoCam.setNextTrigger();let t=e.target;this.touchMouseData.dragCount<10&&t.getAttribute&&t.getAttribute("id")==this.pxlCore&&this.pxlAutoCam.getNextPath(!1,0),this.objectPerc.active=!1,this.pxlAudio.djVolumeParentObj&&(this.pxlAudio.djVolumeParentObj.down=!1)}async keyDownCall(e){if(this.emit("keydown",e),e.ctrlKey&&(this.controlKey=!0),document.activeElement.type==null&&this.pxlTimer.active){if(e.repeat)return;let t=e.keyCode||e.which;(t==37||t==65)&&(this.directionKeyDown=!0,this.keyDownCount[0]=this.pxlQuality.fpsCounter.z,this.directionKeysPressed[0]=1,this.pxlCamera.deviceKey(0,!0)),e.ctrlKey&&t==87&&this.directionKeysPressed[1]==1&&e.this.preventDefault(e)(),(t==38||t==87)&&(this.directionKeyDown=!0,this.keyDownCount[1]=this.pxlQuality.fpsCounter.z,this.directionKeysPressed[1]=1,this.pxlCamera.deviceKey(1,!0)),(t==39||t==68)&&(this.directionKeyDown=!0,this.keyDownCount[0]=this.pxlQuality.fpsCounter.z,this.directionKeysPressed[2]=1,this.pxlCamera.deviceKey(2,!0)),(t==40||t==83)&&(this.directionKeyDown=!0,this.keyDownCount[1]=this.pxlQuality.fpsCounter.z,this.directionKeysPressed[3]=1,this.pxlCamera.deviceKey(3,!0)),(t==16||t==224)&&(this.shiftBoost=7,this.pxlCamera.deviceKey("shift",!0)),t==32&&(this.pxlCamera.camJumpKey(!0),this.pxlCamera.deviceKey("space",!0))}}async keyUpCall(e){if(this.emit("keyup",e),e.ctrlKey)return this.controlKey=!1,e.preventDefault(),!1;if(document.activeElement.type==null){let i=e.keyCode||e.which,s=e.code||e.which;if(!e.isTrusted)return!1;if(e.ctrlKey||e.altKey||e.code.includes("F"))return e.preventDefault(),!1;if(s=="Backquote"){this.pxlGuiDraws.guiToggleVisibility();return}if(i==89&&this.pxlGuiDraws.toggleShaderEditor(),i==220){console.log("Saving screenshot");let r=this.pxlQuality.screenResPerc;this.pxlQuality.screenResPerc=1,this.pxlEnv.mapRender(!1);let l=this.pxlGuiDraws.pxlNavCanvas.toDataURL("image/png"),u=atob(l.split(",")[1]),v=u.length,p=new Uint8Array(v);for(var t=0;t<v;++t)p[t]=u.charCodeAt(t);let g=URL.createObjectURL(new Blob([p])),m=new Date,C=m.getDate(),y=m.getMonth()+1,w=m.getFullYear()+"-"+y+"-"+C+"_"+m.getHours()+"-"+m.getMinutes()+"-"+m.getSeconds(),b=document.createElement("a");b.download=this.projectTitle+"_"+w+".png",b.href=g,document.body.appendChild(b),b.click(),b.parentNode.removeChild(b),this.pxlQuality.screenResPerc=r,this.pxlEnv.mapRender(!1);return}if(this.pxlTimer.active){if((i==37||i==65)&&(this.directionKeysPressed[0]=0,this.pxlCamera.deviceKey(0,!1)),(i==38||i==87)&&(this.directionKeysPressed[1]=0,this.pxlAutoCam.active&&this.pxlAutoCam.step(!0),this.pxlCamera.deviceKey(1,!1)),(i==39||i==68)&&(this.directionKeysPressed[2]=0,this.pxlCamera.deviceKey(2,!1)),(i==40||i==83)&&(this.directionKeysPressed[3]=0,this.pxlAutoCam.active&&this.pxlAutoCam.setRoom(!0),this.pxlCamera.deviceKey(3,!1)),this.directionKeysPressed.includes(1)||(this.directionKeyDown=!1),i==16||i==224){this.shiftBoost=1,this.pxlCamera.deviceKey("shift",!1);return}if(i==32){this.pxlCamera.camJumpKey(!1),this.pxlCamera.deviceKey("space",!1);return}if(!this.directionKeyDown){if(i==49||i==97){this.pxlCamera.fastTravel(0);return}if(i==50||i==98){this.pxlCamera.fastTravel(1);return}if(i==51||i==99){this.pxlCamera.fastTravel(2);return}if(i==52||i==100){this.pxlCamera.fastTravel(3);return}if(i==53||i==101){this.pxlAutoCam.preAutoCamToggle();return}}if(i==75||i==107||i==187,i==74||i==109||i==189,i==76,i==48,i==221){this.pxlUser?.itemInactiveCmd?.length>0&&console.log(this.pxlUser.itemInactiveCmd.pop());return}i==106}if(i==27||i==13&&!e.ctrlKey){this.pxlGuiDraws.toggleHudBlock(!1,!0),this.pxlGuiDraws.toggleGuiWindowContainer(!1,!1,!0);return}if(e.altKey||e.ctrlKey||e.shiftKey)return;if(i==85,i==73){this.pxlGuiDraws.iconEvent("click",this.pxlGuiDraws.hudIcons.infoIcon,"info");return}if(i==71){this.pxlGuiDraws.iconEvent("click",this.pxlGuiDraws.hudIcons.settingsIcon,"settings");return}if(i==67,i==66){this.pxlGuiDraws.iconEvent("click",this.pxlGuiDraws.hudIcons.musicIcon,"musicToggle");return}if(i==78){this.pxlGuiDraws.iconEvent("click",this.pxlGuiDraws.hudIcons.speakerIcon,"speakerToggle");return}if(i==77,i==86,i==191){this.pxlGuiDraws.iconEvent("click",this.pxlGuiDraws.hudIcons.helpIcon,"help");return}if(i==80){this.directionKeysPressed=[0,0,0,0],this.directionKeyDown=!1,this.pxlTimer.pause(),this.pxlTimer.active&&this.pxlEnv.mapRender(),this.pxlCamera.workerFunc("activeToggle",this.pxlTimer.active);return}}}resizeRenderResolution(e=null,t=null){if(e=e||window.innerWidth,t=t||window.innerHeight,this.mapW=(this.sW=e)*this.pxlQuality.screenResPerc,this.mapH=(this.sH=t)*this.pxlQuality.screenResPerc,this.screenRes.x=1/this.mapW,this.screenRes.y=1/this.mapH,this.screenRatio.x=this.sW/this.sH,this.screenRatio.y=this.sH/this.sW,this.pxlEnv.geoList.HDRView){let l=this.mapW>this.mapH?1:this.mapW/this.mapH;this.pxlEnv.geoList.HDRView.material.uniforms.ratioU.value=l}if(this.touchMouseData.mBlurVelInf=new W(2*this.screenRes.x,2*this.screenRes.y),!this.pxlEnv.mapGlowPass)return;this.pxlEnv.scene.renderTarget.setSize(this.mapW*this.pxlQuality.bufferPercMult,this.mapH*this.pxlQuality.bufferPercMult),this.pxlEnv.scene.renderWorldPos.setSize(this.mapW*this.pxlQuality.bufferPercMult,this.mapH*this.pxlQuality.bufferPercMult),this.pxlEnv.mapComposer.setSize(this.mapW,this.mapH),this.pxlEnv.mapComposerGlow.setSize(this.mapW,this.mapH),this.pxlEnv.roomComposer.setSize(this.mapW,this.mapH),this.pxlEnv.roomGlowPass.setSize(this.mapW*this.pxlQuality.bloomPercMult,this.mapH*this.pxlQuality.bloomPercMult),this.pxlEnv.delayComposer.setSize(this.mapW,this.mapH),this.pxlEnv.mapGlowPass.setSize(this.mapW*this.pxlQuality.bloomPercMult,this.mapH*this.pxlQuality.bloomPercMult),this.pxlEnv.mapMotionBlurPass.setSize(this.mapW*this.pxlQuality.mBlurPercMult,this.mapH*this.pxlQuality.mBlurPercMult),this.pxlEnv.mapOverlayHeavyPass.setSize(this.mapW,this.mapH),this.pxlEnv.mapOverlayPass.setSize(this.mapW,this.mapH),this.pxlEnv.mapOverlaySlimPass.setSize(this.mapW,this.mapH),this.pxlEnv.mapOverlayHeavyPass.uniforms.ratio.value=Math.min(1,this.mapW/this.mapH),this.pxlEnv.mapOverlayPass.uniforms.ratio.value=Math.min(1,this.mapW/this.mapH),this.pxlEnv.mapOverlaySlimPass.uniforms.ratio.value=Math.min(1,this.mapW/this.mapH),this.pxlGuiDraws.pxlNavCanvas.width=this.sW,this.pxlGuiDraws.pxlNavCanvas.height=this.sH,this.pxlGuiDraws.loading=!0,this.pxlEnv.engine.setPixelRatio(window.devicePixelRatio*this.pxlQuality.screenResPerc),this.pxlEnv.engine.setSize(this.sW,this.sH);var i=this.mapW/this.mapH;this.pxlCamera.camera.aspect=i,this.pxlCamera.camera.updateProjectionMatrix();let s=[this.sW/this.sH,this.sH/this.sW];var r=[1,1];r[0]=i>s[0]?1:this.sW/(this.sH*s[0]),r[1]=i>s[1]?this.sH/(this.sW*s[1]):1,r[0]>1?(r[1]*=1/r[0],r[0]=1):r[1]>1&&(r[0]*=1/r[1],r[1]=1),this.screenAspect.x=r[0]*(1/(.5**2+.5**2)**.5),this.screenAspect.y=r[1],this.screenResDeltaPerc.x=this.sW/this.origRes.x,this.screenResDeltaPerc.y=this.sH/this.origRes.y,this.pxlEnv.roomSubList.Lobby&&this.pxlEnv.roomSubList.Lobby.setShaders(),this.pxlEnv.updateCompUniforms(),this.pxlEnv.roomNameList.forEach(l=>{this.pxlEnv.roomSceneList[l].pxlCamAspect=i,this.pxlEnv.roomSceneList[l]?.resize&&this.pxlEnv.roomSceneList[l].resize(this.mapW,this.mapH)}),this.emit("resize",{width:this.mapW,height:this.mapH,xPixelPerc:this.screenRes.x,yPixelPerc:this.screenRes.y,aspectRatio:i}),this.pxlTimer.active||this.pxlEnv.mapRender(!1)}subscribe(e,t){if(!this.subscriptableEvents.includes(e)){console.error("Event type not subscribable: ",e);return}this.callbackList[e]||(this.callbackList[e]=[]),this.callbackList[e].push(t)}unsubscribe(e,t){if(this.callbackList[e]){let i=this.callbackList[e].indexOf(t);i>=0&&this.callbackList[e].splice(i,1)}}emit(e,t){this.callbackList.hasOwnProperty(e)&&this.callbackList[e].forEach(i=>{i(t)})}};import*as ke from"./three.module.js";var Ke=class{constructor(e=null,t=null){this.pxlEnv=null,this.assetPath=e,this.verbose=!1,this.animInitEntry={rig:null,mesh:null,mixer:null,clips:{},state:null,hasConnection:!1,prevTime:-1,connected:[],connections:{}},this.objNames=[],this.objects={},this.animMixer={},this.msRunner=t,this.clock=new ke.Clock}setDependencies(e){this.pxlEnv=e}log(e){this.verbose&&console.log(e)}initObject(e,t){let i=null,s=null,r=t.children.length,l=0,u=[...t.children],v=0,p=0,g=0,m=0;for(;l<r;){let y=u[l];switch(y.type){case"Bone":++p,i=y;break;case"Mesh":++v,y.visible=!1;break;case"SkinnedMesh":++g,s=y;break;case"Group":++m,u=u.concat(y.children),r=u.length;break;default:break}++l}let C=!1;if(i||(this.log("Error, No Bone/Rig Root Found; Please move your rig to the scene's root. Grouped rigs aren't supported yet."),C=!0),s||(this.log("Error, No SkinnedMesh Found; Please ensure your rig has a mesh to animate."),C=!0),C){console.log("Unable to prepare '"+e+"' for animation"),console.log("Group Count: "+m),console.log("Bone Root Found : "+(p>0)),console.log("Bone Count : "+p),console.log("Mesh Count: "+v),console.log("SkinnedMesh Count: "+g);return}if(!this.objNames.includes(e)){this.objNames.push(e);let y=Object.assign({},this.animInitEntry);y.rig=i,y.mesh=s,this.animMixer[e]=new ke.AnimationMixer(i),y.mixer=this.animMixer[e],this.objects[e]=y;let f=new ke.MeshStandardMaterial({skinning:!0});f.map=s.material.map,s.material=f}}addClips(e,t,i){if(!this.objNames.includes(e)){this.log("Error, '"+e+"' not found in Animation Manager");return}Object.keys(this.objects[e].clips).includes(t)&&this.log("Warning, '"+t+"' already exists in '"+e+"'");let l=this.animMixer[e].clipAction(i.animations[0]);this.objects[e].clips[t]=l}hasClip(e,t){return this.objNames.includes(e)?Object.keys(this.objects[e].clips).includes(t):!1}getMixer(e){return this.objNames.includes(e)?this.animMixer[e]:null}getRig(e){return this.objNames.includes(e)?this.objects[e].rig:null}getMesh(e){return this.objNames.includes(e)?this.objects[e].mesh:null}playClip(e,t){if(this.objNames.includes(e)&&Object.keys(this.objects[e].clips).includes(t)){let s=this.objects[e].clips[t];this.objects[e].state=t,this.objects[e].prevTime=-1,this.objects[e].hasConnection=this.objects[e].connected.includes(t),this.setWeight(e,t,1,!0),s.reset(),s.play()}}setWeight(e,t,i,s=!1){if(this.objNames.includes(e)){let r=Object.keys(this.objects[e].clips);if(r.includes(t)){let l=this.objects[e].clips[t];l.enabled=!0,l.setEffectiveTimeScale(1),l.setEffectiveWeight(i),s&&r.forEach(u=>{if(u!=t){let v=this.objects[e].clips[u];v.enabled=!1,v.setEffectiveTimeScale(1),v.setEffectiveWeight(0)}})}}}setStateConnections(e,t){if(this.objNames.includes(e)){let i=Object.keys(t);this.objects[e].connected=i,this.objects[e].connections=t}}step(e){if(this.objNames.includes(e)){if(!this.objects[e].hasConnection){this.animMixer[e].update(this.clock.getDelta());return}let i=this.objects[e].state;if(i){let r=this.objects[e].clips[i].time;if(this.objects[e].prevTime>r){let u=this.objects[e].connections[i],v=u[Math.floor(Math.random()*u.length)];this.playClip(e,v)}else this.animMixer[e].update(this.clock.getDelta()),this.objects[e].prevTime=r}else this.animMixer[e].update(this.clock.getDelta())}}destroy(e){if(this.objNames.includes(e)){this.animMixer[e].stopAllAction(),delete this.animMixer[e],delete this.objects[e];let t=this.objNames.indexOf(e);this.objNames.splice(t,1)}}};import*as A from"./three.module.js";import{Clock as Sr,LinearFilter as Pi,Mesh as Dr,OrthographicCamera as Tr,PlaneBufferGeometry as Mr,RGBAFormat as Lr,Vector2 as wi,WebGLRenderTarget as Rr}from"./three.module.js";var de={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","	vec4 texel = texture2D( tDiffuse, vUv );","	gl_FragColor = opacity * texel;","}"].join(`
`)};import{ShaderMaterial as Ci,UniformsUtils as Er}from"./three.module.js";import{OrthographicCamera as Cr,PlaneBufferGeometry as Pr,Mesh as wr}from"./three.module.js";function te(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}Object.assign(te.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}});te.FullScreenQuad=function(){var o=new Cr(-1,1,1,-1,0,1),e=new Pr(2,2),t=function(i){this._mesh=new wr(e,i)};return Object.defineProperty(t.prototype,"material",{get:function(){return this._mesh.material},set:function(i){this._mesh.material=i}}),Object.assign(t.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(i){i.render(this._mesh,o)}}),t}();var X=function(o,e){te.call(this),this.textureID=e!==void 0?e:"tDiffuse",o instanceof Ci?(this.uniforms=o.uniforms,this.material=o):o&&(this.uniforms=Er.clone(o.uniforms),this.material=new Ci({defines:Object.assign({},o.defines),uniforms:this.uniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader})),this.fsQuad=new te.FullScreenQuad(this.material)};X.prototype=Object.assign(Object.create(te.prototype),{constructor:X,render:function(o,e,t){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=t.texture),this.fsQuad.material=this.material,this.renderToScreen?(o.setRenderTarget(null),this.fsQuad.render(o)):(o.setRenderTarget(e),this.clear&&o.clear(o.autoClearColor,o.autoClearDepth,o.autoClearStencil),this.fsQuad.render(o))}});var Xe=function(o,e){te.call(this),this.scene=o,this.camera=e,this.clear=!0,this.needsSwap=!1,this.inverse=!1};Xe.prototype=Object.assign(Object.create(te.prototype),{constructor:Xe,render:function(o,e,t){var i=o.getContext(),s=o.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0);var r,l;this.inverse?(r=0,l=1):(r=1,l=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),s.buffers.stencil.setFunc(i.ALWAYS,r,4294967295),s.buffers.stencil.setClear(l),s.buffers.stencil.setLocked(!0),o.setRenderTarget(t),this.clear&&o.clear(),o.render(this.scene,this.camera),o.setRenderTarget(e),this.clear&&o.clear(),o.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(i.EQUAL,1,4294967295),s.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),s.buffers.stencil.setLocked(!0)}});var pt=function(){te.call(this),this.needsSwap=!1};pt.prototype=Object.create(te.prototype);Object.assign(pt.prototype,{render:function(o){o.state.buffers.stencil.setLocked(!1),o.state.buffers.stencil.setTest(!1)}});var be=function(o,e){if(this.renderer=o,e===void 0){var t={minFilter:Pi,magFilter:Pi,format:Lr,stencilBuffer:!1},i=o.getSize(new wi);this._pixelRatio=o.getPixelRatio(),this._width=i.width,this._height=i.height,e=new Rr(this._width*this._pixelRatio,this._height*this._pixelRatio,t),e.texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=e.width,this._height=e.height;this.renderTarget1=e,this.renderTarget2=e.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],de===void 0&&console.error("THREE.EffectComposer relies on CopyShader"),X===void 0&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new X(de),this.clock=new Sr};Object.assign(be.prototype,{swapBuffers:function(){var o=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=o},addPass:function(o){this.passes.push(o),o.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)},insertPass:function(o,e){this.passes.splice(e,0,o),o.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)},isLastEnabledPass:function(o){for(var e=o+1;e<this.passes.length;e++)if(this.passes[e].enabled)return!1;return!0},render:function(o){o===void 0&&(o=this.clock.getDelta());var e=this.renderer.getRenderTarget(),t=!1,i,s,r=this.passes.length;for(s=0;s<r;s++)if(i=this.passes[s],i.enabled!==!1){if(i.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(s),i.render(this.renderer,this.writeBuffer,this.readBuffer,o,t),i.needsSwap){if(t){var l=this.renderer.getContext(),u=this.renderer.state.buffers.stencil;u.setFunc(l.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,o),u.setFunc(l.EQUAL,1,4294967295)}this.swapBuffers()}Xe!==void 0&&(i instanceof Xe?t=!0:i instanceof pt&&(t=!1))}this.renderer.setRenderTarget(e)},reset:function(o){if(o===void 0){var e=this.renderer.getSize(new wi);this._pixelRatio=this.renderer.getPixelRatio(),this._width=e.width,this._height=e.height,o=this.renderTarget1.clone(),o.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=o,this.renderTarget2=o.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(o,e){this._width=o,this._height=e;var t=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(t,i),this.renderTarget2.setSize(t,i);for(var s=0;s<this.passes.length;s++)this.passes[s].setSize(t,i)},setPixelRatio:function(o){this._pixelRatio=o,this.setSize(this._width,this._height)}});var Ei=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1};Object.assign(Ei.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}});Ei.FullScreenQuad=function(){var o=new Tr(-1,1,1,-1,0,1),e=new Mr(2,2),t=function(i){this._mesh=new Dr(e,i)};return Object.defineProperty(t.prototype,"material",{get:function(){return this._mesh.material},set:function(i){this._mesh.material=i}}),Object.assign(t.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(i){i.render(this._mesh,o)}}),t}();var Ie=function(o,e,t,i,s){te.call(this),this.scene=o,this.camera=e,this.overrideMaterial=t,this.clearColor=i,this.clearAlpha=s!==void 0?s:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1};Ie.prototype=Object.assign(Object.create(te.prototype),{constructor:Ie,render:function(o,e,t){var i=o.autoClear;o.autoClear=!1;var s,r,l;this.overrideMaterial!==void 0&&(l=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(s=o.getClearColor().getHex(),r=o.getClearAlpha(),o.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&o.clearDepth(),o.setRenderTarget(this.renderToScreen?null:t),this.clear&&o.clear(o.autoClearColor,o.autoClearDepth,o.autoClearStencil),o.render(this.scene,this.camera),this.clearColor&&o.setClearColor(s,r),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=l),o.autoClear=i}});import{AdditiveBlending as kr,Color as Si,LinearFilter as Di,MeshBasicMaterial as Ir,RGBAFormat as Br,ShaderMaterial as mt,UniformsUtils as Ti,Vector2 as Pe,Vector3 as Ye,WebGLRenderTarget as Bt}from"./three.module.js";import{Color as Ar}from"./three.module.js";var It={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new Ar(0)},defaultOpacity:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","	vec4 texel = texture2D( tDiffuse, vUv );","	vec3 luma = vec3( 0.299, 0.587, 0.114 );","	float v = dot( texel.xyz, luma );","	vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","	float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","	gl_FragColor = mix( outputColor, texel, alpha );","}"].join(`
`)};var Ce=function(o,e,t,i){te.call(this),this.strength=e!==void 0?e:1,this.radius=t,this.threshold=i,this.resolution=o!==void 0?new Pe(o.x,o.y):new Pe(256,256),this.clearColor=new Si(0,0,0);var s={minFilter:Di,magFilter:Di,format:Br};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;var g=Math.round(this.resolution.x/2),m=Math.round(this.resolution.y/2);this.renderTargetBright=new Bt(g,m,s),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(var r=0;r<this.nMips;r++){var l=new Bt(g,m,s);l.texture.name="UnrealBloomPass.h"+r,l.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(l);var u=new Bt(g,m,s);u.texture.name="UnrealBloomPass.v"+r,u.texture.generateMipmaps=!1,this.renderTargetsVertical.push(u),g=Math.round(g/2),m=Math.round(m/2)}It===void 0&&console.error("UnrealBloomPass relies on LuminosityHighPassShader");var v=It;this.highPassUniforms=Ti.clone(v.uniforms),this.highPassUniforms.luminosityThreshold.value=i,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new mt({uniforms:this.highPassUniforms,vertexShader:v.vertexShader,fragmentShader:v.fragmentShader,defines:{}}),this.separableBlurMaterials=[];for(var p=[3,5,7,9,11],g=Math.round(this.resolution.x/2),m=Math.round(this.resolution.y/2),r=0;r<this.nMips;r++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(p[r])),this.separableBlurMaterials[r].uniforms.texSize.value=new Pe(g,m),g=Math.round(g/2),m=Math.round(m/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=e,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;var C=[1,.8,.6,.4,.2];this.compositeMaterial.uniforms.bloomFactors.value=C,this.bloomTintColors=[new Ye(1,1,1),new Ye(1,1,1),new Ye(1,1,1),new Ye(1,1,1),new Ye(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,de===void 0&&console.error("UnrealBloomPass relies on CopyShader");var y=de;this.copyUniforms=Ti.clone(y.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new mt({uniforms:this.copyUniforms,vertexShader:y.vertexShader,fragmentShader:y.fragmentShader,blending:kr,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new Si,this.oldClearAlpha=1,this.basic=new Ir,this.fsQuad=new te.FullScreenQuad(null)};Ce.prototype=Object.assign(Object.create(te.prototype),{constructor:Ce,dispose:function(){for(var o=0;o<this.renderTargetsHorizontal.length;o++)this.renderTargetsHorizontal[o].dispose();for(var o=0;o<this.renderTargetsVertical.length;o++)this.renderTargetsVertical[o].dispose();this.renderTargetBright.dispose()},setSize:function(o,e){var t=Math.round(o/2),i=Math.round(e/2);this.renderTargetBright.setSize(t,i);for(var s=0;s<this.nMips;s++)this.renderTargetsHorizontal[s].setSize(t,i),this.renderTargetsVertical[s].setSize(t,i),this.separableBlurMaterials[s].uniforms.texSize.value=new Pe(t,i),t=Math.round(t/2),i=Math.round(i/2)},render:function(o,e,t,i,s){this.oldClearColor.copy(o.getClearColor()),this.oldClearAlpha=o.getClearAlpha();var r=o.autoClear;o.autoClear=!1,o.setClearColor(this.clearColor,0),s&&o.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=t.texture,o.setRenderTarget(null),o.clear(),this.fsQuad.render(o)),this.highPassUniforms.tDiffuse.value=t.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,o.setRenderTarget(this.renderTargetBright),o.clear(),this.fsQuad.render(o);for(var l=this.renderTargetBright,u=0;u<this.nMips;u++)this.fsQuad.material=this.separableBlurMaterials[u],this.separableBlurMaterials[u].uniforms.colorTexture.value=l.texture,this.separableBlurMaterials[u].uniforms.direction.value=Ce.BlurDirectionX,o.setRenderTarget(this.renderTargetsHorizontal[u]),o.clear(),this.fsQuad.render(o),this.separableBlurMaterials[u].uniforms.colorTexture.value=this.renderTargetsHorizontal[u].texture,this.separableBlurMaterials[u].uniforms.direction.value=Ce.BlurDirectionY,o.setRenderTarget(this.renderTargetsVertical[u]),o.clear(),this.fsQuad.render(o),l=this.renderTargetsVertical[u];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,o.setRenderTarget(this.renderTargetsHorizontal[0]),o.clear(),this.fsQuad.render(o),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,s&&o.state.buffers.stencil.setTest(!0),this.renderToScreen?(o.setRenderTarget(null),this.fsQuad.render(o)):(o.setRenderTarget(t),this.fsQuad.render(o)),o.setClearColor(this.oldClearColor,this.oldClearAlpha),o.autoClear=r},getSeperableBlurMaterial:function(o){return new mt({defines:{KERNEL_RADIUS:o,SIGMA:o},uniforms:{colorTexture:{value:null},texSize:{value:new Pe(.5,.5)},direction:{value:new Pe(.5,.5)}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 texSize;				uniform vec2 direction;								float gaussianPdf(in float x, in float sigma) {					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;				}				void main() {
					vec2 invSize = 1.0 / texSize;					float fSigma = float(SIGMA);					float weightSum = gaussianPdf(0.0, fSigma);					vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;					for( int i = 1; i < KERNEL_RADIUS; i ++ ) {						float x = float(i);						float w = gaussianPdf(x, fSigma);						vec2 uvOffset = direction * invSize * x;						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;						diffuseSum += (sample1 + sample2) * w;						weightSum += 2.0 * w;					}					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);
				}`})},getCompositeMaterial:function(o){return new mt({defines:{NUM_MIPS:o},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:"varying vec2 vUv;				uniform sampler2D blurTexture1;				uniform sampler2D blurTexture2;				uniform sampler2D blurTexture3;				uniform sampler2D blurTexture4;				uniform sampler2D blurTexture5;				uniform sampler2D dirtTexture;				uniform float bloomStrength;				uniform float bloomRadius;				uniform float bloomFactors[NUM_MIPS];				uniform vec3 bloomTintColors[NUM_MIPS];								float lerpBloomFactor(const in float factor) { 					float mirrorFactor = 1.2 - factor;					return mix(factor, mirrorFactor, bloomRadius);				}								void main() {					gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + 													 lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + 													 lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + 													 lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + 													 lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );				}"})}});Ce.BlurDirectionX=new Pe(1,0);Ce.BlurDirectionY=new Pe(0,1);var $e=class{constructor(e,t="Default",i="pxlRooms",s){this.engine=null,this.scene=null,this.parentGroupList={},this.parentGroupList[t]=[],this.parentNameList=[],this.options=e,this.prevRenderMS=0,this.nextRenderMS=0,this.fps=s?30:60,this.renderInterval=1/this.fps,this.pxlRoomAbsRoot=i;let r=i.split("/");r.splice(0,1),r=r.join("/"),this.pxlRoomLclRoot="../../"+i.split("/").pop(),this.mainRoom=t,this.bootRoom=t,this.bootLocation=null,this.currentRoom=t,this.roomNameList=[t],this.roomSubList={},this.roomSceneList={},this.roomSceneList[t]=this,this.roomPostGuiCalls=[],this.jmaCheckConnection=!1,this.checkContext=0,this.activeContext=!1,this.warpPortalTextures={},this.warpZoneRenderTarget=null,this.currentAudioZone=0,this.pxlUtils=null,this.pxlTimer=null,this.pxlAnim=null,this.pxlAutoCam=null,this.pxlAudio=null,this.pxlFile=null,this.pxlVideo=null,this.pxlQuality=null,this.pxlUser=null,this.pxlShaders=null,this.pxlDevice=null,this.pxlCamera=null,this.pxlGuiDraws=null,this.renderLayerEnum={SCENE:0,PARTICLES:1,GLOW:2,SKY:3},this.cloud3dTexture=null,this.softNoiseTexture=null,this.detailNoiseTexture=null,this.chroAberUVTexture=null,this.blockAnimTexture=null,this.userScreenIntensity=new A.Vector2(0,.8),this.portaluserScreenIntensity=new A.Vector2(1,0),this.portalMtlRate=.7,this.mobile=s,this.camNear=.1,this.camFar=5e3,this.fogMult=new A.Vector2(0,0),this.fogColor=new A.Color(.07,.07,.1),this.fogColorSky=new A.Color(.1,.1,.12),this.fogExp=3e-4,this.fog=new A.FogExp2(this.fogColor,this.fogExp),this.listener=null,this.posted=!1,this.postIntro=!1,this.camLocation={},this.camInitPos=new A.Vector3(0,15,0),this.camInitLookAt=new A.Vector3(0,15,0),this.camThumbPos=new A.Vector3(0,0,0),this.camThumbLookAt=new A.Vector3(0,20,0),this.camReturnPos=new A.Vector3(0,0,0),this.camReturnLookAt=new A.Vector3(0,0,0),this.camLobbyPos=new A.Vector3(0,15,0),this.camLobbyLookAt=new A.Vector3(0,15,-100),this.pxlCamFOV=s?80:60,this.pxlCamZoom=1,this.pxlCamAspect=1,this.pxlCamNearClipping=this.camNear,this.pxlCamFarClipping=this.camFar,this.groupList=[],this.geoList=[],this.geoLoadList=[],this.geoLoadListComplete=0,this.lightList=[],this.returnPortalGlowList=[],this.roomWarpVisuals={},this.proximityGeo=null,this.userAvatarGroup=new A.Group,this.warpVisualActive=!1,this.warpVisualMaxTime=[1.5,1],this.warpVisualStartTime=0,this.warpVisualFader=new A.Vector2(0,1),this.warpVisualCmd=null,this.stepShaderFuncArr=[],this.mapMotionBlurPass=null,this.mapCopyMotionBlurPass=null,this.mapOverlayHeavyPass=null,this.mapOverlayPass=null,this.mapOverlaySlimPass=null,this.mapBoxAAPass=null,this.mapCrossAAPass=null,this.mapWorldPosMaterial=null,this.mapGlowPass=null,this.mapGlowMotionBlur=null,this.mapComposer=null,this.mapComposerMotionBlur=null,this.mapComposerBloom=null,this.mapComposerGlow=null,this.chroAberrationPass=null,this.chroAberrationRoomPass=null,this.lizardKingPass=null,this.lizardKingRoomPass=null,this.mapComposerWarpPass=null,this.blurScreenMerge=null,this.pxlRenderSettings={exposure:1,mult:1,bloomStrength:.5,bloomThresh:.6,bloomRadius:.05},this.exposureShiftActive=!1,this.delayComposer=null,this.delayPass=null,this.chroAberMult=new A.Vector2(1,0),this.blurDirCur=new A.Vector2(0,0),this.blurDirPrev=new A.Vector2(0,0),this.shaderPasses={},this.roomComposer=null,this.roomRenderPass=null,this.roomBloomPass=null,this.roomGlowPass=null,this.blurComposer=null,this.glowPassMask=new A.Vector2(1,0),this.objectClickable=[],this.objectClickableObjectList={},this.clickablePrevActiveObject=null,this.promoClickable=[],this.promoClickableObjectList={},this.promoPrevActiveObject=null,this.promoClickableLinks={},this.remoteVideoTextureList=[],this.remoteUserNameList=[],this.remoteUserMediaList={},this.remoteUserVideoList=[],this.remoteUserAudioList=[],this.camScreenData={count:0,prevCount:0,checkUserCount:!0,checkVideoStatus:!0,findCamCount:()=>{},videoObjectList:[],screenGeoList:[],screenClickable:[],screenMtlUniforms:[],userDataList:[],camFindInfoList:[]},this.curUserCount=0,this.prevUserCount=0,this.emit=(l,u)=>{}}setDependencies(e){this.scene=e.scene,this.pxlUtils=e.pxlUtils,this.pxlTimer=e.pxlTimer,this.pxlAnim=e.pxlAnim,this.pxlAutoCam=e.pxlAutoCam,this.pxlAudio=e.pxlAudio,this.pxlFile=e.pxlFile,this.pxlVideo=e.pxlVideo,this.pxlQuality=e.pxlQuality,this.pxlUser=e.pxlUser,this.pxlShaders=e.pxlShaders,this.pxlDevice=e.pxlDevice,this.pxlCamera=e.pxlCamera,this.pxlGuiDraws=e.pxlGuiDraws,this.emit=e.emit.bind(e)}log(e,t=ae.INFO){this.options.verbose>ae.INFO&&console.log(e)}init(){let e=Object.keys(this.options);Object.keys(Le).forEach(s=>{e.includes(s)||(this.options[s]=Le[s])}),Object.keys(this.roomSubList).forEach(s=>{this.roomSubList[s].init()})}boot(){}setBootRoom(e,t){console.log(e,t),this.bootRoom=e,this.bootLocation=t}postBoot(){this.pxlGuiDraws.togglePageDisplay(),this.roomSceneList[this.bootRoom].start(),this.posted=!0}postHelpIntro(){!this.pxlDevice.mobile&&!this.pxlAutoCam.enabled?this.pxlCamera.jogServerMemory():(this.pxlCamera.colliderValid=!0,this.pxlCamera.eventCheckStatus=!0,this.pxlCamera.colliderShiftActive=!0,this.pxlCamera.nearestFloorObjName="mobile",this.pxlCamera.colliderCurObjHit="AudioTrigger_2",this.pxlCamera.proximityScaleTrigger=!0,this.exposureShiftActive=!0,this.pxlDevice.mobile||(this.pxlAudio.play(),setTimeout(()=>{this.pxlAudio.initPlay()},100))),this.postIntro=!0}start(){this.init()}step(){if(this.pxlTimer.step(),this.pxlAudio.step(),this.pxlQuality.step(),this.pxlAutoCam.step()&&this.pxlCamera.step(),this.pxlGuiDraws.step(),this.stepWarpPass(),this.pxlTimer.msRunner.x>this.checkContext&&this.activeContext){this.checkContext=this.pxlTimer.msRunner.x+1;let e=document.createElement("canvas");try{let t=!!e.getContext("webgl")}catch{this.activeContext=!0,this.pxlGuiDraws.pxlNavCanvas.style.display="none"}}this.pxlDevice.mobile&&this.exposureShiftActive}async stop(){this.setExposure(0),Object.keys(this.roomSubList).forEach(t=>{this.roomSubList[t].stop()})}loadRoom(e){return new Promise((t,i)=>{this.log("Loading Room - ",e);var s=import(`${this.pxlRoomLclRoot}/${e}/${e}.js`);s.then(r=>{let l=new r[e](e,`../${this.pxlRoomLclRoot}/${e}/`,this.pxlFile,this.pxlAnim,this.pxlUtils,this.pxlDevice,this,this.pxlTimer.msRunner,null,null,this.cloud3dTexture);l.camera=this.pxlCamera.camera,l.scene=new A.Scene,l.userAvatarGroup||(l.userAvatarGroup=new A.Group),l.scene.add(l.userAvatarGroup);var u={format:A.RGBAFormat,antialias:!1,sortObjects:!0,alpha:!0,type:/(iPad|iPhone|iPod)/g.test(navigator.userAgent)?A.HalfFloatType:A.FloatType};l.scene.renderTarget=new A.WebGLRenderTarget(this.pxlDevice.sW*this.pxlQuality.screenResPerc,this.pxlDevice.sH*this.pxlQuality.screenResPerc,u),l.scene.renderTarget.texture.format=A.RGBAFormat,l.scene.renderTarget.texture.minFilter=A.LinearFilter,l.scene.renderTarget.texture.magFilter=A.LinearFilter,l.scene.renderTarget.texture.generateMipmaps=!1,l.scene.renderTarget.depthBuffer=!0,l.scene.renderTarget.depthTexture=new A.DepthTexture(this.pxlDevice.sW*this.pxlQuality.screenResPerc,this.pxlDevice.sH*this.pxlQuality.screenResPerc),l.scene.renderTarget.depthTexture.format=A.DepthFormat,l.scene.renderTarget.depthTexture.type=A.UnsignedShortType,l.cloud3dTexture=this.cloud3dTexture,this.roomNameList.includes(e)||this.roomNameList.push(e),this.roomSceneList[e]=l,t(!0)})})}startAllRooms(){this.roomNameList.forEach(e=>{this.startRoom(this.roomSceneList[e])})}startRoom(e){e.active=!1,e.startTime=this.pxlTimer.msRunner.x}newSubRoom(e){this.roomSubList[e.roomName]=e}addToRooms(e){let t={};return this.roomNameList.forEach(i=>{let s=e.clone();this.roomSceneList[i].scene.add(s),t[i]=s}),t}addToRoomLayers(e,t=1){let i={};return this.roomNameList.forEach(s=>{let r=e.clone();this.roomSceneList[s].scene.add(r),i[s]=r,r.layers.set(t)}),i}addToRoomParents(e,t){let i={};return this.parentNameList.includes(t)||this.parentNameList.push(t),this.roomNameList.forEach(s=>{let r=e.clone();if(this.parentGroupList[s]||(this.parentGroupList[s]={}),!this.parentGroupList[s][t]){let l=new A.Group;this.parentGroupList[s][t]=l,this.roomSceneList[s].scene.add(l)}this.parentGroupList[s][t].add(r),i[s]=r}),i}buildRoomEnvironments(){this.log("Building Room Environments"),this.log(this.roomNameList);let e=[];this.roomNameList.forEach(t=>{this.roomSceneList[t].init(),this.roomSceneList[t].build&&this.roomSceneList[t].build()})}getArtistInfo(){return null}setFogHue(e=[0,0],t=[1,1]){let i=this.fog.color.getHSL(),s=[t[0]-e[0],t[1]-e[1]],r=Math.abs(Math.atan2(s[0],s[1])*.3183098861837907),l=(s[0]**2+s[1]**2)**.5/Math.max(this.pxlDevice.sW,this.pxlDevice.sH);this.fog.color.setHSL(r,l*.5+.3,l*.5),this.roomSceneList[this.currentRoom]&&this.roomSceneList[this.currentRoom].setFog&&this.roomSceneList[this.currentRoom].setFog(this.fog.color)}readShader(e=""){if(e=="script_fog"){if(this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.mapOverlayHeavyPass.enabled==!0)return this.mapOverlayHeavyPass.material;if(this.mapOverlayPass.enabled==!0)return this.mapOverlayPass.material;if(this.mapOverlaySlimPass.enabled==!0)return this.mapOverlaySlimPass.material}else{if(e=="script_dArrows")return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.geoList.dArrows[0].material;if(e=="script_userScreens")return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.camScreenData.screenGeoList[0].material;if(e=="script_warpZonePortals")return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.returnPortalGlowList[0].material;if(e=="script_lizardking")return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.lizardKingPass.material;if(e=="script_majorTom")return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.pxlUser.sFieldPass.material;if(e=="script_fractalSubstrate")return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.pxlUser.iZoomPass.material;if(e=="script_fractalEcho")return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.delayPass.material;{let t=e.split("_");if(t.shift(),t=t.join("_"),this.geoList[t])return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.geoList[t].material}}}setShader(e,t,i){let s,r=this.pxlGuiDraws.guiWindows.shaderGui.currentShader;if(r=="script_fog")this.mapOverlayHeavyPass.enabled==!0?s=this.mapOverlayHeavyPass.material:this.mapOverlayPass.enabled==!0?s=this.mapOverlayPass.material:this.mapOverlaySlimPass.enabled==!0&&(s=this.mapOverlaySlimPass.material);else if(r=="script_dArrows"){this.geoList.dArrows.forEach(l=>{s=l.material,s.vertexShader=t,s.fragmentShader=i,s.needsUpdate=!0});return}else if(r=="script_userScreens"){this.camScreenData.screenGeoList.forEach(l=>{s=l.material,s.vertexShader=t,s.fragmentShader=i,s.needsUpdate=!0});return}else if(r=="script_warpZonePortals"){this.returnPortalGlowList.forEach(l=>{s=l.material,s.vertexShader=t,s.fragmentShader=i,s.needsUpdate=!0});return}else if(r=="script_lizardking")s=this.lizardKingPass.material;else if(r=="script_majorTom")s=this.pxlUser.sFieldPass.material;else if(r=="script_fractalSubstrate")s=this.pxlUser.iZoomPass.material;else if(r=="script_fractalEcho")s=this.delayPass.material;else{let l=r.split("_");l.shift(),l=l.join("_"),this.geoList[l]&&(s=this.geoList[l].material)}s&&(s.vertexShader=t,s.fragmentShader=i,s.needsUpdate=!0)}getAssetTexture(e,t=null,i=null){this.log("Get Internal Texture - ",e);let s=this.pxlUtils.assetRoot+e;if(!t){let u=e.split(".").pop().toLowerCase();u=="jpg"||u=="jpeg"?t=3:u=="png"&&(t=4)}return i||(i={magFilter:A.LinearFilter,minFilter:A.LinearFilter}),this.pxlUtils.loadTexture(s,t,i)}buildSnow(){let e=12e3,t=12,i=new A.BufferGeometry,s=[],r=[],l=[],u=()=>Math.floor(Math.random()*4e3%4)*.25;for(let f=0;f<e;++f)s.push(0,0,0),r.push(Math.random(),Math.random(),Math.random()*2-1,Math.random()*.5+.5),l.push(u(),u());let v=new A.Float32BufferAttribute(s,3),p=new A.Float32BufferAttribute(r,4),g=new A.Float32BufferAttribute(l,2);i.setAttribute("position",v),i.setAttribute("seeds",p),i.setAttribute("atlas",g);let m={snowTexture:{type:"t",value:this.pxlUtils.loadTexture(this.pxlUtils.assetRoot+"snow.jpg",1,{magFilter:A.NearestFilter,minFilter:A.NearestMipmapNearestFilter})},pointScale:{type:"f",value:t*this.pxlQuality.screenResPerc},intensity:{type:"f",value:1},rate:{type:"f",value:.035}};console.log(this.pxlShaders.particles);let C=this.pxlFile.pxlShaderBuilder(m,this.pxlShaders.particles.snowVert(this.mobile),this.pxlShaders.particles.snowFrag());C.side=A.DoubleSide,C.transparent=!0,C.blending=A.AdditiveBlending,C.depthTest=!0,C.depthWrite=!1;let y=new A.Points(i,C);y.sortParticles=!1,y.frustumCulled=!1,this.scene.add(y),y.layers.set(1),y.pBaseScale=t,this.geoList.snow=y}buildBackgroundObject(e={},t=null,i=null){let s=new A.PlaneBufferGeometry,r={};Object.assign(r,e),(t==null||typeof t!="string")&&(t=this.pxlShaders.scene.bgScreenVert()),(i==null||typeof i!="string")&&(i=this.pxlShaders.scene.bgScreenFrag());let l=this.pxlFile.pxlShaderBuilder(r,t,i);l.side=A.DoubleSide,l.depthTest=!0,l.depthWrite=!1;let u=new A.Mesh(s,l);return u.frustumCulled=!1,u}clickUserDetect(){if(this.roomSceneList[this.currentRoom].castRay&&this.roomSceneList[this.currentRoom].castRay(!0,this.pxlDevice.touchMouseData.button),this.pxlDevice.mobile)return;let e=null,t=new A.Vector2(this.pxlDevice.mouseX/this.pxlDevice.sW*2-1,-this.pxlDevice.mouseY/this.pxlDevice.sH*2+1);this.pxlCamera.objRaycast.setFromCamera(t,this.pxlCamera.camera);var i=[];if(this.objectClickable.length>0&&(i=this.pxlCamera.objRaycast.intersectObjects(this.objectClickable)),i.length>0){let u=99999;for(var s=0;s<i.length;++s){var r=i[s];let v=r.distance;v<u&&(e=r.object,u=Math.min(u,v))}}e&&this.clickableActions(e.name);let l=null;if(this.promoClickable.length>0&&(i=this.pxlCamera.objRaycast.intersectObjects(this.promoClickable)),i.length>0){let u=99999;for(var s=0;s<i.length;++s){var r=i[s];let g=r.distance;g<u&&(l=r.object,u=Math.min(u,g))}}l&&this.promoActions(l)}clickableActions(e=null){e=="CallToAction"&&this.clickablePrevActiveObject&&(this.pxlGuiDraws.ctaBuildPopup(),this.objectClickableObjectList[this.clickablePrevActiveObject].Inactive.visible=!0,this.objectClickableObjectList[this.clickablePrevActiveObject].Hover.visible=!1,this.clickablePrevActiveObject=null)}promoActions(e=null){let t=e.userData.video,i=e.name;if(this.promoClickableLinks.hasOwnProperty(t)){var s=window.open(this.promoClickableLinks[t],"_blank");s.focus()}}hoverUserDetect(){this.roomSceneList[this.currentRoom].castRay&&this.roomSceneList[this.currentRoom].castRay(!1,this.pxlDevice.touchMouseData.button);let e=null,t=new A.Vector2(this.pxlDevice.mouseX/this.pxlDevice.sW*2-1,-this.pxlDevice.mouseY/this.pxlDevice.sH*2+1);this.pxlCamera.objRaycast.setFromCamera(t,this.pxlCamera.camera);var i=[];if(this.objectClickable.length>0&&(i=this.pxlCamera.objRaycast.intersectObjects(this.objectClickable)),i.length>0){let u=99999;for(var s=0;s<i.length;++s){var r=i[s];let v=r.distance;v<u&&(e=r.object,u=Math.min(u,v))}}if(e){this.pxlDevice.setCursor("help"),this.objectClickableObjectList[e.name]&&(this.clickablePrevActiveObject==null&&(this.clickablePrevActiveObject=e.name),this.objectClickableObjectList[e.name].Inactive.visible=!1,this.objectClickableObjectList[e.name].Hover.visible=!0);return}else this.clickablePrevActiveObject&&(this.objectClickableObjectList[this.clickablePrevActiveObject].Inactive.visible=!0,this.objectClickableObjectList[this.clickablePrevActiveObject].Hover.visible=!1,this.clickablePrevActiveObject=null),this.pxlDevice.setCursor("grab");let l=null;if(this.promoClickable.length>0&&(i=this.pxlCamera.objRaycast.intersectObjects(this.promoClickable)),i.length>0){let u=99999;for(var s=0;s<i.length;++s){var r=i[s];let g=r.distance;g<u&&(l=r.object,u=Math.min(u,g))}}l?(this.pxlDevice.setCursor("alias"),this.promoClickableObjectList[l.name]&&(this.promoPrevActiveObject==null&&(this.promoPrevActiveObject=l.name),this.promoClickableObjectList[l.name].x=1)):(this.promoPrevActiveObject&&(this.promoClickableObjectList[this.promoPrevActiveObject].x=.1,this.promoPrevActiveObject=null),this.pxlDevice.setCursor("grab"))}updateCompUniforms(e=null){e&&(this.pxlRenderSettings.exposure=e*this.pxlRenderSettings.mult),this.mapOverlayPass&&(this.mapMotionBlurPass.uniforms.exposure.value=this.pxlRenderSettings.exposure,this.mapOverlayHeavyPass.uniforms.exposure.value=this.pxlRenderSettings.exposure,this.mapOverlayPass.uniforms.exposure.value=this.pxlRenderSettings.exposure,this.mapOverlaySlimPass.uniforms.exposure.value=this.pxlRenderSettings.exposure)}sendRoomMessage(e,t,i){this.roomSceneList[e]&&this.roomSceneList[e].onMessage(t,i)}buildComposers(){this.mapWorldPosMaterial=new A.ShaderMaterial({uniforms:{camNear:{type:"f",value:this.pxlCamera.camera.near},camFar:{type:"f",value:this.pxlCamera.camera.far}},vertexShader:this.pxlShaders.rendering.worldPositionVert(),fragmentShader:this.pxlShaders.rendering.worldPositionFrag()}),this.mapWorldPosMaterial.side=A.FrontSide,this.mapWorldPosMaterial.name="mapWorldPosMaterial",this.blurComposer=new be(this.engine),this.shaderPasses.blurXShaderPass=new X(new A.ShaderMaterial({uniforms:{time:{value:this.time},tDiffuse:{value:null},pDiffuse:{value:this.scene.renderGlowTarget.texture},resUV:{value:this.pxlDevice.screenRes}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.directionalBlurPass("pDiffuse",[1,0],4,1.8),defines:{}}),"tDiffuse"),this.shaderPasses.blurXShaderPass.material.transparent=!0,this.shaderPasses.blurXShaderPass.needsSwap=!0,this.shaderPasses.blurXShaderPass.enabled=!1,this.shaderPasses.blurXShaderPass.name="blurXShaderPass",this.blurComposer.addPass(this.shaderPasses.blurXShaderPass),this.shaderPasses.dirBlurCopyPass=new X(de),this.shaderPasses.dirBlurCopyPass.enabled=!1,this.shaderPasses.dirBlurCopyPass.name="dirBlurCopyPass",this.blurComposer.addPass(this.shaderPasses.dirBlurCopyPass),this.shaderPasses.blurYShaderPass=new X(new A.ShaderMaterial({uniforms:{time:{value:this.time},tDiffuse:{value:null},pDiffuse:{value:this.scene.renderGlowTarget.texture},resUV:{value:this.pxlDevice.screenRes}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.directionalBlurPass("pDiffuse",[0,1],4,1.3),defines:{}}),"tDiffuse"),this.shaderPasses.blurYShaderPass.material.transparent=!0,this.shaderPasses.blurYShaderPass.enabled=!1,this.shaderPasses.blurYShaderPass.name="blurYShaderPass",this.blurComposer.addPass(this.shaderPasses.blurYShaderPass),this.shaderPasses.scatterMixShaderPass=new X(new A.ShaderMaterial({uniforms:{time:{value:this.time},tDiffuse:{value:null},pDiffuse:{value:this.scene.renderGlowTarget.texture},resUV:{value:this.pxlDevice.screenRes}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.mixBlurShaderPass(),defines:{}}),"tDiffuse"),this.shaderPasses.scatterMixShaderPass.material.transparent=!0,this.shaderPasses.scatterMixShaderPass.enabled=!1,this.shaderPasses.scatterMixShaderPass.name="scatterMixShaderPass",this.blurComposer.addPass(this.shaderPasses.scatterMixShaderPass),this.options.antiAliasing==Me.LOW?this.shaderPasses.scatterMixShaderPass.enabled=!0:this.options.antiAliasing==Me.MEDIUM?(this.shaderPasses.blurXShaderPass.enabled=!0,this.shaderPasses.dirBlurCopyPass.enabled=!0,this.shaderPasses.blurYShaderPass.enabled=!0):this.options.antiAliasing==Me.HIGH&&(this.shaderPasses.blurXShaderPass.enabled=!0,this.shaderPasses.dirBlurCopyPass.enabled=!0,this.shaderPasses.blurYShaderPass.enabled=!0,this.shaderPasses.scatterMixShaderPass.enabled=!0),this.mapComposerMotionBlur=new be(this.engine),this.mapMotionBlurPass=new X(new A.ShaderMaterial({uniforms:{tDiffuse:{value:null},rDiffuse:{value:this.scene.renderTarget.texture},exposure:{type:"f",value:this.pxlRenderSettings.exposure},time:{value:this.pxlTimer.msRunner},camRotXYZ:{value:this.pxlCamera.camRotXYZ},blurDirCur:{type:"f",value:this.blurDirCur},blurDirPrev:{type:"f",value:this.blurDirPrev},noiseTexture:{value:this.cloud3dTexture}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.motionBlurPostProcess(this.pxlDevice.screenRes,this.pxlDevice.mobile),defines:{}}),"tDiffuse"),this.mapMotionBlurPass.needsSwap=!0,this.mapMotionBlurPass.name="mapMotionBlurPass",this.mapComposerMotionBlur.addPass(this.mapMotionBlurPass),this.mapMotionBlurPass.enabled=!1,this.mapComposerMotionBlur.renderToScreen=!1,this.mapComposerGlow=new be(this.engine);let e=new Ie(this.scene,this.pxlCamera.camera);this.mapComposerGlow.addPass(e),this.blurScreenMerge=new X(new A.ShaderMaterial({uniforms:{tDiffuse:{value:null},rDiffuse:{value:this.scene.renderTarget.texture},mtDiffuse:{value:this.scene.renderTarget.texture},exposure:{type:"f",value:this.pxlRenderSettings.exposure}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.compLayersPostProcess(),defines:{}}),"tDiffuse"),this.blurScreenMerge.needsSwap=!0,this.blurScreenMerge.name="blurScreenMerge",this.mapComposerGlow.addPass(this.blurScreenMerge);let t=new X(de);t.name="glowCopyPassBlur",this.mapComposerGlow.addPass(t),this.mapComposerGlow.renderToScreen=!1,this.mapComposerGlow.autoClear=!0,this.mapOverlayHeavyPass=new X(new A.ShaderMaterial({uniforms:{gamma:{type:"f",value:this.pxlDevice.gammaCorrection},exposure:{type:"f",value:this.pxlRenderSettings.exposure},time:{value:this.pxlTimer.msRunner},camPos:{value:this.pxlCamera.camera.position},ratio:{type:"f",value:1},tDiffuse:{value:null},rDiffuse:{value:this.scene.renderTarget.texture},bloomTexture:{value:this.mapComposerGlow.renderTarget2.texture},sceneDepth:{value:this.scene.renderTarget.depthTexture},scenePos:{value:this.scene.renderWorldPos.texture},noiseTexture:{value:this.cloud3dTexture},fogMult:{value:this.fogMult},proximityMult:{value:1}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.finalOverlayHeavyShader(),defines:{}}),"tDiffuse"),this.mapOverlayHeavyPass.needsSwap=!0,this.mapOverlayHeavyPass.name="mapOverlayHeavyPass",this.mapOverlayPass=new X(new A.ShaderMaterial({uniforms:{gamma:{type:"f",value:this.pxlDevice.gammaCorrection},exposure:{type:"f",value:this.pxlRenderSettings.exposure},time:{value:this.pxlTimer.msRunner},camPos:{value:this.pxlCamera.camera.position},ratio:{type:"f",value:1},tDiffuse:{value:null},rDiffuse:{value:this.scene.renderTarget.texture},bloomTexture:{value:this.mapComposerGlow.renderTarget2.texture},sceneDepth:{value:this.scene.renderTarget.depthTexture},scenePos:{value:this.scene.renderWorldPos.texture},noiseTexture:{value:this.cloud3dTexture},fogMult:{value:this.fogMult},proximityMult:{value:1}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.finalOverlayShader(),defines:{}}),"tDiffuse"),this.mapOverlayPass.needsSwap=!0,this.mapOverlayPass.name="mapOverlayPass",this.mapOverlaySlimPass=new X(new A.ShaderMaterial({uniforms:{gamma:{type:"f",value:this.pxlDevice.gammaCorrection},exposure:{type:"f",value:this.pxlRenderSettings.exposure},time:{value:this.pxlTimer.msRunner},camPos:{value:this.pxlCamera.camera.position},ratio:{type:"f",value:1},tDiffuse:{value:null},rDiffuse:{value:this.scene.renderTarget.texture},bloomTexture:{value:this.mapComposerGlow.renderTarget2.texture},sceneDepth:{value:this.scene.renderTarget.depthTexture},fogMult:{value:this.fogMult},proximityMult:{value:1}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.finalOverlaySlimShader(),defines:{}}),"tDiffuse"),this.mapOverlaySlimPass.needsSwap=!0,this.mapOverlaySlimPass.name="mapOverlaySlimPass",this.mapGlowPass=new X(new A.ShaderMaterial({uniforms:{time:{value:this.pxlTimer.msRunner},ratio:{type:"f",value:1},tDiffuse:{value:null},rDiffuse:{value:this.scene.renderGlowTarget.texture},sceneDepth:{value:this.scene.renderTarget.depthTexture}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.glowPassPostProcess(),defines:{}}),"tDiffuse"),this.mapGlowPass.needsSwap=!0,this.mapGlowPass.name="mapGlowPass",this.mapComposer=new be(this.engine),this.mapComposer.addPass(this.mapOverlayHeavyPass),this.mapComposer.addPass(this.mapOverlayPass),this.mapComposer.addPass(this.mapOverlaySlimPass),this.mapComposer.addPass(this.mapGlowPass),this.mapOverlayHeavyPass.enabled=!1,this.mapOverlayPass.enabled=!1,this.pxlUser.lKingWarp=new A.Vector2(...this.pxlUser.lKingInactive),this.lizardKingPass=new X(new A.ShaderMaterial({uniforms:{tDiffuse:{value:null},time:{value:this.pxlTimer.msRunner},ratio:{value:this.pxlDevice.screenRes},noiseTexture:{value:this.cloud3dTexture}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.lKingPostProcess(),defines:{}}),"tDiffuse"),this.pxlUser.lKingPass=this.lizardKingPass,this.lizardKingPass.enabled=!1,this.pxlUser.lKingPass.name="lizardKingPass",this.pxlUser.sFieldPass=new X(new A.ShaderMaterial({uniforms:{tDiffuse:{value:null},time:{value:this.pxlTimer.msRunner},ratio:{value:this.pxlDevice.screenRes},noiseTexture:{value:this.cloud3dTexture},starTexture:{value:this.pxlUtils.loadTexture(this.pxlUtils.assetRoot+"uv_starNoise.jpg")}},vertexShader:this.pxlShaders.rendering.sFieldPostProcessVert(),fragmentShader:this.pxlShaders.rendering.sFieldPostProcessFrag(),defines:{}}),"tDiffuse"),this.pxlUser.sFieldPass.enabled=!1,this.pxlUser.sFieldPass.name="sFieldPass",this.pxlUser.iZoomPass=new X(new A.ShaderMaterial({uniforms:{tDiffuse:{value:null},tDiffusePrev:{type:"t",value:null},time:{value:this.pxlTimer.msRunner},ratio:{value:this.pxlDevice.screenRes},noiseTexture:{value:this.cloud3dTexture}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.iZoomPostProcess(),defines:{}}),"tDiffuse"),this.pxlUser.iZoomPass.enabled=!1,this.pxlUser.iZoomPass.name="iZoomPass",this.chroAberrationPass=new X(new A.ShaderMaterial({uniforms:{tDiffuse:{value:null},ratio:{value:this.pxlDevice.screenRes},warpMult:{value:this.chroAberMult},chroAberUVTexture:{value:this.chroAberUVTexture},lKing:{value:this.pxlUser.lKingWarp}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.chroAberPostProcess(),defines:{}}),"tDiffuse"),this.chroAberrationPass.enabled=!1,this.chroAberrationPass.name="chroAberrationPass",this.mapComposer.addPass(this.chroAberrationPass),this.mapComposer.addPass(this.lizardKingPass),this.mapComposer.addPass(this.pxlUser.sFieldPass),this.mapComposer.addPass(this.pxlUser.iZoomPass),this.mapComposerWarpPass=new X(new A.ShaderMaterial({uniforms:{time:{value:this.pxlTimer.msRunner},fader:{value:this.warpVisualFader},tDiffuse:{value:null},noiseTexture:{value:this.cloud3dTexture},animTexture:{value:this.blockAnimTexture}},vertexShader:this.pxlShaders.core.camPosVert(),fragmentShader:this.pxlShaders.rendering.warpPostProcess(),defines:{}}),"tDiffuse"),this.mapComposerWarpPass.needsSwap=!0,this.mapComposerWarpPass.enabled=!1,this.mapComposerWarpPass.name="mapComposerWarpPass",this.mapComposer.addPass(this.mapComposerWarpPass),this.mapBoxAAPass=new X(new A.ShaderMaterial({uniforms:{tDiffuse:{value:null},resUV:{type:"f",value:this.pxlDevice.screenRes},ratio:{type:"f",value:1},gamma:{type:"f",value:this.pxlDevice.gammaCorrection}},vertexShader:this.pxlShaders.core.camPosVert(),fragmentShader:this.pxlShaders.rendering.boxAntiAliasPass(),defines:{}}),"tDiffuse"),this.mapBoxAAPass.enabled=!1,this.mapBoxAAPass.name="mapBoxAAPass",this.mapComposer.addPass(this.mapBoxAAPass),this.mapCrossAAPass=new X(new A.ShaderMaterial({uniforms:{tDiffuse:{value:null},resUV:{type:"f",value:this.pxlDevice.screenRes},ratio:{type:"f",value:1},gamma:{type:"f",value:this.pxlDevice.gammaCorrection}},vertexShader:this.pxlShaders.core.camPosVert(),fragmentShader:this.pxlShaders.rendering.crossAntiAliasPass(),defines:{}}),"tDiffuse"),this.mapCrossAAPass.enabled=!1,this.mapCrossAAPass.name="mapCrossAAPass",this.mapComposer.addPass(this.mapCrossAAPass),this.mapComposer.autoClear=!0;let i=this.roomSceneList[this.bootRoom].scene;this.roomComposer=new be(this.engine),this.roomRenderPass=new Ie(i,this.pxlCamera.camera),this.roomRenderPass.name="roomRenderPass",this.roomComposer.addPass(this.roomRenderPass),this.roomNameList.forEach(r=>{if(r!=this.mainRoom){let l=this.roomSceneList[r].applyRoomPass(this.roomComposer);l&&(l.enabled=!1,this.roomComposer.addPass(l))}}),this.roomBloomPass=new Ce(new A.Vector2(this.pxlDevice.mapW*.5,this.pxlDevice.mapH*.5),1.5,.8,.85),this.roomBloomPass.threshold=this.pxlRenderSettings.bloomThresh,this.roomBloomPass.strength=this.pxlRenderSettings.bloomStrength,this.roomBloomPass.radius=this.pxlRenderSettings.bloomRadius,this.roomBloomPass.name="roomBloomPass",this.roomComposer.addPass(this.roomBloomPass),this.roomGlowPass=new X(new A.ShaderMaterial({uniforms:{time:{value:this.pxlTimer.msRunner},ratio:{type:"f",value:1},tDiffuse:{value:null},gDiffuse:{value:this.blurComposer.writeBuffer.texture},rDiffuse:{value:this.blurComposer.renderTarget2.texture},sceneDepth:{value:this.scene.renderTarget.depthTexture}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.glowPassPostProcess(),defines:{}}),"tDiffuse"),this.roomGlowPass.needsSwap=!0,this.roomGlowPass.name="roomGlowPass",this.roomComposer.addPass(this.roomGlowPass),this.roomComposer.addPass(this.chroAberrationPass),this.roomComposer.addPass(this.lizardKingPass),this.roomComposer.addPass(this.pxlUser.sFieldPass),this.roomComposer.addPass(this.pxlUser.iZoomPass),this.roomComposer.addPass(this.mapComposerWarpPass),this.roomComposer.addPass(this.mapCrossAAPass),this.roomComposer.addPass(this.mapBoxAAPass),this.roomComposer.autoClear=!0,this.delayComposer=new be(this.engine);let s=new Ie(this.scene,this.pxlCamera.camera);this.delayPass=new X(new A.ShaderMaterial({uniforms:{tDiffuse:{value:null},roomComposer:{type:"f",value:0},tDiffusePrev:{value:this.mapComposer.renderTarget1.texture},tDiffusePrevRoom:{value:this.roomComposer.renderTarget1.texture}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.textureStorePass(),defines:{}}),"tDiffuse"),this.delayPass.clear=!1,this.delayComposer.addPass(this.delayPass),this.delayComposer.renderToScreen=!1,this.delayComposer.autoClear=!1,this.pxlUser.iZoomPass.uniforms.tDiffusePrev.value=this.delayComposer.renderTarget2.texture}setExposure(e){e=e*1,this.pxlCamera.uniformScalars.exposureUniformBase=e,this.updateCompUniforms(e)}stepWarpPass(){if(this.warpVisualActive){let e=(this.pxlTimer.curMS-this.warpVisualStartTime)/this.warpVisualMaxTime[this.pxlCamera.warpType],t=Math.min(1,e*3),i=Math.min(1,3-e*3);t==1&&i==1&&this.pxlCamera.warpActive&&this.pxlCamera.warpCamRun(),this.warpVisualFader.x=t,this.warpVisualFader.y=i,i<=0&&this.stopWarpVisual()}}checkUserVideoStatus(e){}remoteUserUpdateMedia(e,t=!1,i=null){}userRemoveRemoteData(e){}stepShaderValues(){this.stepShaderFuncArr.forEach(e=>{typeof e=="object"?e.step():typeof e=="string"&&(console.log("Does this trigger?"),console.log(e))})}stepAnimatedObjects(){this.pxlUser.itemListNames.length>0&&this.pxlUser.itemListNames.forEach(e=>{this.pxlUser.itemList[e].rotation.y=this.pxlTimer.msRunner.x*this.pxlUser.itemRotateRate})}initWarpVisual(e){this.warpVisualActive=!0,this.warpVisualFader.x=0,this.warpVisualFader.y=1,this.warpVisualStartTime=this.pxlTimer.curMS,this.mapComposerWarpPass.enabled=!0}stopWarpVisual(){this.warpVisualActive=!1,this.warpVisualFader.x=1,this.warpVisualFader.y=0,this.mapComposerWarpPass.enabled=!!this.pxlUser.iZoom}prepPortalRender(){}cleanupPortalRender(){}setPortalTexture(e,t){this.roomWarpVisuals[t].material.map=e}warpPortalQueue(){return Object.keys(this.roomSceneList).reverse()}getSceneSnapshot(e){let t=this.roomSceneList[e];this.engine.setRenderTarget(t.warpZoneRenderTarget),t.prepPortalRender(),this.engine.render(t.scene||t.scene,this.pxlCamera.camera),t.cleanupPortalRender(),this.engine.setRenderTarget(null)}mapRender(e=!0){if(this.pxlTimer.active&&this.step(),this.pxlTimer.curMS>this.nextRenderMS||e==!1){this.prevRenderMS=this.nextRenderMS,this.nextRenderMS=this.pxlTimer.curMS+this.renderInterval,this.stepShaderValues(),this.stepAnimatedObjects();let t=this.roomSceneList[this.currentRoom];t&&t.booted&&(t.step(),t.camera.layers.disable(this.renderLayerEnum.SKY),this.engine.setRenderTarget(t.scene.renderTarget),this.engine.clear(),this.engine.render(t.scene,t.camera),this.engine.setRenderTarget(null),t.camera.layers.enable(this.renderLayerEnum.SKY),this.mapComposerGlow&&(this.pxlQuality.settings.bloom||this.pxlQuality.settings.fog)&&this.mapComposerGlow.render(),this.mapRenderBlurStack(t,t.camera,t.scene,this.scene.renderGlowTarget),this.roomComposer.render()),this.pxlUser.iZoom&&this.delayComposer.render()}this.pxlTimer.active&&e&&requestAnimationFrame(()=>{this.mapRender()})}mapRenderBlurStack(e,t,i,s){if(this.blurComposer){e.geoList.GlowPass&&(e.geoList.GlowPass.forEach(u=>{if(u.userData.hasOwnProperty("GlowPerc")){let v=u.userData.GlowPerc;u.material.hasOwnProperty("uniforms")&&u.material.uniforms.mult&&(u.material.uniforms.mult.value=v)}}),e.geoList.hasOwnProperty("GlowPassMask")&&e.geoList.GlowPassMask.forEach(u=>{u.material.uniforms&&u.material.uniforms.cdMult&&(u.material.uniforms.cdMult.value=0)})),t.layers.disable(this.renderLayerEnum.SCENE),t.layers.disable(this.renderLayerEnum.PARTICLES),t.layers.disable(this.renderLayerEnum.SKY),this.engine.setRenderTarget(s);let r=0,l=i.background.clone();i.background.set(r),this.engine.setClearColor(r,0),this.engine.render(i,t),i.background.r=l.r,i.background.g=l.g,i.background.b=l.b,t.layers.enable(this.renderLayerEnum.SCENE),t.layers.enable(this.renderLayerEnum.PARTICLES),t.layers.enable(this.renderLayerEnum.SKY),this.engine.setRenderTarget(null),e.geoList.GlowPass&&(e.geoList.GlowPass.forEach(u=>{u.userData.hasOwnProperty("GlowPerc")&&u.material.hasOwnProperty("uniforms")&&u.material.uniforms.mult&&(u.material.uniforms.mult.value=1)}),e.geoList.hasOwnProperty("GlowPassMask")&&e.geoList.GlowPassMask.forEach(u=>{u.material.uniforms&&u.material.uniforms.cdMult&&(u.material.uniforms.cdMult.value=1)})),this.blurComposer.render(),this.roomBloomPass.enabled=!1}}};var Z=class{static svgPromise(e,t,i=null,s=null){let r={},l=document.getElementById(t);if(!l)return;i!=null&&l.classList.add(i);let u=this,v=Promise.resolve(ce.getURLContent(e));return v.then(p=>{l.innerHTML=p,r.svg=l.getElementsByTagName("svg")[0],s!=null&&r.svg.classList.add(s)}),r.promise=v,r}static svgRawPromise(e){let t={},i=this;return Promise.resolve(ce.getURLContent(e)).then(r=>{let l=document.createElement("div");l.innerHTML=r,t.svg=l.getElementsByTagName("svg")[0]}),t}static svgIconPromise(e,t,i,s=null,r=null){let l=this,u={};u.hover=null,u.mute=null,u.caret=null,u.indicator=null,u.waiting=[],u.state=null,u.eventType=i;let v=document.getElementById(t);if(!v)return;r?v.classList.add(r):v.classList.add("iconStyle"),u.parent=v.parentNode,u.parent.classList.add("iconHover"),u.parent.addEventListener("click",g=>{l.iconEvent("click",u,i)});let p=Promise.resolve(ce.getURLContent(e));return p.then(g=>{if(v.innerHTML=g,u.svg=v.getElementsByTagName("svg")[0],u.svg){r?u.svg.classList.add(r):u.svg.classList.add("iconStyle");let m=u.svg.children,C=u.svg.getAttribute("xmlns"),y=u.svg.getAttribute("height"),f=u.svg.getAttribute("width");for(let b=0;b<m.length;++b){let P=m[b];if(t=="speakerIcon"){let L=v.getAttribute("xmlns"),T=parseInt(y),k=parseInt(f),U=document.createElementNS(L,"rect");U.setAttribute("x",-1),U.setAttribute("y",-1),U.setAttribute("fill","white"),U.setAttribute("fill-opacity",0),U.setAttribute("height",y+2),U.setAttribute("width",f+2),U.setAttribute("z-index",-1),v.appendChild(U),u.hover=U,u.svg.setAttribute("fill-opacity",this.toggleOpacity[0])}let S=P.getAttribute("id");if(S=="mute"){u.mute=P,u.mute.style.transformOrigin="50% 50%",u.mute.style.filter="alpha(opacity=0)",u.mute.style.opacity="0",u.mute.style.transform="scale(0,0)",u.mute.style.transition="scale 1s, opacity .5s, filter .5s";let L=document.createElement("style");L.type="text/css",L.innerHTML=`
                                @keyframes loadingSpinner{
                                    0%{
                                        transform: rotate(0deg);
                                    }
                                    100%{
                                        transform: rotate(360deg);
                                    }
                                }
                            `,u.svg.appendChild(L);let T=Math.max(2,Math.min(y,f)*.25),k=f*.5,U=y*.5,j=document.createElementNS(C,"path");j.setAttribute("d",` M ${k} ${U-T} A ${T} ${T} 0 1 1 ${k-T} ${U} `),j.setAttribute("stroke","white"),j.setAttribute("stroke-width","2"),j.style.display="none",j.style.transformOrigin="50% 50%",j.style.animation="loadingSpinner 1s linear infinite",j.style.animationDuration="2s",j.style.animationPlayState="paused",u.indicator=j,u.svg.appendChild(j),this.toggleIcon(u,s)}else S=="caret"?(u.caret=P,u.caret.style.transformOrigin="50% 50%",u.caret.style.transition="transform .5s",this.flipIcon(u,!1)):S=="state"?(P.style.display="none",u.state=P):u.waiting.push(P)}let w=document.createElementNS(C,"rect");w.classList.add("iconHover"),w.setAttribute("x",0),w.setAttribute("y",0),w.setAttribute("height",y),w.setAttribute("width",f),u.svg.appendChild(w)}}),u.promise=p,u}static svgButtonPromise(e,t,i=null,s=!1,r=null){if(typeof t=="string"&&(t=document.getElementById(t),!t))return;let l=this;Promise.resolve(ce.getURLContent(e)).then(v=>{t.innerHTML=v;let p=t.getElementsByTagName("svg");if(p.length>0&&(p=p[0],i&&(i=typeof i=="string"?[i]:i,i.forEach(g=>{p.classList.add(g)})),s)){let g=p.getAttribute("xmlns"),m=parseInt(p.getAttribute("height")),C=parseInt(p.getAttribute("width")),y=document.createElementNS(g,"rect");y.setAttribute("x",-1),y.setAttribute("y",-1),y.setAttribute("fill","white"),y.setAttribute("fill-opacity",0),y.setAttribute("height",m+2),y.setAttribute("width",C+2),y.setAttribute("z-index",-1),p.appendChild(y);let f=p.getElementById("state");f&&f.setAttribute("fill-opacity",this.toggleOpacity[0]),r&&(p.onclick=w=>{l.svgCheckClick(w,r)},l.pxlDevice.mobile?(p.ontouchstart=w=>{l.svgStylize(w,!0)},p.ontouchend=w=>{l.svgStylize(w,!1)}):(p.onmouseover=w=>{l.svgStylize(w,!0)},p.onmouseout=w=>{l.svgStylize(w,!1)}))}})}};var ft=class{constructor(e,t="Metal-Asylum",i="images/assets/",s="images/GUI/"){this.projectTitle=t,this.verbose=e,this.sW=window.innerWidth,this.sH=window.innerHeight,this.mobile=!1,this.pxlFile=null,this.pxlCookie=null,this.pxlTimer=null,this.pxlAudio=null,this.pxlUtils=null,this.pxlUser=null,this.pxlDevice=null,this.pxlAutoCam=null,this.pxlCamera=null,this.pxlNavCanvas=null,this.pxlQuality=null,this.pxlEnv=null,this.assetRoot=i,this.guiRoot=s,this.introHelpActive=!0,this.branding={title:t,loader:s+".svg",logo:s+".svg",medalion:s+".svg",stack:s+".svg"},this.loaderPhrases=["Loading..."],this.lableBoxSize=40,this.optionWidthRound=10,this.optionWidthAdd=25,this.deviceOptionHeight=[0,300],this.pxlLoader=null,this.pxlLoaderCount=0,this.pxlLoaderTotal=5,this.hudBlock={obj:null,active:!1},this.userControlBlock=null,this.hudVisibility=!0,this.hudIcons={},this.hudElements={},this.guiWindows={},this.msgCount=0,this.hudMedalionBar=null,this.userProfileMessageInput=null,this.userProfileReturnMessage=null,this.userCountObj=null,this.userCountCur=0,this.messageCountObj=null,this.messageCountCur=0,this.chatMessageDisplay=null,this.chatMessageInput=null,this.camChoicesActive=!1,this.micChoicesActive=!1,this.pxlNavData={active:!1,gui:null,height:null,fpsSet:0,fps:null,dl:null,ul:null},this.djPlayerObj=null,this.buildGuiStatus={hud:!1,userTopBar:!1,bottomBar:!1,djPlayer:!1,roomControls:!1,verseList:!1,medalion:!0,loadingBranding:!1},this.requestVerseList=!1,this.verseList=[],this.verseUserCounts={},this.verseTitlePrefix="",this.verseTitleSuffix="'s Room",this.multiverseData={fromVerse:null,toVerse:null,electedVerse:null,mitosisState:!1,mitosisBufferTime:15,mitosisTime:0,mitosisUpdateTime:0},this.textDescriptions={chatIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">C</span> )</span><br>chat',pos:[1,-1.5]},multiverseIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">U</span> )</span><br>multiverse<br>selection',pos:[0,-1.3]},djPlayerVolumeParent:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">B</span> )</span><br>music volume',pos:[0,-1.5]},speakerIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">N</span> )</span><br>mute people<br>pick audio output',pos:[0,-1.5]},micIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">M</span> )</span><br>mute/pick<br>mic input',pos:[0,-1.5]},camIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">V</span> )</span><br>enable/pick<br>video input',pos:[0,-1.5]},helpIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">?</span> )</span><br>help &<br>instructions',pos:[0,-1.5]},infoIconParent:{text:'Info <span class="helpHotKeyParent">( <span class="helpHotKey">I</span> )</span>',pos:[-1,0],offset:[-10,0]},settingsIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">G</span> )</span><br>graphics &<br>navigation',pos:[0,-1.5]},muteAllIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">N</span> )</span><br>mute all users',pos:[1,0]},fullScreenIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">F</span> )</span><br>toggle full screen',pos:[-1,0]},videoQualityIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">H</span> )</span><br>video quality settings',pos:[-1,0]},statsIcon:{text:"jitsi connection status; toggle connection ",pos:[1,0]},usersIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">T</span> )</span> user moderator tools',pos:[1,0]},ft2Button:{text:"Environment",pos:[-1,0],offset:[-10,0]},ft3Button:{text:"Invite Friends",pos:[-1,0],offset:[-10,0]},hud_userCount:{text:"# of People",pos:[-1,0],offset:[-10,0]}},this.loading=!0,this.disclaimer=!1,this.mapPrompt=null,this.mapPromptBG=null,this.delayLoadChatWindow=!1,this.renderSettings=null,this.controlSettings=null,this.shaderEditorDisplay=null,this.radioControls=[],this.controlState=[!0,!1,!1,!1],this.controlToggle=[!0,!0,!1,!1],this.buttonPadding=6,this.toggleOpacity=[.6,1],this.qualityText=["Netbook","Laptop","Desktop Computer","Gamer Rig"],this.activeItem=null,this.jmaWindowVis=!1,this.actionPopUp=null,this.ctaLocalDocURL={},this.ctaContentLoading=!1,this.googleDocHTML=null,this.googleDocURL=""}setDependencies(e){this.pxlFile=e.pxlFile,this.pxlCookie=e.pxlCookie,this.pxlTimer=e.pxlTimer,this.pxlAudio=e.pxlAudio,this.pxlUtils=e.pxlUtils,this.pxlUser=e.pxlUser,this.pxlDevice=e.pxlDevice,this.pxlAutoCam=e.pxlAutoCam,this.pxlCamera=e.pxlCamera,this.pxlNavCanvas=e.pxlNavCanvas,this.pxlQuality=e.pxlQuality,this.pxlEnv=e.pxlEnv,this.mobile=e.mobile,this.renderSettings=this.pxlCookie.readCookie(this.pxlUser.renderSettingsCookie),this.controlSettings=this.pxlCookie.readCookie(this.pxlUser.controlModeCookie),e.pxlDevice.subscribe("resize",this.resize.bind(this))}init(){this.cssBuildClasses(),this.buildConsole()}prepLoader(){this.mapPromptBG=document.createElement("div"),this.mapPromptBG.classList.add("mapPromptBackgroundStyle"),document.body.appendChild(this.mapPromptBG),this.mapPrompt=document.createElement("div"),this.mapPrompt.setAttribute("id","mapPrompt"),this.mapPrompt.classList.add("mapPromptStyle"),this.mapPrompt.classList.add("fader"),this.mapPrompt.classList.add("visOn"),this.mapPrompt.innerHTML=`
            <div id="loaderLogoBranding" class='pxlLoaderLogo'></div>
            <div class='loadStyleParent'>
              <div id='pxlLoader' class='loadStyle'></div>
              <div id='pxlLoaderBackground' class='loadStyleBackground'></div>
            </div>
            <div id="loaderBranding" class='pxlLoaderTitle'>${this.projectTitle}</div>
            <div id="loaderMessage" class='pxlLoaderMessage'></div>
          `,document.body.appendChild(this.mapPrompt);let e=document.getElementById("loaderMessage");if(e){let u=this.loaderPhrases[Math.floor(Math.random()*this.loaderPhrases.length)];e.innerHTML=u}this.buildGuiStatus.loadingBranding&&Z.svgPromise(this.branding.loader,"loaderBranding","pxlLoaderTitle","loadBrandingLogo"),this.pxlLoader=document.getElementById("pxlLoader"),this.pxlLoader.style.width="2%";let t=document.createElement("div");t.classList.add("canvasCrashPromptBackgroundStyle"),document.body.appendChild(t);let i=document.createElement("div");i.classList.add("canvasCrashPromptStyle"),t.appendChild(i);let s;this.pxlQuality&&(parseInt(this.pxlQuality.detailLimit)==0?s=`Looks like your computer is having a hard time, but we\u2019ve got your fix.
          <br>Please click <a id="crashLink" class="crashLink">HERE</a> to reload ${this.projectTitle}.
          <br>If you\u2019re still having issues, drop us a line in the chat.`:s=`Looks like your computer is still having trouble, but we\u2019ve got another fix for ya.
          <br>Please click <a id="crashLink" class="crashLink">HERE</a> to reload ${this.projectTitle} again.
          <br>Again, if you\u2019re still having issues, drop us a line in the chat.`),i.innerHTML=s;let r=document.getElementById("crashLink"),l=this;r&&(r.onclick=u=>{l.crashLinkTrigger(u,l)})}stepLoader(e=""){this.pxlLoaderCount+=1;let t=Math.min(100,this.pxlLoaderCount/(this.pxlLoaderTotal-1)*100);t==100&&(this.pxlLoader.style.borderRadius="5px"),this.pxlLoader.style.width=t+"%",this.verbose>=ae.INFO&&console.log("Loader",this.pxlLoaderCount,this.pxlLoader.style.width,"; "+e)}setLoaderPhrases(e,t=!0){e&&e.length>0&&(t&&(this.loaderPhrases=[]),this.loaderPhrases=this.loaderPhrases.concat(e),this.setLoaderObjMessage())}setLoaderObjMessage(){let e=document.getElementById("loaderMessage");if(e){let t=Math.floor(Math.random()*17391.537193*this.loaderPhrases.length%this.loaderPhrases.length),i=this.loaderPhrases[t];e.innerHTML=i}}booted(){this.buildHudBlock(),this.buildTopBar(),this.buildBottomBar(),this.buildGuiWindowContainer(),this.buildUserControlBlock(),this.buildRawHtml(),this.prepPageDisplay()}step(){this.updateGuiPositions(),this.pxlUser?.checkItemWearOff(this.pxlTimer.prevMS)&&this.hideItemHud(),this.pxlNavDataUpdate()}resize(){this.sW=window.innerWidth,this.sH=window.innerHeight,this.resetHelpTextPlacement(),["videoinput","audioinput","audiooutput"].forEach(t=>{let i=null,s=null;t=="videoinput"?(i="camChoiceOptionsBlock",s=this.hudIcons.camChoiceIcon):t=="audioinput"?(i="micChoiceOptionsBlock",s=this.hudIcons.micChoiceIcon):t=="audiooutput"&&(i="speakerChoiceOptionsBlock",s=this.hudIcons.speakerChoiceIcon);let r=document.getElementById(i);if(r&&s){let l=r.getBoundingClientRect().width,u=s.parent.getBoundingClientRect();r.style.left=u.x-l*.5,r.style.bottom=this.sH-this.hudBottomBar.getBoundingClientRect().y}}),this.setUserControlPosition(),this.inviteUserPosition(),this.setArtistInfoSizing()}resetHelpTextPlacement(){Object.keys(this.textDescriptions).forEach(t=>{let i=this.textDescriptions[t];if(i){let s=document.getElementById("helpText_"+t);if(!s)return;let r=document.getElementById(t);if(r){let l=2,u=i.pos,v=i.offset?i.offset:[0,0],p=r.getBoundingClientRect(),g=s.getBoundingClientRect(),m=0,C=0,y=!1;u[1]<0?(C=p.y+g.height*u[1],y=!0):u[1]==0?C=p.y+p.height*.5-g.height*.5:u[1]>0&&(C=p.y+p.height+g.height*(u[1]-1),y=!0),y?u[0]<0?m=p.x+p.width+g.width*u[0]:u[0]==0?m=p.x+p.width*.5-g.width*.5:u[0]>0&&(m=p.x+p.width*(u[0]-1)):u[0]<0?m=p.x+g.width*u[0]:u[0]==0?m=p.x+p.width*.5-g.width*.5:u[0]>0&&(m=p.x+p.width*2*u[0]),m=m+v[0],m+g.width>this.sW-l?m=this.sW-l-g.width:m<l&&(m=l),C=C+v[1],s.style.left=m,s.style.top=C}else s.style.display="none"}})}crashLinkTrigger(e,t){let i=location.search.match(/[a-zA-Z0-9=]+/g),s="?";i.forEach(r=>{let l=r.split("=");l[0]=="dlimit"?s+=l[0]+"="+(parseInt(l[1])+1)+"&":s+=r+"&"}),location.search=s}guiToggleVisibility(e=null){if(e=e??!this.hudVisibility,this.hudVisibility=e,this.hudTopBar&&!this.hudTopBar.origDisplay&&(this.hudTopBar.origDisplay=this.hudTopBar.style.display),this.fastTravelBar&&!this.fastTravelBar.origDisplay&&(this.fastTravelBar.origDisplay=this.fastTravelBar.style.display),this.hudBottomBar&&!this.hudBottomBar.origDisplay&&(this.hudBottomBar.origDisplay=this.hudBottomBar.style.display),e){if(this.hudTopBar&&this.hudTopBar.removeAttribute("style"),this.fastTravelBar&&this.fastTravelBar.removeAttribute("style"),this.hudBottomBar&&this.hudBottomBar.removeAttribute("style"),this.userControlBlock){let t=this.userControlBlock.gui.style.top;this.userControlBlock.gui.removeAttribute("style"),this.userControlBlock.gui.style.top=t}}else this.hudTopBar&&(this.hudTopBar.style.display="none"),this.fastTravelBar&&(this.fastTravelBar.style.display="none"),this.hudBottomBar&&(this.hudBottomBar.style.display="none"),this.userControlBlock&&(this.userControlBlock.gui.style.display="none");this.hudElements.artistInfo&&(this.hudElements.artistInfo.parent.style.display=e?"grid":"none")}cssBuildClasses(){let e=document.createElement("style");e.type="text/css",e.innerHTML=`
			.fader{
				transition: opacity .8s, filter .8s;
			}
			.visOn{
				filter:alpha(opacity=100);
				opacity:1.0;
			}
			.visOff{
				filter:alpha(opacity=0);
				opacity:0.0;
			}
		`,document.getElementsByTagName("head")[0].appendChild(e)}prepPromptFader(e,t=!1){let i=e;typeof i=="string"&&(i=document.getElementById(i),!i)||(i.classList.add("fader"),i.classList.add(t?"visOn":"visOff"),i.style.display=t?"inline-block":"none")}promptFader(e,t,i=null,s=!1){typeof e=="string"&&(e=document.getElementById(e),!e)||(e.classList.value.indexOf("fader")<0&&e.classList.add("fader"),t?(e.style.display="inline-block",setTimeout(()=>{e.classList.contains("visOff")&&(e.classList.remove("visOff"),e.classList.add("visOn"),i!=null&&(e.setAttribute("fadeOut",clockTime+i*1e3),fadeOutList.push(e)))},50)):(e.classList.remove("visOn"),e.classList.add("visOff"),s?["webkitTransitionEnd","otransitionend","oTransitionEnd","msTransitionEnd","transitionend"].forEach(l=>{e.addEventListener(l,()=>{let u=e.parentNode;u&&u.removeChild(e)})}):setTimeout(()=>{e.classList.contains("visOff")&&(e.style.display="none")},1e3)))}buildConsole(){let e=document.createElement("div");e.id="consoleBlock",e.classList.add("consoleBlockStyle"),document.body.appendChild(e),this.guiWindows.consoleBlock={active:!1,gui:e}}buildMessageBlock(e,t="Info"){let i=document.createElement("div");this.msgCount++,i.id="messageBlock-"+this.msgCount,i.classList.add("messageBlockStyle"),i.classList.add("message"+t);let s=this,r=document.createElement("div");r.classList.add("messageCloseBtn"),r.innerHTML="X",r.addEventListener("click",function(){s.removeMessage(i)});let l=document.createElement("div");l.classList.add("messageTopBarStyle");let u=document.createElement("div");u.classList.add("messageHeaderStyle"),u.innerHTML=t,l.appendChild(u),l.appendChild(r),i.appendChild(l);let v=document.createElement("div");return v.classList.add("messageContentStyle"),v.innerHTML=e,i.appendChild(v),i}print(e){this.guiWindows.consoleBlock||this.buildConsole(),this.guiWindows.consoleBlock.active||(this.guiWindows.consoleBlock.active=!0,this.promptFader(this.guiWindows.consoleBlock.gui,!0));let t=this.guiWindows.consoleBlock.gui,i=this.buildMessageBlock(e);t.appendChild(i)}buildHudBlock(){if(!this.buildGuiStatus.hud)return;let e=document.createElement("div");e.id="hudBlock",e.classList.add("hudBlockStyle"),this.hudBlock.obj=e,document.body.appendChild(this.hudBlock.obj),this.hudBlock.obj.style.display="none";let t=this;this.hudBlock.obj.addEventListener("click",i=>{t.toggleHudBlock(!1,!0)})}toggleHudBlock(e=null,t=!1){if(!this.hudBlock)return;e=e??!this.hudBlock.active,this.hudBlock.active=e;let i=!1;e?i="inline-block":this.checkOpenWindows(t)||(i="none",this.pxlNavCanvas&&this.pxlNavCanvas.focus()),this.hudBlock.obj&&this.hudBlock.obj.style&&i!=!1&&(this.hudBlock.obj.style.display=i)}checkOpenWindows(e=!1){let t=Object.keys(this.guiWindows),i=!1;return t.forEach(s=>{s!="chatBoxGui"&&(e&&(this.guiWindows[s].button&&this.flipIcon(this.guiWindows[s].button,!1),this.guiWindows[s].gui&&this.guiWindows[s].active&&(this.guiWindows[s].active=!1,this.promptFader(this.guiWindows[s].gui,!1),s=="settingsGui"&&this.togglePxlNavDataDisplay(!1))),i=i||this.guiWindows[s].active)}),i}checkFocus(e=null,t=null){t===!0&&this.guiWindows.inviteUserGui&&this.guiWindows.inviteUserGui.active&&this.toggleInviteUser(!1)}buildRawHtml(){}buildTopBar(){if(this.mobile||!this.buildGuiStatus.userTopBar)return;let e=document.createElement("div");e.id="hud_topBar",e.classList.add("hud_topBarBlockStyle"),this.hudTopBar=e,document.body.appendChild(this.hudTopBar);let t="";t='<div id="statsIcon"></div>',t+=`</div>
		<div id="usersIconParent">
			<div id="usersIcon"></div>`;let i;i=`
			<div id="hud_localVideoStyle" class="hud_localVideoStyle"></div>
			<div id="hud_topBarParent" class="hud_topBarParentStyle">
		<div id="statsIconParent">
			${t}
		</div>
		<div  class="hud_topBarVSpacerStyle"></div>
			</div>
		`,e.innerHTML=i,this.hudIcons.statsIcon=Z.svgIconPromise(`${this.guiRoot}icons/icon_stats.svg`,"statsIcon","stats"),this.hudIcons.statsIcon.promise.finally(()=>{}),this.hudIcons.usersIcon=Z.svgIconPromise(`${this.guiRoot}icons/icon_user.svg`,"usersIcon","users");let s=document.createElement("div");s.id="hud_pxlNavData",s.classList.add("hud_pxlNavDataParentStyle"),e.appendChild(s),this.pxlNavData.gui=s;let r=document.createElement("div");r.id="hud_pxlNavData",r.classList.add("hud_pxlNavDataStyle"),s.appendChild(r),i=`
      <div class="hud_pxlNavData_FPS gui_boldText">FPS</div><div class="hud_pxlNavData_FPS">:</div><div id="hud_pxlFPS" class="hud_pxlNavData_FPS"> - </div>
      <div class="hud_pxlNavData_UL gui_boldText">\u2191</div><div class="hud_pxlNavData_UL">:</div><div id="hud_pxlUL" class="hud_pxlNavData_UL"> - </div>
      <div class="hud_pxlNavData_DL gui_boldText">\u2193</div><div class="hud_pxlNavData_DL">:</div><div id="hud_pxlDL" class="hud_pxlNavData_DL"> - </div>
    `,r.innerHTML=i,this.pxlNavData.fps=document.getElementById("hud_pxlFPS"),this.pxlNavData.ul=document.getElementById("hud_pxlUL"),this.pxlNavData.dl=document.getElementById("hud_pxlDL")}buildUserControlBlock(){this.userControlBlock={},this.userControlBlock.activeList=[],this.userControlBlock.userList={},this.userControlBlock.mutedList=[];let e=document.createElement("div");e.classList.add("userControlBlockStyle"),document.body.appendChild(e),this.userControlBlock.gui=e,this.userControlBlock.speakerIcon=null}buildMedalionBar(){if(this.buildGuiStatus.medalion){let e=document.createElement("div");e.id="hud_medalionBar",e.classList.add("hud_medalionIconBlockStyle"),this.hudMedalionBar=e,document.body.appendChild(this.hudMedalionBar);let t=`
        <div id="medalionIconParent" class="hud_speakerIconStyle">
          <div id="medalionIcon"></div>
        </div>
        <div id="medalionTitle" class="medalionTitleStyle">${this.branding.title}</div>
      `;this.hudMedalionBar.innerHTML=t;let i=document.getElementById("medalionIcon"),s=document.getElementById("medalionTitle");i.addEventListener("mouseover",()=>{s.classList.add("medalionTitleGrowStyle")}),i.addEventListener("mouseout",()=>{s.classList.remove("medalionTitleGrowStyle")}),this.hudIcons.medalionIcon=Z.svgIconPromise(this.branding.medalion,"medalionIcon","info",null,"medalionStyle")}}buildBottomBar(){if(!this.buildGuiStatus.bottomBar)return;let e=document.createElement("div");e.id="hud_bottomBar",e.classList.add("hud_bottomBarStyle"),this.hudBottomBar=e,document.body.appendChild(this.hudBottomBar);let t="";if(t+=`
    <div id="hud_chatIconBlock" class="hud_bottomLeftBlockStyle">
        <div id="settingsIconParent" class="hud_settingsIconStyle">
          <object id="settingsIcon"></object>
        </div>
  <div></div>
        <div id="helpIconParent" class="hud_helpIconStyle">
          <object id="helpIcon"></object>
        </div>
        `,!this.mobile&&this.buildGuiStatus.verseList&&(t+=`<div class="hud_usersIconStyle">
            <div id="multiverseIcon"></div>
          </div>
          <div></div>`),t+="</div>",this.mobile||(t+=`
        <div class="hud_micCamIconsBlockStyle">
          <div id="speakerIconParent" class="hud_speakerIconStyle">
            <div id="speakerIcon"></div>
          </div>
          <div id="speakerChoiceIconParent" class="hud_speakerChoiceIconStyle">
            <div id="speakerChoiceOptionsBlock" class="gui_iconButtonPopup">
            </div>
            <div id="speakerChoiceIconParent">
              <div id="speakerChoiceIcon" class="iconCaretStyle"></div>
            </div>
          </div>
          <div class="hud_micCamSpacerStyle"></div>
          <div id="micIconParent" class="hud_micIconStyle">
            <div id="micIcon"></div>
          </div>
          <div id="micChoiceIconParent" class="hud_micChoiceIconStyle">
            <div id="micChoiceOptionsBlock" class="gui_iconButtonPopup">
            </div>
            <div id="camChoiceIconParent">
              <div id="micChoiceIcon" class="iconCaretStyle"></div>
            </div>
          </div>
          <div class="hud_micCamSpacerStyle"></div>
          <div id="camIconParent" class="hud_camIconStyle">
            <div id="camIcon"></div>
          </div>
          <div id="camChoiceIconBlock" class="hud_camChoiceIconStyle">
            <div id="camChoiceOptionsBlock" class="gui_iconButtonPopup">
            </div>
            <div id="camChoiceIconParent">
              <div id="camChoiceIcon" class="iconCaretStyle"></div>
            </div>
          </div>
        </div>
        
        <div id="hud_helpInfoSettingsBlock" class="hud_helpInfoSettingsBlockStyle">
          <div class="guiVerseHudTitle">
            <span id="guiVerseTitle"></span>
          </div>
          <div></div>
          <div id="chatIconParent" class="hud_chatIconStyle">
            <div id="chatIcon"></div>
          </div>
          <div id="hud_messageCount" class="hud_userCountStyle hud_messageCountBaseStyle">0</div>
        </div>
      `),this.hudBottomBar.innerHTML=t,this.messageCountObj=document.getElementById("hud_messageCount"),this.hudIcons.chatIcon=Z.svgIconPromise(`${this.guiRoot}icons/icon_chat.svg`,"chatIcon","chat"),!this.mobile&&!this.pxlAutoCam.enabled){this.hudIcons.multiverseIcon=Z.svgIconPromise(`${this.guiRoot}icons/icon_multiverse.svg`,"multiverseIcon","multiverse"),this.hudIcons.speakerIcon=Z.svgIconPromise(`${this.guiRoot}icons/icon_ProxAudio.svg`,"speakerIcon","speakerToggle",!1),this.hudIcons.speakerChoiceIcon=Z.svgIconPromise(`${this.guiRoot}icons/icon_downcaret.svg`,"speakerChoiceIcon","speakerChoice",!1,"iconCaretStyle"),this.hudIcons.micIcon=Z.svgIconPromise(`${this.guiRoot}icons/icon_mic.svg`,"micIcon","micToggle",!1),this.hudIcons.micChoiceIcon=Z.svgIconPromise(`${this.guiRoot}icons/icon_downcaret.svg`,"micChoiceIcon","micChoice",!1,"iconCaretStyle"),this.hudIcons.camIcon=Z.svgIconPromise(`${this.guiRoot}icons/icon_camera.svg`,"camIcon","camToggle",!1),this.hudIcons.camChoiceIcon=Z.svgIconPromise(`${this.guiRoot}icons/icon_downcaret.svg`,"camChoiceIcon","camChoice",!1,"iconCaretStyle"),this.hudIcons.helpIcon=Z.svgIconPromise(`${this.guiRoot}icons/icon_help.svg`,"helpIcon","help"),this.hudIcons.settingsIcon=Z.svgIconPromise(`${this.guiRoot}icons/icon_settings.svg`,"settingsIcon","settings");let i=document.getElementById("guiVerseTitle"),s=this}else{let i=document.getElementById("hud_chatIconBlock");i.style.gridAutoColumns="max-content max-content auto max-content",i.style.margin="0px 10px"}}prepArtistInfo(e=null){if(!(!this.pxlEnv?.postIntro||e=="")){if(!this.hudElements.artistInfo){this.hudElements.artistInfo={},this.hudElements.artistInfo.active=!1;let t=document.createElement("div");t.classList.add("hud_aristInfoParentStyle"),this.hudElements.artistInfo.parent=t;let i=document.createElement("div");i.classList.add("hud_aristInfoButtonStyle"),t.appendChild(i);let s=this;i.onclick=()=>{s.toggleArtistInfo()},this.hudElements.artistInfo.button=i;let r=document.createElement("div");r.classList.add("hud_aristInfoButtonTextStyle"),r.innerHTML="artwork info&nbsp;&nbsp;",i.appendChild(r),this.hudElements.artistInfo.buttonText=r;let l=document.createElement("div");l.classList.add("hud_aristInfoCarrotXStyle"),l.id="artistInfoCarrotX",i.appendChild(l);let u=document.createElement("div");u.classList.add("hud_aristInfoInner"),u.innerHTML=e,t.appendChild(u),this.hudElements.artistInfo.inner=u,document.body.appendChild(t),this.hudElements.artistInfo.closeSvg=Z.svgPromise(`${this.guiRoot}global/carrotCloseAnimate.svg`,"artistInfoCarrotX"),this.hudElements.artistInfo.closeSvg.promise.finally(()=>{this.artistInfoButtonPrep()})}this.toggleArtistInfo(!1),e!=null&&this.hudVisibility&&!this.pxlAutoCam.active?(this.hudElements.artistInfo.parent.style.zIndex=155,this.hudElements.artistInfo.parent.style.display="grid",this.hudElements.artistInfo.inner.innerHTML=e,setTimeout(()=>{this.setArtistInfoSizing()},20)):(this.hudElements.artistInfo.parent.style.zIndex=-5,this.hudElements.artistInfo.parent.style.display="none")}}artistInfoButtonPrep(e=0){let t=this.hudElements.artistInfo.closeSvg.svg;if(t){let i=t.getElementById("carrotToClone_on"),s=t.getElementById("carrotToClone_off");i&&s?(this.hudElements.artistInfo.onAnim=i,this.hudElements.artistInfo.offAnim=s):e==2||setTimeout(()=>{this.artistInfoButtonPrep(e+=1)},100)}}setArtistInfoSizing(){if(this.hudElements.artistInfo){let e=this.hudElements.artistInfo.inner.clientHeight,t=this.hudElements.artistInfo.inner.clientWidth,i=this.hudElements.artistInfo.button.clientHeight,s=this.hudElements.artistInfo.button.clientWidth;this.hudElements.artistInfo.innerHeight=e,this.hudElements.artistInfo.innerWidth=t,this.hudElements.artistInfo.baseHeight=i,this.hudElements.artistInfo.baseWidth=s,this.hudElements.artistInfo.parent.style.height=e+"px",this.hudElements.artistInfo.parent.style.width=t+"px";let r=this.hudElements.artistInfo.buttonText.clientWidth;this.hudElements.artistInfo.buttonText.maxWidth=r,this.hudElements.artistInfo.buttonText.style.maxWidth=r+"px",this.toggleArtistInfo(this.hudElements.artistInfo.active)}}toggleArtistInfo(e=null){e=e??!this.hudElements.artistInfo.active,this.hudElements.artistInfo.active=e;let t=this.hudElements.artistInfo.innerHeight,i=Math.min(this.pxlDevice.sW*.3,this.hudElements.artistInfo.innerWidth),s=this.hudElements.artistInfo.baseHeight,r=this.hudElements.artistInfo.baseWidth;this.hudElements.artistInfo.parent.style.maxHeight=e?t+"px":s+"px",this.hudElements.artistInfo.parent.style.maxWidth=e?i+"px":r+"px",this.hudElements.artistInfo.parent.style.padding=e?"5px":"0px";let l=this.hudElements.artistInfo.buttonText.maxWidth;this.hudElements.artistInfo.buttonText.style.maxWidth=e?"0px":l+"px",this.hudElements.artistInfo.buttonText.style.opacity=e?"0":"1",this.hudElements.artistInfo.buttonText.style.filter="alpha(opacity="+(e?"0":"1000")+")",this.hudElements.artistInfo.inner.style.opacity=e?"1":"0",this.hudElements.artistInfo.inner.style.filter="alpha(opacity="+(e?"100":"0")+")",this.hudElements.artistInfo.onAnim&&(e?this.hudElements.artistInfo.onAnim.beginElement():this.hudElements.artistInfo.offAnim.beginElement())}prepPageDisplay(e=null){if(!(!this.pxlEnv?.postIntro||e=="")){if(!this.hudElements.artistInfo){this.hudElements.artistInfo={},this.hudElements.artistInfo.active=!1;let t=document.createElement("div");t.classList.add("hud_aristInfoParentStyle"),this.hudElements.artistInfo.parent=t;let i=document.createElement("div");i.classList.add("hud_aristInfoButtonStyle"),t.appendChild(i);let s=this;i.onclick=()=>{s.togglePageDisplay()},this.hudElements.artistInfo.button=i;let r=document.createElement("div");r.classList.add("hud_aristInfoButtonTextStyle"),r.innerHTML="artwork info&nbsp;&nbsp;",i.appendChild(r),this.hudElements.artistInfo.buttonText=r;let l=document.createElement("div");l.classList.add("hud_aristInfoCarrotXStyle"),l.id="artistInfoCarrotX",i.appendChild(l);let u=document.createElement("div");u.classList.add("hud_aristInfoInner"),u.innerHTML=e,t.appendChild(u),this.hudElements.artistInfo.inner=u,document.body.appendChild(t)}this.togglePageDisplay(!1),e!=null&&this.hudVisibility&&!this.pxlAutoCam.active?(this.hudElements.artistInfo.parent.style.zIndex=155,this.hudElements.artistInfo.parent.style.display="grid",this.hudElements.artistInfo.inner.innerHTML=e,setTimeout(()=>{this.setArtistInfoSizing()},20)):(this.hudElements.artistInfo.parent.style.zIndex=-5,this.hudElements.artistInfo.parent.style.display="none")}}setPageToDisplay(){if(this.hudElements.artistInfo){let e=this.hudElements.artistInfo.inner.clientHeight,t=this.hudElements.artistInfo.inner.clientWidth,i=this.hudElements.artistInfo.button.clientHeight,s=this.hudElements.artistInfo.button.clientWidth;this.hudElements.artistInfo.innerHeight=e,this.hudElements.artistInfo.innerWidth=t,this.hudElements.artistInfo.baseHeight=i,this.hudElements.artistInfo.baseWidth=s,this.hudElements.artistInfo.parent.style.height=e+"px",this.hudElements.artistInfo.parent.style.width=t+"px";let r=this.hudElements.artistInfo.buttonText.clientWidth;this.hudElements.artistInfo.buttonText.maxWidth=r,this.hudElements.artistInfo.buttonText.style.maxWidth=r+"px",this.toggleArtistInfo(this.hudElements.artistInfo.active)}}togglePageDisplay(e=null){if(this.hudElements.artistInfo){e=e??!this.hudElements.artistInfo.active,this.hudElements?.artistInfo&&(this.hudElements.artistInfo.active=e);let t=this.hudElements.artistInfo.innerHeight,i=Math.min(this.pxlDevice.sW*.3,this.hudElements.artistInfo.innerWidth),s=this.hudElements.artistInfo.baseHeight,r=this.hudElements.artistInfo.baseWidth;this.hudElements.artistInfo.parent.style.maxHeight=e?t+"px":s+"px",this.hudElements.artistInfo.parent.style.maxWidth=e?i+"px":r+"px",this.hudElements.artistInfo.parent.style.padding=e?"5px":"0px";let l=this.hudElements.artistInfo.buttonText.maxWidth;this.hudElements.artistInfo.buttonText.style.maxWidth=e?"0px":l+"px",this.hudElements.artistInfo.buttonText.style.opacity=e?"0":"1",this.hudElements.artistInfo.buttonText.style.filter="alpha(opacity="+(e?"0":"1000")+")",this.hudElements.artistInfo.inner.style.opacity=e?"1":"0",this.hudElements.artistInfo.inner.style.filter="alpha(opacity="+(e?"100":"0")+")",this.hudElements.artistInfo.onAnim&&(e?this.hudElements.artistInfo.onAnim.beginElement():this.hudElements.artistInfo.offAnim.beginElement())}}iconEvent(e,t,i=null){if(this.hudBlock.obj&&(this.hudBlock.obj.style.display="none"),e=="click"){if(i=="chat"){this.toggleChatBox();return}else if(i=="musicToggle"){this.pxlAudio.djPlayerMuteToggle(),this.toggleIcon(t,!this.pxlAudio.djMuted,!0);return}else if(i=="userSpeakerToggle"){this.setUserControls(t);return}else if(i=="speakerToggle"){this.toggleIcon(t,!1,!0);return}else if(i=="speakerChoice"){let s="audiooutput";this.flipIcon(t,this.guiWindows[s]&&this.guiWindows[s].active);return}else if(i=="help"){let s=this.guiWindows.helpGui?this.guiWindows.helpGui.active:!1;this.checkOpenWindows(!0),this.helpGuiToggle(!s);return}else if(i=="info"){let s=this.guiWindows.infoGui?this.guiWindows.infoGui.active:!1;this.checkOpenWindows(!0),this.infoGuiToggle(!s);return}else if(i=="settings"){let s=this.guiWindows.settingsGui?this.guiWindows.settingsGui.active:!1;this.checkOpenWindows(!0),this.settingsGuiToggle(!s);return}else if(i=="userProfile"){this.toggleUserProfile();return}else if(i!="users"){if(i=="stats")return}}}setMicVolumeLevel(e){this.hudIcons.micIcon.volumeMask||(this.hudIcons.micIcon.volumeMask=document.getElementById("gui_micVolumeMask"),this.hudIcons.micIcon.timer=this.pxlTimer.msRunner.x-1);let t=12-e*11;this.hudIcons.micIcon.volumeMask.setAttribute("y",t)}toggleIcon(e,t,i=!1){if(e){if(e.mute.style.filter=t?"alpha(opacity=0)":"alpha(opacity=100)",e.mute.style.opacity=t?"0":"1",e.mute.style.transform=t?"scale(0,0)":"scale(1,1)",["camToggle","speakerToggle"].includes(e.eventType))return;let r={speakerToggle:"speaker",micToggle:"audio",camToggle:"video"}[e.eventType];r&&i&&this.loadingDeviceChange(r,t)}}flipIcon(e,t){e.caret.style.transform=`rotate( ${t?"180deg":"0deg"} )`}loadingDeviceChange(e,t=!0){let i=null;e=="speaker"?i=this.hudIcons.speakerIcon:e=="audio"?i=this.hudIcons.micIcon:e=="video"&&(i=this.hudIcons.camIcon),i.indicator.style.display=t?"inline-block":"none",i.indicator.style.animationPlayState=t?"running":"paused",i.waiting.forEach(s=>{s.setAttribute("fill-opacity",t?".5":"1")}),t&&setTimeout(()=>{this.loadingDeviceChange(e,!1)},1e3)}djBuildPlayer(){if(this.buildGuiStatus.djPlayer){this.djPlayerObj=document.createElement("div"),this.djPlayerObj.id="djPlayer";let e=`
          <audio id="djStream" playsinline muted>
            <source src="`+this.pxlAudio.djUrlSource+`"></source>
          </audio>
          <table cellpadding=0 cellspacing=5 border=0 style="height:100%;"><tbody><tr>
              <td align="left">
                  <div id="djPlayerVol"></div>
              <  d><td valign="center" align="left" width=100%>
                  <div id="djPlayerVolumeParent" class="volParent"><div id="djPlayerVolume" class="volSlider"></div></div>
              <  d><  r>
          <  body><  able>`;this.djPlayerObj.innerHTML=e,document.getElementById("musicControllerBlock").appendChild(this.djPlayerObj),this.hudIcons.musicIcon=Z.svgIconPromise(`${this.guiRoot}icons/icon_music.svg`,"djPlayerVol","musicToggle",!this.pxlAudio.djMuted),this.pxlAudio.djBuildPlayer()}}buildItemHud(e,t){this.activeItem.innerHTML=t,this.activeItem.style.opacity="1",this.activeItem.style.filter="alpha(opacity=100)",this.activeItem.style.textShadow="1px 1px 3px #000000",setTimeout(()=>{this.activeItem.style.fontSize="1.5em",this.activeItem.style.top=".5%",this.activeItem.style.right="140px",this.activeItem.style.transform="translateX(0%)"},1500)}hideItemHud(){this.activeItem.innerHTML="",this.activeItem.style.fontSize="3em",this.activeItem.style.top="10%",this.activeItem.style.right="50%",this.activeItem.style.transform="translateX(50%)",this.activeItem.style.opacity="0",this.activeItem.style.filter="alpha(opacity=0)"}mapPrepPrompts(){this.activeItem=document.createElement("div"),this.activeItem.classList.add("activeItemStyle"),document.body.appendChild(this.activeItem)}updateGuiPositions(){if(this.loading){let e=this.radioControls.length,t=!1;for(let i=0;i<e;++i){if(!this.radioControls[i][3]){t=!0;break}let s=this.radioControls[i][0],l=this.radioControls[i][2].getBoundingClientRect(),u=l.width+this.buttonPadding*2,v=l.height+this.buttonPadding*2,p=l.top-this.buttonPadding,g=l.left-this.buttonPadding;s.style.width=u,s.style.height=v,s.style.top=p,s.style.left=g,this.radioControls[i][1].style.width=u,this.radioControls[i][1].style.height=v,this.radioControls[i][1].style.top=p,this.radioControls[i][1].style.left=g}this.loading=t}}togglGuiWindow(e=null,t=!1){e=="helpGui"?this.helpGuiToggle(t,!1):e=="infoGui"?this.infoGuiToggle(t,!1):e=="settingsGui"&&this.settingsGuiToggle(t,!1)}svgCheckClick(e=null,t=null){if(t)if(t=="close"){this.toggleGuiWindowContainer(null,!1,!0);return}else{if(t=="ft1")return;if(t=="ft2")return;if(t=="ft3"){this.toggleInviteUser();return}else{if(t=="ft4")return;if(t=="ft5"){this.pxlAutoCam.toggleAutoCam();return}}}}svgStylize(e=null,t=!1){if(!e)return;let i=e.path?e.path[1]:e.target.parentNode,s=i.getElementById("state");if(s){let l=t?"white":"none";s.setAttribute("fill",l)}let r=i.getElementById("hover");r&&r.setAttribute("fill",color)}renderQualitySettings(e){this.pxlQuality.percent=e,this.pxlQuality.screenResPerc=e*.75+.25,this.pxlQuality.mapAutoQualityUpdate(e,!0),this.pxlDevice.resizeRenderResolution()}pxlNavDataUpdate(){this.pxlNavData.active&&this.pxlTimer.msRunner.x>this.pxlNavData.fpsSet&&(this.pxlNavData.fpsSet=this.pxlTimer.msRunner.x+1,this.pxlNavData.fps.innerText=parseInt(1/this.pxlTimer.msRunner.y))}buildGuiWindowContainer(){let e=document.createElement("div");e.classList.id="guiWindowBackground",e.classList.add("guiWindowBackground"),e.classList.add("fader"),e.classList.add("visOff"),e.style.display="none";let t=this;e.onclick=i=>{t.toggleGuiWindowContainer(i,!1,!0)},this.guiWindowBG=e,document.body.appendChild(e)}toggleGuiWindowContainer(e,t,i=!1){if(e){let l=(e.path?e.path[0]:e.target).getAttribute("id");if(l!="guiWindowBackground"&&!["gui_helpGuiWindow","gui_helpContent","gui_infoGuiWindow","gui_infoContent","gui_settingsGuiWindow","gui_settingsContent"].includes(l))return null}let s=this.checkOpenWindows(i);this.guiWindowBG&&s==t&&this.promptFader(this.guiWindowBG,t,null,!1),t?this.pxlNavCanvas.blur():this.pxlNavCanvas.focus()}helpGuiBuild(){this.guiWindows.helpGui={},this.guiWindows.helpGui.gui=null,this.guiWindows.helpGui.active=!1;let e=document.createElement("div");e.id="gui_helpGuiWindow",e.classList.add("gui_helpGuiParentStyle"),this.prepPromptFader(e),this.guiWindowBG.appendChild(e);let t="";t+=`
    <div id="gui_helpContent" class="gui_contentStyle">
  <div class="gui_body">
    <div id="gui_helpGui_keyboardParent" class="gui_helpGui_keyboardParent">
    <div id="gui_helpGui_controlsKeyboard" class="guiPadding settings_sectionHeader">keyboard controls</div>
    <div class="gui_helpGui_ASDWorUDLR">
      <div id="gui_helpGui_asdw" class="gui_helpGui_asdw"></div>
      <div id="gui_helpGui_or" class="gui_helpGui_text">or</div>
      <div id="gui_helpGui_udlr" class="gui_helpGui_udlr"></div>
    </div>
    <div id="gui_helpGui_useKeys" class="gui_helpGui_text" style="display:inline-block;">Use your keyboard <span class="gui_boldText">ARROWS</span> or<br><span class="gui_boldText">AWSD</span> keys to move around</div>
    </div>
    <div id="gui_helpGui_mouse" class="gui_helpGui_mouse">
    <div id="gui_helpGui_MouseControls" class="guiPadding settings_sectionHeader">mouse controls</div>
    <div id="gui_helpGui_MouseOutlined" class="gui_helpGui_mouseOutline"></div>
    <div id="gui_helpGui_useMouse" class="guiPadding gui_helpGui_text" style="display:inline-block;">To orient your view:<br><span class="gui_boldText">LEFT CLICK</span> and drag your mouse<br><span class="gui_boldText">RIGHT CLICK</span> to lock your mouse</div>
    </div>
  </div>
  <div id="gui_helpGui_hotKeys" class="gui_helpGui_hotKeys">
          You can change <span class="gui_boldText">Navigation</span> and <span class="gui_boldText">Look controls</span> in the <span class="gui_boldText">Settings</span> <span id="gui_helpGui_settingIcon"></span> menu
        </div>
  <div id="guiHelpFooter" class="gui_footer">
    <div class="guiButton" id="guiHelpBackButton">close</div>
  </div>
  <div class="gui_spacer"></div>
    </div>
  `,e.innerHTML=t,[[this.guiRoot+"keyboard/asdw.svg","gui_helpGui_asdw","guiKeyDispSVG",!1],[this.guiRoot+"keyboard/udlr.svg","gui_helpGui_udlr","guiKeyDispSVG",!1],[this.guiRoot+"mouse/MouseOutlined.svg","gui_helpGui_MouseOutlined","guiMouseDispSVG",!1]].forEach(v=>{Z.svgButtonPromise(...v)});let s=this,r=document.getElementById("guiHelpBackButton");r.onclick=v=>{s.introHelpActive&&(s.introHelpActive=!1,s.pxlEnv.postHelpIntro()),s.svgCheckClick(v,"close")},Object.keys(this.textDescriptions).forEach(v=>{let p=this.textDescriptions[v];if(p){let g=p.text,m=p.pos,C=document.createElement("div");C.id="helpText_"+v,C.classList.add("helpTextDescriptionParent"),C.innerHTML=g,e.appendChild(C),this.textDescriptions[v].obj=C}});let u=document.getElementById("gui_helpGui_settingIcon");u&&this.hudIcons.settingsIcon&&(u.innerHTML=this.hudIcons.settingsIcon.svg.parentNode.innerHTML,u.style.position="relative",u.style.top="7.3px",u.style.width="30px",u.style.padding="2px",u.style.cursor="pointer",u.children[0].style.height="26px",u.onclick=()=>{s.iconEvent("click",null,"settings")}),this.guiWindows.helpGui.gui=e,setTimeout(()=>{this.resize()},50)}helpGuiToggle(e=null,t=!0){this.guiWindows.helpGui||this.helpGuiBuild(),e=e??!this.guiWindows.helpGui.active,this.guiWindows.helpGui.active=e,this.promptFader(this.guiWindows.helpGui.gui,e),this.toggleGuiWindowContainer(null,e),this.hudBlock.active&&this.toggleHudBlock(e),this.introHelpActive&&!e&&(this.introHelpActive=!1,this.pxlEnv.postHelpIntro()),setTimeout(()=>{this.resetHelpTextPlacement()},20)}infoGuiBuild(){this.guiWindows.infoGui={},this.guiWindows.infoGui.gui=null,this.guiWindows.infoGui.active=!1;let e=document.createElement("div");e.id="gui_infoGuiWindow",e.classList.add("gui_infoGuiParentStyle"),this.prepPromptFader(e),this.guiWindowBG.appendChild(e);let t="";t+=`
    <div id="gui_infoContent" class="gui_contentInfoStyle">
  <div class="gui_infoBody">
    <div id="gui_infoGuiParent" class="gui_infoGuiParent">
    <br>${this.projectTitle}, created by <a href="https://www.theumbrella.nyc/">The Umbrella</a>,
    <br>an experience design collective.
    <br>
    <br>Want to chat?
    <br><a href="mailto:info@theumbrella.nyc">info@theumbrella.nyc</a>
    <br>
    <br>We\u2019re in active development. Get in touch if you have any issues.
    <br>
    </div>
  </div>
  <div id="guiInfoFooter" class="gui_footer">
    <div class="guiButton" id="guiInfoBackButton">close</div>
  </div>
    </div>
  `,e.innerHTML=t;let i=this,s=document.getElementById("guiInfoBackButton");s.onclick=r=>{i.svgCheckClick(r,"close")},this.guiWindows.infoGui.gui=e}infoGuiToggle(e=null,t=!0){this.guiWindows.infoGui||this.infoGuiBuild(),e=e??!this.guiWindows.infoGui.active,this.guiWindows.infoGui.active=e,this.promptFader(this.guiWindows.infoGui.gui,e),this.toggleGuiWindowContainer(null,e),this.hudBlock.active&&this.toggleHudBlock(e),this.introHelpActive&&!e&&(this.introHelpActive=!1,this.pxlEnv.postHelpIntro())}applyCookies(){this.controlSettings&&(console.log(this.controlSettings),this.controlSettings=this.controlSettings),this.renderSettings&&(console.log(this.renderSettings),this.renderSettings=this.renderSettings)}settingsGuiBuild(){this.guiWindows.settingsGui={},this.guiWindows.settingsGui.gui=null,this.guiWindows.settingsGui.active=!1;let e=document.createElement("div");e.id="gui_settingsGuiWindow",e.classList.add("gui_settingsGuiParentStyle"),this.prepPromptFader(e),this.guiWindowBG.appendChild(e);let t="Default";t=t||"";let i=`
    <div id="gui_settingsContent" class="gui_contentSettingsStyle">
  <div class="gui_settingsBody">
    <div class="gui_settingsParentGrid">
      <!-- -- Username -- -- -->
    <div class="cellMargin settings_icon" id="settings_user"></div>
    <div class="settings_optionHeader">Username</div>
    <div class="settings_radio" style="grid-auto-flow: row; justify-content: start;">
                    <div id="guiuserProfileBoxFieldParent" class="gui_userProfileBoxFieldParentStyle">
                      <input type="text" placeholder="Set your username" value="${t}" id="settings_usernameInput" class="settings_usernameInput"></input>
                      <input type="button" value="Set" id="settings_sendUsername" class="sendUsername">
                    </div>
                    <div id="settings_usernameResponseMessage" class="usernameResponseMessageStyle"></div>
                </div>
      <!-- -- -- -- -- -- -->
    <div class="settingsGridSpan settingsSpacer"></div>
      <!-- -- Left/Right -- -- -->
    <div class="cellMargin settings_icon" id="settings_left_right"></div>
    <div class="settings_optionHeader">Left/Right</div>
    <div class="settings_radio" id="settingsRadioBlock_leftRight">
      <span>
      <input type="radio" id="settings_tankTurning" name="settings_leftRight" value="0" hidden>
      <label for="settings_tankTurning">Turn</label>
      </span>
      <span>
      <input type="radio" id="settings_strafing" name="settings_leftRight" value="1" hidden>
      <label for="settings_strafing">Strafe</label>
      </span>
    </div>
      <!-- -- Mouse -- -- -->
    <div class="cellMargin settings_icon" id="settings_mouse"></div>
    <div class="settings_optionHeader">Mouse Looking</div>
    <div class="settings_radio" id="settingsRadioBlock_mouse">
      <span>
      <input type="radio" id="settings_dragLooking" name="settings_mouse" value="0" hidden>
      <label for="settings_dragLooking">Native</label>
      </span>
      <span>
      <input type="radio" id="settings_pointLooking" name="settings_mouse" value="1" hidden>
      <label for="settings_pointLooking">Inverted</label>
      </span>
    </div>
      <!-- -- -- -- -- -- -->
    <div class="settingsGridSpan settingsSpacer"></div>
      <!-- -- Graphics Quality -- -- -->
    <div class="cellMargin settings_icon" id="settings_graphics"></div>
    <div class="settings_optionHeader">Graphics Quality</div>
    <div class="settings_radio" id="settingsRadioBlock_graphics">
      <span>
      <input type="radio" id="settings_graphicsQuality_low" name="settings_autoQuality" value="0" hidden>
      <label for="settings_graphicsQuality_low">Low</label>
      </span>
      <span>
      <input type="radio" id="settings_graphicsQuality_med" name="settings_autoQuality" value="1" hidden>
      <label for="settings_graphicsQuality_med">Medium</label>
      </span>
      <span>
      <input type="radio" id="settings_graphicsQuality_high" name="settings_autoQuality" value="2" hidden>
      <label for="settings_graphicsQuality_high">High</label>
      </span>
      <span>
      <input type="radio" id="settings_graphicsQuality_custom" name="settings_autoQuality" value="3" hidden>
      <label for="settings_graphicsQuality_custom">Custom</label>
      </span>
    </div>
      <!-- -- -- -- -->
      <div class="r7Adv gui_settingsAdvancedParentGrid" id="gui_advancedSettings">
    <!-- -- -- -- -->
      <div class="cellMargin settings_icon" id="settings_render"></div>
      <div class="settings_optionHeader">Render Resolution</div>
      <div class="settings_radio" id="settingsRadioBlock_resolution">
      <span>
        <input type="radio" id="settings_render_25" name="settings_renderPerc" value=".25" hidden>
        <label for="settings_render_25">25%</label>
      </span>
      <span>
        <input type="radio" id="settings_render_50" name="settings_renderPerc" value=".5" hidden>
        <label for="settings_render_50">50%</label>
      </span>
      <span>
        <input type="radio" id="settings_render_75" name="settings_renderPerc" value=".75" hidden>
        <label for="settings_render_75">75%</label>
      </span>
      <span>
        <input type="radio" id="settings_render_100" name="settings_renderPerc" value="1" hidden>
        <label for="settings_render_100">100%</label>
      </span>
      </div>
    <!-- -- -- -- -->
      <div class="cellMargin settings_icon" id="settings_fog"></div>
      <div class="settings_optionHeader">Fog Quality</div>
      <div class="settings_radio" id="settingsRadioBlock_fog">
      <span>
        <input type="radio" id="settings_noRedFog" name="settings_fogLevel" value="0" hidden>
        <label for="settings_noRedFog">Low</label>
      </span>
      <span>
        <input type="radio" id="settings_cheapResFog" name="settings_fogLevel" value="1" hidden>
        <label for="settings_cheapResFog">Medium</label>
      </span>
      <span>
        <input type="radio" id="settings_highResFog" name="settings_fogLevel" value="2" hidden>
        <label for="settings_highResFog">High</label>
      </span>
      </div>
    <!-- -- -- -- -->
      <div class="cellMargin settings_icon" id="settings_bloom"></div>
      <div class="settings_optionHeader">Bloom Effects</div>
      <div class="settings_radio" id="settingsRadioBlock_bloom">
      <span>
        <input type="radio" id="settings_noBloom" name="settings_bloomEffects" value="0" hidden>
        <label for="settings_noBloom">Off</label>
      </span>
      <span>
        <input type="radio" id="settings_bloomActive" name="settings_bloomEffects" value="1" hidden>
        <label for="settings_bloomActive">On</label>
      </span>
      </div>
    <!-- -- -- -- -->
      </div>
    </div>
      <div class="settingsGridSpan settingsEmptySpacer"></div>
    </div>
    <div class="guiSettingsFooterButtons">
    <div class="guiButton" id="guiSettingsBackButton">close</div>
    </div>
  </div>
    </div>
  `;e.innerHTML=i,this.guiWindows.settingsGui.gui=e;let s=this;this.qualitySlider=document.getElementById("SettingsGraphicsQualitySlider");let r=document.getElementById("guiSettingsBackButton");r.onclick=C=>{s.svgCheckClick(C,"close")},[[this.guiRoot+"settingsIcons/settings_user.svg","settings_user",["settings_icon_scale"],!1],[this.guiRoot+"settingsIcons/settings_left_right.svg","settings_left_right",["settings_icon"],!1],[this.guiRoot+"settingsIcons/settings_mouse.svg","settings_mouse",["settings_icon"],!1],[this.guiRoot+"settingsIcons/settings_graphics.svg","settings_graphics",["settings_icon"],!1],[this.guiRoot+"settingsIcons/settings_render.svg","settings_render",["settings_icon"],!1],[this.guiRoot+"settingsIcons/settings_fog.svg","settings_fog",["settings_icon"],!1],[this.guiRoot+"settingsIcons/settings_bloom.svg","settings_bloom",["settingsIconStyle"],!1]].forEach(C=>{Z.svgButtonPromise(...C)});let u=document.getElementById("settings_usernameInput");u.onkeyup=C=>{s.keyUsernameSet(C)},u.onkeydown=C=>{s.keyDownUsernameSet(C)},this.guiWindows.settingsGui.usernameInput=u,document.getElementById("settings_sendUsername").addEventListener("click",()=>{s.sendUsernameUpdate(u)});let p=document.getElementById("settings_usernameResponseMessage");this.guiWindows.settingsGui.usernameReturn=p;let g,m;this.guiWindows.settingsGui.advObj=document.getElementById("gui_advancedSettings"),this.guiWindows.settingsGui.customObj=document.getElementById("settings_graphicsQuality_custom"),g=["settings_graphicsQuality_low","settings_graphicsQuality_med","settings_graphicsQuality_high","settings_graphicsQuality_custom"],m=g.length;for(let C=0;C<m;++C){let y=g[C],f=document.getElementById(y);this.setRadioStyle(f,C,m);let w=parseInt(f.value);f.addEventListener("change",b=>{s.pxlQuality.setQualityLevel(w),s.setRadioValues()})}g=["settings_render_25","settings_render_50","settings_render_75","settings_render_100"],m=g.length;for(let C=0;C<m;++C){let y=g[C],f=document.getElementById(y);this.setRadioStyle(f,C,m);let w=parseFloat(f.value);f.addEventListener("change",b=>{s.guiWindows.settingsGui.customObj.checked=!0,s.pxlQuality.setGraphicsSettings({resolution:w}),s.pxlQuality.setQualityCookie(3)})}g=["settings_noRedFog","settings_cheapResFog","settings_highResFog"],m=g.length;for(let C=0;C<m;++C){let y=g[C],f=document.getElementById(y);this.setRadioStyle(f,C,m);let w=f.value;f.addEventListener("change",b=>{s.guiWindows.settingsGui.customObj.checked=!0,s.pxlQuality.setGraphicsSettings({fog:w}),s.pxlQuality.setQualityCookie(3)})}g=["settings_noBloom","settings_bloomActive"],m=g.length;for(let C=0;C<m;++C){let y=g[C],f=document.getElementById(y);this.setRadioStyle(f,C,m);let w=f.value==1;f.addEventListener("change",b=>{s.guiWindows.settingsGui.customObj.checked=!0,s.pxlQuality.setGraphicsSettings({bloom:w}),s.pxlQuality.setQualityCookie(3)})}g=["settings_tankTurning","settings_strafing"],m=g.length;for(let C=0;C<m;++C){let y=g[C],f=document.getElementById(y);this.setRadioStyle(f,C,m);let w=f.value==1;f.addEventListener("change",b=>{s.pxlQuality.setGraphicsSettings({leftRight:w},null)})}g=["settings_dragLooking","settings_pointLooking"],m=g.length;for(let C=0;C<m;++C){let y=g[C],f=document.getElementById(y);this.setRadioStyle(f,C,m);let w=f.value==1;f.addEventListener("change",b=>{s.pxlQuality.setGraphicsSettings({mouse:w},null)})}this.setRadioValues()}setRadioStyle(e,t,i){let s="settings_radio_label_mid";t==0?s="settings_radio_label_start":t==i-1&&(s="settings_radio_label_end"),e.parentNode.children[1].classList.add(s)}setRadioValues(){let e=this.pxlQuality.settings;Object.keys(e).forEach(i=>{let s=document.getElementById("settingsRadioBlock_"+i);if(s){let r=i=="resolution"?e[i]*4-1:~~e[i];s.children[r].children[0].checked=!0}})}settingsGuiAdvObjSizing(e=!0){let t=this.guiWindows.settingsGui.advObj,i=t.offsetHeight;t.style.maxHeight=(e?i:0)+"px",t.setAttribute("maxHeight",i)}settingsGuiToggle(e=null,t=!0){this.guiWindows.settingsGui||this.settingsGuiBuild(),e=e??!this.guiWindows.settingsGui.active,e&&this.guiWindows.settingsGui&&(this.guiWindows.settingsGui.usernameReturn.innerText=""),this.guiWindows.settingsGui.active=e,this.promptFader(this.guiWindows.settingsGui.gui,e),this.toggleGuiWindowContainer(null,e),this.hudBlock.active&&this.toggleHudBlock(e),this.toggleHudBlock(e,!1),this.togglePxlNavDataDisplay(e),this.introHelpActive&&!e&&(this.introHelpActive=!1,this.pxlEnv.postHelpIntro())}togglePxlNavDataDisplay(e=null){e==null&&(this.guiWindows.settingsGui?e=this.guiWindows.settingsGui.active:e=!1),this.pxlNavData.active=e;let t=this.pxlNavData.height||200;this.pxlNavData.gui.style.maxHeight=e?t+"px":"0px",e||(this.pxlNavData.height=this.pxlNavData.gui.offsetHeight)}renderRadius(e){this.pxlEnv.mapGlowPass.strength=Number(e),this.pxlEnv.roomBloomPass.strength=Number(e)}renderThreshold(e){this.pxlEnv.mapGlowPass.threshold=Number(e),this.pxlEnv.roomBloomPass.threshold=Number(e)}renderGlowRadius(e){this.pxlEnv.mapGlowPass.radius=Number(e),this.pxlEnv.roomBloomPass.radius=Number(e)}renderResolution(e){this.pxlQuality.screenResPerc=e*.75+.25,this.pxlDevice.resizeRenderResolution()}inviteUserBuild(){this.guiWindows.inviteUserGui={},this.guiWindows.inviteUserGui.gui=null,this.guiWindows.inviteUserGui.active=!1;let e=document.createElement("div");e.id="gui_inviteUserWindow",e.classList.add("gui_inviteUserParentStyle"),this.prepPromptFader(e),document.body.appendChild(e);let t=window.location+"";console.log(t),t=t.replace(/^https?:\/\//,""),console.log(t);let i="";i+=`
      <div class="gui_inviteUserBody">
        <div class="iu_urlStyle">${t}</div>
        <div id="iu_copy" class="iu_copyStyle">Copy</div>
      </div>
  `,e.innerHTML=i;let s=this.pxlUtils,r=document.getElementById("iu_copy");r.addEventListener("click",()=>{s.copyRoomUrl()?r.innerText="Copied":r.innerText="Error",r.timeout&&clearTimeout(r.timeout),r.timeout=setTimeout(()=>{r.innerText="Copy",clearTimeout(r.timeout)},2e3)}),this.guiWindows.inviteUserGui.gui=e}inviteUserPosition(){if(this.guiWindows.inviteUserGui&&this.guiWindows.inviteUserGui.active){let t=document.getElementById("ft3Button").getBoundingClientRect();this.guiWindows.inviteUserGui.gui.style.display="grid",this.guiWindows.inviteUserGui.gui.style.top=t.y,this.guiWindows.inviteUserGui.gui.style.right=this.pxlDevice.sW-t.x+5,this.guiWindows.inviteUserGui.gui.style.minHeight=t.height}}toggleInviteUser(e=null){this.guiWindows.inviteUserGui||this.inviteUserBuild(),e=e??!this.guiWindows.inviteUserGui.active,this.guiWindows.inviteUserGui.active=e,this.promptFader(this.guiWindows.inviteUserGui.gui,e),this.inviteUserPosition()}buildMobileWelcome(){this.guiWindows.mobileGui={},this.guiWindows.mobileGui.gui=null,this.guiWindows.mobileGui.active=!1;let e=document.createElement("div");e.id="gui_mobileWelcomeGuiWindow",e.classList.add("gui_helpGuiParentStyle"),this.prepPromptFader(e),this.guiWindowBG.appendChild(e);let t="";t+=`
    <div id="gui_helpContent" class="gui_contentStyle" style="min-height:45%;">
  <div class="gui_mobileBody">
    welcome to
          <br>${this.projectTitle}
  </div>
  <div id="guiHelpFooter" class="gui_footer" style="margin-bottom: 4vh;">
    <div class="guiButton" style="font-weight: 700; font-size: 5vw;" id="guiMobileWelcomeButton">enter</div>
  </div>
  <div class="gui_spacer"></div>
    </div>
  `,e.innerHTML=t;let i=this,s=document.getElementById("guiMobileWelcomeButton");s.onclick=r=>{i.toggleMobileWelcome(!1),i.pxlEnv.postHelpIntro()},this.guiWindows.mobileGui.gui=e}toggleMobileWelcome(e=null){this.guiWindows.mobileGui||this.buildMobileWelcome(),e=e??!this.guiWindows.mobileGui.active,this.guiWindows.mobileGui.active=e,this.promptFader(this.guiWindows.mobileGui.gui,e),this.toggleGuiWindowContainer(null,e),this.hudBlock.active&&this.toggleHudBlock(e)}ctaBuildPopup(e=""){this.ctaContentLoading||(this.googleDocHTML?this.ctaDisplayPopup():(this.ctaContentLoading=!0,this.pxlFile.getURLContent(this.ctaLocalDocURL.blmSupport).then(t=>{this.ctaContentLoading=!1,this.googleDocHTML=t,this.ctaDisplayPopup()})))}ctaDisplayPopup(){this.actionPopUp&&this.actionPopUp.parentNode.removeChild(this.actionPopUp);let e=this.googleDocHTML;this.actionPopUp=document.createElement("div"),this.actionPopUp.setAttribute("id","ctaPopup"),this.actionPopUp.classList.add("parentGoogleLinkDoc"),this.actionPopUp.classList.add("fader"),this.actionPopUp.classList.add("visOff");let t=document.createElement("div");t.setAttribute("id","ctaPopupInner"),this.actionPopUp.appendChild(t),document.body.appendChild(this.actionPopUp);let i=null;e==""||!e?(i=document.createElement("iframe"),i.src="",i.classList.add("iframeGoogleLinkDoc"),t.appendChild(i),i.referrerpolicy="unsafe-url"):(t.innerHTML=e,t.classList.add("iframeGoogleLinkDoc"));let s=this;this.actionPopUp.onclick=function(r){r.srcElement.getAttribute("id")=="ctaPopup"&&(s.promptFader(this,!1,null,!0),s.actionPopUp=null)},i?i.onload=function(){setTimeout(()=>{this.promptFader(this.actionPopUp,!0,null,!1)},100)}:setTimeout(()=>{this.promptFader(this.actionPopUp,!0,null,!1)},100)}getUserControls(e){if(!e)return[null];let t=e,i=t.userStatusGui,s=t.audio,r=t.audioMuted,l=t.userSoundGui,u=t.displayName,v=t.userNameGui,p=t.verse;return{curAvatar:t,curName:u,curAudio:s,curAudioMuted:r,curGui:i,curNameGui:v,curAudioGui:l,curVerse:p}}async setUserControlPosition(){if(this.userControlBlock){let e=0,t=0;if(this.hudTopBar){let i=this.hudTopBar.getBoundingClientRect();e=i.y+i.height}this.userControlBlock.gui.style.top=e+"px"}}buildUserSpeaker(){let e={},t=this.userControlBlock.speakerIcon.svg.cloneNode(!0);t.classList.add("userControlSpeakerStyle"),t.classList.add("userControlSpeakerButtonStyle"),e.gui=t,e.remoteMuted=!1,e.volPrev=0;let i=t.children;for(let r=0;r<i.length;++r){let l=i[r],u=l.getAttribute("id");e[u]=l,u=="mute"?l.classList.add("userControlVisStyle"):u=="button"&&l.classList.add("userControlSpeakerButtonStyle")}let s=e.volLines.children;for(let r=0;r<s.length;++r){let l=s[r],u=l.getAttribute("id");e[u]=l}s=e.remoteMutedLines.children;for(let r=0;r<s.length;++r){let l=s[r],u=l.getAttribute("id");e[u]=l}return e}async addUserControls(e,t=!1){let{curAvatar:i,curName:s,curGui:r}=this.getUserControls(e),l=document.createElement("div");l.classList.add("userControlProximityOff"),l.classList.add("userControlParentStyle"),l.classList.add("userControlSpeakerButtonStyle"),this.mobile&&(l.style.display="none");let u=this;l.onclick=()=>{u.setUserControlMute(e)},i.userStatusGui=l,this.userControlBlock.gui.appendChild(l);let v=document.createElement("div");v.classList.add("userControlInnerParentStyle"),l.appendChild(v);let p=document.createElement("div");p.classList.add("userControlSpeakerParentStyle");let g=this.buildUserSpeaker();p.appendChild(g.gui),i.userSoundGui=g,v.appendChild(p);let m=document.createElement("div");m.classList.add("userControlNameStyle"),m.innerText=s,i.userNameGui=m,v.appendChild(m),this.setUserControlColor(e)}async setUserControlVolume(e,t,i=!0){if(this.userControlBlock.activeList.includes(e)){let{curAudioGui:s,curAudioMuted:r}=this.getUserControls(e);s&&(!r||t==0)&&(s.remoteMuted?t=0:i&&t>0&&(t*=2,t=Math.min(1,Math.max(t,(t+s.volPrev)*.5))),s.volPrev=t,s.volLines.style.opacity=t,s.volLines.style.filter="alpha(opacity="+t*100+")")}}async setUserControlMute(e){let{curAvatar:t,curAudio:i,curAudioMuted:s,curAudioGui:r}=this.getUserControls(e);if(i){let l=!s;l?(this.setUserControlVolume(e,0,!1),r.mute.classList.add("userControlVisible"),i.volume=0,i.muted=!0):(r.mute.classList.remove("userControlVisible"),i.muted=!1,i.volume=1),t.audioMuted=l}}async setUserControlRemoteMute(e,t=null,i=!0,s="#ffffff"){let{curAudio:r,curAudioGui:l}=this.getUserControls(e);if(l){t==null&&(r?t=r.muted:t=!1);let u=typeof t=="object"?t.muted:t;l.remoteMuted=u,l.base.setAttribute("fill",u?"#ff0000":s),l.remoteMutedLines.style.display=u||!i?"inline-block":"none",l.remoteS1.setAttribute("stroke",i?"#ff0000":s),l.remoteS2.setAttribute("stroke",i?"#ff0000":s),this.setUserControlVolume(e,0,!1)}}async setUserControlVis(e,t=null,i=!1){let{curAvatar:s,curGui:r,curAudio:l}=this.getUserControls(e);if(r){let u="userControlProximityOff";if(t==null&&(t=!r.classList.contains(u)),t)r.classList.remove(u),r.style.maxWidth=r.children[0].getBoundingClientRect().width+"px",this.setUserControlVolume(e,0),this.userControlBlock.activeList.includes(e)||this.userControlBlock.activeList.push(e);else{r.classList.add(u),r.style.maxWidth="30px";let v=this.userControlBlock.activeList.indexOf(e);v>-1&&this.userControlBlock.activeList.splice(v,1)}this.userControlBlock.gui.style.padding=this.userControlBlock.activeList.length==0?"0px":"5px"}}async deleteUserControlVis(e){let{curAvatar:t,curGui:i}=this.getUserControls(e);if(i){i.classList.add("userControlProximityOff"),i.style.maxWidth="30px";let r=this.userControlBlock.activeList.indexOf(e);r>-1&&this.userControlBlock.activeList.splice(r,1),this.userControlBlock.gui.style.padding=this.userControlBlock.activeList.length==0?"0px":"5px",i&&i.parentNode.removeChild(i)}}userControlsSwap(e,t){let i=this.userControlBlock.activeList.indexOf(e);i>-1&&(this.userControlBlock.activeList.splice(i,1),this.userControlBlock.activeList.includes(t)||this.userControlBlock.activeList.push(t))}setUserControlColor(e,t=null){let{curAvatar:i,curGui:s,curAudioGui:r,curVerse:l}=this.getUserControls(e),u=!0;if(t==null)if(u)t="#ffffff";else{let p=this.pxlUtils.stringToRgb(l,.3);t=this.pxlUtils.rgbToHex(...p)}s.style.color=t,r.base.setAttribute("fill",t),r.mute.setAttribute("stroke",t),r.mid.setAttribute("fill",t),r.max.setAttribute("fill",t),r.volPrev=0,r.volLines.style.opacity=0,r.volLines.style.filter="alpha(opacity=0)";let v=this;i.userStatusGui.onclick=()=>{v.setUserControlMute(e)},this.setUserControlRemoteMute(e,null,u,t)}toggleUserControls(e){if(!e)return null}};var vt=class{constructor(e,t){this.active=!1,this.isEditing=!1,this.name="GLSL Editor",this.type="shaderGui",this.pxlCore=e,this.pxlEnv=e.pxlEnv,this.guiManager=t,this.parent=null,this.gui=null,this.helpGui=null,this.shaderEditorDisplay=null,this.children={},this.uniformsObj=null,this.vertObj=null,this.fragObj=null,this.currentShader=null,this.shaderSliderValues=new q,this.editorWidthMinMax={min:30,max:70}}addSlider(e,t,i,s,r,l,u,v){typeof e=="string"&&(e=document.getElementById(e));let p=document.createElement("div");p.style.display="grid",p.style.gridAutoFlow="column",p.style.alignItems="center",p.style.gridAutoColumns="max-content auto max-content",p.innerHTML="<div class='input_sliderLabel'>"+t+" : </div>";let g=document.createElement("input");g.type="range",g.classList.add("input_sliderRange"),g.min=s,g.max=r,g.step=l,g.value=i,p.appendChild(g);let m=document.createElement("input");m.type="number",m.classList.add("gui_defaultInput"),m.classList.add("input_numberInput"),m.value=i,p.appendChild(m),m.onchange=C=>{g.value=C.target.value},g.onchange=C=>{m.value=C.target.value,u(C.target.value,...v)},g.oninput=C=>{m.value=C.target.value,u(C.target.value,...v)},e.appendChild(p)}updateShaderTextFields(e=null){let t,i="shaderGui";e||(e=this.pxlEnv.currentRoom==this.pxlEnv.mainRoom?this.currentShader:this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].getCurrentShader());try{t=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].readShader(e,this.shaderSliderValues)}catch{return}let s,r,l;s=r=l="Unable To Load";try{t.uniforms.sliders={type:"v",value:this.shaderSliderValues},s=JSON.stringify(t.uniforms),r=t.vertexShader,l=t.fragmentShader,s="";for(let u in t.uniforms){let v="float",p={t:"sampler2D",b:"bool",i:"int",f:"float",v:"vec",c:"vec"};if(v=typeof t.uniforms[u].value,v=="object"){if(v="",!t.uniforms[u].value)continue;"image"in t.uniforms[u].value?v="sampler2D":v=v+"vec"+Object.keys(t.uniforms[u].value).length}else p.hasOwnProperty(t.uniforms[u].type)&&(v=t.uniforms[u].type=="i"?"i":""),p.hasOwnProperty(t.uniforms[u].type)&&(v=p[t.uniforms[u].type]);s+=`uniform ${v} ${u};   `}r=r.replace(/[\t]/g,"  "),l=l.replace(/[\t]/g,"  ")}catch(u){console.log("Error Reading Shader"),console.log(u)}t&&(t.needsUpdate=!0,this.children.uniformsObj.value=s,this.children.vertObj.value=r,this.children.fragObj.value=l)}buildShaderEditor(){let e="shaderGui",t=document.createElement("div");t.id="guiShaderEditorBlock",t.classList.add("gui_shaderEditorBlockStyle"),t.style.transition="max-width .5s ease, opacity .8s, filter .8s",this.pxlEnv.pxlGuiDraws.prepPromptFader(t),this.pxlEnv.pxlGuiDraws.guiWindows[e]={},this.pxlEnv.pxlGuiDraws.guiWindows[e].gui=t,this.pxlEnv.pxlGuiDraws.guiWindows[e].active=!1,this.gui=t;let i=document.createElement("div");i.id="guiShaderHelpBlock",i.classList.add("gui_shaderHelpBlockStyle"),i.style.transition="left .3s ease, opacity .8s, filter .8s",this.pxlEnv.pxlGuiDraws.prepPromptFader(i),this.pxlEnv.pxlGuiDraws.guiWindows[e].help=i,this.helpGui=i;let s=this.pxlEnv.currentRoom,r=this.pxlEnv.roomSceneList[s].geoList,l=Object.keys(r),u="";l.forEach(T=>{if(["Mesh","Points"].includes(r[T].type)&&r[T].material.type=="ShaderMaterial"){let k=T.substring(0,1).toUpperCase()+T.substring(1,T.length);u+="<option value='geo_"+T+"'>"+k+"</option>"}});let v="",p="selected";this.pxlEnv.pxlGuiDraws.guiWindows[e].currentShader="script_fog";let g=`
    <div id="gui_shaderEditorParent" class="gui_shaderEditorParentStyle">
      <div id="gui_shaderEditorHeaderBlock" class="gui_shaderEditorHeaderBlock">
      <div class="gui_shaderEditorOptionBlock">
        <div class="gui_shaderEditorTitleBlock">
        <div id="gui_shaderEditorTitleParent" class="gui_shaderEditorTitleParentStyle">
            <div id="gui_shaderEditorTitle" clsss="gui_shaderEditorTitleStyle">GLSL Shader Editor</div>
            <div id="gui_shaderEditorHeaderList" clsss="gui_shaderEditorHeaderListStyle">
              <span id="gui_shaderEditorPulldownHeader" clsss="gui_shaderEditorPulldownHeaderStyle">Edit Shader</span>
              <select name="shaderEditor_loadShader" id="shaderEditor_loadShader" class="pickerStyle gui_shaderPickerStyle">
                <option value="script_avatar" ${v}>Avatar</option>
                <option value="script_fog" ${p}>Fog</option>
                <option value="script_dArrows">Direction Arrows</option>
                <option value="script_userScreens">User Screens</option>
                <option value="script_warpZonePortals">Warp Zone Portals</option>
                <option value="script_lizardking">Item; Lizard King</option>
                <option value="script_majorTom">Item; Major Tom</option>
                <option value="script_fractalSubstrate">Item; Fractal Substrate</option>
                <option value="script_fractalEcho">Item; Fractal Echo Pass</option>
                ${u}
              </select>
            </div>
            <div id="gui_shaderEditorFontSize" clsss="gui_shaderEditorFontSizeStyle">
              <span  style="font-size:.75em;margin-right:5px;">Font Size</span>
              <span id="gui_shaderEditorFontSmaller" class="shaderEditor_settingsButton">-</span>
              <span id="gui_shaderEditorFontLarger" class="shaderEditor_settingsButton">+</span>
              <span class="gui_shaderEditorOptionBarSpacer"> </span>
              <span id="gui_shaderEditorCloseButton" class="shaderEditor_settingsButton">X</span>
            </div>
          </div>
        </div>
        <div class="gui_shaderEditorHeaderLine"></div>
        <div id="guiShaderUserSliders"></div>
        <div class="gui_shaderEditorHeaderLine"></div>
      </div>
      </div>
      
      
      <div id="guiShaderFieldParent" class="gui_shaderEditorFieldParentStyle">
        <span style='height:12px'>Uniforms -</span>
        <textarea spellcheck="false" placeholder="Shader Uniforms" rows="3" id="shaderEditor_uniformInput" style="height:unset;" readonly></textarea>
        <span style='height:12px'>Vertex Shader -</span>
        <textarea spellcheck="false" placeholder="Vertex Shader" id="shaderEditor_vertInput"></textarea>
        <span style='height:12px'>Fragment Shader -</span>
        <textarea spellcheck="false" placeholder="Fragment Shader" id="shaderEditor_fragInput"></textarea>
      </div>
      <div id="shader_updateShader" class="shaderEditor_sendMessage">Update Shader</div>
    </div>
    `,m="<div class='gui_shaderHelpSpacerStyle'></div>";g+=`
    <div id="gui_shaderHelpBlock" class="gui_shaderHelpBlockStyle">
      <div class="gui_shaderHelpTitle">:: Keyboard Shortcuts ::</div>
      ${m}
      <span><span class="gui_boldText">Ctrl + Enter</span><br> - Update Shader on Material</span>
      <br>&nbsp;&nbsp;<span>Returns use existing indent type (Spaces or Tabs)</span>
      ${m}
      <span><span class="gui_boldText">Ctrl + D</span><br> - Duplicate current line</span>
      ${m}
      <span><span class="gui_boldText">Ctrl + K</span><br> - Comment current/selected lines</span>
      ${m}
      <span><span class="gui_boldText">Ctrl + Shift + K</span><br> - Uncomment current/selected lines</span>
      ${m}
      <span><span class="gui_boldText">Ctrl + NumPad {1,2,3}</span><br> - Add selection or '.0' into float(), vec2(), vec3() </span>
      ${m}
      <span><span class="gui_boldText">Ctrl + {Up,Down,Left,Right}</span><br> - Searches for current selection in direction</span>
      ${m}
      <span><span class="gui_boldText">Y</span><br> - To opn/close the Shader Editor</span>
      ${m}
    </div>
    `,t.innerHTML=g,document.body.appendChild(t);let C=document.getElementById("guiShaderUserSliders");this.parentObj=C;let y=this.shaderSliderValues,f=(T,...k)=>{y[k[0]]=T};this.addSlider(C,"sliders.x",0,-1,1,.01,f,["x"]),this.addSlider(C,"sliders.y",0,-5,5,.1,f,["y"]),this.addSlider(C,"sliders.z",0,-10,10,.1,f,["z"]),this.children.shaderSliders=C,this.children.shaderParentObj=document.getElementById("shaderEditor_uniformInput").parentNode,this.children.shaderEditor=document.getElementById("gui_shaderEditorParent"),this.children.headerBar=document.getElementById("gui_shaderEditorHeaderBlock"),this.children.titleParentObj=document.getElementById("gui_shaderEditorTitleParent"),this.children.titleObj=document.getElementById("gui_shaderEditorTitle"),this.children.pulldownHeaderObj=document.getElementById("gui_shaderEditorPulldownHeader"),this.children.uniformsObj=document.getElementById("shaderEditor_uniformInput"),this.children.vertObj=document.getElementById("shaderEditor_vertInput"),this.children.fragObj=document.getElementById("shaderEditor_fragInput"),this.children.updateObj=document.getElementById("shader_updateShader"),this.children.helpDiv=document.getElementById("gui_shaderHelpBlock"),this.children.shaderList=document.getElementById("gui_shaderEditorHeaderList"),this.children.shaderFieldParent=document.getElementById("guiShaderFieldParent"),this.shaderEditorDisplay=document.getElementById("shaderEditorDisplay"),this.children.shaderSelect=document.getElementById("shaderEditor_loadShader");let w=document.getElementById("gui_shaderEditorFontSize");w.style.justifySelf="end",w.style.marginTop="2px",w.style.marginRight="3px",w.style.userSelect="none",w.style.display="flex",w.style.alignItems="center";let b=this;this.children.shaderSelect.onchange=T=>{b.updateShaderTextFields(this.children.shaderSelect.value)};let P=document.getElementById("gui_shaderEditorFontSmaller");P.onclick=T=>{b.shiftFontSize(-.15)};let S=document.getElementById("gui_shaderEditorFontLarger");S.onclick=T=>{b.shiftFontSize(.15)};let L=document.getElementById("gui_shaderEditorCloseButton");L.onclick=T=>{b.toggleShaderEditor()},this.children.updateObj.addEventListener("click",()=>{this.isEditing=!1;let k=document.getElementById("shaderEditor_uniformInput").value,U=document.getElementById("shaderEditor_vertInput"),j=U.value,N=document.getElementById("shaderEditor_fragInput"),G=N.value,a=document.createElement("div");a.innerHTML=k,k=a.innerText,a.innerHTML=j,j=a.innerText,a.innerHTML=G,G=a.innerText,b.pxlEnv.roomSceneList[b.pxlEnv.currentRoom].setShader(k,j,G),U.blur(),N.blur(),b.guiManager.pxlNavCanvas.focus()}),this.children.vertObj.onfocus=T=>{b.focusShaderMessage(T,"vertObj")},this.children.vertObj.onkeydown=T=>{b.keyShaderMessage(T)},this.children.vertObj.onmousedown=T=>{b.mDownShaderMessage(T)},this.children.vertObj.onclick=T=>{b.clickShaderMessage(T)},this.children.vertObj.ondblclick=T=>{b.dblclickShaderMessage(T)},this.children.fragObj.onfocus=T=>{b.focusShaderMessage(T,"fragObj")},this.children.fragObj.onkeydown=T=>{b.keyShaderMessage(T)},this.children.fragObj.onmousedown=T=>{b.mDownShaderMessage(T)},this.children.fragObj.onclick=T=>{b.clickShaderMessage(T)},this.children.fragObj.ondblclick=T=>{b.dblclickShaderMessage(T)},this.mouseX=0,this.mouseY=0,this.prevSelectStart=0,this.prevSelectEnd=0}shiftFontSize(e){let t=document.getElementById("gui_shaderEditorParent");if(!t)return;t.hasAttribute("styleStore")||t.setAttribute("styleStore",1);let r=parseFloat(t.getAttribute("styleStore"))+e;t.setAttribute("styleStore",r),t.style.fontSize=r+"em";let l=document.getElementById("shaderEditor_uniformInput");l&&(l.style.fontSize=r+"em");let u=document.getElementById("shaderEditor_vertInput");u&&(u.style.fontSize=r+"em");let v=document.getElementById("shaderEditor_fragInput");v&&(v.style.fontSize=r+"em"),setTimeout(()=>{this.resizeShaderElements()},130)}updateHeaderBar(){this.isEditing?(this.children.titleParentObj.style.fontSize="2.05em",this.children.titleObj.style.fontSize="1.15em"):(this.children.titleParentObj.style.fontSize="1.3em",this.children.titleObj.style.fontSize="1em")}mDownShaderMessage(e){this.mouseX=e.x,this.mouseY=e.y}clickShaderMessage(e){if(!this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.dcActive){let t=Math.abs(this.mouseX-e.x),i=Math.abs(this.mouseY-e.y);if(Math.max(t,i)<5){let r=e.target,l=r.selectionStart,u=r.selectionEnd,v=parseInt((l+u)*.5);l!=u&&(this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.prevSelectStart=l,this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.prevSelectEnd=u)}}}dblclickShaderMessage(e){let t=this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.prevSelectStart,i=this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.prevSelectEnd,s=e.target,r=s.selectionStart,l=s.selectionEnd,v=s.value.substring(t,i+20),p=v.match(/[a-zA-Z0-9\.\_\[\]]+/);p&&!v[0].match(/\n/)&&(i=t+p[0].length),s.setSelectionRange(t,i),this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.dcActive=!0,setTimeout(()=>{this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.dcActive=!1},500)}keyShaderMessage(e){if(e.repeat)return!1;let t=e.key,i=e.code,s=e.shiftKey,r=e.ctrlKey,l=e.altKey,u=i.includes("Numpad");if(!(t=="Enter"||t=="Tab"||i=="KeyD"&&r||i=="KeyK"&&r||u&&r||i.includes("Arrow")&&r))return!1;e.preventDefault();let p=e.target;if(i=="NumpadAdd"){let b=window.getComputedStyle(p),P=parseFloat(b.fontSize)+2;return p.style.fontSize=P,!1}if(i=="NumpadSubtract"){let b=window.getComputedStyle(p),P=parseFloat(b.fontSize)-2;return p.style.fontSize=P,!1}let g=p.selectionStart,m=p.selectionEnd,C=p.value;if(i.includes("Arrow")){if(g==m)return!1;let b=C.substring(g,m),P,S,L;if(i=="ArrowUp"?(S=C.substring(0,g),g=S.search(/.*$/),i="ArrowLeft"):i=="ArrowDown"&&(S=C.substring(m,C.length),m=S.search(/\n/)+m,i="ArrowRight"),i=="ArrowLeft"){P=new RegExp(b+".*","gm"),S=C.substring(0,g);let T=[...S.matchAll(b,"g")];if(T.length==0&&(T=[...C.matchAll(b,"g")],T.length==0))return!1;L=T.pop().index}if(i=="ArrowRight"){P=new RegExp(b,"m"),S=C.substring(m,C.length);let T=P.exec(S);if(T)L=T.index+m;else{if(T=P.exec(C),!T)return!1;L=T.index}}if(L>-1){let T=L+b.length;p.setSelectionRange(L,T);let k=p.getBoundingClientRect(),j=window.getComputedStyle(p).font,N=[C.slice(0,L),"<span id='tmpShaderPosition'>.</span>",C.slice(L)].join("");N=N.replace(/(?:\r\n|\r|\n)/g,"<br>");let G=document.createElement("div");G.style.position="fixed",G.style.width=k.width,G.style.height=k.height,G.style.overflowY="scroll",G.style.font=j,G.innerHTML=N,document.body.appendChild(G);let n=G.querySelector("#tmpShaderPosition").offsetTop-200;document.body.removeChild(G),p.scrollTo(0,n)}return!1}if(t=="Enter"&&r)return this.children.updateObj.click(),p.focus(),p.setSelectionRange(g,m),!1;if(u){let P=C.substring(g,m),S=P.length>0,L=C.substr(g-1,1);L=/[\w|\d]/.test(L)&&P.length==0?" ":"";let T=C.substr(m+1,1);T=/[\w|\d]/.test(T)&&P.length==0?" ":"";let k=g+L.length;if(i=="Numpad1"){let U="float(";k+=U.length,P=S?P:".0",P=U+P+")"}else if(i=="Numpad2"){let U="vec2(";k+=U.length,P=S?P:".0, .0",P=U+P+")"}else if(i=="Numpad3"){let U="vec3(";k+=U.length,P=S?P:".0, .0, .0",P=U+P+")"}return P=L+P+T,document.execCommand("insertText",!1,P),S||p.setSelectionRange(k,k),!1}let y=Math.min(g,m),f=C.substr(0,y);if(i=="KeyK"){let b=!1,P=!1,S=[],L,T,k;if(g!=m&&(L=f.search(/.*$/),T=m,k=C.substring(L,m),b=/\n/.test(k)),!b){let U=f.search(/[\S\w].*$/),j=!1;if(U==-1){if(U=C.substring(y,C.length).search(/(?:[^\s])/),U==-1)return!1;U+=y,j=!0}let N=U,G=N,a="";if(s){if(G+=2,C.substr(N,2)!="//")return!1;g-=2,m-=2}else{if(C.substr(N,2)=="//")return!1;a="//",g+=2,m+=2}return p.setSelectionRange(N,G),document.execCommand("insertText",!1,a),p.setSelectionRange(g,m),!1}if(b){let U=C.substring(T,C.length),j=T+U.search(/\n./),N=C.substring(L,j),G=s?-2:2,a=[...N.matchAll(/[\S\w].*/g)],n=[],h=g-L,d=T-L;return a.forEach(c=>{let x=c.index;n.push(x)}),n=n.reverse(),n.forEach(c=>{let x=N.substr(c,2);if(s){if(x!="//")return;N=N.substring(0,c)+N.substring(c+2,N.length)}else{if(x=="//")return;N=N.substring(0,c)+"//"+N.substring(c,N.length)}g+=c<h?G:0,m+=c<d?G:0}),p.setSelectionRange(L,j),document.execCommand("insertText",!1,N),p.setSelectionRange(g,m),!1}return!1}let w=f.split(`
`);if(t=="Enter"||t=="Tab"){let b=w.pop();b.length==0&&(b=w.pop());let P=b.replace(/[\S\w].*$/g,"");t=="Tab"?(P=P.length==0?" ":P.substr(0,1),P===" "?P="  ":P="	"):P=`
`+P;let S=P,L=g,T=m;if(t=="Tab"&&g!=m){let k=C.substring(g,m);k=k.split(`
`),s?k=k.map(U=>U==""?U:U.replace(P,"")):k=k.map(U=>U==""?U:P+U),S=k.join(`
`),T=L+S.length}else L=L+S.length,T=L;return document.execCommand("insertText",!1,S),p.setSelectionRange(L,T),!1}if(i=="KeyD"&&r)if(g==m){let b=C.split(`
`);w.pop();let P=w.length,S=b[P],k=[...w,S].join(`
`).length;S=`
`+S,p.setSelectionRange(k,k),document.execCommand("insertText",!1,S),k=y+S.length,p.setSelectionRange(k,k)}else{let b=C.substring(g,m);p.setSelectionRange(m,m),document.execCommand("insertText",!1,b),m+=b.length,p.setSelectionRange(m,m)}return!1}updateShaderList(){let e=this.children.shaderSelect;if(!e){console.log("No pulldown"),console.log(this.gui);return}let t=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].getShaderList(),i=Object.keys(t),s="",r=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].getCurrentShader();i.forEach(l=>{let u=l==r?" selected":"";s+=`<option value="${l}" ${u}>${t[l]}</option>`}),e.innerHTML=s}resize(e){this.resizeShaderElements()}resizeShaderElements(){let e=0;if(this.hudBottomBar&&(e=this.hudBottomBar.offsetHeight),this.children.headerBar&&(e+=this.children.headerBar.offsetHeight),this.gui){this.gui.style.height=this.guiManager.sH-e;let t=this.children.vertObj.getBoundingClientRect().top,i=this.children.updateObj.getBoundingClientRect().height;i+=40;let s=this.guiManager.sH-i-t;this.children.vertObj.style.maxHeight=s*.4+"px",this.children.vertObj.displayHeight=s*.4,this.children.fragObj.style.maxHeight=s*.6+"px",this.children.fragObj.displayHeight=s*.6,this.children.fieldBodyHeight=s}}toggleShaderEditor(e=null){this.gui||this.buildShaderEditor(),this.updateShaderList(),this.updateShaderTextFields(this.children.shaderSelect.value),e=e??!this.active,this.active=e,this.guiManager.promptFader(this.gui,e),this.guiManager.promptFader(this.helpGui,e),this.pxlEnv.emit("shaderEditorVis",e),e?this.guiManager.pxlNavCanvas.addEventListener("mousedown",this.blurShaderEditor.bind(this)):this.guiManager.pxlNavCanvas.removeEventListener("mousedown",this.blurShaderEditor.bind(this)),setTimeout(()=>{this.resizeShaderElements()},130)}blurShaderEditor(){this.isEditing=!1,document.activeElement.blur();let e=document.getElementById("guiShaderEditorBlock");e.style.maxWidth=this.editorWidthMinMax.min+"vw";let t=document.getElementById("gui_shaderHelpBlock");t&&(t.style.left="max("+this.editorWidthMinMax.min+"vw, 430px)");let i=document.getElementById("shaderEditor_loadShader");i&&(i.style.maxWidth="85px"),this.updateHeaderBar(),setTimeout(()=>{this.resizeShaderElements()},130)}focusShaderMessage(e,t){this.isEditing=!0;let i=this.children,s=i.vertObj.displayHeight,r=i.fragObj.displayHeight,l=Math.max(150,this.guiManager.sH*.135),u=i.fieldBodyHeight-l;s=t=="vertObj"?u:l,r=t=="fragObj"?u:l,i.vertObj.style.maxHeight=s+"px",i.fragObj.style.maxHeight=r+"px";let v=document.getElementById("gui_shaderEditorParent");this.gui.style.maxWidth=this.editorWidthMinMax.max+"vw",this.children?.shaderSelect&&(this.children.shaderSelect.style.maxWidth="225px");let p=document.getElementById("gui_shaderHelpBlock");p&&(p.style.left=this.editorWidthMinMax.max+"vw"),this.updateHeaderBar()}};var Ze=class extends ft{constructor(e,t="Metal-Asylum",i="images/assets/",s="images/GUI/"){super(e,t,i,s),this.verbose=e,this.lableBoxSize=40,this.optionWidthRound=10,this.optionWidthAdd=25,this.deviceOptionHeight=[0,300],this.ShaderEditor=null,this.pxlLoaderTotal=5,this.hudVisibility=!0,this.camChoicesActive=!1,this.micChoicesActive=!1,this.textDescriptions={chatIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">C</span> )</span><br>chat',pos:[1,-1.5]},multiverseIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">U</span> )</span><br>multiverse<br>selection',pos:[0,-1.3]},djPlayerVolumeParent:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">B</span> )</span><br>music volume',pos:[0,-1.5]},speakerIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">N</span> )</span><br>mute people<br>pick audio output',pos:[0,-1.5]},micIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">M</span> )</span><br>mute/pick<br>mic input',pos:[0,-1.5]},camIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">V</span> )</span><br>enable/pick<br>video input',pos:[0,-1.5]},helpIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">?</span> )</span><br>help &<br>instructions',pos:[0,-1.5]},infoIconParent:{text:'Info <span class="helpHotKeyParent">( <span class="helpHotKey">I</span> )</span>',pos:[-1,0],offset:[-10,0]},settingsIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">G</span> )</span><br>graphics &<br>navigation',pos:[0,-1.5]},muteAllIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">N</span> )</span><br>mute all users',pos:[1,0]},fullScreenIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">F</span> )</span><br>toggle full screen',pos:[-1,0]},videoQualityIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">H</span> )</span><br>video quality settings',pos:[-1,0]},statsIcon:{text:"jitsi connection status; toggle connection ",pos:[1,0]},usersIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">T</span> )</span> user moderator tools',pos:[1,0]},ft2Button:{text:"Environment",pos:[-1,0],offset:[-10,0]},ft3Button:{text:"Invite Friends",pos:[-1,0],offset:[-10,0]},hud_userCount:{text:"# of People",pos:[-1,0],offset:[-10,0]}},this.activeItem=null,this.actionPopUp=null,this.init()}setDependencies(e){super.setDependencies(e),this.ShaderEditor=new vt(e,this)}init(){super.init()}booted(){super.booted()}step(){super.step()}toggleShaderEditor(){this.ShaderEditor.toggleShaderEditor()}resize(e){super.resize(),this.ShaderEditor&&this.ShaderEditor.resize(e)}};import*as O from"./three.module.js";var Je=class{constructor(){this.standingHeight=1.75,this.movementScalar=1,this.jumpScalar=1,this.userScale=1,this.cameraEasing=[.55,.45],this.cameraJumpImpulse=[.035,.075],this.cameraMaxJumpHold=[.55,1],this.gravityRate=0,this.gravityMax=2.5,this.gravityMPS=[1,.5],this.pxlAudio=null,this.pxlTimer=null,this.pxlAutoCam=null,this.pxlEnv=null,this.pxlUser=null,this.pxlUtils=null,this.pxlDevice=null,this.pxlGuiDraws=null,this.pxlQuality=null,this.socket=null,this.camera=null,this.canMove=!0,this.HDRView=!1,this.objRaycast=new O.Raycaster,this.camUpdated=!0,this.cameraBooted=!1,this.standingHeightGravInfluence=0,this.standingMaxGravityOffset=.5,this.maxStepHeight=.6,this.walkBounce=0,this.walkBounceSeed=230,this.walkBouncePerc=0,this.posRotEasingThreshold=.01,this.cameraMovement=[0,0],this.cameraMovementEase=.85,this.cameraMoveLength=0,this.cameraMoveLengthMult=.1,this.camPosBlend=.65,this.camRotXYZ=new O.Vector3(0,0,0),this.camRotPitch=new O.Vector2(0,0),this.cameraJumpActive=!1,this.cameraAllowJump=!0,this.cameraJumpHeight=0,this.cameraJumpVelocity=0,this.cameraJumpVelocityEaseOut=.8,this.cameraJumpInAir=!1,this.floorColliderInitialHit=!1,this.colliderValidityChecked=!0,this.nearestFloorHit=new O.Vector3(0,0,0),this.nearestFloorObjName=null,this.nearestFloorHitPrev=new O.Vector3(0,0,0),this.nearestFloorObjNamePrev=null,this.objectJumpLock=!1,this.gravityActive=!1,this.gravitySourceActive=!1,this.gravityDirection=new O.Vector3(0,-1,0),this.gravityEaseOutRate=.8,this.jump=0,this.hasJumpLock=!1,this.releaseJumpLockTime=0,this.releaseJumpLockDelay=.05,this.runMain=!0,this.workerActive=!1,this.worker=null,this.workerTransfers=!1,this.workerMessage=()=>{},this.workerFunc=()=>{},this.deviceKey=()=>{},this.portalList={},this.collidersExist=!1,this.colliderActive=!1,this.colliderList={noAxis:[],11:[],"01":[],10:[],"00":[]},this.antiColliderActive=!1,this.antiColliderList={noAxis:[],11:[],"01":[],10:[],"00":[]},this.antiColliderTopActive=!1,this.antiColliderTopList={noAxis:[],11:[],"01":[],10:[],"00":[]},this.roomWarpZone=[],this.colliderCurObjHit=null,this.colliderPrevObjHit=null,this.colliderValid=!1,this.colliderFail=!1,this.warpActive=!1,this.warpType=0,this.warpObj=null,this.warpTarget=null,this.hotKeyTriggered=!1,this.eventCheckStatus=!1,this.proximityScaleTrigger=!1,this.colliderShiftActive=!0,this.colliderAdjustPerc=0,this.colliderAdjustRate=.02,this.gyroGravity=[0,0,0],this.cameraPose={alpha:null,beta:null,gamma:null,alphaOffset:0,betaOffset:0,gammaOffset:0,orientation:window.orientation||0,pos:[0,0,0],posOffset:[0,0,0],rx:()=>this.beta,ry:()=>this.alpha,rz:()=>this.gamma,accelZeroed:[0,0,0],accelCalibration:10,accelCalDiv:1/10,accelCalCount:0,accelTotal:[0,0,0],accelPrev:null,accelDelta:[0,0,0],accelClearDelta:()=>{this.accelDelta=[0,0,0]}},this.uniformScalars={curExp:1,darkBase:.1,brightBase:.5,exposureUniformBase:1},this.cameraPosLookAtNames={default:{pos:"Position",lookAt:"LookAt"},mobile:{pos:"PositionMobile",lookAt:"LookAtMobile"},vr:{pos:"PositionVR",lookAt:"LookAtVR"}},this.cameraPos=new O.Vector3(0,0,0),this.cameraPrevPos=new O.Vector3(0,0,0),this.cameraPrevLookAt=new O.Vector3(0,0,0),this.cameraAim=new O.Vector3(0,0,1),this.cameraAimTarget=new O.Vector3(0,0,0),this.cameraCross=new O.Vector3(1,0,0),this.lookAtTargetActive=new O.Vector3(0,0,0),this.lookAtPerc=new O.Vector2(1,0),this.lookAtLockPerc=0,this.lookAtLockFader=0,this.lookAtLockFadeRate=.01,this.prevQuaternion=new O.Quaternion,this.pi=3.14159265358979,this.init()}setDependencies(e){this.pxlAudio=e.pxlAudio,this.pxlTimer=e.pxlTimer,this.pxlAutoCam=e.pxlAutoCam,this.pxlEnv=e.pxlEnv,this.pxlUser=e.pxlUser,this.pxlUtils=e.pxlUtils,this.pxlDevice=e.pxlDevice,this.pxlGuiDraws=e.pxlGuiDraws,this.pxlQuality=e.pxlQuality,this.socket=e.socket}init(){var e}updateMainValues(e){let{gravityRate:t,standingHeightGravInfluence:i,cameraJumpImpulse:s}=e;t!=null&&(this.gravityRate=t),i!=null&&(this.standingHeightGravInfluence=i),s!=null&&(this.cameraJumpVelocity+=s),this.camUpdated=!0}step(){this.pxlDevice.directionKeyDown&&this.updateMovement(this.pxlTimer.prevMS),this.runMain&&(this.hasJumpLock&&this.pxlTimer.runtime>this.releaseJumpLockTime&&(this.hasJumpLock=!1,this.gravityActive=!1,this.cameraAllowJump=!0,this.camInitJump()),this.gravityActive&&this.cameraJumpActive?this.camJump(this.pxlTimer.prevMS):this.cameraJumpVelocity>0&&this.killJumpImpulse()),this.camUpdated=this.camUpdated||this.cameraMovement[0]!=0||this.cameraMovement[1]||this.gravityActive||this.pxlDevice.cursorLockActive,this.updateCamera(),this.lowQualityUpdates(),this.midQualityUpdates(),this.eventCheck()}eventCheck(){this.colliderValid&&this.eventCheckStatus&&this.eventTrigger(this.nearestFloorObjName)&&this.warpEventTriggered(1,this.nearestFloorObjName)}updateDeviceValues(e){if(!this.pxlQuality.settings.leftRight){let t=-this.cameraMovement[0];this.pxlDevice.touchMouseData.active||(this.pxlDevice.touchMouseData.velocity.x+=t),this.pxlDevice.touchMouseData.netDistance.x+=t*4}if(this.pxlDevice.touchMouseData.velocity!=null&&this.pxlDevice.mobile==0){if(e<this.posRotEasingThreshold)this.pxlDevice.touchMouseData.velocity.multiplyScalar(0);else{let t=this.cameraEasing[this.pxlDevice.mobile?1:0];this.pxlDevice.touchMouseData.velocity.multiplyScalar(t)}this.pxlDevice.touchMouseData.netDistance.add(this.pxlDevice.touchMouseData.velocity.clone().multiply(this.pxlDevice.touchMouseData.moveMult))}}buildDeviceMonitors(){let e=this}updateCameraMatrices(){this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.updateWorldMatrix()}resetCameraCalculations(e){this.cameraMovement[0]=0,this.cameraMovement[1]=0,this.pxlDevice.touchMouseData.curFadeOut.multiplyScalar(0),this.pxlDevice.touchMouseData.velocity.multiplyScalar(0),this.pxlDevice.touchMouseData.netDistance.set(0,0),this.camera.position.copy(e),this.updateCameraMatrices(),this.cameraPos.copy(e),this.cameraPrevPos.copy(e),this.colliderCurObjHit=null,this.colliderPrevObjHit=null,this.camUpdated=!0}setFOV(e){this.camera.fov=e,this.camera.updateProjectionMatrix(),this.camUpdated=!0}setStats(e,t,i,s){this.camera.near=i,this.camera.far=s,this.setFOV(e)}setTransform(e,t=null){this.resetCameraCalculations(e),t&&(this.cameraAimTarget.position.copy(t),this.camera.lookAt(t),this.cameraPrevLookAt.copy(t),this.updateCameraMatrices(),this.pxlDevice.touchMouseData.initialQuat=this.camera.quaternion.clone()),this.resetGravity(),this.camUpdated=!0}setToObj(e,t=null){if(this.resetCameraCalculations(e.position),t){let i=t.position.clone();this.cameraAimTarget.position.copy(i),this.camera.lookAt(i),this.cameraPrevLookAt.copy(i),this.updateCameraMatrices(),this.pxlDevice.touchMouseData.initialQuat=this.camera.quaternion.clone()}else this.pxlDevice.touchMouseData.initialQuat=e.quaternion.clone(),this.camera.setRotationFromQuaternion(this.pxlDevice.touchMouseData.initialQuat),this.updateCameraMatrices();this.resetGravity(),this.camUpdated=!0,this.mainColliderCheck(e.position,null),this.nearestFloorObjName=null}warpToRoom(e,t=!1,i=null){this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].stop();let s=this.pxlEnv.currentRoom,r=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].camHoldWarpPos;this.pxlEnv.currentRoom=e,this.pxlAutoCam.curRoom=e;let l=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom],u=e==this.pxlEnv.mainRoom;if(this.pxlUser.iZoom){let p=u?this.pxlEnv.roomComposer:this.pxlEnv.mapComposer,g=u?this.pxlEnv.mapComposer:this.pxlEnv.roomComposer;this.pxlEnv.delayPass.uniforms.tDiffusePrev.value=p.renderTarget1.texture,this.pxlEnv.delayPass.uniforms.tDiffusePrevRoom.value=g.renderTarget1.texture,setTimeout(()=>{s!=e&&(u?this.pxlEnv.roomComposer.reset():this.pxlEnv.mapComposer.reset()),setTimeout(()=>{this.pxlEnv.mapComposerWarpPass.needsSwap=!1},500)},100)}if(t)if(e!=s&&l.start(),this.pxlEnv.roomRenderPass.scene=l.scene,l.camLocation.hasOwnProperty(i)){let p=this.cameraPosLookAtNames.default.pos,g=this.cameraPosLookAtNames.default.lookAt;this.pxlDevice.mobile&&(l.camLocation[i].hasOwnProperty(this.cameraPosLookAtNames.mobile.pos)&&(p=this.cameraPosLookAtNames.mobile.pos),l.camLocation[i].hasOwnProperty(this.cameraPosLookAtNames.mobile.lookAt)&&(g=this.cameraPosLookAtNames.mobile.lookAt));let m=l.camLocation[i][p],C=l.camLocation[i][g];this.setTransform(m,C)}else l.camInitPos&&l.camInitLookAt&&(!r||!this.pxlEnv.postIntro||this.hotKeyTriggered)&&(this.setTransform(l.camInitPos,l.camInitLookAt),this.hotKeyTriggered=!1);else(!r||!this.pxlEnv.postIntro||this.hotKeyTriggered)&&(i!=null?this.setToObj(i):this.setTransform(l.camReturnPos,l.camReturnLookAt),this.hotKeyTriggered=!1);this.pxlGuiDraws.prepArtistInfo(l.getArtistInfo()),this.camUpdated=!0,this.camera.fov=l.pxlCamFOV,this.camera.zoom=l.pxlCamZoom,this.camera.aspect=l.pxlCamAspect,this.camera.near=l.pxlCamNearClipping,this.camera.far=l.pxlCamFarClipping,this.camera.updateProjectionMatrix();let v=this.getUserHeight();this.emitCameraTransforms(this.camera.position.clone(),v,!0),this.pxlAutoCam.checkStatus()}warpToRoomSnapshot(e){this.pxlEnv.currentRoom=e;let t=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom];this.camera.fov=t.pxlCamFOV,this.camera.zoom=t.pxlCamZoom,this.camera.aspect=t.pxlCamAspect,this.camera.near=t.pxlCamNearClipping,this.camera.far=t.pxlCamFarClipping,this.camera.updateProjectionMatrix(),this.setTransform(t.camThumbPos,t.camThumbLookAt);let i=this.getUserHeight();this.emitCameraTransforms(this.camera.position.clone(),i,!0)}fastTravel(e=0){this.pxlAutoCam.enabled||((this.pxlAutoCam.active||this.pxlAutoCam.autoCamActive)&&this.pxlAutoCam.preAutoCamToggle(),this.hotKeyTriggered=!0,e==0&&this.warpEventTriggered(1,this.pxlEnv.currentRoom,"init"))}camJumpKey(e=!1){e?this.camInitJump():(this.cameraJumpActive&&(this.cameraJumpActive=!1),this.cameraAllowJump=!0,this.hasJumpLock=!1)}camInitJump(){this.canMove&&!this.gravityActive&&this.cameraAllowJump&&(this.pxlDevice.keyDownCount[2]=this.pxlTimer.prevMS,this.cameraAllowJump=!1,this.cameraJumpActive=!0,this.cameraJumpInAir=!0,this.gravityActive=!0,this.gravityRate=0,this.cameraJumpVelocity=this.cameraJumpImpulse[this.pxlUser.lowGrav]*this.userScale,this.objectJumpLock&&(this.objectJumpLock=!1,this.nearestFloorHit=this.nearestFloorHitPrev))}camJump(e){let t=e-this.pxlDevice.keyDownCount[2],i=1,s=Math.min(1,t/this.cameraMaxJumpHold[this.pxlUser.lowGrav]);if(this.cameraJumpActive){let r=s;r==1?this.cameraJumpActive=!1:(r=(1-r)*(1-r),r=r*(r*.5+.5)),this.cameraJumpVelocity+=Math.max(0,r)*this.cameraJumpImpulse[this.pxlUser.lowGrav]*this.jumpScalar}this.cameraJumpVelocity*=1-s,s==1&&(this.cameraJumpActive=!1)}killJumpImpulse(){let e=this.cameraJumpVelocity*this.cameraJumpVelocityEaseOut;this.cameraJumpVelocity=e>.1?e:0,this.workerFunc("killJumpImpulse")}updateGravity(){if(this.runMain){this.gravityRate=Math.max(0,this.gravityRate-this.cameraJumpVelocity*.2);let e=this.gravityMPS[this.pxlUser.lowGrav];if(this.gravityActive&&(this.gravityRate=Math.min(this.gravityMax,this.gravityRate+this.gravityMax*this.pxlTimer.msRunner.y)*e),this.gravityRate!=0){let t=1;this.gravityActive?t=this.gravityRate*.08:(this.gravityRate=this.gravityRate>.01?this.gravityRate*this.gravityEaseOutRate*e:0,t=this.gravityRate),t=Math.min(1,t),this.standingHeightGravInfluence=Math.min(1,this.gravityRate*1.2/this.gravityMax)*this.standingMaxGravityOffset}}}resetGravity(){this.gravityRate=0,this.workerFunc("resetGravity"),this.jumpLanding(!1)}jumpLanding(e=!0){this.cameraJumpActive&&(this.hasJumpLock=!0,this.releaseJumpLockTime=this.pxlTimer.runtime+this.releaseJumpLockDelay),this.gravityActive=!1,this.cameraJumpVelocity=0,this.cameraJumpInAir=!1,this.cameraJumpActive=!1,e&&this.workerFunc("jumpLanding")}mainColliderCheck(e,t){if(!this.canMove)return e;let i=null;if(this.movementBlocked=!1,(this.cameraMoveLength>0||this.colliderPrevObjHit==null||this.nearestFloorObjName==null)&&this.cameraBooted&&this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].collidersExist){this.colliderValidityChecked=!0;let u=new O.Vector3(0,-1,0),v=e.clone(),p=1500;v.y=p,this.objRaycast.set(v,u);let g=!1;var s=[];let m=~~(v.x>0)+(~~(v.z>0)+"");if(this.antiColliderActive&&(s=this.objRaycast.intersectObjects([...this.antiColliderList.noAxis,...this.antiColliderList[m]])),s.length>0)if(this.antiColliderTopActive){let C=this.objRaycast.intersectObjects([...this.antiColliderTopList.noAxis,...this.antiColliderTopList[m]]),y=-99999,f=e.y,w,b=this.nearestFloorHit,P=!1;for(var r=0;r<C.length;++r){var l=C[r];w=l.object.name;let L=l.point,T=l.distance,U=L.y<this.maxStepHeight;P=P||U,(T<y&&valid||i==null)&&(i=w,y=T,b=L)}let S;(!P||e.y<b.y&&this.nearestFloorHitPrev.y-b.y>this.maxStepHeight+this.getStandingHeight()&&!this.gravityActive&&e.y+this.maxStepHeight+this.getStandingHeight()<b.y&&this.gravityActive)&&((this.cameraMovement[0]!=0||this.cameraMovement[1]!=0)&&(P=!0,this.gravityActive=!1,this.objectJumpLock=!0),S=this.cameraPos.clone(),S.y=Math.min(e.y,S.y),e=S,b=e,this.gravityActive?b.y=this.nearestFloorHitPrev.y:b.y=this.cameraPos.y,this.cameraJumpActive=!1,this.cameraAllowJump=!0,this.cameraJumpInAir=!1,this.cameraMovement[0]=0,this.cameraMovement[1]=0,this.pxlDevice.touchMouseData.curFadeOut.multiplyScalar(0),this.pxlDevice.touchMouseData.velocity.multiplyScalar(0)),P&&(i==null?(this.nearestFloorHit=this.nearestFloorHitPrev,this.nearestFloorObjName=this.nearestFloorObjNamePrev,Math.abs(e.y-this.nearestFloorHit.y)>this.maxStepHeight+this.getStandingHeight()&&(this.colliderValid=!1,this.gravityActive=!0)):(this.nearestFloorHitPrev=this.nearestFloorHit,this.nearestFloorObjNamePrev=this.nearestFloorObjName,this.nearestFloorHit=b,this.nearestFloorObjName=i))}else this.colliderFail=!0,this.movementBlocked=!0;else{let C=this.maxStepHeight+this.cameraJumpVelocity,y=C+this.maxStepHeight+this.gravityRate;if(v.y=e.y+C,this.objRaycast.set(v,u),this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].colliderMasterList||(this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].colliderMasterList={}),!this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].colliderMasterList[m]){let f=[],w=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom];f.push(...w.colliderList.noAxis),f.push(...w.colliderList[m]),f.push(...w.antiColliderTopList.noAxis),f.push(...w.antiColliderTopList[m]),this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].colliderMasterList[m]=f}if(this.colliderActive&&this.antiColliderTopActive||this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].colliderActive)s=this.objRaycast.intersectObjects(this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].colliderMasterList[m]);else return e;if(s.length>0){this.floorColliderInitialHit=!0;let f=-99999,w,b=this.nearestFloorHit;for(let P=0;P<s.length;++P){let S=s[P],L=S.distance,T=S.point,k=!1;if(w=S.object.name,k=T.distanceTo(e)<this.maxStepHeight,(this.portalList[w]||this.roomWarpZone.includes(w))&&k){i=w,b=T;break}else this.itemCheck(w,k)||(L<f||i==null)&&(i=w,f=L,b=T)}this.nearestFloorObjName==null&&i!=null&&(this.nearestFloorHitPrev=b,this.nearestFloorObjNamePrev=i,this.nearestFloorHit=b,this.nearestFloorObjName=i),this.nearestFloorHitPrev.y-b.y>this.maxStepHeight+this.getStandingHeight()&&!this.gravityActive?(i?e=this.cameraPos.clone():e=this.cameraPrevPos.clone(),i=this.nearestFloorObjName,this.cameraMovement[0]=0,this.cameraMovement[1]=0,this.pxlDevice.touchMouseData.curFadeOut.multiplyScalar(0),this.pxlDevice.touchMouseData.velocity.multiplyScalar(0)):(this.nearestFloorHitPrev=this.nearestFloorHit,this.nearestFloorObjNamePrev=this.nearestFloorObjName,this.nearestFloorHit=b,this.nearestFloorObjName=i,i==null&&(this.colliderValid=!1,this.gravityActive=!0))}else this.colliderFail=!0,this.movementBlocked=!0,this.colliderValidityChecked=!1,e=this.cameraPos.clone()}}else this.colliderValidityChecked=!1;return this.colliderValidityChecked=!1,e}roomColliderCheck(e,t){if(!this.canMove)return e;this.colliderValidityChecked=!0,this.colliderValid=!1,this.colliderFail=!1,console.log("Room Collider Check");let i=e.clone();i.y=0,this.nearestFloorHit=i,this.nearestFloorObjName="None";let s=new O.Vector3(0,-1,0),r=e.clone(),l=1500;r.y=l,this.objRaycast.set(r,s);var u=this.objRaycast.intersectObjects(this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].roomWarp);if(u.length>0)return this.pxlEnv.currentAudioZone=0,this.warpEventTriggered(1,this.pxlEnv.mainRoom),e;if(this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].colliderActive==!0){if(!this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].colliderMasterList){let v=[];Object.keys(this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].colliderList).forEach(g=>{v.push(...this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].colliderList[g])}),this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].colliderMasterList=v}if(this.objRaycast.set(r,s),u=this.objRaycast.intersectObjects(this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].colliderMasterList),u.length==0){let v=this.cameraPrevPos.clone();return v.y=e.y,v}else{let v=!1,p=!1,g=!1,m=99999,C=e.clone();if(C.y-=this.maxStepHeight,u.forEach(y=>{let f=y.distance,w=y.point.y;w>e.y-this.maxStepHeight&&w<e.y+this.maxStepHeight+t&&C.y<w?(v=!0,g=!1,m=f,C=y.point):w>e.y+this.maxStepHeight?p=!0:w<e.y-this.maxStepHeight&&v==!1&&(g=!0)}),p){let y=this.cameraPrevPos.clone();return y.y=e.y,y}if(g&&(this.gravityActive=!0),v)return e.y<C.y&&this.jumpLanding(),C.clone()}}return e}checkColliderValid(e){this.colliderValidityChecked=!0;let t=this.maxStepHeight+this.gravityRate,i=e.distanceTo(this.nearestFloorHit),s=i<t;return this.colliderValid=s,i}eventTrigger(e=null){if(!this.canMove||!e)return!1;if(this.portalList[e])return this.warpEventTriggered(0,this.portalList[e]),this.eventCheckStatus=!1,!0;if(this.roomWarpZone.includes(e))return this.warpEventTriggered(1,e),this.eventCheckStatus=!1,!0;if(this.colliderShiftActive=this.colliderCurObjHit!=e||this.colliderShiftActive,this.colliderPrevObjHit=this.colliderCurObjHit,this.colliderCurObjHit=e,this.colliderShiftActive=this.colliderShiftActive||!(this.colliderAdjustPerc==1||this.colliderAdjustPerc==0),this.colliderShiftActive&&this.colliderCurObjHit){let t=1;this.colliderCurObjHit.includes("AudioTrigger")&&(t=-1),this.colliderAdjustPerc=Math.min(1,Math.max(0,this.colliderAdjustPerc+this.colliderAdjustRate*t));let s=1-this.colliderAdjustPerc,r=1;if(this.colliderCurObjHit=="AudioTrigger_1"?(this.pxlEnv.currentAudioZone=1,r=r-s*this.uniformScalars.darkBase,this.uniformScalars.exposureUniformBase=r):this.colliderCurObjHit=="AudioTrigger_2"?(this.pxlEnv.currentAudioZone=2,r=this.uniformScalars.curExp+s*this.uniformScalars.brightBase*1,this.uniformScalars.exposureUniformBase=r,this.proximityScaleTrigger=!0,this.pxlAudio.setFadeActive(-1)):(this.pxlEnv.currentAudioZone=0,r=r*(1-s)+this.uniformScalars.exposureUniformBase*s),this.colliderShiftActive=!(this.colliderAdjustPerc==1||this.colliderAdjustPerc==0),this.colliderPrevObjHit=="AudioTrigger_2"&&this.colliderCurObjHit!=this.colliderPrevObjHit&&(this.proximityScaleTrigger=!0,this.pxlAudio.setFadeActive(1)),this.pxlDevice.mobile&&(r=this.colliderAdjustPerc),this.pxlEnv.updateCompUniforms(r),this.proximityScaleTrigger&&!this.pxlDevice.mobile&&!this.pxlAutoCam.enabled){let l=this.colliderAdjustPerc;l=1-(1-l)*(1-l),this.pxlEnv.fogMult.x=l,this.colliderShiftActive||(this.proximityScaleTrigger=!1)}this.eventCheckStatus=this.colliderShiftActive}}itemCheck(e,t){if(!t)return!1;let i=e.split("_").shift();return this.pxlUser.itemListNames.includes(e)&&this.pxlUser.checkItemPickUp(i)?this.itemActive(i,e):!1}itemTrigger(){if(this.pxlUser.itemActiveTimer.length>0)this.pxlUser.itemActiveTimer[0]=this.pxlTimer.curMS;else{this.pxlUser.mPick.length==0&&(this.pxlUser.mPick=this.pxlUtils.randomizeArray(["LizardKing","StarField","InfinityZoom"]));let e=this.pxlUser.mPick.pop();this.pxlUser.checkItemPickUp(e),this.itemActive(e)}}itemActive(e=null,t=null){if(e==null)return!1;let i=this.pxlTimer.prevMS+this.pxlUser.itemRunTime,s="",r="";if(e=="LowGravity")r="Low Gravity",s="this.lowGrav=0;this.itemGroupList['"+t+"'].visible=true;",i=this.pxlTimer.prevMS+this.pxlUser.itemRunTime;else if(e=="LizardKing")r="I am the Lizard King",s="this.lKing=0;this.lKingWarp.set(...this.lKingInactive);this.lKingPass.enabled=false;"+(!this.pxlDevice.mobile&&"this.itemGroupList['"+t+"'].visible=true;"),i=this.pxlTimer.prevMS+this.pxlUser.itemRunTime;else if(e=="StarField")r="Major Tom",s="this.sField=0;this.sFieldPass.enabled=false;"+(!this.pxlDevice.mobile&&"this.itemGroupList['"+t+"'].visible=true;"),i=this.pxlTimer.prevMS+this.pxlUser.itemRunTime;else if(e=="InfinityZoom")r="Fractal Substrate",s="this.iZoom=0;this.iZoomPass.enabled=false;"+(!this.pxlDevice.mobile&&"this.itemGroupList['"+t+"'].visible=true;this.pxlEnv.mapComposerWarpPass.needsSwap=true;this.pxlEnv.mapComposerWarpPass.enabled=false;"),i=this.pxlTimer.prevMS+this.pxlUser.itemRunTime,this.pxlEnv.mapComposerWarpPass.needsSwap=!0,setTimeout(()=>{this.pxlEnv.mapComposer.render(),this.pxlEnv.roomComposer.render(),setTimeout(()=>{this.pxlEnv.mapComposerWarpPass.needsSwap=!1,this.pxlEnv.mapComposerWarpPass.enabled=!0},500)},500);else return!1;return this.pxlGuiDraws.buildItemHud(e,r),this.pxlDevice.mobile||(this.pxlUser.itemGroupList[t].visible=!1),this.pxlUser.itemInactiveCmd.push(s),this.pxlUser.itemActiveTimer.push(i),this.pxlUser.itemActiveList.push(r),!0}toggleMovement(e=null){e==null&&(e=!this.canMove),this.canMove=e}updateMovement(e){if(!this.canMove)return;let t=[0,0],i=[...this.pxlDevice.directionKeysPressed],s=0,r=0,l=[e-this.pxlDevice.keyDownCount[0],e-this.pxlDevice.keyDownCount[1]],u=this.mobile?1:0;if(i[0]+i[2]==1){s=i[2]-i[0];let v=this.pxlQuality.settings.leftRight?this.cameraEasing[u]:(1-Math.min(1,Math.abs(this.cameraMovement[1]*.3)))*.5;t[0]=((this.pxlQuality.settings.leftRight?1:6)+l[0]*l[0]*.1)*v,t[0]=Math.min(this.pxlDevice.shiftBoost,t[0])*this.movementScalar}else this.pxlDevice.keyDownCount[0]=e;if(i[1]+i[3]==1){r=i[3]-i[1];let v=(1-Math.min(1,Math.abs(this.cameraMovement[0]*.07)))*this.cameraEasing[u];t[1]=l[1]*(l[1]*3+2+this.pxlDevice.shiftBoost)*.15*v,t[1]=Math.min(this.pxlDevice.shiftBoost,t[1])*this.movementScalar}else this.pxlDevice.keyDownCount[1]=e;this.cameraMovement[0]+=s*t[0],this.cameraMovement[1]+=r*t[1]}initFrameCamPosition(){let e=this.cameraPos.clone();if(!this.cameraBooted)this.cameraAimTarget.position.set(0,0,0),this.cameraPrevPos=new O.Vector3(e.clone()),this.cameraPrevLookAt=new O.Vector3(0,0,1);else{let t;t=new O.Vector3(this.pxlQuality.settings.leftRight?this.cameraMovement[0]*.5:0,0,this.cameraMovement[1]),this.cameraMoveLength=t.length(),t.applyQuaternion(this.camera.quaternion);let i=this.cameraMoveLength*this.cameraMoveLengthMult;if(i!=0){let s=.1;i=i>0?Math.max(s,i):Math.min(-s,i)}t.normalize().multiply(new O.Vector3(1,0,1)).multiplyScalar(i),e.add(t),this.cameraMovement[0]=Math.abs(this.cameraMovement[0])<this.posRotEasingThreshold?0:this.cameraMovement[0]*this.cameraMovementEase,this.cameraMovement[1]=Math.abs(this.cameraMovement[1])<this.posRotEasingThreshold?0:this.cameraMovement[1]*this.cameraMovementEase,e.y=this.cameraPos.y+this.cameraJumpVelocity,this.workerActive&&(this.cameraJumpVelocity=0)}return this.cameraCross=new O.Vector3(1,0,0).applyQuaternion(this.camera.quaternion),e}applyGravity(e){if(this.gravityActive){let t=this.maxStepHeight+this.gravityRate;if(e.y<this.nearestFloorHit.y){let s=this.nearestFloorHitPrev;e.y=Math.max(s.y,e.y),e.y<0&&(e.x=s.x,e.z=s.z)}else e.y=Math.max(this.nearestFloorHit.y,e.y-this.gravityRate),e.y==this.nearestFloorHit.y&&e.y<this.cameraPrevPos.y&&this.jumpLanding()}else if(e.distanceTo(this.nearestFloorHit)<this.maxStepHeight)e.y=this.nearestFloorHit.y;else{e=this.cameraPos.clone();let i=e.y>this.nearestFloorHit.y;this.gravityActive=i,this.colliderFail=!i,this.workerFunc("jumpLanding")}return e}getStandingHeight(){return this.standingHeight*this.userScale}getUserHeight(){let e=Math.min(1,Math.abs(this.cameraMovement[1]));this.walkBouncePerc=this.walkBouncePerc>=1?1:this.walkBouncePerc+.05,this.walkBounce+=e*.1,this.walkBouncePerc=this.walkBouncePerc*.9+e,this.walkBouncePerc<.03&&(this.walkBouncePerc=0,this.walkBounce=0,this.walkBounceSeed=Math.random()*2351.3256);let t=Math.sin(this.walkBounce*.4+this.walkBounceSeed+this.cameraMovement[1]*.2)*this.walkBouncePerc*.3;return this.getStandingHeight()-this.standingHeightGravInfluence+t}camApplyMobileRotation(){if(this.cameraPose.alpha!=null){let e=.017453292519943278,t=2.23606797749979,i=new O.Quaternion,s=this.cameraPose.alpha*e+this.cameraPose.alphaOffset+2.1,r=this.cameraPose.beta*e,l=this.cameraPose.gamma*e,u=new O.Vector3(0,0,1),v=new O.Quaternion,p=new O.Quaternion(-t,0,0,t),g=new O.Euler;g.set(r,s,-l,"YXZ"),i.setFromEuler(g),i.multiply(p),i.multiply(v.setFromAxisAngle(u,-this.cameraPose.orientation)),i.normalize();let m=new O.Quaternion;O.Quaternion.slerp(this.camera.quaternion,i,m,.35);let C=new O.Euler().setFromQuaternion(m);C.x=Math.max(-.95*Math.PI/2,Math.min(.95*Math.PI/2,C.x)),m.setFromEuler(C),this.camera.setRotationFromQuaternion(m)}}updateRoamCameraRotation(){if(this.cameraPose.alpha==null){let e=this.pxlDevice.gyroGravity[2],t=new O.Vector3(0,0,1),i=new O.Quaternion;this.pxlDevice.touchMouseData.velocity.y=Math.min(this.pi*500,Math.max(-this.pi*500,this.pxlDevice.touchMouseData.velocity.y));let s=new O.Euler,r;this.pxlDevice.mobile?(s.set(this.pxlDevice.touchMouseData.netDistance.y/this.pxlDevice.sH*2,this.pxlDevice.touchMouseData.netDistance.x/this.pxlDevice.sW*2,0,"YXZ"),r=new O.Quaternion,r.setFromEuler(s),r=this.pxlDevice.touchMouseData.initialQuat.clone().multiply(r)):(s.set(this.pxlDevice.touchMouseData.velocity.y*.005,this.pxlDevice.touchMouseData.velocity.x*.008+e,0,"YXZ"),r=new O.Quaternion,r.setFromEuler(s),r=this.camera.quaternion.clone().multiply(r)),r.normalize();let l=new O.Vector3(0,0,-10).applyQuaternion(r).add(this.camera.position);this.camera.setRotationFromQuaternion(r),this.camera.lookAt(l),this.camera.up.set(0,1,0)}}updateStaticCameraRotation(){let e=1;this.touchBlender?(e=Math.min(1,Math.max(0,this.pxlTimer.curMS-this.pxlDevice.touchMouseData.releaseTime)),e*=e,this.pxlDevice.touchMouseData.netDistance.multiplyScalar(1-e),this.touchBlender=e<1):this.pxlDevice.touchMouseData.netDistance.multiplyScalar(.5);let t=new O.Euler;t.set(this.pxlDevice.touchMouseData.netDistance.y/this.pxlDevice.sH*2,this.pxlDevice.touchMouseData.netDistance.x/this.pxlDevice.sW*2,0,"YXZ");let i=new O.Quaternion().clone(this.camera.quaternion);i.setFromEuler(t),i=this.camera.quaternion.clone().multiply(i),i.normalize(),this.touchBlender&&i.slerp(this.camera.quaternion.clone(),e).normalize();let s=new O.Vector3(0,0,-10).applyQuaternion(i).add(this.camera.position);this.camera.setRotationFromQuaternion(i),this.camera.lookAt(s),this.camera.up.set(0,1,0)}lookAtTargetLock(){if(this.lookAtTargetActive&&this.lookAtTargetActive&&(this.lookAtLockFader!=0&&(this.lookAtLockPerc+=(this.lookAtLockFader+Math.min(1,this.pxlDevice.touchMouseData.velocity.length()*.001))*this.lookAtLockFadeRate,(this.lookAtLockPerc<0||this.lookAtLockPerc>1)&&(this.lookAtLockPerc=this.lookAtLockPerc<0?0:1,this.lookAtLockFader=0),this.lookAtPerc.x=this.lookAtLockPerc),this.lookAtLockPerc>0)){let e=this.camera.quaternion.clone();this.camera.lookAt(this.cameraAimTarget.position);let t=this.camera.quaternion.clone();this.lookAtLockPerc==1?this.camera.setRotationFromQuaternion(t):this.camera.setRotationFromQuaternion(t.slerp(e,Math.cos(this.lookAtLockPerc*pi)*.5+.5))}}warpEventTriggered(e=0,t=null,i="init"){this.warpActive||(this.pxlEnv.mapComposerWarpPass.needsSwap=!0,this.warpType=e,this.warpObj=t,this.warpTarget=i,this.warpActive=!0,this.pxlEnv.initWarpVisual(e))}warpCamRun(){if(this.warpType==0)this.setToObj(this.warpObj);else if(this.warpType==1){let e=this.warpTarget=="init";this.warpToRoom(this.warpObj,e,this.warpTarget)}this.pxlEnv.setExposure(this.uniformScalars.exposureUniformBase),this.warpObj=null,this.warpTarget=null,this.warpActive=!1}lowQualityUpdates(){if(this.HDRView){let e=new O.Vector3(0,0,-1).applyQuaternion(this.camera.quaternion),t=e.clone().multiply(new O.Vector3(1,0,1)).normalize();this.camRotPitch.set(-Math.atan2(t.x,t.z)*.1591549430918955,e.y*.5)}}midQualityUpdates(){if(this.pxlQuality.settings.motion){let e=new O.Vector3(0,0,0);e.applyQuaternion(this.camera.quaternion),this.camRotXYZ.multiplyScalar(.8).add(e.multiplyScalar(.2));let t;if(this.pxlDevice.mobile){let r=sW*.5,l=sH*.5,u=new O.Vector3(0,0,10),v=new O.Vector3(0,0,10);u.applyQuaternion(this.camera.quaternion.clone()).project(this.camera),v.applyQuaternion(this.prevQuaternion).project(this.camera),u.x=(u.x+1)*r,u.y=-(u.y-1)*l,v.x=(v.x+1)*r,v.y=-(v.y-1)*l,t=v.clone().sub(u.clone()).multiplyScalar(.6).multiply(new O.Vector3(this.pxlDevice.screenRes.x,this.pxlDevice.screenRes.y,0));let p=.1;t.length>p&&t.normalize().multiplyScalar(p)}else t=this.pxlDevice.touchMouseData.velocity.clone().multiplyScalar(Math.max(this.pxlDevice.screenRes.x,this.pxlDevice.screenRes.y));let i=new O.Vector2(t.x,-t.y),s=new O.Vector2(0,0).lerpVectors(this.pxlEnv.blurDirPrev,i,.85);this.pxlEnv.blurDirPrev.set(this.pxlEnv.blurDirCur),this.pxlEnv.blurDirCur.set(s)}}emitCameraTransforms(e,t,i=!1){}jogServerMemory(){let e=this.cameraPos.clone(),t=this.getUserHeight();this.emitCameraTransforms(e,t,!0)}updateCamera(){this.updateStaticCameraRotation();let e=this.pxlDevice.touchMouseData.velocity.length();if(this.pxlDevice.touchMouseData.curFadeOut.multiplyScalar(.7),this.camUpdated||e!=0||this.pxlDevice.touchMouseData.active){this.camUpdated=!1;let t=!1;this.updateDeviceValues(e),this.pxlUser.localUserTurned=this.pxlDevice.touchMouseData.velocity.length()==0,this.prevQuaternion.copy(this.camera.quaternion);let i=this.initFrameCamPosition(),s=this.getUserHeight();if(this.canMove){if(this.pxlEnv.currentRoom==this.pxlEnv.mainRoom){let r=null,l=!1;i=this.mainColliderCheck(i,r)}else i=this.roomColliderCheck(i,s);this.updateGravity(),!this.colliderValid&&!this.colliderValidityChecked?this.jump=this.checkColliderValid(i):this.jump=0,this.eventCheckStatus=!0,i=this.applyGravity(i),this.pxlUser.localUserMoved=this.gravityActive||(this.cameraMovement[0]**2+this.cameraMovement[1]**2)**.5>0,this.cameraPrevPos=this.cameraPos.clone(),this.cameraPos=i.clone(),i.y+=s,this.camera.position.copy(i)}this.canMove?this.updateRoamCameraRotation():this.updateStaticCameraRotation(),this.camera.updateMatrixWorld(),this.emitCameraTransforms(i,s),this.cameraBooted=!0}else this.pxlUser.localUserMoved=!1,this.pxlUser.localUserTurned=!1}};import*as ue from"./three.module.js";var qe=class{constructor(e=!1){this.enabled=e,this.active=!1,this.mobile=null,this.pxlTimer=null,this.pxlUtils=null,this.pxlDevice=null,this.pxlAudio=null,this.pxlCamera=null,this.pxlEnv=null,this.camera=null,this.netDistance=new ue.Vector2,this.prevCamChange=0,this.nextCamChange=0,this.delayRange=[25,45],this.autoCamActive=!1,this.autoCamMode=0,this.autoCamPaths={},this.resetAutoCam=!0,this.autoCamPrevPos=null,this.autoCamPrevLookAt=null,this.touchBlender=!1,this.autoCamId=0,this.camMode=0,this.curModeCount=0,this.curRoom="",this.curRoomIndex=0,this.curPath=0,this.roomList=[],this.pathCounts={},this.forceNewRoom=!1,this.curRoomCount=0,this.avatarMin=0,this.avatarValid=!1,this.curAvatar=null,this.clusterReturn=!1,this.curCluster=[],this.clusterValid=2,this.clusterRotation=0,this.clusterRotRate=.005}setDependencies(e){this.pxlTimer=e.pxlTimer,this.pxlUtils=e.pxlUtils,this.pxlDevice=e.pxlDevice,this.pxlAudio=e.pxlAudio,this.pxlCamera=e.pxlCamera,this.pxlEnv=e.pxlEnv,this.camera=e.pxlCamera.camera}init(){this.active=this.enabled||this.mobile,this.autoCamActive=this.autoCamActive||this.mobile;let{roomList:e,pathCounts:t}=this.getAutoCamData();this.roomList=e,this.curRoom=this.roomList[0],this.pathCounts=t,this.setRoom(!1,!0),this.getNextPath(),this.checkStatus()}step(e=!1){if(this.autoCamActive==null||this.active==null)return this.autoCamActive=!1,this.active=!1,!0;if(this.active==!1)if(this.autoCamActive)this.updateAutoCamera();else return!0;if((this.pxlTimer.curMS>=this.nextCamChange||e)&&this.active&&!this.pxlDevice.touchMouseData.active){if(!e||!this.enabled){let t=this.checkCamMode();this.setNextTrigger(t)}this.curAvatar=0,this.camera.up.set(0,1,0),this.pxlDevice.touchMouseData.netDistance.multiplyScalar(0),this.camMode==1?this.setCamMode(0):this.camMode==2?this.setCamMode(0):(this.curCluster=[],this.stepDroneCam()),this.setAutoCamMode(this.camMode)}return this.updateAutoCamera(),this.applyTouchRotate(),!1}checkCamMode(){let e=1,t=this.camMode;return this.camMode=0,!this.enabled||!this.active||this.camMode!=t&&this.camMode==0&&(this.forceNewRoom=!0),e}setCamMode(e){let t=1;e.type==1||e.type==2?t=1:(this.camMode=0,this.forceNewRoom=!0),this.step(!0)}stepDroneCam(){let e=!0,t=Math.random(this.nextCamChange),i=this.pathCounts[this.pxlEnv.currentRoom];this.curRoomCount>=i*2&&(this.forceNewRoom=!0),(t<.3||this.forceNewRoom)&&(this.setRoom(),e=!1),this.curRoomCount+=1,this.getNextPath(e)}setRoom(e=!1,t=!1){if(this.active||this.autoCamActive){let i=this.curRoomIndex,s=this.roomList.length;this.pxlEnv.postIntro?t||(e?i=(i+1)%s:(i=Math.floor(Math.random()*s),i==this.curRoomIndex&&(i=(i+1)%s))):i=0,this.curRoomIndex=i,this.curRoom!=this.roomList[i]&&(this.curRoom=this.roomList[i],this.forceNewRoom=!1,this.curRoomCount=0,this.pxlCamera.warpEventTriggered(1,this.curRoom,"init"))}}setNextTrigger(e=1){let t=Math.random(this.nextCamChange);t=(this.delayRange[1]-this.delayRange[0])*t+this.delayRange[0],this.nextCamChange=this.pxlTimer.curMS+t*e}getNextPath(e=!0,t=1){if(this.autoCamPaths.hasOwnProperty(this.pxlEnv.currentRoom)){let i=this.autoCamPaths[this.pxlEnv.currentRoom].length;if(this.curPath=(this.curPath+t)%i,e&&t==0){let s=Math.random(this.nextCamChange);s=Math.floor(s*this.autoCamPaths[this.pxlEnv.currentRoom].length),this.curPath==s&&(s=(s+1)%i),this.curPath=s}else this.curPath=this.curPath<0?i-1:this.curPath,this.setNextTrigger(1);this.setAutoCamPath(this.curPath)}}checkStatus(){(this.autoCamActive||this.pxlDevice.mobile||this.active)&&this.toggleAutoCam(!0)}preAutoCamToggle(){this.autoCamActive||this.pxlCamera.colliderCurObjHit=="AudioTrigger_2"&&(this.pxlCamera.proximityScaleTrigger=!0,this.exposureShiftActive=!0),this.toggleAutoCam()}setAutoCamMode(e=0){this.autoCamMode=e,e==1&&(this.resetAutoCam=!0)}setPosQuat(e,t){this.camera.quaternion.copy(t),this.camera.position.copy(e),this.pxlCamera.updateCameraMatrices(),this.pxlCamera.camUpdated=!0}toggleAutoCam(e=null,t=1){if(this.pxlEnv.fogMult.x=1,this.autoCamPaths[this.pxlEnv.currentRoom]){this.curRoom=this.pxlEnv.currentRoom;let i=this.autoCamPaths[this.pxlEnv.currentRoom].length;isNaN(this.autoCamId)&&(this.autoCamId=i-1);let s=this.autoCamActive;if(this.autoCamActive=e==null&&i>0?!this.autoCamActive:e,this.autoCamActive=this.mobile||this.autoCamActive,!s&&this.autoCamActive&&(this.netDistance=new ue.Vector2().copy(this.pxlDevice.touchMouseData.netDistance)),this.pxlDevice.touchMouseData.netDistance.multiplyScalar(0),this.autoCamActive){this.pxlCamera.resetGravity(),this.autoCamId=(this.autoCamId+t)%i,this.autoCamId=this.autoCamId<0?i-1:this.autoCamId;let r=this.autoCamPaths[this.pxlEnv.currentRoom][this.autoCamId];this.totalLoopDuration=r.position.userData.duration;try{this.autoCamPositions=r.position.geometry.attributes.position,this.autoCamLookAt=r.lookAt.geometry.attributes.position,r.up?this.autoCamUp=r.up.geometry.attributes.position:(this.autoCamUp=null,this.camera.up.set(0,1,0)),this.numControlPoints=this.autoCamPositions.array.length/3,this.autoCamStartTime=this.pxlTimer.curMS-this.totalLoopDuration*Math.random()}catch{}}else this.setPosQuat(this.pxlCamera.cameraPrevPos.clone(),this.pxlCamera.prevQuaternion.clone()),this.pxlDevice.touchMouseData.netDistance.copy(this.netDistance)}}prevNextAutoCam(e=1,t=!1){this.autoCamActive&&(this.enabled&&this.active&&!t?this.nextCamChange=this.pxlTimer.curMS:this.toggleAutoCam(!0,e))}setAutoCamPath(e=0){this.autoCamActive&&(this.autoCamId=e,this.toggleAutoCam(!0,0))}getAutoCamData(){let e=Object.keys(this.autoCamPaths),t={};return e.forEach(i=>{t[i]=this.autoCamPaths[i].length}),{roomList:e,pathCounts:t}}getAutoCamValueFromCurve(e,t,i,s=!1){let r=e[t*3],l=e[t*3+1],u=e[t*3+2],v=(t+1)%this.numControlPoints,p=e[v*3],g=e[v*3+1],m=e[v*3+2],C=new ue.Vector3(r,l,u),y=new ue.Vector3(p,g,m);return C.lerp(y,i),C}updateAutoCamera(){if(!this.autoCamPositions||!this.autoCamPositions.array)return;let t=(this.pxlTimer.curMS-this.autoCamStartTime)%this.totalLoopDuration/this.totalLoopDuration;t*=this.numControlPoints-1;let i=Math.floor(t),s=t-i,r=this.getAutoCamValueFromCurve(this.autoCamPositions.array,i,s,!1);this.camera.position.copy(r);let l=this.getAutoCamValueFromCurve(this.autoCamLookAt.array,i,s);if(this.camera.lookAt(l),this.autoCamUp){let u=this.getAutoCamValueFromCurve(this.autoCamUp.array,i,s);u=u.sub(r).normalize(),this.camera.up.copy(u)}}applyTouchRotate(){let e=1;this.touchBlender?(e=Math.min(1,Math.max(0,this.pxlTimer.curMS-this.pxlDevice.touchMouseData.releaseTime)),e*=e,this.pxlDevice.touchMouseData.netDistance.multiplyScalar(1-e),this.touchBlender=e<1):this.pxlDevice.touchMouseData.netDistance.multiplyScalar(.5);let t=new ue.Euler;t.set(this.pxlDevice.touchMouseData.netDistance.y/this.pxlDevice.sH*2,this.pxlDevice.touchMouseData.netDistance.x/this.pxlDevice.sW*2,0,"YXZ");let i=new ue.Quaternion().clone(this.camera.quaternion);i.setFromEuler(t),i=this.camera.quaternion.clone().multiply(i),i.normalize(),this.touchBlender&&i.slerp(this.camera.quaternion.clone(),e).normalize();let s=new ue.Vector3(0,0,-10).applyQuaternion(i).add(this.camera.position);this.camera.setRotationFromQuaternion(i),this.camera.lookAt(s),this.camera.up.set(0,1,0)}};Vt();var tt=class{constructor(){this.pxlTimer=null,this.pxlVideo=null,this.pxlDevice=null,this.pxlEnv=null,this.pxlGuiDraws=null,this.pxlSocket=null,this.active=!1,this.audioTimer=new q(0,0,0),this.audioEq=new $t(0,0,0,0),this.audioWorker=null,this.audioProcessor=null,this.djUrlSource="//",this.djMuted=!1,this.djAudioVolume=0,this.djAudioVolumeMax=.65,this.djAudioVolumeMin=.25,this.djAudioVolumeScalar=.25,this.djAudioObj=null,this.djTimecodeObj=null,this.djVolumeParentObj=null,this.djVolumeObj=null,this.roomAudioStopped=!0,this.videoStreamObjects=[],this.colliderVolActive=!1,this.isVideoObject=!1,this.activeObject=null,this.fadeActive=!1,this.fadeAdjustRate=.02,this.fadeDir=0,this.fadePerc=0,this.audioContext=null}setDependencies(e){this.pxlTimer=e.pxlTimer,this.pxlVideo=e.pxlVideo,this.pxlDevice=e.pxlDevice,this.pxlEnv=e.pxlEnv,this.pxlGuiDraws=e.pxlGuiDraws,this.pxlSocket=e.pxlSocket}init(){this.active=!0}postBoot(){if(this.djAudioObj){if(this.pxlEnv.pxlAutoCam.enabled)this.djAudioVolumeMax=1,this.djAudioVolumeMin=0;else if(this.pxlEnv.mobile){let l=function(u){setTimeout(()=>{i.djAudioVolume=0,i.djAudioVolumeMax=s,i.djAudioVolumeMin=0,i.djAudioObj.byScript=!0,i.djAudioObj.volume=0,e.play().then(()=>{i.djPlayerMuteToggle(!1),i.setFadeActive(.5)}),r.removeEventListener("click",l),r.removeEventListener("touchstart",l)},500)},i=this,s=this.djAudioVolumeMax,r=document.getElementById("guiMobileWelcomeButton");r.addEventListener("click",l),r.addEventListener("touchstart",l)}this.djAudioVolume=this.pxlEnv.enabled?0:this.djAudioVolumeMin,this.djAudioObj.volume=this.pxlEnv.enabled?0:this.djAudioVolumeMin,this.djPlayerMuteToggle(!1),this.djPlayerAdjustVolume({}),this.djPlayerSetSliderGui();let e=this.djAudioObj;e.setAttribute("autoplay",!0);let t=this;this.djAudioObj.addEventListener("volumechange",i=>{t.djPlayerSetSliderGui()},!0)}}start(){}step(){this.djAudioObj&&this.djAudioObj.paused&&(this.djAudioObj.play().catch(e=>{}),this.djAudioObj.muted=this.djMuted||!this.roomAudioStopped),this.fadeAudioEvent()}isPaused(){let e=!0;return this.djAudioObj&&(e=this.djAudioObj.paused),e}pausePlayback(){this.active=this.pxlTimer.active,this.active?this.play():this.stop()}initPlay(){this.pxlVideo.canUnmute("dj")&&!this.isPaused()&&(this.djPlayerMuteToggle(!1),this.setFadeActive(1),this.pxlDevice.mobile&&this.pxlGuiDraws.toggleIcon(this.pxlGuiDraws.hudIcons.musicIcon,!this.djMuted,!0))}play(){if(this.active=!0,this.isVideoObject)this.pxlVideo.setVolume("dj",this.djAudioVolume),this.pxlVideo.setMuted("dj",this.djMuted);else{this.djAudioObj.byScript=!0;let e=this.djAudioObj;e.children[0].setAttribute("src",this.djUrlSource),setTimeout(()=>{e.load(),setTimeout(()=>{e.volume=this.djAudioVolume,e.muted=this.djMuted||!this.roomAudioStopped,e.paused&&e.play()},20)},20)}}stop(){if(this.active=!1,this.isVideoObject)this.pxlVideo.setMuted("dj",!0);else{let e=this.djAudioObj;e.children[0].setAttribute("src",""),e.pause(),setTimeout(()=>{e.load()},20)}}djBuildPlayer(){this.djAudioObj=document.getElementById("djStream"),this.djVolumeParentObj=document.getElementById("djPlayerVolumeParent"),this.djVolumeObj=document.getElementById("djPlayerVolume"),this.djAudioObj.byScript=!1,this.djAudioObj.volume=0,this.djVolumeObj.style.width="0%";let e=this;this.pxlDevice.objectPercList.push("djPlayerVolume"),this.pxlDevice.objectPercList.push("djPlayerVolumeParent"),this.pxlDevice.objectPercFuncList.djPlayerVolumeParent=t=>{e.djPlayerAdjustVolume(t)},this.djVolumeParentObj.down=!1,this.djVolumeParentObj.addEventListener("mousedown",t=>{e.djVolumeParentObj.down=!0,e.djPlayerAdjustVolume(t)}),this.djVolumeParentObj.addEventListener("mousemove",t=>{e.djPlayerAdjustVolume(t)}),this.djVolumeParentObj.addEventListener("mouseup",t=>{e.djVolumeParentObj.down=!1}),this.pxlDevice.mobile&&(this.djVolumeParentObj.style.width="30vw",this.djVolumeParentObj.addEventListener("touchstart",t=>{e.djVolumeParentObj.down=!0},{passive:!0}),this.djVolumeParentObj.addEventListener("touchmove",t=>{e.djPlayerAdjustVolume(t)},{passive:!0}),this.djVolumeParentObj.addEventListener("touchend",t=>{e.djVolumeParentObj.down=!1},{passive:!0})),this.djAudioObj.muted=!0,this.prepAudioProcessor()}prepAudioProcessor(){}stepAudioProcessor(){}recieveAudioProcessor(e){}buildRemoteAudioMixer(e,t){if(0)var i,s,r;return!1}loadStreamPromise(){let e=this.djAudioObj;return new Promise((t,i)=>{this.djAudioObj.byScript=!0,e.children[0].setAttribute("src",this.djUrlSource),e.load(),e.muted=this.djMuted||!this.roomAudioStopped}).then(()=>{}).catch(t=>{console.log("error source")})}djPlayerSetSliderGui(){this.djAudioObj.byScript||!this.pxlEnv.postIntro||this.pxlEnv.pxlAutoCam.enabled?this.djAudioObj.byScript=!1:(this.fadeActive=!1,this.djAudioVolumeMax=this.djAudioVolume,this.djAudioVolumeMin=this.djAudioVolume*this.djAudioVolumeScalar),this.djVolumeObj.style.width=this.djAudioVolume*100*~~!this.djMuted+"%"}djPlayerAdjustVolume(e){if(this.djVolumeParentObj.down||this.djVolumeParentObj.down&&e.touches){let t=this.djVolumeParentObj.offsetWidth,i=0;e.touches?i=this.pxlDevice.objectPerc.percX:i=e.offsetX/t;let s=Math.max(0,Math.min(1,i));this.djAudioVolume=s,this.djAudioVolumeMax=s,this.djAudioVolumeMin=s*.1,s*=s,this.djAudioObj&&(this.djAudioObj.volume=s),e.touches&&this.djPlayerSetSliderGui()}this.pxlVideo&&this.pxlEnv.posted&&this.pxlVideo.setVolume("dj",this.djAudioVolume)}djPlayerMuteToggle(e=null){this.djMuted=e??!this.djMuted,e!=null&&this.pxlGuiDraws.toggleIcon(this.pxlGuiDraws.hudIcons.musicIcon,!e,!0),this.djAudioObj&&(this.djAudioObj.muted=this.djMuted,this.djAudioObj.byScript=!0,this.djAudioObj.volume=this.djAudioObj.volume),this.pxlVideo&&this.pxlEnv.posted&&this.pxlVideo.setMuted("dj",this.djMuted)}setFadeActive(e=1){this.fadeDir!=e&&(this.fadeDir=e,this.fadeActive=!0)}fadeAudioEvent(){if(this.djVolumeParentObj&&!this.djVolumeParentObj.down&&this.fadeActive&&this.pxlEnv.postIntro){if(this.fadePerc+=this.fadeAdjustRate*this.fadeDir,this.fadePerc<0||this.fadePerc>1){this.fadePerc=this.fadeDir==1?1:0,this.fadeActive=!1;return}let e=(this.djAudioVolumeMax-this.djAudioVolumeMin)*this.fadePerc+this.djAudioVolumeMin;this.djAudioVolume=e,e*=e,this.djAudioObj&&(this.djAudioObj.byScript=!0,this.djAudioObj.volume=e),this.pxlVideo.setVolume("dj",this.djAudioVolume)}}};var Ot={};re(Ot,{camPosVert:()=>Gi,defaultShiftVert:()=>Oi,defaultVert:()=>Vi,discardFrag:()=>ji,shaderHeader:()=>I});function I(){return`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
    #else
      precision mediump float;
    #endif
        `}function Vi(){let o=I();return o+=`
  varying vec2 vUv;
  void main(){
    vUv=uv;
    vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);
    gl_Position = projectionMatrix*modelViewPosition;
  }`,o}function Oi(){let o=I();return o+=`
  varying vec2 vUv;
  varying vec2 vUvShift;
  void main(){
    vUv=uv;
        vUvShift=uv-.5;
    vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);
    gl_Position = projectionMatrix*modelViewPosition;
  }`,o}function Gi(){let o=I();return o+=`
  varying vec3 camPos;
  varying vec2 vUv;
  void main(){
    vUv=uv;
    vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);
    gl_Position = projectionMatrix*modelViewPosition;
    camPos=(modelViewMatrix*vec4(0.0,0.0,1.0,1.0)).xyz;
  }`,o}function ji(){let o=I();return o+=`
  void main(){
    discard;
    gl_FragColor=vec4(.0,.0,.0,0.0);
  }`,o}var Gt={};re(Gt,{animTextureFrag:()=>zi,animTextureVert:()=>Wi,clickableBevelFrag:()=>Ni,clickableBevelVert:()=>Qi,portalBaseFrag:()=>Xi,portalBaseVert:()=>Ki});function Wi(){let o=I();return o+=`
  varying vec2 vUv;
  void main(){
    vUv=uv;
    vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);
    gl_Position = projectionMatrix*modelViewPosition;
  }`,o}function zi(){let o=I();return o+=`
  uniform vec2 time;
  uniform float rate;
  uniform float freq;
  uniform float intensity;
  uniform vec3 glowColor;
  uniform sampler2D glowTexture;
  varying vec2 vUv;
  float pi=3.14159265358979;
  
  void main(){
    vec4 glowCd=texture2D(glowTexture, vUv);
    vec4 Cd=vec4(glowColor,1.0);
    Cd.rgb*=(cos(glowCd.g*pi*freq+time.x*rate)*.5+.5)*(1.0-glowCd.b)*intensity+glowCd.b;
    Cd.rgb*=glowCd.r*glowCd.a;
    gl_FragColor=Cd;
  }`,o}function Qi(){let o=I();return o+=`
    uniform vec2 time;
    uniform float rate;
    varying vec3 pos;
    varying float nDot;
    varying vec2 vUv;
    
    void main(){
      vUv=uv+vec2(rate*time.x, 0.0);
      vec3 camDir=normalize( (projectionMatrix*viewMatrix*vec4(0.0,0.0,-1.0,1.0)).xyz );
      nDot=dot( normal, camDir );
      
      pos=position;
      vec4 modelViewPosition=modelViewMatrix * vec4(pos, 1.0);
      gl_Position = projectionMatrix*modelViewPosition;
      
    }`,o}function Ni(){let o=I();return o+=`
    uniform sampler2D alphaMap;
    uniform sampler2D cloudNoise;
    uniform vec2 time;
    uniform vec2 intensity;
    uniform float rate;
    varying vec3 pos;
    varying float nDot;
    varying vec2 vUv;
    
    void main() {
      vec4 Cd=vec4( 1.0 );
      Cd.rgb= mix( vec3(.05,.1,.5), vec3(.3,.5,1.0), intensity.x);
      
      vec2 nUV=pos.xy*.01+vec2(time.x*rate*.1, time.x*rate*.1);
      vec4 noiseCd=texture2D(cloudNoise,nUV);
      noiseCd.xyz=noiseCd.xyz*2.0-1.0;
      nUV=vUv+noiseCd.xy*.05;
      
      float alpha=texture2D(alphaMap,nUV).r;
      float blender=(nDot*.5+.5);
      Cd.rgb=Cd.rgb*(1.0+alpha);//mix( vec3(0.5,0.5,1.0), vec3(0.0,0.2,0.8), blender); // Center Color, Edge Color
      alpha=1.0-(1.0-alpha)*(1.0-alpha);
      alpha*=alpha;
      Cd.a=alpha+alpha;
      gl_FragColor = Cd;
    }`,o}function Ki(){let o=I();return o+=`
        uniform vec2 time;
        uniform float rate;
        varying vec2 shiftUv;
        varying vec2 wUv;
        
        void main(){
            shiftUv=(uv-.5);
            
            float t=time.x*rate;
            vec2 rot=vec2( sin(t), cos(t) );
            vec2 rotUV=vec2(0.0);
            rotUV.x=rot.y*(uv.x-.5) + rot.x*(uv.y-.5);
            rotUV.y=rot.y*(uv.y-.5) - rot.x*(uv.x-.5);
            wUv=rotUV+.5;
            
            vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);
            gl_Position = projectionMatrix*modelViewPosition;
            
        }`,o}function Xi(){let o=I();return o+=`
        uniform vec3 color;
        uniform sampler2D alphaMap;
        uniform sampler2D cloudNoise;
        uniform vec2 intensity;
        varying vec2 shiftUv;
        varying vec2 wUv;
        
        #define TAU 6.28318530717958
        void main() {
            float suvLength=length(shiftUv)+.1;
            vec2 suvSign=sign(shiftUv);
            
            vec2 rUv=sin( (suvLength+wUv*10.*shiftUv)*.5 );
            rUv *= suvLength ;
            
            vec4 noiseCd=texture2D(cloudNoise,rUv);
            vec2 aUv=wUv*(noiseCd.xy*.5+wUv);
            
            float alpha=texture2D(alphaMap,aUv).r;
            
            vec4 Cd=vec4( color*intensity.x*(1.0+alpha)*mix( noiseCd.rgb, vec3(1.0), alpha), 1.);
            alpha*=max(0.0, alpha-noiseCd.r*noiseCd.g*noiseCd.b );
            Cd.a=min(1.0, alpha);
            
            gl_FragColor = Cd;
        }`,o}var jt={};re(jt,{itemBaseFrag:()=>$i,itemBaseVert:()=>Yi,itemFrag:()=>Ji,itemVert:()=>Zi,itemZoomFrag:()=>qi,pxlPrincipledFrag:()=>ts,pxlPrincipledVert:()=>es});function Yi(){let o=I();return o+=`
    uniform vec2 time;
    uniform float intensity;
    uniform float rate;
    varying vec3 pos;
    varying float nDot;
    varying vec2 vUv;
    
    void main(){
      vUv=uv+vec2(rate*time.x, 0.0);
      vec3 camDir=normalize( (projectionMatrix*viewMatrix*vec4(0.0,0.0,-1.0,1.0)).xyz );
      nDot=dot( normal, camDir );
      
      pos=position;
      vec4 modelViewPosition=modelViewMatrix * vec4(pos, 1.0);
      gl_Position = projectionMatrix*modelViewPosition;
      
    }`,o}function $i(){let o=I();return o+=`
    uniform vec3 color;
    uniform sampler2D alphaMap;
    uniform sampler2D cloudNoise;
    uniform vec2 time;
    uniform float intensity;
    uniform float rate;
    varying vec3 pos;
    varying float nDot;
    varying vec2 vUv;
    
    void main() {
      vec4 Cd=vec4( color, 1.0);
      
      
      vec2 nUV=pos.xy*.01+vec2(time.x*rate*.1, time.x*rate*.1);
      vec4 noiseCd=texture2D(cloudNoise,nUV);
      noiseCd.xyz=noiseCd.xyz*2.0-1.0;
      nUV=vUv+noiseCd.xy*.05;
      
      float alpha=texture2D(alphaMap,nUV).r;
      float blender=(nDot*.5+.5);
      Cd.rgb=color*intensity*(1.0+alpha);//mix( vec3(0.5,0.5,1.0), vec3(0.0,0.2,0.8), blender); // Center Color, Edge Color
      alpha=1.0-(1.0-alpha)*(1.0-alpha);
      alpha*=alpha;
      Cd.a=alpha+alpha;
      gl_FragColor = Cd;
    }`,o}function Zi(){let o=I();return o+=`
    uniform vec2 time;
    uniform float intensity;
    uniform float rate;
    varying vec3 pos;
    varying float nDot;
    varying vec2 vUv;
    varying vec2 nUv;
    
    void main(){
      vUv=uv;
      nUv=uv*.5+vec2(rate*time.x*-.1, 0.0);
      nUv.x=sin(nUv.x)*.5+.5;
      vec3 camDir=normalize( (projectionMatrix*viewMatrix*vec4(0.0,0.0,-1.0,1.0)).xyz );
      nDot=dot( normal, camDir );
      
      vec2 nUV=position.xy*.01+vec2(time.x*rate*.1, time.x*rate*.1);
      vec3 pos=position;
      vec4 modelViewPosition=modelViewMatrix * vec4(pos, 1.0);
      gl_Position = projectionMatrix*modelViewPosition;
      
    }`,o}function Ji(){let o=I();return o+=`
    uniform vec3 color;
    uniform sampler2D alphaMap;
    uniform vec2 time;
    uniform float intensity;
    uniform float rate;
    uniform sampler2D cloudNoise;
    varying vec3 pos;
    varying float nDot;
    varying vec2 vUv;
    varying vec2 nUv;
    
    void main() {
      vec4 Cd=vec4( color, 1.0);
      float alpha=texture2D(alphaMap,vUv).r;
      float noise=length(texture2D(cloudNoise,nUv).rgb)*.5;
      float blender=(nDot*.5+.5);
      Cd.rgb=color*blender;
      Cd.rgb*=intensity*alpha;
      Cd.a=blender*alpha+noise*alpha;
      gl_FragColor = Cd;
    }`,o}function qi(){let o=I();return o+=`
    uniform sampler2D color;
    uniform vec2 time;
    uniform float intensity;
    uniform sampler2D cloudNoise;
    varying vec2 vUv;
    
    void main() {
      vec4 Cd=texture2D(color,vUv);
      Cd.a=Cd.b;
      Cd.rgb=vec3( Cd.rg*Cd.a, 0.0 );
      Cd.rgb*=Cd.a* mix(.7, 1.0, gl_FrontFacing);
      gl_FragColor = Cd;
    }`,o}import*as Ue from"./three.module.js";function es(o=!1){let e=`
    attribute vec3 color;
    attribute vec3 shading;

    varying float vFlicker;
    varying vec2 vUv;
    varying vec3 vCd;
    varying vec3 vPos;
    varying vec3 vLocalPos;
    varying vec3 vN;
    varying vec3 vLocalN;
    varying vec3 vShading;
    `;return o&&(e+=`
        ${Ue.ShaderChunk.common}
        ${Ue.ShaderChunk.shadowmap_pars_vertex}
      `),e+=`
    
    void main(){
        vUv=uv;
        
        vShading=shading;
        
        vCd=color;
        
        vec3 transformed = vec3( position );
        vec3 objectNormal = vec3( normal );
        vec3 transformedNormal = objectNormal;
        
        
        vLocalPos = position;
        vN = (modelViewMatrix * vec4(normal, 0.0)).xyz;
        vLocalN = ( modelMatrix * vec4(normal, 0.0)).xyz;
        vec4 mvPos=modelViewMatrix * vec4(position, 1.0);
        gl_Position = projectionMatrix*mvPos;
        vPos = mvPos.xyz;
        
        `,o&&(e+=`
            ${Ue.ShaderChunk.worldpos_vertex}
            ${Ue.ShaderChunk.shadowmap_vertex}
          `),e+=`
    }`,e}function ts(o,e,t,i,s,r){let l=!1,u=1;o.hasOwnProperty("Specular")&&o.Specular>0&&(l=!0,u=o.Specular);let v=!1;o.PointColor&&(v=!0);let p=!0,g="1.0";o.hasOwnProperty("SurfaceNoise")&&(o.SurfaceNoise%1==0&&(g=o.SurfaceNoise+".0"),g=="0.0"&&(p=!1));let m=`
        `;if(e||(m+="uniform sampler2D dTexture;"),m+=`
    
    uniform sampler2D noiseTexture;
    uniform sampler2D detailTexture;
        
    uniform vec2 time;
    uniform float cdMult;
    uniform vec3 fogColor;
    
    varying vec2 vUv;
    varying vec3 vCd;
    varying vec3 vPos;
    varying vec3 vLocalPos;
    varying vec3 vN;
    varying vec3 vLocalN;
    varying vec3 vShading;
    
    varying float vFlicker;
    
    #define PI 3.14159265358979
    
    struct PointLight {
      vec3 color;
      float decay;
      float distance;
      vec3 position;
    };
    struct DirLight {
      vec3 color;
      vec3 direction;
    };
    `,i&&(m+=`
    #if NUM_POINT_LIGHTS > 0
      uniform PointLight pointLights[NUM_POINT_LIGHTS];
    #endif
    #if NUM_DIR_LIGHTS > 0
      uniform DirLight directionalLights[NUM_DIR_LIGHTS];
    #endif
      `),s&&(m+=`
      
      ${Ue.ShaderChunk.packing}
      
      #if NUM_POINT_LIGHT_SHADOWS > 0
          uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
          varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
          struct PointLightShadow {
              float shadowBias;
              float shadowNormalBias;
              float shadowRadius;
              vec2 shadowMapSize;
              float shadowCameraNear;
              float shadowCameraFar;
          };
          uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
      #endif
      float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
          return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
      }
      vec2 cubeToUV( vec3 v, float texelSizeY ) {
          vec3 absV = abs( v );
          float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
          absV *= scaleToCube;
          v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
          vec2 planar = v.xy;
          float almostATexel = 1.5 * texelSizeY;
          float almostOne = 1.0 - almostATexel;
          if ( absV.z >= almostOne ) {
              if ( v.z > 0.0 )
                  planar.x = 4.0 - v.x;
          } else if ( absV.x >= almostOne ) {
              float signX = sign( v.x );
              planar.x = v.z * signX + 2.0 * signX;
          } else if ( absV.y >= almostOne ) {
              float signY = sign( v.y );
              planar.x = v.x + 2.0 * signY + 2.0;
              planar.y = v.z * signY - 2.0;
          }
          return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
      }
      float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
          vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
          vec3 lightToPosition = shadowCoord.xyz;
          float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );
           dp += shadowBias;
          vec3 bd3D = normalize( lightToPosition );
          #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
              vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
              return (
                  texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
                  texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
                  texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
                  texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
                  texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
                  texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
                  texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
                  texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
                  texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
              ) * ( .11111111111 ) * (1.0-dp);
          #else
              return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) * (1.0-dp);
          #endif
      }
    
      vec3 directionToLight( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar  ){
          vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
          vec3 lightToPosition = shadowCoord.xyz;
          float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );
          dp += shadowBias;
          vec3 bd3D = normalize( lightToPosition );
          vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
          return texture2D( pointShadowMap[1], cubeToUV( bd3D, texelSize.y )).rgb;
      }
      `),m+=`
    void main(){
      `,v)m+="vec3 vertCd = vCd;";else if(e){let w=L=>L%1==0?L+".0":L+"",b=w(e.r),P=w(e.g),S=w(e.b);m+=`vec3 vertCd = vec3( ${b}, ${P}, ${S} ) ;`}else m+="vec3 vertCd = texture2D(dTexture,vUv).rgb ;";m+=`
        
        vec4 Cd=vec4( vertCd, 1.0 );
        float specular = 0.0;
        `,t&&(m+=`
          float depth = gl_FragCoord.z / gl_FragCoord.w *.0004;
          Cd.rgb=  mix( Cd.rgb, fogColor, depth );
          `);let C="",y="",f="";if(p&&(g!="1.0"&&(C="*"+g),m+=`
            float detailMult = (texture2D(detailTexture,vUv*4.0).r)*.5+.5;
            `,y=`+detailMult * (shadowInf*.5+.5) ${C}`,f=`(detailMult+.5) ${C}`),i&&(m+=`
          #if NUM_POINT_LIGHTS > 0 || NUM_DIR_LIGHTS > 0
            vec4 lights = vec4(0.0, 0.0, 0.0, 1.0);
          #endif
          
          #if NUM_POINT_LIGHTS > 0
            for(int i = 0; i < NUM_POINT_LIGHTS; i++) {
                vec3 lightVector = normalize(vPos - pointLights[i].position);
                vec3 lightInf= clamp(dot(-lightVector, vN), 0.0, 1.0) * pointLights[i].color;
                //lightInf = mix( lightInf, 1.0-(1.0-lightInf)*(1.0-lightInf), .2);
                float distFalloff =  1.0-min(1.0, length(vPos - pointLights[i].position) * pointLights[i].decay*.008 );
                lightInf *=  distFalloff;
                lights.rgb += lightInf;
                `,l&&(m+=`
                  distFalloff = (dot(vN, normalize(-vPos)) )*distFalloff;
                  specular += distFalloff;
                  `),m+=`
            }
          #endif
            
          #if NUM_DIR_LIGHTS > 0
            for(int i = 0; i < NUM_DIR_LIGHTS; i++) {
                vec3 lightInf= max(0.0, dot(directionalLights[i].direction, vN)*.65+.35) * directionalLights[i].color;
                lights.rgb += lightInf;
            }
          #endif
            
            
          #if NUM_POINT_LIGHTS > 0 || NUM_DIR_LIGHTS > 0
            Cd.rgb *= lights.rgb;
          #endif
          `,l&&(m+=`
            Cd.rgb += vertCd * specular * ${u};
            `)),s){m+=`
          #if NUM_POINT_LIGHT_SHADOWS > 0
            
            float shadowInf = 0.0;
            float detailInf = 0.0;
            float lShadow = 0.0;
            int i = 0;
            `;for(let w=0;w<r;++w)m+=`
                i=${w};
                lShadow = getPointShadow( pointShadowMap[${w}], pointLightShadows[i].shadowMapSize, pointLightShadows[i].shadowBias*.1, pointLightShadows[i].shadowRadius*.5, vPointShadowCoord[i], pointLightShadows[i].shadowCameraNear, pointLightShadows[i].shadowCameraFar );
                shadowInf = max( lShadow, shadowInf);
                `;m+=`
            shadowInf = shadowInf;//*.75+.25;
            Cd.rgb*=shadowInf ${y} ;
            `,p&&(m+=`
              #else
                Cd.rgb*=${f};
              `),m+=`
          #endif
          `}else p&&(m+=`
            Cd.rgb*=${f};
            `);return m+=`
        Cd*=cdMult;
        gl_FragColor=Cd;
    }`,m}var Wt={};re(Wt,{dustFrag:()=>as,dustVert:()=>rs,emberWispsFrag:()=>ss,emberWispsVert:()=>is,smokeFrag:()=>ls,smokeVert:()=>os,snowFrag:()=>us,snowVert:()=>ns});function is(o=[-.13,.15]){let e=I();return e+=`
        
    uniform sampler2D noiseTexture;
    uniform vec2 time;
    uniform float rate;
    uniform vec2 pointScale;
    uniform vec3 sliders;
    
    attribute vec4 seeds;
    attribute vec2 atlas;
    
    varying vec3 vCd;
    varying vec2 vAtlas;
    varying vec2 vRot;
    varying float vAlpha;
    varying float vBrightness;
    
    #define PROX 60.0
    #define LAND 10.0
    
    const vec2 windForce = vec2(${o[0]}, ${o[1]});
    
    const vec3 earlyCd = vec3( 1.0, 0.7, .1 );
    const vec3 oldCd = vec3( 0.634, 0.50, 0.20 );
    const float emberSpread = 15.0;
    const float emberFadeDistance = 0.04;
    const float baseSpeed = 0.47;
    
    
    float colDetect( vec2 pos, vec2 pt, vec2 n1, vec2 n2 ){
        vec2 ref=pos-pt;
        float ret = step( dot( ref, n1 ), 0.0 );
        ret *= step( dot( ref, n2 ), 0.0 );
        
        return ret;
    }
    
    
    void main(){
        vAtlas=atlas;
        
        float rot=seeds.z+time.x*(seeds.z*2.);
        vRot=vec2( sin(rot), cos(rot) );
        
        vec3 pOff=vec3(seeds.z, seeds.y, seeds.w) * vec3(PROX);
        
        vec2 sinUV=abs(sin(pOff.xz*.5+seeds.zw+time.x*.1)*.5+.5);
        vec3 noiseCd=texture2D(noiseTexture, sinUV ).rgb*4.5 + 0.50;
        
        float rateShift = (baseSpeed*(seeds.x*.4+.6));
        float t=time.x*rate*rateShift;
        float shiftY= mod( t+t*seeds.x+seeds.z*8.0+noiseCd.r*10.20*(seeds.y*2.0-1.0)+noiseCd.b+(-seeds.x+seeds.y)*4.0, 10.0);
        float life = 1.0-max(0.0,abs(shiftY-seeds.x*.1)*(1.0-(seeds.x*1.0)) );
        life = 1.0-((shiftY*.001-seeds.x*.2) );
        
        pOff.y=shiftY*seeds.y;
        
        pOff.y=(pOff.y)+shiftY; 
        vec3 pos= pOff ;
        

        pos.xz=(noiseCd.rg*noiseCd.r)*(seeds.x)*emberSpread*(life*seeds.zy*(seeds.w*4.0-2.));
        
        float yPush = ( life * (life*.5+.5))  * min(1.0,pos.y*.12) * 5.8;
        pos.xz += windForce * yPush * pos.y + vec2(1.25, .0);
        pos.y += yPush;
        
        
        
        float pScalar = max( 0., (1.-length(pos-cameraPosition )*0.017)  );
        float aMult = min(1.0, pScalar*3.0);
        vAlpha = (seeds.x*.15+.7) * aMult;

        
        vAlpha=max(0.0, life*life-seeds.z-seeds.z);
        float distMult = ( length( pos )*emberFadeDistance );
        distMult = 1.0 - ( distMult * distMult );
        vAlpha *= distMult;
        
        vec3 doubleCd=texture2D(noiseTexture, sinUV+pos.xz*.3+vec2(0.0,pos.y)).rgb*2.0 ;
        pos.xz+=doubleCd.rb ;
        
        
        float pScale = pointScale.x * seeds.w * pScalar + 2.0;
        
        gl_PointSize = pScale;
        
        pos += modelMatrix[3].xyz - vec3(1.0, 0.50, 0.2);
        vec4 mvPos=viewMatrix * vec4(pos, 1.0);
        gl_Position = projectionMatrix*mvPos;
        
        float cdAge = clamp( 1.0 - life, 0.0, 1.0);
    
    //earlyCd, oldCd
        vCd = mix( earlyCd, oldCd, cdAge )  ;
        vBrightness = 1.45;
        
    } `,e}function ss(){let o=I();return o+=`        
    uniform sampler2D atlasTexture;
    uniform vec2 time;
    uniform float rate;
    
    varying vec3 vCd;
    varying vec2 vAtlas;
    varying vec2 vRot;
    varying float vAlpha;
    varying float vBrightness;
    
    void main(){
        vec2 uv=gl_PointCoord;

        vec2 pos = (uv-.5)*.85;

        vec2 rotUV;
        rotUV.x = vRot.y * pos.x - vRot.x * pos.y;
        rotUV.y = vRot.x * pos.x + vRot.y * pos.y;
        rotUV=(rotUV+.5)*.25+vAtlas;
        
        vec4 dustCd=texture2D(atlasTexture,rotUV);
        float alpha=dustCd.a*vAlpha;
        
        //dustCd.rgb = 1.0 - (1.0 - dustCd.rgb ) * vBrightness;
        dustCd.rgb *= vBrightness;
        
        vec4 Cd=vec4( dustCd.rgb * vCd * vBrightness, alpha );
        gl_FragColor=Cd;
    }`,o}function rs(o,e=120){let t=I();return t+=`
                
    uniform sampler2D noiseTexture;
    uniform vec2 time;
    uniform float rate;
    uniform vec2 pointScale;
    uniform vec3 positionOffset;
    uniform vec2 windDir;
  `,o>0&&(t+=`uniform vec3[${o}] lightPos;`),t+=`
    
    attribute vec4 seeds;
    attribute vec2 atlas;
    
    varying vec2 vAtlas;
    varying vec2 vRot;
    varying float vScalar;
    varying float vAlpha;
    
    #define PROX ${e.toFixed(3)}
    #define PROX_INV 1.0/${(e*1.8).toFixed(3)}
    
    #define LIGHT_COUNT ${o}
    
    
    float colDetect( vec2 pos, vec2 pt, vec2 n1, vec2 n2 ){
        vec2 ref=pos-pt;
        float ret = step( dot( ref, n1 ), 0.0 );
        ret *= step( dot( ref, n2 ), 0.0 );
        
        return ret;
    }
    
    
    void main(){
        vAtlas=atlas;
        
        float rot=seeds.z+time.x*(seeds.z*2.);
        vRot=vec2( sin(rot), cos(rot) );
        
        float t=time.x*rate;
        
        vec3 pOff=seeds.xyz * vec3(PROX);
        
        // Loop point positions based on camera location
        float yFract=fract(t+seeds.x);
        pOff.y+=cameraPosition.y ; 
        pOff.x+=time.x*windDir.x; 
        pOff.z+=time.x*windDir.y; 
        vec3 pos= pOff ;
        
        vec3 noiseCd=texture2D(noiseTexture, sin(pos.xz*.05+seeds.xz+time.x*.1)*.5+.5 ).rgb-.5;
        
        pos.y = (pos.y-.1)*.45;
        pos.y+=sin(seeds.x+seeds.z+noiseCd.r*noiseCd.g+noiseCd.b+time.x*.2)*2.;//+noiseCd.r*noiseCd.g*noiseCd.b*20.;

        pos.xz+=(noiseCd.rg*noiseCd.b)*((seeds.w+.75)*4.);
        vec2 camXZ=cameraPosition.xz;
        pos.xz= mod( pos.xz-camXZ, PROX) + camXZ - PROX*.5;
        
        float pScalar = max( 0., (1.-length(pos-cameraPosition )*PROX_INV)  );
        float aMult = min(1.0, pScalar*3.0);
        vAlpha = (seeds.x*.5+.7) * aMult;

  `,o>1?t+=`
          float lightInf = 1.0;

          for(int i = 0; i < LIGHT_COUNT; i++) {
              vec3 lightVector = normalize(pos - lightPos[i]);
              lightInf = min(lightInf, length(pos - lightPos[i]) *.05 );
          }
          vAlpha*=(1.0-lightInf)*.8+.2;
    `:o==1&&(t+=`
        vec3 lightVector = normalize(pos - lightPos[0]);
        float lightInf = length(pos - lightPos[0]) *.02;
        vAlpha*=(1.0-lightInf)*.8+.2;
    `),t+=`
        vScalar = pScalar ;
        //float pScale = pointScale.x * ((seeds.w+.75)*.5) * pScalar + 1.0;
        float pScale = pointScale.x * (seeds.w*.5+.5)*pScalar + 1.0;
        pScale *= step( .5, atlas.x )*.5+1.;
        //pScale = 10.0;
       
        gl_PointSize = pScale;
        
        pos+=positionOffset;
        vec4 mvPos=viewMatrix * vec4(pos, 1.0);
        gl_Position = projectionMatrix*mvPos;
    }`,t}function as(){let o=I();return o+=`
    uniform sampler2D atlasTexture;
    uniform vec2 time;
    uniform float rate;
    
    varying vec2 vAtlas;
    varying vec2 vRot;
    varying float vScalar;
    varying float vAlpha;
    
    void main(){
        vec2 uv=gl_PointCoord;

        vec2 pos = (uv-.5)*.85;

        vec2 rotUV;
        rotUV.x = vRot.y * pos.x - vRot.x * pos.y;
        rotUV.y = vRot.x * pos.x + vRot.y * pos.y;
        rotUV=(rotUV+.5)*.25+vAtlas;
        
        vec4 dustCd=texture2D(atlasTexture,rotUV);
        float alpha=dustCd.a*vAlpha; // *vScalar;
        vec4 Cd=vec4( dustCd.rgb, alpha );

        gl_FragColor=Cd;
    }`,o}function os(o=[8.7,8.4]){let e=I();return e+=` 
    uniform sampler2D noiseTexture;
    uniform vec2 time;
    uniform float rate;
    uniform vec2 pointScale;
    
    attribute vec4 seeds;
    attribute vec2 atlas;
    
    varying vec2 vAtlas;
    varying vec2 vRot;
    varying float vAlpha;
    varying float vBrightness;
    
    
    #define PROX 6.0
    
    
    float colDetect( vec2 pos, vec2 pt, vec2 n1, vec2 n2 ){
        vec2 ref=pos-pt;
        float ret = step( dot( ref, n1 ), 0.0 );
        ret *= step( dot( ref, n2 ), 0.0 );
        
        return ret;
    }
     
    
    // Attempted de-Magic-num-ification
    float baseSpread = 110.0;
    float innerBulster = -0.110;
    float smokeDensity = 0.25;
        
    void main(){
        vAtlas=atlas;
        
        float rot=seeds.z+time.x*(seeds.z*2.);
        vRot=vec2( sin(rot), cos(rot) );
        
        vec3 pOff=vec3(seeds.z, seeds.y, seeds.w) ;
        
        vec2 sinUV=abs(sin(pOff.xz*.5+seeds.zw+time.x*.1)*.5+.5);
        vec3 noiseCd=texture2D(noiseTexture, sinUV ).rgb*4.5 + 0.50;
        
        float t=time.x*rate;
        float shiftY= mod( t+t*seeds.x+seeds.z*24.0+noiseCd.r+noiseCd.b+(seeds.x+seeds.y)*2.0, 14.0);
        float life = max(0.0,(shiftY-seeds.x)*0.07142857142857142)*.9+.2;
        float alphaMult = (1.0-(1.0-life)*(1.0-life))*smokeDensity;
        
        pOff.y=shiftY*seeds.y*life - (1.0-life);
        
        pOff.y=(pOff.y*.5)+shiftY; 
        vec3 pos= pOff ;
        

        
        // Magic numbers!  Boo!!
        float tightenTip = max(0.0,life-.63)*1.3;
        tightenTip = 1.0 - (1.0-tightenTip) * (1.0-tightenTip);
        //tightenTip *= tightenTip;
        float tightenBase = max(0.0, (1.0-life)*innerBulster);
        float tightenMid = max(0.0, 0.60 - tightenTip - tightenBase - seeds.x*.2);
        
        baseSpread = baseSpread*tightenBase + baseSpread*tightenMid + baseSpread*tightenTip ;
        
        pos.xz=(noiseCd.rg*noiseCd.b)*seeds.w*baseSpread*(life*(seeds.zy*.6));
        
        // Wind -- Forces
        //   Magic numbers, yarb!
        float windInf = life * life * (life*.5+.5);
        vec2 windDir = vec2( windInf*${o[0]}, windInf * ${o[1]} );
        pos.xz += windDir + vec2(-.5, .0);
        
        
        // Alpha with cam distance inf
        float pScalar = 1.0-min( 1.0, (length(pos-cameraPosition )*0.004) );
        pScalar=1.0-(pScalar*pScalar);
        float aMult = min(1.0, pScalar*2.0);
        vAlpha = (seeds.x*.5+.7) * aMult;

        
        // Alpha from gettin' old
        vAlpha=(1.0-life)*min(1.0,alphaMult);
        vec3 doubleCd=texture2D(noiseTexture, sinUV+pos.xz*.5+vec2(seeds.y,pos.y)).rgb ;
        pos.xz=(pos.xz*seeds.xy+doubleCd.rb*10.0)*min(1.0,life+seeds.y);
        
        
        // Draw size, particle scale
        pScalar = 1.0-(1.0-pScalar)*.75*(1.0-pScalar);
        float pScale = pointScale.x * seeds.w * 0.006 * pScalar + (200.0+125.0*life*pScalar)*(1.0-pScalar);
        pScale += 150.0*(clamp(-(pScalar-.45)*10.0,0.0,1.0));

        gl_PointSize = pScale;
        
        // Brightness multiplier
        vBrightness = 1.0-tightenMid*.81 - tightenTip + tightenBase;
        float originDelta = length(pos)*(-innerBulster);
        vBrightness *= max(0.0, 1.0-originDelta * life * 0.807);
        
        
        // Add Particle System position
        pos += modelMatrix[3].xyz;
        
        vec4 mvPos=viewMatrix * vec4(pos, 1.0);
        gl_Position = projectionMatrix*mvPos;
        
        
    }`,e}function ls(){let o=I();return o+=`
        
    uniform sampler2D atlasTexture;
    uniform vec2 time;
    uniform float rate;
    
    varying vec2 vAtlas;
    varying vec2 vRot;
    varying float vAlpha;
    varying float vBrightness;
    
    void main(){
        vec2 uv=gl_PointCoord;

        vec2 pos = (uv-.5)*.85;

        vec2 rotUV;
        rotUV.x = vRot.y * pos.x - vRot.x * pos.y;
        rotUV.y = vRot.x * pos.x + vRot.y * pos.y;
        rotUV=(rotUV+.5)*.25+vAtlas;
        
        vec4 dustCd=texture2D(atlasTexture,rotUV);
        float alpha=dustCd.a*vAlpha;
        vec4 Cd=vec4( dustCd.rgb, alpha );

        Cd.rgb *= vec3(vBrightness);
        
        gl_FragColor=Cd;
    }`,o}function ns(o=!1){let e=!o,t=I();return t+=`
    uniform vec2 time;
    uniform float rate;
    uniform float pointScale;
    
    attribute vec4 seeds;
    attribute vec2 atlas;
    
    varying vec2 vAtlas;
    varying vec2 vRot;
    varying float vScalar;
    
    #define PROX 1000.0
    #define LAND 50.0
    
    float colDetect( vec2 pos, vec2 pt, vec2 n1, vec2 n2 ){
        vec2 ref=pos-pt;
        float ret = step( dot( ref, n1 ), 0.0 );
        ret *= step( dot( ref, n2 ), 0.0 );
        
        return ret;
    }
    
    
    void main(){
        vAtlas=atlas;
        
        float rot=seeds.z+time.x*(seeds.z*2.);
        vRot=vec2( sin(rot), cos(rot) );
        
        float t=time.x*rate;
        
        vec3 pOff=vec3( seeds.x, 0, seeds.y)* vec3(PROX);
        
        // Loop point positions based on camera location
        float yFract=fract(t+seeds.z);
        pOff.y=PROX-yFract*(PROX+LAND); 
        vec3 pos= pOff ;
        vec2 camXZ=cameraPosition.xz;
        pos.xz= mod( pos.xz-camXZ, PROX) + camXZ - PROX*.5;
        
        
        // Get some roof tops working
        //   Using opposing points and 2 normals in xz space to determin y floor position
        // Find rooves from xz pos + dot products
        float floor=0.0;
    `,e&&(t+=`
        // -- --
        vec2 lp1=vec2( -186.0, -1002.0 ); // Point 1
        vec2 l1n1=vec2(-.1,1.); // Normal 1
        vec2 l1n2=vec2(1.,-.1); // Normal 2
        vec2 lp2=vec2( -1101.0, -1720.0 ); // Point 2
        vec2 l2n1=vec2(.1,-1.1);
        vec2 l2n2=vec2(-1.,.1);
        floor = max( floor, 170.0*colDetect( pos.xz, lp1,l1n1,l1n2 ) * colDetect( pos.xz, lp2,l2n1,l2n2 ) ); // Lobby roof

        lp1=vec2( -217.0, 786.0 ); // Point 1
        l1n1=vec2(.2,-1.); // Normal 1
        l1n2=vec2(1.,.1); // Normal 2
        lp2=vec2( -940.0, 1293.0 ); // Point 2
        l2n1=vec2(-.2,1.);
        l2n2=vec2(-1.,-.1);
        floor = max( floor, 500.0*colDetect( pos.xz, lp1,l1n1,l1n2 ) * colDetect( pos.xz, lp2,l2n1,l2n2 ) ); // sunflower roof

        lp1=vec2( 204.028, 56.7629 ); // Point 1
        l1n1=vec2( 0.152344, -0.988327 ); // Normal 1
        l1n2=vec2( -0.999862, 0.0165819 ); // Normal 2
        lp2=vec2( 755.264, 754.843 ); // Point 2
        l2n1=vec2( -0.160366, 0.987058 );
        l2n2=vec2( 0.999849, 0.0173488 );
        floor = max( floor, 150.0*colDetect( pos.xz, lp1,l1n1,l1n2 ) * colDetect( pos.xz, lp2,l2n1,l2n2 ) ); // sunflower roof
        `),t+=`  
        // Prevent snow drifting after hitting the ground
        float yLimit=max( floor, pos.y ) * .08 * seeds.z;
        pos.xz+=vec2( sin(pos.x+yLimit*seeds.x), sin(pos.z+pos.x+yLimit*seeds.y) )*10.; // Snow sway in the sky
        
        // Shift Y position per camera height
        pos.y+=cameraPosition.y-yFract*(cameraPosition.y); 
        pos.y=max( floor+1.5, pos.y );
        
        float melt=min(1.0, (pOff.y+LAND-floor)*.02);
        float pScalar = max( 0., (1.-length(pos-cameraPosition )*0.001) * melt );
        
        vScalar = pScalar;
        float pScale = pointScale * seeds.w * pScalar ;
        gl_PointSize = pScale;
        
        vec4 mvPos=viewMatrix * vec4(pos, 1.0);
        gl_Position = projectionMatrix*mvPos;
    }`,t}function us(){let o=I();return o+=`
    uniform sampler2D snowTexture;
    uniform vec2 time;
    uniform float rate;
    
    varying vec2 vAtlas;
    varying vec2 vRot;
    varying float vScalar;
    
    void main(){
        vec2 uv=gl_PointCoord;

        vec2 pos = uv-.5;

        vec2 rotUV;
        rotUV.x = vRot.y * pos.x - vRot.x * pos.y;
        rotUV.y = vRot.x * pos.x + vRot.y * pos.y;
        rotUV=(rotUV+.5)*.25+vAtlas;
        
        float alpha=texture2D(snowTexture,rotUV).r * vScalar;
        vec4 Cd=vec4( vec3(1.), alpha );

        gl_FragColor=Cd;
    }`,o}var zt={};re(zt,{boxAntiAliasPass:()=>fs,chroAberPostProcess:()=>bs,compLayersPostProcess:()=>ms,crossAntiAliasPass:()=>vs,directionalBlurPass:()=>gs,finalOverlayHeavyShader:()=>Ds,finalOverlayShader:()=>Ts,finalOverlaySlimShader:()=>Ms,glowPassPostProcess:()=>ds,iZoomPostProcess:()=>Ps,lKingPostProcess:()=>Cs,mixBlurShaderPass:()=>xs,motionBlurPostProcess:()=>ys,sFieldPostProcessFrag:()=>Es,sFieldPostProcessVert:()=>ws,textureStorePass:()=>ps,warpPostProcess:()=>Ss,worldPositionFrag:()=>cs,worldPositionVert:()=>hs});function hs(){let o=I();return o+=`
  varying vec3 pos;
  
  void main(){
    vec3 transformed = vec3( position );
      vec4 mvPosition = modelViewMatrix  * vec4( transformed, 1.0 );
    pos=((projectionMatrix * modelMatrix * vec4( transformed-vec3(0.0,0.0,-500.0), 1.0 )).xyz*.0001)*.5+.5;
    
    gl_Position = projectionMatrix * mvPosition;
  }`,o}function cs(){let o=I();return o=`#include <packing>
  `+o,o+=`
    uniform sampler2D diffuse;
    uniform sampler2D depth;
    uniform float camNear;
    uniform float camFar;
    varying vec3 pos;
    
    void main() {
      
      vec4 Cd=vec4( pos, 1.0 );
      gl_FragColor = Cd;
    }`,o}function ds(){let o=I();return o+=`
    uniform sampler2D tDiffuse;
    uniform sampler2D gDiffuse;
    uniform sampler2D rDiffuse;
    uniform sampler2D sceneDepth;
    uniform vec2 time;
    uniform vec2 ratio;
    varying vec2 vUv;

        #define PI 3.14159265358979
        
    void main() {
      vec4 Cd=texture2D( tDiffuse, vUv );
      vec4 gCd=texture2D( gDiffuse, vUv );
      vec4 rCd=texture2D( rDiffuse, vUv );
      
      Cd.rgb=gCd.rgb + gCd.rgb*length(gCd.rgb) + rCd.rgb  + Cd.rgb ;

      Cd.a=1.0;
      gl_FragColor = Cd;
    }`,o}function ps(){let o=I();return o+=`
    uniform sampler2D tDiffuse;
    uniform sampler2D tDiffusePrev;
    uniform sampler2D tDiffusePrevRoom;
    uniform float roomComposer;
    varying vec2 vUv;
        
    void main() {
      vec4 Cd = texture2D( tDiffusePrev, vUv );
      vec3 prevRoomCd = texture2D( tDiffusePrevRoom, vUv ).rgb;
      Cd.rgb=mix( Cd.rgb, prevRoomCd, roomComposer);
      //Cd.rgb=Cd.rgb + prevRoomCd;
      Cd.a=1.0;
      gl_FragColor = Cd;
    }`,o}function ms(){let o="";return o+=`
    uniform sampler2D tDiffuse;
    uniform sampler2D mtDiffuse;
    uniform sampler2D sceneDepth;
    uniform sampler2D noiseTexture;
    uniform float exposure;
    uniform vec2 camRotPitch;
    uniform vec2 time;
    varying vec2 vUv;

    void main() {
      vec4 Cd=texture2D(tDiffuse,vUv)*exposure;
      vec4 mBlurCd=texture2D(mtDiffuse,vUv)*exposure;
      vec4 depth=texture2D(sceneDepth,vUv);
      
  ////////////////////////
  /*
      vec2 uv=vUv;
      float pi=3.14159265358979;
      float t=-time.x*.007;
      float pitch=camRotPitch.y;//depth.w*2.0-1.0;
      float yaw=camRotPitch.x;
      
      float distMult=depth.x*2.0;
      vec2 noiseUV=vec2(fract(uv.x*distMult+t+yaw), fract(uv.y*distMult+pitch));
      vec3 noiseCd=texture2D(noiseTexture,noiseUV).rgb;
      noiseUV=vec2(fract(uv.x*distMult+t*.5+yaw), fract(uv.y*.5*distMult+t*.25+pitch));
      noiseCd.g=texture2D(noiseTexture,noiseUV).g;
      noiseUV=vec2(fract(uv.x*.8*distMult+t*1.3+yaw), fract(uv.y*.3*distMult+t*.5+ pitch + depth.x*2.0));
      noiseCd.b=texture2D(noiseTexture,noiseUV).b;
      float mult=noiseCd.x*noiseCd.y*noiseCd.z*1.3;
      mult*=max(0.0, 1.0-depth.x) + (1.0-depth.z*.6);
      
      float bg=length(depth.rgb)<.02 ? 0.0 : 1.0;
      float bval=length(bloomCd.rgb);
      mult= mult*(bg+bval) ;//*(1.0-depth.z);
      Cd.rgb= mix( Cd.rgb, vec3(mult*.2), mult );
      */
      
      Cd.rgb+=mBlurCd.rgb;
      Cd.a=1.0;
      gl_FragColor = Cd;
    }`,o}function fs(){let o=I();return o+=`
    uniform sampler2D tDiffuse;
    uniform vec2 resUV;
    uniform float ratio;
    uniform vec3 gamma;
    varying vec2 vUv;

        #define AADIV 0.1

    void main() {
      vec4 Cd=texture2D(tDiffuse,vUv)*2.0;
            
            float dist = 1.0;
      vec2 baseUV=vUv;
      const int runCount=8;
      vec2 runDir[runCount];
      runDir[0]=vec2(1.0, 0.0);
      runDir[1]=vec2(1.0, 1.0);
      runDir[2]=vec2(0.0, 1.0);
      runDir[3]=vec2(-1.0, 1.0);
      runDir[4]=vec2(-1.0, 0.0);
      runDir[5]=vec2(-1.0, -1.0);
      runDir[6]=vec2(0.0, -1.0);
      runDir[7]=vec2(1.0, -1.0);
      vec2 curUV;
      vec3 curCd;
      for(int s=0; s<runCount; ++s){
        curUV = baseUV+runDir[s]*(resUV);//*dist);
        curCd = texture2D(tDiffuse,curUV).rgb;
                Cd.rgb+=curCd;
      }
      Cd.rgb=Cd.rgb*AADIV;
      Cd.a=1.0;
      
      //Cd.rgb = pow(Cd.rgb, vec3(gamma.x));
      Cd.rgb = vec3(1.0)-(vec3(1.0)-Cd.rgb)*gamma.y + Cd.rgb*(1.0-min(1.0,length(Cd.rgb)))*gamma.z;
      gl_FragColor = Cd;
    }`,o}function vs(){let o=I();return o+=`
    uniform sampler2D tDiffuse;
    uniform vec2 resUV;
    uniform float ratio;
    uniform vec3 gamma;
    varying vec2 vUv;

        #define AADIV 0.16666666666666666

    void main() {
      vec4 Cd=texture2D(tDiffuse,vUv)*2.0;
            
            float dist = 1.0;
      vec2 baseUV=vUv;
      const int runCount=4;
      vec2 runDir[runCount];
      runDir[0]=vec2(1.0, 1.0);
      runDir[1]=vec2(-1.0, 1.0);
      runDir[2]=vec2(-1.0, -1.0);
      runDir[3]=vec2(1.0, -1.0);
      vec2 curUV;
      vec3 curCd;
      for(int s=0; s<runCount; ++s){
        curUV = baseUV+runDir[s]*(resUV);//*dist);
        curCd = texture2D(tDiffuse,curUV).rgb;
                Cd.rgb+=curCd;
      }
      Cd.rgb=Cd.rgb*AADIV;
      Cd.a=1.0;
      
      //Cd.rgb = pow(Cd.rgb, vec3(gamma.x));
      Cd.rgb = vec3(1.0)-(vec3(1.0)-Cd.rgb)*gamma.y + Cd.rgb*(1.0-min(1.0,length(Cd.rgb)))*gamma.z;
      gl_FragColor = Cd;
    }`,o}function gs(o,e,t,i){let s=I();return s+=`
        uniform sampler2D tDiffuse;
        uniform sampler2D pDiffuse;
        uniform vec2 resUV;
        varying vec2 vUv;
  
        #define PI 3.14159265358979
        
        void main() {
          
          float dist = 2.0;
          float fade = 1.0;
          vec2 baseUV=vUv;
            
          const int blurCount=${t};
          const int runCount=2;
          vec2 runDir[runCount];
          runDir[0]=vec2(${e[0]}.0, ${e[1]}.0);
          runDir[1]=vec2(-${e[0]}.0, -${e[1]}.0);
          vec2 curUV;
          vec4 curCd;
          vec4 blurCd=vec4(.0);
          for(int b=0; b<blurCount; ++b){
            dist = 1.0 + float(b)*${i};
            fade = (1.0-float(b+1)/float(blurCount+2));
            //fade = 1.- (1.-fade)*(1.-fade);
            for(int s=0; s<runCount; ++s){
              curUV = baseUV+runDir[s]*(resUV*dist);
              curUV = min( vec2(1.), max( vec2(0.), curUV ));
              curCd = texture2D(${o},curUV);
              curCd.a *= fade*(length(curCd.rgb)*.6);
              blurCd.r = max( blurCd.r, curCd.r );
              blurCd.g = max( blurCd.g, curCd.g );
              blurCd.b = max( blurCd.b, curCd.b );
              //blurCd.rgb += curCd.rgb;
              blurCd.a = max( blurCd.a, curCd.a );
            }
          }
          vec4 Cd=blurCd;
          //Cd.a=.01;
          gl_FragColor = Cd;
        }`,s}function xs(){let o=I();return o+=`
        uniform sampler2D tDiffuse;
        uniform sampler2D pDiffuse;
        uniform vec2 resUV;
        varying vec2 vUv;
        
        #define PI 3.14159265358979
        
        void main() {

          float dist = 3.0;
          float fade = 1.0;
          vec2 baseUV=vUv;
          const int blurCount=3;
          const int runCount=8;
          vec2 runDir[runCount];
          runDir[0]=vec2(1.0, 0.0);
          runDir[1]=vec2(1.0, 1.0);
          runDir[2]=vec2(0.0, 1.0);
          runDir[3]=vec2(-1.0, 1.0);
          runDir[4]=vec2(-1.0, 0.0);
          runDir[5]=vec2(-1.0, -1.0);
          runDir[6]=vec2(0.0, -1.0);
          runDir[7]=vec2(1.0, -1.0);
          vec2 curUV;
          vec4 curCd;
          vec4 scatterCd=vec4(.0);
          for(int b=0; b<blurCount; ++b){
            dist = 1.5*(1.0+float(b));
            fade = .1*(1.0-float(b)/float(blurCount));
            for(int s=0; s<runCount; ++s){
              curUV = baseUV+runDir[s]*(resUV*dist);
              curCd = texture2D(pDiffuse,curUV);
              curCd.a *= fade;
              scatterCd.rgb += curCd.rgb;
              scatterCd.a = max( scatterCd.a, curCd.a );
            }
          }
          vec4 Cd=scatterCd;
          
          vec4 blurCd=texture2D(tDiffuse,vUv);
          blurCd.rgb = normalize( blurCd.rgb );
          
          Cd = mix( blurCd, Cd, Cd.a);
          Cd = texture2D(tDiffuse,vUv);
          //Cd.a=.01;
          gl_FragColor = Cd;
        }`,o}function ys(o,e){let t=I();return t+=`
    uniform sampler2D tDiffuse;
    uniform sampler2D rDiffuse;
    uniform sampler2D noiseTexture;
    
    uniform float exposure;
    uniform vec2 time;
    uniform vec3 camRotXYZ;
    uniform vec2 blurDirCur;
    uniform vec2 blurDirPrev;
    varying vec2 vUv;

    vec4 getTexture( sampler2D texelToLinearTexture ) {
      return mapTexelToLinear( texture2D( texelToLinearTexture , vUv ) );
    }
    
    vec3 directionalBlur(vec3 origCd, sampler2D tex, vec2 uv, vec2 dir, vec2 deltaDir, float dist, float thresh){
      float perc;
      float curPerc=1.0;
      vec2 curUV;
      float origLength=length(origCd.rgb);
      vec3 curCd;
      vec3 retCd=origCd;
      float delta;
      float threshTrigger=1.0;
      float dropoff;
      float percCurve;
      float d=dot(dir,deltaDir)*.5+.5;
      for(int r=0; r<10; ++r){
        perc=(float(r)/10.0);
        percCurve=perc*.5;
        dropoff=(dist*float(r))*perc*d;
        curUV=uv+normalize(deltaDir*percCurve+dir*(1.0-percCurve))*dropoff;
        //curUV=uv+dir*dropoff;
        curCd=texture2D(tex,curUV).rgb;
        delta=length(curCd.rgb);
        delta=origLength<delta?1.0-perc*perc:0.0;
        //delta=1.0-perc*perc;
        retCd+=curCd.rgb*delta;
        curPerc+=delta;
        
        percCurve*=percCurve;
        curUV=uv-normalize(-deltaDir*percCurve+dir*(1.0-percCurve))*dropoff*.4;
        //curUV=uv-dir*dropoff*.4;
        curCd=texture2D(tex,curUV).rgb;
        delta=length(curCd.rgb);
        delta=origLength<delta?1.0-perc*perc:0.0;
        //delta=1.0-perc*perc;
        retCd+=curCd.rgb*delta;
        curPerc+=delta;
        
      }
      return retCd /curPerc;
    }

    void main() {
      
      
      vec4 bloomCd=getTexture( rDiffuse );
      float noise=sin(time.x*1.8+vUv.x*length(bloomCd.rgb)*12.523+cos(time.x*.4+vUv.y*length(bloomCd.rgb)*2.352)*1.9)*.4+.8;
      noise=1.0-min(1.0, max(0.0, noise*sin(time.x*.4+24.512)*3.0+1.0));
      vec2 noiseUV=vUv*0.1;//+vec2(camRotXYZ.x+time.x*.05,-camRotXYZ.y);
      vec4 noiseCd=texture2D(noiseTexture,noiseUV);
      float blurDist=length(blurDirCur);
      blurDist=min(1.0,blurDist*15.0);
      //blurDist=(1.0-(1.0-blurDist)*(1.0-blurDist));
      vec2 blurDir=normalize(blurDirCur);//+(vUv-.5)*2.0);`,e||(t+=`
        blurDir=normalize( blurDir + (noiseCd.gb-.5)*(dot(blurDir,noiseCd.gb)*.5+.5) );
      `),t+=`
      vec2 deltaDir=normalize(blurDirPrev);
      deltaDir.x+=sin((blurDir.x-deltaDir.x));
      deltaDir.y+=sin((blurDir.y-deltaDir.y));
      
      vec4 bloomAdd=vec4( directionalBlur(bloomCd.rgb, rDiffuse, vUv, blurDir, deltaDir, `+o.y+"*"+(e?"3.0":"5.0")+`*(1.5)*blurDist, .5)*(1.0+exposure*.4), 1.0);
      vec4 Cd= bloomAdd* ( 0.50+bloomCd)*exposure;//getTexture( rDiffuse ) + bloomAdd;//+ vec4( 1.0 ) * bloomCd + bloomAdd;
      //Cd.a=bloomAdd.a-bloomCd.a;
      
      Cd.a=1.0;
      gl_FragColor = Cd;
      
    }`,t}function bs(){let o=I();return o+=`
    uniform sampler2D tDiffuse;
    uniform sampler2D chroAberUVTexture;
    uniform vec2 ratio;
    uniform vec2 warpMult;
        uniform vec2 lKing;
    varying vec2 vUv;

    void main() {
      // I don't know, sRGB to Linear. Keeping it Linear doesn't work, PNG encoding to blame
      vec4 caCd= texture2D( chroAberUVTexture, vUv )-vec4(vec3(0.7294118), 0.5019608);
      //caCd*=mix( .025, .018, length(caCd.rg)*4.0 );
      caCd*=mix( lKing.x, lKing.y, length(caCd.rg)*4.0 )+warpMult.x;
      
      vec2 bUv=vUv+caCd.rg;
      vec2 rUv=vUv+caCd.ba;
      vec2 gUv=vUv+(caCd.rg+caCd.ba);
      vec4 rCd=texture2D( tDiffuse, rUv );
      vec4 Cd=texture2D( tDiffuse, gUv );
      vec4 bCd=texture2D( tDiffuse, bUv );
      
      Cd.rgb=vec3( rCd.r, Cd.g, bCd.b );
      Cd.a=1.0;
      gl_FragColor = Cd;
    }`,o}function Cs(){let o=I();return o+=`
    uniform sampler2D tDiffuse;
    uniform sampler2D noiseTexture;
    uniform vec2 time;
    uniform vec2 ratio;
    varying vec2 vUv;

        #define PI 3.14159265358979
        
    void main() {
      vec4 Cd=texture2D( tDiffuse, vUv )*.2;
      vec4 noiseCd= (texture2D( noiseTexture, vec2( fract(vUv.x*.2-time.x*.02+sin(time.x*.1+vUv.y*PI+Cd.r+Cd.g)),fract( vUv.y*.2+time.x*.01+cos(-time.x*.2+1.15+vUv.x*PI+Cd.g+Cd.b)) ) )-.5)*.025;
      
      vec2 bUv=vUv+noiseCd.rg;
      vec2 rUv=vUv+noiseCd.gb;
      vec2 gUv=vUv+noiseCd.br;
      vec4 rCd=texture2D( tDiffuse, rUv );
      vec4 gCd=texture2D( tDiffuse, gUv );
      vec4 bCd=texture2D( tDiffuse, bUv );
      
      Cd.rgb=vec3( rCd.r, gCd.g, bCd.b );
      Cd.a=1.0;
      gl_FragColor = Cd;
    }`,o}function Ps(){let o=I();return o+=`
    uniform sampler2D tDiffuse;
    uniform sampler2D tDiffusePrev;
    uniform sampler2D noiseTexture;
    uniform vec2 time;
    uniform vec2 ratio;
    varying vec2 vUv;

        #define PI 3.14159265358979
        
    void main() {
      vec4 Cd=texture2D( tDiffuse, vUv );
            vec4 pCd=texture2D( tDiffusePrev, vUv );
            vec3 dCd=Cd.rgb-pCd.rgb;
            vec3 b1Cd= texture2D( tDiffuse, vUv-vec2( dCd.rg*.1 ) ).rgb;
            vec3 b2Cd= texture2D( tDiffusePrev, vUv+vec2( dCd.rg*.1 ) ).rgb;
            b1Cd=mix( b1Cd, b2Cd, step( length(b1Cd), length(b2Cd) ) );
            
            vec4 outCd=vec4(1.0);
            outCd.rgb= mix(  Cd.rgb, b1Cd, length(dCd) );
            
      vec3 noiseCd=texture2D( noiseTexture, fract( vUv*50.0+dCd.rg*.1 + length(Cd.rgb*30.0) + time.x) ).rgb;

            outCd.rgb= mix( vec3(length(outCd.rgb)*.333-length(noiseCd)*.1), outCd.rgb, min(1.0,length(dCd))*.5+.5 );
            outCd.rgb+= dCd.gbr;
            
            
            
      outCd.a=1.0;
      gl_FragColor = outCd;
    }`,o}function ws(){let o=I();return o+=`
    uniform vec2 time;
    varying vec2 vUv;
    varying vec2 vUvShift;
    varying vec2 starUv;
    varying float vTimer;

    void main(){
        vUv=uv;
        vUvShift=uv-.5;
        
        vec2 rUv=vUvShift*0.7071067811865476;
        vec2 tmpUv=rUv;
        float rot=time.x*.1;
        vec2 sinCos=vec2( sin(rot), cos(rot) );
        rUv.x=sinCos.x*tmpUv.x + sinCos.y*tmpUv.y;
        rUv.y=sinCos.y*tmpUv.x - sinCos.x*tmpUv.y;
        rUv=(rUv+.5);
        
        float starTimer=sin(time.x*.2)*.1+.1;
        starUv=mix( vUv, rUv, starTimer);
        
        vTimer=time.x*.5;
        
        vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);
        gl_Position = projectionMatrix*modelViewPosition;
    }`,o}function Es(){let o=I();return o+=`
        uniform sampler2D tDiffuse;
        uniform sampler2D starTexture;
        varying vec2 vUv;
        varying vec2 vUvShift;
        varying vec2 starUv;
        varying float vTimer;

        #define PI 3.14159265358979
        
        void main() {
            float uvDist=length(vUvShift);
            
            vec3 starCd=texture2D( starTexture, starUv ).rgb*uvDist;
            
            float blender=uvDist*starCd.b * abs((fract(starCd.b*PI+vTimer))*2.0-1.0)*.5;
            vec2 starBlendUV=starCd.rg*blender;
            
            vec2 cdUv = vUv+starBlendUV;
            vec4 Cd=texture2D( tDiffuse, cdUv );
            
            vec3 negCd= mix( Cd.brg, Cd.gbr, length(Cd.rgb-Cd.rgb) );
            float cdBlender=step(.015,starBlendUV.x*uvDist)+starCd.b;
            Cd.rgb= mix( Cd.rgb, negCd, cdBlender );
            
            gl_FragColor = Cd;
        }`,o}function Ss(){let o=I();return o+=`
    uniform sampler2D tDiffuse;
    uniform sampler2D noiseTexture;
    uniform sampler2D animTexture;
    uniform vec2 time;
    uniform vec2 fader;
    varying vec2 vUv;

    void main() {
      vec4 Cd=texture2D( tDiffuse, vUv );
      vec4 animCd=texture2D( animTexture, vUv );
      float timer=time.x*.2;
      vec2 animUV=vec2( mod(animCd.r+Cd.r+Cd.g+timer, 1.0), mod(animCd.g+Cd.g+Cd.b+timer, 1.0) );
      animCd=texture2D( animTexture, animUV );
      
      vec2 noiseUV=animUV+animCd.rg;
      vec4 noiseCd=texture2D(noiseTexture,noiseUV);
      noiseCd.rgb=vec3( length( noiseCd.rgb )*.5-.25 );
      
      float blend=fader.x*fader.y;
      Cd=mix( Cd, noiseCd, blend);
      
      Cd.a=1.0;
      gl_FragColor = Cd;
    }`,o}function Ds(){let o=I();return o+=`
        uniform sampler2D tDiffuse;
        uniform sampler2D rDiffuse;
        uniform sampler2D bloomTexture;
        uniform sampler2D sceneDepth;
        uniform sampler2D scenePos;
        uniform sampler2D noiseTexture;
        uniform vec3 camPos;
        uniform vec2 time;
        uniform vec2 fogMult;
        uniform vec2 proximityMult;
        uniform float ratio;
        uniform float exposure;
        varying vec2 vUv;

        vec3 fogValue( vec3 worldPos, float time ){
            float wpDist = worldPos.x+worldPos.z*2.0;
            vec2 noiseUV = vec2( ((time*.5+wpDist*.60)), (worldPos.y*.7+time*.25 ));
            vec3 noiseCd = texture2D(noiseTexture,noiseUV).rgb;
            noiseUV=vec2( ((time*.3+wpDist*.55)), (worldPos.x*.5+time*.35 ));
            noiseCd.g=texture2D(noiseTexture,noiseUV+vec2(0.0,time)).g;
            noiseUV=vec2( ((time*1.2+wpDist*.83)), (worldPos.y+time*.15  ));
            noiseCd.b=texture2D(noiseTexture,noiseUV).b;
            
            return noiseCd;
        }

        #define PROX_WARP 3.14159265358979*.45
        
        void main() {
            vec4 Cd=texture2D(rDiffuse,vUv);
            float depth=texture2D(sceneDepth,vUv).r;
            
            vec3 worldPos = texture2D(scenePos,vUv).rgb;
            float t = -time.x*.003;
            vec3 baseNoiseCd=fogValue( worldPos, t );
            
            float mult=0.0;
            vec3 noiseCd;
            vec3 curNoiseCd;
            vec3 samplePos;
            float samples=4.3;//+sin(time.x*.001);
            float blender;
            float blenderMax=0.0;
            for( int x=0; x<=3; ++x){
                blender=( float(x+1) / samples );
                samplePos=worldPos*blender;
                curNoiseCd=fogValue( samplePos, t );
                noiseCd=max(noiseCd, curNoiseCd * blender );
                blenderMax+=blender;
            }
            noiseCd += baseNoiseCd*.2;
            mult= noiseCd.x*noiseCd.y*noiseCd.z*1.2;
            //mult*=mult;
            
            // Distance Mapping
            float proxWarp= cos(( vUv.x-.5 ) * PROX_WARP*ratio );
            float mDepth= pow( depth, 28.*proxWarp );
            
            float fogDap= max(0.0, 1.0-mDepth);
            fogDap=1.0-fogDap*fogDap;
            mult*=max(0.0, (worldPos.y-0.04)*1.65) * fogMult.x * fogDap ;
            
            
            Cd.rgb= mix( Cd.rgb, vec3(mult*.7), mult)-mult*.35;
 
            vec3 bloomCd=texture2D(bloomTexture,vUv).rgb;
            Cd.rgb+= bloomCd;
            Cd.rgb*=exposure;
            
            // Proximity Draw Over
            float dProx=  ((mDepth-.5)*-10.);
            dProx= max(0.0, (1.0-dProx)*step( 0., dProx));
            float yProxMult= 1.0-min(1.0, max(0.0, (worldPos.y-.5 )*1000.));
            dProx*= dProx* yProxMult * proximityMult.x;
            vec3 proxCd = (vec3(.5,.5,.2)*dProx)*.5;
            Cd.rgb+=proxCd*mult;
            
            Cd.a=1.0;
            gl_FragColor = Cd;
    }`,o}function Ts(){let o=I();return o+=`
        uniform sampler2D tDiffuse;
        uniform sampler2D rDiffuse;
        uniform sampler2D bloomTexture;
        uniform sampler2D sceneDepth;
        uniform sampler2D scenePos;
        uniform sampler2D noiseTexture;
        uniform vec2 time;
        uniform vec2 fogMult;
        uniform vec2 proximityMult;
        uniform vec2 lookAtPerc;
        uniform vec2 resUV;
        uniform float ratio;
        uniform float exposure;
        varying vec2 vUv;

        #define PROX_WARP 3.14159265358979*.45

        void main() {
            vec4 Cd=texture2D(rDiffuse,vUv);
            float depth=texture2D(sceneDepth,vUv).r;
            
            vec3 worldPos = texture2D(scenePos,vUv).rgb;
            float wpDist = worldPos.x+worldPos.z*2.0;
            float t = -time.x*.003;
            
            vec2 noiseUV = vec2( ((t*.5+wpDist*.60)), (worldPos.y*.7+t*.25 ));
            vec3 noiseCd = texture2D(noiseTexture,noiseUV).rgb;
            noiseUV=vec2( ((t*.3+wpDist*.55)), (worldPos.x*.5+t*.35 ));
            noiseCd.g=texture2D(noiseTexture,noiseUV+vec2(0.0,t)).g;
            noiseUV=vec2( ((t*1.2+wpDist*.83)), (worldPos.y+t*.15  ));
            noiseCd.b=texture2D(noiseTexture,noiseUV).b;
            
            
            // Distance Mapping
            float proxWarp= cos(( vUv.x-.5 ) * PROX_WARP*ratio );
            float mDepth= pow( depth, 28.*proxWarp );
            
            float fogDap= max(0.0, 1.0-mDepth);
            fogDap=1.0-fogDap*fogDap;
            float mult=noiseCd.x*noiseCd.y*noiseCd.z*1.3;
            mult*=max(0.0, (worldPos.y-0.04)*1.65) * fogMult.x * fogDap;
            
            
            Cd.rgb= mix( Cd.rgb, vec3(mult), mult)-mult*.4;
 
            vec3 bloomCd=texture2D(bloomTexture,vUv).rgb;
            Cd.rgb+= bloomCd;
            Cd.rgb*=exposure;
            
            // Proximity Draw Over
            float dProx=  ((mDepth-.5)*-10.);
            dProx= max(0.0, (1.0-dProx)*step( 0., dProx));
            float yProxMult= 1.0-min(1.0, max(0.0, (worldPos.y-.5 )*1000.));
            dProx*= dProx* yProxMult * proximityMult.x;
            vec3 proxCd = (vec3(.5,.5,.2)*dProx)*.5;
            Cd.rgb+=proxCd*mult;
            
            Cd.a=1.0;
            gl_FragColor = Cd;
        }`,o}function Ms(){let o=I();return o+=`
        uniform sampler2D tDiffuse;
        uniform sampler2D rDiffuse;
        uniform sampler2D bloomTexture;
        uniform sampler2D sceneDepth;
        uniform vec2 time;
        uniform vec2 proximityMult;
        uniform vec2 lookAtPerc;
        uniform vec2 resUV;
        uniform float ratio;
        uniform float exposure;
        varying vec2 vUv;

        #define PROX_WARP 3.14159265358979*.4
        #define PI 3.14159265358979
        
        vec3 boostHighs( vec3 Cd ){
            float sat=max(max(Cd.r,Cd.g),Cd.b) - min(min(Cd.r,Cd.g),Cd.b);
            sat=(1.0-sat);
            sat=1.0-sat*sat;
            Cd+=Cd*sat;
            return Cd;
        }
        
        vec3 boostMids( vec3 Cd ){
            float sat=max(max(Cd.r,Cd.g),Cd.b) - min(min(Cd.r,Cd.g),Cd.b);
            sat=sin( sat*PI );
            Cd+=Cd*sat;
            return Cd;
        }
        
        void main() {
            vec4 Cd=texture2D(rDiffuse,vUv);
            vec2 uv=vUv;
            
            vec3 bloomCd=texture2D(bloomTexture,uv).rgb;
            bloomCd= mix( boostHighs(Cd.rgb), bloomCd,  step( 0.01, length( bloomCd )) );
            
            Cd.rgb+= bloomCd;

            // Proximity Draw Over
            float depth=texture2D(sceneDepth,vUv).r;
            
            // Distance Mapping
            float proxWarp= cos(( vUv.x-.5 ) * PROX_WARP*ratio );
            float mDepth= pow( depth, 28.*proxWarp );
            
            // Proximity Draw Over
            float dProx=  ((mDepth-.5)*-10.);
            dProx= max(0.0, (1.0-dProx)*step( 0., dProx));
            dProx*= dProx * proximityMult.x;
            vec3 proxCd = (vec3(.5,.5,.2)*dProx)*.5;
            Cd.rgb+=proxCd;
            Cd.r=1.0;
            Cd.a=1.0;
            gl_FragColor = Cd;
        }`,o}var Qt={};re(Qt,{bgScreenFrag:()=>Rs,bgScreenVert:()=>Ls,skyObjectFrag:()=>ks,skyObjectVert:()=>As});function Ls(){let o=I();return o+=`
    uniform vec2 time;
    
    varying vec2 vUv;
    varying vec3 vCamNormal;
    varying vec3 vWorldNormal;
    varying vec3 vWorldCross;
    varying vec3 vSunPos;
    
    void main(){
        vUv=uv;
        
        mat4 pvMat=projectionMatrix * viewMatrix;
        pvMat[3] = vec4(.0, .0, .0, 1.0);
        mat3 pvRot = inverse( mat3( pvMat ) );
        vCamNormal= pvRot * vec3( position*.2 + vec3(.0, .0, 1.0));
        vWorldNormal= normalize( pvRot[2] *vec3(1.,0.,1.));
        vWorldCross= normalize( pvRot[0]*vec3(1.,0.,1.));
        
        float timeRate = time.x * .1;
        vec3 sunPos = normalize( vec3(.3, 1.0, 1.0) );
        vec3 sunRef = sunPos;
        sunPos.y= sin(timeRate) * sunRef.y + cos(timeRate)*sunRef.z;
        sunPos.z= sin(timeRate) * sunRef.z - cos(timeRate)*sunRef.y;
        sunPos.x = sin( timeRate ) * .1;
        
        vSunPos = normalize( sunPos );
        
        vec4 modelViewPosition= vec4(position*2.0 + vec3(.0, .0, 1.0), 1.0);
        gl_Position = modelViewPosition;
    }`,o}function Rs(){let o=I();return o+=`
    uniform sampler2D noiseTexture;
    varying vec2 vUv;
    varying vec3 vCamNormal;
    varying vec3 vWorldNormal;
    varying vec3 vWorldCross;
    varying vec3 vSunPos;
    
    void main(){
        vec4 Cd=vec4( vec3(1.0, .10, .10), 1.0);
        
        float sunDot = dot( vSunPos, vCamNormal )*.5 +.5;
        sunDot *= max(0.0, dot( vSunPos, vec3(.0, 1.0, .0)) );
        
        vec2 xOffset = vec2( .0, .0);
        vec3 nCd=texture2D(noiseTexture,vUv*.1+vSunPos.zy*vec2(.15,.22) + xOffset ).rgb;
        nCd*=texture2D(noiseTexture,vUv*.1+vSunPos.yx*.2).rgb;
        sunDot *= nCd.x*nCd.y*nCd.z;
        nCd= vec3( length( nCd ) );
        
        float mixVal= min(1.0, sunDot+(1.-(vWorldNormal.y*.5+.5)));
        Cd.rgb= mix(vec3(0.0, .20, 1.0)+nCd*vWorldNormal.y, vec3(.0, .0, .0), mixVal);
        Cd.rgb=mix( vec3(.0), Cd.rgb, vWorldNormal.y );
        Cd.rgb=vec3(mix( vWorldNormal, vWorldCross, step(.4, vUv.x)));
        Cd.rgb=vec3(mix( vWorldCross, Cd.rgb, step(vUv.y,.9)));
        gl_FragColor=Cd;
    }`,o}function As(){let o=I();return o+=`
    uniform float camFar;
    uniform vec2 resUV;
    
    varying vec2 vUv;
    varying vec3 vLocalPos;
    varying vec4 vWorldPos;
    
    void main(){
        vUv=uv;
        vLocalPos=position;
        
        vec3 pos = position;
        vec4 modelViewPosition=projectionMatrix * viewMatrix * vec4(normalize(position)*camFar, 1.0);
        gl_Position = modelViewPosition;
        
        vWorldPos = modelViewPosition;
        
    }`,o}function ks(){let o=I();return o+=`     
    uniform sampler2D diffuse;
    uniform sampler2D envDiffuse;
    uniform sampler2D noiseTexture;
    uniform vec2 time;
    uniform float camNear;
    uniform float camFar;
    uniform vec2 resUV;

    uniform float rate;
    uniform vec3 fogColor;
    
    varying vec2 vUv;
    varying vec3 vLocalPos;
    varying vec4 vWorldPos;
    
    #define PI 3.14159265358979323

    float fitDepth( float zDepth ){
        float viewZ = ( camNear * camFar ) / ( ( camFar - camNear ) * zDepth - camFar );
        return ( viewZ + camNear ) / ( camNear - camFar );
    }
    
    void main(){
        vec2 uv=vUv;
        vec2 screenUV=(vec2(vWorldPos.xy/vWorldPos.w))*.5+.5;
        vec4 Cd=texture2D(diffuse,uv);
        float t = time.x*.6;
        
        vec2 nUv = ( vec2(vUv.x*0.40, vUv.y - t*.01) );
        vec3 noiseCd = texture2D( noiseTexture, nUv ).rgb;
        nUv = ( nUv+noiseCd.rg*(noiseCd.b));
        //nUv.y *= .5;
        noiseCd = texture2D( noiseTexture, nUv ).rgb;
        noiseCd.rg = noiseCd.rg*2.0-1.0;
        
        float zFrag = texture2D( envDiffuse, screenUV ).x;
        float depth = fitDepth( zFrag );
        float stencil = zFrag==1.0 ? 1.0 : 0.0;
        
        float reachDepth = 0.0 ;
        vec2 baseUV=screenUV;
        vec2 curUV=vec2(0.0);
        float curDepth=0.0;
        float curPerc = 0.0;
        float dist = 11.0;
        float blendStep = .4;
        float blend = 0.0;
        float uvShift=0.0;
        for(int s=0; s<5; ++s){
            uvShift = mix(noiseCd.r, noiseCd.g, fract(noiseCd.b+float(s)*193.5247))*15.0;
            curUV = baseUV+vec2(0.0,resUV.y*-(dist+uvShift) );
            curDepth = texture2D(envDiffuse,curUV).x ;
            curDepth = fitDepth( curDepth );
            curPerc = step( .3, (1.0-curDepth)*7.0 );
            reachDepth += min(1.0,curDepth)*curPerc;
            blend += blendStep;
            dist+=dist*dot(noiseCd.rgb, vec3(0.0,0.0,1.0));
        }
        reachDepth *= blend*stencil*3.0;
        
        vec3 normPos = normalize(vLocalPos);
        normPos.y = 1.0-min(1.0,(normPos.y)*2.0);
        normPos.y = normPos.y*normPos.y*normPos.y;
        depth = clamp(reachDepth+normPos.y, 0.0, 1.0);
        
        float blender = (sin(noiseCd.r*PI+t+uv.x)*.03)*max(0.0,1.0-depth);
        vec3 baseColor = (fogColor+blender);
        Cd.rgb = mix(Cd.rgb*1.5, baseColor, depth);
        
        gl_FragColor=Cd;
    }`,o}var Is={animated:Gt,core:Ot,objects:jt,particles:Wt,rendering:zt,scene:Qt};var an="0.0.15";var Bs="pxlNav-coreCanvas";var Us,Hs,Nt=window.innerWidth,Kt=window.innerHeight,_s=class{constructor(e,t,i,s,r){this._active=!1,this.options={loadList:["Cloud3d","SoftNoise","SmoothNoise","WarpAnimTexture"]},this.options=Object.assign(this.options,e);let l=Object.keys(this.options);Object.keys(Le).forEach(v=>{l.includes(v)||(this.options[v]=Le[v])}),this.verbose=this.options.verbose,this.projectTitle=t,this.startingRoom=s,r.includes(s)||r.push(s),this.roomBootList=r,this.callbacks={},this.uriHashParms=this.findHashParms(),this.mobile=this.isMobile(),this.autoCam=this.getHashParm("autoCam",!1),this.loadPercent=0,this.folderDict={assetRoot:"assets/",guiRoot:"assets/GUI/",roomRoot:"assets/rooms/",vidRoot:"assets/screenContent/"},this.validEvents={booted:"Emitted after the engine has fully booted and is ready to be addressed.",shaderEditorVis:"Returns a [bool]; Emitted when the shader editor is toggled on or off.","roomChange-Start":"Emitted when the room change transition begins.","roomChange-Middle":"Emitted when the room change process occurs mid transition.","roomChange-End":"Returns a [bool]; Emitted when the room change transition ends.",fromRoom:"Returns a custom object; Emitted from your Room code you choose to emit during run time.","device-keydown":"Returns an [int]; The just pressed key.","device-keyup":"Returns an [int]; The just released key.","device-resize":"Returns an [{height:#,width:#}]; Height Width object of the new window size.",pxlNavEventNameHere:"Never emitted; You did some copy'pasta.","":"** NOTE : callbacks get an event object shaped -  **","":"** { 'type' : *eventName*, 'value' : *data* } **","":"",help:"Hello! I'm here to help you!",pingPong:"Send 'ping', Get 'pong'! - pxlNav.trigger('ping');"},this.validEventsKeys=Object.keys(this.validEvents),this.loadEnvAssetFile=!0,this.pxlTimer=new ze,this.pxlShaders=Is,this.pxlCookie=new We(t,"/"),this.pxlCookie.hasCookie("forceMobile")&&(this.mobile=pxlCookie.parseCookie("forceMobile")),this.pxlQuality=new je(this.verbose,this.mobile,this.uriHashParms),this.pxlUtils=new He(this.folderDict.assetRoot,this.mobile),this.pxlFile=new ce(this.folderDict),this.pxlExtensions=new Be,this.pxlAudio=new tt(this.pxlTimer),this.pxlAutoCam=new qe(this.autoCam,this.mobile),this.pxlAutoCam.active=!1,this.pxlUser=new Qe,this.pxlEnv=new $e(this.options,this.startingRoom,i,this.mobile),this.pxlDevice=new Ne(t,Bs,this.mobile,this.autoCam),this.pxlCamera=new Je,this.options.staticCamera&&this.pxlCamera.toggleMovement(!1),this.pxlAnim=new Ke(this.folderDict.assetRoot,this.pxlTimer),this.pxlGuiDraws=new Ze(this.verbose,t,this.folderDict.assetRoot,this.folderDict.guiRoot),this.pxlQuality.setDependencies(this),this.pxlUtils.setDependencies(this),this.pxlFile.setDependencies(this),this.pxlAudio.setDependencies(this),this.pxlAutoCam.setDependencies(this),this.pxlEnv.setDependencies(this),this.pxlAnim.setDependencies(this),this.pxlDevice.setDependencies(this),this.pxlCamera.setDependencies(this),this.pxlGuiDraws.setDependencies(this),this.pxlGuiDraws.prepLoader(),this.pxlQuality.init()}set active(e=null){e==null&&(e=!this.pxlTimer.active),e==!0?(this.pxlTimer.play(),this.step(!1)):this.pxlTimer.stop()}get active(){return this.pxlTimer.active}start(){this.active=!0}stop(){this.active=!1}init(){this.pxlEnv.boot(),this.pxlQuality.startBenchmark(),this.buildGui().then(()=>{this.tickLoader(),this.bootEnvironment()}).then(()=>{this.tickLoader(),this.bootEngine()}).then(()=>{this.tickLoader(),this.pxlEnv.buildComposers(),this.cameraRunAnimatorMobile(this),this.pxlGuiDraws.stepLoader("postBoot"),this.pxlEnv.mapRender(),this.pxlDevice.setCursor("grab")}).catch(e=>{this.verbose>ae.NONE&&(console.error("Error in pxlNavCore.init(); Load level - ",e),console.error(e))}).finally(()=>{this.verbose>ae.ERROR&&(console.log("pxlNavCore Room Build Promise-Chain Completed; ",this.loadPercent),console.log("  -- Starting pxlNav in Room `"+this.pxlEnv.bootRoom+"`")),this.start()})}buildGui(){return new Promise((e,t)=>{this.pxlGuiDraws.booted(),this.pxlGuiDraws.pxlNavCanvas=document.getElementById(Bs),Us=window.innerWidth*this.pxlQuality.screenResPerc,this.pxlGuiDraws.pxlNavCanvas.width=window.innerWidth,Hs=window.innerHeight*this.pxlQuality.screenResPerc,this.pxlGuiDraws.pxlNavCanvas.height=window.innerHeight,this.pxlDevice.canCursorLock&&(this.pxlGuiDraws.pxlNavCanvas.requestPointerLock=this.pxlGuiDraws.pxlNavCanvas.requestPointerLock||this.pxlGuiDraws.pxlNavCanvas.mozRequestPointerLock||this.pxlGuiDraws.pxlNavCanvas.webkitRequestPointerLock,document.requestPointerLock=this.pxlGuiDraws.pxlNavCanvas.exitPointerLock||this.pxlGuiDraws.pxlNavCanvas.mozExitPointerLock||this.pxlGuiDraws.pxlNavCanvas.webkitExitPointerLock),this.pxlGuiDraws.mapPrepPrompts(),e(!0)})}isMobile(){var e=!1;return e=/\b(BlackBerry|webOS|iPhone|IEMobile|Android|Windows Phone|iPad|iPod)\b/i.test(navigator.userAgent),e=this.getHashParm("m",e),e}findHashParms(){var e={},t=window.location.hash;if(t.length>1){t=t.substring(1);for(var i=t.split("&"),s=0;s<i.length;s++){var r=i[s].split("=");e[r[0]]=r[1]}}return e}getHashParm(e,t){return Object.keys(this.uriHashParms).includes(e)?this.uriHashParms[e]:t}tickLoader(){this.loadPercent+=1}bootEngine(){return new Promise((e,t)=>{let i=[];for(let s=0;s<this.roomBootList.length;++s)i.push(this.pxlEnv.loadRoom(this.roomBootList[s]));Promise.all(i).then(()=>{e(!0)})})}bootEnvironment(){return new Promise((e,t)=>{this.pxlEnv.engine=new V.WebGLRenderer({canvas:this.pxlGuiDraws.pxlNavCanvas,alpha:!0,antialias:!1,sortObjects:!0,depth:!0});var i={format:V.RGBAFormat,antialias:!1,sortObjects:!0,alpha:!0,type:/(iPad|iPhone|iPod)/g.test(navigator.userAgent)?V.HalfFloatType:V.FloatType};this.pxlEnv.engine.autoClear=!0,this.pxlEnv.engine.debug.checkShaderErrors=!1,this.pxlEnv.engine.debug.checkShaderErrors=!0,this.verbose>=ae.INFO&&(this.pxlEnv.engine.extensions.get("WEBGL_depth_texture")?console.log("  ** WebGL Depth Texture support enabled **"):console.log("  ** WebGL Depth Texture NOT supported **"),console.log("-- Depth Composer pass currently not used, --"),console.log("  -- A future technology for Metal Asylum --"));let s=0,r="#000000";this.pxlEnv.engine.setClearColor(this.pxlEnv.fogColor,0),this.pxlEnv.engine.setSize(Us/this.pxlQuality.screenResPerc,Hs/this.pxlQuality.screenResPerc),this.pxlEnv.engine.setPixelRatio(1),this.pxlEnv.engine.outputEncoding=V.GammaEncoding,this.pxlEnv.engine.shadowMap.enabled=!0,this.pxlEnv.engine.shadowMap.type=V.BasicShadowMap,this.pxlEnv.scene=new V.Scene,this.pxlEnv.scene.fog=this.pxlEnv.fog,this.pxlEnv.scene.background=new V.Color(r),this.pxlEnv.scene.renderTarget=new V.WebGLRenderTarget(Nt*this.pxlQuality.screenResPerc,Kt*this.pxlQuality.screenResPerc,i),this.pxlEnv.scene.renderTarget.texture.format=V.RGBAFormat,this.pxlEnv.scene.renderTarget.texture.minFilter=V.LinearFilter,this.pxlEnv.scene.renderTarget.texture.magFilter=V.LinearFilter,this.pxlEnv.scene.renderTarget.texture.generateMipmaps=!1,this.pxlEnv.scene.renderTarget.depthBuffer=!0,this.pxlEnv.scene.renderTarget.depthTexture=new V.DepthTexture,this.pxlEnv.scene.renderTarget.depthTexture.format=V.DepthFormat,this.pxlEnv.scene.renderTarget.depthTexture.type=V.UnsignedIntType,this.pxlEnv.scene.renderWorldPos=new V.WebGLRenderTarget(Nt*this.pxlQuality.screenResPerc,Kt*this.pxlQuality.screenResPerc,i),this.pxlEnv.scene.renderWorldPos.texture.format=V.RGBAFormat,this.pxlEnv.scene.renderWorldPos.texture.minFilter=V.NearestFilter,this.pxlEnv.scene.renderWorldPos.texture.magFilter=V.NearestFilter,this.pxlEnv.scene.renderWorldPos.texture.generateMipmaps=!1,i.alpha=!0,this.pxlEnv.scene.renderGlowTarget=new V.WebGLRenderTarget(parseInt(Nt*this.pxlQuality.screenResPerc),parseInt(Kt*this.pxlQuality.screenResPerc),i),this.pxlEnv.scene.renderGlowTarget.texture.format=V.RGBAFormat,this.pxlEnv.scene.renderGlowTarget.texture.generateMipmaps=!1;var l=this.pxlGuiDraws.pxlNavCanvas.width/this.pxlGuiDraws.pxlNavCanvas.height;if(this.pxlCamera.camera=new V.PerspectiveCamera(this.pxlEnv.pxlCamFOV,1,this.pxlEnv.camNear,this.pxlEnv.camFar),this.pxlAutoCam.camera=this.pxlCamera.camera,this.pxlCamera.cameraAimTarget=new V.Object3D,this.pxlEnv.scene.add(this.pxlCamera.cameraAimTarget),this.pxlCamera.camera.target=this.pxlCamera.cameraAimTarget,this.pxlCamera.camera.layers.enable(1),this.pxlCamera.camera.layers.enable(2),this.pxlEnv.scene.add(this.pxlEnv.userAvatarGroup),this.options.loadList.includes("Cloud3d")&&(this.pxlEnv.cloud3dTexture=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"Noise_Cloud3d.jpg"),this.pxlEnv.cloud3dTexture.wrapS=V.RepeatWrapping,this.pxlEnv.cloud3dTexture.wrapT=V.RepeatWrapping),this.options.loadList.includes("SoftNoise")&&(this.pxlEnv.softNoiseTexture=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"Noise_Soft3d.jpg"),this.pxlEnv.softNoiseTexture.wrapS=V.RepeatWrapping,this.pxlEnv.softNoiseTexture.wrapT=V.RepeatWrapping),this.options.loadList.includes("SmoothNoise")&&(this.pxlEnv.detailNoiseTexture=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"Noise_UniformSmooth.jpg"),this.pxlEnv.detailNoiseTexture.wrapS=V.RepeatWrapping,this.pxlEnv.detailNoiseTexture.wrapT=V.RepeatWrapping),this.options.loadList.includes("ChromaticAberration")){let y=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"uv_ChromaticAberration.png");y.minFilter=V.LinearFilter,y.magFilter=V.LinearFilter,this.pxlEnv.chroAberUVTexture=y}this.options.loadList.includes("WarpAnimTexture")&&(this.pxlEnv.blockAnimTexture=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"uv_blockPortalWarp.jpg"),this.pxlEnv.blockAnimTexture.minFilter=V.LinearFilter,this.pxlEnv.blockAnimTexture.magFilter=V.LinearFilter),this.options.loadList.includes("MathFuncs")&&(this.pxlEnv.mathFuncsTexture=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"MathFuncs.jpg"),this.pxlEnv.mathFuncsTexture.minFilter=V.LinearFilter,this.pxlEnv.mathFuncsTexture.magFilter=V.LinearFilter);var u,v,p=(y=null)=>{var f={t:[0,0,0],r:[0,0,0],s:[1,1,1]};return y!=null&&(f[y[0]]=y[1]),f};v=p();let g="";if(this.mobile&&(g="_mobile"),this.loadEnvAssetFile){let y=this.folderDict.assetRoot+"EnvironmentAssets.fbx";this.pxlFile.loadSceneFBX(y,u,v,this.verbose,"EnvironmentAssets",[this.pxlEnv.scene])}this.pxlEnv.engine.shadowMap.enabled=!0,this.mobile?this.pxlEnv.engine.shadowMap.type=V.BasicShadowMap:this.pxlEnv.engine.shadowMap.type=V.PCFSoftShadowMap;var m=new V.AmbientLight(16777215,.05);this.pxlEnv.lightList.push(m),this.pxlEnv.scene.add(m);var C=new V.DirectionalLight(16777215,.1);C.position.set(1e3,550,1200),this.pxlEnv.lightList.push(C),this.pxlEnv.scene.add(C),e(!0)})}cameraRunAnimatorMobile(e){let t=!1,i=Object.keys(e.pxlEnv.geoLoadList);for(let s=0;s<i.length&&(t=e.pxlEnv.geoLoadList[i[s]]==0,t=t&&!e.pxlEnv.roomSceneList[s]?.booted,!t);++s);t?setTimeout(()=>{e.cameraRunAnimatorMobile(e)},300):e.initRoomList(e)}initRoomList(e){e.pxlGuiDraws.stepLoader("camAnim"),e.pxlCamera.setTransform(e.pxlEnv.camInitPos,e.pxlEnv.camInitLookAt),e.pxlCamera.updateCamera(),e.pxlEnv.buildRoomEnvironments(),e.monitorRoomLoad(e)}monitorRoomLoad(e,t=0){let i=!1,s=Object.keys(e.pxlEnv.geoLoadList);for(let r=0;r<s.length&&(i=e.pxlEnv.geoLoadList[s[r]]==0,i=i&&!e.pxlEnv.roomSceneList[r]?.booted,!i);++r);i?setTimeout(()=>{e.monitorRoomLoad(e)},300):(e.pxlQuality.mapAutoQualityUpdate(1,!0),e.runPrepDrawScenes(0,!0,[]))}runPrepDrawScenes(e=0,t=!0,i=[]){if(e++,i.length>0){if(t){t=!1;let s=i[i.length-1];this.pxlCamera.warpToRoom(s)}if(this.pxlCamera.colliderPrevObjHit=null,this.pxlEnv.mapRender(!1),e%10==0){let s=i.pop();t=!0,this.pxlGuiDraws.stepLoader(s)}requestAnimationFrame(()=>{this.runPrepDrawScenes(e,t,i)})}else this.pxlGuiDraws.stepLoader("Post Room Prep"),this.pxlNavPrepSettings()}pxlNavPrepSettings(){this.pxlCamera.warpToRoom(this.pxlEnv.bootRoom,!0),this.pxlQuality.endBenchmark(),this.pxlGuiDraws.stepLoader("Nav Settings"),this.startPxlNav()}startPxlNav(){this.pxlTimer.init(),this.pxlTimer.play(),this.pxlGuiDraws.applyCookies(),this.pxlGuiDraws.pxlNavCanvas&&this.pxlGuiDraws.pxlNavCanvas.focus();let e=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom];e.active=!0,e.startTime=this.pxlTimer.msRunner.x,this.pxlEnv.roomPostGuiCalls.forEach(i=>{i.postGuiEvent()}),this.pxlEnv.roomPostGuiCalls=[],this.pxlAutoCam.enabled&&this.pxlGuiDraws.guiToggleVisibility(!1),this.pxlAutoCam.init(),this.pxlDevice.resizeRenderResolution(),this.pxlEnv.mapRender(),this.pxlQuality.setDependentSettings(),this.pxlGuiDraws.stepLoader("Starting...");let t=this;setTimeout(()=>{t.pxlEnv.postBoot(),t.pxlGuiDraws.mapPrompt&&t.pxlGuiDraws.promptFader(t.pxlGuiDraws.mapPrompt,!1,null,!0),t.pxlGuiDraws.mapPromptBG&&t.pxlGuiDraws.promptFader(t.pxlGuiDraws.mapPromptBG,!1,null,!1),t.emit("booted",!0)},200)}step(e=!1){this.pxlTimer.active&&(this.pxlTimer.step(),e&&requestAnimationFrame(()=>{this.step()}))}bootTimer(){this.pxlTimer.init(),this.pxlTimer.play()}stopTimer(){this.pxlTimer.stop()}pauseTimer(){this.pxlTimer.pause()}prepPromptFader(e,t=!1){let i=e;typeof i=="string"&&(i=document.getElementById(i),!i)||(i.classList.add("fader"),i.classList.add(t?"visOn":"visOff"),i.style.display=t?"inline-block":"none")}promptFader(e,t,i=null,s=!1){typeof e=="string"&&(e=document.getElementById(e),!e)||(e.classList.value.indexOf("fader")<0&&e.classList.add("fader"),t?(e.style.display="inline-block",setTimeout(()=>{e.classList.contains("visOff")&&(e.classList.remove("visOff"),e.classList.add("visOn"),i!=null&&(e.setAttribute("fadeOut",clockTime+i*1e3),fadeOutList.push(e)))},50)):(e.classList.remove("visOn"),e.classList.add("visOff"),s?["webkitTransitionEnd","otransitionend","oTransitionEnd","msTransitionEnd","transitionend"].forEach(l=>{e.addEventListener(l,()=>{let u=e.parentNode;u&&u.removeChild(e)})}):setTimeout(()=>{e.classList.contains("visOff")&&(e.style.display="none")},1e3)))}addRooms(e){for(let t=0;t<e.length;++t)this.pxlEnv.roomNameList.includes(e[t])||this.booted||this.roomBootList.push(e[t])}setBootRoom(e,t){console.log(e,t),this.pxlEnv.bootRoom=e,this.pxlEnv.bootLocation=t}setLoaderPhrases(e){this.pxlGuiDraws.setLoaderPhrases(e)}initExtension(e,t,i){this.pxlExtensions.init(e,t,i)}startExtension(e,t,i){this.pxlExtensions.start(e,t,i)}stopExtension(e,t,i){this.pxlExtensions.stop(e,t,i)}extensionStatus(e){return this.pxlExtensions.status(e)}trigger(e,t=null,i=null){switch(e=e.toLowerCase(),e){case"warptoroom":this.pxlCamera.warpToRoom(t,!0,i);break;case"camera":let s=t.toLowerCase();s=="roam"?this.pxlCamera.toggleMovement(!0):s=="static"&&this.pxlCamera.toggleMovement(!1);break;case"ping":this.emit("pingPong","pong");break;case"roommessage":let r=i.type,l=i.value;t==null&&(t=this.pxlEnv.currentRoom),this.pxlEnv.sendRoomMessage(t,r,l);default:break}}subscribe(e,t){let i=!1;if(this.validEventsKeys.includes(e))if(e=="test")console.log("Test Event : `pxlNav.subscribe( 'test', ... )` was used; subscription list -");else if(e=="pxlNavEventNameHere"||e=="help")e=="pxlNavEventNameHere"?console.warn("Warning : `pxlNav.subscribe( 'pxlNavEventNameHere', ... )` was used; need some help?"):e=="help"&&console.log("Help Requested : `pxlNav.subscribe( 'help', ... )` was used; Subscription items--"),console.log("Valid Event Types : "),this.validEventsKeys.forEach(s=>{console.log("  - ",s," : ",this.validEvents[s])});else{let s=e.split("-");s[0]=="device"?this.pxlDevice.subscribe(s[1],t):this.callbacks[e]=t}else console.warn("Warning : `pxlNav.subscribe( '"+e+"', ... )` was used; use 'help' for a list of valid events.")}emit(e,t,i=null){if(this.callbacks[e]){let s={type:e,value:t};i!==null&&(s.status=i),this.callbacks[e](s)}}};export{Me as ANTI_ALIASING,Le as PXLNAV_OPTIONS,ae as VERBOSE_LEVEL,_s as pxlNav,an as pxlNavVersion};
/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */
