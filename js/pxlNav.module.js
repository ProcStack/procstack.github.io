var Fl=Object.create;var Bs=Object.defineProperty;var Ol=Object.getOwnPropertyDescriptor;var Ul=Object.getOwnPropertyNames;var Gl=Object.getPrototypeOf,Nl=Object.prototype.hasOwnProperty;var Ra=l=>e=>{var t=l[e];if(t)return t();throw new Error("Module not found in bundle: "+e)};var lt=(l,e)=>()=>(l&&(e=l(l=0)),e);var Vl=(l,e)=>()=>(e||l((e={exports:{}}).exports,e),e.exports),ve=(l,e)=>{for(var t in e)Bs(l,t,{get:e[t],enumerable:!0})},Is=(l,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Ul(e))!Nl.call(l,s)&&s!==t&&Bs(l,s,{get:()=>e[s],enumerable:!(i=Ol(e,s))||i.enumerable});return l},pe=(l,e,t)=>(Is(l,e,"default"),t&&Is(t,e,"default")),Hl=(l,e,t)=>(t=l!=null?Fl(Gl(l)):{},Is(e||!l||!l.__esModule?Bs(t,"default",{value:l,enumerable:!0}):t,l));var Mn={};ve(Mn,{ExtensionBase:()=>Xe});var Xe,$t=lt(()=>{Xe=class{constructor(e=null){this.extType=e||"ExtensionBase",this.active=!1,this.verbose=!1,this.callbacks={}}init(){}start(){this.active=!0}pause(){this.stop()}stop(){this.active=!1}subscribe(e,t){this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t)}unsubscribe(e,t){this.callbacks[e]&&(this.callbacks[e]=this.callbacks[e].filter(i=>i!==t))}emit(e,t){this.callbacks[e]&&this.callbacks[e].forEach(i=>i(t))}destroy(){this.disable()}}});var Ln={};ve(Ln,{default:()=>as});var ea,as,kn=lt(()=>{$t();ea=class{constructor(e,t){this.url=e,this.options=t}on(e,t){}emit(e,t){}},as=class extends Xe{constructor(e){super("Networking"),this.status=!1,this.accessToken="",this.jwtToken="",this.socket=ea("https://www.www.com",{transports:["websocket"]})}init(){this.socket.on("event",e=>{console.log(e)}),this.socket.on("connect",this.onConnect),this.socket.on("disconnect",this.onDisconnect),this.socket.on("authenticated",this.onAuthenticated),this.socket.on("unauthorized",console.error)}onConnect(){console.log("Successfully connected to the websocket"),this.socket.emit("authenticate",{method:"jwt",token:this.jwtToken})}onDisconnect(){console.log("Disconnected from websocket"),this.status=!1,this.onConnect()}onAuthenticated(e){let{channelId:t}=e;console.log(`Successfully connected to channel ${t}`),this.status=!0}}});var Qn={};ve(Qn,{MediaPipePoseEngine:()=>ei});var ei,ta=lt(()=>{ei=class l{constructor(){this.workerScriptUrl="./PoseEngine_worker.js",this.worker=null,this.booted=!1}static async loadScriptWithProgress(e,t){return new Promise((i,s)=>{let r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="text",r.onprogress=a=>{if(a.lengthComputable&&typeof t=="function"){let o=Math.round(a.loaded/a.total*100);t(o)}},r.onload=()=>{if(r.status===200){let a=document.createElement("script");a.textContent=r.responseText,document.head.appendChild(a),i()}else s(new Error(`Failed to load script: ${e}`))},r.onerror=()=>s(new Error(`Network error while loading: ${e}`)),r.send()})}async init(e){let t="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js";try{console.log("Loading MediaPipe..."),await l.loadScriptWithProgress(t,e),this.worker=new Worker(this.workerScriptUrl),this.booted=!0,console.log("MediaPipe Pose Engine Initialized")}catch(i){console.error("Error initializing MediaPipePoseEngine:",i)}}sendMessage(e){if(!this.booted){console.warn("MediaPipePoseEngine is not initialized.");return}this.worker.postMessage(e)}onMessage(e){if(!this.worker){console.warn("WebWorker not initialized.");return}this.worker.onmessage=t=>e(t.data)}terminateWorker(){this.worker&&(this.worker.terminate(),this.worker=null,console.log("WebWorker terminated."))}}});var _n={};ve(_n,{default:()=>os,pxlPoseEngineList:()=>_A});var _A,os,Fn=lt(()=>{$t();ta();_A=["MediaPipe"],os=class extends Xe{constructor(e){switch(super(),this.active=!1,this.verbose=!1,e){case"MediaPipe":this.model=new ei;break;default:throw new Error("Unknown pose estimation '"+e+"' model")}}async estimatePose(e){return await this.model.estimate(e)}}});var Un=Vl(()=>{var On=null,FA=async()=>{try{console.log("Pose model initialization placeholder")}catch(l){console.error("Failed to initialize pose model:",l)}};self.onmessage=async l=>{let{type:e,data:t}=l.data;switch(e){case"init":await FA(),self.postMessage({type:"initialized"});break;case"processFrame":if(!On){self.postMessage({type:"error",error:"Pose model not initialized"});return}try{let{imageData:i}=t,s=await On.estimate(i);self.postMessage({type:"result",pose:s})}catch(i){self.postMessage({type:"error",error:i.message})}break;default:console.warn("Unknown message type:",e)}}});var Gn={};ve(Gn,{WebCamera:()=>ia});var ia,Nn=lt(()=>{$t();ia=class extends Xe{constructor(){super("WebCamera"),this.video=document.createElement("video"),this.stream=null,this.isInitialized=!1,this.active=!1}init(e){navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(t=>{this.stream=t,this.video.srcObject=this.stream,this.video.play(),this.isInitialized=!0,console.log("WebCamera Initialized"),e&&e(null)}).catch(t=>{console.error("Error initializing WebCamera:",t),e&&e(t)})}start(e){this.isInitialized?(this.active=!0,console.log("WebCamera Started"),e&&e(null)):(console.error("WebCamera is not initialized"),e&&e(new Error("WebCamera is not initialized")))}pause(e){this.stop(e)}stop(e){this.stream?(this.stream.getTracks().forEach(t=>t.stop()),this.video.srcObject=null,this.isInitialized=!1,console.log("WebCamera Stopped"),this.active=!1,e&&e(null)):e&&e(new Error("WebCamera is not initialized"))}}});var OA,sa=lt(()=>{OA=Ra({"./ExtensionBase.js":()=>Promise.resolve().then(()=>($t(),Mn)),"./Extensions.js":()=>Promise.resolve().then(()=>(ra(),Vn)),"./Networking.js":()=>Promise.resolve().then(()=>(kn(),Ln)),"./PoseEngine.js":()=>Promise.resolve().then(()=>(Fn(),_n)),"./PoseEngine/MediaPipe.js":()=>Promise.resolve().then(()=>(ta(),Qn)),"./PoseEngine/PoseEngine_worker.js":()=>Promise.resolve().then(()=>Hl(Un())),"./WebCam.js":()=>Promise.resolve().then(()=>(Nn(),Gn))})});var Vn={};ve(Vn,{Extensions:()=>ti});var UA,ti,ra=lt(()=>{sa();UA=["PoseEngine"],ti=class{constructor(){this.plugins={},this.verbose=!1}init(e,t,i,s=!1){!this.plugins[e]||s?this.load(e,(r,a)=>{r?i?i(r):this.verbose&&console.error(r):t&&t(a)}):(this.verbose&&console.log(`Extension ${e} already booted, skipping...`),t&&t(this.plugins[e]))}async load(e,t){if(UA.includes(e))try{let i=await OA(`./${e}.js`),s=new i.default;try{this.boot(e,s)}catch(r){console.error(`Error (2) Booting extension '${e}':`,r)}t&&t(null,s)}catch(i){console.error(`Error (1) Importing / Parsing extension '${e}':`,i),t&&t(i,null)}else{let i=new Error(`Extension ${e} not found`);console.error(i),t&&t(i,null)}}start(e){let t=this.get(e);t&&t.start()}pause(e){let t=this.get(e);t&&t.pause()}stop(e){let t=this.get(e);t&&t.stop()}status(e){let t=this.get(e);return t?t.active:!1}boot(e,t){this.plugins[e]=t,t.init()}get(e){return this.plugins[e]?this.plugins[e]:(console.warn(`Extension ${e} not found`),null)}unload(e){let t=this.get(e);t&&(t.destroy(),delete this.plugins[e])}}});var y={};ve(y,{BufferGeometryUtils:()=>Ci,CopyShader:()=>Fe,DRACOLoader:()=>yt,EffectComposer:()=>De,FBXLoader:()=>fi,FullScreenQuad:()=>Je,GLTFLoader:()=>bt,KTX2Loader:()=>Pe,LuminosityHighPassShader:()=>hi,MeshoptDecoder:()=>wi,Pass:()=>be,RenderPass:()=>ht,ShaderPass:()=>X,UnrealBloomPass:()=>$e});pe(y,cf);import*as cf from"three";import{Clock as Xl,HalfFloatType as Jl,NoBlending as Zl,Vector2 as Ma,WebGLRenderTarget as $l}from"three";var Fe={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`
varying vec2 vUv;

void main() {

	vUv = uv;
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

}`,fragmentShader:`
uniform float opacity;

uniform sampler2D tDiffuse;

varying vec2 vUv;

void main() {

	vec4 texel = texture2D( tDiffuse, vUv );
	gl_FragColor = opacity * texel;

}`};import{ShaderMaterial as Pa,UniformsUtils as Yl}from"three";import{BufferGeometry as jl,Float32BufferAttribute as Ta,OrthographicCamera as Kl,Mesh as zl}from"three";var be=class{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}},Wl=new Kl(-1,1,1,-1,0,1),ws=class extends jl{constructor(){super(),this.setAttribute("position",new Ta([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Ta([0,2,0,0,2,0],2))}},ql=new ws,Je=class{constructor(e){this._mesh=new zl(ql,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,Wl)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}};var X=class extends be{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof Pa?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=Yl.clone(e.uniforms),this.material=new Pa({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Je(this.material)}render(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}};var Qt=class extends be{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,i){let s=e.getContext(),r=e.state;r.buffers.color.setMask(!1),r.buffers.depth.setMask(!1),r.buffers.color.setLocked(!0),r.buffers.depth.setLocked(!0);let a,o;this.inverse?(a=0,o=1):(a=1,o=0),r.buffers.stencil.setTest(!0),r.buffers.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),r.buffers.stencil.setFunc(s.ALWAYS,a,4294967295),r.buffers.stencil.setClear(o),r.buffers.stencil.setLocked(!0),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),r.buffers.color.setLocked(!1),r.buffers.depth.setLocked(!1),r.buffers.color.setMask(!0),r.buffers.depth.setMask(!0),r.buffers.stencil.setLocked(!1),r.buffers.stencil.setFunc(s.EQUAL,1,4294967295),r.buffers.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),r.buffers.stencil.setLocked(!0)}},li=class extends be{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}};var De=class{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){let i=e.getSize(new Ma);this._width=i.width,this._height=i.height,t=new $l(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Jl}),t.texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new X(Fe),this.copyPass.material.blending=Zl,this.clock=new Xl}swapBuffers(){let e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){let t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());let t=this.renderer.getRenderTarget(),i=!1;for(let s=0,r=this.passes.length;s<r;s++){let a=this.passes[s];if(a.enabled!==!1){if(a.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(s),a.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),a.needsSwap){if(i){let o=this.renderer.getContext(),n=this.renderer.state.buffers.stencil;n.setFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),n.setFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}Qt!==void 0&&(a instanceof Qt?i=!0:a instanceof li&&(i=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){let t=this.renderer.getSize(new Ma);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;let i=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget1.setSize(i,s),this.renderTarget2.setSize(i,s);for(let r=0;r<this.passes.length;r++)this.passes[r].setSize(i,s)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}};import{Color as eh}from"three";var ht=class extends be{constructor(e,t,i=null,s=null,r=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=i,this.clearColor=s,this.clearAlpha=r,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new eh}render(e,t,i){let s=e.autoClear;e.autoClear=!1;let r,a;this.overrideMaterial!==null&&(a=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),this.clearAlpha!==null&&(r=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:i),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(r),this.overrideMaterial!==null&&(this.scene.overrideMaterial=a),e.autoClear=s}};import{AdditiveBlending as ih,Color as La,HalfFloatType as Ss,MeshBasicMaterial as sh,ShaderMaterial as ci,UniformsUtils as ka,Vector2 as Ze,Vector3 as _t,WebGLRenderTarget as Ds}from"three";import{Color as th}from"three";var hi={name:"LuminosityHighPassShader",shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new th(0)},defaultOpacity:{value:0}},vertexShader:`
varying vec2 vUv;

void main() {

	vUv = uv;

	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

}`,fragmentShader:`
uniform sampler2D tDiffuse;
uniform vec3 defaultColor;
uniform float defaultOpacity;
uniform float luminosityThreshold;
uniform float smoothWidth;

varying vec2 vUv;

void main() {

	vec4 texel = texture2D( tDiffuse, vUv );

	float v = luminance( texel.xyz );

	vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );

	float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );

	gl_FragColor = mix( outputColor, texel, alpha );

}`};var $e=class l extends be{constructor(e,t,i,s){super(),this.strength=t!==void 0?t:1,this.radius=i,this.threshold=s,this.resolution=e!==void 0?new Ze(e.x,e.y):new Ze(256,256),this.clearColor=new La(0,0,0),this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let r=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);this.renderTargetBright=new Ds(r,a,{type:Ss}),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let c=0;c<this.nMips;c++){let p=new Ds(r,a,{type:Ss});p.texture.name="UnrealBloomPass.h"+c,p.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(p);let d=new Ds(r,a,{type:Ss});d.texture.name="UnrealBloomPass.v"+c,d.texture.generateMipmaps=!1,this.renderTargetsVertical.push(d),r=Math.round(r/2),a=Math.round(a/2)}let o=hi;this.highPassUniforms=ka.clone(o.uniforms),this.highPassUniforms.luminosityThreshold.value=s,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new ci({uniforms:this.highPassUniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader}),this.separableBlurMaterials=[];let n=[3,5,7,9,11];r=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);for(let c=0;c<this.nMips;c++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(n[c])),this.separableBlurMaterials[c].uniforms.invSize.value=new Ze(1/r,1/a),r=Math.round(r/2),a=Math.round(a/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1;let h=[1,.8,.6,.4,.2];this.compositeMaterial.uniforms.bloomFactors.value=h,this.bloomTintColors=[new _t(1,1,1),new _t(1,1,1),new _t(1,1,1),new _t(1,1,1),new _t(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors;let u=Fe;this.copyUniforms=ka.clone(u.uniforms),this.blendMaterial=new ci({uniforms:this.copyUniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,blending:ih,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new La,this.oldClearAlpha=1,this.basic=new sh,this.fsQuad=new Je(null)}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose();for(let e=0;e<this.separableBlurMaterials.length;e++)this.separableBlurMaterials[e].dispose();this.compositeMaterial.dispose(),this.blendMaterial.dispose(),this.basic.dispose(),this.fsQuad.dispose()}setSize(e,t){let i=Math.round(e/2),s=Math.round(t/2);this.renderTargetBright.setSize(i,s);for(let r=0;r<this.nMips;r++)this.renderTargetsHorizontal[r].setSize(i,s),this.renderTargetsVertical[r].setSize(i,s),this.separableBlurMaterials[r].uniforms.invSize.value=new Ze(1/i,1/s),i=Math.round(i/2),s=Math.round(s/2)}render(e,t,i,s,r){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();let a=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),r&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=i.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=i.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);let o=this.renderTargetBright;for(let n=0;n<this.nMips;n++)this.fsQuad.material=this.separableBlurMaterials[n],this.separableBlurMaterials[n].uniforms.colorTexture.value=o.texture,this.separableBlurMaterials[n].uniforms.direction.value=l.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[n]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[n].uniforms.colorTexture.value=this.renderTargetsHorizontal[n].texture,this.separableBlurMaterials[n].uniforms.direction.value=l.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[n]),e.clear(),this.fsQuad.render(e),o=this.renderTargetsVertical[n];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.blendMaterial,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,r&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(i),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=a}getSeperableBlurMaterial(e){let t=[];for(let i=0;i<e;i++)t.push(.39894*Math.exp(-.5*i*i/(e*e))/e);return new ci({defines:{KERNEL_RADIUS:e},uniforms:{colorTexture:{value:null},invSize:{value:new Ze(.5,.5)},direction:{value:new Ze(.5,.5)},gaussianCoefficients:{value:t}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 invSize;
				uniform vec2 direction;
				uniform float gaussianCoefficients[KERNEL_RADIUS];

				void main() {
					float weightSum = gaussianCoefficients[0];
					vec3 diffuseSum = texture2D( colorTexture, vUv ).rgb * weightSum;
					for( int i = 1; i < KERNEL_RADIUS; i ++ ) {
						float x = float(i);
						float w = gaussianCoefficients[i];
						vec2 uvOffset = direction * invSize * x;
						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset ).rgb;
						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset ).rgb;
						diffuseSum += (sample1 + sample2) * w;
						weightSum += 2.0 * w;
					}
					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);
				}`})}getCompositeMaterial(e){return new ci({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;
				uniform sampler2D blurTexture1;
				uniform sampler2D blurTexture2;
				uniform sampler2D blurTexture3;
				uniform sampler2D blurTexture4;
				uniform sampler2D blurTexture5;
				uniform float bloomStrength;
				uniform float bloomRadius;
				uniform float bloomFactors[NUM_MIPS];
				uniform vec3 bloomTintColors[NUM_MIPS];

				float lerpBloomFactor(const in float factor) {
					float mirrorFactor = 1.2 - factor;
					return mix(factor, mirrorFactor, bloomRadius);
				}

				void main() {
					gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +
						lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +
						lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +
						lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +
						lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );
				}`})}};$e.BlurDirectionX=new Ze(1,0);$e.BlurDirectionY=new Ze(0,1);import{AmbientLight as Sh,AnimationClip as Dh,Bone as Ya,BufferGeometry as Ms,ClampToEdgeWrapping as Xa,Color as Ue,ColorManagement as tt,DirectionalLight as Rh,EquirectangularReflectionMapping as Th,Euler as ct,FileLoader as Ph,Float32BufferAttribute as gt,Group as Ja,Line as Mh,LineBasicMaterial as Lh,Loader as _s,LoaderUtils as kh,MathUtils as de,Matrix3 as Qh,Matrix4 as ie,Mesh as _h,MeshLambertMaterial as Fh,MeshPhongMaterial as Ls,NumberKeyframeTrack as Oh,Object3D as pi,PerspectiveCamera as Uh,PointLight as Za,PropertyBinding as di,Quaternion as et,QuaternionKeyframeTrack as $a,RepeatWrapping as eo,SRGBColorSpace as ye,ShapeUtils as Gh,Skeleton as Nh,SkinnedMesh as Vh,SpotLight as Hh,Texture as jh,TextureLoader as Kh,Uint16BufferAttribute as zh,Vector2 as Wh,Vector3 as Ge,Vector4 as qh,VectorKeyframeTrack as Yh}from"three";var Ie=Uint8Array,mt=Uint16Array,rh=Int32Array,Qa=new Ie([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),_a=new Ie([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ah=new Ie([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Fa=function(l,e){for(var t=new mt(31),i=0;i<31;++i)t[i]=e+=1<<l[i-1];for(var s=new rh(t[30]),i=1;i<30;++i)for(var r=t[i];r<t[i+1];++r)s[r]=r-t[i]<<5|i;return{b:t,r:s}},Oa=Fa(Qa,2),Ua=Oa.b,oh=Oa.r;Ua[28]=258,oh[258]=28;var Ga=Fa(_a,0),nh=Ga.b,Pd=Ga.r,Ps=new mt(32768);for(W=0;W<32768;++W)Oe=(W&43690)>>1|(W&21845)<<1,Oe=(Oe&52428)>>2|(Oe&13107)<<2,Oe=(Oe&61680)>>4|(Oe&3855)<<4,Ps[W]=((Oe&65280)>>8|(Oe&255)<<8)>>1;var Oe,W,Ft=function(l,e,t){for(var i=l.length,s=0,r=new mt(e);s<i;++s)l[s]&&++r[l[s]-1];var a=new mt(e);for(s=1;s<e;++s)a[s]=a[s-1]+r[s-1]<<1;var o;if(t){o=new mt(1<<e);var n=15-e;for(s=0;s<i;++s)if(l[s])for(var h=s<<4|l[s],u=e-l[s],c=a[l[s]-1]++<<u,p=c|(1<<u)-1;c<=p;++c)o[Ps[c]>>n]=h}else for(o=new mt(i),s=0;s<i;++s)l[s]&&(o[s]=Ps[a[l[s]-1]++]>>15-l[s]);return o},Ot=new Ie(288);for(W=0;W<144;++W)Ot[W]=8;var W;for(W=144;W<256;++W)Ot[W]=9;var W;for(W=256;W<280;++W)Ot[W]=7;var W;for(W=280;W<288;++W)Ot[W]=8;var W,Na=new Ie(32);for(W=0;W<32;++W)Na[W]=5;var W;var lh=Ft(Ot,9,1);var hh=Ft(Na,5,1),Rs=function(l){for(var e=l[0],t=1;t<l.length;++t)l[t]>e&&(e=l[t]);return e},Re=function(l,e,t){var i=e/8|0;return(l[i]|l[i+1]<<8)>>(e&7)&t},Ts=function(l,e){var t=e/8|0;return(l[t]|l[t+1]<<8|l[t+2]<<16)>>(e&7)},ch=function(l){return(l+7)/8|0},uh=function(l,e,t){return(e==null||e<0)&&(e=0),(t==null||t>l.length)&&(t=l.length),new Ie(l.subarray(e,t))};var ph=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Te=function(l,e,t){var i=new Error(e||ph[l]);if(i.code=l,Error.captureStackTrace&&Error.captureStackTrace(i,Te),!t)throw i;return i},Ah=function(l,e,t,i){var s=l.length,r=i?i.length:0;if(!s||e.f&&!e.l)return t||new Ie(0);var a=!t,o=a||e.i!=2,n=e.i;a&&(t=new Ie(s*3));var h=function(_e){var Lt=t.length;if(_e>Lt){var kt=new Ie(Math.max(Lt*2,_e));kt.set(t),t=kt}},u=e.f||0,c=e.p||0,p=e.b||0,d=e.l,g=e.d,m=e.m,A=e.n,f=s*8;do{if(!d){u=Re(l,c,1);var C=Re(l,c+1,3);if(c+=3,C)if(C==1)d=lh,g=hh,m=9,A=5;else if(C==2){var I=Re(l,c,31)+257,E=Re(l,c+10,15)+4,B=I+Re(l,c+5,31)+1;c+=14;for(var w=new Ie(B),D=new Ie(19),S=0;S<E;++S)D[ah[S]]=Re(l,c+S*3,7);c+=E*3;for(var P=Rs(D),F=(1<<P)-1,O=Ft(D,P,1),S=0;S<B;){var N=O[Re(l,c,F)];c+=N&15;var v=N>>4;if(v<16)w[S++]=v;else{var M=0,L=0;for(v==16?(L=3+Re(l,c,3),c+=2,M=w[S-1]):v==17?(L=3+Re(l,c,7),c+=3):v==18&&(L=11+Re(l,c,127),c+=7);L--;)w[S++]=M}}var H=w.subarray(0,I),k=w.subarray(I);m=Rs(H),A=Rs(k),d=Ft(H,m,1),g=Ft(k,A,1)}else Te(1);else{var v=ch(c)+4,x=l[v-4]|l[v-3]<<8,b=v+x;if(b>s){n&&Te(0);break}o&&h(p+x),t.set(l.subarray(v,b),p),e.b=p+=x,e.p=c=b*8,e.f=u;continue}if(c>f){n&&Te(0);break}}o&&h(p+131072);for(var Q=(1<<m)-1,K=(1<<A)-1,Y=c;;Y=c){var M=d[Ts(l,c)&Q],_=M>>4;if(c+=M&15,c>f){n&&Te(0);break}if(M||Te(2),_<256)t[p++]=_;else if(_==256){Y=c,d=null;break}else{var $=_-254;if(_>264){var S=_-257,ee=Qa[S];$=Re(l,c,(1<<ee)-1)+Ua[S],c+=ee}var Z=g[Ts(l,c)&K],he=Z>>4;Z||Te(3),c+=Z&15;var k=nh[he];if(he>3){var ee=_a[he];k+=Ts(l,c)&(1<<ee)-1,c+=ee}if(c>f){n&&Te(0);break}o&&h(p+131072);var xe=p+$;if(p<k){var Qe=r-k,Ce=Math.min(k,xe);for(Qe+p<0&&Te(3);p<Ce;++p)t[p]=i[Qe+p]}for(;p<xe;++p)t[p]=t[p-k]}}e.l=d,e.p=Y,e.b=p,e.f=u,d&&(u=1,e.m=m,e.d=g,e.n=A)}while(!u);return p!=t.length&&a?uh(t,0,p):t.subarray(0,p)};var dh=new Ie(0);var fh=function(l,e){return((l[0]&15)!=8||l[0]>>4>7||(l[0]<<8|l[1])%31)&&Te(6,"invalid zlib data"),(l[1]>>5&1)==+!e&&Te(6,"invalid zlib data: "+(l[1]&32?"need":"unexpected")+" dictionary"),(l[1]>>3&4)+2};function Va(l,e){return Ah(l.subarray(fh(l,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}var mh=typeof TextDecoder!="undefined"&&new TextDecoder,gh=0;try{mh.decode(dh,{stream:!0}),gh=1}catch(l){}import{Curve as wh,Vector3 as Wa,Vector4 as qa}from"three";import{Vector3 as xh,Vector4 as Ha}from"three";function ja(l,e,t){let i=t.length-l-1;if(e>=t[i])return i-1;if(e<=t[l])return l;let s=l,r=i,a=Math.floor((s+r)/2);for(;e<t[a]||e>=t[a+1];)e<t[a]?r=a:s=a,a=Math.floor((s+r)/2);return a}function Ch(l,e,t,i){let s=[],r=[],a=[];s[0]=1;for(let o=1;o<=t;++o){r[o]=e-i[l+1-o],a[o]=i[l+o]-e;let n=0;for(let h=0;h<o;++h){let u=a[h+1],c=r[o-h],p=s[h]/(u+c);s[h]=n+u*p,n=c*p}s[o]=n}return s}function Ka(l,e,t,i){let s=ja(l,i,e),r=Ch(s,i,l,e),a=new Ha(0,0,0,0);for(let o=0;o<=l;++o){let n=t[s-l+o],h=r[o],u=n.w*h;a.x+=n.x*u,a.y+=n.y*u,a.z+=n.z*u,a.w+=n.w*h}return a}function bh(l,e,t,i,s){let r=[];for(let c=0;c<=t;++c)r[c]=0;let a=[];for(let c=0;c<=i;++c)a[c]=r.slice(0);let o=[];for(let c=0;c<=t;++c)o[c]=r.slice(0);o[0][0]=1;let n=r.slice(0),h=r.slice(0);for(let c=1;c<=t;++c){n[c]=e-s[l+1-c],h[c]=s[l+c]-e;let p=0;for(let d=0;d<c;++d){let g=h[d+1],m=n[c-d];o[c][d]=g+m;let A=o[d][c-1]/o[c][d];o[d][c]=p+g*A,p=m*A}o[c][c]=p}for(let c=0;c<=t;++c)a[0][c]=o[c][t];for(let c=0;c<=t;++c){let p=0,d=1,g=[];for(let m=0;m<=t;++m)g[m]=r.slice(0);g[0][0]=1;for(let m=1;m<=i;++m){let A=0,f=c-m,C=t-m;c>=m&&(g[d][0]=g[p][0]/o[C+1][f],A=g[d][0]*o[f][C]);let v=f>=-1?1:-f,x=c-1<=C?m-1:t-c;for(let I=v;I<=x;++I)g[d][I]=(g[p][I]-g[p][I-1])/o[C+1][f+I],A+=g[d][I]*o[f+I][C];c<=C&&(g[d][m]=-g[p][m-1]/o[C+1][c],A+=g[d][m]*o[c][C]),a[m][c]=A;let b=p;p=d,d=b}}let u=t;for(let c=1;c<=i;++c){for(let p=0;p<=t;++p)a[c][p]*=u;u*=t-c}return a}function yh(l,e,t,i,s){let r=s<l?s:l,a=[],o=ja(l,i,e),n=bh(o,i,l,r,e),h=[];for(let u=0;u<t.length;++u){let c=t[u].clone(),p=c.w;c.x*=p,c.y*=p,c.z*=p,h[u]=c}for(let u=0;u<=r;++u){let c=h[o-l].clone().multiplyScalar(n[u][0]);for(let p=1;p<=l;++p)c.add(h[o-l+p].clone().multiplyScalar(n[u][p]));a[u]=c}for(let u=r+1;u<=s+1;++u)a[u]=new Ha(0,0,0);return a}function Eh(l,e){let t=1;for(let s=2;s<=l;++s)t*=s;let i=1;for(let s=2;s<=e;++s)i*=s;for(let s=2;s<=l-e;++s)i*=s;return t/i}function Ih(l){let e=l.length,t=[],i=[];for(let r=0;r<e;++r){let a=l[r];t[r]=new xh(a.x,a.y,a.z),i[r]=a.w}let s=[];for(let r=0;r<e;++r){let a=t[r].clone();for(let o=1;o<=r;++o)a.sub(s[r-o].clone().multiplyScalar(Eh(r,o)*i[o]));s[r]=a.divideScalar(i[0])}return s}function za(l,e,t,i,s){let r=yh(l,e,t,i,s);return Ih(r)}var ui=class extends wh{constructor(e,t,i,s,r){super();let a=t?t.length-1:0,o=i?i.length:0;this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=s||0,this.endKnot=r||a;for(let n=0;n<o;++n){let h=i[n];this.controlPoints[n]=new qa(h.x,h.y,h.z,h.w)}}getPoint(e,t=new Wa){let i=t,s=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=Ka(this.degree,this.knots,this.controlPoints,s);return r.w!==1&&r.divideScalar(r.w),i.set(r.x,r.y,r.z)}getTangent(e,t=new Wa){let i=t,s=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),r=za(this.degree,this.knots,this.controlPoints,s,1);return i.copy(r[1]).normalize(),i}toJSON(){let e=super.toJSON();return e.degree=this.degree,e.knots=[...this.knots],e.controlPoints=this.controlPoints.map(t=>t.toArray()),e.startKnot=this.startKnot,e.endKnot=this.endKnot,e}fromJSON(e){return super.fromJSON(e),this.degree=e.degree,this.knots=[...e.knots],this.controlPoints=e.controlPoints.map(t=>new qa(t[0],t[1],t[2],t[3])),this.startKnot=e.startKnot,this.endKnot=e.endKnot,this}};var U,se,Ae,fi=class extends _s{constructor(e){super(e)}load(e,t,i,s){let r=this,a=r.path===""?kh.extractUrlBase(e):r.path,o=new Ph(this.manager);o.setPath(r.path),o.setResponseType("arraybuffer"),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,function(n){try{t(r.parse(n,a))}catch(h){s?s(h):console.error(h),r.manager.itemError(e)}},i,s)}parse(e,t){if(Xh(e))U=new Ns().parse(e);else{let s=so(e);if(!Jh(s))throw new Error("THREE.FBXLoader: Unknown format.");if(to(s)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+to(s));U=new Gs().parse(s)}let i=new Kh(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new Fs(i,this.manager).parse(U)}},Fs=class{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){se=this.parseConnections();let e=this.parseImages(),t=this.parseTextures(e),i=this.parseMaterials(t),s=this.parseDeformers(),r=new Os().parse(s);return this.parseScene(s,r,i),Ae}parseConnections(){let e=new Map;return"Connections"in U&&U.Connections.connections.forEach(function(i){let s=i[0],r=i[1],a=i[2];e.has(s)||e.set(s,{parents:[],children:[]});let o={ID:r,relationship:a};e.get(s).parents.push(o),e.has(r)||e.set(r,{parents:[],children:[]});let n={ID:s,relationship:a};e.get(r).children.push(n)}),e}parseImages(){let e={},t={};if("Video"in U.Objects){let i=U.Objects.Video;for(let s in i){let r=i[s],a=parseInt(s);if(e[a]=r.RelativeFilename||r.Filename,"Content"in r){let o=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,n=typeof r.Content=="string"&&r.Content!=="";if(o||n){let h=this.parseImage(i[s]);t[r.RelativeFilename||r.Filename]=h}}}}for(let i in e){let s=e[i];t[s]!==void 0?e[i]=t[s]:e[i]=e[i].split("\\").pop()}return e}parseImage(e){let t=e.Content,i=e.RelativeFilename||e.Filename,s=i.slice(i.lastIndexOf(".")+1).toLowerCase(),r;switch(s){case"bmp":r="image/bmp";break;case"jpg":case"jpeg":r="image/jpeg";break;case"png":r="image/png";break;case"tif":r="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",i),r="image/tga";break;default:console.warn('FBXLoader: Image type "'+s+'" is not supported.');return}if(typeof t=="string")return"data:"+r+";base64,"+t;{let a=new Uint8Array(t);return window.URL.createObjectURL(new Blob([a],{type:r}))}}parseTextures(e){let t=new Map;if("Texture"in U.Objects){let i=U.Objects.Texture;for(let s in i){let r=this.parseTexture(i[s],e);t.set(parseInt(s),r)}}return t}parseTexture(e,t){let i=this.loadTexture(e,t);i.ID=e.id,i.name=e.attrName;let s=e.WrapModeU,r=e.WrapModeV,a=s!==void 0?s.value:0,o=r!==void 0?r.value:0;if(i.wrapS=a===0?eo:Xa,i.wrapT=o===0?eo:Xa,"Scaling"in e){let n=e.Scaling.value;i.repeat.x=n[0],i.repeat.y=n[1]}if("Translation"in e){let n=e.Translation.value;i.offset.x=n[0],i.offset.y=n[1]}return i}loadTexture(e,t){let i=new Set(["tga","tif","tiff","exr","dds","hdr","ktx2"]),s=e.FileName.split(".").pop().toLowerCase(),r=i.has(s)?this.manager.getHandler(`.${s}`):this.textureLoader;if(!r)return console.warn(`FBXLoader: ${s.toUpperCase()} loader not found, creating placeholder texture for`,e.RelativeFilename),new jh;let a=r.path;a||r.setPath(this.textureLoader.path);let o=se.get(e.id).children,n;o!==void 0&&o.length>0&&t[o[0].ID]!==void 0&&(n=t[o[0].ID],(n.indexOf("blob:")===0||n.indexOf("data:")===0)&&r.setPath(void 0));let h=r.load(n);return r.setPath(a),h}parseMaterials(e){let t=new Map;if("Material"in U.Objects){let i=U.Objects.Material;for(let s in i){let r=this.parseMaterial(i[s],e);r!==null&&t.set(parseInt(s),r)}}return t}parseMaterial(e,t){let i=e.id,s=e.attrName,r=e.ShadingModel;if(typeof r=="object"&&(r=r.value),!se.has(i))return null;let a=this.parseParameters(e,t,i),o;switch(r.toLowerCase()){case"phong":o=new Ls;break;case"lambert":o=new Fh;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',r),o=new Ls;break}return o.setValues(a),o.name=s,o}parseParameters(e,t,i){let s={};e.BumpFactor&&(s.bumpScale=e.BumpFactor.value),e.Diffuse?s.color=tt.toWorkingColorSpace(new Ue().fromArray(e.Diffuse.value),ye):e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(s.color=tt.toWorkingColorSpace(new Ue().fromArray(e.DiffuseColor.value),ye)),e.DisplacementFactor&&(s.displacementScale=e.DisplacementFactor.value),e.Emissive?s.emissive=tt.toWorkingColorSpace(new Ue().fromArray(e.Emissive.value),ye):e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(s.emissive=tt.toWorkingColorSpace(new Ue().fromArray(e.EmissiveColor.value),ye)),e.EmissiveFactor&&(s.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),s.opacity=1-(e.TransparencyFactor?parseFloat(e.TransparencyFactor.value):0),(s.opacity===1||s.opacity===0)&&(s.opacity=e.Opacity?parseFloat(e.Opacity.value):null,s.opacity===null&&(s.opacity=1-(e.TransparentColor?parseFloat(e.TransparentColor.value[0]):0))),s.opacity<1&&(s.transparent=!0),e.ReflectionFactor&&(s.reflectivity=e.ReflectionFactor.value),e.Shininess&&(s.shininess=e.Shininess.value),e.Specular?s.specular=tt.toWorkingColorSpace(new Ue().fromArray(e.Specular.value),ye):e.SpecularColor&&e.SpecularColor.type==="Color"&&(s.specular=tt.toWorkingColorSpace(new Ue().fromArray(e.SpecularColor.value),ye));let r=this;return se.get(i).children.forEach(function(a){let o=a.relationship;switch(o){case"Bump":s.bumpMap=r.getTexture(t,a.ID);break;case"Maya|TEX_ao_map":s.aoMap=r.getTexture(t,a.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":s.map=r.getTexture(t,a.ID),s.map!==void 0&&(s.map.colorSpace=ye);break;case"DisplacementColor":s.displacementMap=r.getTexture(t,a.ID);break;case"EmissiveColor":s.emissiveMap=r.getTexture(t,a.ID),s.emissiveMap!==void 0&&(s.emissiveMap.colorSpace=ye);break;case"NormalMap":case"Maya|TEX_normal_map":s.normalMap=r.getTexture(t,a.ID);break;case"ReflectionColor":s.envMap=r.getTexture(t,a.ID),s.envMap!==void 0&&(s.envMap.mapping=Th,s.envMap.colorSpace=ye);break;case"SpecularColor":s.specularMap=r.getTexture(t,a.ID),s.specularMap!==void 0&&(s.specularMap.colorSpace=ye);break;case"TransparentColor":case"TransparencyFactor":s.alphaMap=r.getTexture(t,a.ID),s.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",o);break}}),s}getTexture(e,t){return"LayeredTexture"in U.Objects&&t in U.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=se.get(t).children[0].ID),e.get(t)}parseDeformers(){let e={},t={};if("Deformer"in U.Objects){let i=U.Objects.Deformer;for(let s in i){let r=i[s],a=se.get(parseInt(s));if(r.attrType==="Skin"){let o=this.parseSkeleton(a,i);o.ID=s,a.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),o.geometryID=a.parents[0].ID,e[s]=o}else if(r.attrType==="BlendShape"){let o={id:s};o.rawTargets=this.parseMorphTargets(a,i),o.id=s,a.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[s]=o}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){let i=[];return e.children.forEach(function(s){let r=t[s.ID];if(r.attrType!=="Cluster")return;let a={ID:s.ID,indices:[],weights:[],transformLink:new ie().fromArray(r.TransformLink.a)};"Indexes"in r&&(a.indices=r.Indexes.a,a.weights=r.Weights.a),i.push(a)}),{rawBones:i,bones:[]}}parseMorphTargets(e,t){let i=[];for(let s=0;s<e.children.length;s++){let r=e.children[s],a=t[r.ID],o={name:a.attrName,initialWeight:a.DeformPercent,id:a.id,fullWeights:a.FullWeights.a};if(a.attrType!=="BlendShapeChannel")return;o.geoID=se.get(parseInt(r.ID)).children.filter(function(n){return n.relationship===void 0})[0].ID,i.push(o)}return i}parseScene(e,t,i){Ae=new Ja;let s=this.parseModels(e.skeletons,t,i),r=U.Objects.Model,a=this;s.forEach(function(n){let h=r[n.ID];a.setLookAtProperties(n,h),se.get(n.ID).parents.forEach(function(c){let p=s.get(c.ID);p!==void 0&&p.add(n)}),n.parent===null&&Ae.add(n)}),this.bindSkeleton(e.skeletons,t,s),this.addGlobalSceneSettings(),Ae.traverse(function(n){if(n.userData.transformData){n.parent&&(n.userData.transformData.parentMatrix=n.parent.matrix,n.userData.transformData.parentMatrixWorld=n.parent.matrixWorld);let h=io(n.userData.transformData);n.applyMatrix4(h),n.updateWorldMatrix()}});let o=new Us().parse();Ae.children.length===1&&Ae.children[0].isGroup&&(Ae.children[0].animations=o,Ae=Ae.children[0]),Ae.animations=o}parseModels(e,t,i){let s=new Map,r=U.Objects.Model;for(let a in r){let o=parseInt(a),n=r[a],h=se.get(o),u=this.buildSkeleton(h,e,o,n.attrName);if(!u){switch(n.attrType){case"Camera":u=this.createCamera(h);break;case"Light":u=this.createLight(h);break;case"Mesh":u=this.createMesh(h,t,i);break;case"NurbsCurve":u=this.createCurve(h,t);break;case"LimbNode":case"Root":u=new Ya;break;case"Null":default:u=new Ja;break}u.name=n.attrName?di.sanitizeNodeName(n.attrName):"",u.userData.originalName=n.attrName,u.ID=o}this.getTransformData(u,n),s.set(o,u)}return s}buildSkeleton(e,t,i,s){let r=null;return e.parents.forEach(function(a){for(let o in t){let n=t[o];n.rawBones.forEach(function(h,u){if(h.ID===a.ID){let c=r;r=new Ya,r.matrixWorld.copy(h.transformLink),r.name=s?di.sanitizeNodeName(s):"",r.userData.originalName=s,r.ID=i,n.bones[u]=r,c!==null&&r.add(c)}})}}),r}createCamera(e){let t,i;if(e.children.forEach(function(s){let r=U.Objects.NodeAttribute[s.ID];r!==void 0&&(i=r)}),i===void 0)t=new pi;else{let s=0;i.CameraProjectionType!==void 0&&i.CameraProjectionType.value===1&&(s=1);let r=1;i.NearPlane!==void 0&&(r=i.NearPlane.value/1e3);let a=1e3;i.FarPlane!==void 0&&(a=i.FarPlane.value/1e3);let o=window.innerWidth,n=window.innerHeight;i.AspectWidth!==void 0&&i.AspectHeight!==void 0&&(o=i.AspectWidth.value,n=i.AspectHeight.value);let h=o/n,u=45;i.FieldOfView!==void 0&&(u=i.FieldOfView.value);let c=i.FocalLength?i.FocalLength.value:null;switch(s){case 0:t=new Uh(u,h,r,a),c!==null&&t.setFocalLength(c);break;case 1:console.warn("THREE.FBXLoader: Orthographic cameras not supported yet."),t=new pi;break;default:console.warn("THREE.FBXLoader: Unknown camera type "+s+"."),t=new pi;break}}return t}createLight(e){let t,i;if(e.children.forEach(function(s){let r=U.Objects.NodeAttribute[s.ID];r!==void 0&&(i=r)}),i===void 0)t=new pi;else{let s;i.LightType===void 0?s=0:s=i.LightType.value;let r=16777215;i.Color!==void 0&&(r=tt.toWorkingColorSpace(new Ue().fromArray(i.Color.value),ye));let a=i.Intensity===void 0?1:i.Intensity.value/100;i.CastLightOnObject!==void 0&&i.CastLightOnObject.value===0&&(a=0);let o=0;i.FarAttenuationEnd!==void 0&&(i.EnableFarAttenuation!==void 0&&i.EnableFarAttenuation.value===0?o=0:o=i.FarAttenuationEnd.value);let n=1;switch(s){case 0:t=new Za(r,a,o,n);break;case 1:t=new Rh(r,a);break;case 2:let h=Math.PI/3;i.InnerAngle!==void 0&&(h=de.degToRad(i.InnerAngle.value));let u=0;i.OuterAngle!==void 0&&(u=de.degToRad(i.OuterAngle.value),u=Math.max(u,1)),t=new Hh(r,a,o,h,u,n);break;default:console.warn("THREE.FBXLoader: Unknown light type "+i.LightType.value+", defaulting to a PointLight."),t=new Za(r,a);break}i.CastShadows!==void 0&&i.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,i){let s,r=null,a=null,o=[];return e.children.forEach(function(n){t.has(n.ID)&&(r=t.get(n.ID)),i.has(n.ID)&&o.push(i.get(n.ID))}),o.length>1?a=o:o.length>0?a=o[0]:(a=new Ls({name:_s.DEFAULT_MATERIAL_NAME,color:13421772}),o.push(a)),"color"in r.attributes&&o.forEach(function(n){n.vertexColors=!0}),r.FBX_Deformer?(s=new Vh(r,a),s.normalizeSkinWeights()):s=new _h(r,a),s}createCurve(e,t){let i=e.children.reduce(function(r,a){return t.has(a.ID)&&(r=t.get(a.ID)),r},null),s=new Lh({name:_s.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new Mh(i,s)}getTransformData(e,t){let i={};"InheritType"in t&&(i.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?i.eulerOrder=Ut(t.RotationOrder.value):i.eulerOrder=Ut(0),"Lcl_Translation"in t&&(i.translation=t.Lcl_Translation.value),"PreRotation"in t&&(i.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(i.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(i.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(i.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(i.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(i.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(i.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(i.rotationPivot=t.RotationPivot.value),e.userData.transformData=i}setLookAtProperties(e,t){"LookAtProperty"in t&&se.get(e.ID).children.forEach(function(s){if(s.relationship==="LookAtProperty"){let r=U.Objects.Model[s.ID];if("Lcl_Translation"in r){let a=r.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(a),Ae.add(e.target)):e.lookAt(new Ge().fromArray(a))}}})}bindSkeleton(e,t,i){let s=this.parsePoseNodes();for(let r in e){let a=e[r];se.get(parseInt(a.ID)).parents.forEach(function(n){if(t.has(n.ID)){let h=n.ID;se.get(h).parents.forEach(function(c){i.has(c.ID)&&i.get(c.ID).bind(new Nh(a.bones),s[c.ID])})}})}}parsePoseNodes(){let e={};if("Pose"in U.Objects){let t=U.Objects.Pose;for(let i in t)if(t[i].attrType==="BindPose"&&t[i].NbPoseNodes>0){let s=t[i].PoseNode;Array.isArray(s)?s.forEach(function(r){e[r.Node]=new ie().fromArray(r.Matrix.a)}):e[s.Node]=new ie().fromArray(s.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in U){if("AmbientColor"in U.GlobalSettings){let e=U.GlobalSettings.AmbientColor.value,t=e[0],i=e[1],s=e[2];if(t!==0||i!==0||s!==0){let r=new Ue().setRGB(t,i,s,ye);Ae.add(new Sh(r,1))}}"UnitScaleFactor"in U.GlobalSettings&&(Ae.userData.unitScaleFactor=U.GlobalSettings.UnitScaleFactor.value)}}},Os=class{constructor(){this.negativeMaterialIndices=!1}parse(e){let t=new Map;if("Geometry"in U.Objects){let i=U.Objects.Geometry;for(let s in i){let r=se.get(parseInt(s)),a=this.parseGeometry(r,i[s],e);t.set(parseInt(s),a)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,i){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,i);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,i){let s=i.skeletons,r=[],a=e.parents.map(function(c){return U.Objects.Model[c.ID]});if(a.length===0)return;let o=e.children.reduce(function(c,p){return s[p.ID]!==void 0&&(c=s[p.ID]),c},null);e.children.forEach(function(c){i.morphTargets[c.ID]!==void 0&&r.push(i.morphTargets[c.ID])});let n=a[0],h={};"RotationOrder"in n&&(h.eulerOrder=Ut(n.RotationOrder.value)),"InheritType"in n&&(h.inheritType=parseInt(n.InheritType.value)),"GeometricTranslation"in n&&(h.translation=n.GeometricTranslation.value),"GeometricRotation"in n&&(h.rotation=n.GeometricRotation.value),"GeometricScaling"in n&&(h.scale=n.GeometricScaling.value);let u=io(h);return this.genGeometry(t,o,r,u)}genGeometry(e,t,i,s){let r=new Ms;e.attrName&&(r.name=e.attrName);let a=this.parseGeoNode(e,t),o=this.genBuffers(a),n=new gt(o.vertex,3);if(n.applyMatrix4(s),r.setAttribute("position",n),o.colors.length>0&&r.setAttribute("color",new gt(o.colors,3)),t&&(r.setAttribute("skinIndex",new zh(o.weightsIndices,4)),r.setAttribute("skinWeight",new gt(o.vertexWeights,4)),r.FBX_Deformer=t),o.normal.length>0){let h=new Qh().getNormalMatrix(s),u=new gt(o.normal,3);u.applyNormalMatrix(h),r.setAttribute("normal",u)}if(o.uvs.forEach(function(h,u){let c=u===0?"uv":`uv${u}`;r.setAttribute(c,new gt(o.uvs[u],2))}),a.material&&a.material.mappingType!=="AllSame"){let h=o.materialIndex[0],u=0;if(o.materialIndex.forEach(function(c,p){c!==h&&(r.addGroup(u,p-u,h),h=c,u=p)}),r.groups.length>0){let c=r.groups[r.groups.length-1],p=c.start+c.count;p!==o.materialIndex.length&&r.addGroup(p,o.materialIndex.length-p,h)}r.groups.length===0&&r.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(r,e,i,s),r}parseGeoNode(e,t){let i={};if(i.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],i.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(i.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(i.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(i.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){i.uv=[];let s=0;for(;e.LayerElementUV[s];)e.LayerElementUV[s].UV&&i.uv.push(this.parseUVs(e.LayerElementUV[s])),s++}return i.weightTable={},t!==null&&(i.skeleton=t,t.rawBones.forEach(function(s,r){s.indices.forEach(function(a,o){i.weightTable[a]===void 0&&(i.weightTable[a]=[]),i.weightTable[a].push({id:r,weight:s.weights[o]})})})),i}genBuffers(e){let t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},i=0,s=0,r=!1,a=[],o=[],n=[],h=[],u=[],c=[],p=this;return e.vertexIndices.forEach(function(d,g){let m,A=!1;d<0&&(d=d^-1,A=!0);let f=[],C=[];if(a.push(d*3,d*3+1,d*3+2),e.color){let v=Ai(g,i,d,e.color);n.push(v[0],v[1],v[2])}if(e.skeleton){if(e.weightTable[d]!==void 0&&e.weightTable[d].forEach(function(v){C.push(v.weight),f.push(v.id)}),C.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);let v=[0,0,0,0],x=[0,0,0,0];C.forEach(function(b,I){let E=b,B=f[I];x.forEach(function(w,D,S){if(E>w){S[D]=E,E=w;let P=v[D];v[D]=B,B=P}})}),f=v,C=x}for(;C.length<4;)C.push(0),f.push(0);for(let v=0;v<4;++v)u.push(C[v]),c.push(f[v])}if(e.normal){let v=Ai(g,i,d,e.normal);o.push(v[0],v[1],v[2])}e.material&&e.material.mappingType!=="AllSame"&&(m=Ai(g,i,d,e.material)[0],m<0&&(p.negativeMaterialIndices=!0,m=0)),e.uv&&e.uv.forEach(function(v,x){let b=Ai(g,i,d,v);h[x]===void 0&&(h[x]=[]),h[x].push(b[0]),h[x].push(b[1])}),s++,A&&(p.genFace(t,e,a,m,o,n,h,u,c,s),i++,s=0,a=[],o=[],n=[],h=[],u=[],c=[])}),t}getNormalNewell(e){let t=new Ge(0,0,0);for(let i=0;i<e.length;i++){let s=e[i],r=e[(i+1)%e.length];t.x+=(s.y-r.y)*(s.z+r.z),t.y+=(s.z-r.z)*(s.x+r.x),t.z+=(s.x-r.x)*(s.y+r.y)}return t.normalize(),t}getNormalTangentAndBitangent(e){let t=this.getNormalNewell(e),s=(Math.abs(t.z)>.5?new Ge(0,1,0):new Ge(0,0,1)).cross(t).normalize(),r=t.clone().cross(s).normalize();return{normal:t,tangent:s,bitangent:r}}flattenVertex(e,t,i){return new Wh(e.dot(t),e.dot(i))}genFace(e,t,i,s,r,a,o,n,h,u){let c;if(u>3){let p=[],d=t.baseVertexPositions||t.vertexPositions;for(let f=0;f<i.length;f+=3)p.push(new Ge(d[i[f]],d[i[f+1]],d[i[f+2]]));let{tangent:g,bitangent:m}=this.getNormalTangentAndBitangent(p),A=[];for(let f of p)A.push(this.flattenVertex(f,g,m));c=Gh.triangulateShape(A,[])}else c=[[0,1,2]];for(let[p,d,g]of c)e.vertex.push(t.vertexPositions[i[p*3]]),e.vertex.push(t.vertexPositions[i[p*3+1]]),e.vertex.push(t.vertexPositions[i[p*3+2]]),e.vertex.push(t.vertexPositions[i[d*3]]),e.vertex.push(t.vertexPositions[i[d*3+1]]),e.vertex.push(t.vertexPositions[i[d*3+2]]),e.vertex.push(t.vertexPositions[i[g*3]]),e.vertex.push(t.vertexPositions[i[g*3+1]]),e.vertex.push(t.vertexPositions[i[g*3+2]]),t.skeleton&&(e.vertexWeights.push(n[p*4]),e.vertexWeights.push(n[p*4+1]),e.vertexWeights.push(n[p*4+2]),e.vertexWeights.push(n[p*4+3]),e.vertexWeights.push(n[d*4]),e.vertexWeights.push(n[d*4+1]),e.vertexWeights.push(n[d*4+2]),e.vertexWeights.push(n[d*4+3]),e.vertexWeights.push(n[g*4]),e.vertexWeights.push(n[g*4+1]),e.vertexWeights.push(n[g*4+2]),e.vertexWeights.push(n[g*4+3]),e.weightsIndices.push(h[p*4]),e.weightsIndices.push(h[p*4+1]),e.weightsIndices.push(h[p*4+2]),e.weightsIndices.push(h[p*4+3]),e.weightsIndices.push(h[d*4]),e.weightsIndices.push(h[d*4+1]),e.weightsIndices.push(h[d*4+2]),e.weightsIndices.push(h[d*4+3]),e.weightsIndices.push(h[g*4]),e.weightsIndices.push(h[g*4+1]),e.weightsIndices.push(h[g*4+2]),e.weightsIndices.push(h[g*4+3])),t.color&&(e.colors.push(a[p*3]),e.colors.push(a[p*3+1]),e.colors.push(a[p*3+2]),e.colors.push(a[d*3]),e.colors.push(a[d*3+1]),e.colors.push(a[d*3+2]),e.colors.push(a[g*3]),e.colors.push(a[g*3+1]),e.colors.push(a[g*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(s),e.materialIndex.push(s),e.materialIndex.push(s)),t.normal&&(e.normal.push(r[p*3]),e.normal.push(r[p*3+1]),e.normal.push(r[p*3+2]),e.normal.push(r[d*3]),e.normal.push(r[d*3+1]),e.normal.push(r[d*3+2]),e.normal.push(r[g*3]),e.normal.push(r[g*3+1]),e.normal.push(r[g*3+2])),t.uv&&t.uv.forEach(function(m,A){e.uvs[A]===void 0&&(e.uvs[A]=[]),e.uvs[A].push(o[A][p*2]),e.uvs[A].push(o[A][p*2+1]),e.uvs[A].push(o[A][d*2]),e.uvs[A].push(o[A][d*2+1]),e.uvs[A].push(o[A][g*2]),e.uvs[A].push(o[A][g*2+1])})}addMorphTargets(e,t,i,s){if(i.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];let r=this;i.forEach(function(a){a.rawTargets.forEach(function(o){let n=U.Objects.Geometry[o.geoID];n!==void 0&&r.genMorphGeometry(e,t,n,s,o.name)})})}genMorphGeometry(e,t,i,s,r){let a=t.Vertices!==void 0?t.Vertices.a:[],o=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],n=i.Vertices!==void 0?i.Vertices.a:[],h=i.Indexes!==void 0?i.Indexes.a:[],u=e.attributes.position.count*3,c=new Float32Array(u);for(let m=0;m<h.length;m++){let A=h[m]*3;c[A]=n[m*3],c[A+1]=n[m*3+1],c[A+2]=n[m*3+2]}let p={vertexIndices:o,vertexPositions:c,baseVertexPositions:a},d=this.genBuffers(p),g=new gt(d.vertex,3);g.name=r||i.attrName,g.applyMatrix4(s),e.morphAttributes.position.push(g)}parseNormals(e){let t=e.MappingInformationType,i=e.ReferenceInformationType,s=e.Normals.a,r=[];return i==="IndexToDirect"&&("NormalIndex"in e?r=e.NormalIndex.a:"NormalsIndex"in e&&(r=e.NormalsIndex.a)),{dataSize:3,buffer:s,indices:r,mappingType:t,referenceType:i}}parseUVs(e){let t=e.MappingInformationType,i=e.ReferenceInformationType,s=e.UV.a,r=[];return i==="IndexToDirect"&&(r=e.UVIndex.a),{dataSize:2,buffer:s,indices:r,mappingType:t,referenceType:i}}parseVertexColors(e){let t=e.MappingInformationType,i=e.ReferenceInformationType,s=e.Colors.a,r=[];i==="IndexToDirect"&&(r=e.ColorIndex.a);for(let a=0,o=new Ue;a<s.length;a+=4)o.fromArray(s,a),tt.toWorkingColorSpace(o,ye),o.toArray(s,a);return{dataSize:4,buffer:s,indices:r,mappingType:t,referenceType:i}}parseMaterialIndices(e){let t=e.MappingInformationType,i=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i};let s=e.Materials.a,r=[];for(let a=0;a<s.length;++a)r.push(a);return{dataSize:1,buffer:s,indices:r,mappingType:t,referenceType:i}}parseNurbsGeometry(e){let t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new Ms;let i=t-1,s=e.KnotVector.a,r=[],a=e.Points.a;for(let c=0,p=a.length;c<p;c+=4)r.push(new qh().fromArray(a,c));let o,n;if(e.Form==="Closed")r.push(r[0]);else if(e.Form==="Periodic"){o=i,n=s.length-1-o;for(let c=0;c<i;++c)r.push(r[c])}let u=new ui(i,s,r,o,n).getPoints(r.length*12);return new Ms().setFromPoints(u)}},Us=class{parse(){let e=[],t=this.parseClips();if(t!==void 0)for(let i in t){let s=t[i],r=this.addClip(s);e.push(r)}return e}parseClips(){if(U.Objects.AnimationCurve===void 0)return;let e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);let t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){let e=U.Objects.AnimationCurveNode,t=new Map;for(let i in e){let s=e[i];if(s.attrName.match(/S|R|T|DeformPercent/)!==null){let r={id:s.id,attr:s.attrName,curves:{}};t.set(r.id,r)}}return t}parseAnimationCurves(e){let t=U.Objects.AnimationCurve;for(let i in t){let s={id:t[i].id,times:t[i].KeyTime.a.map(Zh),values:t[i].KeyValueFloat.a},r=se.get(s.id);if(r!==void 0){let a=r.parents[0].ID,o=r.parents[0].relationship;o.match(/X/)?e.get(a).curves.x=s:o.match(/Y/)?e.get(a).curves.y=s:o.match(/Z/)?e.get(a).curves.z=s:o.match(/DeformPercent/)&&e.has(a)&&(e.get(a).curves.morph=s)}}}parseAnimationLayers(e){let t=U.Objects.AnimationLayer,i=new Map;for(let s in t){let r=[],a=se.get(parseInt(s));a!==void 0&&(a.children.forEach(function(n,h){if(e.has(n.ID)){let u=e.get(n.ID);if(u.curves.x!==void 0||u.curves.y!==void 0||u.curves.z!==void 0){if(r[h]===void 0){let c=se.get(n.ID).parents.filter(function(p){return p.relationship!==void 0})[0].ID;if(c!==void 0){let p=U.Objects.Model[c.toString()];if(p===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",n);return}let d={modelName:p.attrName?di.sanitizeNodeName(p.attrName):"",ID:p.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Ae.traverse(function(g){g.ID===p.id&&(d.transform=g.matrix,g.userData.transformData&&(d.eulerOrder=g.userData.transformData.eulerOrder))}),d.transform||(d.transform=new ie),"PreRotation"in p&&(d.preRotation=p.PreRotation.value),"PostRotation"in p&&(d.postRotation=p.PostRotation.value),r[h]=d}}r[h]&&(r[h][u.attr]=u)}else if(u.curves.morph!==void 0){if(r[h]===void 0){let c=se.get(n.ID).parents.filter(function(f){return f.relationship!==void 0})[0].ID,p=se.get(c).parents[0].ID,d=se.get(p).parents[0].ID,g=se.get(d).parents[0].ID,m=U.Objects.Model[g],A={modelName:m.attrName?di.sanitizeNodeName(m.attrName):"",morphName:U.Objects.Deformer[c].attrName};r[h]=A}r[h][u.attr]=u}}}),i.set(parseInt(s),r))}return i}parseAnimStacks(e){let t=U.Objects.AnimationStack,i={};for(let s in t){let r=se.get(parseInt(s)).children;r.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");let a=e.get(r[0].ID);i[s]={name:t[s].attrName,layer:a}}return i}addClip(e){let t=[],i=this;return e.layer.forEach(function(s){t=t.concat(i.generateTracks(s))}),new Dh(e.name,-1,t)}generateTracks(e){let t=[],i=new Ge,s=new Ge;if(e.transform&&e.transform.decompose(i,new et,s),i=i.toArray(),s=s.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){let r=this.generateVectorTrack(e.modelName,e.T.curves,i,"position");r!==void 0&&t.push(r)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){let r=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);r!==void 0&&t.push(r)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){let r=this.generateVectorTrack(e.modelName,e.S.curves,s,"scale");r!==void 0&&t.push(r)}if(e.DeformPercent!==void 0){let r=this.generateMorphTrack(e);r!==void 0&&t.push(r)}return t}generateVectorTrack(e,t,i,s){let r=this.getTimesForAllAxes(t),a=this.getKeyframeTrackValues(r,t,i);return new Yh(e+"."+s,r,a)}generateRotationTrack(e,t,i,s,r){let a,o;if(t.x!==void 0&&t.y!==void 0&&t.z!==void 0){let p=this.interpolateRotations(t.x,t.y,t.z,r);a=p[0],o=p[1]}let n=Ut(0);i!==void 0&&(i=i.map(de.degToRad),i.push(n),i=new ct().fromArray(i),i=new et().setFromEuler(i)),s!==void 0&&(s=s.map(de.degToRad),s.push(n),s=new ct().fromArray(s),s=new et().setFromEuler(s).invert());let h=new et,u=new ct,c=[];if(!o||!a)return new $a(e+".quaternion",[0],[0]);for(let p=0;p<o.length;p+=3)u.set(o[p],o[p+1],o[p+2],r),h.setFromEuler(u),i!==void 0&&h.premultiply(i),s!==void 0&&h.multiply(s),p>2&&new et().fromArray(c,(p-3)/3*4).dot(h)<0&&h.set(-h.x,-h.y,-h.z,-h.w),h.toArray(c,p/3*4);return new $a(e+".quaternion",a,c)}generateMorphTrack(e){let t=e.DeformPercent.curves.morph,i=t.values.map(function(r){return r/100}),s=Ae.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new Oh(e.modelName+".morphTargetInfluences["+s+"]",t.times,i)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(i,s){return i-s}),t.length>1){let i=1,s=t[0];for(let r=1;r<t.length;r++){let a=t[r];a!==s&&(t[i]=a,s=a,i++)}t=t.slice(0,i)}return t}getKeyframeTrackValues(e,t,i){let s=i,r=[],a=-1,o=-1,n=-1;return e.forEach(function(h){if(t.x&&(a=t.x.times.indexOf(h)),t.y&&(o=t.y.times.indexOf(h)),t.z&&(n=t.z.times.indexOf(h)),a!==-1){let u=t.x.values[a];r.push(u),s[0]=u}else r.push(s[0]);if(o!==-1){let u=t.y.values[o];r.push(u),s[1]=u}else r.push(s[1]);if(n!==-1){let u=t.z.values[n];r.push(u),s[2]=u}else r.push(s[2])}),r}interpolateRotations(e,t,i,s){let r=[],a=[];r.push(e.times[0]),a.push(de.degToRad(e.values[0])),a.push(de.degToRad(t.values[0])),a.push(de.degToRad(i.values[0]));for(let o=1;o<e.values.length;o++){let n=[e.values[o-1],t.values[o-1],i.values[o-1]];if(isNaN(n[0])||isNaN(n[1])||isNaN(n[2]))continue;let h=n.map(de.degToRad),u=[e.values[o],t.values[o],i.values[o]];if(isNaN(u[0])||isNaN(u[1])||isNaN(u[2]))continue;let c=u.map(de.degToRad),p=[u[0]-n[0],u[1]-n[1],u[2]-n[2]],d=[Math.abs(p[0]),Math.abs(p[1]),Math.abs(p[2])];if(d[0]>=180||d[1]>=180||d[2]>=180){let m=Math.max(...d)/180,A=new ct(...h,s),f=new ct(...c,s),C=new et().setFromEuler(A),v=new et().setFromEuler(f);C.dot(v)&&v.set(-v.x,-v.y,-v.z,-v.w);let x=e.times[o-1],b=e.times[o]-x,I=new et,E=new ct;for(let B=0;B<1;B+=1/m)I.copy(C.clone().slerp(v.clone(),B)),r.push(x+B*b),E.setFromQuaternion(I,s),a.push(E.x),a.push(E.y),a.push(E.z)}else r.push(e.times[o]),a.push(de.degToRad(e.values[o])),a.push(de.degToRad(t.values[o])),a.push(de.degToRad(i.values[o]))}return[r,a]}},Gs=class{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new gi,this.nodeStack=[],this.currentProp=[],this.currentPropName="";let t=this,i=e.split(/[\r\n]+/);return i.forEach(function(s,r){let a=s.match(/^[\s\t]*;/),o=s.match(/^[\s\t]*$/);if(a||o)return;let n=s.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),h=s.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),u=s.match("^\\t{"+(t.currentIndent-1)+"}}");n?t.parseNodeBegin(s,n):h?t.parseNodeProperty(s,h,i[++r]):u?t.popStack():s.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(s)}),this.allNodes}parseNodeBegin(e,t){let i=t[1].trim().replace(/^"/,"").replace(/"$/,""),s=t[2].split(",").map(function(n){return n.trim().replace(/^"/,"").replace(/"$/,"")}),r={name:i},a=this.parseNodeAttr(s),o=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(i,r):i in o?(i==="PoseNode"?o.PoseNode.push(r):o[i].id!==void 0&&(o[i]={},o[i][o[i].id]=o[i]),a.id!==""&&(o[i][a.id]=r)):typeof a.id=="number"?(o[i]={},o[i][a.id]=r):i!=="Properties70"&&(i==="PoseNode"?o[i]=[r]:o[i]=r),typeof a.id=="number"&&(r.id=a.id),a.name!==""&&(r.attrName=a.name),a.type!==""&&(r.attrType=a.type),this.pushStack(r)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let i="",s="";return e.length>1&&(i=e[1].replace(/^(\w+)::/,""),s=e[2]),{id:t,name:i,type:s}}parseNodeProperty(e,t,i){let s=t[1].replace(/^"/,"").replace(/"$/,"").trim(),r=t[2].replace(/^"/,"").replace(/"$/,"").trim();s==="Content"&&r===","&&(r=i.replace(/"/g,"").replace(/,$/,"").trim());let a=this.getCurrentNode();if(a.name==="Properties70"){this.parseNodeSpecialProperty(e,s,r);return}if(s==="C"){let n=r.split(",").slice(1),h=parseInt(n[0]),u=parseInt(n[1]),c=r.split(",").slice(3);c=c.map(function(p){return p.trim().replace(/^"/,"")}),s="connections",r=[h,u],ec(r,c),a[s]===void 0&&(a[s]=[])}s==="Node"&&(a.id=r),s in a&&Array.isArray(a[s])?a[s].push(r):s!=="a"?a[s]=r:a.a=r,this.setCurrentProp(a,s),s==="a"&&r.slice(-1)!==","&&(a.a=Qs(r))}parseNodePropertyContinued(e){let t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=Qs(t.a))}parseNodeSpecialProperty(e,t,i){let s=i.split('",').map(function(u){return u.trim().replace(/^\"/,"").replace(/\s/,"_")}),r=s[0],a=s[1],o=s[2],n=s[3],h=s[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":h=parseFloat(h);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":h=Qs(h);break}this.getPrevNode()[r]={type:a,type2:o,flag:n,value:h},this.setCurrentProp(this.getPrevNode(),r)}},Ns=class{parse(e){let t=new mi(e);t.skip(23);let i=t.getUint32();if(i<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+i);let s=new gi;for(;!this.endOfContent(t);){let r=this.parseNode(t,i);r!==null&&s.add(r.name,r)}return s}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){let i={},s=t>=7500?e.getUint64():e.getUint32(),r=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();let a=e.getUint8(),o=e.getString(a);if(s===0)return null;let n=[];for(let p=0;p<r;p++)n.push(this.parseProperty(e));let h=n.length>0?n[0]:"",u=n.length>1?n[1]:"",c=n.length>2?n[2]:"";for(i.singleProperty=r===1&&e.getOffset()===s;s>e.getOffset();){let p=this.parseNode(e,t);p!==null&&this.parseSubNode(o,i,p)}return i.propertyList=n,typeof h=="number"&&(i.id=h),u!==""&&(i.attrName=u),c!==""&&(i.attrType=c),o!==""&&(i.name=o),i}parseSubNode(e,t,i){if(i.singleProperty===!0){let s=i.propertyList[0];Array.isArray(s)?(t[i.name]=i,i.a=s):t[i.name]=s}else if(e==="Connections"&&i.name==="C"){let s=[];i.propertyList.forEach(function(r,a){a!==0&&s.push(r)}),t.connections===void 0&&(t.connections=[]),t.connections.push(s)}else if(i.name==="Properties70")Object.keys(i).forEach(function(r){t[r]=i[r]});else if(e==="Properties70"&&i.name==="P"){let s=i.propertyList[0],r=i.propertyList[1],a=i.propertyList[2],o=i.propertyList[3],n;s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),r==="Color"||r==="ColorRGB"||r==="Vector"||r==="Vector3D"||r.indexOf("Lcl_")===0?n=[i.propertyList[4],i.propertyList[5],i.propertyList[6]]:n=i.propertyList[4],t[s]={type:r,type2:a,flag:o,value:n}}else t[i.name]===void 0?typeof i.id=="number"?(t[i.name]={},t[i.name][i.id]=i):t[i.name]=i:i.name==="PoseNode"?(Array.isArray(t[i.name])||(t[i.name]=[t[i.name]]),t[i.name].push(i)):t[i.name][i.id]===void 0&&(t[i.name][i.id]=i)}parseProperty(e){let t=e.getString(1),i;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return i=e.getUint32(),e.getArrayBuffer(i);case"S":return i=e.getUint32(),e.getString(i);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":let s=e.getUint32(),r=e.getUint32(),a=e.getUint32();if(r===0)switch(t){case"b":case"c":return e.getBooleanArray(s);case"d":return e.getFloat64Array(s);case"f":return e.getFloat32Array(s);case"i":return e.getInt32Array(s);case"l":return e.getInt64Array(s)}let o=Va(new Uint8Array(e.getArrayBuffer(a))),n=new mi(o.buffer);switch(t){case"b":case"c":return n.getBooleanArray(s);case"d":return n.getFloat64Array(s);case"f":return n.getFloat32Array(s);case"i":return n.getInt32Array(s);case"l":return n.getInt64Array(s)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}},mi=class{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){let t=[];for(let i=0;i<e;i++)t.push(this.getBoolean());return t}getUint8(){let e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){let e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){let e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){let t=[];for(let i=0;i<e;i++)t.push(this.getInt32());return t}getUint32(){let e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){let t=[];for(let i=0;i<e;i++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){let e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){let t=[];for(let i=0;i<e;i++)t.push(this.getFloat32());return t}getFloat64(){let e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){let t=[];for(let i=0;i<e;i++)t.push(this.getFloat64());return t}getArrayBuffer(e){let t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=this.offset,i=new Uint8Array(this.dv.buffer,t,e);this.skip(e);let s=i.indexOf(0);return s>=0&&(i=new Uint8Array(this.dv.buffer,t,s)),this._textDecoder.decode(i)}},gi=class{add(e,t){this[e]=t}};function Xh(l){let e="Kaydara FBX Binary  \0";return l.byteLength>=e.length&&e===so(l,0,e.length)}function Jh(l){let e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],t=0;function i(s){let r=l[s-1];return l=l.slice(t+s),t++,r}for(let s=0;s<e.length;++s)if(i(1)===e[s])return!1;return!0}function to(l){let e=/FBXVersion: (\d+)/,t=l.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Zh(l){return l/46186158e3}var $h=[];function Ai(l,e,t,i){let s;switch(i.mappingType){case"ByPolygonVertex":s=l;break;case"ByPolygon":s=e;break;case"ByVertice":s=t;break;case"AllSame":s=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}i.referenceType==="IndexToDirect"&&(s=i.indices[s]);let r=s*i.dataSize,a=r+i.dataSize;return tc($h,i.buffer,r,a)}var ks=new ct,vt=new Ge;function io(l){let e=new ie,t=new ie,i=new ie,s=new ie,r=new ie,a=new ie,o=new ie,n=new ie,h=new ie,u=new ie,c=new ie,p=new ie,d=l.inheritType?l.inheritType:0;l.translation&&e.setPosition(vt.fromArray(l.translation));let g=Ut(0);if(l.preRotation){let S=l.preRotation.map(de.degToRad);S.push(g),t.makeRotationFromEuler(ks.fromArray(S))}if(l.rotation){let S=l.rotation.map(de.degToRad);S.push(l.eulerOrder||g),i.makeRotationFromEuler(ks.fromArray(S))}if(l.postRotation){let S=l.postRotation.map(de.degToRad);S.push(g),s.makeRotationFromEuler(ks.fromArray(S)),s.invert()}l.scale&&r.scale(vt.fromArray(l.scale)),l.scalingOffset&&o.setPosition(vt.fromArray(l.scalingOffset)),l.scalingPivot&&a.setPosition(vt.fromArray(l.scalingPivot)),l.rotationOffset&&n.setPosition(vt.fromArray(l.rotationOffset)),l.rotationPivot&&h.setPosition(vt.fromArray(l.rotationPivot)),l.parentMatrixWorld&&(c.copy(l.parentMatrix),u.copy(l.parentMatrixWorld));let m=t.clone().multiply(i).multiply(s),A=new ie;A.extractRotation(u);let f=new ie;f.copyPosition(u);let C=f.clone().invert().multiply(u),v=A.clone().invert().multiply(C),x=r,b=new ie;if(d===0)b.copy(A).multiply(m).multiply(v).multiply(x);else if(d===1)b.copy(A).multiply(v).multiply(m).multiply(x);else{let P=new ie().scale(new Ge().setFromMatrixScale(c)).clone().invert(),F=v.clone().multiply(P);b.copy(A).multiply(m).multiply(F).multiply(x)}let I=h.clone().invert(),E=a.clone().invert(),B=e.clone().multiply(n).multiply(h).multiply(t).multiply(i).multiply(s).multiply(I).multiply(o).multiply(a).multiply(r).multiply(E),w=new ie().copyPosition(B),D=u.clone().multiply(w);return p.copyPosition(D),B=p.clone().multiply(b),B.premultiply(u.invert()),B}function Ut(l){l=l||0;let e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return l===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[l]}function Qs(l){return l.split(",").map(function(t){return parseFloat(t)})}function so(l,e,t){return e===void 0&&(e=0),t===void 0&&(t=l.byteLength),new TextDecoder().decode(new Uint8Array(l,e,t))}function ec(l,e){for(let t=0,i=l.length,s=e.length;t<s;t++,i++)l[i]=e[t]}function tc(l,e,t,i){for(let s=t,r=0;s<i;s++,r++)l[r]=e[s];return l}import{AnimationClip as gc,Bone as vc,Box3 as xc,BufferAttribute as Hs,BufferGeometry as Cc,ClampToEdgeWrapping as bc,Color as pt,ColorManagement as no,DirectionalLight as yc,DoubleSide as Ec,FileLoader as go,FrontSide as Ic,Group as js,ImageBitmapLoader as Bc,InstancedMesh as wc,InterleavedBuffer as Sc,InterleavedBufferAttribute as Dc,Interpolant as Rc,InterpolateDiscrete as Tc,InterpolateLinear as vo,Line as Pc,LineBasicMaterial as Mc,LineLoop as Lc,LineSegments as kc,LinearFilter as Ys,LinearMipmapLinearFilter as xo,LinearMipmapNearestFilter as Qc,LinearSRGBColorSpace as Ve,Loader as _c,LoaderUtils as Ht,Material as Ks,MathUtils as Fc,Matrix4 as bi,Mesh as Oc,MeshBasicMaterial as Vt,MeshPhysicalMaterial as ke,MeshStandardMaterial as Co,MirroredRepeatWrapping as Uc,NearestFilter as bo,NearestMipmapLinearFilter as Gc,NearestMipmapNearestFilter as Nc,NumberKeyframeTrack as lo,Object3D as yo,OrthographicCamera as Vc,PerspectiveCamera as Hc,PointLight as jc,Points as Kc,PointsMaterial as zc,PropertyBinding as Wc,Quaternion as Eo,QuaternionKeyframeTrack as ho,RepeatWrapping as Xs,Skeleton as qc,SkinnedMesh as Yc,Sphere as Xc,SpotLight as Jc,Texture as co,TextureLoader as Zc,TriangleFanDrawMode as $c,TriangleStripDrawMode as eu,Vector2 as Io,Vector3 as xt,VectorKeyframeTrack as uo,SRGBColorSpace as jt,InstancedBufferAttribute as tu}from"three";var Ci={};ve(Ci,{computeMikkTSpaceTangents:()=>nc,computeMorphedAttributes:()=>dc,deepCloneAttribute:()=>hc,deinterleaveAttribute:()=>vi,deinterleaveGeometry:()=>uc,estimateBytesUsed:()=>pc,interleaveAttributes:()=>cc,mergeAttributes:()=>Vs,mergeGeometries:()=>lc,mergeGroups:()=>fc,mergeVertices:()=>Ac,toCreasedNormals:()=>mc,toTrianglesDrawMode:()=>xi});import{BufferAttribute as Gt,BufferGeometry as ic,Float32BufferAttribute as ro,InstancedBufferAttribute as oo,InterleavedBuffer as sc,InterleavedBufferAttribute as rc,TriangleFanDrawMode as ao,TriangleStripDrawMode as ac,TrianglesDrawMode as oc,Vector3 as ue}from"three";function nc(l,e,t=!0){if(!e||!e.isReady)throw new Error("BufferGeometryUtils: Initialized MikkTSpace library required.");if(!l.hasAttribute("position")||!l.hasAttribute("normal")||!l.hasAttribute("uv"))throw new Error('BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.');function i(a){if(a.normalized||a.isInterleavedBufferAttribute){let o=new Float32Array(a.count*a.itemSize);for(let n=0,h=0;n<a.count;n++)o[h++]=a.getX(n),o[h++]=a.getY(n),a.itemSize>2&&(o[h++]=a.getZ(n));return o}return a.array instanceof Float32Array?a.array:new Float32Array(a.array)}let s=l.index?l.toNonIndexed():l,r=e.generateTangents(i(s.attributes.position),i(s.attributes.normal),i(s.attributes.uv));if(t)for(let a=3;a<r.length;a+=4)r[a]*=-1;return s.setAttribute("tangent",new Gt(r,4)),l!==s&&l.copy(s),l}function lc(l,e=!1){let t=l[0].index!==null,i=new Set(Object.keys(l[0].attributes)),s=new Set(Object.keys(l[0].morphAttributes)),r={},a={},o=l[0].morphTargetsRelative,n=new ic,h=0;for(let u=0;u<l.length;++u){let c=l[u],p=0;if(t!==(c.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let d in c.attributes){if(!i.has(d))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+'. All geometries must have compatible attributes; make sure "'+d+'" attribute exists among all geometries, or in none of them.'),null;r[d]===void 0&&(r[d]=[]),r[d].push(c.attributes[d]),p++}if(p!==i.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". Make sure all geometries have the same number of attributes."),null;if(o!==c.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let d in c.morphAttributes){if(!s.has(d))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+".  .morphAttributes must be consistent throughout all geometries."),null;a[d]===void 0&&(a[d]=[]),a[d].push(c.morphAttributes[d])}if(e){let d;if(t)d=c.index.count;else if(c.attributes.position!==void 0)d=c.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". The geometry must have either an index or a position attribute"),null;n.addGroup(h,d,u),h+=d}}if(t){let u=0,c=[];for(let p=0;p<l.length;++p){let d=l[p].index;for(let g=0;g<d.count;++g)c.push(d.getX(g)+u);u+=l[p].attributes.position.count}n.setIndex(c)}for(let u in r){let c=Vs(r[u]);if(!c)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+u+" attribute."),null;n.setAttribute(u,c)}for(let u in a){let c=a[u][0].length;if(c===0)break;n.morphAttributes=n.morphAttributes||{},n.morphAttributes[u]=[];for(let p=0;p<c;++p){let d=[];for(let m=0;m<a[u].length;++m)d.push(a[u][m][p]);let g=Vs(d);if(!g)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+u+" morphAttribute."),null;n.morphAttributes[u].push(g)}}return n}function Vs(l){let e,t,i,s=-1,r=0;for(let h=0;h<l.length;++h){let u=l[h];if(e===void 0&&(e=u.array.constructor),e!==u.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(t===void 0&&(t=u.itemSize),t!==u.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(i===void 0&&(i=u.normalized),i!==u.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(s===-1&&(s=u.gpuType),s!==u.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;r+=u.count*t}let a=new e(r),o=new Gt(a,t,i),n=0;for(let h=0;h<l.length;++h){let u=l[h];if(u.isInterleavedBufferAttribute){let c=n/t;for(let p=0,d=u.count;p<d;p++)for(let g=0;g<t;g++){let m=u.getComponent(p,g);o.setComponent(p+c,g,m)}}else a.set(u.array,n);n+=u.count*t}return s!==void 0&&(o.gpuType=s),o}function hc(l){return l.isInstancedInterleavedBufferAttribute||l.isInterleavedBufferAttribute?vi(l):l.isInstancedBufferAttribute?new oo().copy(l):new Gt().copy(l)}function cc(l){let e,t=0,i=0;for(let h=0,u=l.length;h<u;++h){let c=l[h];if(e===void 0&&(e=c.array.constructor),e!==c.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;t+=c.array.length,i+=c.itemSize}let s=new sc(new e(t),i),r=0,a=[],o=["getX","getY","getZ","getW"],n=["setX","setY","setZ","setW"];for(let h=0,u=l.length;h<u;h++){let c=l[h],p=c.itemSize,d=c.count,g=new rc(s,p,r,c.normalized);a.push(g),r+=p;for(let m=0;m<d;m++)for(let A=0;A<p;A++)g[n[A]](m,c[o[A]](m))}return a}function vi(l){let e=l.data.array.constructor,t=l.count,i=l.itemSize,s=l.normalized,r=new e(t*i),a;l.isInstancedInterleavedBufferAttribute?a=new oo(r,i,s,l.meshPerAttribute):a=new Gt(r,i,s);for(let o=0;o<t;o++)a.setX(o,l.getX(o)),i>=2&&a.setY(o,l.getY(o)),i>=3&&a.setZ(o,l.getZ(o)),i>=4&&a.setW(o,l.getW(o));return a}function uc(l){let e=l.attributes,t=l.morphTargets,i=new Map;for(let s in e){let r=e[s];r.isInterleavedBufferAttribute&&(i.has(r)||i.set(r,vi(r)),e[s]=i.get(r))}for(let s in t){let r=t[s];r.isInterleavedBufferAttribute&&(i.has(r)||i.set(r,vi(r)),t[s]=i.get(r))}}function pc(l){let e=0;for(let i in l.attributes){let s=l.getAttribute(i);e+=s.count*s.itemSize*s.array.BYTES_PER_ELEMENT}let t=l.getIndex();return e+=t?t.count*t.itemSize*t.array.BYTES_PER_ELEMENT:0,e}function Ac(l,e=1e-4){e=Math.max(e,Number.EPSILON);let t={},i=l.getIndex(),s=l.getAttribute("position"),r=i?i.count:s.count,a=0,o=Object.keys(l.attributes),n={},h={},u=[],c=["getX","getY","getZ","getW"],p=["setX","setY","setZ","setW"];for(let C=0,v=o.length;C<v;C++){let x=o[C],b=l.attributes[x];n[x]=new b.constructor(new b.array.constructor(b.count*b.itemSize),b.itemSize,b.normalized);let I=l.morphAttributes[x];I&&(h[x]||(h[x]=[]),I.forEach((E,B)=>{let w=new E.array.constructor(E.count*E.itemSize);h[x][B]=new E.constructor(w,E.itemSize,E.normalized)}))}let d=e*.5,g=Math.log10(1/e),m=Math.pow(10,g),A=d*m;for(let C=0;C<r;C++){let v=i?i.getX(C):C,x="";for(let b=0,I=o.length;b<I;b++){let E=o[b],B=l.getAttribute(E),w=B.itemSize;for(let D=0;D<w;D++)x+=`${~~(B[c[D]](v)*m+A)},`}if(x in t)u.push(t[x]);else{for(let b=0,I=o.length;b<I;b++){let E=o[b],B=l.getAttribute(E),w=l.morphAttributes[E],D=B.itemSize,S=n[E],P=h[E];for(let F=0;F<D;F++){let O=c[F],N=p[F];if(S[N](a,B[O](v)),w)for(let M=0,L=w.length;M<L;M++)P[M][N](a,w[M][O](v))}}t[x]=a,u.push(a),a++}}let f=l.clone();for(let C in l.attributes){let v=n[C];if(f.setAttribute(C,new v.constructor(v.array.slice(0,a*v.itemSize),v.itemSize,v.normalized)),C in h)for(let x=0;x<h[C].length;x++){let b=h[C][x];f.morphAttributes[C][x]=new b.constructor(b.array.slice(0,a*b.itemSize),b.itemSize,b.normalized)}}return f.setIndex(u),f}function xi(l,e){if(e===oc)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),l;if(e===ao||e===ac){let t=l.getIndex();if(t===null){let a=[],o=l.getAttribute("position");if(o!==void 0){for(let n=0;n<o.count;n++)a.push(n);l.setIndex(a),t=l.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),l}let i=t.count-2,s=[];if(e===ao)for(let a=1;a<=i;a++)s.push(t.getX(0)),s.push(t.getX(a)),s.push(t.getX(a+1));else for(let a=0;a<i;a++)a%2===0?(s.push(t.getX(a)),s.push(t.getX(a+1)),s.push(t.getX(a+2))):(s.push(t.getX(a+2)),s.push(t.getX(a+1)),s.push(t.getX(a)));s.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let r=l.clone();return r.setIndex(s),r.clearGroups(),r}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),l}function dc(l){let e=new ue,t=new ue,i=new ue,s=new ue,r=new ue,a=new ue,o=new ue,n=new ue,h=new ue;function u(k,Q,K,Y,_,$,ee,Z){e.fromBufferAttribute(Q,_),t.fromBufferAttribute(Q,$),i.fromBufferAttribute(Q,ee);let he=k.morphTargetInfluences;if(K&&he){o.set(0,0,0),n.set(0,0,0),h.set(0,0,0);for(let xe=0,Qe=K.length;xe<Qe;xe++){let Ce=he[xe],_e=K[xe];Ce!==0&&(s.fromBufferAttribute(_e,_),r.fromBufferAttribute(_e,$),a.fromBufferAttribute(_e,ee),Y?(o.addScaledVector(s,Ce),n.addScaledVector(r,Ce),h.addScaledVector(a,Ce)):(o.addScaledVector(s.sub(e),Ce),n.addScaledVector(r.sub(t),Ce),h.addScaledVector(a.sub(i),Ce)))}e.add(o),t.add(n),i.add(h)}k.isSkinnedMesh&&(k.applyBoneTransform(_,e),k.applyBoneTransform($,t),k.applyBoneTransform(ee,i)),Z[_*3+0]=e.x,Z[_*3+1]=e.y,Z[_*3+2]=e.z,Z[$*3+0]=t.x,Z[$*3+1]=t.y,Z[$*3+2]=t.z,Z[ee*3+0]=i.x,Z[ee*3+1]=i.y,Z[ee*3+2]=i.z}let c=l.geometry,p=l.material,d,g,m,A=c.index,f=c.attributes.position,C=c.morphAttributes.position,v=c.morphTargetsRelative,x=c.attributes.normal,b=c.morphAttributes.position,I=c.groups,E=c.drawRange,B,w,D,S,P,F,O,N=new Float32Array(f.count*f.itemSize),M=new Float32Array(x.count*x.itemSize);if(A!==null)if(Array.isArray(p))for(B=0,D=I.length;B<D;B++)for(P=I[B],F=Math.max(P.start,E.start),O=Math.min(P.start+P.count,E.start+E.count),w=F,S=O;w<S;w+=3)d=A.getX(w),g=A.getX(w+1),m=A.getX(w+2),u(l,f,C,v,d,g,m,N),u(l,x,b,v,d,g,m,M);else for(F=Math.max(0,E.start),O=Math.min(A.count,E.start+E.count),B=F,D=O;B<D;B+=3)d=A.getX(B),g=A.getX(B+1),m=A.getX(B+2),u(l,f,C,v,d,g,m,N),u(l,x,b,v,d,g,m,M);else if(Array.isArray(p))for(B=0,D=I.length;B<D;B++)for(P=I[B],F=Math.max(P.start,E.start),O=Math.min(P.start+P.count,E.start+E.count),w=F,S=O;w<S;w+=3)d=w,g=w+1,m=w+2,u(l,f,C,v,d,g,m,N),u(l,x,b,v,d,g,m,M);else for(F=Math.max(0,E.start),O=Math.min(f.count,E.start+E.count),B=F,D=O;B<D;B+=3)d=B,g=B+1,m=B+2,u(l,f,C,v,d,g,m,N),u(l,x,b,v,d,g,m,M);let L=new ro(N,3),H=new ro(M,3);return{positionAttribute:f,normalAttribute:x,morphedPositionAttribute:L,morphedNormalAttribute:H}}function fc(l){if(l.groups.length===0)return console.warn("THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge."),l;let e=l.groups;if(e=e.sort((a,o)=>a.materialIndex!==o.materialIndex?a.materialIndex-o.materialIndex:a.start-o.start),l.getIndex()===null){let a=l.getAttribute("position"),o=[];for(let n=0;n<a.count;n+=3)o.push(n,n+1,n+2);l.setIndex(o)}let t=l.getIndex(),i=[];for(let a=0;a<e.length;a++){let o=e[a],n=o.start,h=n+o.count;for(let u=n;u<h;u++)i.push(t.getX(u))}l.dispose(),l.setIndex(i);let s=0;for(let a=0;a<e.length;a++){let o=e[a];o.start=s,s+=o.count}let r=e[0];l.groups=[r];for(let a=1;a<e.length;a++){let o=e[a];r.materialIndex===o.materialIndex?r.count+=o.count:(r=o,l.groups.push(r))}return l}function mc(l,e=Math.PI/3){let t=Math.cos(e),i=(1+1e-10)*100,s=[new ue,new ue,new ue],r=new ue,a=new ue,o=new ue,n=new ue;function h(m){let A=~~(m.x*i),f=~~(m.y*i),C=~~(m.z*i);return`${A},${f},${C}`}let u=l.index?l.toNonIndexed():l,c=u.attributes.position,p={};for(let m=0,A=c.count/3;m<A;m++){let f=3*m,C=s[0].fromBufferAttribute(c,f+0),v=s[1].fromBufferAttribute(c,f+1),x=s[2].fromBufferAttribute(c,f+2);r.subVectors(x,v),a.subVectors(C,v);let b=new ue().crossVectors(r,a).normalize();for(let I=0;I<3;I++){let E=s[I],B=h(E);B in p||(p[B]=[]),p[B].push(b)}}let d=new Float32Array(c.count*3),g=new Gt(d,3,!1);for(let m=0,A=c.count/3;m<A;m++){let f=3*m,C=s[0].fromBufferAttribute(c,f+0),v=s[1].fromBufferAttribute(c,f+1),x=s[2].fromBufferAttribute(c,f+2);r.subVectors(x,v),a.subVectors(C,v),o.crossVectors(r,a).normalize();for(let b=0;b<3;b++){let I=s[b],E=h(I),B=p[E];n.set(0,0,0);for(let w=0,D=B.length;w<D;w++){let S=B[w];o.dot(S)>t&&n.add(S)}n.normalize(),g.setXYZ(f+b,n.x,n.y,n.z)}}return u.setAttribute("normal",g),u}var bt=class extends _c{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new er(t)}),this.register(function(t){return new tr(t)}),this.register(function(t){return new cr(t)}),this.register(function(t){return new ur(t)}),this.register(function(t){return new pr(t)}),this.register(function(t){return new sr(t)}),this.register(function(t){return new rr(t)}),this.register(function(t){return new ar(t)}),this.register(function(t){return new or(t)}),this.register(function(t){return new $s(t)}),this.register(function(t){return new nr(t)}),this.register(function(t){return new ir(t)}),this.register(function(t){return new hr(t)}),this.register(function(t){return new lr(t)}),this.register(function(t){return new Js(t)}),this.register(function(t){return new Ar(t)}),this.register(function(t){return new dr(t)})}load(e,t,i,s){let r=this,a;if(this.resourcePath!=="")a=this.resourcePath;else if(this.path!==""){let h=Ht.extractUrlBase(e);a=Ht.resolveURL(h,this.path)}else a=Ht.extractUrlBase(e);this.manager.itemStart(e);let o=function(h){s?s(h):console.error(h),r.manager.itemError(e),r.manager.itemEnd(e)},n=new go(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,function(h){try{r.parse(h,a,function(u){t(u),r.manager.itemEnd(e)},o)}catch(u){o(u)}},i,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,s){let r,a={},o={},n=new TextDecoder;if(typeof e=="string")r=JSON.parse(e);else if(e instanceof ArrayBuffer)if(n.decode(new Uint8Array(e,0,4))===Bo){try{a[V.KHR_BINARY_GLTF]=new fr(e)}catch(c){s&&s(c);return}r=JSON.parse(a[V.KHR_BINARY_GLTF].content)}else r=JSON.parse(n.decode(e));else r=e;if(r.asset===void 0||r.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}let h=new yr(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});h.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){let c=this.pluginCallbacks[u](h);c.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[c.name]=c,a[c.name]=!0}if(r.extensionsUsed)for(let u=0;u<r.extensionsUsed.length;++u){let c=r.extensionsUsed[u],p=r.extensionsRequired||[];switch(c){case V.KHR_MATERIALS_UNLIT:a[c]=new Zs;break;case V.KHR_DRACO_MESH_COMPRESSION:a[c]=new mr(r,this.dracoLoader);break;case V.KHR_TEXTURE_TRANSFORM:a[c]=new gr;break;case V.KHR_MESH_QUANTIZATION:a[c]=new vr;break;default:p.indexOf(c)>=0&&o[c]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+c+'".')}}h.setExtensions(a),h.setPlugins(o),h.parse(i,s)}parseAsync(e,t){let i=this;return new Promise(function(s,r){i.parse(e,t,s,r)})}};function iu(){let l={};return{get:function(e){return l[e]},add:function(e,t){l[e]=t},remove:function(e){delete l[e]},removeAll:function(){l={}}}}var V={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"},Js=class{constructor(e){this.parser=e,this.name=V.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let e=this.parser,t=this.parser.json.nodes||[];for(let i=0,s=t.length;i<s;i++){let r=t[i];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){let t=this.parser,i="light:"+e,s=t.cache.get(i);if(s)return s;let r=t.json,n=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e],h,u=new pt(16777215);n.color!==void 0&&u.setRGB(n.color[0],n.color[1],n.color[2],Ve);let c=n.range!==void 0?n.range:0;switch(n.type){case"directional":h=new yc(u),h.target.position.set(0,0,-1),h.add(h.target);break;case"point":h=new jc(u),h.distance=c;break;case"spot":h=new Jc(u),h.distance=c,n.spot=n.spot||{},n.spot.innerConeAngle=n.spot.innerConeAngle!==void 0?n.spot.innerConeAngle:0,n.spot.outerConeAngle=n.spot.outerConeAngle!==void 0?n.spot.outerConeAngle:Math.PI/4,h.angle=n.spot.outerConeAngle,h.penumbra=1-n.spot.innerConeAngle/n.spot.outerConeAngle,h.target.position.set(0,0,-1),h.add(h.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+n.type)}return h.position.set(0,0,0),h.decay=2,Ne(h,n),n.intensity!==void 0&&(h.intensity=n.intensity),h.name=t.createUniqueName(n.name||"light_"+e),s=Promise.resolve(h),t.cache.add(i,s),s}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){let t=this,i=this.parser,r=i.json.nodes[e],o=(r.extensions&&r.extensions[this.name]||{}).light;return o===void 0?null:this._loadLight(o).then(function(n){return i._getNodeRef(t.cache,o,n)})}},Zs=class{constructor(){this.name=V.KHR_MATERIALS_UNLIT}getMaterialType(){return Vt}extendParams(e,t,i){let s=[];e.color=new pt(1,1,1),e.opacity=1;let r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){let a=r.baseColorFactor;e.color.setRGB(a[0],a[1],a[2],Ve),e.opacity=a[3]}r.baseColorTexture!==void 0&&s.push(i.assignTexture(e,"map",r.baseColorTexture,jt))}return Promise.all(s)}},$s=class{constructor(e){this.parser=e,this.name=V.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){let s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();let r=s.extensions[this.name].emissiveStrength;return r!==void 0&&(t.emissiveIntensity=r),Promise.resolve()}},er=class{constructor(e){this.parser=e,this.name=V.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){let i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:ke}extendMaterialParams(e,t){let i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();let r=[],a=s.extensions[this.name];if(a.clearcoatFactor!==void 0&&(t.clearcoat=a.clearcoatFactor),a.clearcoatTexture!==void 0&&r.push(i.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),a.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),a.clearcoatRoughnessTexture!==void 0&&r.push(i.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),a.clearcoatNormalTexture!==void 0&&(r.push(i.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),a.clearcoatNormalTexture.scale!==void 0)){let o=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Io(o,o)}return Promise.all(r)}},tr=class{constructor(e){this.parser=e,this.name=V.KHR_MATERIALS_DISPERSION}getMaterialType(e){let i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:ke}extendMaterialParams(e,t){let s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();let r=s.extensions[this.name];return t.dispersion=r.dispersion!==void 0?r.dispersion:0,Promise.resolve()}},ir=class{constructor(e){this.parser=e,this.name=V.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){let i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:ke}extendMaterialParams(e,t){let i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();let r=[],a=s.extensions[this.name];return a.iridescenceFactor!==void 0&&(t.iridescence=a.iridescenceFactor),a.iridescenceTexture!==void 0&&r.push(i.assignTexture(t,"iridescenceMap",a.iridescenceTexture)),a.iridescenceIor!==void 0&&(t.iridescenceIOR=a.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),a.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),a.iridescenceThicknessTexture!==void 0&&r.push(i.assignTexture(t,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(r)}},sr=class{constructor(e){this.parser=e,this.name=V.KHR_MATERIALS_SHEEN}getMaterialType(e){let i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:ke}extendMaterialParams(e,t){let i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();let r=[];t.sheenColor=new pt(0,0,0),t.sheenRoughness=0,t.sheen=1;let a=s.extensions[this.name];if(a.sheenColorFactor!==void 0){let o=a.sheenColorFactor;t.sheenColor.setRGB(o[0],o[1],o[2],Ve)}return a.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=a.sheenRoughnessFactor),a.sheenColorTexture!==void 0&&r.push(i.assignTexture(t,"sheenColorMap",a.sheenColorTexture,jt)),a.sheenRoughnessTexture!==void 0&&r.push(i.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(r)}},rr=class{constructor(e){this.parser=e,this.name=V.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){let i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:ke}extendMaterialParams(e,t){let i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();let r=[],a=s.extensions[this.name];return a.transmissionFactor!==void 0&&(t.transmission=a.transmissionFactor),a.transmissionTexture!==void 0&&r.push(i.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(r)}},ar=class{constructor(e){this.parser=e,this.name=V.KHR_MATERIALS_VOLUME}getMaterialType(e){let i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:ke}extendMaterialParams(e,t){let i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();let r=[],a=s.extensions[this.name];t.thickness=a.thicknessFactor!==void 0?a.thicknessFactor:0,a.thicknessTexture!==void 0&&r.push(i.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||1/0;let o=a.attenuationColor||[1,1,1];return t.attenuationColor=new pt().setRGB(o[0],o[1],o[2],Ve),Promise.all(r)}},or=class{constructor(e){this.parser=e,this.name=V.KHR_MATERIALS_IOR}getMaterialType(e){let i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:ke}extendMaterialParams(e,t){let s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();let r=s.extensions[this.name];return t.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}},nr=class{constructor(e){this.parser=e,this.name=V.KHR_MATERIALS_SPECULAR}getMaterialType(e){let i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:ke}extendMaterialParams(e,t){let i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();let r=[],a=s.extensions[this.name];t.specularIntensity=a.specularFactor!==void 0?a.specularFactor:1,a.specularTexture!==void 0&&r.push(i.assignTexture(t,"specularIntensityMap",a.specularTexture));let o=a.specularColorFactor||[1,1,1];return t.specularColor=new pt().setRGB(o[0],o[1],o[2],Ve),a.specularColorTexture!==void 0&&r.push(i.assignTexture(t,"specularColorMap",a.specularColorTexture,jt)),Promise.all(r)}},lr=class{constructor(e){this.parser=e,this.name=V.EXT_MATERIALS_BUMP}getMaterialType(e){let i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:ke}extendMaterialParams(e,t){let i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();let r=[],a=s.extensions[this.name];return t.bumpScale=a.bumpFactor!==void 0?a.bumpFactor:1,a.bumpTexture!==void 0&&r.push(i.assignTexture(t,"bumpMap",a.bumpTexture)),Promise.all(r)}},hr=class{constructor(e){this.parser=e,this.name=V.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){let i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:ke}extendMaterialParams(e,t){let i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();let r=[],a=s.extensions[this.name];return a.anisotropyStrength!==void 0&&(t.anisotropy=a.anisotropyStrength),a.anisotropyRotation!==void 0&&(t.anisotropyRotation=a.anisotropyRotation),a.anisotropyTexture!==void 0&&r.push(i.assignTexture(t,"anisotropyMap",a.anisotropyTexture)),Promise.all(r)}},cr=class{constructor(e){this.parser=e,this.name=V.KHR_TEXTURE_BASISU}loadTexture(e){let t=this.parser,i=t.json,s=i.textures[e];if(!s.extensions||!s.extensions[this.name])return null;let r=s.extensions[this.name],a=t.options.ktx2Loader;if(!a){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,a)}},ur=class{constructor(e){this.parser=e,this.name=V.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){let t=this.name,i=this.parser,s=i.json,r=s.textures[e];if(!r.extensions||!r.extensions[t])return null;let a=r.extensions[t],o=s.images[a.source],n=i.textureLoader;if(o.uri){let h=i.options.manager.getHandler(o.uri);h!==null&&(n=h)}return this.detectSupport().then(function(h){if(h)return i.loadTextureImage(e,a.source,n);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}},pr=class{constructor(e){this.parser=e,this.name=V.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){let t=this.name,i=this.parser,s=i.json,r=s.textures[e];if(!r.extensions||!r.extensions[t])return null;let a=r.extensions[t],o=s.images[a.source],n=i.textureLoader;if(o.uri){let h=i.options.manager.getHandler(o.uri);h!==null&&(n=h)}return this.detectSupport().then(function(h){if(h)return i.loadTextureImage(e,a.source,n);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}},Ar=class{constructor(e){this.name=V.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){let t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){let s=i.extensions[this.name],r=this.parser.getDependency("buffer",s.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(o){let n=s.byteOffset||0,h=s.byteLength||0,u=s.count,c=s.byteStride,p=new Uint8Array(o,n,h);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(u,c,p,s.mode,s.filter).then(function(d){return d.buffer}):a.ready.then(function(){let d=new ArrayBuffer(u*c);return a.decodeGltfBuffer(new Uint8Array(d),u,c,p,s.mode,s.filter),d})})}else return null}},dr=class{constructor(e){this.name=V.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){let t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;let s=t.meshes[i.mesh];for(let h of s.primitives)if(h.mode!==Be.TRIANGLES&&h.mode!==Be.TRIANGLE_STRIP&&h.mode!==Be.TRIANGLE_FAN&&h.mode!==void 0)return null;let a=i.extensions[this.name].attributes,o=[],n={};for(let h in a)o.push(this.parser.getDependency("accessor",a[h]).then(u=>(n[h]=u,n[h])));return o.length<1?null:(o.push(this.parser.createNodeMesh(e)),Promise.all(o).then(h=>{let u=h.pop(),c=u.isGroup?u.children:[u],p=h[0].count,d=[];for(let g of c){let m=new bi,A=new xt,f=new Eo,C=new xt(1,1,1),v=new wc(g.geometry,g.material,p);for(let x=0;x<p;x++)n.TRANSLATION&&A.fromBufferAttribute(n.TRANSLATION,x),n.ROTATION&&f.fromBufferAttribute(n.ROTATION,x),n.SCALE&&C.fromBufferAttribute(n.SCALE,x),v.setMatrixAt(x,m.compose(A,f,C));for(let x in n)if(x==="_COLOR_0"){let b=n[x];v.instanceColor=new tu(b.array,b.itemSize,b.normalized)}else x!=="TRANSLATION"&&x!=="ROTATION"&&x!=="SCALE"&&g.geometry.setAttribute(x,n[x]);yo.prototype.copy.call(v,g),this.parser.assignFinalMaterial(v),d.push(v)}return u.isGroup?(u.clear(),u.add(...d),u):d[0]}))}},Bo="glTF",Nt=12,po={JSON:1313821514,BIN:5130562},fr=class{constructor(e){this.name=V.KHR_BINARY_GLTF,this.content=null,this.body=null;let t=new DataView(e,0,Nt),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Bo)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");let s=this.header.length-Nt,r=new DataView(e,Nt),a=0;for(;a<s;){let o=r.getUint32(a,!0);a+=4;let n=r.getUint32(a,!0);if(a+=4,n===po.JSON){let h=new Uint8Array(e,Nt+a,o);this.content=i.decode(h)}else if(n===po.BIN){let h=Nt+a;this.body=e.slice(h,h+o)}a+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}},mr=class{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=V.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){let i=this.json,s=this.dracoLoader,r=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},n={},h={};for(let u in a){let c=Cr[u]||u.toLowerCase();o[c]=a[u]}for(let u in e.attributes){let c=Cr[u]||u.toLowerCase();if(a[u]!==void 0){let p=i.accessors[e.attributes[u]],d=Ct[p.componentType];h[c]=d.name,n[c]=p.normalized===!0}}return t.getDependency("bufferView",r).then(function(u){return new Promise(function(c,p){s.decodeDracoFile(u,function(d){for(let g in d.attributes){let m=d.attributes[g],A=n[g];A!==void 0&&(m.normalized=A)}c(d)},o,h,Ve,p)})})}},gr=class{constructor(){this.name=V.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}},vr=class{constructor(){this.name=V.KHR_MESH_QUANTIZATION}},yi=class extends Rc{constructor(e,t,i,s){super(e,t,i,s)}copySampleValue_(e){let t=this.resultBuffer,i=this.sampleValues,s=this.valueSize,r=e*s*3+s;for(let a=0;a!==s;a++)t[a]=i[r+a];return t}interpolate_(e,t,i,s){let r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,n=o*2,h=o*3,u=s-t,c=(i-t)/u,p=c*c,d=p*c,g=e*h,m=g-h,A=-2*d+3*p,f=d-p,C=1-A,v=f-p+c;for(let x=0;x!==o;x++){let b=a[m+x+o],I=a[m+x+n]*u,E=a[g+x+o],B=a[g+x]*u;r[x]=C*b+v*I+A*E+f*B}return r}},su=new Eo,xr=class extends yi{interpolate_(e,t,i,s){let r=super.interpolate_(e,t,i,s);return su.fromArray(r).normalize().toArray(r),r}},Be={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Ct={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Ao={9728:bo,9729:Ys,9984:Nc,9985:Qc,9986:Gc,9987:xo},fo={33071:bc,33648:Uc,10497:Xs},zs={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Cr={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},it={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},ru={CUBICSPLINE:void 0,LINEAR:vo,STEP:Tc},Ws={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function au(l){return l.DefaultMaterial===void 0&&(l.DefaultMaterial=new Co({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Ic})),l.DefaultMaterial}function ut(l,e,t){for(let i in t.extensions)l[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function Ne(l,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(l.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function ou(l,e,t){let i=!1,s=!1,r=!1;for(let h=0,u=e.length;h<u;h++){let c=e[h];if(c.POSITION!==void 0&&(i=!0),c.NORMAL!==void 0&&(s=!0),c.COLOR_0!==void 0&&(r=!0),i&&s&&r)break}if(!i&&!s&&!r)return Promise.resolve(l);let a=[],o=[],n=[];for(let h=0,u=e.length;h<u;h++){let c=e[h];if(i){let p=c.POSITION!==void 0?t.getDependency("accessor",c.POSITION):l.attributes.position;a.push(p)}if(s){let p=c.NORMAL!==void 0?t.getDependency("accessor",c.NORMAL):l.attributes.normal;o.push(p)}if(r){let p=c.COLOR_0!==void 0?t.getDependency("accessor",c.COLOR_0):l.attributes.color;n.push(p)}}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(n)]).then(function(h){let u=h[0],c=h[1],p=h[2];return i&&(l.morphAttributes.position=u),s&&(l.morphAttributes.normal=c),r&&(l.morphAttributes.color=p),l.morphTargetsRelative=!0,l})}function nu(l,e){if(l.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)l.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){let t=e.extras.targetNames;if(l.morphTargetInfluences.length===t.length){l.morphTargetDictionary={};for(let i=0,s=t.length;i<s;i++)l.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function lu(l){let e,t=l.extensions&&l.extensions[V.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+qs(t.attributes):e=l.indices+":"+qs(l.attributes)+":"+l.mode,l.targets!==void 0)for(let i=0,s=l.targets.length;i<s;i++)e+=":"+qs(l.targets[i]);return e}function qs(l){let e="",t=Object.keys(l).sort();for(let i=0,s=t.length;i<s;i++)e+=t[i]+":"+l[t[i]]+";";return e}function br(l){switch(l){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function hu(l){return l.search(/\.jpe?g($|\?)/i)>0||l.search(/^data\:image\/jpeg/)===0?"image/jpeg":l.search(/\.webp($|\?)/i)>0||l.search(/^data\:image\/webp/)===0?"image/webp":l.search(/\.ktx2($|\?)/i)>0||l.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}var cu=new bi,yr=class{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new iu,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,s=-1,r=!1,a=-1;if(typeof navigator!="undefined"){let o=navigator.userAgent;i=/^((?!chrome|android).)*safari/i.test(o)===!0;let n=o.match(/Version\/(\d+)/);s=i&&n?parseInt(n[1],10):-1,r=o.indexOf("Firefox")>-1,a=r?o.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap=="undefined"||i&&s<17||r&&a<98?this.textureLoader=new Zc(this.options.manager):this.textureLoader=new Bc(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new go(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){let i=this,s=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(a){let o={scene:a[0][s.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:s.asset,parser:i,userData:{}};return ut(r,o,s),Ne(o,s),Promise.all(i._invokeAll(function(n){return n.afterRoot&&n.afterRoot(o)})).then(function(){for(let n of o.scenes)n.updateMatrixWorld();e(o)})}).catch(t)}_markDefs(){let e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let s=0,r=t.length;s<r;s++){let a=t[s].joints;for(let o=0,n=a.length;o<n;o++)e[a[o]].isBone=!0}for(let s=0,r=e.length;s<r;s++){let a=e[s];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(i[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;let s=i.clone(),r=(a,o)=>{let n=this.associations.get(a);n!=null&&this.associations.set(o,n);for(let[h,u]of a.children.entries())r(u,o.children[h])};return r(i,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){let t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){let s=e(t[i]);if(s)return s}return null}_invokeAll(e){let t=Object.values(this.plugins);t.unshift(this);let i=[];for(let s=0;s<t.length;s++){let r=e(t[s]);r&&i.push(r)}return i}getDependency(e,t){let i=e+":"+t,s=this.cache.get(i);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this._invokeOne(function(r){return r.loadNode&&r.loadNode(t)});break;case"mesh":s=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(t)});break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(t)});break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(t)});break;case"texture":s=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(t)});break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(t)});break;case"camera":s=this.loadCamera(t);break;default:if(s=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(e,t)}),!s)throw new Error("Unknown type: "+e);break}this.cache.add(i,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){let i=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(s.map(function(r,a){return i.getDependency(e,a)})),this.cache.add(e,t)}return t}loadBuffer(e){let t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[V.KHR_BINARY_GLTF].body);let s=this.options;return new Promise(function(r,a){i.load(Ht.resolveURL(t.uri,s.path),r,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){let t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){let s=t.byteLength||0,r=t.byteOffset||0;return i.slice(r,r+s)})}loadAccessor(e){let t=this,i=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0){let a=zs[s.type],o=Ct[s.componentType],n=s.normalized===!0,h=new o(s.count*a);return Promise.resolve(new Hs(h,a,n))}let r=[];return s.bufferView!==void 0?r.push(this.getDependency("bufferView",s.bufferView)):r.push(null),s.sparse!==void 0&&(r.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(r).then(function(a){let o=a[0],n=zs[s.type],h=Ct[s.componentType],u=h.BYTES_PER_ELEMENT,c=u*n,p=s.byteOffset||0,d=s.bufferView!==void 0?i.bufferViews[s.bufferView].byteStride:void 0,g=s.normalized===!0,m,A;if(d&&d!==c){let f=Math.floor(p/d),C="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+f+":"+s.count,v=t.cache.get(C);v||(m=new h(o,f*d,s.count*d/u),v=new Sc(m,d/u),t.cache.add(C,v)),A=new Dc(v,n,p%d/u,g)}else o===null?m=new h(s.count*n):m=new h(o,p,s.count*n),A=new Hs(m,n,g);if(s.sparse!==void 0){let f=zs.SCALAR,C=Ct[s.sparse.indices.componentType],v=s.sparse.indices.byteOffset||0,x=s.sparse.values.byteOffset||0,b=new C(a[1],v,s.sparse.count*f),I=new h(a[2],x,s.sparse.count*n);o!==null&&(A=new Hs(A.array.slice(),A.itemSize,A.normalized)),A.normalized=!1;for(let E=0,B=b.length;E<B;E++){let w=b[E];if(A.setX(w,I[E*n]),n>=2&&A.setY(w,I[E*n+1]),n>=3&&A.setZ(w,I[E*n+2]),n>=4&&A.setW(w,I[E*n+3]),n>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}A.normalized=g}return A})}loadTexture(e){let t=this.json,i=this.options,r=t.textures[e].source,a=t.images[r],o=this.textureLoader;if(a.uri){let n=i.manager.getHandler(a.uri);n!==null&&(o=n)}return this.loadTextureImage(e,r,o)}loadTextureImage(e,t,i){let s=this,r=this.json,a=r.textures[e],o=r.images[t],n=(o.uri||o.bufferView)+":"+a.sampler;if(this.textureCache[n])return this.textureCache[n];let h=this.loadImageSource(t,i).then(function(u){u.flipY=!1,u.name=a.name||o.name||"",u.name===""&&typeof o.uri=="string"&&o.uri.startsWith("data:image/")===!1&&(u.name=o.uri);let p=(r.samplers||{})[a.sampler]||{};return u.magFilter=Ao[p.magFilter]||Ys,u.minFilter=Ao[p.minFilter]||xo,u.wrapS=fo[p.wrapS]||Xs,u.wrapT=fo[p.wrapT]||Xs,u.generateMipmaps=!u.isCompressedTexture&&u.minFilter!==bo&&u.minFilter!==Ys,s.associations.set(u,{textures:e}),u}).catch(function(){return null});return this.textureCache[n]=h,h}loadImageSource(e,t){let i=this,s=this.json,r=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(c=>c.clone());let a=s.images[e],o=self.URL||self.webkitURL,n=a.uri||"",h=!1;if(a.bufferView!==void 0)n=i.getDependency("bufferView",a.bufferView).then(function(c){h=!0;let p=new Blob([c],{type:a.mimeType});return n=o.createObjectURL(p),n});else if(a.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");let u=Promise.resolve(n).then(function(c){return new Promise(function(p,d){let g=p;t.isImageBitmapLoader===!0&&(g=function(m){let A=new co(m);A.needsUpdate=!0,p(A)}),t.load(Ht.resolveURL(c,r.path),g,void 0,d)})}).then(function(c){return h===!0&&o.revokeObjectURL(n),Ne(c,a),c.userData.mimeType=a.mimeType||hu(a.uri),c}).catch(function(c){throw console.error("THREE.GLTFLoader: Couldn't load texture",n),c});return this.sourceCache[e]=u,u}assignTexture(e,t,i,s){let r=this;return this.getDependency("texture",i.index).then(function(a){if(!a)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(a=a.clone(),a.channel=i.texCoord),r.extensions[V.KHR_TEXTURE_TRANSFORM]){let o=i.extensions!==void 0?i.extensions[V.KHR_TEXTURE_TRANSFORM]:void 0;if(o){let n=r.associations.get(a);a=r.extensions[V.KHR_TEXTURE_TRANSFORM].extendTexture(a,o),r.associations.set(a,n)}}return s!==void 0&&(a.colorSpace=s),e[t]=a,a})}assignFinalMaterial(e){let t=e.geometry,i=e.material,s=t.attributes.tangent===void 0,r=t.attributes.color!==void 0,a=t.attributes.normal===void 0;if(e.isPoints){let o="PointsMaterial:"+i.uuid,n=this.cache.get(o);n||(n=new zc,Ks.prototype.copy.call(n,i),n.color.copy(i.color),n.map=i.map,n.sizeAttenuation=!1,this.cache.add(o,n)),i=n}else if(e.isLine){let o="LineBasicMaterial:"+i.uuid,n=this.cache.get(o);n||(n=new Mc,Ks.prototype.copy.call(n,i),n.color.copy(i.color),n.map=i.map,this.cache.add(o,n)),i=n}if(s||r||a){let o="ClonedMaterial:"+i.uuid+":";s&&(o+="derivative-tangents:"),r&&(o+="vertex-colors:"),a&&(o+="flat-shading:");let n=this.cache.get(o);n||(n=i.clone(),r&&(n.vertexColors=!0),a&&(n.flatShading=!0),s&&(n.normalScale&&(n.normalScale.y*=-1),n.clearcoatNormalScale&&(n.clearcoatNormalScale.y*=-1)),this.cache.add(o,n),this.associations.set(n,this.associations.get(i))),i=n}e.material=i}getMaterialType(){return Co}loadMaterial(e){let t=this,i=this.json,s=this.extensions,r=i.materials[e],a,o={},n=r.extensions||{},h=[];if(n[V.KHR_MATERIALS_UNLIT]){let c=s[V.KHR_MATERIALS_UNLIT];a=c.getMaterialType(),h.push(c.extendParams(o,r,t))}else{let c=r.pbrMetallicRoughness||{};if(o.color=new pt(1,1,1),o.opacity=1,Array.isArray(c.baseColorFactor)){let p=c.baseColorFactor;o.color.setRGB(p[0],p[1],p[2],Ve),o.opacity=p[3]}c.baseColorTexture!==void 0&&h.push(t.assignTexture(o,"map",c.baseColorTexture,jt)),o.metalness=c.metallicFactor!==void 0?c.metallicFactor:1,o.roughness=c.roughnessFactor!==void 0?c.roughnessFactor:1,c.metallicRoughnessTexture!==void 0&&(h.push(t.assignTexture(o,"metalnessMap",c.metallicRoughnessTexture)),h.push(t.assignTexture(o,"roughnessMap",c.metallicRoughnessTexture))),a=this._invokeOne(function(p){return p.getMaterialType&&p.getMaterialType(e)}),h.push(Promise.all(this._invokeAll(function(p){return p.extendMaterialParams&&p.extendMaterialParams(e,o)})))}r.doubleSided===!0&&(o.side=Ec);let u=r.alphaMode||Ws.OPAQUE;if(u===Ws.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,u===Ws.MASK&&(o.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&a!==Vt&&(h.push(t.assignTexture(o,"normalMap",r.normalTexture)),o.normalScale=new Io(1,1),r.normalTexture.scale!==void 0)){let c=r.normalTexture.scale;o.normalScale.set(c,c)}if(r.occlusionTexture!==void 0&&a!==Vt&&(h.push(t.assignTexture(o,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(o.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&a!==Vt){let c=r.emissiveFactor;o.emissive=new pt().setRGB(c[0],c[1],c[2],Ve)}return r.emissiveTexture!==void 0&&a!==Vt&&h.push(t.assignTexture(o,"emissiveMap",r.emissiveTexture,jt)),Promise.all(h).then(function(){let c=new a(o);return r.name&&(c.name=r.name),Ne(c,r),t.associations.set(c,{materials:e}),r.extensions&&ut(s,c,r),c})}createUniqueName(e){let t=Wc.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){let t=this,i=this.extensions,s=this.primitiveCache;function r(o){return i[V.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(o,t).then(function(n){return mo(n,o,t)})}let a=[];for(let o=0,n=e.length;o<n;o++){let h=e[o],u=lu(h),c=s[u];if(c)a.push(c.promise);else{let p;h.extensions&&h.extensions[V.KHR_DRACO_MESH_COMPRESSION]?p=r(h):p=mo(new Cc,h,t),s[u]={primitive:h,promise:p},a.push(p)}}return Promise.all(a)}loadMesh(e){let t=this,i=this.json,s=this.extensions,r=i.meshes[e],a=r.primitives,o=[];for(let n=0,h=a.length;n<h;n++){let u=a[n].material===void 0?au(this.cache):this.getDependency("material",a[n].material);o.push(u)}return o.push(t.loadGeometries(a)),Promise.all(o).then(function(n){let h=n.slice(0,n.length-1),u=n[n.length-1],c=[];for(let d=0,g=u.length;d<g;d++){let m=u[d],A=a[d],f,C=h[d];if(A.mode===Be.TRIANGLES||A.mode===Be.TRIANGLE_STRIP||A.mode===Be.TRIANGLE_FAN||A.mode===void 0)f=r.isSkinnedMesh===!0?new Yc(m,C):new Oc(m,C),f.isSkinnedMesh===!0&&f.normalizeSkinWeights(),A.mode===Be.TRIANGLE_STRIP?f.geometry=xi(f.geometry,eu):A.mode===Be.TRIANGLE_FAN&&(f.geometry=xi(f.geometry,$c));else if(A.mode===Be.LINES)f=new kc(m,C);else if(A.mode===Be.LINE_STRIP)f=new Pc(m,C);else if(A.mode===Be.LINE_LOOP)f=new Lc(m,C);else if(A.mode===Be.POINTS)f=new Kc(m,C);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+A.mode);Object.keys(f.geometry.morphAttributes).length>0&&nu(f,r),f.name=t.createUniqueName(r.name||"mesh_"+e),Ne(f,r),A.extensions&&ut(s,f,A),t.assignFinalMaterial(f),c.push(f)}for(let d=0,g=c.length;d<g;d++)t.associations.set(c[d],{meshes:e,primitives:d});if(c.length===1)return r.extensions&&ut(s,c[0],r),c[0];let p=new js;r.extensions&&ut(s,p,r),t.associations.set(p,{meshes:e});for(let d=0,g=c.length;d<g;d++)p.add(c[d]);return p})}loadCamera(e){let t,i=this.json.cameras[e],s=i[i.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new Hc(Fc.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):i.type==="orthographic"&&(t=new Vc(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),Ne(t,i),Promise.resolve(t)}loadSkin(e){let t=this.json.skins[e],i=[];for(let s=0,r=t.joints.length;s<r;s++)i.push(this._loadNodeShallow(t.joints[s]));return t.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(s){let r=s.pop(),a=s,o=[],n=[];for(let h=0,u=a.length;h<u;h++){let c=a[h];if(c){o.push(c);let p=new bi;r!==null&&p.fromArray(r.array,h*16),n.push(p)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[h])}return new qc(o,n)})}loadAnimation(e){let t=this.json,i=this,s=t.animations[e],r=s.name?s.name:"animation_"+e,a=[],o=[],n=[],h=[],u=[];for(let c=0,p=s.channels.length;c<p;c++){let d=s.channels[c],g=s.samplers[d.sampler],m=d.target,A=m.node,f=s.parameters!==void 0?s.parameters[g.input]:g.input,C=s.parameters!==void 0?s.parameters[g.output]:g.output;m.node!==void 0&&(a.push(this.getDependency("node",A)),o.push(this.getDependency("accessor",f)),n.push(this.getDependency("accessor",C)),h.push(g),u.push(m))}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(n),Promise.all(h),Promise.all(u)]).then(function(c){let p=c[0],d=c[1],g=c[2],m=c[3],A=c[4],f=[];for(let C=0,v=p.length;C<v;C++){let x=p[C],b=d[C],I=g[C],E=m[C],B=A[C];if(x===void 0)continue;x.updateMatrix&&x.updateMatrix();let w=i._createAnimationTracks(x,b,I,E,B);if(w)for(let D=0;D<w.length;D++)f.push(w[D])}return new gc(r,void 0,f)})}createNodeMesh(e){let t=this.json,i=this,s=t.nodes[e];return s.mesh===void 0?null:i.getDependency("mesh",s.mesh).then(function(r){let a=i._getNodeRef(i.meshCache,s.mesh,r);return s.weights!==void 0&&a.traverse(function(o){if(o.isMesh)for(let n=0,h=s.weights.length;n<h;n++)o.morphTargetInfluences[n]=s.weights[n]}),a})}loadNode(e){let t=this.json,i=this,s=t.nodes[e],r=i._loadNodeShallow(e),a=[],o=s.children||[];for(let h=0,u=o.length;h<u;h++)a.push(i.getDependency("node",o[h]));let n=s.skin===void 0?Promise.resolve(null):i.getDependency("skin",s.skin);return Promise.all([r,Promise.all(a),n]).then(function(h){let u=h[0],c=h[1],p=h[2];p!==null&&u.traverse(function(d){d.isSkinnedMesh&&d.bind(p,cu)});for(let d=0,g=c.length;d<g;d++)u.add(c[d]);return u})}_loadNodeShallow(e){let t=this.json,i=this.extensions,s=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];let r=t.nodes[e],a=r.name?s.createUniqueName(r.name):"",o=[],n=s._invokeOne(function(h){return h.createNodeMesh&&h.createNodeMesh(e)});return n&&o.push(n),r.camera!==void 0&&o.push(s.getDependency("camera",r.camera).then(function(h){return s._getNodeRef(s.cameraCache,r.camera,h)})),s._invokeAll(function(h){return h.createNodeAttachment&&h.createNodeAttachment(e)}).forEach(function(h){o.push(h)}),this.nodeCache[e]=Promise.all(o).then(function(h){let u;if(r.isBone===!0?u=new vc:h.length>1?u=new js:h.length===1?u=h[0]:u=new yo,u!==h[0])for(let c=0,p=h.length;c<p;c++)u.add(h[c]);if(r.name&&(u.userData.name=r.name,u.name=a),Ne(u,r),r.extensions&&ut(i,u,r),r.matrix!==void 0){let c=new bi;c.fromArray(r.matrix),u.applyMatrix4(c)}else r.translation!==void 0&&u.position.fromArray(r.translation),r.rotation!==void 0&&u.quaternion.fromArray(r.rotation),r.scale!==void 0&&u.scale.fromArray(r.scale);return s.associations.has(u)||s.associations.set(u,{}),s.associations.get(u).nodes=e,u}),this.nodeCache[e]}loadScene(e){let t=this.extensions,i=this.json.scenes[e],s=this,r=new js;i.name&&(r.name=s.createUniqueName(i.name)),Ne(r,i),i.extensions&&ut(t,r,i);let a=i.nodes||[],o=[];for(let n=0,h=a.length;n<h;n++)o.push(s.getDependency("node",a[n]));return Promise.all(o).then(function(n){for(let u=0,c=n.length;u<c;u++)r.add(n[u]);let h=u=>{let c=new Map;for(let[p,d]of s.associations)(p instanceof Ks||p instanceof co)&&c.set(p,d);return u.traverse(p=>{let d=s.associations.get(p);d!=null&&c.set(p,d)}),c};return s.associations=h(r),r})}_createAnimationTracks(e,t,i,s,r){let a=[],o=e.name?e.name:e.uuid,n=[];it[r.path]===it.weights?e.traverse(function(p){p.morphTargetInfluences&&n.push(p.name?p.name:p.uuid)}):n.push(o);let h;switch(it[r.path]){case it.weights:h=lo;break;case it.rotation:h=ho;break;case it.position:case it.scale:h=uo;break;default:switch(i.itemSize){case 1:h=lo;break;case 2:case 3:default:h=uo;break}break}let u=s.interpolation!==void 0?ru[s.interpolation]:vo,c=this._getArrayFromAccessor(i);for(let p=0,d=n.length;p<d;p++){let g=new h(n[p]+"."+it[r.path],t.array,c,u);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(g),a.push(g)}return a}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){let i=br(t.constructor),s=new Float32Array(t.length);for(let r=0,a=t.length;r<a;r++)s[r]=t[r]*i;t=s}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(i){let s=this instanceof ho?xr:yi;return new s(this.times,this.values,this.getValueSize()/3,i)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}};function uu(l,e,t){let i=e.attributes,s=new xc;if(i.POSITION!==void 0){let o=t.json.accessors[i.POSITION],n=o.min,h=o.max;if(n!==void 0&&h!==void 0){if(s.set(new xt(n[0],n[1],n[2]),new xt(h[0],h[1],h[2])),o.normalized){let u=br(Ct[o.componentType]);s.min.multiplyScalar(u),s.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;let r=e.targets;if(r!==void 0){let o=new xt,n=new xt;for(let h=0,u=r.length;h<u;h++){let c=r[h];if(c.POSITION!==void 0){let p=t.json.accessors[c.POSITION],d=p.min,g=p.max;if(d!==void 0&&g!==void 0){if(n.setX(Math.max(Math.abs(d[0]),Math.abs(g[0]))),n.setY(Math.max(Math.abs(d[1]),Math.abs(g[1]))),n.setZ(Math.max(Math.abs(d[2]),Math.abs(g[2]))),p.normalized){let m=br(Ct[p.componentType]);n.multiplyScalar(m)}o.max(n)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(o)}l.boundingBox=s;let a=new Xc;s.getCenter(a.center),a.radius=s.min.distanceTo(s.max)/2,l.boundingSphere=a}function mo(l,e,t){let i=e.attributes,s=[];function r(a,o){return t.getDependency("accessor",a).then(function(n){l.setAttribute(o,n)})}for(let a in i){let o=Cr[a]||a.toLowerCase();o in l.attributes||s.push(r(i[a],o))}if(e.indices!==void 0&&!l.index){let a=t.getDependency("accessor",e.indices).then(function(o){l.setIndex(o)});s.push(a)}return no.workingColorSpace!==Ve&&"COLOR_0"in i&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${no.workingColorSpace}" not supported.`),Ne(l,e),uu(l,e,t),Promise.all(s).then(function(){return e.targets!==void 0?ou(l,e.targets,t):l})}import{BufferAttribute as wo,BufferGeometry as pu,Color as Au,ColorManagement as du,FileLoader as So,Loader as fu,LinearSRGBColorSpace as mu,SRGBColorSpace as Er}from"three";var Ir=new WeakMap,yt=class extends fu{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,s){let r=new So(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,a=>{this.parse(a,t,s)},i,s)}parse(e,t,i=()=>{}){this.decodeDracoFile(e,t,null,null,Er,i).catch(i)}decodeDracoFile(e,t,i,s,r=mu,a=()=>{}){let o={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!i,vertexColorSpace:r};return this.decodeGeometry(e,o).then(t).catch(a)}decodeGeometry(e,t){let i=JSON.stringify(t);if(Ir.has(e)){let n=Ir.get(e);if(n.key===i)return n.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s,r=this.workerNextTaskID++,a=e.byteLength,o=this._getWorker(r,a).then(n=>(s=n,new Promise((h,u)=>{s._callbacks[r]={resolve:h,reject:u},s.postMessage({type:"decode",id:r,taskConfig:t,buffer:e},[e])}))).then(n=>this._createGeometry(n.geometry));return o.catch(()=>!0).then(()=>{s&&r&&this._releaseTask(s,r)}),Ir.set(e,{key:i,promise:o}),o}_createGeometry(e){let t=new pu;e.index&&t.setIndex(new wo(e.index.array,1));for(let i=0;i<e.attributes.length;i++){let s=e.attributes[i],r=s.name,a=s.array,o=s.itemSize,n=new wo(a,o);r==="color"&&(this._assignVertexColorSpace(n,s.vertexColorSpace),n.normalized=!(a instanceof Float32Array)),t.setAttribute(r,n)}return t}_assignVertexColorSpace(e,t){if(t!==Er)return;let i=new Au;for(let s=0,r=e.count;s<r;s++)i.fromBufferAttribute(e,s),du.toWorkingColorSpace(i,Er),e.setXYZ(s,i.r,i.g,i.b)}_loadLibrary(e,t){let i=new So(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((s,r)=>{i.load(e,s,void 0,r)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{let s=i[0];e||(this.decoderConfig.wasmBinary=i[1]);let r=gu.toString(),a=["/* draco decoder */",s,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([a]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){let s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(r){let a=r.data;switch(a.type){case"decode":s._callbacks[a.id].resolve(a);break;case"error":s._callbacks[a.id].reject(a);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+a.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,r){return s._taskLoad>r._taskLoad?-1:1});let i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}};function gu(){let l,e;onmessage=function(a){let o=a.data;switch(o.type){case"init":l=o.decoderConfig,e=new Promise(function(u){l.onModuleLoaded=function(c){u({draco:c})},DracoDecoderModule(l)});break;case"decode":let n=o.buffer,h=o.taskConfig;e.then(u=>{let c=u.draco,p=new c.Decoder;try{let d=t(c,p,new Int8Array(n),h),g=d.attributes.map(m=>m.array.buffer);d.index&&g.push(d.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:d},g)}catch(d){console.error(d),self.postMessage({type:"error",id:o.id,error:d.message})}finally{c.destroy(p)}});break}};function t(a,o,n,h){let u=h.attributeIDs,c=h.attributeTypes,p,d,g=o.GetEncodedGeometryType(n);if(g===a.TRIANGULAR_MESH)p=new a.Mesh,d=o.DecodeArrayToMesh(n,n.byteLength,p);else if(g===a.POINT_CLOUD)p=new a.PointCloud,d=o.DecodeArrayToPointCloud(n,n.byteLength,p);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!d.ok()||p.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+d.error_msg());let m={index:null,attributes:[]};for(let A in u){let f=self[c[A]],C,v;if(h.useUniqueIDs)v=u[A],C=o.GetAttributeByUniqueId(p,v);else{if(v=o.GetAttributeId(p,a[u[A]]),v===-1)continue;C=o.GetAttribute(p,v)}let x=s(a,o,p,A,f,C);A==="color"&&(x.vertexColorSpace=h.vertexColorSpace),m.attributes.push(x)}return g===a.TRIANGULAR_MESH&&(m.index=i(a,o,p)),a.destroy(p),m}function i(a,o,n){let u=n.num_faces()*3,c=u*4,p=a._malloc(c);o.GetTrianglesUInt32Array(n,c,p);let d=new Uint32Array(a.HEAPF32.buffer,p,u).slice();return a._free(p),{array:d,itemSize:1}}function s(a,o,n,h,u,c){let p=c.num_components(),g=n.num_points()*p,m=g*u.BYTES_PER_ELEMENT,A=r(a,u),f=a._malloc(m);o.GetAttributeDataArrayForAllPoints(n,c,A,m,f);let C=new u(a.HEAPF32.buffer,f,g).slice();return a._free(f),{name:h,array:C,itemSize:p}}function r(a,o){switch(o){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}import{CompressedTexture as Jo,CompressedArrayTexture as Iu,CompressedCubeTexture as Bu,Data3DTexture as wu,DataTexture as Su,FileLoader as Rr,FloatType as Wt,HalfFloatType as Et,NoColorSpace as Qo,LinearFilter as Bi,LinearMipmapLinearFilter as Zo,LinearSRGBColorSpace as Du,Loader as Ru,RedFormat as Kt,RGB_BPTC_UNSIGNED_Format as Tu,RGB_ETC1_Format as Pu,RGB_ETC2_Format as Mu,RGB_PVRTC_4BPPV1_Format as Lu,RGBA_ASTC_4x4_Format as $o,RGBA_ASTC_6x6_Format as _o,RGBA_BPTC_Format as ku,RGBA_ETC2_EAC_Format as Qu,RGBA_PVRTC_4BPPV1_Format as _u,RGBA_S3TC_DXT5_Format as Fu,RGBA_S3TC_DXT1_Format as Ou,RGBAFormat as It,RGFormat as zt,SRGBColorSpace as Uu,UnsignedByteType as je}from"three";var Ei=class{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){let t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){let i=this.workersResolve[e];if(i&&i(t),this.queue.length){let{resolve:s,msg:r,transfer:a}=this.queue.shift();this.workersResolve[e]=s,this.workers[e].postMessage(r,a)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(i=>{let s=this._getIdleWorker();s!==-1?(this._initWorker(s),this.workerStatus|=1<<s,this.workersResolve[s]=i,this.workers[s].postMessage(e,t)):this.queue.push({resolve:i,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}};var Br=class{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}},At=class{constructor(e,t,i,s){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,i),this._littleEndian=s,this._offset=0}_nextUint8(){let e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){let e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){let e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){let e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){let e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){let t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t){t===void 0&&(t=0);let i=this._offset,s=0;for(;this._dataView.getUint8(this._offset)!==t&&s<e;)s++,this._offset++;return s<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+i,s)}},Wd=new Uint8Array([0]),fe=[171,75,84,88,32,50,48,187,13,10,26,10];function Do(l){return new TextDecoder().decode(l)}function Ro(l){let e=new Uint8Array(l.buffer,l.byteOffset,fe.length);if(e[0]!==fe[0]||e[1]!==fe[1]||e[2]!==fe[2]||e[3]!==fe[3]||e[4]!==fe[4]||e[5]!==fe[5]||e[6]!==fe[6]||e[7]!==fe[7]||e[8]!==fe[8]||e[9]!==fe[9]||e[10]!==fe[10]||e[11]!==fe[11])throw new Error("Missing KTX 2.0 identifier.");let t=new Br,i=17*Uint32Array.BYTES_PER_ELEMENT,s=new At(l,fe.length,i,!0);t.vkFormat=s._nextUint32(),t.typeSize=s._nextUint32(),t.pixelWidth=s._nextUint32(),t.pixelHeight=s._nextUint32(),t.pixelDepth=s._nextUint32(),t.layerCount=s._nextUint32(),t.faceCount=s._nextUint32();let r=s._nextUint32();t.supercompressionScheme=s._nextUint32();let a=s._nextUint32(),o=s._nextUint32(),n=s._nextUint32(),h=s._nextUint32(),u=s._nextUint64(),c=s._nextUint64(),p=new At(l,fe.length+i,3*r*8,!0);for(let L=0;L<r;L++)t.levels.push({levelData:new Uint8Array(l.buffer,l.byteOffset+p._nextUint64(),p._nextUint64()),uncompressedByteLength:p._nextUint64()});let d=new At(l,a,o,!0),g={vendorId:d._skip(4)._nextUint16(),descriptorType:d._nextUint16(),versionNumber:d._nextUint16(),descriptorBlockSize:d._nextUint16(),colorModel:d._nextUint8(),colorPrimaries:d._nextUint8(),transferFunction:d._nextUint8(),flags:d._nextUint8(),texelBlockDimension:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],bytesPlane:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],samples:[]},m=(g.descriptorBlockSize/4-6)/4;for(let L=0;L<m;L++){let H={bitOffset:d._nextUint16(),bitLength:d._nextUint8(),channelType:d._nextUint8(),samplePosition:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&H.channelType?(H.sampleLower=d._nextInt32(),H.sampleUpper=d._nextInt32()):(H.sampleLower=d._nextUint32(),H.sampleUpper=d._nextUint32()),g.samples[L]=H}t.dataFormatDescriptor.length=0,t.dataFormatDescriptor.push(g);let A=new At(l,n,h,!0);for(;A._offset<h;){let L=A._nextUint32(),H=A._scan(L),k=Do(H);if(t.keyValue[k]=A._nextUint8Array(L-H.byteLength-1),k.match(/^ktx/i)){let Q=Do(t.keyValue[k]);t.keyValue[k]=Q.substring(0,Q.lastIndexOf("\0"))}A._skip(L%4?4-L%4:0)}if(c<=0)return t;let f=new At(l,u,c,!0),C=f._nextUint16(),v=f._nextUint16(),x=f._nextUint32(),b=f._nextUint32(),I=f._nextUint32(),E=f._nextUint32(),B=[];for(let L=0;L<r;L++)B.push({imageFlags:f._nextUint32(),rgbSliceByteOffset:f._nextUint32(),rgbSliceByteLength:f._nextUint32(),alphaSliceByteOffset:f._nextUint32(),alphaSliceByteLength:f._nextUint32()});let w=u+f._offset,D=w+x,S=D+b,P=S+I,F=new Uint8Array(l.buffer,l.byteOffset+w,x),O=new Uint8Array(l.buffer,l.byteOffset+D,b),N=new Uint8Array(l.buffer,l.byteOffset+S,I),M=new Uint8Array(l.buffer,l.byteOffset+P,E);return t.globalData={endpointCount:C,selectorCount:v,imageDescs:B,endpointsData:F,selectorsData:O,tablesData:N,extendedData:M},t}var wr,He,Dr,Sr={env:{emscripten_notify_memory_growth:function(l){Dr=new Uint8Array(He.exports.memory.buffer)}}},Ii=class{init(){return wr||(wr=typeof fetch!="undefined"?fetch("data:application/wasm;base64,"+To).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,Sr)).then(this._init):WebAssembly.instantiate(Buffer.from(To,"base64"),Sr).then(this._init),wr)}_init(e){He=e.instance,Sr.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!He)throw new Error("ZSTDDecoder: Await .init() before decoding.");let i=e.byteLength,s=He.exports.malloc(i);Dr.set(e,s),t=t||Number(He.exports.ZSTD_findDecompressedSize(s,i));let r=He.exports.malloc(t),a=He.exports.ZSTD_decompress(r,t,s,i),o=Dr.slice(r,r+a);return He.exports.free(s),He.exports.free(r),o}},To="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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";import{LinearTransfer as Zd,Matrix3 as $d,SRGBTransfer as ef}from"three";var Po="display-p3",Mo="display-p3-linear";var Tr=new WeakMap,Pr=0,Mr,Pe=class l extends Ru{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new Ei,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER!="undefined"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}async detectSupportAsync(e){return this.workerConfig={astcSupported:await e.hasFeatureAsync("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:await e.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await e.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await e.hasFeatureAsync("texture-compression-bc"),bptcSupported:await e.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await e.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(e){return e.isWebGPURenderer===!0?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:e.hasFeature("texture-compression-etc1"),etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:e.hasFeature("texture-compression-bptc"),pvrtcSupported:e.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),astcHDRSupported:e.extensions.has("WEBGL_compressed_texture_astc")&&e.extensions.get("WEBGL_compressed_texture_astc").getSupportedProfiles().includes("hdr"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){let e=new Rr(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);let t=e.loadAsync("basis_transcoder.js"),i=new Rr(this.manager);i.setPath(this.transcoderPath),i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);let s=i.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,s]).then(([r,a])=>{let o=l.BasisWorker.toString(),n=["/* constants */","let _EngineFormat = "+JSON.stringify(l.EngineFormat),"let _EngineType = "+JSON.stringify(l.EngineType),"let _TranscoderFormat = "+JSON.stringify(l.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(l.BasisFormat),"/* basis_transcoder.js */",r,"/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([n])),this.transcoderBinary=a,this.workerPool.setWorkerCreator(()=>{let h=new Worker(this.workerSourceURL),u=this.transcoderBinary.slice(0);return h.postMessage({type:"init",config:this.workerConfig,transcoderBinary:u},[u]),h})}),Pr>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),Pr++}return this.transcoderPending}load(e,t,i,s){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");let r=new Rr(this.manager);r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials),r.load(e,a=>{this.parse(a,t,s)},i,s)}parse(e,t,i){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");if(Tr.has(e))return Tr.get(e).promise.then(t).catch(i);this._createTexture(e).then(s=>t?t(s):null).catch(i)}_createTextureFrom(e,t){let{type:i,error:s,data:{faces:r,width:a,height:o,format:n,type:h,dfdFlags:u}}=e;if(i==="error")return Promise.reject(s);let c;if(t.faceCount===6)c=new Bu(r,n,h);else{let p=r[0].mipmaps;c=t.layerCount>1?new Iu(p,a,o,t.layerCount,n,h):new Jo(p,a,o,n,h)}return c.minFilter=r[0].mipmaps.length===1?Bi:Zo,c.magFilter=Bi,c.generateMipmaps=!1,c.needsUpdate=!0,c.colorSpace=en(t),c.premultiplyAlpha=!!(u&1),c}async _createTexture(e,t={}){let i=Ro(new Uint8Array(e)),s=i.vkFormat===1000066e3&&i.dataFormatDescriptor[0].colorModel===167;if(!(i.vkFormat===0||s&&!this.workerConfig.astcHDRSupported))return Nu(i);let a=t,o=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:a},[e])).then(n=>this._createTextureFrom(n.data,i));return Tr.set(e,{promise:o}),o}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),Pr--,this}};Pe.BasisFormat={ETC1S:0,UASTC:1,UASTC_HDR:2};Pe.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16,BC6H:22,RGB_HALF:24,RGBA_HALF:25};Pe.EngineFormat={RGBAFormat:It,RGBA_ASTC_4x4_Format:$o,RGB_BPTC_UNSIGNED_Format:Tu,RGBA_BPTC_Format:ku,RGBA_ETC2_EAC_Format:Qu,RGBA_PVRTC_4BPPV1_Format:_u,RGBA_S3TC_DXT5_Format:Fu,RGB_ETC1_Format:Pu,RGB_ETC2_Format:Mu,RGB_PVRTC_4BPPV1_Format:Lu,RGBA_S3TC_DXT1_Format:Ou};Pe.EngineType={UnsignedByteType:je,HalfFloatType:Et,FloatType:Wt};Pe.BasisWorker=function(){let l,e,t,i=_EngineFormat,s=_EngineType,r=_TranscoderFormat,a=_BasisFormat;self.addEventListener("message",function(g){let m=g.data;switch(m.type){case"init":l=m.config,o(m.transcoderBinary);break;case"transcode":e.then(()=>{try{let{faces:A,buffers:f,width:C,height:v,hasAlpha:x,format:b,type:I,dfdFlags:E}=n(m.buffer);self.postMessage({type:"transcode",id:m.id,data:{faces:A,width:C,height:v,hasAlpha:x,format:b,type:I,dfdFlags:E}},f)}catch(A){console.error(A),self.postMessage({type:"error",id:m.id,error:A.message})}});break}});function o(g){e=new Promise(m=>{t={wasmBinary:g,onRuntimeInitialized:m},BASIS(t)}).then(()=>{t.initializeBasis(),t.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function n(g){let m=new t.KTX2File(new Uint8Array(g));function A(){m.close(),m.delete()}if(!m.isValid())throw A(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");let f;if(m.isUASTC())f=a.UASTC;else if(m.isETC1S())f=a.ETC1S;else if(m.isHDR())f=a.UASTC_HDR;else throw new Error("THREE.KTX2Loader: Unknown Basis encoding");let C=m.getWidth(),v=m.getHeight(),x=m.getLayers()||1,b=m.getLevels(),I=m.getFaces(),E=m.getHasAlpha(),B=m.getDFDFlags(),{transcoderFormat:w,engineFormat:D,engineType:S}=c(f,C,v,E);if(!C||!v||!b)throw A(),new Error("THREE.KTX2Loader:	Invalid texture");if(!m.startTranscoding())throw A(),new Error("THREE.KTX2Loader: .startTranscoding failed");let P=[],F=[];for(let O=0;O<I;O++){let N=[];for(let M=0;M<b;M++){let L=[],H,k;for(let K=0;K<x;K++){let Y=m.getImageLevelInfo(M,K,O);O===0&&M===0&&K===0&&(Y.origWidth%4!==0||Y.origHeight%4!==0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),b>1?(H=Y.origWidth,k=Y.origHeight):(H=Y.width,k=Y.height);let _=new Uint8Array(m.getImageTranscodedSizeInBytes(M,K,0,w)),$=m.transcodeImage(_,M,K,O,w,0,-1,-1);if(S===s.HalfFloatType&&(_=new Uint16Array(_.buffer,_.byteOffset,_.byteLength/Uint16Array.BYTES_PER_ELEMENT)),!$)throw A(),new Error("THREE.KTX2Loader: .transcodeImage failed.");L.push(_)}let Q=d(L);N.push({data:Q,width:H,height:k}),F.push(Q.buffer)}P.push({mipmaps:N,width:C,height:v,format:D,type:S})}return A(),{faces:P,buffers:F,width:C,height:v,hasAlpha:E,dfdFlags:B,format:D,type:S}}let h=[{if:"astcSupported",basisFormat:[a.UASTC],transcoderFormat:[r.ASTC_4x4,r.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],engineType:[s.UnsignedByteType],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[a.ETC1S,a.UASTC],transcoderFormat:[r.BC7_M5,r.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],engineType:[s.UnsignedByteType],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[a.ETC1S,a.UASTC],transcoderFormat:[r.BC1,r.BC3],engineFormat:[i.RGBA_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],engineType:[s.UnsignedByteType],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[a.ETC1S,a.UASTC],transcoderFormat:[r.ETC1,r.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],engineType:[s.UnsignedByteType],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[a.ETC1S,a.UASTC],transcoderFormat:[r.ETC1],engineFormat:[i.RGB_ETC1_Format],engineType:[s.UnsignedByteType],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[a.ETC1S,a.UASTC],transcoderFormat:[r.PVRTC1_4_RGB,r.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],engineType:[s.UnsignedByteType],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0},{if:"bptcSupported",basisFormat:[a.UASTC_HDR],transcoderFormat:[r.BC6H],engineFormat:[i.RGB_BPTC_UNSIGNED_Format],engineType:[s.HalfFloatType],priorityHDR:1,needsPowerOfTwo:!1},{basisFormat:[a.ETC1S,a.UASTC],transcoderFormat:[r.RGBA32,r.RGBA32],engineFormat:[i.RGBAFormat,i.RGBAFormat],engineType:[s.UnsignedByteType,s.UnsignedByteType],priorityETC1S:100,priorityUASTC:100,needsPowerOfTwo:!1},{basisFormat:[a.UASTC_HDR],transcoderFormat:[r.RGBA_HALF],engineFormat:[i.RGBAFormat],engineType:[s.HalfFloatType],priorityHDR:100,needsPowerOfTwo:!1}],u={[a.ETC1S]:h.filter(g=>g.basisFormat.includes(a.ETC1S)).sort((g,m)=>g.priorityUASTC-m.priorityUASTC),[a.UASTC]:h.filter(g=>g.basisFormat.includes(a.UASTC)).sort((g,m)=>g.priorityUASTC-m.priorityUASTC),[a.UASTC_HDR]:h.filter(g=>g.basisFormat.includes(a.UASTC_HDR)).sort((g,m)=>g.priorityHDR-m.priorityHDR)};function c(g,m,A,f){let C=u[g];for(let v=0;v<C.length;v++){let x=C[v];if(x.if&&!l[x.if]||!x.basisFormat.includes(g)||f&&x.transcoderFormat.length<2||x.needsPowerOfTwo&&!(p(m)&&p(A)))continue;let b=x.transcoderFormat[f?1:0],I=x.engineFormat[f?1:0],E=x.engineType[0];return{transcoderFormat:b,engineFormat:I,engineType:E}}throw new Error("THREE.KTX2Loader: Failed to identify transcoding target.")}function p(g){return g<=2?!0:(g&g-1)===0&&g!==0}function d(g){if(g.length===1)return g[0];let m=0;for(let C=0;C<g.length;C++){let v=g[C];m+=v.byteLength}let A=new Uint8Array(m),f=0;for(let C=0;C<g.length;C++){let v=g[C];A.set(v,f),f+=v.byteLength}return A}};var Gu=new Set([It,zt,Kt]),Lr={[109]:It,[97]:It,[37]:It,[43]:It,[103]:zt,[83]:zt,[16]:zt,[22]:zt,[100]:Kt,[76]:Kt,[15]:Kt,[9]:Kt,[1000066e3]:$o,[166]:_o,[165]:_o},kr={[109]:Wt,[97]:Et,[37]:je,[43]:je,[103]:Wt,[83]:Et,[16]:je,[22]:je,[100]:Wt,[76]:Et,[15]:je,[9]:je,[1000066e3]:Et,[166]:je,[165]:je};async function Nu(l){let{vkFormat:e}=l;if(Lr[e]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let t;l.supercompressionScheme===2&&(Mr||(Mr=new Promise(async r=>{let a=new Ii;await a.init(),r(a)})),t=await Mr);let i=[];for(let r=0;r<l.levels.length;r++){let a=Math.max(1,l.pixelWidth>>r),o=Math.max(1,l.pixelHeight>>r),n=l.pixelDepth?Math.max(1,l.pixelDepth>>r):0,h=l.levels[r],u;if(l.supercompressionScheme===0)u=h.levelData;else if(l.supercompressionScheme===2)u=t.decode(h.levelData,h.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");let c;kr[e]===Wt?c=new Float32Array(u.buffer,u.byteOffset,u.byteLength/Float32Array.BYTES_PER_ELEMENT):kr[e]===Et?c=new Uint16Array(u.buffer,u.byteOffset,u.byteLength/Uint16Array.BYTES_PER_ELEMENT):c=u,i.push({data:c,width:a,height:o,depth:n})}let s;if(Gu.has(Lr[e]))s=l.pixelDepth===0?new Su(i[0].data,l.pixelWidth,l.pixelHeight):new wu(i[0].data,l.pixelWidth,l.pixelHeight,l.pixelDepth);else{if(l.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");s=new Jo(i,l.pixelWidth,l.pixelHeight),s.minFilter=i.length===1?Bi:Zo,s.magFilter=Bi}return s.mipmaps=i,s.type=kr[e],s.format=Lr[e],s.colorSpace=en(l),s.needsUpdate=!0,Promise.resolve(s)}function en(l){let e=l.dataFormatDescriptor[0];return e.colorPrimaries===1?e.transferFunction===2?Uu:Du:e.colorPrimaries===10?e.transferFunction===2?Po:Mo:e.colorPrimaries===0?Qo:(console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${e.colorPrimaries}"`),Qo)}var wi=function(){"use strict";var l="b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:P8Yqdbk;3sezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhDcbhqinaqae9pmeaDaeaq9RaqaDfae6Egkcsfgocl4cifcd4hxdndndndnaoc9WGgmTmbcbhPcehsawcjdfhzalhHinaraH9Rax6midnaraHaxfgl9RcK6mbczhoinawcj;cbfaogifgoc9WfhOdndndndndnaHaic9WfgAco4fRbbaAci4coG4ciGPlbedibkaO9cb83ibaOcwf9cb83ibxikaOalRblalRbbgAco4gCaCciSgCE86bbaocGfalclfaCfgORbbaAcl4ciGgCaCciSgCE86bbaocVfaOaCfgORbbaAcd4ciGgCaCciSgCE86bbaoc7faOaCfgORbbaAciGgAaAciSgAE86bbaoctfaOaAfgARbbalRbegOco4gCaCciSgCE86bbaoc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc93faAaCfgARbbaOciGgOaOciSgOE86bbaoc94faAaOfgARbbalRbdgOco4gCaCciSgCE86bbaoc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc97faAaCfgARbbaOciGgOaOciSgOE86bbaoc98faAaOfgORbbalRbiglco4gAaAciSgAE86bbaoc99faOaAfgORbbalcl4ciGgAaAciSgAE86bbaoc9:faOaAfgORbbalcd4ciGgAaAciSgAE86bbaocufaOaAfgoRbbalciGglalciSglE86bbaoalfhlxdkaOalRbwalRbbgAcl4gCaCcsSgCE86bbaocGfalcwfaCfgORbbaAcsGgAaAcsSgAE86bbaocVfaOaAfgORbbalRbegAcl4gCaCcsSgCE86bbaoc7faOaCfgORbbaAcsGgAaAcsSgAE86bbaoctfaOaAfgORbbalRbdgAcl4gCaCcsSgCE86bbaoc91faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc4faOaAfgORbbalRbigAcl4gCaCcsSgCE86bbaoc93faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc94faOaAfgORbbalRblgAcl4gCaCcsSgCE86bbaoc95faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc96faOaAfgORbbalRbvgAcl4gCaCcsSgCE86bbaoc97faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc98faOaAfgORbbalRbogAcl4gCaCcsSgCE86bbaoc99faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc9:faOaAfgORbbalRbrglcl4gAaAcsSgAE86bbaocufaOaAfgoRbbalcsGglalcsSglE86bbaoalfhlxekaOal8Pbb83bbaOcwfalcwf8Pbb83bbalczfhlkdnaiam9pmbaiczfhoaral9RcL0mekkaiam6mialTmidnakTmbawaPfRbbhOcbhoazhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkkazcefhzaPcefgPad6hsalhHaPad9hmexvkkcbhlasceGmdxikalaxad2fhCdnakTmbcbhHcehsawcjdfhminaral9Rax6mialTmdalaxfhlawaHfRbbhOcbhoamhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkamcefhmaHcefgHad6hsaHad9hmbkaChlxikcbhocehsinaral9Rax6mdalTmealaxfhlaocefgoad6hsadao9hmbkaChlxdkcbhlasceGTmekc9:hoxikabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqalmbkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;ebf8Kjjjjbaok;yzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;siliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabavcefciGaiVcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:Ohkxekcjjjj94hkkabavcdfciGaiVcetfak87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:Ohqxekcjjjj94hqkabavcufciGaiVcetfaq87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohqxekcjjjj94hqkabavciGaiVcetfaq87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2geTmbinababydbgdcwtcw91:Yadce91cjjj;8ifcjjj98G::NUdbabclfhbaecufgembkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaiczfhiaeczfheadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",e="b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;t9tqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk;h8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhwcbhDinaDae9pmeawaeaD9RaDawfae6Egqcsfgoc9WGgkci2hxakcethmaocl4cifcd4hPabaDad2fhscbhzdnincehHalhOcbhAdninaraO9RaP6miavcj;cbfaAak2fhCaOaPfhlcbhidnakc;ab6mbaral9Rc;Gb6mbcbhoinaCaofhidndndndndnaOaoco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklbalczfhlkdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklzalczfhlkdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklaalczfhlkdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalclfaYpQbfaXc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalcwfaYpQbfaXc:q:yjjbfRbbfhlxekaialpbbbpkl8Walczfhlkaoc;abfhiaocjefak0meaihoaral9Rc;Fb0mbkkdndnaiak9pmbaici4hoinaral9RcK6mdaCaifhXdndndndndnaOaico4fRbbaocoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpklbxikaXalpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaXalpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaXalpbbbpklbalczfhlkaocdfhoaiczfgiak6mbkkalTmbaAci6hHalhOaAcefgohAaoclSmdxekkcbhlaHceGmdkdnakTmbavcjdfazfhiavazfpbdbhYcbhXinaiavcj;cbfaXfgopblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLaoakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEaoamfpblbg3cep9Ta3aQp9op9Hp9rg3aoaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfhiaXczfgXak6mbkkazclfgzad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfhDc9:hoalmexikkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk;uzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:EPliuo97eue978Jjjjjbca9Rhidndnadcl9hmbdnaec98GglTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalae9pmeaiaeciGgvcdtgdVcbczad9R;8kbaiabalcdtfglad;8qbbdnavTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkalaiad;8qbbskdnaec98GgxTmbcbhvabhdinadczfglalpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oawaopmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgvax6mbkkaxae9pmbaiaeciGgvcitgdfcbcaad9R;8kbaiabaxcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oawaopmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalae9pmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbhdabheinaeaepbbbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepkbbaeczfheadclfgdav6mbkkdnaval9pmbaialciGgdcdtgeVcbc;abae9R;8kbaiabavcdtfgvae;8qbbdnadTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepklbkavaiae;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb",t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),i=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if(typeof WebAssembly!="object")return{supported:!1};var s=WebAssembly.validate(t)?e:l,r,a=WebAssembly.instantiate(o(s),{}).then(function(f){r=f.instance,r.exports.__wasm_call_ctors()});function o(f){for(var C=new Uint8Array(f.length),v=0;v<f.length;++v){var x=f.charCodeAt(v);C[v]=x>96?x-97:x>64?x-39:x+4}for(var b=0,v=0;v<f.length;++v)C[b++]=C[v]<60?i[C[v]]:(C[v]-60)*64+C[++v];return C.buffer.slice(0,b)}function n(f,C,v,x,b,I){var E=r.exports.sbrk,B=v+3&-4,w=E(B*x),D=E(b.length),S=new Uint8Array(r.exports.memory.buffer);S.set(b,D);var P=f(w,v,x,D,b.length);if(P==0&&I&&I(w,B,x),C.set(S.subarray(w,w+v*x)),E(w-E(0)),P!=0)throw new Error("Malformed buffer data: "+P)}var h={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},u={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},c=[],p=0;function d(f){var C={object:new Worker(f),pending:0,requests:{}};return C.object.onmessage=function(v){var x=v.data;C.pending-=x.count,C.requests[x.id][x.action](x.value),delete C.requests[x.id]},C}function g(f){for(var C="var instance; var ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(o(s))+"]), {}).then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });self.onmessage = workerProcess;"+n.toString()+A.toString(),v=new Blob([C],{type:"text/javascript"}),x=URL.createObjectURL(v),b=0;b<f;++b)c[b]=d(x);URL.revokeObjectURL(x)}function m(f,C,v,x,b){for(var I=c[0],E=1;E<c.length;++E)c[E].pending<I.pending&&(I=c[E]);return new Promise(function(B,w){var D=new Uint8Array(v),S=p++;I.pending+=f,I.requests[S]={resolve:B,reject:w},I.object.postMessage({id:S,count:f,size:C,source:D,mode:x,filter:b},[D.buffer])})}function A(f){a.then(function(){var C=f.data;try{var v=new Uint8Array(C.count*C.size);n(r.exports[C.mode],v,C.count,C.size,C.source,r.exports[C.filter]),self.postMessage({id:C.id,count:C.count,action:"resolve",value:v},[v.buffer])}catch(x){self.postMessage({id:C.id,count:C.count,action:"reject",value:x})}})}return{ready:a,supported:!0,useWorkers:function(f){g(f)},decodeVertexBuffer:function(f,C,v,x,b){n(r.exports.meshopt_decodeVertexBuffer,f,C,v,x,r.exports[h[b]])},decodeIndexBuffer:function(f,C,v,x){n(r.exports.meshopt_decodeIndexBuffer,f,C,v,x)},decodeIndexSequence:function(f,C,v,x){n(r.exports.meshopt_decodeIndexSequence,f,C,v,x)},decodeGltfBuffer:function(f,C,v,x,b,I){n(r.exports[u[b]],f,C,v,x,r.exports[h[I]])},decodeGltfBufferAsync:function(f,C,v,x,b){return c.length>0?m(f,C,v,u[x],h[b]):a.then(function(){var I=new Uint8Array(f*C);return n(r.exports[u[x]],I,f,C,v,r.exports[h[b]]),I})}}}();import{Vector2 as tn,Vector3 as Vu,ImageLoader as Hu,Texture as ju,VideoTexture as Ku,CanvasTexture as zu,LinearFilter as sn,AlphaFormat as Wu,RedFormat as qu,RGBAFormat as Yu,RGFormat as Xu,RGBFormat as rn,DepthFormat as Ju,MeshBasicMaterial as Zu}from"three";var Si=class{constructor(e="images/assets/",t){this.assetRoot=e,this.mobile=t,this.pxlTimer=null,this.pxlEnums=null,this.verboseLoading=!1,this.texLoader=new Hu,this.textLoaderArray=[],this.channelFormats=[Wu,qu,Xu,rn,Yu,Ju]}get curMS(){return this.pxlTimer.curMS}setDependencies(e){this.pxlTimer=e.pxlTimer,this.pxlEnums=e.pxlEnums}updateUrl(e,t={},i=""){window.history.replaceState?window.history.replaceState(t,i,e):window.history.pushState(t,i,e)}copyRoomUrl(){let e=window.location,t=document.activeElement,i=document.createElement("textarea");i.value=e,document.body.appendChild(i),i.focus(),i.select();let s=!1;try{s=document.execCommand("copy")?"successful":"unsuccessful"}catch(r){}return document.body.removeChild(i),t.focus(),s}checkInt(e){return e%1===0}degToRad(e){return e*(Math.PI/180)}toHundreths(e){if(!e)return 0;if(Number.isInteger(e))return e;{let t=(e+"").split(".");return parseFloat(t[0]+"."+t[1].substr(0,2))}}toTenths(e){if(!e)return 0;if(Number.isInteger(e))return e;{let t=(e+"").split(".");return parseFloat(t[0]+"."+t[1].substr(0,1))}}getDateTime(){let e=new Date,t=(e.getFullYear()+"").padStart(2,"0")+"-"+(e.getMonth()+1+"").padStart(2,"0")+"-"+(e.getDate()+"").padStart(2,"0"),i=(e.getHours()+"").padStart(2,"0")+":"+(e.getMinutes()+"").padStart(2,"0")+":"+(e.getSeconds()+"").padStart(2,"0");return[t,i]}cleanStrict(e){let t=document.createElement("div");t.innerHTML=e,t=t.innerText;let i=t.match(/([a-zA-Z0-9])\w+/g);return i&&(t=i.join(" ")),t}cleanBasic(e){let t=document.createElement("div");t.innerHTML=e,t=t.innerText;let i=t.match(/([a-zA-Z0-9\s\w-+()[\]])+/g);return i&&(t=i.join("")),t}cleanString(e){let t=document.createElement("div");return t.innerHTML=e,t=t.innerText,t}toNearestStr(e,t=2){return e.toFixed(t)}arrayToStr(e,t=2){let i=[];return e.forEach(s=>{i.push(this.toNearestStr(s,t))}),i}flattenArrayToStr(e,t=2,i=","){return this.arrayToStr(e,t).join(i)}randomFloat(e,t){return Math.random()*(t-e)+e}screenToNDC(e,t,i,s){let r=e/i*2-1,a=-(t/s)*2+1;return new tn(r,a)}componentToHex(e){var t=e.toString(16);return t.padStart(2,"0")}rgbToHex(e,t,i){return"#"+this.componentToHex(Math.min(255,Math.max(0,Math.round(e))))+this.componentToHex(Math.min(255,Math.max(0,Math.round(t))))+this.componentToHex(Math.min(255,Math.max(0,Math.round(i))))}hexToRgb(e){e[0]==="#"?e=e.substr(1,6):e=e.substr(0,6);let i,s,r;return e.length===3?(i=e[0]+e[0],s=e[1]+e[1],r=e[2]+e[2]):(i=e[0]+e[1],s=e[2]+e[3],r=e[4]+e[5]),i=parseInt(i,16),s=parseInt(s,16),r=parseInt(r,16),[i,s,r]}stringToRgb(e,t=null,i=!1){let s=[255,0,0];if(e){let r=e.length,a="";for(let n=0;n<r;++n)a+=e[r-1-n].charCodeAt(0).toString(16);let o=a.length;if(o>6){let n=1;e==="tussin"?n=0:e==="fexofenadine"&&(n=-1);let h=Math.max(0,parseInt((o-6)/2+n));a=a.substr(h,6)}s=this.hexToRgb(a)}if(t!=null){let r=Math.max(...s),a=Math.min(...s),o=r*t;s[0]=parseInt(Math.min(255,(s[0]-a)/(r-a)*255+o)),s[1]=parseInt(Math.min(255,(s[1]-a)/(r-a)*255+o)),s[2]=parseInt(Math.min(255,(s[2]-a)/(r-a)*255+o))}return i===!0&&(s[0]=s[0]/255,s[1]=s[1]/255,s[2]=s[2]/255),s}colorTosRGB(e){return typeof e=="object"&&(e.hasOwnProperty&&e.hasOwnProperty("r")&&(e.r=this.tosRGB(e.r),e.g=this.tosRGB(e.g),e.b=this.tosRGB(e.b)),e.hasOwnProperty&&e.hasOwnProperty("x")&&(e.x=this.tosRGB(e.x),e.y=this.tosRGB(e.y),e.z=this.tosRGB(e.z))),e}tosRGB(e){return e<=.0031308?e*=12.92:e=1.055*Math.pow(e,this.oneTwoPFour)-.055,e}colorToLinear(e){return typeof e=="object"&&(e.hasOwnProperty&&e.hasOwnProperty("r")&&(e.r=this.toLinear(e.r),e.g=this.toLinear(e.g),e.b=this.toLinear(e.b)),e.hasOwnProperty&&e.hasOwnProperty("x")&&(e.x=this.toLinear(e.x),e.y=this.toLinear(e.y),e.z=this.toLinear(e.z))),e}toLinear(e){return e<=.04045?e*=this.twelvePNineTwoDiv:e=Math.pow((e+.055)*this.onePOFiveFiveDiv,2.4),e}gammaCorrectColor(e,t="2.2",i="1.8"){return typeof e=="object"&&(e.hasOwnProperty&&e.hasOwnProperty("r")&&(e.r=this.gammaCorrect(e.r,t,i),e.g=this.gammaCorrect(e.g,t,i),e.b=this.gammaCorrect(e.b,t,i)),e.hasOwnProperty&&e.hasOwnProperty("x")&&(e.x=this.gammaCorrect(e.x,t,i),e.y=this.gammaCorrect(e.y,t,i),e.z=this.gammaCorrect(e.z,t,i))),e}gammaCorrection(e,t="2.2",i="1.8"){let s=Math.pow(e,t);return Math.pow(s,1/i)}convertColor(e,t=this.pxlEnums.COLOR_SHIFT.KEEP){if(t===this.pxlEnums.COLOR_SHIFT.KEEP)return e;let i=e.clone();switch(t){case this.pxlEnums.COLOR_SHIFT.sRGB_TO_LINEAR:i=this.colorTosRGB(i);break;case this.pxlEnums.COLOR_SHIFT.LINEAR_TO_sRGB:i=this.colorToLinear(i);break;case this.pxlEnums.COLOR_SHIFT.WINDOWS_TO_UNIX:i=this.gammaCorrectColor(i,"2.2","1.8");break;case this.pxlEnums.COLOR_SHIFT.UNIX_TO_WINDOWS:i=this.gammaCorrectColor(i,"1.8","2.2");break;case this.pxlEnums.COLOR_SHIFT.LINEAR_TO_WINDOWS:i=this.gammaCorrectColor(i,"1.0","2.2");break;case this.pxlEnums.COLOR_SHIFT.WINDOWS_TO_LINEAR:i=this.gammaCorrectColor(i,"2.2","1.0");break;case this.pxlEnums.COLOR_SHIFT.LINEAR_TO_UNIX:i=this.gammaCorrectColor(i,"1.0","1.8");break;case this.pxlEnums.COLOR_SHIFT.UNIX_TO_LINEAR:i=this.gammaCorrectColor(i,"1.8","1.0");break;default:break}return i}randomizeArray(e){let t=[...e],i=[];for(;t.length>0;){let s=t.length===1?0:parseInt(Math.random()*21*t.length)%t.length;i.push(t.splice(s,1)[0])}return i}getRandom(e,t=1.14){let i=Math.floor(Math.random(t)*e.length);return e[i]}applyTransformList(e,t){var i=t.r;e.rotateX(i[0]),e.rotateY(i[1]),e.rotateZ(i[2]),typeof t.rOrder!="undefined"&&(e.rotation.order=t.rOrder);var s=t.t;e.position.set(s[0],s[1],s[2]);var r=t.s;e.scale.set(r[0],r[1],r[2]),e.matrixAutoUpdate=!1,e.updateMatrix()}vec2(e=null,t=null){return new tn(e,t)}vec3(e=0,t=0,i=0){return new Vu(e,t,i)}loadTexture(e,t=null,i={}){e.includes("/")||(e=this.assetRoot+e);let s=null;if(typeof this.textLoaderArray[e]!="undefined")s=this.textLoaderArray[e];else{s=new ju;let r=Object.keys(i);this.texLoader.load(e,a=>{t!=null&&(s.format=this.channelFormats[t]),s.image=a,s.needsUpdate=!0,r.length>0&&r.forEach(o=>{s[o]=i[o]})},void 0,a=>{console.error(" TextureLoader :: Error loading texture :: "+e),console.error(a)}),this.textLoaderArray[e]=s}return s}getVideoTexture(e){let t=new Ku(e);return t.minFilter=sn,t.magFilter=sn,t.format=rn,t}getCanvasTexture(e){let t=new zu(e),i=new Zu({map:t});return{texture:t,material:i}}dupeArray(e,t){return Array.from({length:t}).fill(e)}};import{AmbientLight as yp,AnimationClip as Ep,Bone as xn,BufferGeometry as Ur,ClampToEdgeWrapping as Cn,Color as ze,ColorManagement as Ip,DirectionalLight as Bp,EquirectangularReflectionMapping as wp,Euler as dt,FileLoader as Sp,Float32BufferAttribute as wt,Group as bn,Line as Dp,LineBasicMaterial as Rp,Loader as Hr,LoaderUtils as Tp,MathUtils as ge,Matrix3 as Pp,Matrix4 as re,Mesh as Mp,MeshLambertMaterial as Lp,MeshPhongMaterial as Gr,NumberKeyframeTrack as kp,Object3D as Ri,PerspectiveCamera as Qp,PointLight as yn,PropertyBinding as Pi,Quaternion as st,QuaternionKeyframeTrack as En,RepeatWrapping as In,SRGBColorSpace as _p,ShapeUtils as Fp,Skeleton as Op,SkinnedMesh as Up,SpotLight as Gp,Texture as Np,TextureLoader as Vp,Uint16BufferAttribute as Hp,Vector2 as jp,Vector3 as We,Vector4 as Kp,VectorKeyframeTrack as zp}from"three";var we=Uint8Array,Bt=Uint16Array,$u=Int32Array,an=new we([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),on=new we([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ep=new we([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),nn=function(l,e){for(var t=new Bt(31),i=0;i<31;++i)t[i]=e+=1<<l[i-1];for(var s=new $u(t[30]),i=1;i<30;++i)for(var r=t[i];r<t[i+1];++r)s[r]=r-t[i]<<5|i;return{b:t,r:s}},ln=nn(an,2),hn=ln.b,tp=ln.r;hn[28]=258,tp[258]=28;var cn=nn(on,0),ip=cn.b,Bf=cn.r,Or=new Bt(32768);for(q=0;q<32768;++q)Ke=(q&43690)>>1|(q&21845)<<1,Ke=(Ke&52428)>>2|(Ke&13107)<<2,Ke=(Ke&61680)>>4|(Ke&3855)<<4,Or[q]=((Ke&65280)>>8|(Ke&255)<<8)>>1;var Ke,q,qt=function(l,e,t){for(var i=l.length,s=0,r=new Bt(e);s<i;++s)l[s]&&++r[l[s]-1];var a=new Bt(e);for(s=1;s<e;++s)a[s]=a[s-1]+r[s-1]<<1;var o;if(t){o=new Bt(1<<e);var n=15-e;for(s=0;s<i;++s)if(l[s])for(var h=s<<4|l[s],u=e-l[s],c=a[l[s]-1]++<<u,p=c|(1<<u)-1;c<=p;++c)o[Or[c]>>n]=h}else for(o=new Bt(i),s=0;s<i;++s)l[s]&&(o[s]=Or[a[l[s]-1]++]>>15-l[s]);return o},Yt=new we(288);for(q=0;q<144;++q)Yt[q]=8;var q;for(q=144;q<256;++q)Yt[q]=9;var q;for(q=256;q<280;++q)Yt[q]=7;var q;for(q=280;q<288;++q)Yt[q]=8;var q,un=new we(32);for(q=0;q<32;++q)un[q]=5;var q;var sp=qt(Yt,9,1);var rp=qt(un,5,1),_r=function(l){for(var e=l[0],t=1;t<l.length;++t)l[t]>e&&(e=l[t]);return e},Me=function(l,e,t){var i=e/8|0;return(l[i]|l[i+1]<<8)>>(e&7)&t},Fr=function(l,e){var t=e/8|0;return(l[t]|l[t+1]<<8|l[t+2]<<16)>>(e&7)},ap=function(l){return(l+7)/8|0},op=function(l,e,t){return(e==null||e<0)&&(e=0),(t==null||t>l.length)&&(t=l.length),new we(l.subarray(e,t))};var np=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Le=function(l,e,t){var i=new Error(e||np[l]);if(i.code=l,Error.captureStackTrace&&Error.captureStackTrace(i,Le),!t)throw i;return i},lp=function(l,e,t,i){var s=l.length,r=i?i.length:0;if(!s||e.f&&!e.l)return t||new we(0);var a=!t,o=a||e.i!=2,n=e.i;a&&(t=new we(s*3));var h=function(_e){var Lt=t.length;if(_e>Lt){var kt=new we(Math.max(Lt*2,_e));kt.set(t),t=kt}},u=e.f||0,c=e.p||0,p=e.b||0,d=e.l,g=e.d,m=e.m,A=e.n,f=s*8;do{if(!d){u=Me(l,c,1);var C=Me(l,c+1,3);if(c+=3,C)if(C==1)d=sp,g=rp,m=9,A=5;else if(C==2){var I=Me(l,c,31)+257,E=Me(l,c+10,15)+4,B=I+Me(l,c+5,31)+1;c+=14;for(var w=new we(B),D=new we(19),S=0;S<E;++S)D[ep[S]]=Me(l,c+S*3,7);c+=E*3;for(var P=_r(D),F=(1<<P)-1,O=qt(D,P,1),S=0;S<B;){var N=O[Me(l,c,F)];c+=N&15;var v=N>>4;if(v<16)w[S++]=v;else{var M=0,L=0;for(v==16?(L=3+Me(l,c,3),c+=2,M=w[S-1]):v==17?(L=3+Me(l,c,7),c+=3):v==18&&(L=11+Me(l,c,127),c+=7);L--;)w[S++]=M}}var H=w.subarray(0,I),k=w.subarray(I);m=_r(H),A=_r(k),d=qt(H,m,1),g=qt(k,A,1)}else Le(1);else{var v=ap(c)+4,x=l[v-4]|l[v-3]<<8,b=v+x;if(b>s){n&&Le(0);break}o&&h(p+x),t.set(l.subarray(v,b),p),e.b=p+=x,e.p=c=b*8,e.f=u;continue}if(c>f){n&&Le(0);break}}o&&h(p+131072);for(var Q=(1<<m)-1,K=(1<<A)-1,Y=c;;Y=c){var M=d[Fr(l,c)&Q],_=M>>4;if(c+=M&15,c>f){n&&Le(0);break}if(M||Le(2),_<256)t[p++]=_;else if(_==256){Y=c,d=null;break}else{var $=_-254;if(_>264){var S=_-257,ee=an[S];$=Me(l,c,(1<<ee)-1)+hn[S],c+=ee}var Z=g[Fr(l,c)&K],he=Z>>4;Z||Le(3),c+=Z&15;var k=ip[he];if(he>3){var ee=on[he];k+=Fr(l,c)&(1<<ee)-1,c+=ee}if(c>f){n&&Le(0);break}o&&h(p+131072);var xe=p+$;if(p<k){var Qe=r-k,Ce=Math.min(k,xe);for(Qe+p<0&&Le(3);p<Ce;++p)t[p]=i[Qe+p]}for(;p<xe;++p)t[p]=t[p-k]}}e.l=d,e.p=Y,e.b=p,e.f=u,d&&(u=1,e.m=m,e.d=g,e.n=A)}while(!u);return p!=t.length&&a?op(t,0,p):t.subarray(0,p)};var hp=new we(0);var cp=function(l,e){return((l[0]&15)!=8||l[0]>>4>7||(l[0]<<8|l[1])%31)&&Le(6,"invalid zlib data"),(l[1]>>5&1)==+!e&&Le(6,"invalid zlib data: "+(l[1]&32?"need":"unexpected")+" dictionary"),(l[1]>>3&4)+2};function pn(l,e){return lp(l.subarray(cp(l,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}var up=typeof TextDecoder!="undefined"&&new TextDecoder,pp=0;try{up.decode(hp,{stream:!0}),pp=1}catch(l){}import{Curve as bp,Vector3 as gn,Vector4 as vn}from"three";import{Vector3 as dp,Vector4 as An}from"three";function dn(l,e,t){let i=t.length-l-1;if(e>=t[i])return i-1;if(e<=t[l])return l;let s=l,r=i,a=Math.floor((s+r)/2);for(;e<t[a]||e>=t[a+1];)e<t[a]?r=a:s=a,a=Math.floor((s+r)/2);return a}function fp(l,e,t,i){let s=[],r=[],a=[];s[0]=1;for(let o=1;o<=t;++o){r[o]=e-i[l+1-o],a[o]=i[l+o]-e;let n=0;for(let h=0;h<o;++h){let u=a[h+1],c=r[o-h],p=s[h]/(u+c);s[h]=n+u*p,n=c*p}s[o]=n}return s}function fn(l,e,t,i){let s=dn(l,i,e),r=fp(s,i,l,e),a=new An(0,0,0,0);for(let o=0;o<=l;++o){let n=t[s-l+o],h=r[o],u=n.w*h;a.x+=n.x*u,a.y+=n.y*u,a.z+=n.z*u,a.w+=n.w*h}return a}function mp(l,e,t,i,s){let r=[];for(let c=0;c<=t;++c)r[c]=0;let a=[];for(let c=0;c<=i;++c)a[c]=r.slice(0);let o=[];for(let c=0;c<=t;++c)o[c]=r.slice(0);o[0][0]=1;let n=r.slice(0),h=r.slice(0);for(let c=1;c<=t;++c){n[c]=e-s[l+1-c],h[c]=s[l+c]-e;let p=0;for(let d=0;d<c;++d){let g=h[d+1],m=n[c-d];o[c][d]=g+m;let A=o[d][c-1]/o[c][d];o[d][c]=p+g*A,p=m*A}o[c][c]=p}for(let c=0;c<=t;++c)a[0][c]=o[c][t];for(let c=0;c<=t;++c){let p=0,d=1,g=[];for(let m=0;m<=t;++m)g[m]=r.slice(0);g[0][0]=1;for(let m=1;m<=i;++m){let A=0,f=c-m,C=t-m;c>=m&&(g[d][0]=g[p][0]/o[C+1][f],A=g[d][0]*o[f][C]);let v=f>=-1?1:-f,x=c-1<=C?m-1:t-c;for(let I=v;I<=x;++I)g[d][I]=(g[p][I]-g[p][I-1])/o[C+1][f+I],A+=g[d][I]*o[f+I][C];c<=C&&(g[d][m]=-g[p][m-1]/o[C+1][c],A+=g[d][m]*o[c][C]),a[m][c]=A;let b=p;p=d,d=b}}let u=t;for(let c=1;c<=i;++c){for(let p=0;p<=t;++p)a[c][p]*=u;u*=t-c}return a}function gp(l,e,t,i,s){let r=s<l?s:l,a=[],o=dn(l,i,e),n=mp(o,i,l,r,e),h=[];for(let u=0;u<t.length;++u){let c=t[u].clone(),p=c.w;c.x*=p,c.y*=p,c.z*=p,h[u]=c}for(let u=0;u<=r;++u){let c=h[o-l].clone().multiplyScalar(n[u][0]);for(let p=1;p<=l;++p)c.add(h[o-l+p].clone().multiplyScalar(n[u][p]));a[u]=c}for(let u=r+1;u<=s+1;++u)a[u]=new An(0,0,0);return a}function vp(l,e){let t=1;for(let s=2;s<=l;++s)t*=s;let i=1;for(let s=2;s<=e;++s)i*=s;for(let s=2;s<=l-e;++s)i*=s;return t/i}function xp(l){let e=l.length,t=[],i=[];for(let r=0;r<e;++r){let a=l[r];t[r]=new dp(a.x,a.y,a.z),i[r]=a.w}let s=[];for(let r=0;r<e;++r){let a=t[r].clone();for(let o=1;o<=r;++o)a.sub(s[r-o].clone().multiplyScalar(vp(r,o)*i[o]));s[r]=a.divideScalar(i[0])}return s}function mn(l,e,t,i,s){let r=gp(l,e,t,i,s);return xp(r)}var Di=class extends bp{constructor(e,t,i,s,r){super();let a=t?t.length-1:0,o=i?i.length:0;this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=s||0,this.endKnot=r||a;for(let n=0;n<o;++n){let h=i[n];this.controlPoints[n]=new vn(h.x,h.y,h.z,h.w)}}getPoint(e,t=new gn){let i=t,s=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=fn(this.degree,this.knots,this.controlPoints,s);return r.w!==1&&r.divideScalar(r.w),i.set(r.x,r.y,r.z)}getTangent(e,t=new gn){let i=t,s=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),r=mn(this.degree,this.knots,this.controlPoints,s,1);return i.copy(r[1]).normalize(),i}toJSON(){let e=super.toJSON();return e.degree=this.degree,e.knots=[...this.knots],e.controlPoints=this.controlPoints.map(t=>t.toArray()),e.startKnot=this.startKnot,e.endKnot=this.endKnot,e}fromJSON(e){return super.fromJSON(e),this.degree=e.degree,this.knots=[...e.knots],this.controlPoints=e.controlPoints.map(t=>new vn(t[0],t[1],t[2],t[3])),this.startKnot=e.startKnot,this.endKnot=e.endKnot,this}};var G,ae,me,Mi=class extends Hr{constructor(e){super(e)}load(e,t,i,s){let r=this,a=r.path===""?Tp.extractUrlBase(e):r.path,o=new Sp(this.manager);o.setPath(r.path),o.setResponseType("arraybuffer"),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,function(n){try{t(r.parse(n,a))}catch(h){s?s(h):console.error(h),r.manager.itemError(e)}},i,s)}parse(e,t){if(Wp(e))G=new qr().parse(e);else{let s=Sn(e);if(!qp(s))throw new Error("THREE.FBXLoader: Unknown format.");if(Bn(s)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Bn(s));G=new Wr().parse(s)}let i=new Vp(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new jr(i,this.manager).parse(G)}},jr=class{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){ae=this.parseConnections();let e=this.parseImages(),t=this.parseTextures(e),i=this.parseMaterials(t),s=this.parseDeformers(),r=new Kr().parse(s);return this.parseScene(s,r,i),me}parseConnections(){let e=new Map;return"Connections"in G&&G.Connections.connections.forEach(function(i){let s=i[0],r=i[1],a=i[2];e.has(s)||e.set(s,{parents:[],children:[]});let o={ID:r,relationship:a};e.get(s).parents.push(o),e.has(r)||e.set(r,{parents:[],children:[]});let n={ID:s,relationship:a};e.get(r).children.push(n)}),e}parseImages(){let e={},t={};if("Video"in G.Objects){let i=G.Objects.Video;for(let s in i){let r=i[s],a=parseInt(s);if(e[a]=r.RelativeFilename||r.Filename,"Content"in r){let o=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,n=typeof r.Content=="string"&&r.Content!=="";if(o||n){let h=this.parseImage(i[s]);t[r.RelativeFilename||r.Filename]=h}}}}for(let i in e){let s=e[i];t[s]!==void 0?e[i]=t[s]:e[i]=e[i].split("\\").pop()}return e}parseImage(e){let t=e.Content,i=e.RelativeFilename||e.Filename,s=i.slice(i.lastIndexOf(".")+1).toLowerCase(),r;switch(s){case"bmp":r="image/bmp";break;case"jpg":case"jpeg":r="image/jpeg";break;case"png":r="image/png";break;case"tif":r="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",i),r="image/tga";break;default:console.warn('FBXLoader: Image type "'+s+'" is not supported.');return}if(typeof t=="string")return"data:"+r+";base64,"+t;{let a=new Uint8Array(t);return window.URL.createObjectURL(new Blob([a],{type:r}))}}parseTextures(e){let t=new Map;if("Texture"in G.Objects){let i=G.Objects.Texture;for(let s in i){let r=this.parseTexture(i[s],e);t.set(parseInt(s),r)}}return t}parseTexture(e,t){let i=this.loadTexture(e,t);i.ID=e.id,i.name=e.attrName;let s=e.WrapModeU,r=e.WrapModeV,a=s!==void 0?s.value:0,o=r!==void 0?r.value:0;if(i.wrapS=a===0?In:Cn,i.wrapT=o===0?In:Cn,"Scaling"in e){let n=e.Scaling.value;i.repeat.x=n[0],i.repeat.y=n[1]}if("Translation"in e){let n=e.Translation.value;i.offset.x=n[0],i.offset.y=n[1]}return i}loadTexture(e,t){let i=new Set(["tga","tif","tiff","exr","dds","hdr","ktx2"]),s=e.FileName.split(".").pop().toLowerCase(),r=i.has(s)?this.manager.getHandler(`.${s}`):this.textureLoader;if(!r)return console.warn(`FBXLoader: ${s.toUpperCase()} loader not found, creating placeholder texture for`,e.RelativeFilename),new Np;let a=r.path;a||r.setPath(this.textureLoader.path);let o=ae.get(e.id).children,n;o!==void 0&&o.length>0&&t[o[0].ID]!==void 0&&(n=t[o[0].ID],(n.indexOf("blob:")===0||n.indexOf("data:")===0)&&r.setPath(void 0));let h=r.load(n);return r.setPath(a),h}parseMaterials(e){let t=new Map;if("Material"in G.Objects){let i=G.Objects.Material;for(let s in i){let r=this.parseMaterial(i[s],e);r!==null&&t.set(parseInt(s),r)}}return t}parseMaterial(e,t){let i=e.id,s=e.attrName,r=e.ShadingModel;if(typeof r=="object"&&(r=r.value),!ae.has(i))return null;let a=this.parseParameters(e,t,i),o;switch(r.toLowerCase()){case"phong":o=new Gr;break;case"lambert":o=new Lp;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',r),o=new Gr;break}return o.setValues(a),o.name=s,o}parseParameters(e,t,i){let s={};e.BumpFactor&&(s.bumpScale=e.BumpFactor.value),e.Diffuse?s.color=new ze().fromArray(e.Diffuse.value):e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(s.color=new ze().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(s.displacementScale=e.DisplacementFactor.value),e.Emissive?s.emissive=new ze().fromArray(e.Emissive.value):e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(s.emissive=new ze().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(s.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),s.opacity=1-(e.TransparencyFactor?parseFloat(e.TransparencyFactor.value):0),(s.opacity===1||s.opacity===0)&&(s.opacity=e.Opacity?parseFloat(e.Opacity.value):null,s.opacity===null&&(s.opacity=1-(e.TransparentColor?parseFloat(e.TransparentColor.value[0]):0))),s.opacity<1&&(s.transparent=!0),e.ReflectionFactor&&(s.reflectivity=e.ReflectionFactor.value),e.Shininess&&(s.shininess=e.Shininess.value),e.Specular?s.specular=new ze().fromArray(e.Specular.value):e.SpecularColor&&e.SpecularColor.type==="Color"&&(s.specular=new ze().fromArray(e.SpecularColor.value));let r=this;return ae.get(i).children.forEach(function(a){let o=a.relationship;switch(o){case"Bump":s.bumpMap=r.getTexture(t,a.ID);break;case"Maya|TEX_ao_map":s.aoMap=r.getTexture(t,a.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":s.map=r.getTexture(t,a.ID);break;case"DisplacementColor":s.displacementMap=r.getTexture(t,a.ID);break;case"EmissiveColor":s.emissiveMap=r.getTexture(t,a.ID);break;case"NormalMap":case"Maya|TEX_normal_map":s.normalMap=r.getTexture(t,a.ID);break;case"ReflectionColor":s.envMap=r.getTexture(t,a.ID),s.envMap!==void 0&&(s.envMap.mapping=wp);break;case"SpecularColor":s.specularMap=r.getTexture(t,a.ID),s.specularMap;break;case"TransparentColor":case"TransparencyFactor":s.alphaMap=r.getTexture(t,a.ID),s.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",o);break}}),s}getTexture(e,t){return"LayeredTexture"in G.Objects&&t in G.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=ae.get(t).children[0].ID),e.get(t)}parseDeformers(){let e={},t={};if("Deformer"in G.Objects){let i=G.Objects.Deformer;for(let s in i){let r=i[s],a=ae.get(parseInt(s));if(r.attrType==="Skin"){let o=this.parseSkeleton(a,i);o.ID=s,a.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),o.geometryID=a.parents[0].ID,e[s]=o}else if(r.attrType==="BlendShape"){let o={id:s};o.rawTargets=this.parseMorphTargets(a,i),o.id=s,a.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[s]=o}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){let i=[];return e.children.forEach(function(s){let r=t[s.ID];if(r.attrType!=="Cluster")return;let a={ID:s.ID,indices:[],weights:[],transformLink:new re().fromArray(r.TransformLink.a)};"Indexes"in r&&(a.indices=r.Indexes.a,a.weights=r.Weights.a),i.push(a)}),{rawBones:i,bones:[]}}parseMorphTargets(e,t){let i=[];for(let s=0;s<e.children.length;s++){let r=e.children[s],a=t[r.ID],o={name:a.attrName,initialWeight:a.DeformPercent,id:a.id,fullWeights:a.FullWeights.a};if(a.attrType!=="BlendShapeChannel")return;o.geoID=ae.get(parseInt(r.ID)).children.filter(function(n){return n.relationship===void 0})[0].ID,i.push(o)}return i}parseScene(e,t,i){me=new bn;let s=this.parseModels(e.skeletons,t,i),r=G.Objects.Model,a=this;s.forEach(function(n){let h=r[n.ID];a.setLookAtProperties(n,h),ae.get(n.ID).parents.forEach(function(c){let p=s.get(c.ID);p!==void 0&&p.add(n)}),n.parent===null&&me.add(n)}),this.bindSkeleton(e.skeletons,t,s),this.addGlobalSceneSettings(),me.traverse(function(n){if(n.userData.transformData){n.parent&&(n.userData.transformData.parentMatrix=n.parent.matrix,n.userData.transformData.parentMatrixWorld=n.parent.matrixWorld);let h=wn(n.userData.transformData);n.applyMatrix4(h),n.updateWorldMatrix()}});let o=new zr().parse();me.children.length===1&&me.children[0].isGroup&&(me.children[0].animations=o,me=me.children[0]),me.animations=o}parseModels(e,t,i){let s=new Map,r=G.Objects.Model;var a=["Culling","DefaultAttributeIndex","InheritType","Lcl_Translation","Lcl_Rotation","Lcl_Scaling","RotationPivot","ScalingPivot","RotationActive","ScalingMax","RotationOffset","fbx_node_path","Shading","Version","attrName","attrType","currentUVSet","id","name","propertyList","singleProperty"];for(let o in r){let n=parseInt(o),h=r[o],u=ae.get(n),c=this.buildSkeleton(u,e,n,h.attrName);if(!c){switch(h.attrType){case"Camera":c=this.createCamera(u);break;case"Light":c=this.createLight(u);break;case"Mesh":c=this.createMesh(u,t,i);break;case"NurbsCurve":c=this.createCurve(u,t);break;case"LimbNode":case"Root":c=new xn;break;case"Null":default:c=new bn;break}c.name=h.attrName?Pi.sanitizeNodeName(h.attrName):"",c.userData.originalName=h.attrName,c.ID=n}Object.keys(h).forEach(d=>{a.includes(d)||(c.userData[d]=h[d].value)}),this.getTransformData(c,h),s.set(n,c)}return s}buildSkeleton(e,t,i,s){let r=null;return e.parents.forEach(function(a){for(let o in t){let n=t[o];n.rawBones.forEach(function(h,u){if(h.ID===a.ID){let c=r;r=new xn,r.matrixWorld.copy(h.transformLink),r.name=s?Pi.sanitizeNodeName(s):"",r.userData.originalName=s,r.ID=i,n.bones[u]=r,c!==null&&r.add(c)}})}}),r}createCamera(e){let t,i;if(e.children.forEach(function(s){let r=G.Objects.NodeAttribute[s.ID];r!==void 0&&(i=r)}),i===void 0)t=new Ri;else{let s=0;i.CameraProjectionType!==void 0&&i.CameraProjectionType.value===1&&(s=1);let r=1;i.NearPlane!==void 0&&(r=i.NearPlane.value/1e3);let a=1e3;i.FarPlane!==void 0&&(a=i.FarPlane.value/1e3);let o=window.innerWidth,n=window.innerHeight;i.AspectWidth!==void 0&&i.AspectHeight!==void 0&&(o=i.AspectWidth.value,n=i.AspectHeight.value);let h=o/n,u=45;i.FieldOfView!==void 0&&(u=i.FieldOfView.value);let c=i.FocalLength?i.FocalLength.value:null;switch(s){case 0:t=new Qp(u,h,r,a),c!==null&&t.setFocalLength(c);break;case 1:console.warn("THREE.FBXLoader: Orthographic cameras not supported yet."),t=new Ri;break;default:console.warn("THREE.FBXLoader: Unknown camera type "+s+"."),t=new Ri;break}}return t}createLight(e){let t,i;if(e.children.forEach(function(s){let r=G.Objects.NodeAttribute[s.ID];r!==void 0&&(i=r)}),i===void 0)t=new Ri;else{let s;i.LightType===void 0?s=0:s=i.LightType.value;let r=16777215;i.Color!==void 0&&(r=new ze().fromArray(i.Color.value));let a=i.Intensity===void 0?1:i.Intensity.value/100;i.CastLightOnObject!==void 0&&i.CastLightOnObject.value===0&&(a=0);let o=0;i.FarAttenuationEnd!==void 0&&(i.EnableFarAttenuation!==void 0&&i.EnableFarAttenuation.value===0?o=0:o=i.FarAttenuationEnd.value);let n=1;switch(s){case 0:t=new yn(r,a,o,n);break;case 1:t=new Bp(r,a);break;case 2:let h=Math.PI/3;i.InnerAngle!==void 0&&(h=ge.degToRad(i.InnerAngle.value));let u=0;i.OuterAngle!==void 0&&(u=ge.degToRad(i.OuterAngle.value),u=Math.max(u,1)),t=new Gp(r,a,o,h,u,n);break;default:console.warn("THREE.FBXLoader: Unknown light type "+i.LightType.value+", defaulting to a PointLight."),t=new yn(r,a);break}i.CastShadows!==void 0&&i.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,i){let s,r=null,a=null,o=[];return e.children.forEach(function(n){t.has(n.ID)&&(r=t.get(n.ID)),i.has(n.ID)&&o.push(i.get(n.ID))}),o.length>1?a=o:o.length>0?a=o[0]:(a=new Gr({name:Hr.DEFAULT_MATERIAL_NAME,color:13421772}),o.push(a)),"color"in r.attributes&&o.forEach(function(n){n.vertexColors=!0}),r.FBX_Deformer?(s=new Up(r,a),s.normalizeSkinWeights()):s=new Mp(r,a),s}createCurve(e,t){let i=e.children.reduce(function(r,a){return t.has(a.ID)&&(r=t.get(a.ID)),r},null),s=new Rp({name:Hr.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new Dp(i,s)}getTransformData(e,t){let i={};"InheritType"in t&&(i.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?i.eulerOrder=Xt(t.RotationOrder.value):i.eulerOrder=Xt(0),"Lcl_Translation"in t&&(i.translation=t.Lcl_Translation.value),"PreRotation"in t&&(i.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(i.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(i.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(i.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(i.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(i.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(i.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(i.rotationPivot=t.RotationPivot.value),e.userData.transformData=i}setLookAtProperties(e,t){"LookAtProperty"in t&&ae.get(e.ID).children.forEach(function(s){if(s.relationship==="LookAtProperty"){let r=G.Objects.Model[s.ID];if("Lcl_Translation"in r){let a=r.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(a),me.add(e.target)):e.lookAt(new We().fromArray(a))}}})}bindSkeleton(e,t,i){let s=this.parsePoseNodes();for(let r in e){let a=e[r];ae.get(parseInt(a.ID)).parents.forEach(function(n){if(t.has(n.ID)){let h=n.ID;ae.get(h).parents.forEach(function(c){i.has(c.ID)&&i.get(c.ID).bind(new Op(a.bones),s[c.ID])})}})}}parsePoseNodes(){let e={};if("Pose"in G.Objects){let t=G.Objects.Pose;for(let i in t)if(t[i].attrType==="BindPose"&&t[i].NbPoseNodes>0){let s=t[i].PoseNode;Array.isArray(s)?s.forEach(function(r){e[r.Node]=new re().fromArray(r.Matrix.a)}):e[s.Node]=new re().fromArray(s.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in G){if("AmbientColor"in G.GlobalSettings){let e=G.GlobalSettings.AmbientColor.value,t=e[0],i=e[1],s=e[2];if(t!==0||i!==0||s!==0){let r=new ze().setRGB(t,i,s);me.add(new yp(r,1))}}"UnitScaleFactor"in G.GlobalSettings&&(me.userData.unitScaleFactor=G.GlobalSettings.UnitScaleFactor.value)}}},Kr=class{constructor(){this.negativeMaterialIndices=!1}parse(e){let t=new Map;if("Geometry"in G.Objects){let i=G.Objects.Geometry;for(let s in i){let r=ae.get(parseInt(s)),a=this.parseGeometry(r,i[s],e);t.set(parseInt(s),a)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,i){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,i);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,i){let s=i.skeletons,r=[],a=e.parents.map(function(c){return G.Objects.Model[c.ID]});if(a.length===0)return;let o=e.children.reduce(function(c,p){return s[p.ID]!==void 0&&(c=s[p.ID]),c},null);e.children.forEach(function(c){i.morphTargets[c.ID]!==void 0&&r.push(i.morphTargets[c.ID])});let n=a[0],h={};"RotationOrder"in n&&(h.eulerOrder=Xt(n.RotationOrder.value)),"InheritType"in n&&(h.inheritType=parseInt(n.InheritType.value)),"GeometricTranslation"in n&&(h.translation=n.GeometricTranslation.value),"GeometricRotation"in n&&(h.rotation=n.GeometricRotation.value),"GeometricScaling"in n&&(h.scale=n.GeometricScaling.value);let u=wn(h);return this.genGeometry(t,o,r,u)}genGeometry(e,t,i,s){let r=new Ur;e.attrName&&(r.name=e.attrName);let a=this.parseGeoNode(e,t),o=this.genBuffers(a),n=new wt(o.vertex,3);if(n.applyMatrix4(s),r.setAttribute("position",n),o.colors.length>0&&r.setAttribute("color",new wt(o.colors,3)),t&&(r.setAttribute("skinIndex",new Hp(o.weightsIndices,4)),r.setAttribute("skinWeight",new wt(o.vertexWeights,4)),r.FBX_Deformer=t),o.normal.length>0){let h=new Pp().getNormalMatrix(s),u=new wt(o.normal,3);u.applyNormalMatrix(h),r.setAttribute("normal",u)}if(o.uvs.forEach(function(h,u){let c=u===0?"uv":`uv${u}`;r.setAttribute(c,new wt(o.uvs[u],2))}),a.material&&a.material.mappingType!=="AllSame"){let h=o.materialIndex[0],u=0;if(o.materialIndex.forEach(function(c,p){c!==h&&(r.addGroup(u,p-u,h),h=c,u=p)}),r.groups.length>0){let c=r.groups[r.groups.length-1],p=c.start+c.count;p!==o.materialIndex.length&&r.addGroup(p,o.materialIndex.length-p,h)}r.groups.length===0&&r.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(r,e,i,s),r}parseGeoNode(e,t){let i={};if(i.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],i.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(i.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(i.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(i.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){i.uv=[];let s=0;for(;e.LayerElementUV[s];)e.LayerElementUV[s].UV&&i.uv.push(this.parseUVs(e.LayerElementUV[s])),s++}return i.weightTable={},t!==null&&(i.skeleton=t,t.rawBones.forEach(function(s,r){s.indices.forEach(function(a,o){i.weightTable[a]===void 0&&(i.weightTable[a]=[]),i.weightTable[a].push({id:r,weight:s.weights[o]})})})),i}genBuffers(e){let t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},i=0,s=0,r=!1,a=[],o=[],n=[],h=[],u=[],c=[],p=this;return e.vertexIndices.forEach(function(d,g){let m,A=!1;d<0&&(d=d^-1,A=!0);let f=[],C=[];if(a.push(d*3,d*3+1,d*3+2),e.color){let v=Ti(g,i,d,e.color);n.push(v[0],v[1],v[2])}if(e.skeleton){if(e.weightTable[d]!==void 0&&e.weightTable[d].forEach(function(v){C.push(v.weight),f.push(v.id)}),C.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);let v=[0,0,0,0],x=[0,0,0,0];C.forEach(function(b,I){let E=b,B=f[I];x.forEach(function(w,D,S){if(E>w){S[D]=E,E=w;let P=v[D];v[D]=B,B=P}})}),f=v,C=x}for(;C.length<4;)C.push(0),f.push(0);for(let v=0;v<4;++v)u.push(C[v]),c.push(f[v])}if(e.normal){let v=Ti(g,i,d,e.normal);o.push(v[0],v[1],v[2])}e.material&&e.material.mappingType!=="AllSame"&&(m=Ti(g,i,d,e.material)[0],m<0&&(p.negativeMaterialIndices=!0,m=0)),e.uv&&e.uv.forEach(function(v,x){let b=Ti(g,i,d,v);h[x]===void 0&&(h[x]=[]),h[x].push(b[0]),h[x].push(b[1])}),s++,A&&(p.genFace(t,e,a,m,o,n,h,u,c,s),i++,s=0,a=[],o=[],n=[],h=[],u=[],c=[])}),t}getNormalNewell(e){let t=new We(0,0,0);for(let i=0;i<e.length;i++){let s=e[i],r=e[(i+1)%e.length];t.x+=(s.y-r.y)*(s.z+r.z),t.y+=(s.z-r.z)*(s.x+r.x),t.z+=(s.x-r.x)*(s.y+r.y)}return t.normalize(),t}getNormalTangentAndBitangent(e){let t=this.getNormalNewell(e),s=(Math.abs(t.z)>.5?new We(0,1,0):new We(0,0,1)).cross(t).normalize(),r=t.clone().cross(s).normalize();return{normal:t,tangent:s,bitangent:r}}flattenVertex(e,t,i){return new jp(e.dot(t),e.dot(i))}genFace(e,t,i,s,r,a,o,n,h,u){let c;if(u>3){let p=[],d=t.baseVertexPositions||t.vertexPositions;for(let f=0;f<i.length;f+=3)p.push(new We(d[i[f]],d[i[f+1]],d[i[f+2]]));let{tangent:g,bitangent:m}=this.getNormalTangentAndBitangent(p),A=[];for(let f of p)A.push(this.flattenVertex(f,g,m));c=Fp.triangulateShape(A,[])}else c=[[0,1,2]];for(let[p,d,g]of c)e.vertex.push(t.vertexPositions[i[p*3]]),e.vertex.push(t.vertexPositions[i[p*3+1]]),e.vertex.push(t.vertexPositions[i[p*3+2]]),e.vertex.push(t.vertexPositions[i[d*3]]),e.vertex.push(t.vertexPositions[i[d*3+1]]),e.vertex.push(t.vertexPositions[i[d*3+2]]),e.vertex.push(t.vertexPositions[i[g*3]]),e.vertex.push(t.vertexPositions[i[g*3+1]]),e.vertex.push(t.vertexPositions[i[g*3+2]]),t.skeleton&&(e.vertexWeights.push(n[p*4]),e.vertexWeights.push(n[p*4+1]),e.vertexWeights.push(n[p*4+2]),e.vertexWeights.push(n[p*4+3]),e.vertexWeights.push(n[d*4]),e.vertexWeights.push(n[d*4+1]),e.vertexWeights.push(n[d*4+2]),e.vertexWeights.push(n[d*4+3]),e.vertexWeights.push(n[g*4]),e.vertexWeights.push(n[g*4+1]),e.vertexWeights.push(n[g*4+2]),e.vertexWeights.push(n[g*4+3]),e.weightsIndices.push(h[p*4]),e.weightsIndices.push(h[p*4+1]),e.weightsIndices.push(h[p*4+2]),e.weightsIndices.push(h[p*4+3]),e.weightsIndices.push(h[d*4]),e.weightsIndices.push(h[d*4+1]),e.weightsIndices.push(h[d*4+2]),e.weightsIndices.push(h[d*4+3]),e.weightsIndices.push(h[g*4]),e.weightsIndices.push(h[g*4+1]),e.weightsIndices.push(h[g*4+2]),e.weightsIndices.push(h[g*4+3])),t.color&&(e.colors.push(a[p*3]),e.colors.push(a[p*3+1]),e.colors.push(a[p*3+2]),e.colors.push(a[d*3]),e.colors.push(a[d*3+1]),e.colors.push(a[d*3+2]),e.colors.push(a[g*3]),e.colors.push(a[g*3+1]),e.colors.push(a[g*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(s),e.materialIndex.push(s),e.materialIndex.push(s)),t.normal&&(e.normal.push(r[p*3]),e.normal.push(r[p*3+1]),e.normal.push(r[p*3+2]),e.normal.push(r[d*3]),e.normal.push(r[d*3+1]),e.normal.push(r[d*3+2]),e.normal.push(r[g*3]),e.normal.push(r[g*3+1]),e.normal.push(r[g*3+2])),t.uv&&t.uv.forEach(function(m,A){e.uvs[A]===void 0&&(e.uvs[A]=[]),e.uvs[A].push(o[A][p*2]),e.uvs[A].push(o[A][p*2+1]),e.uvs[A].push(o[A][d*2]),e.uvs[A].push(o[A][d*2+1]),e.uvs[A].push(o[A][g*2]),e.uvs[A].push(o[A][g*2+1])})}addMorphTargets(e,t,i,s){if(i.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];let r=this;i.forEach(function(a){a.rawTargets.forEach(function(o){let n=G.Objects.Geometry[o.geoID];n!==void 0&&r.genMorphGeometry(e,t,n,s,o.name)})})}genMorphGeometry(e,t,i,s,r){let a=t.Vertices!==void 0?t.Vertices.a:[],o=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],n=i.Vertices!==void 0?i.Vertices.a:[],h=i.Indexes!==void 0?i.Indexes.a:[],u=e.attributes.position.count*3,c=new Float32Array(u);for(let m=0;m<h.length;m++){let A=h[m]*3;c[A]=n[m*3],c[A+1]=n[m*3+1],c[A+2]=n[m*3+2]}let p={vertexIndices:o,vertexPositions:c,baseVertexPositions:a},d=this.genBuffers(p),g=new wt(d.vertex,3);g.name=r||i.attrName,g.applyMatrix4(s),e.morphAttributes.position.push(g)}parseNormals(e){let t=e.MappingInformationType,i=e.ReferenceInformationType,s=e.Normals.a,r=[];return i==="IndexToDirect"&&("NormalIndex"in e?r=e.NormalIndex.a:"NormalsIndex"in e&&(r=e.NormalsIndex.a)),{dataSize:3,buffer:s,indices:r,mappingType:t,referenceType:i}}parseUVs(e){let t=e.MappingInformationType,i=e.ReferenceInformationType,s=e.UV.a,r=[];return i==="IndexToDirect"&&(r=e.UVIndex.a),{dataSize:2,buffer:s,indices:r,mappingType:t,referenceType:i}}parseVertexColors(e){let t=e.MappingInformationType,i=e.ReferenceInformationType,s=e.Colors.a,r=[];i==="IndexToDirect"&&(r=e.ColorIndex.a);for(let a=0,o=new ze;a<s.length;a+=4)o.fromArray(s,a),Ip.toWorkingColorSpace(o,_p),o.toArray(s,a);return{dataSize:4,buffer:s,indices:r,mappingType:t,referenceType:i}}parseMaterialIndices(e){let t=e.MappingInformationType,i=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i};let s=e.Materials.a,r=[];for(let a=0;a<s.length;++a)r.push(a);return{dataSize:1,buffer:s,indices:r,mappingType:t,referenceType:i}}parseNurbsGeometry(e){let t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new Ur;let i=t-1,s=e.KnotVector.a,r=[],a=e.Points.a;for(let c=0,p=a.length;c<p;c+=4)r.push(new Kp().fromArray(a,c));let o,n;if(e.Form==="Closed")r.push(r[0]);else if(e.Form==="Periodic"){o=i,n=s.length-1-o;for(let c=0;c<i;++c)r.push(r[c])}let u=new Di(i,s,r,o,n).getPoints(r.length*12);return new Ur().setFromPoints(u)}},zr=class{parse(){let e=[],t=this.parseClips();if(t!==void 0)for(let i in t){let s=t[i],r=this.addClip(s);e.push(r)}return e}parseClips(){if(G.Objects.AnimationCurve===void 0)return;let e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);let t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){let e=G.Objects.AnimationCurveNode,t=new Map;for(let i in e){let s=e[i];if(s.attrName.match(/S|R|T|DeformPercent/)!==null){let r={id:s.id,attr:s.attrName,curves:{}};t.set(r.id,r)}}return t}parseAnimationCurves(e){let t=G.Objects.AnimationCurve;for(let i in t){let s={id:t[i].id,times:t[i].KeyTime.a.map(Yp),values:t[i].KeyValueFloat.a},r=ae.get(s.id);if(r!==void 0){let a=r.parents[0].ID,o=r.parents[0].relationship;o.match(/X/)?e.get(a).curves.x=s:o.match(/Y/)?e.get(a).curves.y=s:o.match(/Z/)?e.get(a).curves.z=s:o.match(/DeformPercent/)&&e.has(a)&&(e.get(a).curves.morph=s)}}}parseAnimationLayers(e){let t=G.Objects.AnimationLayer,i=new Map;for(let s in t){let r=[],a=ae.get(parseInt(s));a!==void 0&&(a.children.forEach(function(n,h){if(e.has(n.ID)){let u=e.get(n.ID);if(u.curves.x!==void 0||u.curves.y!==void 0||u.curves.z!==void 0){if(r[h]===void 0){let c=ae.get(n.ID).parents.filter(function(p){return p.relationship!==void 0})[0].ID;if(c!==void 0){let p=G.Objects.Model[c.toString()];if(p===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",n);return}let d={modelName:p.attrName?Pi.sanitizeNodeName(p.attrName):"",ID:p.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};me.traverse(function(g){g.ID===p.id&&(d.transform=g.matrix,g.userData.transformData&&(d.eulerOrder=g.userData.transformData.eulerOrder))}),d.transform||(d.transform=new re),"PreRotation"in p&&(d.preRotation=p.PreRotation.value),"PostRotation"in p&&(d.postRotation=p.PostRotation.value),r[h]=d}}r[h]&&(r[h][u.attr]=u)}else if(u.curves.morph!==void 0){if(r[h]===void 0){let c=ae.get(n.ID).parents.filter(function(f){return f.relationship!==void 0})[0].ID,p=ae.get(c).parents[0].ID,d=ae.get(p).parents[0].ID,g=ae.get(d).parents[0].ID,m=G.Objects.Model[g],A={modelName:m.attrName?Pi.sanitizeNodeName(m.attrName):"",morphName:G.Objects.Deformer[c].attrName};r[h]=A}r[h][u.attr]=u}}}),i.set(parseInt(s),r))}return i}parseAnimStacks(e){let t=G.Objects.AnimationStack,i={};for(let s in t){let r=ae.get(parseInt(s)).children;r.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");let a=e.get(r[0].ID);i[s]={name:t[s].attrName,layer:a}}return i}addClip(e){let t=[],i=this;return e.layer.forEach(function(s){t=t.concat(i.generateTracks(s))}),new Ep(e.name,-1,t)}generateTracks(e){let t=[],i=new We,s=new We;if(e.transform&&e.transform.decompose(i,new st,s),i=i.toArray(),s=s.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){let r=this.generateVectorTrack(e.modelName,e.T.curves,i,"position");r!==void 0&&t.push(r)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){let r=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);r!==void 0&&t.push(r)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){let r=this.generateVectorTrack(e.modelName,e.S.curves,s,"scale");r!==void 0&&t.push(r)}if(e.DeformPercent!==void 0){let r=this.generateMorphTrack(e);r!==void 0&&t.push(r)}return t}generateVectorTrack(e,t,i,s){let r=this.getTimesForAllAxes(t),a=this.getKeyframeTrackValues(r,t,i);return new zp(e+"."+s,r,a)}generateRotationTrack(e,t,i,s,r){let a,o;if(t.x!==void 0&&t.y!==void 0&&t.z!==void 0){let p=this.interpolateRotations(t.x,t.y,t.z,r);a=p[0],o=p[1]}let n=Xt(0);i!==void 0&&(i=i.map(ge.degToRad),i.push(n),i=new dt().fromArray(i),i=new st().setFromEuler(i)),s!==void 0&&(s=s.map(ge.degToRad),s.push(n),s=new dt().fromArray(s),s=new st().setFromEuler(s).invert());let h=new st,u=new dt,c=[];if(!o||!a)return new En(e+".quaternion",[0],[0]);for(let p=0;p<o.length;p+=3)u.set(o[p],o[p+1],o[p+2],r),h.setFromEuler(u),i!==void 0&&h.premultiply(i),s!==void 0&&h.multiply(s),p>2&&new st().fromArray(c,(p-3)/3*4).dot(h)<0&&h.set(-h.x,-h.y,-h.z,-h.w),h.toArray(c,p/3*4);return new En(e+".quaternion",a,c)}generateMorphTrack(e){let t=e.DeformPercent.curves.morph,i=t.values.map(function(r){return r/100}),s=me.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new kp(e.modelName+".morphTargetInfluences["+s+"]",t.times,i)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(i,s){return i-s}),t.length>1){let i=1,s=t[0];for(let r=1;r<t.length;r++){let a=t[r];a!==s&&(t[i]=a,s=a,i++)}t=t.slice(0,i)}return t}getKeyframeTrackValues(e,t,i){let s=i,r=[],a=-1,o=-1,n=-1;return e.forEach(function(h){if(t.x&&(a=t.x.times.indexOf(h)),t.y&&(o=t.y.times.indexOf(h)),t.z&&(n=t.z.times.indexOf(h)),a!==-1){let u=t.x.values[a];r.push(u),s[0]=u}else r.push(s[0]);if(o!==-1){let u=t.y.values[o];r.push(u),s[1]=u}else r.push(s[1]);if(n!==-1){let u=t.z.values[n];r.push(u),s[2]=u}else r.push(s[2])}),r}interpolateRotations(e,t,i,s){let r=[],a=[];r.push(e.times[0]),a.push(ge.degToRad(e.values[0])),a.push(ge.degToRad(t.values[0])),a.push(ge.degToRad(i.values[0]));for(let o=1;o<e.values.length;o++){let n=[e.values[o-1],t.values[o-1],i.values[o-1]];if(isNaN(n[0])||isNaN(n[1])||isNaN(n[2]))continue;let h=n.map(ge.degToRad),u=[e.values[o],t.values[o],i.values[o]];if(isNaN(u[0])||isNaN(u[1])||isNaN(u[2]))continue;let c=u.map(ge.degToRad),p=[u[0]-n[0],u[1]-n[1],u[2]-n[2]],d=[Math.abs(p[0]),Math.abs(p[1]),Math.abs(p[2])];if(d[0]>=180||d[1]>=180||d[2]>=180){let m=Math.max(...d)/180,A=new dt(...h,s),f=new dt(...c,s),C=new st().setFromEuler(A),v=new st().setFromEuler(f);C.dot(v)&&v.set(-v.x,-v.y,-v.z,-v.w);let x=e.times[o-1],b=e.times[o]-x,I=new st,E=new dt;for(let B=0;B<1;B+=1/m)I.copy(C.clone().slerp(v.clone(),B)),r.push(x+B*b),E.setFromQuaternion(I,s),a.push(E.x),a.push(E.y),a.push(E.z)}else r.push(e.times[o]),a.push(ge.degToRad(e.values[o])),a.push(ge.degToRad(t.values[o])),a.push(ge.degToRad(i.values[o]))}return[r,a]}},Wr=class{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new ki,this.nodeStack=[],this.currentProp=[],this.currentPropName="";let t=this,i=e.split(/[\r\n]+/);return i.forEach(function(s,r){let a=s.match(/^[\s\t]*;/),o=s.match(/^[\s\t]*$/);if(a||o)return;let n=s.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),h=s.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),u=s.match("^\\t{"+(t.currentIndent-1)+"}}");n?t.parseNodeBegin(s,n):h?t.parseNodeProperty(s,h,i[++r]):u?t.popStack():s.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(s)}),this.allNodes}parseNodeBegin(e,t){let i=t[1].trim().replace(/^"/,"").replace(/"$/,""),s=t[2].split(",").map(function(n){return n.trim().replace(/^"/,"").replace(/"$/,"")}),r={name:i},a=this.parseNodeAttr(s),o=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(i,r):i in o?(i==="PoseNode"?o.PoseNode.push(r):o[i].id!==void 0&&(o[i]={},o[i][o[i].id]=o[i]),a.id!==""&&(o[i][a.id]=r)):typeof a.id=="number"?(o[i]={},o[i][a.id]=r):i!=="Properties70"&&(i==="PoseNode"?o[i]=[r]:o[i]=r),typeof a.id=="number"&&(r.id=a.id),a.name!==""&&(r.attrName=a.name),a.type!==""&&(r.attrType=a.type),this.pushStack(r)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let i="",s="";return e.length>1&&(i=e[1].replace(/^(\w+)::/,""),s=e[2]),{id:t,name:i,type:s}}parseNodeProperty(e,t,i){let s=t[1].replace(/^"/,"").replace(/"$/,"").trim(),r=t[2].replace(/^"/,"").replace(/"$/,"").trim();s==="Content"&&r===","&&(r=i.replace(/"/g,"").replace(/,$/,"").trim());let a=this.getCurrentNode();if(a.name==="Properties70"){this.parseNodeSpecialProperty(e,s,r);return}if(s==="C"){let n=r.split(",").slice(1),h=parseInt(n[0]),u=parseInt(n[1]),c=r.split(",").slice(3);c=c.map(function(p){return p.trim().replace(/^"/,"")}),s="connections",r=[h,u],Jp(r,c),a[s]===void 0&&(a[s]=[])}s==="Node"&&(a.id=r),s in a&&Array.isArray(a[s])?a[s].push(r):s!=="a"?a[s]=r:a.a=r,this.setCurrentProp(a,s),s==="a"&&r.slice(-1)!==","&&(a.a=Vr(r))}parseNodePropertyContinued(e){let t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=Vr(t.a))}parseNodeSpecialProperty(e,t,i){let s=i.split('",').map(function(u){return u.trim().replace(/^\"/,"").replace(/\s/,"_")}),r=s[0],a=s[1],o=s[2],n=s[3],h=s[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":h=parseFloat(h);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":h=Vr(h);break}this.getPrevNode()[r]={type:a,type2:o,flag:n,value:h},this.setCurrentProp(this.getPrevNode(),r)}},qr=class{parse(e){let t=new Li(e);t.skip(23);let i=t.getUint32();if(i<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+i);let s=new ki;for(;!this.endOfContent(t);){let r=this.parseNode(t,i);r!==null&&s.add(r.name,r)}return s}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){let i={},s=t>=7500?e.getUint64():e.getUint32(),r=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();let a=e.getUint8(),o=e.getString(a);if(s===0)return null;let n=[];for(let p=0;p<r;p++)n.push(this.parseProperty(e));let h=n.length>0?n[0]:"",u=n.length>1?n[1]:"",c=n.length>2?n[2]:"";for(i.singleProperty=r===1&&e.getOffset()===s;s>e.getOffset();){let p=this.parseNode(e,t);p!==null&&this.parseSubNode(o,i,p)}return i.propertyList=n,typeof h=="number"&&(i.id=h),u!==""&&(i.attrName=u),c!==""&&(i.attrType=c),o!==""&&(i.name=o),i}parseSubNode(e,t,i){if(i.singleProperty===!0){let s=i.propertyList[0];Array.isArray(s)?(t[i.name]=i,i.a=s):t[i.name]=s}else if(e==="Connections"&&i.name==="C"){let s=[];i.propertyList.forEach(function(r,a){a!==0&&s.push(r)}),t.connections===void 0&&(t.connections=[]),t.connections.push(s)}else if(i.name==="Properties70")Object.keys(i).forEach(function(r){t[r]=i[r]});else if(e==="Properties70"&&i.name==="P"){let s=i.propertyList[0],r=i.propertyList[1],a=i.propertyList[2],o=i.propertyList[3],n;s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),r==="Color"||r==="ColorRGB"||r==="Vector"||r==="Vector3D"||r.indexOf("Lcl_")===0?n=[i.propertyList[4],i.propertyList[5],i.propertyList[6]]:n=i.propertyList[4],t[s]={type:r,type2:a,flag:o,value:n}}else t[i.name]===void 0?typeof i.id=="number"?(t[i.name]={},t[i.name][i.id]=i):t[i.name]=i:i.name==="PoseNode"?(Array.isArray(t[i.name])||(t[i.name]=[t[i.name]]),t[i.name].push(i)):t[i.name][i.id]===void 0&&(t[i.name][i.id]=i)}parseProperty(e){let t=e.getString(1),i;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return i=e.getUint32(),e.getArrayBuffer(i);case"S":return i=e.getUint32(),e.getString(i);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":let s=e.getUint32(),r=e.getUint32(),a=e.getUint32();if(r===0)switch(t){case"b":case"c":return e.getBooleanArray(s);case"d":return e.getFloat64Array(s);case"f":return e.getFloat32Array(s);case"i":return e.getInt32Array(s);case"l":return e.getInt64Array(s)}let o=pn(new Uint8Array(e.getArrayBuffer(a))),n=new Li(o.buffer);switch(t){case"b":case"c":return n.getBooleanArray(s);case"d":return n.getFloat64Array(s);case"f":return n.getFloat32Array(s);case"i":return n.getInt32Array(s);case"l":return n.getInt64Array(s)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}},Li=class{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){let t=[];for(let i=0;i<e;i++)t.push(this.getBoolean());return t}getUint8(){let e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){let e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){let e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){let t=[];for(let i=0;i<e;i++)t.push(this.getInt32());return t}getUint32(){let e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){let t=[];for(let i=0;i<e;i++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){let e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){let t=[];for(let i=0;i<e;i++)t.push(this.getFloat32());return t}getFloat64(){let e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){let t=[];for(let i=0;i<e;i++)t.push(this.getFloat64());return t}getArrayBuffer(e){let t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=this.offset,i=new Uint8Array(this.dv.buffer,t,e);this.skip(e);let s=i.indexOf(0);return s>=0&&(i=new Uint8Array(this.dv.buffer,t,s)),this._textDecoder.decode(i)}},ki=class{add(e,t){this[e]=t}};function Wp(l){let e="Kaydara FBX Binary  \0";return l.byteLength>=e.length&&e===Sn(l,0,e.length)}function qp(l){let e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],t=0;function i(s){let r=l[s-1];return l=l.slice(t+s),t++,r}for(let s=0;s<e.length;++s)if(i(1)===e[s])return!1;return!0}function Bn(l){let e=/FBXVersion: (\d+)/,t=l.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Yp(l){return l/46186158e3}var Xp=[];function Ti(l,e,t,i){let s;switch(i.mappingType){case"ByPolygonVertex":s=l;break;case"ByPolygon":s=e;break;case"ByVertice":s=t;break;case"AllSame":s=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}i.referenceType==="IndexToDirect"&&(s=i.indices[s]);let r=s*i.dataSize,a=r+i.dataSize;return Zp(Xp,i.buffer,r,a)}var Nr=new dt,St=new We;function wn(l){let e=new re,t=new re,i=new re,s=new re,r=new re,a=new re,o=new re,n=new re,h=new re,u=new re,c=new re,p=new re,d=l.inheritType?l.inheritType:0;l.translation&&e.setPosition(St.fromArray(l.translation));let g=Xt(0);if(l.preRotation){let S=l.preRotation.map(ge.degToRad);S.push(g),t.makeRotationFromEuler(Nr.fromArray(S))}if(l.rotation){let S=l.rotation.map(ge.degToRad);S.push(l.eulerOrder||g),i.makeRotationFromEuler(Nr.fromArray(S))}if(l.postRotation){let S=l.postRotation.map(ge.degToRad);S.push(g),s.makeRotationFromEuler(Nr.fromArray(S)),s.invert()}l.scale&&r.scale(St.fromArray(l.scale)),l.scalingOffset&&o.setPosition(St.fromArray(l.scalingOffset)),l.scalingPivot&&a.setPosition(St.fromArray(l.scalingPivot)),l.rotationOffset&&n.setPosition(St.fromArray(l.rotationOffset)),l.rotationPivot&&h.setPosition(St.fromArray(l.rotationPivot)),l.parentMatrixWorld&&(c.copy(l.parentMatrix),u.copy(l.parentMatrixWorld));let m=t.clone().multiply(i).multiply(s),A=new re;A.extractRotation(u);let f=new re;f.copyPosition(u);let C=f.clone().invert().multiply(u),v=A.clone().invert().multiply(C),x=r,b=new re;if(d===0)b.copy(A).multiply(m).multiply(v).multiply(x);else if(d===1)b.copy(A).multiply(v).multiply(m).multiply(x);else{let P=new re().scale(new We().setFromMatrixScale(c)).clone().invert(),F=v.clone().multiply(P);b.copy(A).multiply(m).multiply(F).multiply(x)}let I=h.clone().invert(),E=a.clone().invert(),B=e.clone().multiply(n).multiply(h).multiply(t).multiply(i).multiply(s).multiply(I).multiply(o).multiply(a).multiply(r).multiply(E),w=new re().copyPosition(B),D=u.clone().multiply(w);return p.copyPosition(D),B=p.clone().multiply(b),B.premultiply(u.invert()),B}function Xt(l){l=l||0;let e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return l===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[l]}function Vr(l){return l.split(",").map(function(t){return parseFloat(t)})}function Sn(l,e,t){return e===void 0&&(e=0),t===void 0&&(t=l.byteLength),new TextDecoder().decode(new Uint8Array(l,e,t))}function Jp(l,e){for(let t=0,i=l.length,s=e.length;t<s;t++,i++)l[i]=e[t]}function Zp(l,e,t,i){for(let s=t,r=0;s<i;s++,r++)l[r]=e[s];return l}var te={NONE:0,ERROR:1,WARN:2,INFO:3,DEBUG:4},$p={AUTO:-1,JPG:0,JPEG:0,PNG:1,WEBP:2,FBX:3,GLTF:4,GLB:5},Jt={OFF:0,LOW:1,MEDIUM:2,HIGH:3},Yr={SKY:0,SCENE:1,PARTICLES:5,GLOW:6,GLOW_MASK:7},Qi={OFF:0,VAPOR:1},eA={OFF:0,BASIC:1,SOFT:2},T={FLOOR:0,WALL:1,WALL_TOP:2,CEILING:3,PORTAL_WARP:4,ROOM_WARP:5,ITEM:6,SCRIPTED:7,HOVERABLE:8,CLICKABLE:9},Zt={FRONT:0,BACK:1,DOUBLE:2},tA={MOVE:0,ROTATE:1,JUMP:2,FALL:3,LANDED:4,COLLISION:5},iA={KEEP:0,sRGB_TO_LINEAR:1,LINEAR_TO_sRGB:2,WINDOWS_TO_UNIX:3,UNIX_TO_WINDOWS:4,LINEAR_TO_WINDOWS:5,WINDOWS_TO_LINEAR:6,LINEAR_TO_UNIX:7,UNIX_TO_LINEAR:8},sA={STOP:0,SLOW:1,BASE:2,BOOST:3},rA={KEYBOARD:0,MOBILE:1,GAMEPAD:2,XR:3,VR:3,AR:3,OTHER:4},aA={CONNECT:0,DISCONNECT:1,BUTTON_PRESS:2,AXIS_MOVE:3,AXIS_LOOK:4},oA={B_L:0,B_U:1,B_R:2,B_D:3,L1:4,R1:5,L2:6,R2:7,SELECT:8,START:9,L3:10,R3:11,UP:12,DOWN:13,LEFT:14,RIGHT:15},Dt={MOVE:0,MOVE_X:1,MOVE_Y:2,LOOK:3,LOOK_X:4,LOOK_Y:5,JUMP:6,RUN:7,ACTION:8,ACTION_ALT:9,ITEM:10,MENU:11,PAUSE:12,MAP:13},ne={REGION:0,DRAG_REGION:1,BUTTON:2,THUMBSTICK:3,SLIDER:4,IMAGE:5,TEXT:6},ft={NONE:0,CLICK:1,HOVER:2,ACTIVE:3,DRAG:4,DROP:5},Xr={DEFAULT:0,BLENDED:1},z={VERBOSE_LEVEL:te,FILE_TYPE:$p,ANTI_ALIASING:Jt,RENDER_LAYER:Yr,SKY_HAZE:Qi,SHADOW_MAP:eA,CAMERA_EVENT:tA,COLLIDER_TYPE:T,GEOMETRY_SIDE:Zt,COLOR_SHIFT:iA,USER_SPEED:sA,DEVICE_TYPE:rA,DEVICE_EVENT:aA,DEVICE_BUTTON:oA,DEVICE_ACTION:Dt,HUD_ELEMENT:ne,HUD_ACTION:ft,HUD_DRAW:Xr};function _i(l){return new Mi(l)}var qe=class{constructor(e={}){this.pxlTimer=null,this.pxlUtils=null,this.pxlQuality=null,this.pxlEnums=null,this.pxlVideo=null,this.pxlCamera=null,this.pxlAutoCam=null,this.pxlUser=null,this.pxlEnv=null,this.pxlAnim=null,this.pxlDevice=null,this.pxlShaders=null,this.pxlColliders=null,this.verbose=!1,this.pxlOptions={},this.runDebugger=!1,this.assetRoot=this.findInDict(e,"assetRoot","images/assets/"),this.guiRoot=this.findInDict(e,"guiRoot","images/GUI/"),this.roomRoot=this.findInDict(e,"roomRoot","images/rooms/"),this.vidRoot=this.findInDict(e,"vidRoot","images/screenContent/"),this.workerList=[],this.oneTwoPFour=1/2.4,this.twelvePNineTwoDiv=1/12.92,this.onePOFiveFiveDiv=1/1.055}setDependencies(e){this.pxlTimer=e.pxlTimer,this.pxlUtils=e.pxlUtils,this.pxlQuality=e.pxlQuality,this.pxlEnums=e.pxlEnums,this.pxlVideo=e.pxlVideo,this.pxlCamera=e.pxlCamera,this.pxlAutoCam=e.pxlAutoCam,this.pxlUser=e.pxlUser,this.pxlEnv=e.pxlEnv,this.pxlAnim=e.pxlAnim,this.pxlDevice=e.pxlDevice,this.pxlShaders=e.pxlShaders,this.pxlColliders=e.pxlColliders,this.pxlOptions=e.pxlOptions,this.verbose=this.pxlOptions.verbose}setLogging(e=!1){this.runDebugger=e}log(...e){(this.runDebugger||this.verbose>=this.pxlEnums.VERBOSE_LEVEL.DEBUG)&&(console.log("---"),e.forEach(t=>{console.log(t)}))}warn(...e){(this.runDebugger||this.verbose>=this.pxlEnums.VERBOSE_LEVEL.WARN)&&e.forEach(t=>{console.warn(t)})}debug(...e){(this.runDebugger||this.verbose>=this.pxlEnums.VERBOSE_LEVEL.DEBUG)&&e.forEach(t=>{console.log(t)})}toggleDebugger(e=null){e||(e=!this.runDebugger),this.runDebugger=e}findInDict(e,t,i){return e.hasOwnProperty(t)?e[t]:(e[t]=i,i)}convertVertColor(e,t=this.pxlEnums.COLOR_SHIFT.KEEP){if(e.geometry&&e.geometry.attributes&&e.geometry.attributes.color){let i=e.geometry.attributes.color;for(let s=0;s<i.count;++s){let r=new y.Color().fromBufferAttribute(i,s);this.pxlUtils.convertColor(r,t),i.setXYZ(s,r.r,r.g,r.b)}i.needsUpdate=!0}}checkForUserData(e,t,i){if(i.hasOwnProperty("userData")){if(i.hasOwnProperty("material")&&(i.userData.hasOwnProperty("doubleSided")&&i.userData.doubleSided?i.material.side=y.DoubleSide:i.material.side=y.FrontSide),i.userData.hasOwnProperty("pSystem")&&i.userData.pSystem){let s=this.pSystemBuild(i,e);s&&(e.pSystemList||(e.pSystemList={}),e.pSystemList[i.name]=s,t.add(s),i.parent.remove(i),i=s)}i.userData.hasOwnProperty("GlowPass")&&i.userData.GlowPass&&(e.geoList.GlowPass||(e.geoList.GlowPass=[]),i.layers.set(this.pxlEnums.RENDER_LAYER.GLOW),e.geoList.GlowPass.push(i)),i.userData.hasOwnProperty("GlowPassMask")&&i.userData.GlowPass&&(e.geoList.GlowPassMask||(e.geoList.GlowPassMask=[]),i.layers.set(this.pxlEnums.RENDER_LAYER.GLOW_MASK),e.geoList.GlowPassMask.push(i)),i.userData.hasOwnProperty("castShadow")&&i.userData.castShadow&&(i.castShadow=!0),i.userData.hasOwnProperty("receiveShadow")&&i.userData.receiveShadow&&(i.receiveShadow=!0),i.userData.hasOwnProperty("Shader")&&i.userData.Shader!==""&&(e.shaderGeoList||(e.shaderGeoList={}),e.shaderGeoList[i.name]=i),i.userData.hasOwnProperty("Emitter")&&i.userData.Emitter!==""&&(e.emitterList||(e.emitterList={}),e.emitterList[i.userData.Emitter]||(e.emitterList[i.userData.Emitter]={},e.emitterList[i.userData.Emitter].Emitter=[],e.emitterList[i.userData.Emitter].Particles=[]),e.emitterList[i.userData.Emitter].Emitter.push(i)),i.userData.hasOwnProperty("Hover")&&i.userData.Hover&&(e.hasHoverables=!0,e.hoverableList.push(i)),i.userData.hasOwnProperty("Click")&&i.userData.Click&&(e.hasClickables=!0,e.clickableList.push(i)),this.checkObjectInstancing(e,t,i),i.userData.hasOwnProperty("Scripted")&&(e.geoList.hasOwnProperty("Scripted")||(e.geoList.Scripted={}),e.geoList.Scripted[i.name]=i,i.children.forEach(r=>{if(r.name.includes("Geo")){let a=i.position,o=i.rotation,n=i.scale;r.position.set(a.x,a.y,a.z),r.rotation.set(o.x,o.y,o.z),r.scale.set(n.x,n.y,n.z),r.updateMatrix(),r.children.forEach(u=>{this.checkForColorSpace(e,u),this.checkForUserData(e,t,u),u.type==="Group"&&(u.position.set(a.x+u.position.x,a.y+u.position.y,a.z+u.position.z),u.rotation.set(o.x,o.y,o.z),u.scale.set(n.x,n.y,n.z)),u.updateMatrix()})}else if(r.name.includes("Colliders")){let a=i.position,o=i.rotation,n=i.scale;r.position.set(a.x,a.y,a.z),r.rotation.set(o.x,o.y,o.z),r.scale.set(n.x,n.y,n.z),r.updateMatrix(),r.visible=!1}}))}}checkForColorSpace(e,t){t.type}checkForMeshSettings(e,t){t.hasOwnProperty("meshSettings")&&(t.meshSettings.hasOwnProperty("frontSided")&&(e.side=t.meshSettings.frontSided?y.FrontSide:y.BackSide),t.meshSettings.hasOwnProperty("doubleSided")&&(e.side=t.meshSettings.doubleSided?y.DoubleSide:y.FrontSide),t.meshSettings.hasOwnProperty("renderOrder")&&(e.renderOrder=t.meshSettings.renderOrder),t.meshSettings.hasOwnProperty("castShadow")&&(e.castShadow=t.meshSettings.castShadow),t.meshSettings.hasOwnProperty("receiveShadow")&&(e.receiveShadow=t.meshSettings.receiveShadow))}canAppendChildren(e,t){if(t.type!=="Group")return!1;let i=!0;return e.geoList.hasOwnProperty("Scripted")&&e.geoList.Scripted.hasOwnProperty(t.name)&&(i=!1),i}canAddToScene(e,t){let i=!0;return t.hasOwnProperty("userData")&&(t.userData.hasOwnProperty("Instance")||t.userData.hasOwnProperty("MobileInstance"))&&e.hasOwnProperty("baseInstancesNames")&&e.baseInstancesNames.hasOwnProperty(t.userData.Instance)&&(i=!1),i}checkIsGlassLiquid(e,t,i,s){let r=!1;if(i.userData.hasOwnProperty("isGlass")&&i.userData.isGlass&&(r=!0),i.userData.hasOwnProperty("isLiquid")&&i.userData.isLiquid&&(r=!0),!r)return!1;if(this.log("Glass Detected - ",i.name),!e.glassGroup){let d=new y.Group;e.glassGroup=d,t.add(d)}let a=i.material.clone();i.material=a,i.material.transparent=!0,i.material.opacity=.5,i.material.shininess=20,i.material.specular=i.material.color.clone(),i.material.specular.r=i.material.specular.r*.5+.1,i.material.specular.g=i.material.specular.g*.5+.1,i.material.specular.b=i.material.specular.b*.5+.1,i.material.side=y.BackSide,i.material.depthWrite=!1,i.matrixAutoUpdate=!1,i.renderOrder=1+e.glassList.length,e.glassList.push(i),e.glassGroup.add(i);let o=i.geometry.clone(),n=i.material.clone();n.copy(i.material);let h=new y.Mesh(o,n);h.name=i.name+"_Front",h.material.shininess=40,h.material.side=y.FrontSide,h.matrixAutoUpdate=!1,h.renderOrder=1+e.glassList.length;let u=i.position,c=i.rotation,p=i.scale;return h.rotation.set(c.x,c.y,c.z),h.position.set(u.x,u.y,u.z),h.scale.set(p.x,p.y,p.z),h.updateMatrix(),i.parent.add(h),e.glassList.push(h),e.glassGroup.add(h),r}checkObjectInstancing(e,t,i){if(!e.hasOwnProperty("baseInstancesNames")||!e.hasOwnProperty("baseInstancesList")||!(i.hasOwnProperty("userData")&&(i.userData.hasOwnProperty("Instance")||i.userData.hasOwnProperty("MobileInstance"))))return!1;if(!e.baseInstancesList.hasOwnProperty(i.userData.Instance))return this.warn(`Instance '${i.userData.Instance}' not found for ${i.name}`),!1;let s=i.name;this.log("Generate Instance - ",s),e.geoList.hasOwnProperty("InstanceObjects")||(e.geoList.InstanceObjects={});let r=new RegExp(/(instlod)\d+/,"i"),a=new RegExp(/\d+/,"i"),o=new RegExp(/(instlod)\d+(dist)/,"i"),n=new RegExp(/(instlod)\d+(skip)/,"i"),h={lod0:{mesh:i,dist:1}},u={mesh:i,instMesh:null,dist:1,skip:0},c=!1,p=null,d={};try{Object.keys(i.userData).forEach(f=>{if(r.test(f)){let v=a.exec(f);if(!v||v.length<1)return;v=parseInt(v[0]);let x={};if(d.hasOwnProperty(v)||(d[v]=Object.assign({},u)),x=d[v],o.test(f)){let b=i.userData[f];x.dist=b}else if(n.test(f)){let b=i.userData[f];x.skip=b}else x.instMesh=i.userData[f]}})}catch(A){this.verbose>=this.pxlEnums.VERBOSE_LEVEL.ERROR&&console.error(A)}let g=i.children;for(let A=0;A<g.length;++A){if(!g[A].hasOwnProperty("userData"))continue;let f=g[A].userData;for(let C=0;C<f.length;++C){let v=f[C],x=r.test(v),b=Object.assign({},u);if(x){let I=a.exec(v);d.hasOwnProperty(I)&&(b=d[I])}if(o.test(v)){let I=f[v];b.dist=I}else if(n.test(v)){let I=f[v];b.skip=I}else b.instMesh=f[v]}}let m=Object.keys(h);try{c&&(p=new y.LOD,p.name=s+"_LOD_TOPLVL",p.userData=Object.assign({},i.userData),p.userData.pxlInstanceToMesh=!0,e.geoList.InstanceObjects[s]=p,e.lodList.push(p),i.parent.add(p));for(let A=0;A<m.length;++A){let f=h[m[A]].mesh,C=f.position,v=f.rotation,x=f.scale,b=this.pxlOptions.mobile&&f.userData.hasOwnProperty("MobileInstance")?f.userData.MobileInstance:f.userData.Instance,I=e.baseInstancesList[b];if(f.type==="Mesh"){let E=new y.Matrix4,B=new y.Vector3,w=new y.Vector3,D=new y.Quaternion,S=new y.Vector3(1,1,1),P=f.geometry.attributes.hasOwnProperty("color"),F=Object.keys(f.userData),O=F.map(Q=>Q.toLowerCase()),N=!1,M=0,L=1;O.includes("minscale")&&(N=!0,M=f.userData[F[O.indexOf("minscale")]]),O.includes("maxscale")&&(N=!0,L=f.userData[F[O.indexOf("maxscale")]]);let H={},k=[];for(let Q=0;Q<f.geometry.attributes.position.count;++Q){B.fromBufferAttribute(f.geometry.attributes.position,Q);let K=B.toArray();if(K=this.pxlUtils.flattenArrayToStr(K),!H.hasOwnProperty(K)){if(f.geometry.attributes.normal){w.fromBufferAttribute(f.geometry.attributes.normal,Q);let _=w.clone();_=_.cross(new y.Vector3(0,1,0)).cross(_).normalize(),D.setFromUnitVectors(w,_)}else{let _=new y.Vector3(Math.random(),Math.random()*.1,Math.random()).normalize();w.copy(_);let $=new y.Vector3(0,1,0).cross(_).normalize();D.setFromUnitVectors(_,$)}let Y=S;if(P){let _=f.geometry.attributes.color.getX(Q);N&&(_=M+(L-M)*_),Y=new y.Vector3(_,_,_)}E.compose(B,D,Y),k.push(E.clone()),H[K]=!0}}if(k.length>0){let Q=new y.InstancedMesh(I.geometry,I.material,k.length);Q.instanceMatrix.setUsage(y.DynamicDrawUsage),Q.userData=Object.assign({},f.userData),Q.userData.pxlInstanceToMesh=!0,this.checkForMeshSettings(Q,I.material);for(let K=0;K<k.length;++K)Q.setMatrixAt(K,k[K]);if(Q.visible=!0,Q.position.set(C.x,C.y,C.z),Q.rotation.set(v.x,v.y,v.z),Q.scale.set(x.x,x.y,x.z),Q.updateMatrix(),c){Q.name=s+"Geo_"+m[A];let K=h[m[A]].dist;p.addLevel(Q,K)}else Q.name=s+"Geo",e.geoList.InstanceObjects[s]=Q,f.parent.add(Q);f.visible=!1}}else{let E=new y.InstancedMesh(I.geometry,I.material,1);E.instanceMatrix.setUsage(y.DynamicDrawUsage),E.userData=Object.assign({},f.userData),E.userData.pxlInstanceToMesh=!1,this.checkForMeshSettings(E,I.material);let B=!1;if(f.userData.hasOwnProperty("fixInstMatrix")&&(B=!!f.userData.fixInstMatrix),B)E.rotation.set(v.x,v.y,v.z),E.position.set(C.x,C.y,C.z),E.scale.set(x.x,x.y,x.z);else{let w=new y.Matrix4;w.compose(C,new y.Quaternion().setFromEuler(v),x),E.setMatrixAt(0,w)}if(E.visible=!0,E.updateMatrix(),c){E.name=s+"Geo_"+m[A];let w=h[m[A]].dist;p.addLevel(E,w)}else E.name=s+"Geo",e.geoList.InstanceObjects[s]=E,f.parent.add(E);f.visible=!1,f.parent.remove(f)}}}catch(A){this.verbose>=this.pxlEnums.VERBOSE_LEVEL.ERROR&&console.error(A)}if(this.verbose>=this.pxlEnums.VERBOSE_LEVEL.DEBUG&&c){let A="Failed",f=-1,C=[];p!=null&&p.levels&&(A="Created",f=p.levels,C=Object.keys(f));let v="Instance LODs "+A+" - "+s;this.log(v),C.length>0&&(v="LOD Levels - "+f,this.log(v),this.log(p))}}pSystemBuild(e,t){if(!e.hasOwnProperty("userData")||!e.userData.hasOwnProperty("pSystem")||!e.userData.pSystem)return null;this.log("Processing Particle System - ",e.name);try{let i=e;if(i.type==="Mesh"){let s=new y.Vector3,r=i.geometry.attributes.hasOwnProperty("color"),a=Object.keys(i.userData),o=a.map(m=>m.toLowerCase()),n=!1,h=0,u=1;o.includes("minscale")&&(n=!0,h=i.userData[a[o.indexOf("minscale")]]),o.includes("maxscale")&&(n=!0,u=i.userData[a[o.indexOf("maxscale")]]);let c={},p=[],d=i.geometry.attributes.hasOwnProperty("color"),g=[];for(let m=0;m<i.geometry.attributes.position.count;++m){s.fromBufferAttribute(i.geometry.attributes.position,m);let A=s.toArray();if(A=this.pxlUtils.flattenArrayToStr(A),!c.hasOwnProperty(A)){if(d&&(g.push(i.geometry.attributes.color.getX(m)),g.push(i.geometry.attributes.color.getY(m)),g.push(i.geometry.attributes.color.getZ(m))),r){let f=i.geometry.attributes.color.getX(m);n&&(f=h+(u-h)*f)}p.push(s.x),p.push(s.y),p.push(s.z),c[A]=!0}}if(p.length>0){let m=new y.Float32BufferAttribute(p,3),A=new y.BufferGeometry;A.setAttribute("position",m),A.userData=Object.assign({},i.userData),A.userData.pSystem=!0;let f=new y.Vector3(0,0,0);f.equals(i.position)||(A.userData.pPosition=i.position),f.equals(i.rotation)||(A.userData.pRotation=i.rotation),f.equals(i.scale)||(A.userData.pScale=i.scale),A.computeBoundingBox(),A.computeBoundingSphere(),t.particleList[i.name]=A,i.parent.remove(i);return}}}catch(i){this.verbose>=this.pxlEnums.VERBOSE_LEVEL.ERROR&&console.error(i)}}loadSceneFBX(e,t,i,s,r,a){r!==""&&(this.pxlEnv.geoLoadListComplete=0,this.pxlEnv.geoLoadList[r]=0);var o=_i();return o.load(e,n=>{let h=n.children,u={},c=[];h.forEach((p,d)=>{let g=p.name.toLowerCase();c.push(g),u[g]=d}),c.forEach(p=>{if(p.includes("camera")&&(h[u[p]].children.forEach((g,m)=>{if(g.matrixAutoUpdate=!1,g.name.includes("position")){let A=g.position.clone();this.pxlCamera.cameraPrevPos=A.clone(),this.pxlCamera.camera.position.copy(A),this.pxlCamera.cameraPos.copy(A),this.pxlCamera.camera.updateMatrixWorld(),this.pxlCamera.cameraBooted=!0,this.pxlEnv.camInitPos=A,this.pxlEnv.camThumbPos=this.pxlEnv.camThumbPos.clone().add(A.clone())}else if(g.name.includes("lookat")){let A=g.position.clone();this.pxlCamera.cameraAimTarget.position.copy(A),this.pxlCamera.camera.lookAt(A),this.pxlCamera.camera.updateMatrixWorld(),this.pxlCamera.cameraPrevLookAt=new y.Vector3,this.pxlEnv.camInitLookAt=A,this.pxlEnv.camThumbLookAt=this.pxlEnv.camThumbLookAt.clone().add(A.clone())}else if(g.name.includes("returnposition")){let A=g.position.clone();this.pxlEnv.camReturnPos=A}else if(g.name.includes("returnlookat")){let A=g.position.clone();this.pxlEnv.camReturnLookAt=A}}),this.pxlDevice.touchMouseData.initialQuat=this.pxlCamera.camera.quaternion.clone()),p.includes("Items")){let d=h[u[p]].children,g=null,m=null,A=null,f=null,C=(v,x)=>{v.forEach(b=>{b.name.includes("Item")?(x.includes("LowGravity")?(m==null&&(m=new y.ShaderMaterial({uniforms:{color:{value:b.material.emissive.clone()},alphaMap:{type:"t",value:b.material.map},cloudNoise:{type:"t",value:this.pxlEnv.cloud3dTexture},time:{value:this.pxlTimer.msRunner},intensity:{type:"f",value:1.5},rate:{type:"f",value:this.pxlUser.itemRotateRate}},vertexShader:this.pxlShaders.objects.itemVert(),fragmentShader:this.pxlShaders.objects.itemFrag(),transparent:!0,side:y.DoubleSide,depthTest:!0,depthWrite:!1})),b.material=m):x.includes("LizardKing")?(A==null&&(A=b.material.clone(),A.emissiveMap=A.map,A.emissive=new y.Color(8421504)),b.material=A):x.includes("StarField")||x.includes("InfinityZoom")&&(f==null&&(f=new y.ShaderMaterial({uniforms:{color:{value:b.material.map},cloudNoise:{type:"t",value:this.pxlEnv.cloud3dTexture},time:{value:this.pxlTimer.msRunner},intensity:{type:"f",value:1},rate:{type:"f",value:this.pxlUser.itemRotateRate}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.objects.itemZoomFrag(),transparent:!0,side:y.DoubleSide,depthTest:!0,depthWrite:!0})),b.material=f),this.pxlUser.itemList[x]=b):b.name.includes("ItemBase")&&(g==null&&(g=new y.ShaderMaterial({uniforms:{color:{value:b.material.emissive.clone()},alphaMap:{type:"t",value:b.material.map},cloudNoise:{type:"t",value:this.pxlEnv.cloud3dTexture},time:{value:this.pxlTimer.msRunner},intensity:{type:"f",value:1.5},rate:{type:"f",value:this.pxlUser.itemBaseRotateRate}},vertexShader:this.pxlShaders.objects.itemBaseVert(),fragmentShader:this.pxlShaders.objects.itemBaseFrag(),transparent:!0,side:y.DoubleSide,depthTest:!0,depthWrite:!1})),b.material=g,this.pxlUser.itemBaseList.push(b))})};for(;d.length>0;){let v=d.pop();if(v.type==="Group"){let x=v.children;C(x,v.name),a[0].add(v),this.pxlUser.itemGroupList[v.name]=v,this.pxlUser.itemListNames.push(v.name)}}}}),r!==""&&(this.pxlEnv.geoList[r]=n,this.pxlEnv.geoLoadList[r]=1),this.pxlEnv.geoLoadList[r]=1},void 0,n=>{r!==""&&(this.pxlEnv.geoLoadList[r]=1)}),o}getSettings(){return{fileType:this.pxlEnums.FILE_TYPE.AUTO,filePath:"",meshKey:"",meshIsChild:!1,enableLogging:!1}}readSettings(e,t){let i=Object.assign(this.getSettings(),t);if(this.setLogging(i.enableLogging),(i.filePath===null||i.filePath==="")&&e.hasOwnProperty("sceneFile")&&(i.filePath=e.sceneFile),i.filePath===null||i.filePath==="")return this.warn("No Path Provided for Environment Load"),i.filePath=null,i;if(i.fileType===this.pxlEnums.FILE_TYPE.AUTO||typeof i.fileType!="number"){let s=i.filePath.split(".").pop().toLowerCase();s==="fbx"?i.fileType=this.pxlEnums.FILE_TYPE.FBX:s==="glb"?i.fileType=this.pxlEnums.FILE_TYPE.GLB:s==="gltf"&&(i.fileType=this.pxlEnums.FILE_TYPE.GLTF)}return i.meshKey===""&&(i.meshKey=e.getName()),i.verified=!0,i}verifySettings(e,t){return!t.hasOwnProperty("verified")||!t.verified?this.readSettings(e,t):t}loadPath(e,t=null,i={}){let s=Object.assign(this.getSettings(),i);t!==null&&t!==""&&(s.filePath=t),s=this.readSettings(e,s),!(s.filePath===null||s.filePath==="")&&this.loadRoom(e,s)}loadRoom(e,t={}){let i=this.readSettings(e,t);if(i.filePath===null||i.filePath==="")return;let s=i.fileType;s===this.pxlEnums.FILE_TYPE.FBX?this.loadRoomFBX(e,i):(s===this.pxlEnums.FILE_TYPE.GLB||s===this.pxlEnums.FILE_TYPE.GLTF)&&this.loadRoomGLTF(e,i)}loadRoomGLTF(e,t={}){if(t=this.readSettings(e,t),!t.filePath)return;let i=new bt,s=new yt;s.setDecoderPath("https://threejs.org/examples/jsm/libs/draco/"),s.preload(),i.setDRACOLoader(s);let r=i;r.setMeshoptDecoder(wi);let a=new Pe;a.setTranscoderPath("https://threejs.org/examples/jsm/libs/basis/"),a.detectSupport(this.pxlEnv.engine),r.setKTX2Loader(a),this.loadRoomFile(r,e,t)}loadRoomFBX(e,t={}){if(t=this.readSettings(e,t),!!t.filePath){var i=_i();this.loadRoomFile(i,e,t)}}loadRoomFile(e,t,i={}){if(i=this.verifySettings(t,i),!i.filePath)return;let s=i.meshKey,r=i.filePath,a=t.materialList;this.pxlEnv.geoLoadListComplete=0,this.pxlEnv.geoLoadList[s]=0;let o=t.scene;return e.load(r,n=>{var p,d,g;n.hasOwnProperty("scenes")&&!n.hasOwnProperty("children")&&(n=n.scene);let h=n.children;if(h.length===1){let m=h[0];m.name.toLowerCase().includes("scene")||(h=m.children)}let u={},c=[];if(h.forEach((m,A)=>{let f=m.name.split("_")[0].toLowerCase();c.push(f),u[f]=A}),c.indexOf("camera")>-1){let m=[];this.log("Camera - ",h[u.camera]);let A=t.defaultCamLocation;h[u.camera].userData.hasOwnProperty("DefaultCam")&&(A=h[u.camera].userData.DefaultCam,t.defaultCamLocation=A),h[u.camera].children.forEach((v,x)=>{let b=v.name.toLowerCase();b.includes("position")||b.includes("lookat")||b.includes("returnposition")||b.includes("returnlookat")?m.push(v):v.children.length>0&&m.push(...v.children)}),m.forEach((v,x)=>{v.matrixAutoUpdate=!1;let b=v.parent.name.toLowerCase();b===h[u.camera].name.toLowerCase()&&(b="default"),t.camLocation.hasOwnProperty(b)||(t.camLocation[b]={},t.camLocation[b].position=new y.Vector3(0,0,-10),t.camLocation[b].lookat=new y.Vector3(0,0,0));let I=v.name.toLowerCase();if(I.includes("positionmobile")){let E=v.position.clone();t.cameraBooted=!0,t.camInitPos=E,t.camLocation[b].positionmobile=E}else if(I.includes("lookatmobile")){let E=v.position.clone();t.camInitLookAt=E,t.camLocation[b].lookatmobile=E}else if(I.includes("position")){let E=v.position.clone();t.cameraBooted=!0,t.camInitPos=E,t.camLocation[b].position=E}else if(I.includes("lookat")){let E=v.position.clone();t.camInitLookAt=E,t.camLocation[b].lookat=E}else if(I.includes("returnposition")){let E=v.position.clone();t.camReturnPos=E,t.camLocation[b].returnposition=E}else if(I.includes("returnlookat")){let E=v.position.clone();t.camReturnLookAt=E,t.camLocation[b].returnlookat=E}}),Object.keys(t.camLocation).forEach(v=>{let x=t.camLocation[v];x.hasOwnProperty("positionmobile")||(x.positionmobile=x.position),x.hasOwnProperty("lookatmobile")||(x.lookatmobile=x.lookat)})}if(c.indexOf("AutoCamPaths")>-1){let m=h[u.AutoCamPaths].children;for(this.log("AutoCamPaths - ",h[u.AutoCamPaths]),this.pxlAutoCam.autoCamPaths[t.getName()]=[];m.length>0;){let A=m.pop();if(A.type==="Group"){let f={};A.children.forEach(v=>{v.matrixAutoUpdate=!1,f[v.name]=v}),A.visible=!1,A.matrixAutoUpdate=!1,o.add(A),this.pxlAutoCam.autoCamPaths[t.getName()].push(f)}}}if(c.indexOf("instances")>-1&&this.pxlQuality.detailLimit===0){let m=[...h[u.instances].children];this.log("Instances - ",h[u.instances]),m.length>0&&(t.hasOwnProperty("baseInstancesNames")||(t.baseInstancesNames=[]),t.hasOwnProperty("baseInstancesList")||(t.baseInstancesList={}),m.forEach((A,f)=>{if(this.checkForColorSpace(t,A),this.checkForUserData(t,o,A),a.hasOwnProperty(A.name)){let C=null;A.material.map&&(C=A.material.map),A.material=a[A.name],this.checkForMeshSettings(A,A.material),C&&(A.material.uniforms.hasOwnProperty("diffuse")&&(A.material.uniforms.diffuse.value=C),A.material.hasOwnProperty("emissiveMap")&&(A.material.emissiveMap=C,A.material.emissive.r>0&&(A.material.emissiveIntensity=A.material.emissive.r))),A.matrixAutoUpdate=!1}t.baseInstancesNames.push(A),t.baseInstancesList[A.name]=A}))}if(c.indexOf("lights")>-1){let m=h[u.lights].children;for(this.log("Lights - ",h[u.lights]);m.length>0;){let A=m.pop();m.push(...A.children),A.type.includes("Light")&&(t.hasOwnProperty("lightList")||(t.lightList={}),t.geoList.hasOwnProperty("lights")||(t.geoList.lights=[]),A.type==="PointLight"&&(A.decay=Math.max(1.1,Math.min(3,A.intensity)),A.distance=A.distance===0?1e3*A.intensity:A.distance),t.lightList.hasOwnProperty(A.type)||(t.lightList[A.type]=[]),t.lightList[A.type].push(A),t.geoList.lights.push(A),A.matrixAutoUpdate=!1,o.add(A))}}if(c.includes("scene")||c.includes("mainscene")){let m=u.scene||u.mainscene,A=[...h[m].children];for(this.log("MainScene - ",h[m]);A.length>0;){let f=A.pop();if(this.log(`Cur Object - ${f.name}`),this.debug(f),this.checkForColorSpace(t,f),this.checkForUserData(t,o,f),f.isMesh){f.userData.hasOwnProperty("Show")&&(!f.userData.Show||f.userData.Show===0)&&(f.visible=!1),f.layers.set(this.pxlEnums.RENDER_LAYER.SCENE),t.geoList[f.name]=f;let C=y.FrontSide;if((f.userData.hasOwnProperty("doubleSided")||f.userData.hasOwnProperty("DoubleSided"))&&(C=y.DoubleSide),(f.userData.hasOwnProperty("scripted")||f.userData.hasOwnProperty("Scripted"))&&(t.geoList.hasOwnProperty("Scripted")||(t.geoList.Scripted={}),t.geoList.Scripted[f.name]=f),a.hasOwnProperty(f.name)){let v=null;f.material.map&&(v=f.material.map),f.material=a[f.name],this.checkForMeshSettings(f,f.material),v&&(f.material.uniforms.hasOwnProperty("diffuse")&&(f.material.uniforms.diffuse.value=v),f.material.hasOwnProperty("emissiveMap")&&(f.material.emissiveMap=v,f.material.emissive.r>0&&(f.material.emissiveIntensity=f.material.emissive.r))),f.matrixAutoUpdate=!1}else{let v=f.material;Array.isArray(f.material)||(v=[f.material]),this.checkIsGlassLiquid(t,o,f,v)||v.forEach(x=>{x.map&&!x.emissiveMap&&x.emissive.r>0&&(x.emissiveMap=x.map,x.emissiveIntensity=x.emissive.r,x.emissive=new y.Color(16777215)),x.side=C}),f.matrixAutoUpdate=!1}}else if(f.type.includes("Light"))t.lightList.hasOwnProperty(f.type)||(t.lightList[f.type]=[]),t.lightList[f.type].push(f);else if(f.type==="Group"){let C=!0;(f.userData.hasOwnProperty("scripted")||f.userData.hasOwnProperty("Scripted"))&&(t.geoList.hasOwnProperty("Scripted")||(t.geoList.Scripted={}),t.geoList.Scripted[f.name]=f),C&&A.push(...f.children)}}o.add(...h[m].children)}if(c.indexOf("glass")>-1){let m=h[u.glass].children;if(this.log("Glass - ",h[u.glass]),m.length>0){if(!t.glassGroup){let A=new y.Group;t.glassGroup=A,o.add(A)}for(;m.length>0;){let A=m.pop();if(m.push(...A.children),A.isMesh){this.checkForColorSpace(t,A),this.checkForUserData(t,o,A);let f=A.material.clone();A.material=f,A.material.transparent=!0,A.material.opacity=.5,A.material.shininess=20,A.material.specular=A.material.color.clone(),A.material.specular.r=A.material.specular.r*.5+.1,A.material.specular.g=A.material.specular.g*.5+.1,A.material.specular.b=A.material.specular.b*.5+.1,A.material.side=y.BackSide,A.material.depthWrite=!1,A.matrixAutoUpdate=!1,A.renderOrder=1,t.glassList.push(A),t.glassGroup.add(A);let C=A.geometry.clone(),v=A.material.clone();v.copy(A.material);let x=new y.Mesh(C,v);x.material.shininess=40,x.material.side=y.FrontSide,x.matrixAutoUpdate=!1,x.renderOrder=2;let b=A.position,I=A.rotation,E=A.scale;x.rotation.set(I.x,I.y,I.z),x.position.set(b.x,b.y,b.z),x.scale.set(E.x,E.y,E.z),x.updateMatrix(),o.add(x),t.glassList.push(x),t.glassGroup.add(x)}}}}if(c.indexOf("colliders")>-1){let m=h[u.colliders];this.log("Colliders - ",h[u.colliders]);let A=m.children;t.collidersExist=A.length>0;for(let f=0;f<A.length;++f){let C=A[f].name.toLowerCase(),v=A[f].children;for(;v.length>0;){let x=v.pop();v.push(...x.children),x.isMesh&&(x.visible=!1,C==="colliderwalls"?(t.antiColliderActive=!0,t.antiColliderList.push(x)):C==="collidertops"?(t.antiColliderTopActive=!0,t.antiColliderTopList.push(x)):(C==="roomwarpzone"&&(t.hasRoomWarp=!0,t.roomWarp.push(x)),t.colliderActive=!0,t.colliderList.push(x)),x.matrixAutoUpdate=!1,o.add(x),t.geoList[x.name]=x)}}t.hasColliderType(this.pxlEnums.COLLIDER_TYPE.FLOOR)?this.pxlColliders.prepColliders(t,this.pxlEnums.COLLIDER_TYPE.FLOOR):t.hasColliderType(this.pxlEnums.COLLIDER_TYPE.WALL)?this.pxlColliders.prepColliders(t,this.pxlEnums.COLLIDER_TYPE.WALL):t.hasColliderType(this.pxlEnums.COLLIDER_TYPE.WALL_TOP)?this.pxlColliders.prepColliders(t,this.pxlEnums.COLLIDER_TYPE.WALL_TOP):t.hasColliderType(this.pxlEnums.COLLIDER_TYPE.ROOM)&&this.pxlColliders.prepColliders(t,this.pxlEnums.COLLIDER_TYPE.ROOM)}if(c.indexOf("portalexit")>-1){let m=h[u.portalexit].children;for(this.log("PortalExit - ",h[u.portalexit]);m.length>0;){let A=m.pop();A.matrixAutoUpdate=!1,t.hasPortalExit=!0,t.portalList[A.name]=A}}if(c.indexOf("flatcolor")>-1){let m=h[u.flatcolor].children;for(this.log("FlatColor - ",h[u.flatcolor]);m.length>0;){let A=m.pop();if(m.push(...A.children),A.isMesh){this.checkForColorSpace(t,A),this.checkForUserData(t,o,A);let f=new y.MeshBasicMaterial({color:A.material.color.clone()});f.side=y.FrontSide,f.flatShading=!0,A.material=f,A.layers.set(this.pxlEnums.RENDER_LAYER.SCENE),A.matrixAutoUpdate=!1,o.add(A)}}}if(c.indexOf("lambertcolor")>-1){let m=h[u.lambertcolor].children;for(this.log("LambertColor - ",h[u.lambertcolor]);m.length>0;){let A=m.pop();if(m.push(...A.children),A.isMesh){this.checkForColorSpace(t,A),this.checkForUserData(t,o,A);let f=new y.MeshLambertMaterial;if(A.material.map){let C=A.material.map.clone();f.map=C,A.material=f}else f.color=A.material.color.clone(),f.side=y.FrontSide,f.flatShading=!0,A.material=f;A.layers.set(this.pxlEnums.RENDER_LAYER.SCENE),A.matrixAutoUpdate=!1,o.add(A)}}}if(c.indexOf("sky")>-1){let m=h[u.sky].children;for(this.log("Sky - ",h[u.sky]);m.length>0;){let A=m.pop();if(m.push(...A.children),A.isMesh){let f=null;a.hasOwnProperty(A.name)?(f=a[A.name],this.checkForMeshSettings(A,f)):f=new y.ShaderMaterial({uniforms:{diffuse:{type:"t",value:A.material.map},noiseTexture:{type:"t",value:null},fogColor:{value:o.fog.color},time:{value:this.pxlTimer.msRunner},camNear:{type:"f",value:t.camera.near},camFar:{type:"f",value:t.camera.far*.85},resUV:{value:this.pxlDevice.screenRes}},vertexShader:this.pxlShaders.scene.skyObjectVert(),fragmentShader:this.pxlShaders.scene.skyObjectFrag(this.pxlOptions.skyHaze)}),A.material=f,A.matrixAutoUpdate=!1,A.frustumCulled=!1,A.layers.set(this.pxlEnums.RENDER_LAYER.SKY),A.material.depthTest=!0,A.material.depthWrite=!1,(p=A.material)!=null&&p.uniforms.hasOwnProperty("noiseTexture")&&(t!=null&&t.cloud3dTexture)&&(A.material.uniforms.noiseTexture.value=t.cloud3dTexture),(d=A.material)!=null&&d.uniforms.hasOwnProperty("depthTexture")&&((g=o==null?void 0:o.renderTarget)!=null&&g.depthTexture)&&(A.material.uniforms.envDiffuse.value=o.renderTarget.depthTexture),t.geoList[A.name]=A,t.materialList[A.name]=f,o.add(A)}}}if(c.indexOf("animatedtextures")>-1){let m=h[u.animatedtextures].children;for(this.log("AnimatedTextures - ",h[u.animatedtextures]);m.length>0;){let A=m.pop();if(m.push(...A.children),A.isMesh){this.checkForColorSpace(t,A),this.checkForUserData(t,o,A);let f={time:{value:this.pxlTimer.msRunner},glowTexture:{type:"t",value:A.material.map},cloudNoise:{type:"t",value:this.pxlEnv.cloud3dTexture},glowColor:{value:new y.Vector3(.01,.35,.55)},intensity:{type:"f",value:.35},rate:{type:"f",value:2},freq:{type:"f",value:1}},C=this.pxlShaders.animated.animTextureVert(),v=this.pxlShaders.animated.animTextureFrag(),x=new y.ShaderMaterial({uniforms:f,vertexShader:C,fragmentShader:v,transparent:!0,side:y.FrontSide});A.material=x,A.matrixAutoUpdate=!1,o.add(A)}}}if(c.indexOf("scrollingtextures")>-1){let m=h[u.scrollingtextures].children;this.log("ScrollingTextures - ",h[u.scrollingtextures]);let A=1;for(;m.length>0;){A+=1;let f=m.pop();if(m.push(...f.children),f.isMesh){this.checkForColorSpace(t,f),this.checkForUserData(t,o,f);let C=f.name,v=.05;C.indexOf("_")>-1&&(v=C.split("_")[1],v=parseInt(v)*.01);let x=new y.ShaderMaterial({uniforms:{scrollTexture:{type:"t",value:f.material.map},time:{value:this.pxlTimer.msRunner},speed:{value:v},seed:{type:"f",value:A*1.1423},boostPerc:{value:1}},vertexShader:this.pxlShaders.animated.scrollingTextureVert(),fragmentShader:this.pxlShaders.animated.scrollingTextureFrag(),transparent:!0,side:y.FrontSide});f.material=x,f.matrixAutoUpdate=!1,o.add(f)}}}if(c.indexOf("userscreens")>-1){let m=h[u.userscreens].children;this.log("UserScreens - ",h[u.userscreens]);let A=0,f=[new y.Vector3(1,0,0),new y.Vector3(0,1,0),new y.Vector3(0,0,1)],C=[this.assetRoot+"DJ_Vector_Masks_1.jpg",this.assetRoot+"DJ_Vector_Masks_2.jpg",this.assetRoot+"DJ_Vector_Masks_3.jpg"],v=0,x=0,b=f.length;for(;m.length>0;){let I=m.pop();if(m.push(...I.children),I.isMesh){let E=new y.ShaderMaterial({uniforms:{camExists:{type:"f",value:0},time:{value:this.pxlTimer.msRunner},seed:{type:"f",value:A*1.1423},alpha:{type:"f",value:1},boostPerc:{value:t.userScreenIntensity},scale:{value:new y.Vector2(100,100)},ratio:{value:new y.Vector2(1,1)},videoFeed:{type:"t",value:null},cloudNoise:{type:"t",value:this.pxlEnv.cloud3dTexture},maskChannel:{value:f[v]},maskMap:{type:"t",value:this.pxlUtils.loadTexture(C[x])}},vertexShader:t.userScreenVert,fragmentShader:t.userScreenFrag,transparent:!0,side:y.FrontSide});I.material=E,I.matrixAutoUpdate=!1,t.pxlEnv.camScreenData.screenGeoList.push(I),o.add(I),A+=1,v=A%b,x=Math.floor(A/3)%b}}}if(c.indexOf("items")>-1){let m=h[u.items].children;for(this.log("Items - ",h[u.items]);m.length>0;){let A=m.pop();if(A.type==="Group"){let f=A.children;f.length>0&&(f.forEach(C=>{if(C.name.includes("Item")){let v=new y.ShaderMaterial({uniforms:{color:{value:C.material.emissive.clone()},alphaMap:{type:"t",value:C.material.map},cloudNoise:{type:"t",value:this.cloud3dTexture},time:{value:this.pxlTimer.msRunner},intensity:{type:"f",value:1.5},rate:{type:"f",value:this.pxlUser.itemRotateRate}},vertexShader:this.pxlShaders.objects.itemVert(),fragmentShader:this.pxlShaders.objects.itemFrag(),transparent:!0,side:y.DoubleSide,depthTest:!0,depthWrite:!1});C.material=v,this.pxlUser.itemList[A.name]=C}else if(C.name.toLowerCase().includes("base")){let v=new y.ShaderMaterial({uniforms:{color:{value:C.material.emissive.clone()},alphaMap:{type:"t",value:C.material.map},cloudNoise:{type:"t",value:this.cloud3dTexture},time:{value:this.pxlTimer.msRunner},intensity:{type:"f",value:1.5},rate:{type:"f",value:this.pxlUser.itemBaseRotateRate}},vertexShader:this.pxlShaders.objects.itemBaseVert(),fragmentShader:this.pxlShaders.objects.itemBaseFrag(),transparent:!0,side:y.DoubleSide,depthTest:!0,depthWrite:!1});C.material=v,this.pxlUser.itemBaseList.push(C)}}),o.add(A),this.pxlUser.itemGroupList[A.name]=A,this.pxlUser.itemListNames.push(A.name))}}}if(c.includes("scripted")){let m=h[u.scripted].children;for(this.log("Scripted - ",h[u.scripted]);m.length>0;){let A=m.pop();A.isMesh&&(t.geoList[A.name]=A,o.add(A))}}if(c.includes("clickable")){let m=h[u.clickable];this.log("Clickable - ",h[u.clickable]);let A=m.children;for(let f=0;f<A.length;++f){let C=A[f].name,v=A[f].children;for(;v.length>0;){let x=v.pop();if(v.push(...x.children),x.isMesh){let b=new y.MeshBasicMaterial;b.color=new y.Color(16777215),x.material.emissive=new y.Color(4473924),x.material.emissiveMap=x.material.map,x.matrixAutoUpdate=!1,t.objectClickableObjectList[x.name]||(t.objectClickableObjectList[x.name]={}),t.objectClickableObjectList[x.name][C]=x,t.objectClickable.push(x),o.add(x),C==="Hover"&&(x.visible=!1)}}}}if(c.includes("markers")){let m=h[u.markers].children;for(this.log("Markers - ",h[u.markers]);m.length>0;){let A=m.pop();t.marker[A.name]=A.position}}this.pxlEnv.geoList[s]=n,this.pxlEnv.geoLoadList[s]=1,t.fbxPostLoad(),this.runDebugger=!1},null,n=>{i.hasOwnProperty("onError")?i.onError(n):(s!==""&&(this.pxlEnv.geoLoadList[s]=1),this.log("Error Loading FBX"),this.log(n),this.runDebugger=!1)}),e}loadAnimFBX(e,t,i,s,r){t===""&&(t=e.getName()),this.pxlEnv.geoLoadListComplete=0,this.pxlEnv.geoLoadList[t]=0;let a=e.scene,o=e.materialList;var n=_i();return n.load(i,h=>{let u=h.children,c={},p=[];u.forEach((A,f)=>{let C=A.name.split("_")[0];p.push(C),c[C]=f}),h.traverse(A=>{if(this.checkForColorSpace(e,A),this.checkForUserData(e,a,A),A.isMesh&&(e.geoList[A.name]=A),o.hasOwnProperty(A.name)){let f=null;A.material.map&&(f=A.material.map),A.material=o[A.name],this.checkForMeshSettings(A,A.material),f&&(A.material.uniforms.hasOwnProperty("diffuse")&&(A.material.uniforms.diffuse.value=f),A.material.hasOwnProperty("emissiveMap")&&(A.material.emissiveMap=f,A.material.emissive.r>0&&(A.material.emissiveIntensity=A.material.emissive.r))),A.matrixAutoUpdate=!1}A.userData.hasOwnProperty("doubleSided")&&A.userData.doubleSided&&(A.material.side=y.DoubleSide)}),this.pxlAnim.initObject(t,h),this.log("Animation FBX - ",p[0]),a.add(h),h.frustumCulled=!1;var d=_i();let g=[];Object.keys(s).forEach(A=>{let f=s[A],C=new Promise((v,x)=>{d.load(f,b=>{b.animations.length===0&&(this.log("No animations found in file",f),this.log(b),v()),this.pxlAnim.addClips(t,A,b),this.log("Animation Loaded",A),v()},null,b=>{this.log("Animation Load Error"),this.log(b),x(b)})});g.push(C)}),Promise.all(g).then(()=>{this.pxlAnim.setStateConnections(t,r),e.geoList[t]=h,this.pxlEnv.geoLoadList[t]=1,e.animPostLoad(t)}).catch(A=>{this.log("Error loading animations",A)})},null,h=>{t!==""&&(this.pxlEnv.geoLoadList[t]=1)}),n}pxlShaderBuilder(e,t,i,s=null){var r,a={diffuse:{type:"t",value:null},time:{value:this.pxlTimer.msRunner}};e!==null&&(a=Object.assign({},a,e));let o={uniforms:a,vertexShader:t,fragmentShader:i};return s&&(o.defines=s),r=new y.ShaderMaterial(o),r.transparent=!0,r.depthTest=!0,r}removeChildren(e){for(var t=0,i=e.children,s=0;s<i.length;++s)i[s].type==="Group"&&(e.remove(i[s]),t++);return t}findMesh(e){for(var t=null,i=e.children,s=0;s<i.length;++s)if(i[s].type==="Mesh"){t=i[s];break}return t}getBBoxCentroid(e){try{var t=new y.Box3().setFromObject(e),i=t.min,s=t.max,r=new y.Vector3().addVectors(s,i).multiplyScalar(.5);e.userData={bbox:t,centroid:r}}catch(a){this.verbose>=te.ERROR&&(console.log("- - - - - - - - ERROR - - - - - - - -"),console.log(`     Object does not exist.
           - Error Info -`),console.log(a),console.log("- - - - - - - - - - - - - - - - - - -"))}}loadScript(e){return new Promise((t,i)=>{let s=document.createElement("script");s.type="text/javascript",s.src=e,s.async=!0,s.onreadystatechange=()=>{t(!0)},s.onload=()=>{t(!0)},document.head.appendChild(s)})}xmlHttp(){if(typeof window!="undefined"&&window.XMLHttpRequest)return new XMLHttpRequest;if(typeof window!="undefined"&&typeof window.ActiveXObject!="undefined")return new window.ActiveXObject("Microsoft.XMLHTTP");throw new Error("No supported XMLHttpRequest implementation found.")}static getURLContent(e){return new Promise((t,i)=>{let s=null;typeof window!="undefined"&&window.XMLHttpRequest?s=new XMLHttpRequest:typeof window!="undefined"&&typeof window.ActiveXObject!="undefined"&&(s=new window.ActiveXObject("Microsoft.XMLHTTP")),s.open("GET",e),s.onload=r=>{s.readyState===4&&s.status>=200&&s.status<300?t(s.response):t(s.statusText)},s.onerror=()=>i(s.statusText),s.send()})}getExternalHTML(e,t){if(!window.XMLHttpRequest){window.open(e,"_blank");return}let i=this.xmlHttp();i.onreadystatechange=function(){this.readyState===4&&this.status===200&&t&&typeof t=="function"&&t(i.responseText)},i.open("GET",e,!0),i.responceType="document",i.send()}fetchURLStatus(e,t,i){fetch(e,{method:"HEAD"}).then(s=>{t(s.status,i)}).catch(s=>{t(404,i)})}urlExistsFallback(e){return new Promise((t,i)=>{let s=this.xmlHttp();s.open("HEAD",e,!0),s.send(),s.onreadystatechange=function(){this.readyState===this.DONE&&t(this.status<400)},s.onerror=r=>{t(!1)},s.ontimeout=r=>{t(!1)}})}urlExists(e){var t;return new Promise((i,s)=>{t?(t.onmessage=function(r){i(r.data.data)},t.onerror=function(r){i(!1)},t.postMessage({type:"urlExists",data:e})):this.urlExistsFallback(e).then(r=>{i(r)})}).then(i=>(t&&t.terminate(),i)).catch(i=>(t&&t.terminate(),!1))}};import{Vector3 as nA}from"three";var Fi=class{constructor(e,t=!1,i={}){this.pxlTimer=null,this.pxlCookie=null,this.pxlDevice=null,this.pxlRendering=null,this.pxlEnv=null,this.msLog=0,this.prevMS=new Date().getTime()*.001,this.autoQuality=!1,this.percent=1,this.verbose=e,this.screenResPerc=1,this.mBlurPercMult=t?.65:1,this.bloomPercMult=t?.65:1,this.bufferPercMult=1,this.renderTargetScale=10,this.percentSteps=[.3,.45,.85],this.fpsCounter=new nA(30,0,new Date().getTime()*.001),this.countAtLevel=0,this.shiftRate=.01,this.moduleQualityList=[],this.qualityStep=-1,this.qualityMaxSteps=3,this.qualityStepValues=[.25,.5,.75,1],this.benchmarkStart=-1,this.benchmarkTime=-1,this.benchmarkRating=-1,this.benchmarkTimes=[9,17],this.setFromBenchmark=!0,this.benchmarkQuality=1,this.benchmarkQualityRange=[.25,1],this.settingsQualityChoice=null,this.detailLimitOverride=Object.keys(i).includes("dlimit")?i.dlimit:0,this.detailLimit=this.detailLimitOverride!=null?this.detailLimitOverride:0,this.settings={leftRight:!0,mouse:!0,graphics:2,resolution:1,fog:2,bloom:!0,motion:!1},this.settingsLow={resolution:.5,fog:0,bloom:!1,motion:!1},this.settingsMedium={resolution:.75,fog:1,bloom:!0,motion:!1},this.settingsHigh={resolution:1,fog:2,bloom:!0,motion:!1},this.settingsCustom=null}setDependencies(e){this.pxlTimer=e.pxlTimer,this.pxlCookie=e.pxlCookie,this.pxlDevice=e.pxlDevice,this.pxlRendering=e.pxlRendering,this.pxlEnv=e.pxlEnv}init(){if(this.detailLimitOverride!=null?this.detailLimit=this.detailLimitOverride:this.pxlCookie.hasCookie("detailLimit")&&(this.detailLimit=this.pxlCookie.parseCookie("detailLimit")),this.verbose>=te.INFO&&console.log("Graphics Limiting is set to level ",this.detailLimit),this.setFromBenchmark=!this.pxlCookie.parseDict(this.settings),this.pxlCookie.hasCookie("leftRight")&&(this.settings.leftRight=this.pxlCookie.parseCookie("leftRight")),this.pxlCookie.hasCookie("mouse")&&(this.settings.mouse=this.pxlCookie.parseCookie("mouse")),this.pxlCookie.hasCookie("qualitySetting")){let e=this.pxlCookie.parseCookie("qualitySetting");this.settings.graphics=e,this.settingsQualityChoice=e}}step(){this.mapFpsQualitCheck()}attachModule(e=null){e&&this.moduleQualityList.push(e)}startBenchmark(){this.pxlTimer.step(),this.benchmarkStart=this.pxlTimer.curMS}endBenchmark(){this.pxlTimer.step();let e=this.pxlTimer.curMS-this.benchmarkStart;this.benchmarkTime=e,this.benchmarkRating=1-Math.min(1,Math.max(0,(e-this.benchmarkTimes[0])/(this.benchmarkTimes[1]-this.benchmarkTimes[0]))),this.benchmarkQuality=this.benchmarkRating*(this.benchmarkQualityRange[1]-this.benchmarkQualityRange[0])+this.benchmarkQualityRange[0];let t=Math.min(1,Math.max(0,this.benchmarkRating));t=Math.ceil(Math.max(.05,t)*this.qualityMaxSteps)-1,this.qualityStep=t,this.setFromBenchmark?this.setQualityLevel(this.qualityStep):(this.settingsQualityChoice===null&&(this.settingsQualityChoice=3),this.settingsCustom={},Object.keys(this.settingsHigh).forEach(s=>{this.settingsCustom[s]=this.settings[s]})),this.setDependentSettings()}mapFpsQualitCheck(){if(this.pxlTimer.curMS-this.fpsCounter.z>1){this.fpsCounter.x=this.fpsCounter.y,this.fpsCounter.y=0,this.fpsCounter.z=this.pxlTimer.curMS;let e=1;this.fpsCounter.x<15&&(e=-1);let t=Math.min(1,Math.max(0,this.percent+this.shiftRate*e));this.autoQuality&&this.mapAutoQualityUpdate(t,!1)}this.fpsCounter.y+=1,this.pxlTimer.prevMS=this.pxlTimer.curMS}mapAutoQualityUpdate(e=null,t=!1){let i=Math.min(1,Math.max(0,e));i=Math.ceil(Math.max(.05,i)*this.qualityMaxSteps)-1,this.qualityStep=i}setGraphicsSettings(e=null,t=3){if(e===null)if(this.qualityStep===0)e=this.settingsLow;else if(this.qualityStep===1)e=this.settingsMedium;else if(this.qualityStep===2)e=this.settingsHigh;else return;t===3&&this.checkCustomDict(),Object.keys(e).forEach(s=>{this.setComponentQuality(s,e[s]),this.settings[s]=e[s],t===3&&(this.settingsCustom[s]=e[s])}),this.setDependentSettings(),this.colliderPrevObjHit=null,t!=null&&(this.settings.graphics=t)}reapplySettings(){Object.keys(this.settingsLow).forEach(t=>{this.setComponentQuality(t,this.settings[t],!1)}),this.setDependentSettings()}setQualityLevel(e){this.pxlDevice.mobile&&(e=1),this.setQualityCookie(e),e===0?this.setLowQuality():e===1?this.setMediumQuality():e===2?this.setHighQuality():e===3&&this.setCustomQuality()}setLowQuality(){this.settingsQualityChoice=0,this.setGraphicsSettings(this.settingsLow,0)}setMediumQuality(){this.settingsQualityChoice=1,this.setGraphicsSettings(this.settingsMedium,1)}setHighQuality(){this.settingsQualityChoice=2,this.setGraphicsSettings(this.settingsHigh,2)}setCustomQuality(){this.checkCustomDict(),this.settingsQualityChoice=3,this.setGraphicsSettings(this.settingsCustom)}checkCustomDict(){if(this.settingsCustom===null){this.settingsCustom={};let e=this.settingsHigh;this.settingsQualityChoice&&(this.settingsQualityChoice===0?e=this.settingsLow:this.settingsQualityChoice===1?e=this.settingsMedium:this.settingsQualityChoice===2&&(e=this.settingsHigh)),Object.assign(this.settingsCustom,e)}}setQualityCookie(e){this.pxlCookie.setCookie("qualitySetting",e)}setComponentQuality(e,t,i=!0){switch(e){case"leftRight":this.settings[e]=t;break;case"mouse":this.settings[e]=t;break;case"resolution":this.screenResPerc=t,this.pxlDevice.resizeRenderResolution(),this.settings[e]=t,this.pxlEnv.geoList.snow&&this.pxlEnv.geoList.snow.material&&(this.pxlEnv.geoList.snow.material.uniforms.pointScale.value=this.pxlEnv.geoList.snow.pBaseScale*t);break;case"fog":this.pxlRendering.mapOverlayHeavyPass&&(this.pxlRendering.mapOverlayHeavyPass.enabled=t===2),this.pxlRendering.mapOverlayPass&&(this.pxlRendering.mapOverlayPass.enabled=t===1),this.pxlRendering.mapOverlaySlimPass&&(this.pxlRendering.mapOverlaySlimPass.enabled=t===0),this.pxlRendering.mapBoxAAPass.enabled&&(this.pxlRendering.mapBoxAAPass.enabled=t===2),this.pxlRendering.mapCrossAAPass.enabled&&(this.pxlRendering.mapCrossAAPass.enabled=t===1),this.pxlEnv.portaluserScreenIntensity&&(this.pxlEnv.portaluserScreenIntensity.x=1),this.pxlEnv.userScreenIntensity&&(this.pxlEnv.userScreenIntensity.x=.65,this.pxlEnv.userScreenIntensity.y=0),this.pxlEnv.geoList.HDRView&&(this.pxlEnv.geoList.HDRView.material.uniforms.cdMult.value=t===0?.7:.3),this.settings[e]=t;break;case"bloom":this.pxlEnv.portaluserScreenIntensity.x=t?.4:1,this.pxlRendering.mapGlowPass&&(this.pxlRendering.mapGlowPass.enabled=t),this.pxlRendering.roomBloomPass&&(this.pxlRendering.roomBloomPass.enabled=t),this.pxlRendering.roomGlowPass&&(this.pxlRendering.roomGlowPass.enabled=t),this.pxlEnv.userScreenIntensity&&(this.pxlEnv.userScreenIntensity.x=t?.65:.8,this.pxlEnv.userScreenIntensity.y=t?0:.8),this.pxlEnv.geoList.HDRView&&(this.pxlEnv.geoList.HDRView.material.uniforms.cdMult.value=t===0?.7:.3),this.pxlRendering.mapMotionBlurPass&&(this.pxlRendering.mapMotionBlurPass.enabled=t),this.settings[e]=t;break;case"motion":this.pxlRendering.mapMotionBlurPass&&(this.pxlRendering.mapMotionBlurPass.enabled=t),this.settings[e]=t;break;default:break}i&&this.pxlCookie.setCookie(e,t)}setDependentSettings(){var p,d;let e=1,t=0,i=.6,s=!1,r=!1,a=!1,o=!1,n=!1,h=!1;this.settings.fog===2?(s=!1,r=!0,a=!1,o=!1,n=!0,h=!1,e=.5):this.settings.fog===1?(s=!1,r=!1,a=!0,o=!1,n=!1,h=!0,e=.5):(s=!1,a=!1,o=!0,n=!1,h=!1,e=.4),this.pxlRendering.mapMotionBlurPass&&(this.pxlRendering.mapMotionBlurPass.enabled=s),r&&(this.pxlRendering.mapOverlayHeavyPass.enabled=r),a&&(this.pxlRendering.mapOverlayPass.enabled=a),o&&(this.pxlRendering.mapOverlaySlimPass.enabled=o),n&&(this.pxlRendering.mapBoxAAPass.enabled=n),h&&(this.pxlRendering.mapCrossAAPass.enabled=h),this.settings.bloom?(this.pxlRendering.mapGlowPass&&(this.pxlRendering.mapGlowPass.enabled=!0),this.pxlRendering.roomBloomPass&&(this.pxlRendering.roomBloomPass.enabled=!0),this.pxlRendering.roomGlowPass&&(this.pxlRendering.roomGlowPass.enabled=!0),this.pxlEnv.userScreenIntensity.x=.65,this.pxlEnv.userScreenIntensity.y=0,t=1,i=.25):(this.pxlRendering.mapGlowPass&&(this.pxlRendering.mapGlowPass.enabled=!1),this.pxlRendering.roomBloomPass&&(this.pxlRendering.roomBloomPass.enabled=!1),this.pxlRendering.roomGlowPass&&(this.pxlRendering.roomGlowPass.enabled=!1),(p=this.pxlRendering.mapComposerGlow)!=null&&p.renderTarget2&&(this.pxlRendering.engine.setRenderTarget(this.pxlRendering.mapComposerGlow.renderTarget2),this.pxlRendering.engine.clear()),(d=this.pxlRendering.roomGlowPass)!=null&&d.renderTarget2&&(this.pxlRendering.engine.setRenderTarget(this.pxlRendering.roomGlowPass.renderTarget2),this.pxlRendering.engine.clear()),this.pxlRendering.engine.setRenderTarget(null),this.pxlEnv.userScreenIntensity.x=.8,this.pxlEnv.userScreenIntensity.y=0,e=1,t=0,i=.5);let u=this.pxlEnv.geoList.Circular_Gate;u&&(u.material.uniforms.bloomBoost.value=t),this.pxlEnv.geoList.HDRView&&(this.pxlEnv.geoList.HDRView.material.uniforms.cdMult.value=this.settings.bloom?.3:.7);let c=this.pxlEnv.geoList.CirculateGateVideoSphere;c&&(c.material.color.r=i,c.material.color.g=i,c.material.color.b=i),this.pxlEnv.portaluserScreenIntensity&&(this.pxlEnv.portaluserScreenIntensity.x=e),this.pxlEnv.pxlCamera.colliderCurObjHit=null}};var Oi=class{constructor(e=!1,t="pxlNav-",i="/",s=30){let r=t.substring(-1)==="-"?t:t+"-";this.prepend=r,this.verbose=e,this.exp=s,this.path="path="+i,this.deleteDate="expires=Thu, 01 Jan 1970 00:00:01 GMT;",this.sub="_%_"}log(...e){this.verbose>=te.INFO&&(console.log("-- Cookie Manager --"),e.forEach(t=>{console.log(t)}))}getExpiration(){let e=new Date;return e.setTime(e.getTime()+this.exp*24*60*60*1e3),"expires="+e.toGMTString()+";"}isEqual(e){return this.hasCookie(e)?(this.log(e),this.readCookie(e)===this.variableToString(e)):!1}getRegexp(e){return new RegExp("(?="+e+").*?((?=;)|(?=$))","g")}getClearCookieRegexp(e){return new RegExp("(?="+e+").*?(?==)","g")}pullData(){let e=document.cookie,t=this.getRegexp(this.prepend),i=e.match(t),s={};return i&&i.forEach(r=>{let a=r.split("=")[0].replace(this.prepend,""),o=r.split("=")[1].replace(this.sub,";");s[a]=o}),s}valueToString(e){let t=typeof e;return isNaN(Number(e))?t==="string"?"'"+e+"'":t==="boolean"?e?"true":"false":e==null?"null":isNaN(Number(e))?"NaN":e:e}variableToString(e){return Array.isArray(e)?"["+e.map(i=>Array.isArray(i)?this.variableToString(i):this.valueToString(i)).join(",")+"]":this.valueToString(e)}hasCookie(e){return document.cookie.includes(this.prepend+e)}readCookie(e){if(this.hasCookie(e)){let t=this.getRegexp(this.prepend+e);return document.cookie.match(t)[0].split("=")[1].replace(this.prepend,"").replace(this.sub,";")}return null}parseCookie(e){if(this.hasCookie(e)){let t=this.getRegexp(this.prepend+e),i=document.cookie.match(t)[0].split("=")[1].replace(this.prepend,"").replace(this.sub,";");return i==="true"?i=!0:i==="false"?i=!1:parseInt(i)===i?i=parseInt(i):parseFloat(i)===i&&(i=parseFloat(i)),i}return null}evalCookie(e){if(e){if(this.hasCookie(e)){let t=this.getRegexp(this.prepend+e);return this.log("Eval Cookie has been limited, responce is: "),this.log(document.cookie.match(t)[0].replace(this.prepend,"").replace(this.sub,";")),!0}return!1}else{let t=this.getRegexp(this.prepend);return this.log("Eval Cookie has been limited, may error."),document.cookie.match(t).forEach(i=>{i.replace(this.prepend,"").replace(this.sub,";")}),!0}}setCookie(e,t){t=this.variableToString(t),t.replace&&t.replace(";",this.sub),document.cookie=this.prepend+e+"="+t+";"+this.getExpiration()+this.path}addDictionary(e){let t=Object.keys(e);for(let i=0;i<t.length;++i){let s=e[t[i]];s=this.variableToString(s),s.replace&&s.replace(";",this.sub),document.cookie=this.prepend+t[i]+"="+s+";"+this.getExpiration()+this.path}}parseDict(e){let t=Object.keys(e),i=!1;return t.forEach(s=>{this.hasCookie(s)&&(e[s]=this.parseCookie(s),i=!0)}),i}clearCookie(e){if(e)typeof e=="string"&&(e=[e]),e.forEach(t=>{document.cookie=t+"=;"+this.deleteDate+this.path});else{let t=this.getClearCookieRegexp(this.prepend);document.cookie.match(t).forEach(s=>{document.cookie=s+"=;"+this.deleteDate+this.path})}}};import{Vector2 as lA}from"three";var Ui=class{constructor(){this.active=!1,this.msRunner=new lA(0,0),this.msLog=0,this.fpsStats=-1,this._msRate=.001,this.baseRate=.001;let e=new Date().getTime()*this._msRate;this._bootMS=e,this._prevWorldMS=e,this._curMS=e,this._prevMS=e,this.deltaTime=0,this.avgDeltaTime=0,this.avgDeltaRate=.7,this.videoFeeds=[],this.booted=!1}init(){this.booted||(this.prevMS=this.curMS,this.msRunner.x=0,this.msRunner.y=0,this.step(),this.booted=!0)}get runtime(){return this._curMS-this._bootMS}get curMS(){return this._curMS}updateTime(){this._curMS=new Date().getTime()*this._msRate}get prevMS(){return this._prevMS}set prevMS(e){this._prevMS=e}scaleTime(e){this._msRate=this.baseRate*e}start(){this.play()}pause(e=null){return e===null?this.active=!this.active:this.active=!!e,this.active}play(){return this.active=!0,this.active}stop(){return this.active=!1,this.active}toggleMSLog(){this.msLog=(this.msLog+1)%2}step(){let e=this._curMS;if(this.updateTime(),this._curMS===e){this._curMS=e;return}this.prevMS=e,this.fpsStats!==-1&&this.fpsStats.update();let t=this.curMS-this.prevMS;this.avgDeltaTime=this.deltaTime*(1-this.avgDeltaRate)+t*this.avgDeltaRate,this.deltaTime=t,this.msRunner.x+=t>0?t:0,this.msRunner.y=this.avgDeltaTime}getLerpRate(e){return 1-Math.pow(.5,this.deltaTime*e)}getLerpAvgRate(e){return 1-Math.pow(.5,this.avgDeltaTime*e)}};var Gi=class{constructor(e=null){this.pxlEnums=null,this.pxlEnv=null,this.pxlTimer=null,this.id=null,this.Stats=null,this.jmaConnectObj=!1,this.jmaServer=!1,this.jmaRoom=!1,this.jmaUserId=null,this.jmaUserName=null,this.jmaTempUserIdActive=!1,this.welcome=!1,this.tankStrafe=!1,this.invertMouse=!1,this.moveSpeed=1,this.moveSpeedSlow=.5,this.moveSpeedBase=1,this.moveSpeedBoost=2,this.renderSettingsCookie="settings_renderSettings",this.controlModeCookie="settings_controlMode",this.tankStrageCookie="settings_tankStrage",this.invertMouseCookie="settings_invertMouse",this.rootUserCookie="data_userEnlil",this.adminUserCookie="data_userNanna",this.localUserMoved=!1,this.localUserTurned=!1,this.itemRunTime=60,this.itemGroupList=[],this.itemList={},this.itemListNames=[],this.itemBaseList=[],this.itemActiveList=[],this.itemInactiveCmd=[],this.itemActiveTimer=[],this.itemRotateRate=.65,this.itemBaseRotateRate=.1,this.itemBobRate=.35,this.itemBobMag=0,this.mPick=[],this.activeEffects={},this.lowGrav=0,this.lKing=0,this.lKingInactive=[.025,.018],this.lKingActive=[.35,.25],this.lKingWarp=0,this.lizardKingPass=null,this.sField=0,this.sFieldWarp=0,this.starFieldPass=null,this.iZoom=0,this.iZoomWarp=0,this.crystallinePass=null}setDependencies(e){this.pxlEnums=e.pxlEnums,this.pxlEnv=e.pxlEnv,this.pxlTimer=e.pxlTimer}setSlowSpeed(e){e=Math.max(.001,e),this.moveSpeedSlow=e}setBaseSpeed(e){e=Math.max(.001,e),this.moveSpeedBase=e}setBoostSpeed(e){e=Math.max(.001,e),this.moveSpeedBoost=e}setSpeed(e){switch(e){case this.pxlEnums.USER_SPEED.STOP:this.moveSpeed=0;break;case this.pxlEnums.USER_SPEED.SLOW:this.moveSpeed=this.moveSpeedBase*this.moveSpeedSlow;break;case this.pxlEnums.USER_SPEED.BASE:this.moveSpeed=this.moveSpeedBase;break;case this.pxlEnums.USER_SPEED.BOOST:this.moveSpeed=this.moveSpeedBase*this.moveSpeedBoost;break;default:this.moveSpeed=this.moveSpeedBase;break}}checkItemWearOff(e){return this.itemActiveList.length>0&&this.itemActiveTimer[0]-e<=0?(this.itemInactiveCmd.shift()(),this.itemActiveTimer.shift(),this.itemActiveList.shift(),!0):!1}checkItemPickUp(e){if(e==="LowGravity")return this.lowGrav===0?(this.lowGrav=1,!0):!1;if(e==="LizardKing")return this.lKing===0?(this.lKing=1,this.lKingWarp.set(...this.lKingActive),this.lizardKingPass.enabled=!0,!0):!1;if(e==="StarField")return this.sField===0?(this.sField=1,this.starFieldPass.enabled=!0,!0):!1;if(e==="InfinityZoom")return this.iZoom===0?(this.iZoom=1,this.crystallinePass.enabled=!0,!0):!1}toggleTankRotate(e=null){this.tankStrafe=e===null?!this.tankStrafe:e,this.tankStrageText=this.tankStrafe?"Left/Right Rotation":"Left/Right Strafe"}toggleMouseInf(e=null){this.invertMouse=e===null?!this.invertMouse:e,this.invertMouseText=this.invertMouse?"Revert Mouse":"Invert Mouse"}toggleFpsStats(){}};import{Vector2 as j,Vector3 as hA,Quaternion as cA}from"three";var Ni=class{constructor(e,t,i){this.projectTitle=e,this.pxlCore=t,this.pxlRendering=null,this.pxlEnv=null,this.pxlEnums=null,this.pxlTimer=null,this.pxlAudio=null,this.pxlUser=null,this.pxlCamera=null,this.pxlAutoCam=null,this.pxlGuiDraws=null,this.pxlQuality=null,this.pxlOptions=null,this.allowCursorSwap=!1,this.longTouchLength=.75;let s=window.innerWidth,r=window.innerHeight;this.sW=s,this.sH=r,this.lookRange=.3,this.lookXScalar=1/(this.sW*this.lookRange),this.lookYScalar=1/(this.sH*this.lookRange),this.touchScreen=!1,this.x=s*.5,this.y=r*.5,this.screenRes=new j(1/s,1/r),this.screenAspect=new j(1,1),this.screenRatio=new j(s/r,r/s),this.origRes=new j(s,r),this.screenResDeltaPerc=new j(1,1),this.mapW=1,this.mapH=1,this.gammaCorrection=new hA(1,1,1),this.lightShift=new j(1,1),this.firefox=/Firefox/i.test(navigator.userAgent),this.mobile=i,this.button=0,this.inputActive=!1,this.startPos=[0,0],this.endPos=[0,0],this.dragCount=0,this.dragTotal=0,this.latched=!1,this.windowHidden=!1,this.mouseX=s/2,this.mouseY=r/2,this.keyDownCount=[0,0,0],this.directionKeyDown=!1,this.directionKeysPressed=[0,0,0,0],this.controlKey=!1,this.objectPercList=[],this.objectPercFuncList={},this.objectPerc={active:!1,object:null,left:0,top:0,width:0,height:0,startX:0,startY:0,offsetX:0,offsetY:0,percX:0,percY:0,offsetPercX:0,offsetPercY:0},this.canCursorLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,this.cursorLockActive=!1,this.cursorRightButtonLockActive=!1,this.gyroGravity=[0,0,0],this.touchMouseData={active:!1,lock:!1,mode:0,updated:0,button:0,dragCount:0,dragTotal:0,startPos:null,moveMult:new j(1,1),velocityEase:new j(0,0),velocityEasePrev:null,velocity:new j(0,0),mBlurVelInf:new j(2*this.screenRes.x,2*this.screenRes.y),prevDeltaPos:[0,0,0],endPos:null,latchMatrix:null,netDistance:new j(0,0),netDistYPerc:0,curDistance:new j(0,0),curFadeOut:new j(0,0),curStepDistance:new j(0,0),initialQuat:new cA,releaseTime:0},this.subscriptableEvents=["keydown","keyup","resize"],this.callbackList={}}setDependencies(e){this.pxlRendering=e.pxlRendering,this.pxlEnv=e.pxlEnv,this.pxlEnums=e.pxlEnums,this.pxlTimer=e.pxlTimer,this.pxlAudio=e.pxlAudio,this.pxlUser=e.pxlUser,this.pxlCamera=e.pxlCamera,this.pxlAutoCam=e.pxlAutoCam,this.pxlGuiDraws=e.pxlGuiDraws,this.pxlQuality=e.pxlQuality,this.pxlOptions=e.pxlOptions}init(){this.setGammaCorrection();let e=this;(!this.pxlOptions.staticCamera||this.pxlOptions.allowStaticRotation&&this.pxlOptions.staticCamera)&&(document.addEventListener("mousedown",i=>{e.onmousedown(e,i)},!1),document.addEventListener("mousemove",i=>{e.onmousemove(e,i)},!1),document.addEventListener("mouseup",i=>{e.onmouseup(e,i)},!1),document.addEventListener("touchstart",function(i){e.touchstart(e,i)},{passive:!0}),document.addEventListener("touchmove",function(i){e.touchmove(e,i)},{passive:!0}),document.addEventListener("touchend",function(i){e.touchend(e,i)},{passive:!0})),document.addEventListener("contextmenu",i=>{e.oncontextmenu(i)},!1),window.addEventListener("resize",i=>{e.resizeRenderResolution()},!1),document.onkeydown=i=>{e.onkeydown(e,i)},document.onkeyup=i=>{e.onkeyup(e,i)};let t=this;document.addEventListener("visibilitychange",this.onVisibilityChange.bind(this),!1),typeof window.onblur=="object"&&(window.onblur=this.resetUserInput.bind(this)),window.addEventListener("beforeunload",i=>{if(t.controlKey===!0)return i.preventDefault(),i.returnValue="Close tab?",t.controlKey=!1,t.mapLockCursor(!1,0),"Close tab?"}),window.addEventListener("unhandledrejection",i=>(this.verbose>=this.pxlEnums.VERBOSE_LEVEL.ERROR?console.error("Unhandled promise rejection:",i.reason):i.preventDefault(),!1))}step(){this.addMoveDelta()}setGammaCorrection(e=null){if(e!=null){this.gammaCorrection.x=1/e,this.gammaCorrection.y=e,this.gammaCorrection.z=e;return}let t=1.5,i=1.1,s=1.2,r=.5;if(window&&window.navigator&&window.navigator.userAgent){let a=window.navigator.userAgent.match(/(windows|win32|win64|wince)/i);if(a&&a.length>0)t=2.2,i=.95,s=1,r=0;else{let o=window.navigator.userAgent.match(/(macintosh|macintel|macppc|mac68k|iphone|ipad|ipod)/i);o&&o.length>0?(t=1.8,i=.9,s=.97,r=.1):(t=1.8,i=.7,s=.96,r=.1)}}this.gammaCorrection.x=1/t,this.gammaCorrection.y=s,this.gammaCorrection.z=r,this.lightShift.x=i}getRenderScalar(){let e=1;return this.mobile&&this.pxlOptions.renderScale.mobile!==0?e=this.pxlOptions.renderScale.mobile:this.pxlOptions.renderScale.pc!==0&&(e=this.pxlOptions.renderScale.pc),e}setCanvasSize(e,t){this.pxlGuiDraws.pxlNavCanvas.width=e,this.pxlGuiDraws.pxlNavCanvas.height=t;let i=this.getRenderScalar();if(i!==1){let s=1/i;this.pxlGuiDraws.pxlNavCanvas.style.transform="scale("+s+")"}else this.pxlGuiDraws.pxlNavCanvas.style.transform=""}runHiddenCalcs(){this.windowHidden&&setTimeout(()=>{this.runHiddenCalcs()},100)}onVisibilityChange(){this.windowHidden=document.hidden,this.directionKeysPressed=[0,0,0,0],this.directionKeyDown=!1,this.pxlUser.setSpeed(this.pxlEnums.USER_SPEED.BASE),this.pxlCamera.workerFunc("focus",!document.hidden),this.runHiddenCalcs()}resetUserInput(e){this.directionKeysPressed=[0,0,0,0],this.directionKeyDown=!1,this.pxlUser.setSpeed(this.pxlEnums.USER_SPEED.BASE),this.mapLockCursor(!1,0),this.pxlCamera.camJumpKey(!1),this.pxlCamera.deviceKey("space",!1),this.touchMouseData.active&&(this.touchScreen?this.endTouch(e):this.mapOnUp(e))}requestFullScreen(){let e=document.documentElement,t=e.requestFullScreen||e.webkitRequestFullScreen||e.mozRequestFullScreen||e.msRequestFullScreen;t&&t.call(e)}onmousemove(e,t){e.mapOnMove(t)}onmousedown(e,t){e.mapOnDown(t)}onmouseup(e,t){e.mapOnUp(t)}oncontextmenu(e){return e.preventDefault(),!1}touchstart(e,t){e.startTouch(t)}touchmove(e,t){e.doTouch(t)}touchend(e,t){e.endTouch(t)}onkeydown(e,t){e.keyDownCall(t)}onkeyup(e,t){e.keyUpCall(t)}get active(){return this.inputActive}set active(e){this.inputActive=!!e}preventDefault(e){e=e||window.event,e.preventDefault(e)&&e.preventDefault(e)(),e.returnValue=!1}setCursor(e){this.allowCursorSwap&&(e==="activeLatch"&&(e=["grab","grabbing","all-scroll"][this.touchMouseData.button]),document.body.style.cursor=e)}hideAddressBar(){setTimeout(function(){window.scrollTo(0,1)},0)}getMouseXY(e){if(this.mobile)try{let t=e.touches[0];this.mouseX=t.pageX,this.mouseY=t.pageY}catch(t){}else{let t=this.pxlQuality.settings.mouse?-1:1;this.cursorLockActive?(this.mouseX+=(e.movementX||e.mozMovementX||e.webkitMovementX||0)*t,this.mouseY+=(e.movementY||e.mozMovementY||e.webkitMovementY||0)*t):(this.mouseX=e.clientX,this.mouseY=e.clientY)}}mapLockCursor(e=!1,t){if(this.canCursorLock&&!this.mobile){if(t===2?(!e&&this.cursorRightButtonLockActive?this.cursorRightButtonLockActive=!1:!e&&!this.cursorRightButtonLockActive&&(this.cursorRightButtonLockActive=!0),e=e||this.cursorRightButtonLockActive):e||(this.cursorRightButtonLockActive=e),e===!0){this.pxlGuiDraws.pxlNavCanvas.focus();let i=this.pxlGuiDraws.pxlNavCanvas;i.requestPointerLock=i.requestPointerLock||i.mozRequestPointerLock||i.webkitRequestPointerLock;try{i.requestPointerLock()}catch(s){}}else document.pointerLockElement&&document.exitPointerLock();this.cursorLockActive=e}}mapOnDown(e){let t=e.target;t.getAttribute&&t.getAttribute("id")===this.pxlCore&&this.pxlTimer.active&&(this.pxlGuiDraws.chatMessageInput&&this.pxlGuiDraws.chatMessageInput.blur(),this.pxlGuiDraws.pxlNavCanvas.focus(),this.preventDefault(e),this.touchMouseData.button=e.which,this.touchMouseData.active=!0,this.touchMouseData.mode=this.touchMouseData.button,this.touchMouseData.startPos=new j(this.mouseX,this.mouseY),this.touchMouseData.endPos=new j(this.mouseX,this.mouseY),this.touchMouseData.curDistance=new j(0,0),this.touchMouseData.curStepDistance=new j(0,0),this.touchMouseData.dragCount=0,this.pxlAutoCam.touchBlender=!1,this.setCursor("grabbing"),this.mapLockCursor(!0,e.button))}mapOnMove(e){let t=e.target;if(t.getAttribute&&t.getAttribute("id")===this.pxlCore&&this.pxlTimer.active||this.cursorLockActive)if(this.preventDefault(e),this.getMouseXY(e),(this.touchMouseData.active||this.cursorLockActive)&&this.touchMouseData.startPos){this.touchMouseData.dragCount++;let i=this.touchMouseData.endPos.clone();this.touchMouseData.endPos=new j(this.mouseX,this.mouseY),this.touchMouseData.curDistance=this.touchMouseData.startPos.clone().sub(this.touchMouseData.endPos),this.touchMouseData.curStepDistance=this.touchMouseData.endPos.clone().sub(i),this.touchMouseData.netDistance.add(this.touchMouseData.curStepDistance.clone()),this.touchMouseData.velocity=this.touchMouseData.velocity.clone().multiplyScalar(3).add(this.touchMouseData.curStepDistance).multiplyScalar(.25),this.touchMouseData.netDistYPerc=(this.touchMouseData.netDistance.y+this.touchMouseData.curDistance.y+250)*8e-4,this.touchMouseData.curFadeOut.add(i.sub(this.touchMouseData.endPos))}else this.pxlEnv.hoverUserDetect()}mapOnUp(e){let t=e.target;if(this.pxlAudio.djVolumeParentObj&&(this.pxlAudio.djVolumeParentObj.down=!1),t.getAttribute&&t.getAttribute("id")===this.pxlCore)if(this.pxlGuiDraws.checkFocus(t.getAttribute("id"),!0),this.mobile)this.pxlAutoCam.getNextPath(!1,1);else return this.preventDefault(e),this.touchMouseData.dragCount++,this.touchMouseData.dragTotal+=this.touchMouseData.dragCount,this.touchMouseData.active=!1,this.touchMouseData.releaseTime=this.pxlTimer.curMS,this.pxlAutoCam.touchBlender=!0,this.pxlAutoCam.setNextTrigger(),this.touchMouseData.dragCount<9&&this.pxlEnv.clickUserDetect(),this.touchMouseData.endPos=new j(this.mouseX,this.mouseY),this.touchMouseData.netDistYPerc=(this.touchMouseData.netDistance.y+250)/1250,this.setCursor("grab"),this.mapLockCursor(!1,e.button),e.preventDefault(),!1}startTouch(e){let t=e.target;if(!(t.getAttribute&&t.getAttribute("id")===this.pxlCore&&this.pxlTimer.active))return;this.touchScreen=!0;let s=e.touches[0];this.mouseX=s.pageX,this.mouseY=s.pageY,this.touchMouseData.active=!0,this.touchMouseData.mode=this.touchMouseData.button,this.touchMouseData.startPos=new j(this.mouseX,this.mouseY),this.touchMouseData.endPos=new j(this.mouseX,this.mouseY),this.touchMouseData.curDistance=new j(0,0),this.touchMouseData.curStepDistance=new j(0,0),this.touchMouseData.dragCount=0,this.pxlAutoCam.touchBlender=!1,this.touchMouseData.releaseTime=this.pxlTimer.curMS;let r=t.getAttribute("id");if(this.objectPercList.includes(r)){r==="djPlayerVolume"&&(t=this.pxlAudio.djVolumeParentObj,r=t.getAttribute("id"));let a=t.getBoundingClientRect();this.objectPerc.active=!0,this.objectPerc.object=t,this.objectPerc.left=a.left,this.objectPerc.top=a.top,this.objectPerc.width=a.width,this.objectPerc.height=a.height,this.objectPerc.startX=this.mouseX-a.left,this.objectPerc.startY=this.mouseY-a.top,this.objectPerc.percX=(this.mouseX-this.objectPerc.left)/this.objectPerc.width,this.objectPerc.percY=(this.mouseY-this.objectPerc.top)/this.objectPerc.height,this.objectPerc.offsetX=0,this.objectPerc.offsetY=0,this.objectPerc.offsetPercX=0,this.objectPerc.offsetPercY=0,this.objectPercFuncList[r]&&this.objectPercFuncList[r](e)}}doTouch(e){if(!this.touchMouseData.active)return;let t=e.touches[0];if(this.mouseX=t.pageX,this.mouseY=t.pageY,this.touchMouseData.active){if(this.touchMouseData.dragCount++,typeof e.touches[1]!="undefined"){e.touches.length>1&&this.touchMouseData.dragCount>10&&(this.touchMouseData.lock=!0,t=e.touches[1],this.pxlEnv.setFogHue([this.mouseX,this.mouseY],[t.pageX,t.pageY]));return}let i=this.touchMouseData.endPos.clone();this.touchMouseData.endPos=new j(this.mouseX,this.mouseY),this.touchMouseData.curDistance=this.touchMouseData.startPos.clone().sub(this.touchMouseData.endPos),this.touchMouseData.curStepDistance=this.touchMouseData.endPos.clone().sub(i),this.touchMouseData.netDistance.add(this.touchMouseData.curStepDistance.clone()),this.touchMouseData.velocity.add(this.touchMouseData.curStepDistance).multiplyScalar(.5),this.touchMouseData.netDistYPerc=(this.touchMouseData.netDistance.y+this.touchMouseData.curDistance.y+250)/1250,this.touchMouseData.curFadeOut.add(i.sub(this.touchMouseData.endPos))}this.objectPerc.active&&(this.objectPerc.percX=(this.mouseX-this.objectPerc.left)/this.objectPerc.width,this.objectPerc.percY=(this.mouseY-this.objectPerc.top)/this.objectPerc.height,this.objectPerc.offsetX=this.mouseX-this.objectPerc.startX,this.objectPerc.offsetY=this.mouseY-this.objectPerc.startY,this.objectPerc.offsetPercX=this.objectPerc.offsetX/this.objectPerc.width,this.objectPerc.offsetPercY=this.objectPerc.offsetY/this.objectPerc.height)}endTouch(e){if(this.touchMouseData.active){if(this.touchScreen=!1,this.touchMouseData.dragCount++,this.touchMouseData.dragTotal+=this.touchMouseData.dragCount,this.touchMouseData.active=!1,this.touchMouseData.endPos=new j(this.mouseX,this.mouseY),this.touchMouseData.netDistYPerc=(this.touchMouseData.netDistance.y+250)/1250,this.touchMouseData.curDistance.multiplyScalar(0),this.touchMouseData.curStepDistance.multiplyScalar(0),this.touchMouseData.releaseTime=this.pxlTimer.curMS,this.touchMouseData.lock){this.touchMouseData.lock=!1;return}this.pxlAutoCam.touchBlender=!0,this.pxlAutoCam.setNextTrigger()}}async keyDownCall(e){if(this.emit("keydown",e),e.ctrlKey&&(this.controlKey=!0),document.activeElement.type===void 0&&this.pxlTimer.active){if(e.repeat)return;let t=e.keyCode||e.which;(t===37||t===65)&&(this.directionKeyDown=!0,this.keyDownCount[0]=this.pxlQuality.fpsCounter.z,this.directionKeysPressed[0]=1,this.pxlCamera.deviceKey(0,!0)),e.ctrlKey&&t===87&&this.directionKeysPressed[1]===1&&e.this.preventDefault(e)(),(t===38||t===87)&&(this.directionKeyDown=!0,this.keyDownCount[1]=this.pxlQuality.fpsCounter.z,this.directionKeysPressed[1]=1,this.pxlCamera.deviceKey(1,!0)),(t===39||t===68)&&(this.directionKeyDown=!0,this.keyDownCount[0]=this.pxlQuality.fpsCounter.z,this.directionKeysPressed[2]=1,this.pxlCamera.deviceKey(2,!0)),(t===40||t===83)&&(this.directionKeyDown=!0,this.keyDownCount[1]=this.pxlQuality.fpsCounter.z,this.directionKeysPressed[3]=1,this.pxlCamera.deviceKey(3,!0)),(t===16||t===224)&&this.deviceAction(this.pxlEnums.DEVICE_ACTION.RUN,{},!0),t===32&&this.deviceAction(this.pxlEnums.DEVICE_ACTION.JUMP,{},!0)}}async keyUpCall(e){var t,i;if(this.emit("keyup",e),e.ctrlKey)return this.controlKey=!1,e.preventDefault(),!1;if(document.activeElement.type===void 0){let s=e.keyCode||e.which,r=e.code||e.which;if(!e.isTrusted)return!1;if(e.ctrlKey||e.altKey||e.code.includes("F"))return e.preventDefault(),!1;if(r==="Backquote"){this.pxlGuiDraws.guiToggleVisibility();return}if(s===89&&this.pxlGuiDraws.toggleShaderEditor(),s===220){let a=this.pxlQuality.screenResPerc;this.pxlQuality.screenResPerc=1,this.pxlEnv.mapRender(!1);let o=this.pxlGuiDraws.pxlNavCanvas.toDataURL("image/png"),n=atob(o.split(",")[1]),h=n.length,u=new Uint8Array(h);for(let C=0;C<h;++C)u[C]=n.charCodeAt(C);let c=URL.createObjectURL(new Blob([u])),p=new Date,d=p.getDate(),g=p.getMonth()+1,A=p.getFullYear()+"-"+g+"-"+d+"_"+p.getHours()+"-"+p.getMinutes()+"-"+p.getSeconds(),f=document.createElement("a");f.download=this.projectTitle+"_"+A+".png",f.href=c,document.body.appendChild(f),f.click(),f.parentNode.removeChild(f),this.pxlQuality.screenResPerc=a,this.pxlEnv.mapRender(!1);return}if(this.pxlTimer.active){if((s===37||s===65)&&(this.directionKeysPressed[0]=0,this.pxlCamera.deviceKey(0,!1)),(s===38||s===87)&&(this.directionKeysPressed[1]=0,this.pxlAutoCam.active&&this.pxlAutoCam.step(!0),this.pxlCamera.deviceKey(1,!1)),(s===39||s===68)&&(this.directionKeysPressed[2]=0,this.pxlCamera.deviceKey(2,!1)),(s===40||s===83)&&(this.directionKeysPressed[3]=0,this.pxlAutoCam.active&&this.pxlAutoCam.setRoom(!0),this.pxlCamera.deviceKey(3,!1)),this.directionKeysPressed.includes(1)||(this.directionKeyDown=!1),s===16||s===224){this.deviceAction(this.pxlEnums.DEVICE_ACTION.RUN,{},!1);return}if(s===32){this.deviceAction(this.pxlEnums.DEVICE_ACTION.JUMP,{},!1);return}if(!this.directionKeyDown&&(s===53||s===101)){this.pxlAutoCam.preAutoCamToggle();return}if(s===221){((i=(t=this.pxlUser)==null?void 0:t.itemInactiveCmd)==null?void 0:i.length)>0&&this.pxlUser.itemInactiveCmd.pop();return}}if(s===27||s===13&&!e.ctrlKey){this.pxlGuiDraws.toggleHudBlock(!1,!0),this.pxlGuiDraws.toggleGuiWindowContainer(!1,!1,!0);return}if(e.altKey||e.ctrlKey||e.shiftKey)return;if(s===73){this.pxlGuiDraws.iconEvent("click",this.pxlGuiDraws.hudIcons.infoIcon,"info");return}if(s===71){this.pxlGuiDraws.iconEvent("click",this.pxlGuiDraws.hudIcons.settingsIcon,"settings");return}if(s===191||s===72){this.pxlGuiDraws.iconEvent("click",this.pxlGuiDraws.hudIcons.helpIcon,"help");return}if(s===66){this.pxlGuiDraws.iconEvent("click",this.pxlGuiDraws.hudIcons.musicIcon,"musicToggle");return}if(s===78){this.pxlGuiDraws.iconEvent("click",this.pxlGuiDraws.hudIcons.speakerIcon,"speakerToggle");return}if(s===80){this.deviceAction(this.pxlEnums.DEVICE_ACTION.PAUSE);return}}}deviceAction(e,t,i=null){switch(e){case this.pxlEnums.DEVICE_ACTION.MOVE:this.addMoveDelta(t);break;case this.pxlEnums.DEVICE_ACTION.LOOK:this.addLookDelta(t);break;case this.pxlEnums.DEVICE_ACTION.JUMP:this.pxlCamera.camJumpKey(i);break;case this.pxlEnums.DEVICE_ACTION.RUN:let s=i?this.pxlEnums.USER_SPEED.BOOST:this.pxlEnums.USER_SPEED.BASE;this.pxlUser.setSpeed(s);break;case this.pxlEnums.DEVICE_ACTION.ACTION:break;case this.pxlEnums.DEVICE_ACTION.ACTION_ALT:break;case this.pxlEnums.DEVICE_ACTION.ITEM:break;case this.pxlEnums.DEVICE_ACTION.MENU:break;case this.pxlEnums.DEVICE_ACTION.PAUSE:this.togglePause(i);break;case this.pxlEnums.DEVICE_ACTION.MAP:break;default:break}}addMoveDelta(e=null){let t=!1;if(!(!this.pxlOptions.mobile||this.pxlOptions.staticCamera||e===null&&!this.directionKeyDown)){if(e!==null){if(e.hasOwnProperty("status")&&(t=e.status),t){let i=Math.abs(e.startDelta.x),s=Math.abs(e.startDelta.y),r=this.pxlOptions.userSettings.deadZone.touch,a=i>r?e.startDelta.x-r*Math.sign(e.startDelta.x):0,o=s>r?e.startDelta.y-r*Math.sign(e.startDelta.y):0,n=this.sW/this.sH,h=this.sH/this.sW;a=Math.min(a*this.lookXScalar,1)*this.pxlOptions.userSettings.movement.max*n,o=Math.min(o*this.lookYScalar,1)*this.pxlOptions.userSettings.movement.max*h,this.pxlCamera.cameraMovement[0]=(this.pxlCamera.cameraMovement[0]+a)*.7,this.pxlCamera.cameraMovement[1]=(this.pxlCamera.cameraMovement[1]+o)*.7,this.userInputMoveScalar=Math.max(this.pxlCamera.cameraMovement[0]**2,this.pxlCamera.cameraMovement[1]**2)**.5,this.userInputMoveScalar=this.userInputMoveScalar*this.userInputMoveScalar*this.userInputMoveScalar*1.5,this.userInputMoveScalar+=this.userInputMoveScalar>1?(this.userInputMoveScalar-1)*30:0,this.userInputMoveScalar>1?this.deviceAction(this.pxlEnums.DEVICE_ACTION.RUN,{},!0):this.deviceAction(this.pxlEnums.DEVICE_ACTION.RUN,{},!1)}}else t=this.directionKeyDown;this.directionKeyDown=t,t?(this.directionKeysPressed[0]=this.pxlCamera.cameraMovement[0]<0?1:0,this.directionKeysPressed[1]=this.pxlCamera.cameraMovement[1]<0?1:0,this.directionKeysPressed[2]=this.pxlCamera.cameraMovement[0]>0?1:0,this.directionKeysPressed[3]=this.pxlCamera.cameraMovement[1]>0?1:0,this.pxlCamera.userInputMoveScalar.x=this.pxlCamera.cameraMovement[0],this.pxlCamera.userInputMoveScalar.y=this.pxlCamera.cameraMovement[1],this.pxlCamera.cameraMovementEase=1,this.pxlUser.setSpeed(this.userInputMoveScalar*this.pxlEnums.USER_SPEED.BASE)):(this.directionKeysPressed[0]=0,this.directionKeysPressed[1]=0,this.directionKeysPressed[2]=0,this.directionKeysPressed[3]=0,this.pxlCamera.cameraMovementEase=.85)}}addLookDelta(e){let t=!1;if(e.hasOwnProperty("status")&&(t=e.status),this.mouseX=e.currentPos.x,this.mouseY=e.currentPos.y,t)e.dragCount===0?(this.touchScreen=!0,this.touchMouseData.active=!0,this.touchMouseData.mode=this.touchMouseData.button,this.touchMouseData.startPos=new j(this.mouseX,this.mouseY),this.touchMouseData.endPos=new j(this.mouseX,this.mouseY),this.touchMouseData.curDistance=new j(0,0),this.touchMouseData.curStepDistance=new j(0,0),this.touchMouseData.dragCount=0,this.pxlAutoCam.touchBlender=!1,this.touchMouseData.releaseTime=this.pxlTimer.curMS):(this.touchMouseData.endPos=new j(this.mouseX,this.mouseY),this.touchMouseData.curDistance=new j(e.startDelta.x,e.startDelta.y),this.touchMouseData.curStepDistance=new j(e.stepDelta.x,e.stepDelta.y),this.touchMouseData.netDistance.add(this.touchMouseData.curStepDistance.clone()),this.touchMouseData.velocity.add(this.touchMouseData.curStepDistance).multiplyScalar(.5),this.touchMouseData.netDistYPerc=(this.touchMouseData.netDistance.y+this.touchMouseData.curDistance.y+250)/1250,this.touchMouseData.curFadeOut.add(new j(e.previousPos.x,e.previousPos.y).sub(this.touchMouseData.endPos)),this.objectPerc.active&&(this.objectPerc.percX=(this.mouseX-this.objectPerc.left)/this.objectPerc.width,this.objectPerc.percY=(this.mouseY-this.objectPerc.top)/this.objectPerc.height,this.objectPerc.offsetX=this.mouseX-this.objectPerc.startX,this.objectPerc.offsetY=this.mouseY-this.objectPerc.startY,this.objectPerc.offsetPercX=this.objectPerc.offsetX/this.objectPerc.width,this.objectPerc.offsetPercY=this.objectPerc.offsetY/this.objectPerc.height));else{if(this.touchScreen=!1,this.touchMouseData.dragTotal+=e.dragCount,this.touchMouseData.active=!1,this.touchMouseData.endPos=new j(this.mouseX,this.mouseY),this.touchMouseData.netDistYPerc=(this.touchMouseData.netDistance.y+250)/1250,this.touchMouseData.curDistance.multiplyScalar(0),this.touchMouseData.curStepDistance.multiplyScalar(0),this.touchMouseData.releaseTime=this.pxlTimer.curMS,this.touchMouseData.lock){this.touchMouseData.lock=!1;return}this.pxlAutoCam.touchBlender=!0}}togglePause(e=null){e===null&&(e=!this.pxlTimer.active),this.directionKeysPressed=[0,0,0,0],this.directionKeyDown=!1,this.pxlTimer.pause(e),this.pxlTimer.active&&this.pxlEnv.mapRender(),this.pxlCamera.workerFunc("activeToggle",this.pxlTimer.active)}resizeRenderResolution(e=null,t=null){let i=window.innerWidth,s=window.innerHeight;i=e||i,s=t||s;let r=this.getRenderScalar();if(i=i*r,s=s*r,this.mapW=(this.sW=i)*this.pxlQuality.screenResPerc,this.mapH=(this.sH=s)*this.pxlQuality.screenResPerc,this.screenRes.x=1/this.mapW,this.screenRes.y=1/this.mapH,this.screenRatio.x=this.sW*this.screenRes.x,this.screenRatio.y=this.sH*this.screenRes.y,this.pxlEnv.geoList.HDRView){let h=this.mapW>this.mapH?1:this.mapW/this.mapH;this.pxlEnv.geoList.HDRView.material.uniforms.ratioU.value=h}if(this.touchMouseData.mBlurVelInf=new j(2*this.screenRes.x,2*this.screenRes.y),!this.pxlEnv.mapGlowPass)return;this.pxlEnv.scene.renderTarget.setSize(this.mapW,this.mapH),this.pxlEnv.scene.renderWorldPos.setSize(this.mapW,this.mapH),this.setCanvasSize(this.sW,this.sH),this.pxlRendering.resize(this.mapW,this.mapH),this.pxlGuiDraws.loading=!0,this.pxlEnv.engine.setPixelRatio(window.devicePixelRatio*this.pxlQuality.screenResPerc),this.pxlEnv.engine.setSize(this.sW,this.sH);let a=window.innerWidth/window.innerHeight;this.pxlCamera.setAspect(a);let o=[this.sW/this.sH,this.sH/this.sW],n=[1,1];n[0]=a>o[0]?1:this.sW/(this.sH*o[0]),n[1]=a>o[1]?this.sH/(this.sW*o[1]):1,n[0]>1?(n[1]*=1/n[0],n[0]=1):n[1]>1&&(n[0]*=1/n[1],n[1]=1),this.screenAspect.x=n[0]*(1/(.5**2+.5**2)**.5),this.screenAspect.y=n[1],this.screenResDeltaPerc.x=this.sW/this.origRes.x,this.screenResDeltaPerc.y=this.sH/this.origRes.y,this.pxlRendering.updateCompUniforms(),this.pxlEnv.roomNameList.forEach(h=>{var u;this.pxlEnv.roomSceneList[h].pxlCamAspect=a,(u=this.pxlEnv.roomSceneList[h])!=null&&u.resize&&this.pxlEnv.roomSceneList[h].resize(this.mapW,this.mapH)}),this.emit("resize",{rawWidth:window.innerWidth,rawHeight:window.innerHeight,width:this.mapW,height:this.mapH,xPixelPerc:this.screenRes.x,yPixelPerc:this.screenRes.y,aspectRatio:a}),this.pxlTimer.active||this.pxlEnv.mapRender(!1)}subscribe(e,t){if(!this.subscriptableEvents.includes(e)){console.error("Event type not subscribable: ",e);return}this.callbackList[e]||(this.callbackList[e]=[]),this.callbackList[e].push(t)}unsubscribe(e,t){let i=-1;return this.callbackList[e]&&(i=this.callbackList[e].indexOf(t),i>=0&&this.callbackList[e].splice(i,1)),i>=0}emit(e,t){this.callbackList.hasOwnProperty(e)&&this.callbackList[e].forEach(i=>{i(t)})}};import{Vector2 as Vi,Vector3 as rt,BufferAttribute as Jr,BufferGeometry as uA,ShaderMaterial as pA,Mesh as AA,DoubleSide as dA,AdditiveBlending as fA}from"three";var Hi=class{constructor(e=!1,t=100,i=500){this.pxlEnv=null,this.pxlUtils=null,this.verbose=e,this.delimiter=",",this.roomColliderData={},this.baseGridSize=t,this.degToRad=Math.PI/180,this.epsilon=1e-5,this.colliderBoundsReference=i,this.prevGridKey=""}setDependencies(e){this.pxlEnv=e,this.pxlUtils=e.pxlUtils}log(e){this.verbose>=te.INFO&&console.log(e)}debug(e){this.verbose>=te.DEBUG&&console.log(e)}warn(e){this.verbose>=te.WARN&&console.warn(e)}error(e){this.verbose>=te.ERROR&&console.error(e)}init(){}start(){}stop(){}step(){}prepColliders(e,t=T.FLOOR,i=null){if(e.hasColliders()){i||(i=this.baseGridSize);let s=1/i;if(t===T.HOVERABLE||t===T.CLICKABLE){this.prepInteractables(e,t);return}let r=e.getName(),a=e.getColliders(t);this.roomColliderData.hasOwnProperty(r)||(this.roomColliderData[r]={}),this.roomColliderData[r].hasOwnProperty(t)||(this.roomColliderData[r][t]={},this.roomColliderData[r][t].helper=null,this.roomColliderData[r][t].count=0,this.roomColliderData[r][t].gridSize=i,this.roomColliderData[r][t].gridSizeInv=s,this.roomColliderData[r][t].faceVerts={},this.roomColliderData[r][t].faceGridGroup={});let o=[],n={min:new Vi(1/0,1/0),max:new Vi(-1/0,-1/0)};a.forEach(m=>{let A=m.geometry.attributes.position.array,f=A.length/3;for(let C=0;C<f;++C){let v=new Vi(A[C*3],A[C*3+2]);o.push(v),n.min.min(v),n.max.max(v)}});let h=n.max.clone().sub(n.min),u=Math.abs(Math.max(h.x,h.z)),c=Math.min(1,u/this.colliderBoundsReference);if(c<1){let m=i;i=i*c,s=1/i,this.roomColliderData[r][t].gridSize=i,this.roomColliderData[r][t].gridSizeInv=s,this.debug("Grid size adjusted for pxlRoom: "+r+"; from "+m+" to "+i+" units; "+c+"%"),this.debug("Reference bound set to: "+this.colliderBoundsReference+" units"),this.debug("Total pxlRoom bounds found: "+u+" units")}else this.debug("-- Grid size unchanged for pxlRoom '"+r+"', collider bounds within reference bounds --");this.debug("Collider bounds: {x:"+n.min.x+", y:"+n.min.y+"} -to- {x:"+n.max.x+", y:"+n.max.y+" }");let p=-1,d=0;a.forEach(m=>{p++;let A=m.geometry.attributes.position.array,f=A.length/3,C=m.matrixWorld;for(let v=0;v<f;++v){let x=v*9,b=new rt(A[x],A[x+1],A[x+2]),I=new rt(A[x+3],A[x+4],A[x+5]),E=new rt(A[x+6],A[x+7],A[x+8]);if(b.applyMatrix4(C),I.applyMatrix4(C),E.applyMatrix4(C),b.length()===0&&I.length()===0&&E.length()===0)continue;let B=Math.min(b.x,I.x,E.x),w=Math.max(b.x,I.x,E.x),D=Math.min(b.z,I.z,E.z),S=Math.max(b.z,I.z,E.z),P=Math.floor(B*s),F=Math.floor(w*s),O=Math.floor(D*s),N=Math.floor(S*s);d++;let M=I.clone().sub(b),L=E.clone().sub(b),H=M.clone().cross(L),k=M.dot(M),Q=M.dot(L),K=L.dot(L),Y=1/(k*K-Q*Q),_=m.name!==""?m.name:"collider_"+p,$=this.getGridKey(_,"_face_",this.flattenVector3(b),this.flattenVector3(I),this.flattenVector3(E)),ee={object:m,name:m.name,key:$,verts:[b,I,E],edge0:M,edge1:L,normal:H,dotE0E0:k,dotE0E1:Q,dotE1E1:K,areaInv:Y};if(this.roomColliderData[r][t].faceVerts[$]=ee,P===F&&O===N){this.addFaceToGridLocation(r,t,P,O,$);continue}for(let Z=P;Z<=F;++Z)for(let he=O;he<=N;++he)this.addFaceToGridLocation(r,t,Z,he,$)}});let g=Object.keys(this.roomColliderData[r][t].faceGridGroup);for(let m=0;m<g.length;++m){let A=this.roomColliderData[r][t].faceGridGroup[g[m]];this.roomColliderData[r][t].faceGridGroup[g[m]]=[...new Set(A)]}this.roomColliderData[r][t].count=d,this.debug(" -- Collider Count for "+r+" : "+d)}else this.debug(" -- No colliders found for room: "+e.getName()),this.debug("      If you didn't intend on including collider objects in your FBX, something went wrong. Please check your FBX for unintentional collider user-detail attributes on mainScene objects.")}prepInteractables(e,t=T.HOVERABLE){if(!e.hasColliderType(t))return;let i=e.getName(),s=e.getColliders(t);s.length!==0&&(this.roomColliderData.hasOwnProperty(i)||(this.roomColliderData[i]={}),s.forEach(r=>{let a=r.geometry.attributes.position.array,o=a.length/3,n=r.name;if(!this.roomColliderData[i].hasOwnProperty(n)){this.roomColliderData[i][n]={},this.roomColliderData[i][n].hoverable=t===T.HOVERABLE,this.roomColliderData[i][n].clickable=t===T.CLICKABLE,this.roomColliderData[i][n].gridSize=this.baseGridSize,this.roomColliderData[i][n].faceVerts={};for(let h=0;h<o;++h){let u=h*9,c=new rt(a[u],a[u+1],a[u+2]),p=new rt(a[u+3],a[u+4],a[u+5]),d=new rt(a[u+6],a[u+7],a[u+8]),g=p.clone().sub(c),m=d.clone().sub(c),A=g.clone().cross(m),f=this.getGridKey(n,"_",this.flattenVector3(c),this.flattenVector3(p),this.flattenVector3(d)),C={object:r,key:f,verts:[c,p,d],edge0:g,edge1:m,normal:A};this.roomColliderData[i][n].faceVerts[f]=C}}}))}isGridEdgeIntersecting(e,t,i,s,r,a){let o=t.x,n=t.z,h=o!==0?(i-e.x)/o:1/0,u=o!==0?(s-e.x)/o:-1/0,c=n!==0?(r-e.z)/n:1/0,p=n!==0?(a-e.z)/n:-1/0,d=Math.max(Math.min(h,u),Math.min(c,p)),g=Math.min(Math.max(h,u),Math.max(c,p));return g>=d&&g>=0&&d<=1}getGridKey(...e){return e.join(this.delimiter)}flattenVector3(e){return this.getGridKey(this.pxlUtils.toNearestStr(e.x),this.pxlUtils.toNearestStr(e.y),this.pxlUtils.toNearestStr(e.z))}addFaceToGridLocation(e,t,i,s,r){let a=this.getGridKey(i,s);this.roomColliderData[e][t].faceGridGroup[a]||(this.roomColliderData[e][t].faceGridGroup[a]=[]),this.roomColliderData[e][t].faceGridGroup[a].push(r)}castRay(e,t,i,s=T.FLOOR,r=Zt.DOUBLE,a=!0){if(!this.roomColliderData.hasOwnProperty(e)||!this.roomColliderData[e].hasOwnProperty(s))return this.error("Room '"+e+"' does not have collider data for type: "+s),this.error(" -- Please register any collider objects with `pxlColliders.prepColliders()` or `pxlColliders.prepInteractables` first -- "),[];let o=this.roomColliderData[e][s],h=1/o.gridSize,u=Math.floor(t.x*h),c=Math.floor(t.z*h),p=this.getGridKey(u,c),d=1,g=1;if(r===Zt.FRONT?d=0:r===Zt.BACK&&(g=0),!o.faceGridGroup.hasOwnProperty(p))return[];let m=o.faceGridGroup[p],A={};m.forEach(v=>{let x=o.faceVerts[v],b=x.verts[0],I=x.edge0,E=x.edge1,B=i.clone().cross(E),w=I.dot(B);if(w*d>-this.epsilon&&w*g<this.epsilon)return;let D=t.clone().sub(b),S=D.dot(B);if(S<0||S>w)return;let P=D.clone().cross(I),F=i.dot(P);if(F<0||S+F>w)return;let O=1/w;S*=O,F*=O;let N=O*E.dot(P);if(N>this.epsilon){let M=t.clone().add(i.clone().multiplyScalar(N));A[N]={object:x.object,pos:M,dist:N}}});let f=Object.keys(A);f.sort();let C=[];for(let v=0;v<f.length;++v)C.push(A[f[v]]);if(o.helper){let v=C.length>0?C[0]:-1;this.setHelperActiveFace(e,s,v)}return C}castGravityRay(e,t,i=T.FLOOR,s=!0){if(!this.roomColliderData.hasOwnProperty(e)||!this.roomColliderData[e].hasOwnProperty(i))return[];let r=this.roomColliderData[e][i],a=r.gridSize,o=r.faceGridGroup,n=1/a,h=Math.floor(t.x*n),u=Math.floor(t.z*n),c=[this.getGridKey(h-1,u-1),this.getGridKey(h-1,u),this.getGridKey(h,u-1),this.getGridKey(h,u),this.getGridKey(h+1,u),this.getGridKey(h,u+1),this.getGridKey(h+1,u+1)],p=[];for(let A=0;A<c.length;++A)o!=null&&o.hasOwnProperty(c[A])&&p.push(...o[c[A]]);if(p=Object.keys(r.faceVerts),p.length===0)return[];p=[...new Set(p)];let d={};for(let A=0;A<p.length;++A){let f=r.faceVerts[p[A]],C=f.verts[0],v=f.verts[1],x=f.verts[2],b=t.clone().sub(C),I=f.normal,E=b.dot(I)/I.dot(I),B=t.clone().sub(I.clone().multiplyScalar(E)),w=x.sub(C),D=v.sub(C),S=B.clone().sub(C),P=w.dot(w),F=w.dot(D),O=w.dot(S),N=D.dot(D),M=D.dot(S),L=P*N-F*F;if(L===0)continue;L=1/(P*N-F*F);let H=(N*O-F*M)*L,k=(P*M-F*O)*L;if(H>=0&&k>=0&&H+k<1){let Q=C.clone().add(w.multiplyScalar(H)).add(D.multiplyScalar(k)),K=t.distanceTo(Q),Y={object:f.object,pos:Q,dist:K};if(d[K]=Y,!s)return[Y]}}let g=Object.keys(d);g.sort();let m=[];for(let A=0;A<g.length;++A)m.push(d[g[A]]);if(r.helper){let A=m.length>0?m[0]:-1;this.setHelperActiveFace(e,i,A)}return m}castInteractRay(e,t=[],i=null,s=Vi(0,0),r=!0){if(i===null)return this.error("No camera provided for castInteractRay()"),[];let a=new rt(0,0,0);i.getWorldDirection(a);let o=i.position.clone(),n=i.fov*this.degToRad,h=Math.tan(n*.5),u=i.aspect,c=s.x*u*h,p=s.y*h,d=-1,g=new rt(c,p,d).applyMatrix4(i.matrixWorld).sub(i.position).normalize(),m={};t.forEach(C=>{let v=C.name,b=this.roomColliderData[e][v].faceVerts;Object.keys(b).forEach(E=>{let B=b[E],w=B.verts[0],D=B.verts[1],S=B.verts[2],P=B.edge0,F=B.edge1,O=B.normal,N=O.dot(g);if(Math.abs(N)<1e-6)return;let L=(O.dot(w)-O.dot(o))/N;if(L<0)return;let H=o.clone().add(g.clone().multiplyScalar(L)),k=w.clone().sub(H),Q=D.clone().sub(H),K=S.clone().sub(H),Y=Q.clone().cross(K).length(),_=K.clone().cross(k).length(),$=k.clone().cross(Q).length(),ee=Y+_+$,Z=Y/ee,he=_/ee,xe=$/ee;if(Z>=0&&Z<=1&&he>=0&&he<=1&&xe>=0&&xe<=1){let Qe=w.clone().add(P.multiplyScalar(Z)).add(F.multiplyScalar(he)),Ce=o.distanceTo(Qe);if(m[Ce]={obj:C,pos:H},!r)return{obj:C,pos:H}}})});let A=Object.keys(m);A.sort();let f={};f.order=[],f.hits={},f.hitCount=0;for(let C=0;C<A.length;++C){let v=m[A[C]].obj,x=m[A[C]].pos,b=v.name;f.order.push(v),f.hits.hasOwnProperty(b)||(f.hits[b]=[]),f.hits[b].push(x),f.hitCount++}return f}toColorId(e,t=256){let i=1/t,s=1/(t*t),r=Math.floor(e*s)%t,a=Math.floor(e*i)%t,o=e%t;return[r*i,a*i,o*i]}getRandomColorIdList(e=64){let t=Array.from({length:e},(r,a)=>a),i=parseInt(Math.floor(t.length/3));i+=i&1?0:1;let s=[];for(let r=0;r<e&&t.length!==0;++r){if(t.length===1){s.push(t.pop());break}let a=i*r%t.length,o=t.splice(a,1);s.push(o[0])}return s}buildHelper(e,t=T.FLOOR){let i=e.getName(),s=this.roomColliderData[i][t],r=s.count;this.log("Building helper for "+i+" with "+r+" triangles");let a=new uA,o=[],n=[],h=[],u=this.getRandomColorIdList(r),c=parseInt(r**.5),p=.1;Object.keys(s.faceVerts).forEach((C,v)=>{let x=s.faceVerts[C].verts;o.push(x[0].x,x[0].y+p,x[0].z),o.push(x[1].x,x[1].y+p,x[1].z),o.push(x[2].x,x[2].y+p,x[2].z),h.push(0,0,0);let b=this.toColorId(u[v],c);n.push(...b,...b,...b)});let d=new Float32Array(o),g=new Float32Array(n),m=new Float32Array(h);a.setAttribute("position",new Jr(d,3)),a.setAttribute("colorId",new Jr(g,3)),a.setAttribute("visibility",new Jr(m,1));let A=new pA({uniforms:{visibleFaceId:{value:-1}},vertexShader:`
uniform float visibleFaceId;

attribute vec3 colorId;
attribute float visibility;

varying vec4 vCd;
varying float vVisibility;

void main() {
  vVisibility = visibility*.5+.5;

  vCd = vec4( normalize(colorId), 0.50 ); // Pre-calculated Blue for visible face
  if (visibleFaceId === 1.0) {
    vCd = vec4( 0.0, 1.0, 0.0, 1.0 ); // Green for visible face
  }

  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,fragmentShader:`
varying vec4 vCd;
varying float vVisibility;

void main() {

  vec4 Cd = vCd;
  //Cd.a *= vVisibility;
  //Cd.rgb = vec3( vVisibility );

  gl_FragColor = Cd;
}
`});A.side=dA,A.transparent=!0,A.depthTest=!0,A.depthWrite=!1,A.blending=fA;let f=new AA(a,A);return f.renderOrder=2,this.roomColliderData[i][t].helper=f,f}stepHelper(e,t=T.FLOOR){let i=e.getName(),a=1/this.roomColliderData[i][t].gridSize,o=Math.floor(e.position.x*a),n=Math.floor(e.position.z*a),h=this.getGridKey(o,n);this.prevGridKey}setHelperActiveFace(e,t=T.FLOOR,i=-1){let a=this.roomColliderData[e][t].helper.material;a.uniforms.visibleFaceId.value=i}destroy(e){if(this.objNames.includes(e)){this.animMixer[e].stopAllAction(),delete this.animMixer[e],delete this.objects[e];let t=this.objNames.indexOf(e);this.objNames.splice(t,1)}}};import{Clock as mA,AnimationMixer as gA,MeshStandardMaterial as vA}from"three";var ji=class{constructor(e=null,t=null){this.pxlEnv=null,this.assetPath=e,this.verbose=!1,this.animInitEntry={rig:null,mesh:null,mixer:null,clips:{},state:null,hasConnection:!1,prevTime:-1,connected:[],connections:{}},this.objNames=[],this.objects={},this.animMixer={},this.msRunner=t,this.clock=new mA}setDependencies(e){this.pxlEnv=e}log(e){this.verbose&&console.log(e)}initObject(e,t){let i=null,s=null,r=t.children.length,a=0,o=[...t.children],n=0,h=0,u=0,c=0;for(;a<r;){let d=o[a];switch(d.type){case"Bone":++h,i=d;break;case"Mesh":++n,d.visible=!1;break;case"SkinnedMesh":++u,s=d;break;case"Group":++c,o=o.concat(d.children),r=o.length;break;default:break}++a}let p=!1;if(i||(this.log("Error, No Bone/Rig Root Found; Please move your rig to the scene's root. Grouped rigs aren't supported yet."),p=!0),s||(this.log("Error, No SkinnedMesh Found; Please ensure your rig has a mesh to animate."),p=!0),p){console.log("Unable to prepare '"+e+"' for animation"),console.log("Group Count: "+c),console.log("Bone Root Found : "+(h>0)),console.log("Bone Count : "+h),console.log("Mesh Count: "+n),console.log("SkinnedMesh Count: "+u);return}if(!this.objNames.includes(e)){this.objNames.push(e);let d=Object.assign({},this.animInitEntry);d.rig=i,d.mesh=s,this.animMixer[e]=new gA(i),d.mixer=this.animMixer[e],this.objects[e]=d;let g=new vA;g.map=s.material.map,s.material=g}}addClips(e,t,i){if(!this.objNames.includes(e)){this.log("Error, '"+e+"' not found in Animation Manager");return}Object.keys(this.objects[e].clips).includes(t)&&this.log("Warning, '"+t+"' already exists in '"+e+"'");let a=this.animMixer[e].clipAction(i.animations[0]);this.objects[e].clips[t]=a}hasClip(e,t){return this.objNames.includes(e)?Object.keys(this.objects[e].clips).includes(t):!1}getMixer(e){return this.objNames.includes(e)?this.animMixer[e]:null}getRig(e){return this.objNames.includes(e)?this.objects[e].rig:null}getMesh(e){return this.objNames.includes(e)?this.objects[e].mesh:null}getFallbackCycle(e){if(this.objNames.includes(e)){let t=Object.keys(this.objects[e].clips);if(t.length>0)return t[0]}return null}playClip(e,t){if(this.objNames.includes(e)&&Object.keys(this.objects[e].clips).includes(t)){let s=this.objects[e].clips[t];this.objects[e].state=t,this.objects[e].prevTime=-1,this.objects[e].hasConnection=this.objects[e].connected.includes(t),this.setWeight(e,t,1,!0),s.reset(),s.play()}}setWeight(e,t,i,s=!1){if(this.objNames.includes(e)){let r=Object.keys(this.objects[e].clips);if(r.includes(t)){let a=this.objects[e].clips[t];a.enabled=!0,a.setEffectiveTimeScale(1),a.setEffectiveWeight(i),s&&r.forEach(o=>{if(o!==t){let n=this.objects[e].clips[o];n.enabled=!1,n.setEffectiveTimeScale(1),n.setEffectiveWeight(0)}})}}}setStateConnections(e,t){if(this.objNames.includes(e)){let i=Object.keys(t);this.objects[e].connected=i,this.objects[e].connections=t}}step(e){if(this.objNames.includes(e)){if(!this.objects[e].hasConnection){this.animMixer[e].update(this.clock.getDelta());return}let i=this.objects[e].state;if(i){let r=this.objects[e].clips[i].time;if(this.objects[e].prevTime>r){let o=this.objects[e].connections[i],n=o[Math.floor(Math.random()*o.length)];this.playClip(e,n)}else this.animMixer[e].update(this.clock.getDelta()),this.objects[e].prevTime=r}else this.animMixer[e].update(this.clock.getDelta())}}destroy(e){if(this.objNames.includes(e)){this.animMixer[e].stopAllAction(),delete this.animMixer[e],delete this.objects[e];let t=this.objNames.indexOf(e);this.objNames.splice(t,1)}}};import{Vector2 as Dn,ShaderMaterial as le,FrontSide as xA,LinearSRGBColorSpace as CA}from"three";var Ki=class{constructor(e){this.pxlOptions=e,this.pxlEnv=null,this.pxlUser=null,this.pxlUtils=null,this.pxlTimer=null,this.pxlQuality=null,this.pxlDevice=null,this.pxlCamera=null,this.pxlShaders=null,this.engine=null,this.scene=null,this.shaderPasses={},this.stepShaderFuncArr=[],this.pxlRenderSettings={exposure:1,mult:1,bloomStrength:.5,bloomThresh:.6,bloomRadius:.05},this.mapMotionBlurPass=null,this.mapOverlayHeavyPass=null,this.mapOverlayPass=null,this.mapOverlaySlimPass=null,this.mapBoxAAPass=null,this.mapCrossAAPass=null,this.mapWorldPosMaterial=null,this.mapGlowPass=null,this.mapComposer=null,this.mapComposerMotionBlur=null,this.mapComposerGlow=null,this.chromaticAberrationPass=null,this.lizardKingPass=null,this.mapComposerWarpPass=null,this.blurScreenMerge=null}init(){}setDependencies(e){this.scene=e.scene,this.pxlEnv=e.pxlEnv,this.pxlUser=e.pxlUser,this.pxlUtils=e.pxlUtils,this.pxlTimer=e.pxlTimer,this.pxlQuality=e.pxlQuality,this.pxlDevice=e.pxlDevice,this.pxlCamera=e.pxlCamera,this.pxlShaders=e.pxlShaders}buildComposers(){var a,o;let e=((a=this.pxlCamera.camera)==null?void 0:a.near)||.1,t=((o=this.pxlCamera.camera)==null?void 0:o.far)||1e3;this.mapWorldPosMaterial=new le({uniforms:{camNear:{type:"f",value:e},camFar:{type:"f",value:t}},vertexShader:this.pxlShaders.rendering.worldPositionVert(),fragmentShader:this.pxlShaders.rendering.worldPositionFrag()}),this.mapWorldPosMaterial.side=xA,this.mapWorldPosMaterial.name="mapWorldPosMaterial",this.pxlOptions.postProcessPasses.roomGlowPass&&(this.blurComposer=new De(this.engine),this.shaderPasses.blurXShaderPass=new X(new le({uniforms:{time:{value:this.pxlTimer.msRunner},tDiffuse:{value:null},pDiffuse:{value:null},resUV:{value:this.pxlDevice.screenRes}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.directionalBlurPass("pDiffuse",[1,0],4,1.8),defines:{}}),"tDiffuse"),this.shaderPasses.blurXShaderPass.material.uniforms.pDiffuse=this.pxlEnv.scene.renderGlowTarget.texture,this.shaderPasses.blurXShaderPass.material.transparent=!0,this.shaderPasses.blurXShaderPass.needsSwap=!0,this.shaderPasses.blurXShaderPass.enabled=!1,this.shaderPasses.blurXShaderPass.name="blurXShaderPass",this.blurComposer.addPass(this.shaderPasses.blurXShaderPass),this.shaderPasses.dirBlurCopyPass=new X(Fe),this.shaderPasses.dirBlurCopyPass.enabled=!1,this.shaderPasses.dirBlurCopyPass.name="dirBlurCopyPass",this.blurComposer.addPass(this.shaderPasses.dirBlurCopyPass),this.shaderPasses.blurYShaderPass=new X(new le({uniforms:{time:{value:this.pxlTimer.msRunner},tDiffuse:{value:null},pDiffuse:{value:null},resUV:{value:this.pxlDevice.screenRes}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.directionalBlurPass("pDiffuse",[0,1],4,1.3),defines:{}}),"tDiffuse"),this.shaderPasses.blurYShaderPass.material.uniforms.pDiffuse=this.pxlEnv.scene.renderGlowTarget.texture,this.shaderPasses.blurYShaderPass.material.transparent=!0,this.shaderPasses.blurYShaderPass.enabled=!1,this.shaderPasses.blurYShaderPass.name="blurYShaderPass",this.blurComposer.addPass(this.shaderPasses.blurYShaderPass),this.shaderPasses.scatterMixShaderPass=new X(new le({uniforms:{time:{value:this.pxlTimer.msRunner},tDiffuse:{value:null},pDiffuse:{value:null},resUV:{value:this.pxlDevice.screenRes}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.mixBlurShaderPass(),defines:{}}),"tDiffuse"),this.shaderPasses.scatterMixShaderPass.material.uniforms.pDiffuse=this.pxlEnv.scene.renderGlowTarget.texture,this.shaderPasses.scatterMixShaderPass.material.transparent=!0,this.shaderPasses.scatterMixShaderPass.enabled=!1,this.shaderPasses.scatterMixShaderPass.name="scatterMixShaderPass",this.blurComposer.addPass(this.shaderPasses.scatterMixShaderPass),this.pxlOptions.antiAliasing===Jt.LOW?this.shaderPasses.scatterMixShaderPass.enabled=!0:this.pxlOptions.antiAliasing===Jt.MEDIUM?(this.shaderPasses.blurXShaderPass.enabled=!0,this.shaderPasses.dirBlurCopyPass.enabled=!0,this.shaderPasses.blurYShaderPass.enabled=!0):this.pxlOptions.antiAliasing===Jt.HIGH&&(this.shaderPasses.blurXShaderPass.enabled=!0,this.shaderPasses.dirBlurCopyPass.enabled=!0,this.shaderPasses.blurYShaderPass.enabled=!0,this.shaderPasses.scatterMixShaderPass.enabled=!0)),this.mapComposerMotionBlur=new De(this.engine),this.mapMotionBlurPass=new X(new le({uniforms:{tDiffuse:{value:null},rDiffuse:{value:null},exposure:{type:"f",value:this.pxlRenderSettings.exposure},time:{value:this.pxlTimer.msRunner},camRotXYZ:{value:this.pxlCamera.camRotXYZ},blurDirCur:{type:"f",value:this.blurDirCur},blurDirPrev:{type:"f",value:this.blurDirPrev},noiseTexture:{value:this.pxlEnv.cloud3dTexture}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.motionBlurPostProcess(this.pxlDevice.screenRes,this.pxlDevice.mobile),defines:{}}),"tDiffuse"),this.mapMotionBlurPass.material.uniforms.rDiffuse=this.pxlEnv.scene.renderTarget.texture,this.mapMotionBlurPass.needsSwap=!0,this.mapMotionBlurPass.name="mapMotionBlurPass",this.mapComposerMotionBlur.addPass(this.mapMotionBlurPass),this.mapMotionBlurPass.enabled=!1,this.mapComposerMotionBlur.renderToScreen=!1,this.mapComposerGlow=new De(this.engine);let i=new ht(this.pxlEnv.scene,this.pxlCamera.camera);this.mapComposerGlow.addPass(i),this.blurScreenMerge=new X(new le({uniforms:{tDiffuse:{value:null},rDiffuse:{value:null},mtDiffuse:{value:null},exposure:{type:"f",value:this.pxlRenderSettings.exposure}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.compLayersPostProcess(),defines:{}}),"tDiffuse"),this.blurScreenMerge.material.uniforms.rDiffuse=this.pxlEnv.scene.renderTarget.texture,this.blurScreenMerge.material.uniforms.mtDiffuse=this.pxlEnv.scene.renderTarget.texture,this.blurScreenMerge.needsSwap=!0,this.blurScreenMerge.name="blurScreenMerge",this.mapComposerGlow.addPass(this.blurScreenMerge);let s=new X(Fe);s.name="glowCopyPassBlur",this.mapComposerGlow.addPass(s),this.mapComposerGlow.renderToScreen=!1,this.mapComposerGlow.autoClear=!0,this.mapOverlayHeavyPass=new X(new le({uniforms:{gamma:{type:"f",value:this.pxlDevice.gammaCorrection},exposure:{type:"f",value:this.pxlRenderSettings.exposure},time:{value:this.pxlTimer.msRunner},camPos:{value:this.pxlCamera.camera.position},ratio:{type:"f",value:1},tDiffuse:{value:null},rDiffuse:{value:null},bloomTexture:{value:null},sceneDepth:{value:null},scenePos:{value:null},noiseTexture:{value:this.pxlEnv.cloud3dTexture},fogMult:{value:this.fogMult},proximityMult:{value:1}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.finalOverlayHeavyShader(),defines:{}}),"tDiffuse"),this.mapOverlayHeavyPass.material.uniforms.rDiffuse=this.pxlEnv.scene.renderTarget.texture,this.mapOverlayHeavyPass.material.uniforms.bloomTexture=this.mapComposerGlow.renderTarget2.texture,this.mapOverlayHeavyPass.material.uniforms.sceneDepth=this.pxlEnv.scene.renderTarget.depthTexture,this.mapOverlayHeavyPass.material.uniforms.scenePos=this.pxlEnv.scene.renderWorldPos.texture,this.mapOverlayHeavyPass.needsSwap=!0,this.mapOverlayHeavyPass.name="mapOverlayHeavyPass",this.mapOverlayPass=new X(new le({uniforms:{gamma:{type:"f",value:this.pxlDevice.gammaCorrection},exposure:{type:"f",value:this.pxlRenderSettings.exposure},time:{value:this.pxlTimer.msRunner},camPos:{value:this.pxlCamera.camera.position},ratio:{type:"f",value:1},tDiffuse:{value:null},rDiffuse:{value:null},bloomTexture:{value:null},sceneDepth:{value:null},scenePos:{value:null},noiseTexture:{value:this.pxlEnv.cloud3dTexture},fogMult:{value:this.fogMult},proximityMult:{value:1}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.finalOverlayShader(),defines:{}}),"tDiffuse"),this.mapOverlayPass.material.uniforms.rDiffuse=this.pxlEnv.scene.renderTarget.texture,this.mapOverlayPass.material.uniforms.bloomTexture=this.mapComposerGlow.renderTarget2.texture,this.mapOverlayPass.material.uniforms.sceneDepth=this.pxlEnv.scene.renderTarget.depthTexture,this.mapOverlayPass.material.uniforms.scenePos=this.pxlEnv.scene.renderWorldPos.texture,this.mapOverlayPass.needsSwap=!0,this.mapOverlayPass.name="mapOverlayPass",this.mapOverlaySlimPass=new X(new le({uniforms:{gamma:{type:"f",value:this.pxlDevice.gammaCorrection},exposure:{type:"f",value:this.pxlRenderSettings.exposure},time:{value:this.pxlTimer.msRunner},camPos:{value:this.pxlCamera.camera.position},ratio:{type:"f",value:1},tDiffuse:{value:null},rDiffuse:{value:null},bloomTexture:{value:null},sceneDepth:{value:null},fogMult:{value:this.fogMult},proximityMult:{value:1}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.finalOverlaySlimShader(),defines:{}}),"tDiffuse"),this.mapOverlaySlimPass.material.uniforms.rDiffuse=this.pxlEnv.scene.renderTarget.texture,this.mapOverlaySlimPass.material.uniforms.bloomTexture=this.mapComposerGlow.renderTarget2.texture,this.mapOverlaySlimPass.material.uniforms.sceneDepth=this.pxlEnv.scene.renderTarget.depthTexture,this.mapOverlaySlimPass.needsSwap=!0,this.mapOverlaySlimPass.name="mapOverlaySlimPass",this.mapGlowPass=new X(new le({uniforms:{time:{value:this.pxlTimer.msRunner},ratio:{type:"f",value:1},tDiffuse:{value:null},rDiffuse:{value:null},sceneDepth:{value:null}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.glowPassPostProcess(),defines:{}}),"tDiffuse"),this.mapGlowPass.material.uniforms.rDiffuse=this.pxlEnv.scene.renderGlowTarget.texture,this.mapGlowPass.material.uniforms.sceneDepth=this.pxlEnv.scene.renderTarget.depthTexture,this.mapGlowPass.needsSwap=!0,this.mapGlowPass.name="mapGlowPass",this.mapComposer=new De(this.engine),this.mapComposer.addPass(this.mapOverlayHeavyPass),this.mapComposer.addPass(this.mapOverlayPass),this.mapComposer.addPass(this.mapOverlaySlimPass),this.mapComposer.addPass(this.mapGlowPass),this.mapOverlayHeavyPass.enabled=!1,this.mapOverlayPass.enabled=!1,this.pxlUser.lKingWarp=new Dn(...this.pxlUser.lKingInactive),this.lizardKingPass=new X(new le({uniforms:{tDiffuse:{value:null},time:{value:this.pxlTimer.msRunner},ratio:{value:this.pxlDevice.screenRes},noiseTexture:{value:this.pxlEnv.cloud3dTexture}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.lKingPostProcess(),defines:{}}),"tDiffuse"),this.pxlUser.lizardKingPass=this.lizardKingPass,this.lizardKingPass.enabled=!1,this.pxlUser.lizardKingPass.name="lizardKingPass",this.pxlUser.starFieldPass=new X(new le({uniforms:{tDiffuse:{value:null},time:{value:this.pxlTimer.msRunner},ratio:{value:this.pxlDevice.screenRes},noiseTexture:{value:this.pxlEnv.cloud3dTexture},starTexture:{value:this.pxlUtils.loadTexture(this.pxlUtils.assetRoot+"uv_starNoise.jpg",null,{encoding:CA})}},vertexShader:this.pxlShaders.rendering.sFieldPostProcessVert(),fragmentShader:this.pxlShaders.rendering.sFieldPostProcessFrag(),defines:{}}),"tDiffuse"),this.pxlUser.starFieldPass.enabled=!1,this.pxlUser.starFieldPass.name="starFieldPass",this.pxlUser.crystallinePass=new X(new le({uniforms:{tDiffuse:{value:null},tDiffusePrev:{type:"t",value:null},time:{value:this.pxlTimer.msRunner},ratio:{value:this.pxlDevice.screenRes},noiseTexture:{value:this.pxlEnv.cloud3dTexture}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.iZoomPostProcess(),defines:{}}),"tDiffuse"),this.pxlUser.crystallinePass.enabled=!1,this.pxlUser.crystallinePass.name="crystallinePass",this.pxlOptions.postProcessPasses.chromaticAberrationPass&&(this.chromaticAberrationPass=new X(new le({uniforms:{tDiffuse:{value:null},ratio:{value:this.pxlDevice.screenRes},warpMult:{value:this.chroAberMult},chroAberUVTexture:{value:this.chroAberUVTexture},chroAberUVAlpha:{value:this.chroAberUVAlpha},lKing:{value:this.pxlUser.lKingWarp}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.chroAberPostProcess(),defines:{}}),"tDiffuse"),this.chromaticAberrationPass.enabled=!1,this.chromaticAberrationPass.name="chromaticAberrationPass",this.mapComposer.addPass(this.chromaticAberrationPass)),this.pxlOptions.postProcessPasses.lizardKingPass&&this.mapComposer.addPass(this.lizardKingPass),this.pxlOptions.postProcessPasses.starFieldPass&&this.mapComposer.addPass(this.pxlUser.starFieldPass),this.pxlOptions.postProcessPasses.crystallinePass&&this.mapComposer.addPass(this.pxlUser.crystallinePass),this.pxlOptions.postProcessPasses.mapComposerWarpPass&&(this.mapComposerWarpPass=new X(new le({uniforms:{time:{value:this.pxlTimer.msRunner},fader:{value:this.pxlEnv.warpVisualFader},tDiffuse:{value:null},noiseTexture:{value:this.pxlEnv.cloud3dTexture},animTexture:{value:this.pxlEnv.blockAnimTexture}},vertexShader:this.pxlShaders.core.camPosVert(),fragmentShader:this.pxlShaders.rendering.warpPostProcess(),defines:{}}),"tDiffuse"),this.mapComposerWarpPass.needsSwap=!0,this.mapComposerWarpPass.enabled=!1,this.mapComposerWarpPass.name="mapComposerWarpPass",this.mapComposer.addPass(this.mapComposerWarpPass)),this.mapBoxAAPass=new X(new le({uniforms:{tDiffuse:{value:null},resUV:{type:"f",value:this.pxlDevice.screenRes},ratio:{type:"f",value:1},gamma:{type:"f",value:this.pxlDevice.gammaCorrection}},vertexShader:this.pxlShaders.core.camPosVert(),fragmentShader:this.pxlShaders.rendering.boxAntiAliasPass(),defines:{}}),"tDiffuse"),this.mapBoxAAPass.enabled=!1,this.mapBoxAAPass.name="mapBoxAAPass",this.mapComposer.addPass(this.mapBoxAAPass),this.mapCrossAAPass=new X(new le({uniforms:{tDiffuse:{value:null},resUV:{type:"f",value:this.pxlDevice.screenRes},ratio:{type:"f",value:1},gamma:{type:"f",value:this.pxlDevice.gammaCorrection}},vertexShader:this.pxlShaders.core.camPosVert(),fragmentShader:this.pxlShaders.rendering.crossAntiAliasPass(),defines:{}}),"tDiffuse"),this.mapCrossAAPass.enabled=!1,this.mapCrossAAPass.name="mapCrossAAPass",this.mapComposer.addPass(this.mapCrossAAPass),this.mapComposer.autoClear=!0;let r=this.pxlEnv.roomSceneList[this.pxlEnv.bootRoom].scene;this.roomComposer=new De(this.engine),this.roomRenderPass=new ht(r,this.pxlCamera.camera),this.roomRenderPass.name="roomRenderPass",this.roomComposer.addPass(this.roomRenderPass),this.pxlEnv.roomNameList.forEach(n=>{if(n!==this.mainRoom){let h=this.pxlEnv.roomSceneList[n].applyRoomPass(this.roomComposer);h&&(h.enabled=!1,this.roomComposer.addPass(h))}}),this.pxlOptions.postProcessPasses.roomGlowPass&&(this.roomBloomPass=new $e(new Dn(this.pxlDevice.mapW*.5,this.pxlDevice.mapH*.5),1.5,.8,.85),this.roomBloomPass.threshold=this.pxlRenderSettings.bloomThresh,this.roomBloomPass.strength=this.pxlRenderSettings.bloomStrength,this.roomBloomPass.radius=this.pxlRenderSettings.bloomRadius,this.roomBloomPass.name="roomBloomPass",this.roomComposer.addPass(this.roomBloomPass),this.roomGlowPass=new X(new le({uniforms:{time:{value:this.pxlTimer.msRunner},ratio:{type:"f",value:1},tDiffuse:{value:null},gDiffuse:{value:null},rDiffuse:{value:null},sceneDepth:{value:null}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.glowPassPostProcess(),defines:{}}),"tDiffuse"),this.roomGlowPass.material.uniforms.gDiffuse=this.blurComposer.writeBuffer.texture,this.roomGlowPass.material.uniforms.rDiffuse=this.blurComposer.renderTarget2.texture,this.roomGlowPass.material.uniforms.sceneDepth=this.pxlEnv.scene.renderTarget.depthTexture,this.roomGlowPass.needsSwap=!0,this.roomGlowPass.name="roomGlowPass",this.roomComposer.addPass(this.roomGlowPass)),this.pxlOptions.postProcessPasses.chromaticAberrationPass&&this.roomComposer.addPass(this.chromaticAberrationPass),this.pxlOptions.postProcessPasses.lizardKingPass&&this.roomComposer.addPass(this.lizardKingPass),this.pxlOptions.postProcessPasses.starFieldPass&&this.roomComposer.addPass(this.pxlUser.starFieldPass),this.pxlOptions.postProcessPasses.crystallinePass&&this.roomComposer.addPass(this.pxlUser.crystallinePass),this.pxlOptions.postProcessPasses.mapComposerWarpPass&&this.roomComposer.addPass(this.mapComposerWarpPass),this.roomComposer.addPass(this.mapCrossAAPass),this.roomComposer.addPass(this.mapBoxAAPass),this.roomComposer.autoClear=!0,this.delayComposer=new De(this.engine),this.delayPass=new X(new le({uniforms:{tDiffuse:{value:null},roomComposer:{type:"f",value:0},tDiffusePrev:{value:null},tDiffusePrevRoom:{value:null}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.textureStorePass(),defines:{}}),"tDiffuse"),this.delayPass.material.uniforms.tDiffusePrev=this.mapComposer.renderTarget1.texture,this.delayPass.material.uniforms.tDiffusePrevRoom=this.roomComposer.renderTarget1.texture,this.delayPass.clear=!1,this.delayComposer.addPass(this.delayPass),this.delayComposer.renderToScreen=!1,this.delayComposer.autoClear=!1,this.pxlUser.crystallinePass.uniforms.tDiffusePrev.value=this.delayComposer.renderTarget2.texture}resize(e,t){this.pxlEnv.mapComposer&&this.pxlEnv.mapComposer.setSize(e,t),this.pxlEnv.mapComposerGlow&&this.pxlEnv.mapComposerGlow.setSize(e,t),this.pxlEnv.roomComposer&&this.pxlEnv.roomComposer.setSize(e,t),this.pxlEnv.roomGlowPass&&this.pxlEnv.roomGlowPass.setSize(e*this.pxlQuality.bloomPercMult,t*this.pxlQuality.bloomPercMult),this.pxlEnv.delayComposer&&this.pxlEnv.delayComposer.setSize(e,t),this.pxlEnv.mapGlowPass&&this.pxlEnv.mapGlowPass.setSize(e*this.pxlQuality.bloomPercMult,t*this.pxlQuality.bloomPercMult),this.pxlEnv.mapMotionBlurPass&&this.pxlEnv.mapMotionBlurPass.setSize(e*this.pxlQuality.mBlurPercMult,t*this.pxlQuality.mBlurPercMult),this.pxlEnv.mapOverlayHeavyPass&&(this.pxlEnv.mapOverlayHeavyPass.setSize(e,t),this.pxlEnv.mapOverlayHeavyPass.uniforms.ratio.value=Math.min(1,e/t)),this.pxlEnv.mapOverlayPass&&(this.pxlEnv.mapOverlayPass.setSize(e,t),this.pxlEnv.mapOverlayPass.uniforms.ratio.value=Math.min(1,e/t)),this.pxlEnv.mapOverlaySlimPass&&(this.pxlEnv.mapOverlaySlimPass.setSize(e,t),this.pxlEnv.mapOverlaySlimPass.uniforms.ratio.value=Math.min(1,e/t))}updateCompUniforms(e=null){e&&(this.pxlRenderSettings.exposure=e*this.pxlRenderSettings.mult),this.mapOverlayPass&&(this.mapMotionBlurPass.uniforms.exposure.value=this.pxlRenderSettings.exposure,this.mapOverlayHeavyPass.uniforms.exposure.value=this.pxlRenderSettings.exposure,this.mapOverlayPass.uniforms.exposure.value=this.pxlRenderSettings.exposure,this.mapOverlaySlimPass.uniforms.exposure.value=this.pxlRenderSettings.exposure)}stepShaderValues(){this.stepShaderFuncArr.forEach(e=>{typeof e=="object"&&e.step()})}};import{Vector2 as ot,Vector3 as nt,WebGLRenderTarget as bA,RGBAFormat as Rn,LinearFilter as Wi,DepthTexture as yA,DepthFormat as EA,UnsignedShortType as IA,FloatType as BA,HalfFloatType as wA,Scene as SA,Group as Zr,Color as Tn,FogExp2 as DA,LinearSRGBColorSpace as RA,PlaneGeometry as TA,DoubleSide as PA,Mesh as MA}from"three";var zi={height:{standing:1.75,stepSize:5},movement:{scalar:1,max:10,easing:.55},look:{pc:{invert:!1},mobile:{invert:!0}},headBounce:{height:.3,rate:.025,easeIn:.03,easeOut:.95},jump:{impulse:.75,holdMax:2.85,repeatDelay:.08},gravity:{ups:.3,max:15.5},deadZone:{controller:.1,touch:20,xr:.1}},at={verbose:z.VERBOSE_LEVEL.NONE,fps:{pc:60,mobile:30},renderScale:{pc:1,mobile:1.5},fullLoadPreBoot:!0,staticCamera:!1,autoCamera:!1,allowStaticRotation:!1,userSettings:Object.assign({},zi),subFrameCalculations:!1,pxlRoomRoot:"./pxlRooms",pxlAssetRoot:"./pxlAssets",showOnboarding:!0,onboarding:{pc:{message:"Welcome to<br>%projectTitle%",messageStyle:["pxlGui-welcome-message"],buttonText:"close",buttonStyle:["guiButton"]},mobile:{message:"Welcome to<br>%projectTitle%",messageStyle:["pxlGui-mobile-body"],buttonText:"start",buttonStyle:["guiButton","pxlGui-mobile-welcomeButton"]}},loaderPhrases:["...loading the pixels..."],antiAliasing:z.ANTI_ALIASING.LOW,collisionScale:{gridSize:50,gridReference:1e3},shadowMapBiasing:z.SHADOW_MAP.BASIC,loadEnvAssetFile:!1,skyHaze:z.SKY_HAZE.OFF,postProcessPasses:{roomGlowPass:!1,motionBlurPass:!1,mapComposerWarpPass:!1,chromaticAberrationPass:!1,lizardKingPass:!1,starFieldPass:!1,crystallinePass:!1}};var qi=class{constructor(e,t="Default",i){this.engine=null,this.scene=null,this.parentGroupList={},this.parentGroupList[t]=[],this.parentNameList=[],this.pxlOptions=e,this.pxlRendering=null,this.prevRenderMS=0,this.prevRuntimeMS=0,this.nextRenderMS=0,this.fps=30,this.pxlOptions.fps.hasOwnProperty("mobile")?this.fps=i?this.pxlOptions.fps.mobile:this.pxlOptions.fps.pc:this.pxlOptions.fps.hasOwnProperty("Mobile")&&(this.fps=i?this.pxlOptions.fps.Mobile:this.pxlOptions.fps.PC),this.renderInterval=1/this.fps;let s="Default";this.pxlOptions.hasOwnProperty("pxlRoomName")?s=this.pxlOptions.pxlRoomName:s=t||"Default",this.pxlRoomAbsRoot=s;let r=s.split("/");r.splice(0,1),r=r.join("/"),s=s.startsWith("./")?s.slice(1):s,this.pxlOptions.hasOwnProperty("pxlRoomRoot")?this.pxlRoomLclRoot=this.pxlOptions.pxlRoomRoot:this.pxlRoomLclRoot="./"+s.split("/").pop().join("/"),this.mainRoom=t,this.bootRoom=t,this.bootLocation=null,this.currentRoom=t,this.roomNameList=[t],this.roomSubList={},this.roomSceneList={},this.roomSceneList[t]=this,this.roomPostGuiCalls=[],this.jmaCheckConnection=!1,this.checkContext=0,this.activeContext=!1,this.warpPortalTextures={},this.warpZoneRenderTarget=null,this.currentAudioZone=0,this.pxlUtils=null,this.pxlEnums=null,this.pxlTimer=null,this.pxlAnim=null,this.pxlColliders=null,this.pxlAutoCam=null,this.pxlAudio=null,this.pxlFile=null,this.pxlVideo=null,this.pxlQuality=null,this.pxlUser=null,this.pxlShaders=null,this.pxlDevice=null,this.pxlCamera=null,this.pxlGuiDraws=null,this.cloud3dTexture=null,this.softNoiseTexture=null,this.detailNoiseTexture=null,this.chroAberUVTexture=null,this.chroAberUVAlpha=null,this.blockAnimTexture=null,this.userScreenIntensity=new ot(0,.8),this.portaluserScreenIntensity=new ot(1,0),this.portalMtlRate=.7,this.mobile=i,this.camNear=.1,this.camFar=5e3,this.fogMult=new ot(0,0),this.fogColor=new Tn(.07,.07,.1),this.fogColorSky=new Tn(.1,.1,.12),this.fogExp=3e-4,this.fog=new DA(this.fogColor,this.fogExp),this.listener=null,this.posted=!1,this.postIntro=!1,this.camLocation={},this.camInitPos=new nt(0,15,0),this.camInitLookAt=new nt(0,15,0),this.camThumbPos=new nt(0,0,0),this.camThumbLookAt=new nt(0,20,0),this.camReturnPos=new nt(0,0,0),this.camReturnLookAt=new nt(0,0,0),this.camLobbyPos=new nt(0,15,0),this.camLobbyLookAt=new nt(0,15,-100),this.pxlCamFOV={PC:60,MOBILE:80},this.pxlCamZoom=1,this.pxlCamAspect=1,this.pxlCamNearClipping=this.camNear,this.pxlCamFarClipping=this.camFar,this.groupList=[],this.geoList=[],this.geoLoadList=[],this.geoLoadListComplete=0,this.lightList=[],this.returnPortalGlowList=[],this.roomWarpVisuals={},this.proximityGeo=null,this.userAvatarGroup=new Zr,this.warpVisualActive=!1,this.warpVisualMaxTime=[1.5,1],this.warpVisualStartTime=0,this.warpVisualFader=new ot(0,1),this.warpVisualCmd=null,this.exposureShiftActive=!1,this.delayComposer=null,this.delayPass=null,this.chroAberMult=new ot(1,0),this.blurDirCur=new ot(0,0),this.blurDirPrev=new ot(0,0),this.roomComposer=null,this.roomRenderPass=null,this.roomBloomPass=null,this.roomGlowPass=null,this.blurComposer=null,this.glowPassMask=new ot(1,0),this.objectClickable=[],this.objectClickableObjectList={},this.clickablePrevActiveObject=null,this.promoClickable=[],this.promoClickableObjectList={},this.promoPrevActiveObject=null,this.promoClickableLinks={},this.remoteVideoTextureList=[],this.remoteUserNameList=[],this.remoteUserMediaList={},this.remoteUserVideoList=[],this.remoteUserAudioList=[],this.camScreenData={count:0,prevCount:0,checkUserCount:!0,checkVideoStatus:!0,findCamCount:()=>{},videoObjectList:[],screenGeoList:[],screenClickable:[],screenMtlUniforms:[],userDataList:[],camFindInfoList:[]},this.curUserCount=0,this.prevUserCount=0,this.emit=(a,o)=>{}}setDependencies(e){this.scene=e.scene,this.pxlUtils=e.pxlUtils,this.pxlEnums=e.pxlEnums,this.pxlTimer=e.pxlTimer,this.pxlAnim=e.pxlAnim,this.pxlRendering=e.pxlRendering,this.pxlColliders=e.pxlColliders,this.pxlAutoCam=e.pxlAutoCam,this.pxlAudio=e.pxlAudio,this.pxlFile=e.pxlFile,this.pxlVideo=e.pxlVideo,this.pxlQuality=e.pxlQuality,this.pxlUser=e.pxlUser,this.pxlShaders=e.pxlShaders,this.pxlDevice=e.pxlDevice,this.pxlCamera=e.pxlCamera,this.pxlGuiDraws=e.pxlGuiDraws,this.emit=e.emit.bind(e)}log(...e){this.pxlOptions.verbose>te.INFO&&console.log(e)}debug(...e){this.pxlOptions.verbose>te.DEBUG&&console.log(e)}warn(...e){this.pxlOptions.verbose>te.WARN&&console.warn(e)}error(...e){this.pxlOptions.verbose>te.ERROR&&console.error(e)}init(){let e=Object.keys(this.pxlOptions);Object.keys(at).forEach(s=>{e.includes(s)||(this.pxlOptions[s]=at[s])}),Object.keys(this.roomSubList).forEach(s=>{this.roomSubList[s].init()})}boot(){}setBootRoom(e,t){this.bootRoom=e,this.bootLocation=t}postBoot(){this.pxlGuiDraws.togglePageDisplay(),this.roomSceneList[this.bootRoom].start(),this.posted=!0,this.pxlOptions.showOnboarding&&(this.pxlDevice.mobile||this.pxlAutoCam.enabled?this.pxlGuiDraws.toggleMobileWelcome(!0):this.pxlGuiDraws.iconEvent("click",this.pxlGuiDraws.hudIcons.helpIcon,"help"))}postHelpIntro(){!this.pxlDevice.mobile&&!this.pxlAutoCam.enabled?this.pxlCamera.jogServerMemory():(this.pxlCamera.colliderValid=!0,this.pxlCamera.eventCheckStatus=!0,this.pxlCamera.colliderShiftActive=!0,this.pxlCamera.nearestFloorObjName="mobile",this.pxlCamera.colliderCurObjHit="AudioTrigger_2",this.pxlCamera.proximityScaleTrigger=!0,this.exposureShiftActive=!0,this.pxlDevice.mobile||(this.pxlAudio.play(),setTimeout(()=>{this.pxlAudio.initPlay()},100))),this.postIntro=!0}start(){this.init()}step(){if(this.pxlTimer.step(),this.pxlAudio.step(),this.pxlQuality.step(),this.pxlDevice.step(),this.pxlAutoCam.step()&&this.pxlCamera.step(),this.pxlGuiDraws.step(),this.stepWarpPass(),this.pxlTimer.msRunner.x>this.checkContext&&this.activeContext){this.checkContext=this.pxlTimer.msRunner.x+1;let e=document.createElement("canvas"),t=!1;try{t=!!e.getContext("webgl")}catch(i){this.activeContext=!0,this.pxlGuiDraws.pxlNavCanvas.style.display="none"}t||console.warn("WebGL Context lost, reloading pxlNav")}this.emit("step",{time:this.pxlTimer.curMS,delta:this.pxlTimer.msRunner.y})}async stop(){this.setExposure(0),Object.keys(this.roomSubList).forEach(t=>{this.roomSubList[t].stop()})}loadRoomByName(e){if(Object.keys(this.roomSceneList).includes(e)){let i=this.roomSceneList[e];this.loadRoom(i)}else this.warn("Room '"+e+"' not found, cannot load.")}loadRoom(e){return new Promise(async(t,i)=>{let s=e.roomName;this.log("Loading Room - ",s);try{e.setDependencies(this),e.camera=this.pxlCamera.camera,e.scene=new SA,e.userAvatarGroup||(e.userAvatarGroup=new Zr),e.scene.add(e.userAvatarGroup);var r={format:Rn,antialias:!1,sortObjects:!0,alpha:!0,type:/(iPad|iPhone|iPod)/g.test(navigator.userAgent)?wA:BA};e.scene.renderTarget=new bA(this.pxlDevice.sW*this.pxlQuality.screenResPerc,this.pxlDevice.sH*this.pxlQuality.screenResPerc,r),e.scene.renderTarget.texture.format=Rn,e.scene.renderTarget.texture.minFilter=Wi,e.scene.renderTarget.texture.magFilter=Wi,e.scene.renderTarget.texture.generateMipmaps=!1,e.scene.renderTarget.depthBuffer=!0,e.scene.renderTarget.depthTexture=new yA(this.pxlDevice.sW*this.pxlQuality.screenResPerc,this.pxlDevice.sH*this.pxlQuality.screenResPerc),e.scene.renderTarget.depthTexture.format=EA,e.scene.renderTarget.depthTexture.type=IA,this.roomNameList.includes(s)||this.roomNameList.push(s),this.roomSceneList[s]=e,this.debug(this.roomSceneList[s]),t(!0)}catch(a){console.error("Error Loading Room - ",s),console.error("Error details:",a.message),this.pxlOptions.verbose>=te.ERROR&&console.error("Full error:",a),i(a)}})}startAllRooms(){this.roomNameList.forEach(e=>{this.startRoom(this.roomSceneList[e])})}startRoom(e){e.active=!1,e.startTime=this.pxlTimer.msRunner.x}newSubRoom(e){this.roomSubList[e.getName()]=e}addToRooms(e){let t={};return this.roomNameList.forEach(i=>{let s=e.clone();this.roomSceneList[i].scene.add(s),t[i]=s}),t}addToRoomLayers(e,t=1){let i={};return this.roomNameList.forEach(s=>{let r=e.clone();this.roomSceneList[s].scene.add(r),i[s]=r,r.layers.set(t)}),i}addToRoomParents(e,t){let i={};return this.parentNameList.includes(t)||this.parentNameList.push(t),this.roomNameList.forEach(s=>{let r=e.clone();if(this.parentGroupList[s]||(this.parentGroupList[s]={}),!this.parentGroupList[s][t]){let a=new Zr;this.parentGroupList[s][t]=a,this.roomSceneList[s].scene.add(a)}this.parentGroupList[s][t].add(r),i[s]=r}),i}buildRoomEnvironments(){this.debug("Building Room Environments - "),this.debug(this.roomNameList),this.roomNameList.forEach(e=>{this.roomSceneList[e].init&&this.roomSceneList[e].init(),this.roomSceneList[e].build&&this.roomSceneList[e].build()})}getArtistInfo(){return null}setFogHue(e=[0,0],t=[1,1]){let i=[t[0]-e[0],t[1]-e[1]],s=Math.abs(Math.atan2(i[0],i[1])*.3183098861837907),r=(i[0]**2+i[1]**2)**.5/Math.max(this.pxlDevice.sW,this.pxlDevice.sH);this.fog.color.setHSL(s,r*.5+.3,r*.5),this.roomSceneList[this.currentRoom]&&this.roomSceneList[this.currentRoom].setFog&&this.roomSceneList[this.currentRoom].setFog(this.fog.color)}readShader(e=""){if(e==="script_fog"){if(this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.pxlRendering.mapOverlayHeavyPass.enabled===!0)return this.pxlRendering.mapOverlayHeavyPass.material;if(this.pxlRendering.mapOverlayPass.enabled===!0)return this.pxlRendering.mapOverlayPass.material;if(this.pxlRendering.mapOverlaySlimPass.enabled===!0)return this.pxlRendering.mapOverlaySlimPass.material}else{if(e==="script_dArrows")return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.geoList.dArrows[0].material;if(e==="script_userScreens")return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.camScreenData.screenGeoList[0].material;if(e==="script_warpZonePortals")return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.returnPortalGlowList[0].material;if(e==="script_lizardking")return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.pxlRendering.lizardKingPass.material;if(e==="script_majorTom")return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.pxlUser.starFieldPass.material;if(e==="script_fractalSubstrate")return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.pxlUser.crystallinePass.material;if(e==="script_fractalEcho")return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.pxlRendering.delayPass.material;{let t=e.split("_");if(t.shift(),t=t.join("_"),this.geoList[t])return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.geoList[t].material}}}setShader(e,t,i){let s,r=this.pxlGuiDraws.guiWindows.shaderGui.currentShader;if(r==="script_fog")this.pxlRendering.mapOverlayHeavyPass.enabled===!0?s=this.pxlRendering.mapOverlayHeavyPass.material:this.pxlRendering.mapOverlayPass.enabled===!0?s=this.pxlRendering.mapOverlayPass.material:this.pxlRendering.mapOverlaySlimPass.enabled===!0&&(s=this.pxlRendering.mapOverlaySlimPass.material);else if(r==="script_dArrows"){this.geoList.dArrows.forEach(a=>{s=a.material,s.vertexShader=t,s.fragmentShader=i,s.needsUpdate=!0});return}else if(r==="script_userScreens"){this.camScreenData.screenGeoList.forEach(a=>{s=a.material,s.vertexShader=t,s.fragmentShader=i,s.needsUpdate=!0});return}else if(r==="script_warpZonePortals"){this.returnPortalGlowList.forEach(a=>{s=a.material,s.vertexShader=t,s.fragmentShader=i,s.needsUpdate=!0});return}else if(r==="script_lizardking")s=this.pxlRendering.lizardKingPass.material;else if(r==="script_majorTom")s=this.pxlUser.starFieldPass.material;else if(r==="script_fractalSubstrate")s=this.pxlUser.crystallinePass.material;else if(r==="script_fractalEcho")s=this.pxlRendering.delayPass.material;else{let a=r.split("_");a.shift(),a=a.join("_"),this.geoList[a]&&(s=this.geoList[a].material)}s&&(s.vertexShader=t,s.fragmentShader=i,s.needsUpdate=!0)}getAssetTexture(e,t=null,i=null){this.log("Get Internal Texture - ",e);let s=this.pxlUtils.assetRoot+e;if(!t){let o=e.split(".").pop().toLowerCase();o==="jpg"||o==="jpeg"?t=3:o==="png"&&(t=4)}return i||(i={encoding:RA,magFilter:Wi,minFilter:Wi}),this.pxlUtils.loadTexture(s,t,i)}buildBackgroundObject(e={},t=null,i=null){let s=new TA,r={};Object.assign(r,e),(t===null||typeof t!="string")&&(t=this.pxlShaders.scene.bgScreenVert()),(i===null||typeof i!="string")&&(i=this.pxlShaders.scene.bgScreenFrag());let a=this.pxlFile.pxlShaderBuilder(r,t,i);a.side=PA,a.depthTest=!0,a.depthWrite=!1;let o=new MA(s,a);return o.frustumCulled=!1,o}clickUserDetect(){let e=this.roomSceneList[this.currentRoom],t=this.pxlUtils.screenToNDC(this.pxlDevice.mouseX,this.pxlDevice.mouseY,this.pxlDevice.sW,this.pxlDevice.sH),i={};if(e!=null&&e.hasColliderType&&e.hasColliderType(T.CLICKABLE)){let s=e.getColliders(T.CLICKABLE);i=this.pxlColliders.castInteractRay(this.currentRoom,s,this.pxlCamera.camera,t)}if(i.hasOwnProperty("order")&&i.order.length>0){let s=i.order[0];this.clickableActions(s.name);return}if(i={},i=this.pxlColliders.castInteractRay(this.currentRoom,this.promoClickable,this.pxlCamera.camera,t),i.hasOwnProperty("order")&&i.order.length>0){let s=i.order[0];this.promoActions(s)}}clickableActions(e=null){e==="CallToAction"&&this.clickablePrevActiveObject&&(this.pxlGuiDraws.ctaBuildPopup(),this.objectClickableObjectList[this.clickablePrevActiveObject].Inactive.visible=!0,this.objectClickableObjectList[this.clickablePrevActiveObject].Hover.visible=!1,this.clickablePrevActiveObject=null)}promoActions(e=null){let t=e.userData.video;if(this.promoClickableLinks.hasOwnProperty(t)){var i=window.open(this.promoClickableLinks[t],"_blank");i.focus()}}hoverUserDetect(){let e=this.roomSceneList[this.currentRoom],t=this.pxlUtils.screenToNDC(this.pxlDevice.mouseX,this.pxlDevice.mouseY,this.pxlDevice.sW,this.pxlDevice.sH),i={};if(e!=null&&e.hasColliderType&&(e.hasColliderType(T.CLICKABLE)||e.hasColliderType(T.HOVERABLE))){let s=[...e.getColliders(T.CLICKABLE),...e.getColliders(T.HOVERABLE)];i=this.pxlColliders.castInteractRay(this.currentRoom,s,this.pxlCamera.camera,t)}if(i.hasOwnProperty("order")&&i.order.length>0){let s=i.order[0];this.pxlDevice.setCursor("help"),this.objectClickableObjectList[s.name]&&(this.clickablePrevActiveObject===null&&(this.clickablePrevActiveObject=s.name),this.objectClickableObjectList[s.name].Inactive.visible=!1,this.objectClickableObjectList[s.name].Hover.visible=!0);return}else this.clickablePrevActiveObject&&(this.objectClickableObjectList[this.clickablePrevActiveObject].Inactive.visible=!0,this.objectClickableObjectList[this.clickablePrevActiveObject].Hover.visible=!1,this.clickablePrevActiveObject=null),this.pxlDevice.setCursor("grab");if(i={},i=this.pxlColliders.castInteractRay(this.currentRoom,this.promoClickable,this.pxlCamera.camera,t),i.hasOwnProperty("order")&&i.order.length>0){let s=i.order[0];this.pxlDevice.setCursor("alias"),this.promoClickableObjectList[s.name]&&(this.promoPrevActiveObject===null&&(this.promoPrevActiveObject=s.name),this.promoClickableObjectList[s.name].x=1)}else this.promoPrevActiveObject&&(this.promoClickableObjectList[this.promoPrevActiveObject].x=.1,this.promoPrevActiveObject=null),this.pxlDevice.setCursor("grab")}sendRoomMessage(e,t,i){this.roomSceneList[e]&&this.roomSceneList[e].onMessage(t,i)}buildComposers(){this.pxlRendering.buildComposers(),this.mapOverlayHeavyPass=this.pxlRendering.mapOverlayHeavyPass,this.mapOverlayPass=this.pxlRendering.mapOverlayPass,this.mapOverlaySlimPass=this.pxlRendering.mapOverlaySlimPass,this.mapBoxAAPass=this.pxlRendering.mapBoxAAPass,this.mapCrossAAPass=this.pxlRendering.mapCrossAAPass,this.mapWorldPosMaterial=this.pxlRendering.mapWorldPosMaterial,this.mapGlowPass=this.pxlRendering.mapGlowPass,this.mapComposer=this.pxlRendering.mapComposer,this.mapComposerMotionBlur=this.pxlRendering.mapComposerMotionBlur,this.mapComposerGlow=this.pxlRendering.mapComposerGlow,this.chromaticAberrationPass=this.pxlRendering.chromaticAberrationPass,this.lizardKingPass=this.pxlRendering.lizardKingPass,this.mapComposerWarpPass=this.pxlRendering.mapComposerWarpPass,this.blurScreenMerge=this.pxlRendering.blurScreenMerge}setExposure(e){e=e*1,this.pxlCamera.uniformScalars.exposureUniformBase=e,this.pxlRendering.updateCompUniforms(e)}stepWarpPass(){if(this.warpVisualActive){let e=(this.pxlTimer.curMS-this.warpVisualStartTime)/this.warpVisualMaxTime[this.pxlCamera.warpType],t=Math.min(1,e*3),i=Math.min(1,3-e*3);t===1&&i===1&&this.pxlCamera.warpActive&&this.pxlCamera.warpCamRun(),this.warpVisualFader.x=t,this.warpVisualFader.y=i,i<=0&&this.stopWarpVisual()}}checkUserVideoStatus(e){}remoteUserUpdateMedia(e,t=!1,i=null){}userRemoveRemoteData(e){}stepAnimatedObjects(){this.pxlUser.itemListNames.length>0&&this.pxlUser.itemListNames.forEach(e=>{this.pxlUser.itemList[e].rotation.y=this.pxlTimer.msRunner.x*this.pxlUser.itemRotateRate})}initWarpVisual(e){this.warpVisualActive=!0,this.warpVisualFader.x=0,this.warpVisualFader.y=1,this.warpVisualStartTime=this.pxlTimer.curMS,this.mapComposerWarpPass&&(this.mapComposerWarpPass.enabled=!0)}stopWarpVisual(){this.warpVisualActive=!1,this.warpVisualFader.x=1,this.warpVisualFader.y=0,this.mapComposerWarpPass&&(this.mapComposerWarpPass.enabled=!!this.pxlUser.iZoom)}prepPortalRender(){}cleanupPortalRender(){}setPortalTexture(e,t){this.roomWarpVisuals[t].material.map=e}warpPortalQueue(){return Object.keys(this.roomSceneList).reverse()}getSceneSnapshot(e){let t=this.roomSceneList[e];this.pxlRendering.engine.setRenderTarget(t.warpZoneRenderTarget),t.prepPortalRender(),this.pxlRendering.engine.render(t.scene||t.scene,this.pxlCamera.camera),t.cleanupPortalRender(),this.pxlRendering.engine.setRenderTarget(null)}mapRender(e=!0){if(this.pxlTimer.active&&this.step(),this.pxlTimer.runtime>this.nextRenderMS||e===!1){this.prevRenderMS=this.nextRenderMS,this.nextRenderMS=this.pxlTimer.runtime+this.renderInterval,this.pxlRendering.stepShaderValues(),this.stepAnimatedObjects(),this.emit("render-prep",{time:this.pxlTimer.runtime});let t=this.roomSceneList[this.currentRoom];t&&t.booted&&(t.step(),t.camera.layers.disable(this.pxlEnums.RENDER_LAYER.SKY),this.pxlRendering.engine.setRenderTarget(t.scene.renderTarget),this.pxlRendering.engine.clear(),this.pxlRendering.engine.render(t.scene,t.camera),this.pxlRendering.engine.setRenderTarget(null),t.camera.layers.enable(this.pxlEnums.RENDER_LAYER.SKY),this.mapComposerGlow&&(this.pxlQuality.settings.bloom||this.pxlQuality.settings.fog)&&this.mapComposerGlow.render(),this.mapRenderBlurStack(t,t.camera,t.scene,this.scene.renderGlowTarget),this.pxlRendering.roomComposer.render()),this.pxlUser.iZoom&&this.delayComposer.render()}else if(this.pxlOptions.subFrameCalculations){let t=this.roomSceneList[this.currentRoom];t&&t.booted&&t.step()}this.emit("render-post",{time:this.pxlTimer.runtime}),this.pxlTimer.active&&e&&requestAnimationFrame(()=>{this.mapRender()})}mapRenderBlurStack(e,t,i,s){if(this.blurComposer){e.geoList.GlowPass&&(e.geoList.GlowPass.forEach(o=>{if(o.userData.hasOwnProperty("GlowPerc")){let n=o.userData.GlowPerc;o.material.hasOwnProperty("uniforms")&&o.material.uniforms.mult&&(o.material.uniforms.mult.value=n)}}),e.geoList.hasOwnProperty("GlowPassMask")&&e.geoList.GlowPassMask.forEach(o=>{o.material.uniforms&&o.material.uniforms.cdMult&&(o.material.uniforms.cdMult.value=0)})),t.layers.disable(this.pxlEnums.RENDER_LAYER.SCENE),t.layers.disable(this.pxlEnums.RENDER_LAYER.PARTICLES),t.layers.disable(this.pxlEnums.RENDER_LAYER.SKY),this.pxlRendering.engine.setRenderTarget(s);let r=0,a=i.background.clone();i.background.set(r),this.pxlRendering.engine.setClearColor(r,0),this.pxlRendering.engine.render(i,t),i.background.r=a.r,i.background.g=a.g,i.background.b=a.b,t.layers.enable(this.pxlEnums.RENDER_LAYER.SCENE),t.layers.enable(this.pxlEnums.RENDER_LAYER.PARTICLES),t.layers.enable(this.pxlEnums.RENDER_LAYER.SKY),this.pxlRendering.engine.setRenderTarget(null),e.geoList.GlowPass&&(e.geoList.GlowPass.forEach(o=>{o.userData.hasOwnProperty("GlowPerc")&&o.material.hasOwnProperty("uniforms")&&o.material.uniforms.mult&&(o.material.uniforms.mult.value=1)}),e.geoList.hasOwnProperty("GlowPassMask")&&e.geoList.GlowPassMask.forEach(o=>{o.material.uniforms&&o.material.uniforms.cdMult&&(o.material.uniforms.cdMult.value=1)})),this.blurComposer.render(),this.roomBloomPass.enabled=!1}}};var oe=class{static svgPromise(e,t,i=null,s=null){let r={},a=document.getElementById(t);if(!a)return;i!=null&&a.classList.add(i);let o=Promise.resolve(qe.getURLContent(e));return o.then(n=>{a.innerHTML=n,r.svg=a.getElementsByTagName("svg")[0],s!=null&&r.svg.classList.add(s)}),r.promise=o,r}static svgRawPromise(e){let t={};return Promise.resolve(qe.getURLContent(e)).then(s=>{let r=document.createElement("div");r.innerHTML=s,t.svg=r.getElementsByTagName("svg")[0]}),t}static svgIconPromise(e,t,i,s=null,r=null){let a=this,o={};o.hover=null,o.mute=null,o.caret=null,o.indicator=null,o.waiting=[],o.state=null,o.eventType=i;let n=document.getElementById(t);if(!n)return;r?n.classList.add(r):n.classList.add("iconStyle"),o.parent=n.parentNode,o.parent.classList.add("iconHover"),o.parent.addEventListener("click",u=>{a.iconEvent("click",o,i)});let h=Promise.resolve(qe.getURLContent(e));return h.then(u=>{if(n.innerHTML=u,o.svg=n.getElementsByTagName("svg")[0],o.svg){r?o.svg.classList.add(r):o.svg.classList.add("iconStyle");let c=o.svg.children,p=o.svg.getAttribute("xmlns"),d=o.svg.getAttribute("height"),g=o.svg.getAttribute("width");for(let A=0;A<c.length;++A){let f=c[A];if(t==="speakerIcon"){let v=n.getAttribute("xmlns"),x=document.createElementNS(v,"rect");x.setAttribute("x",-1),x.setAttribute("y",-1),x.setAttribute("fill","white"),x.setAttribute("fill-opacity",0),x.setAttribute("height",d+2),x.setAttribute("width",g+2),x.setAttribute("z-index",-1),n.appendChild(x),o.hover=x,o.svg.setAttribute("fill-opacity",this.toggleOpacity[0])}let C=f.getAttribute("id");if(C==="mute"){o.mute=f,o.mute.style.transformOrigin="50% 50%",o.mute.style.filter="alpha(opacity=0)",o.mute.style.opacity="0",o.mute.style.transform="scale(0,0)",o.mute.style.transition="scale 1s, opacity .5s, filter .5s";let v=document.createElement("style");v.type="text/css",v.innerHTML=`
                                @keyframes loadingSpinner{
                                    0%{
                                        transform: rotate(0deg);
                                    }
                                    100%{
                                        transform: rotate(360deg);
                                    }
                                }
                            `,o.svg.appendChild(v);let x=Math.max(2,Math.min(d,g)*.25),b=g*.5,I=d*.5,E=document.createElementNS(p,"path");E.setAttribute("d",` M ${b} ${I-x} A ${x} ${x} 0 1 1 ${b-x} ${I} `),E.setAttribute("stroke","white"),E.setAttribute("stroke-width","2"),E.style.display="none",E.style.transformOrigin="50% 50%",E.style.animation="loadingSpinner 1s linear infinite",E.style.animationDuration="2s",E.style.animationPlayState="paused",o.indicator=E,o.svg.appendChild(E),this.toggleIcon(o,s)}else C==="caret"?(o.caret=f,o.caret.style.transformOrigin="50% 50%",o.caret.style.transition="transform .5s",this.flipIcon(o,!1)):C==="state"?(f.style.display="none",o.state=f):o.waiting.push(f)}let m=document.createElementNS(p,"rect");m.classList.add("iconHover"),m.setAttribute("x",0),m.setAttribute("y",0),m.setAttribute("height",d),m.setAttribute("width",g),o.svg.appendChild(m)}}),o.promise=h,o}static svgButtonPromise(e,t,i=null,s=!1,r=null){if(typeof t=="string"&&(t=document.getElementById(t),!t))return;let a=this;Promise.resolve(qe.getURLContent(e)).then(n=>{t.innerHTML=n;let h=t.getElementsByTagName("svg");if(h.length>0&&(h=h[0],i&&(i=typeof i=="string"?[i]:i,i.forEach(u=>{h.classList.add(u)})),s)){let u=h.getAttribute("xmlns"),c=parseInt(h.getAttribute("height")),p=parseInt(h.getAttribute("width")),d=document.createElementNS(u,"rect");d.setAttribute("x",-1),d.setAttribute("y",-1),d.setAttribute("fill","white"),d.setAttribute("fill-opacity",0),d.setAttribute("height",c+2),d.setAttribute("width",p+2),d.setAttribute("z-index",-1),h.appendChild(d);let g=h.getElementById("state");g&&g.setAttribute("fill-opacity",this.toggleOpacity[0]),r&&(h.onclick=m=>{a.svgCheckClick(m,r)},a.pxlDevice.mobile?(h.ontouchstart=m=>{a.svgStylize(m,!0)},h.ontouchend=m=>{a.svgStylize(m,!1)}):(h.onmouseover=m=>{a.svgStylize(m,!0)},h.onmouseout=m=>{a.svgStylize(m,!1)}))}})}};var Yi=class{constructor(e,t="Metal-Asylum",i="./assets/",s="./assets/GUI/"){this.projectTitle=t,this.verbose=e,this.mobile=!1,this.pxlOptions=null,this.pxlFile=null,this.pxlCookie=null,this.pxlTimer=null,this.pxlAudio=null,this.pxlUtils=null,this.pxlUser=null,this.pxlDevice=null,this.pxlAutoCam=null,this.pxlCamera=null,this.pxlNavCanvas=null,this.pxlQuality=null,this.pxlEnv=null,this.assetRoot=i,this.guiRoot=s,this.introHelpActive=!0,this.branding={title:t,loader:s+".svg",logo:s+".svg",medalion:s+".svg",stack:s+".svg"},this.loaderPhrases=["Loading..."],this.lableBoxSize=40,this.optionWidthRound=10,this.optionWidthAdd=25,this.deviceOptionHeight=[0,300],this.pxlLoader=null,this.pxlLoaderCount=0,this.pxlLoaderTotal=8,this.hudBlock={obj:null,active:!1},this.userControlBlock=null,this.hudVisibility=!0,this.hudIcons={},this.hudElements={},this.guiWindows={},this.msgCount=0,this.hudMedalionBar=null,this.userProfileMessageInput=null,this.userProfileReturnMessage=null,this.userCountObj=null,this.userCountCur=0,this.messageCountObj=null,this.messageCountCur=0,this.chatMessageDisplay=null,this.chatMessageInput=null,this.camChoicesActive=!1,this.micChoicesActive=!1,this.pxlNavData={active:!1,gui:null,height:null,fpsSet:0,fps:null,dl:null,ul:null},this.djPlayerObj=null,this.buildGuiStatus={hud:!1,userTopBar:!1,bottomBar:!1,djPlayer:!1,roomControls:!1,verseList:!1,medalion:!1,loadingBranding:!1},this.settingsFields={changeUsername:!1},this.requestVerseList=!1,this.verseList=[],this.verseUserCounts={},this.verseTitlePrefix="",this.verseTitleSuffix="'s Room",this.multiverseData={fromVerse:null,toVerse:null,electedVerse:null,mitosisState:!1,mitosisBufferTime:15,mitosisTime:0,mitosisUpdateTime:0},this.textDescriptions={chatIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">C</span> )</span><br>chat',pos:[1,-1.5]},multiverseIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">U</span> )</span><br>multiverse<br>selection',pos:[0,-1.3]},djPlayerVolumeParent:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">B</span> )</span><br>music volume',pos:[0,-1.5]},speakerIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">N</span> )</span><br>mute people<br>pick audio output',pos:[0,-1.5]},micIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">M</span> )</span><br>mute/pick<br>mic input',pos:[0,-1.5]},camIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">V</span> )</span><br>enable/pick<br>video input',pos:[0,-1.5]},helpIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">?</span> )</span><br>help &<br>instructions',pos:[0,-1.5]},infoIconParent:{text:'Info <span class="helpHotKeyParent">( <span class="helpHotKey">I</span> )</span>',pos:[-1,0],offset:[-10,0]},settingsIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">G</span> )</span><br>graphics &<br>navigation',pos:[0,-1.5]},muteAllIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">N</span> )</span><br>mute all users',pos:[1,0]},fullScreenIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">F</span> )</span><br>toggle full screen',pos:[-1,0]},videoQualityIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">H</span> )</span><br>video quality settings',pos:[-1,0]},statsIcon:{text:"jitsi connection status; toggle connection ",pos:[1,0]},usersIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">T</span> )</span> user moderator tools',pos:[1,0]},ft2Button:{text:"Environment",pos:[-1,0],offset:[-10,0]},ft3Button:{text:"Invite Friends",pos:[-1,0],offset:[-10,0]},hud_userCount:{text:"# of People",pos:[-1,0],offset:[-10,0]}},this.loading=!0,this.disclaimer=!1,this.mapPrompt=null,this.mapPromptBG=null,this.delayLoadChatWindow=!1,this.renderSettings=null,this.controlSettings=null,this.shaderEditorDisplay=null,this.radioControls=[],this.controlState=[!0,!1,!1,!1],this.controlToggle=[!0,!0,!1,!1],this.buttonPadding=6,this.toggleOpacity=[.6,1],this.qualityText=["Netbook","Laptop","Desktop Computer","Gamer Rig"],this.activeItem=null,this.jmaWindowVis=!1,this.actionPopUp=null,this.ctaLocalDocURL={},this.ctaContentLoading=!1,this.googleDocHTML=null,this.googleDocURL=""}setDependencies(e){this.pxlOptions=e.pxlOptions,this.pxlFile=e.pxlFile,this.pxlCookie=e.pxlCookie,this.pxlTimer=e.pxlTimer,this.pxlAudio=e.pxlAudio,this.pxlUtils=e.pxlUtils,this.pxlUser=e.pxlUser,this.pxlDevice=e.pxlDevice,this.pxlAutoCam=e.pxlAutoCam,this.pxlCamera=e.pxlCamera,this.pxlNavCanvas=e.pxlNavCanvas,this.pxlQuality=e.pxlQuality,this.pxlEnv=e.pxlEnv,this.mobile=e.mobile,this.renderSettings=this.pxlCookie.readCookie(this.pxlUser.renderSettingsCookie),this.controlSettings=this.pxlCookie.readCookie(this.pxlUser.controlModeCookie),e.pxlDevice.subscribe("resize",this.resize.bind(this)),this.createContainer(),this.createFailState(),this.buildConsole()}init(){this.cssBuildClasses()}createContainer(){let e;this.pxlOptions.hasOwnProperty("container")&&this.pxlOptions.container instanceof HTMLElement?e=this.pxlOptions.container:(e=document.createElement("div"),e.id="pxlNav-container",e.classList.add("pxlNav-mainContainerStyle"),document.body.appendChild(e)),this.guiWindows.container={active:!0,gui:e}}addToContainer(e){this.guiWindows.container||this.createContainer(),this.guiWindows.container.gui.appendChild(e)}createFailState(){var t,i;let e=document.createElement("div");e.id="pxlNav-failState",e.classList.add("pxlNav-failStateStyle"),(i=(t=this.guiWindows)==null?void 0:t.container)!=null&&i.gui?this.guiWindows.container.gui.appendChild(e):document.body.appendChild(e),this.guiWindows.failState={active:!0,gui:e}}addToFailState(e){this.guiWindows.failState||this.createFailState(),this.guiWindows.failState.gui.appendChild(e)}prepLoader(){this.mapPromptBG=document.createElement("div"),this.mapPromptBG.classList.add("mapPromptBackgroundStyle"),this.addToContainer(this.mapPromptBG),this.mapPrompt=document.createElement("div"),this.mapPrompt.setAttribute("id","mapPrompt"),this.mapPrompt.classList.add("mapPromptStyle"),this.mapPrompt.classList.add("fader"),this.mapPrompt.classList.add("visOn"),this.mapPrompt.innerHTML=`
            <div id="loaderLogoBranding" class='pxlLoaderLogo'></div>
            <div class='loadStyleParent'>
              <div id='pxlLoader' class='loadStyle'></div>
              <div id='pxlLoaderBackground' class='loadStyleBackground'></div>
            </div>
            <div id="loaderBranding" class='pxlLoaderTitle'>${this.projectTitle}</div>
            <div id="loaderMessage" class='pxlLoaderMessage'></div>
          `,this.addToContainer(this.mapPrompt);let e=document.getElementById("loaderMessage");if(e){let a=this.loaderPhrases[Math.floor(Math.random()*this.loaderPhrases.length)];e.innerHTML=a}this.buildGuiStatus.loadingBranding&&oe.svgPromise(this.branding.loader,"loaderBranding","pxlLoaderTitle","loadBrandingLogo"),this.pxlLoader=document.getElementById("pxlLoader"),this.pxlLoader.style.width="2%";let t=document.createElement("div");t.classList.add("pxlNav-crashPromptBackgroundStyle"),this.addToFailState(t);let i=document.createElement("div");i.classList.add("pxlNav-canvasCrashPromptStyle"),t.appendChild(i);let s;this.pxlQuality&&(parseInt(this.pxlQuality.detailLimit)===0?s=`Looks like your computer is having a hard time, but we\u2019ve got your fix.
          <br>Please click <a id="pxlNav-crashLink" class="pxlNav-crashLink">HERE</a> to reload ${this.projectTitle}.`:s=`Looks like your computer is still having trouble, but we\u2019ve got another fix for ya.
          <br>Please click <a id="pxlNav-crashLink" class="pxlNav-crashLink">HERE</a> to reload ${this.projectTitle} again.`),i.innerHTML=s;let r=document.getElementById("pxlNav-crashLink");r&&(r.onclick=this.crashLinkTrigger.bind(this))}stepLoader(e=""){this.pxlLoaderCount+=1;let t=Math.min(100,this.pxlLoaderCount/(this.pxlLoaderTotal-1)*100);t===100&&(this.pxlLoader.style.borderRadius="5px"),this.pxlLoader.style.width=t+"%",this.verbose>=te.INFO&&console.log("Loader",this.pxlLoaderCount,this.pxlLoader.style.width,"; "+e)}setLoaderPhrases(e,t=!0){e&&e.length>0&&(t&&(this.loaderPhrases=[]),this.loaderPhrases=this.loaderPhrases.concat(e),this.setLoaderObjMessage())}setLoaderObjMessage(){let e=document.getElementById("loaderMessage");if(e){let t=Math.floor(Math.random()*17391.537193*this.loaderPhrases.length%this.loaderPhrases.length),i=this.loaderPhrases[t];e.innerHTML=i}}booted(){this.buildHudBlock(),this.buildTopBar(),this.buildBottomBar(),this.buildGuiWindowContainer(),this.buildUserControlBlock(),this.buildRawHtml(),this.prepPageDisplay()}step(){var e;this.updateGuiPositions(),(e=this.pxlUser)!=null&&e.checkItemWearOff(this.pxlTimer.prevMS)&&this.hideItemHud(),this.pxlNavDataUpdate()}resize(){this.resetHelpTextPlacement(),["videoinput","audioinput","audiooutput"].forEach(t=>{let i=null,s=null;t==="videoinput"?(i="camChoiceOptionsBlock",s=this.hudIcons.camChoiceIcon):t==="audioinput"?(i="micChoiceOptionsBlock",s=this.hudIcons.micChoiceIcon):t==="audiooutput"&&(i="speakerChoiceOptionsBlock",s=this.hudIcons.speakerChoiceIcon);let r=document.getElementById(i);if(r&&s){let a=r.getBoundingClientRect().width,o=s.parent.getBoundingClientRect();r.style.left=o.x-a*.5,r.style.bottom=this.sH-this.hudBottomBar.getBoundingClientRect().y}}),this.setUserControlPosition(),this.inviteUserPosition(),this.setArtistInfoSizing()}resetHelpTextPlacement(){Object.keys(this.textDescriptions).forEach(e=>{let t=this.textDescriptions[e];if(t){let i=document.getElementById("helpText_"+e);if(!i)return;let s=document.getElementById(e);if(s){let r=2,a=t.pos,o=t.offset?t.offset:[0,0],n=s.getBoundingClientRect(),h=i.getBoundingClientRect(),u=0,c=0,p=!1;a[1]<0?(c=n.y+h.height*a[1],p=!0):a[1]===0?c=n.y+n.height*.5-h.height*.5:a[1]>0&&(c=n.y+n.height+h.height*(a[1]-1),p=!0),p?a[0]<0?u=n.x+n.width+h.width*a[0]:a[0]===0?u=n.x+n.width*.5-h.width*.5:a[0]>0&&(u=n.x+n.width*(a[0]-1)):a[0]<0?u=n.x+h.width*a[0]:a[0]===0?u=n.x+n.width*.5-h.width*.5:a[0]>0&&(u=n.x+n.width*2*a[0]),u=u+o[0],u+h.width>this.sW-r?u=this.sW-r-h.width:u<r&&(u=r),c=c+o[1],i.style.left=u,i.style.top=c}else i.style.display="none"}})}refreshPage(){window.location.reload()}crashLinkTrigger(e){let t=window.location.search.match(/[a-zA-Z0-9=]+/g);if(t){let i="?";t.forEach(s=>{let r=s.split("=");r[0]==="dlimit"?i+=r[0]+"="+(parseInt(r[1])+1)+"&":i+=s+"&"}),window.location.search=i}else window.location.search="?dlimit=1"}guiToggleVisibility(e=null){if(e=e===null?!this.hudVisibility:e,this.hudVisibility=e,this.hudTopBar&&!this.hudTopBar.origDisplay&&(this.hudTopBar.origDisplay=this.hudTopBar.style.display),this.fastTravelBar&&!this.fastTravelBar.origDisplay&&(this.fastTravelBar.origDisplay=this.fastTravelBar.style.display),this.hudBottomBar&&!this.hudBottomBar.origDisplay&&(this.hudBottomBar.origDisplay=this.hudBottomBar.style.display),e){if(this.hudTopBar&&this.hudTopBar.removeAttribute("style"),this.fastTravelBar&&this.fastTravelBar.removeAttribute("style"),this.hudBottomBar&&this.hudBottomBar.removeAttribute("style"),this.userControlBlock){let t=this.userControlBlock.gui.style.top;this.userControlBlock.gui.removeAttribute("style"),this.userControlBlock.gui.style.top=t}}else this.hudTopBar&&(this.hudTopBar.style.display="none"),this.fastTravelBar&&(this.fastTravelBar.style.display="none"),this.hudBottomBar&&(this.hudBottomBar.style.display="none"),this.userControlBlock&&(this.userControlBlock.gui.style.display="none");this.hudElements.artistInfo&&(this.hudElements.artistInfo.parent.style.display=e?"grid":"none")}cssBuildClasses(){let e=document.createElement("style");e.type="text/css",e.innerHTML=`
			.fader{
				transition: opacity .8s, filter .8s;
			}
			.visOn{
				filter:alpha(opacity=100);
				opacity:1.0;
			}
			.visOff{
				filter:alpha(opacity=0);
				opacity:0.0;
			}
		`,document.getElementsByTagName("head")[0].appendChild(e)}prepPromptFader(e,t=!1){let i=e;typeof i=="string"&&(i=document.getElementById(i)),i&&(i.classList.add("fader"),i.classList.add(t?"visOn":"visOff"),i.style.display=t?"inline-block":"none")}promptFader(e,t,i=null,s=!1){var r;typeof e=="string"&&(e=document.getElementById(e)),e&&(e.hasOwnProperty("gui")&&(e=e.gui),((r=e.classList)==null?void 0:r.value.indexOf("fader"))<0&&e.classList.add("fader"),t?(e.style.display="inline-block",setTimeout(()=>{e.classList.contains("visOff")&&(e.classList.remove("visOff"),e.classList.add("visOn"),i!==null&&e.setAttribute("fadeOut",i*1e3))},50)):(e.classList.remove("visOn"),e.classList.add("visOff"),s?["webkitTransitionEnd","otransitionend","oTransitionEnd","msTransitionEnd","transitionend"].forEach(o=>{e.addEventListener(o,()=>{let n=e.parentNode;n&&n.removeChild(e)})}):setTimeout(()=>{e.classList.contains("visOff")&&(e.style.display="none")},1e3)))}buildConsole(){let e=document.createElement("div");e.id="consoleBlock",e.classList.add("consoleBlockStyle"),this.addToContainer(e),this.guiWindows.consoleBlock={active:!1,gui:e}}buildMessageBlock(e,t="Info"){let i=document.createElement("div");this.msgCount++,i.id="messageBlock-"+this.msgCount,i.classList.add("messageBlockStyle"),i.classList.add("message"+t);let s=this,r=document.createElement("div");r.classList.add("messageCloseBtn"),r.innerHTML="X",r.addEventListener("click",function(){s.removeMessage(i)});let a=document.createElement("div");a.classList.add("messageTopBarStyle");let o=document.createElement("div");o.classList.add("messageHeaderStyle"),o.innerHTML=t,a.appendChild(o),a.appendChild(r),i.appendChild(a);let n=document.createElement("div");return n.classList.add("messageContentStyle"),n.innerHTML=e,i.appendChild(n),i}print(e){this.guiWindows.consoleBlock||this.buildConsole(),this.guiWindows.consoleBlock.active||(this.guiWindows.consoleBlock.active=!0,this.promptFader(this.guiWindows.consoleBlock.gui,!0));let t=this.guiWindows.consoleBlock.gui,i=this.buildMessageBlock(e);t.appendChild(i)}buildHudBlock(){if(!this.buildGuiStatus.hud)return;let e=document.createElement("div");e.id="hudBlock",e.classList.add("hudBlockStyle"),this.hudBlock.obj=e,this.addToContainer(this.hudBlock.obj),this.hudBlock.obj.style.display="none";let t=this;this.hudBlock.obj.addEventListener("click",i=>{t.toggleHudBlock(!1,!0)})}toggleHudBlock(e=null,t=!1){if(!this.hudBlock)return;e=e===null?!this.hudBlock.active:e,this.hudBlock.active=e;let i=!1;e?i="inline-block":this.checkOpenWindows(t)||(i="none",this.pxlNavCanvas&&this.pxlNavCanvas.focus()),this.hudBlock.obj&&this.hudBlock.obj.style&&i!==!1&&(this.hudBlock.obj.style.display=i)}checkOpenWindows(e=!1){let t=Object.keys(this.guiWindows),i=!1;return t.forEach(s=>{["container","failState","chatBoxGui"].includes(s)||(e&&(this.guiWindows[s].button&&this.flipIcon(this.guiWindows[s].button,!1),this.guiWindows[s].gui&&this.guiWindows[s].active&&(this.guiWindows[s].active=!1,this.promptFader(this.guiWindows[s].gui,!1),s==="settingsGui"&&this.togglePxlNavDataDisplay(!1))),i=i||this.guiWindows[s].active)}),i}checkFocus(e=null,t=null){t===!0&&this.guiWindows.inviteUserGui&&this.guiWindows.inviteUserGui.active&&this.toggleInviteUser(!1)}buildRawHtml(){}buildTopBar(){if(this.mobile||!this.buildGuiStatus.userTopBar)return;let e=document.createElement("div");e.id="hud_topBar",e.classList.add("hud_topBarBlockStyle"),this.hudTopBar=e,this.addToContainer(this.hudTopBar);let t="";t='<div id="statsIcon"></div>',t+=`</div>
		<div id="usersIconParent">
			<div id="usersIcon"></div>`;let i;i=`
			<div id="hud_localVideoStyle" class="hud_localVideoStyle"></div>
			<div id="hud_topBarParent" class="hud_topBarParentStyle">
		<div id="statsIconParent">
			${t}
		</div>
		<div  class="hud_topBarVSpacerStyle"></div>
			</div>
		`,e.innerHTML=i,this.hudIcons.statsIcon=oe.svgIconPromise(`${this.guiRoot}icons/icon_stats.svg`,"statsIcon","stats"),this.hudIcons.statsIcon.promise.finally(()=>{}),this.hudIcons.usersIcon=oe.svgIconPromise(`${this.guiRoot}icons/icon_user.svg`,"usersIcon","users");let s=document.createElement("div");s.id="hud_pxlNavData",s.classList.add("hud_pxlNavDataParentStyle"),e.appendChild(s),this.pxlNavData.gui=s;let r=document.createElement("div");r.id="hud_pxlNavData",r.classList.add("hud_pxlNavDataStyle"),s.appendChild(r),i=`
      <div class="hud_pxlNavData_FPS gui_boldText">FPS</div><div class="hud_pxlNavData_FPS">:</div><div id="hud_pxlFPS" class="hud_pxlNavData_FPS"> - </div>
      <div class="hud_pxlNavData_UL gui_boldText">\u2191</div><div class="hud_pxlNavData_UL">:</div><div id="hud_pxlUL" class="hud_pxlNavData_UL"> - </div>
      <div class="hud_pxlNavData_DL gui_boldText">\u2193</div><div class="hud_pxlNavData_DL">:</div><div id="hud_pxlDL" class="hud_pxlNavData_DL"> - </div>
    `,r.innerHTML=i,this.pxlNavData.fps=document.getElementById("hud_pxlFPS"),this.pxlNavData.ul=document.getElementById("hud_pxlUL"),this.pxlNavData.dl=document.getElementById("hud_pxlDL")}buildUserControlBlock(){this.userControlBlock={},this.userControlBlock.activeList=[],this.userControlBlock.userList={},this.userControlBlock.mutedList=[];let e=document.createElement("div");e.classList.add("userControlBlockStyle"),this.addToContainer(e),this.userControlBlock.gui=e,this.userControlBlock.speakerIcon=null}buildMedalionBar(){if(this.buildGuiStatus.medalion){let e=document.createElement("div");e.id="hud_medalionBar",e.classList.add("hud_medalionIconBlockStyle"),this.hudMedalionBar=e,this.addToContainer(this.hudMedalionBar);let t=`
        <div id="medalionIconParent" class="hud_speakerIconStyle">
          <div id="medalionIcon"></div>
        </div>
        <div id="medalionTitle" class="medalionTitleStyle">${this.branding.title}</div>
      `;this.hudMedalionBar.innerHTML=t;let i=document.getElementById("medalionIcon"),s=document.getElementById("medalionTitle");i.addEventListener("mouseover",()=>{s.classList.add("medalionTitleGrowStyle")}),i.addEventListener("mouseout",()=>{s.classList.remove("medalionTitleGrowStyle")}),this.hudIcons.medalionIcon=oe.svgIconPromise(this.branding.medalion,"medalionIcon","info",null,"medalionStyle")}}buildBottomBar(){if(!this.buildGuiStatus.bottomBar)return;let e=document.createElement("div");e.id="hud_bottomBar",e.classList.add("hud_bottomBarStyle"),this.hudBottomBar=e,this.addToContainer(this.hudBottomBar);let t="";if(t+=`
    <div id="hud_chatIconBlock" class="hud_bottomLeftBlockStyle">
        <div id="settingsIconParent" class="hud_settingsIconStyle">
          <object id="settingsIcon"></object>
        </div>
  <div></div>
        <div id="helpIconParent" class="hud_helpIconStyle">
          <object id="helpIcon"></object>
        </div>
        `,!this.mobile&&this.buildGuiStatus.verseList&&(t+=`<div class="hud_usersIconStyle">
            <div id="multiverseIcon"></div>
          </div>
          <div></div>`),t+="</div>",this.mobile||(t+=`
        <div class="hud_micCamIconsBlockStyle">
          <div id="speakerIconParent" class="hud_speakerIconStyle">
            <div id="speakerIcon"></div>
          </div>
          <div id="speakerChoiceIconParent" class="hud_speakerChoiceIconStyle">
            <div id="speakerChoiceOptionsBlock" class="gui_iconButtonPopup">
            </div>
            <div id="speakerChoiceIconParent">
              <div id="speakerChoiceIcon" class="iconCaretStyle"></div>
            </div>
          </div>
          <div class="hud_micCamSpacerStyle"></div>
          <div id="micIconParent" class="hud_micIconStyle">
            <div id="micIcon"></div>
          </div>
          <div id="micChoiceIconParent" class="hud_micChoiceIconStyle">
            <div id="micChoiceOptionsBlock" class="gui_iconButtonPopup">
            </div>
            <div id="camChoiceIconParent">
              <div id="micChoiceIcon" class="iconCaretStyle"></div>
            </div>
          </div>
          <div class="hud_micCamSpacerStyle"></div>
          <div id="camIconParent" class="hud_camIconStyle">
            <div id="camIcon"></div>
          </div>
          <div id="camChoiceIconBlock" class="hud_camChoiceIconStyle">
            <div id="camChoiceOptionsBlock" class="gui_iconButtonPopup">
            </div>
            <div id="camChoiceIconParent">
              <div id="camChoiceIcon" class="iconCaretStyle"></div>
            </div>
          </div>
        </div>

        <div id="hud_helpInfoSettingsBlock" class="hud_helpInfoSettingsBlockStyle">
          <div class="guiVerseHudTitle">
            <span id="guiVerseTitle"></span>
          </div>
          <div></div>
          <div id="chatIconParent" class="hud_chatIconStyle">
            <div id="chatIcon"></div>
          </div>
          <div id="hud_messageCount" class="hud_userCountStyle hud_messageCountBaseStyle">0</div>
        </div>
      `),this.hudBottomBar.innerHTML=t,this.messageCountObj=document.getElementById("hud_messageCount"),this.hudIcons.chatIcon=oe.svgIconPromise(`${this.guiRoot}icons/icon_chat.svg`,"chatIcon","chat"),!this.mobile&&!this.pxlAutoCam.enabled)this.hudIcons.multiverseIcon=oe.svgIconPromise(`${this.guiRoot}icons/icon_multiverse.svg`,"multiverseIcon","multiverse"),this.hudIcons.speakerIcon=oe.svgIconPromise(`${this.guiRoot}icons/icon_ProxAudio.svg`,"speakerIcon","speakerToggle",!1),this.hudIcons.speakerChoiceIcon=oe.svgIconPromise(`${this.guiRoot}icons/icon_downcaret.svg`,"speakerChoiceIcon","speakerChoice",!1,"iconCaretStyle"),this.hudIcons.micIcon=oe.svgIconPromise(`${this.guiRoot}icons/icon_mic.svg`,"micIcon","micToggle",!1),this.hudIcons.micChoiceIcon=oe.svgIconPromise(`${this.guiRoot}icons/icon_downcaret.svg`,"micChoiceIcon","micChoice",!1,"iconCaretStyle"),this.hudIcons.camIcon=oe.svgIconPromise(`${this.guiRoot}icons/icon_camera.svg`,"camIcon","camToggle",!1),this.hudIcons.camChoiceIcon=oe.svgIconPromise(`${this.guiRoot}icons/icon_downcaret.svg`,"camChoiceIcon","camChoice",!1,"iconCaretStyle"),this.hudIcons.helpIcon=oe.svgIconPromise(`${this.guiRoot}icons/icon_help.svg`,"helpIcon","help"),this.hudIcons.settingsIcon=oe.svgIconPromise(`${this.guiRoot}icons/icon_settings.svg`,"settingsIcon","settings");else{let i=document.getElementById("hud_chatIconBlock");i.style.gridAutoColumns="max-content max-content auto max-content",i.style.margin="0px 10px"}}prepArtistInfo(e=null){var t;if(!(!((t=this.pxlEnv)!=null&&t.postIntro)||e==="")){if(!this.hudElements.artistInfo){this.hudElements.artistInfo={},this.hudElements.artistInfo.active=!1;let i=document.createElement("div");i.classList.add("hud_aristInfoParentStyle"),this.hudElements.artistInfo.parent=i;let s=document.createElement("div");s.classList.add("hud_aristInfoButtonStyle"),i.appendChild(s);let r=this;s.onclick=()=>{r.toggleArtistInfo()},this.hudElements.artistInfo.button=s;let a=document.createElement("div");a.classList.add("hud_aristInfoButtonTextStyle"),a.innerHTML="artwork info&nbsp;&nbsp;",s.appendChild(a),this.hudElements.artistInfo.buttonText=a;let o=document.createElement("div");o.classList.add("hud_aristInfoCarrotXStyle"),o.id="artistInfoCarrotX",s.appendChild(o);let n=document.createElement("div");n.classList.add("hud_aristInfoInner"),n.innerHTML=e,i.appendChild(n),this.hudElements.artistInfo.inner=n,this.addToContainer(i),this.hudElements.artistInfo.closeSvg=oe.svgPromise(`${this.guiRoot}global/carrotClose_animated.svg`,"artistInfoCarrotX"),this.hudElements.artistInfo.closeSvg.promise.finally(()=>{this.artistInfoButtonPrep()})}this.toggleArtistInfo(!1),e!==null&&this.hudVisibility&&!this.pxlAutoCam.active?(this.hudElements.artistInfo.parent.style.zIndex=155,this.hudElements.artistInfo.parent.style.display="grid",this.hudElements.artistInfo.inner.innerHTML=e,setTimeout(()=>{this.setArtistInfoSizing()},20)):(this.hudElements.artistInfo.parent.style.zIndex=-5,this.hudElements.artistInfo.parent.style.display="none")}}artistInfoButtonPrep(e=0){let t=this.hudElements.artistInfo.closeSvg.svg;if(t){let i=t.getElementById("carrotToClone_on"),s=t.getElementById("carrotToClone_off");i&&s?(this.hudElements.artistInfo.onAnim=i,this.hudElements.artistInfo.offAnim=s):e===2||setTimeout(()=>{this.artistInfoButtonPrep(e+=1)},100)}}setArtistInfoSizing(){if(this.hudElements.artistInfo){let e=this.hudElements.artistInfo.inner.clientHeight,t=this.hudElements.artistInfo.inner.clientWidth,i=this.hudElements.artistInfo.button.clientHeight,s=this.hudElements.artistInfo.button.clientWidth;this.hudElements.artistInfo.innerHeight=e,this.hudElements.artistInfo.innerWidth=t,this.hudElements.artistInfo.baseHeight=i,this.hudElements.artistInfo.baseWidth=s,this.hudElements.artistInfo.parent.style.height=e+"px",this.hudElements.artistInfo.parent.style.width=t+"px";let r=this.hudElements.artistInfo.buttonText.clientWidth;this.hudElements.artistInfo.buttonText.maxWidth=r,this.hudElements.artistInfo.buttonText.style.maxWidth=r+"px",this.toggleArtistInfo(this.hudElements.artistInfo.active)}}toggleArtistInfo(e=null){e=e===null?!this.hudElements.artistInfo.active:e,this.hudElements.artistInfo.active=e;let t=this.hudElements.artistInfo.innerHeight,i=Math.min(this.pxlDevice.sW*.3,this.hudElements.artistInfo.innerWidth),s=this.hudElements.artistInfo.baseHeight,r=this.hudElements.artistInfo.baseWidth;this.hudElements.artistInfo.parent.style.maxHeight=e?t+"px":s+"px",this.hudElements.artistInfo.parent.style.maxWidth=e?i+"px":r+"px",this.hudElements.artistInfo.parent.style.padding=e?"5px":"0px";let a=this.hudElements.artistInfo.buttonText.maxWidth;this.hudElements.artistInfo.buttonText.style.maxWidth=e?"0px":a+"px",this.hudElements.artistInfo.buttonText.style.opacity=e?"0":"1",this.hudElements.artistInfo.buttonText.style.filter="alpha(opacity="+(e?"0":"1000")+")",this.hudElements.artistInfo.inner.style.opacity=e?"1":"0",this.hudElements.artistInfo.inner.style.filter="alpha(opacity="+(e?"100":"0")+")",this.hudElements.artistInfo.onAnim&&(e?this.hudElements.artistInfo.onAnim.beginElement():this.hudElements.artistInfo.offAnim.beginElement())}prepPageDisplay(e=null){var t;if(!(!((t=this.pxlEnv)!=null&&t.postIntro)||e==="")){if(!this.hudElements.artistInfo){this.hudElements.artistInfo={},this.hudElements.artistInfo.active=!1;let i=document.createElement("div");i.classList.add("hud_aristInfoParentStyle"),this.hudElements.artistInfo.parent=i;let s=document.createElement("div");s.classList.add("hud_aristInfoButtonStyle"),i.appendChild(s);let r=this;s.onclick=()=>{r.togglePageDisplay()},this.hudElements.artistInfo.button=s;let a=document.createElement("div");a.classList.add("hud_aristInfoButtonTextStyle"),a.innerHTML="artwork info&nbsp;&nbsp;",s.appendChild(a),this.hudElements.artistInfo.buttonText=a;let o=document.createElement("div");o.classList.add("hud_aristInfoCarrotXStyle"),o.id="artistInfoCarrotX",s.appendChild(o);let n=document.createElement("div");n.classList.add("hud_aristInfoInner"),n.innerHTML=e,i.appendChild(n),this.hudElements.artistInfo.inner=n,this.addToContainer(i)}this.togglePageDisplay(!1),e!==null&&this.hudVisibility&&!this.pxlAutoCam.active?(this.hudElements.artistInfo.parent.style.zIndex=155,this.hudElements.artistInfo.parent.style.display="grid",this.hudElements.artistInfo.inner.innerHTML=e,setTimeout(()=>{this.setArtistInfoSizing()},20)):(this.hudElements.artistInfo.parent.style.zIndex=-5,this.hudElements.artistInfo.parent.style.display="none")}}setPageToDisplay(){if(this.hudElements.artistInfo){let e=this.hudElements.artistInfo.inner.clientHeight,t=this.hudElements.artistInfo.inner.clientWidth,i=this.hudElements.artistInfo.button.clientHeight,s=this.hudElements.artistInfo.button.clientWidth;this.hudElements.artistInfo.innerHeight=e,this.hudElements.artistInfo.innerWidth=t,this.hudElements.artistInfo.baseHeight=i,this.hudElements.artistInfo.baseWidth=s,this.hudElements.artistInfo.parent.style.height=e+"px",this.hudElements.artistInfo.parent.style.width=t+"px";let r=this.hudElements.artistInfo.buttonText.clientWidth;this.hudElements.artistInfo.buttonText.maxWidth=r,this.hudElements.artistInfo.buttonText.style.maxWidth=r+"px",this.toggleArtistInfo(this.hudElements.artistInfo.active)}}togglePageDisplay(e=null){var t;if(this.hudElements.artistInfo){e=e===null?!this.hudElements.artistInfo.active:e,(t=this.hudElements)!=null&&t.artistInfo&&(this.hudElements.artistInfo.active=e);let i=this.hudElements.artistInfo.innerHeight,s=Math.min(this.pxlDevice.sW*.3,this.hudElements.artistInfo.innerWidth),r=this.hudElements.artistInfo.baseHeight,a=this.hudElements.artistInfo.baseWidth;this.hudElements.artistInfo.parent.style.maxHeight=e?i+"px":r+"px",this.hudElements.artistInfo.parent.style.maxWidth=e?s+"px":a+"px",this.hudElements.artistInfo.parent.style.padding=e?"5px":"0px";let o=this.hudElements.artistInfo.buttonText.maxWidth;this.hudElements.artistInfo.buttonText.style.maxWidth=e?"0px":o+"px",this.hudElements.artistInfo.buttonText.style.opacity=e?"0":"1",this.hudElements.artistInfo.buttonText.style.filter="alpha(opacity="+(e?"0":"1000")+")",this.hudElements.artistInfo.inner.style.opacity=e?"1":"0",this.hudElements.artistInfo.inner.style.filter="alpha(opacity="+(e?"100":"0")+")",this.hudElements.artistInfo.onAnim&&(e?this.hudElements.artistInfo.onAnim.beginElement():this.hudElements.artistInfo.offAnim.beginElement())}}iconEvent(e,t,i=null){if(this.hudBlock.obj&&(this.hudBlock.obj.style.display="none"),e==="click")switch(i){case"chat":this.toggleChatBox();break;case"musicToggle":this.pxlAudio.djPlayerMuteToggle(),this.toggleIcon(t,!this.pxlAudio.djMuted,!0);break;case"userSpeakerToggle":this.setUserControls(t);break;case"speakerToggle":this.toggleIcon(t,!1,!0);break;case"speakerChoice":let s="audiooutput";this.flipIcon(t,this.guiWindows[s]&&this.guiWindows[s].active);break;case"help":let r=this.guiWindows.helpGui?this.guiWindows.helpGui.active:!1;this.checkOpenWindows(!0),this.helpGuiToggle(!r);break;case"info":let a=this.guiWindows.infoGui?this.guiWindows.infoGui.active:!1;this.checkOpenWindows(!0),this.infoGuiToggle(!a);break;case"settings":let o=this.guiWindows.settingsGui?this.guiWindows.settingsGui.active:!1;this.checkOpenWindows(!0),this.settingsGuiToggle(!o);break;case"userProfile":this.toggleUserProfile();break;case"users":break;case"stats":default:break}}setMicVolumeLevel(e){this.hudIcons.micIcon.volumeMask||(this.hudIcons.micIcon.volumeMask=document.getElementById("gui_micVolumeMask"),this.hudIcons.micIcon.timer=this.pxlTimer.msRunner.x-1);let t=12-e*11;this.hudIcons.micIcon.volumeMask.setAttribute("y",t)}toggleIcon(e,t,i=!1){if(e){if(e.mute.style.filter=t?"alpha(opacity=0)":"alpha(opacity=100)",e.mute.style.opacity=t?"0":"1",e.mute.style.transform=t?"scale(0,0)":"scale(1,1)",["camToggle","speakerToggle"].includes(e.eventType))return;let r={speakerToggle:"speaker",micToggle:"audio",camToggle:"video"}[e.eventType];r&&i&&this.loadingDeviceChange(r,t)}}flipIcon(e,t){e.caret.style.transform=`rotate( ${t?"180deg":"0deg"} )`}loadingDeviceChange(e,t=!0){let i=null;e==="speaker"?i=this.hudIcons.speakerIcon:e==="audio"?i=this.hudIcons.micIcon:e==="video"&&(i=this.hudIcons.camIcon),i.indicator.style.display=t?"inline-block":"none",i.indicator.style.animationPlayState=t?"running":"paused",i.waiting.forEach(s=>{s.setAttribute("fill-opacity",t?".5":"1")}),t&&setTimeout(()=>{this.loadingDeviceChange(e,!1)},1e3)}djBuildPlayer(){if(this.buildGuiStatus.djPlayer){this.djPlayerObj=document.createElement("div"),this.djPlayerObj.id="djPlayer";let e=`
          <audio id="djStream" playsinline muted>
            <source src="`+this.pxlAudio.djUrlSource+`"></source>
          </audio>
          <table cellpadding=0 cellspacing=5 border=0 style="height:100%;"><tbody><tr>
              <td align="left">
                  <div id="djPlayerVol"></div>
              </td><td valign="center" align="left" width=100%>
                  <div id="djPlayerVolumeParent" class="volParent"><div id="djPlayerVolume" class="volSlider"></div></div>
              </td></tr>
          </tbody></table>`;this.djPlayerObj.innerHTML=e,document.getElementById("musicControllerBlock").appendChild(this.djPlayerObj),this.hudIcons.musicIcon=oe.svgIconPromise(`${this.guiRoot}icons/icon_music.svg`,"djPlayerVol","musicToggle",!this.pxlAudio.djMuted),this.pxlAudio.djBuildPlayer()}}buildItemHud(e,t){this.activeItem.innerHTML=t,this.activeItem.style.opacity="1",this.activeItem.style.filter="alpha(opacity=100)",this.activeItem.style.textShadow="1px 1px 3px #000000",setTimeout(()=>{this.activeItem.style.fontSize="1.5em",this.activeItem.style.top=".5%",this.activeItem.style.right="140px",this.activeItem.style.transform="translateX(0%)"},1500)}hideItemHud(){this.activeItem.innerHTML="",this.activeItem.style.fontSize="3em",this.activeItem.style.top="10%",this.activeItem.style.right="50%",this.activeItem.style.transform="translateX(50%)",this.activeItem.style.opacity="0",this.activeItem.style.filter="alpha(opacity=0)"}mapPrepPrompts(){this.activeItem=document.createElement("div"),this.activeItem.classList.add("activeItemStyle"),this.addToContainer(this.activeItem)}updateGuiPositions(){if(this.loading){let e=this.radioControls.length,t=!1;for(let i=0;i<e;++i){if(!this.radioControls[i][3]){t=!0;break}let s=this.radioControls[i][0],a=this.radioControls[i][2].getBoundingClientRect(),o=a.width+this.buttonPadding*2,n=a.height+this.buttonPadding*2,h=a.top-this.buttonPadding,u=a.left-this.buttonPadding;s.style.width=o,s.style.height=n,s.style.top=h,s.style.left=u,this.radioControls[i][1].style.width=o,this.radioControls[i][1].style.height=n,this.radioControls[i][1].style.top=h,this.radioControls[i][1].style.left=u}this.loading=t}}togglGuiWindow(e=null,t=!1){e==="helpGui"?this.helpGuiToggle(t,!1):e==="infoGui"?this.infoGuiToggle(t,!1):e==="settingsGui"&&this.settingsGuiToggle(t,!1)}svgCheckClick(e=null,t=null){if(t)if(t==="close"){this.toggleGuiWindowContainer(null,!1,!0);return}else{if(t==="ft1")return;if(t==="ft2")return;if(t==="ft3"){this.toggleInviteUser();return}else{if(t==="ft4")return;if(t==="ft5"){this.pxlAutoCam.toggleAutoCam();return}}}}svgStylize(e=null,t=!1){if(!e)return;let i=e.path?e.path[1]:e.target.parentNode,s=i.getElementById("state");if(s){let a=t?"white":"none";s.setAttribute("fill",a)}let r=i.getElementById("hover");r&&r.setAttribute("fill","white")}renderQualitySettings(e){this.pxlQuality.percent=e,this.pxlQuality.screenResPerc=e*.75+.25,this.pxlQuality.mapAutoQualityUpdate(e,!0),this.pxlDevice.resizeRenderResolution()}pxlNavDataUpdate(){var e;this.pxlNavData.active&&((e=this.pxlNavData)!=null&&e.fps)&&this.pxlTimer.msRunner.x>this.pxlNavData.fpsSet&&(this.pxlNavData.fpsSet=this.pxlTimer.msRunner.x+1,this.pxlNavData.fps.innerText=parseInt(1/this.pxlTimer.msRunner.y))}buildGuiWindowContainer(){var i,s;let e=document.createElement("div");e.classList.id="guiWindowBackground",e.classList.add("guiWindowBackground"),e.classList.add("fader"),e.classList.add("visOff"),e.style.display="none";let t=this;e.onclick=r=>{t.toggleGuiWindowContainer(r,!1,!0)},this.guiWindowBG=e,(s=(i=this.guiWindows)==null?void 0:i.container)!=null&&s.gui?this.guiWindows.container.gui.appendChild(e):document.body.appendChild(e)}toggleGuiWindowContainer(e,t,i=!1){if(e){let a=(e.path?e.path[0]:e.target).getAttribute("id");if(a!=="guiWindowBackground"&&!["pxlNav-container","pxlnav-react-container","pxlnav-next-container","gui_helpGuiWindow","gui_helpContent","gui_infoGuiWindow","gui_infoContent","gui_settingsGuiWindow","gui_settingsContent"].includes(a))return null}let s=this.checkOpenWindows(i);this.guiWindowBG&&s===t&&this.promptFader(this.guiWindowBG,t,null,!1),t?this.pxlNavCanvas.blur():this.pxlNavCanvas.focus()}helpGuiBuild(){var c,p,d;this.guiWindows.helpGui={},this.guiWindows.helpGui.gui=null,this.guiWindows.helpGui.active=!1;let e=document.createElement("div");e.id="gui_helpGuiWindow",e.classList.add("gui_helpGuiParentStyle"),this.prepPromptFader(e),this.guiWindowBG.appendChild(e);let t="",i="";if(((c=this.pxlOptions.onboarding.pc)==null?void 0:c.message)!==""){t=this.pxlOptions.onboarding.pc.message,t=this.formatWelcomeMessage(t);let g="";this.pxlOptions.onboarding.pc.messageStyle.length>0&&(g=this.pxlOptions.onboarding.pc.messageStyle.join(" ")),i=`<div class="${g}" id="guiWelcomeMessage">${t}</div>`}let s="close",r="guiButton";((p=this.pxlOptions.onboarding.pc)==null?void 0:p.buttonText)!==""&&(s=this.pxlOptions.onboarding.pc.buttonText),((d=this.pxlOptions.onboarding.pc)==null?void 0:d.buttonStyle.length)>0&&(r=this.pxlOptions.onboarding.pc.buttonStyle.join(" "));let a="";a+=`
      <div id="gui_helpContent" class="gui_contentStyle">
      ${i}
    <div class="gui_body">
      <div id="gui_helpGui_keyboardParent" class="gui_helpGui_keyboardParent">
      <div id="gui_helpGui_controlsKeyboard" class="guiPadding settings_sectionHeader">keyboard controls</div>
      <div class="gui_helpGui_ASDWorUDLR">
        <div id="gui_helpGui_asdw" class="gui_helpGui_asdw"></div>
        <div id="gui_helpGui_or" class="gui_helpGui_text">or</div>
        <div id="gui_helpGui_udlr" class="gui_helpGui_udlr"></div>
      </div>
      <div id="gui_helpGui_useKeys" class="gui_helpGui_text" style="display:inline-block;">Use your keyboard <span class="gui_boldText">WASD</span> or<br><span class="gui_boldText">ARROWS</span> keys to move around</div>
      </div>
      <div id="gui_helpGui_mouse" class="gui_helpGui_mouse">
      <div id="gui_helpGui_MouseControls" class="guiPadding settings_sectionHeader">mouse controls</div>
      <div id="gui_helpGui_MouseOutlined" class="gui_helpGui_mouseOutline"></div>
      <div id="gui_helpGui_useMouse" class="guiPadding gui_helpGui_text" style="display:inline-block;">To orient your view:<br><span class="gui_boldText">LEFT CLICK</span> and drag your mouse<br><span class="gui_boldText">RIGHT CLICK</span> to lock your mouse</div>
      </div>
    </div>
    <div id="gui_helpGui_hotKeys" class="gui_helpGui_hotKeys">
            You can change <span class="gui_boldText">Navigation</span> and <span class="gui_boldText">Look controls</span> in the <span class="gui_boldText">Settings (G)</span> <span id="gui_helpGui_settingIcon"></span> menu
            <br> To show this screen again, open the <span class="gui_boldText">Help (H)</span> screen
            <br> For additional info, see the <span class="gui_boldText">Info (I)</span> screen
          </div>
    <div id="guiHelpFooter" class="gui_footer">
      <div class="${r}" id="guiHelpBackButton">${s}</div>
    </div>
    <div class="gui_spacer"></div>
      </div>
    `,e.innerHTML=a,[[this.guiRoot+"keyboard_asdw.svg","gui_helpGui_asdw","guiKeyDispSVG",!1],[this.guiRoot+"keyboard_udlr.svg","gui_helpGui_udlr","guiKeyDispSVG",!1],[this.guiRoot+"mouse_outline.svg","gui_helpGui_MouseOutlined","guiMouseDispSVG",!1]].forEach(g=>{oe.svgButtonPromise(...g)});let n=this,h=document.getElementById("guiHelpBackButton");h&&(h.onclick=g=>{n.introHelpActive&&(n.introHelpActive=!1,n.pxlEnv.postHelpIntro()),n.svgCheckClick(g,"close")});let u=document.getElementById("gui_helpGui_settingIcon");u&&this.hudIcons.settingsIcon&&(u.innerHTML=this.hudIcons.settingsIcon.svg.parentNode.innerHTML,u.style.position="relative",u.style.top="7.3px",u.style.width="30px",u.style.padding="2px",u.style.cursor="pointer",u.children[0].style.height="26px",u.onclick=()=>{n.iconEvent("click",null,"settings")}),this.guiWindows.helpGui.gui=e,setTimeout(()=>{this.resize()},50)}helpGuiToggle(e=null,t=!0){this.guiWindows.helpGui||this.helpGuiBuild(),e=e===null?!this.guiWindows.helpGui.active:e,this.guiWindows.helpGui.active=e,this.promptFader(this.guiWindows.helpGui.gui,e),this.toggleGuiWindowContainer(null,e),this.hudBlock.active&&this.toggleHudBlock(e),this.promptFader(this.guiWindows.container,!0),this.introHelpActive&&!e&&(this.introHelpActive=!1,this.pxlEnv.postHelpIntro()),setTimeout(()=>{this.resetHelpTextPlacement()},20)}infoGuiBuild(){this.guiWindows.infoGui={},this.guiWindows.infoGui.gui=null,this.guiWindows.infoGui.active=!1;let e=document.createElement("div");e.id="gui_infoGuiWindow",e.classList.add("gui_infoGuiParentStyle"),this.prepPromptFader(e),this.guiWindowBG.appendChild(e);let t="";t+=`
    <div id="gui_infoContent" class="gui_contentInfoStyle">
  <div class="gui_infoBody">
    <div id="gui_infoGuiParent" class="gui_infoGuiParent">
    <br>${this.projectTitle}
    <br>&nbsp;&nbsp; Created by <a href="https://github.com/ProcStack" target="_blank">Kevin Edzenga / ProcStack</a> 2024; 2025
    <br>
    <br>If any bugs are found in pxlNav, you can share them on the GitHub issues page:
    <br>&nbsp;&nbsp; <a href="https://github.com/ProcStack/pxlNav/issues" target="_blank">pxlNav / issues</a>
    <br>
    </div>
  </div>

  <div id="guiInfoFooter" class="gui_footer">
    <div class="guiButton" id="guiInfoBackButton">close</div>
  </div>
    </div>
  `,e.innerHTML=t;let i=this,s=document.getElementById("guiInfoBackButton");s.onclick=r=>{i.svgCheckClick(r,"close")},this.guiWindows.infoGui.gui=e}infoGuiToggle(e=null,t=!0){this.guiWindows.infoGui||this.infoGuiBuild(),e=e===null?!this.guiWindows.infoGui.active:e,this.guiWindows.infoGui.active=e,this.promptFader(this.guiWindows.infoGui.gui,e),this.toggleGuiWindowContainer(null,e),this.hudBlock.active&&this.toggleHudBlock(e),this.introHelpActive&&!e&&(this.introHelpActive=!1,this.pxlEnv.postHelpIntro())}applyCookies(){}settingsGuiBuild(){this.guiWindows.settingsGui={},this.guiWindows.settingsGui.gui=null,this.guiWindows.settingsGui.active=!1;let e=document.createElement("div");e.id="gui_settingsGuiWindow",e.classList.add("gui_settingsGuiParentStyle"),this.prepPromptFader(e),this.guiWindowBG.appendChild(e);let t="Default";t=t||"";let i=`
    <div id="gui_settingsContent" class="gui_contentSettingsStyle">
  <div class="gui_settingsBody">
    <div class="gui_settingsParentGrid">
    `;this.settingsFields.changeUsername&&(i+=`
        <!-- -- Username -- -- -->
        <div class="cellMargin settings_icon" id="settings_user"></div>
        <div class="settings_optionHeader">Username</div>
        <div class="settings_radio" style="grid-auto-flow: row; justify-content: start;">
            <div id="guiuserProfileBoxFieldParent" class="gui_userProfileBoxFieldParentStyle">
              <input type="text" placeholder="Set your username" value="${t}" id="settings_usernameInput" class="settings_usernameInput"></input>
              <input type="button" value="Set" id="settings_sendUsername" class="sendUsername">
            </div>
            <div id="settings_usernameResponseMessage" class="usernameResponseMessageStyle"></div>
        </div>
      <!-- -- -- -- -- -- -->
      <div class="settingsGridSpan settingsSpacer"></div>
      <!-- -- -- -- -- -- -->
      `),i+=`
      <!-- -- Left/Right -- -- -->
    <div class="cellMargin settings_icon" id="settings_left_right"></div>
    <div class="settings_optionHeader">Left/Right</div>
    <div class="settings_radio" id="settingsRadioBlock_leftRight">
      <span>
      <input type="radio" id="settings_tankTurning" name="settings_leftRight" value="0" hidden>
      <label for="settings_tankTurning">Turn</label>
      </span>
      <span>
      <input type="radio" id="settings_strafing" name="settings_leftRight" value="1" hidden>
      <label for="settings_strafing">Strafe</label>
      </span>
    </div>
      <!-- -- Mouse -- -- -->
    <div class="cellMargin settings_icon" id="settings_mouse"></div>
    <div class="settings_optionHeader">Mouse Looking</div>
    <div class="settings_radio" id="settingsRadioBlock_mouse">
      <span>
      <input type="radio" id="settings_dragLooking" name="settings_mouse" value="0" hidden>
      <label for="settings_dragLooking">Native</label>
      </span>
      <span>
      <input type="radio" id="settings_pointLooking" name="settings_mouse" value="1" hidden>
      <label for="settings_pointLooking">Inverted</label>
      </span>
    </div>
      <!-- -- -- -- -- -- -->
    <div class="settingsGridSpan settingsSpacer"></div>
      <!-- -- Graphics Quality -- -- -->
    <div class="cellMargin settings_icon" id="settings_graphics"></div>
    <div class="settings_optionHeader">Graphics Quality</div>
    <div class="settings_radio" id="settingsRadioBlock_graphics">
      <span>
      <input type="radio" id="settings_graphicsQuality_low" name="settings_autoQuality" value="0" hidden>
      <label for="settings_graphicsQuality_low">Low</label>
      </span>
      <span>
      <input type="radio" id="settings_graphicsQuality_med" name="settings_autoQuality" value="1" hidden>
      <label for="settings_graphicsQuality_med">Medium</label>
      </span>
      <span>
      <input type="radio" id="settings_graphicsQuality_high" name="settings_autoQuality" value="2" hidden>
      <label for="settings_graphicsQuality_high">High</label>
      </span>
      <span>
      <input type="radio" id="settings_graphicsQuality_custom" name="settings_autoQuality" value="3" hidden>
      <label for="settings_graphicsQuality_custom">Custom</label>
      </span>
    </div>
      <!-- -- -- -- -->
      <div class="r7Adv gui_settingsAdvancedParentGrid" id="gui_advancedSettings">
    <!-- -- -- -- -->
      <div class="cellMargin settings_icon" id="settings_render"></div>
      <div class="settings_optionHeader">Render Resolution</div>
      <div class="settings_radio" id="settingsRadioBlock_resolution">
      <span>
        <input type="radio" id="settings_render_25" name="settings_renderPerc" value=".25" hidden>
        <label for="settings_render_25">25%</label>
      </span>
      <span>
        <input type="radio" id="settings_render_50" name="settings_renderPerc" value=".5" hidden>
        <label for="settings_render_50">50%</label>
      </span>
      <span>
        <input type="radio" id="settings_render_75" name="settings_renderPerc" value=".75" hidden>
        <label for="settings_render_75">75%</label>
      </span>
      <span>
        <input type="radio" id="settings_render_100" name="settings_renderPerc" value="1" hidden>
        <label for="settings_render_100">100%</label>
      </span>
      </div>
    <!-- -- -- -- -->
      <div class="cellMargin settings_icon" id="settings_fog"></div>
      <div class="settings_optionHeader">Fog Quality</div>
      <div class="settings_radio" id="settingsRadioBlock_fog">
      <span>
        <input type="radio" id="settings_noRedFog" name="settings_fogLevel" value="0" hidden>
        <label for="settings_noRedFog">Low</label>
      </span>
      <span>
        <input type="radio" id="settings_cheapResFog" name="settings_fogLevel" value="1" hidden>
        <label for="settings_cheapResFog">Medium</label>
      </span>
      <span>
        <input type="radio" id="settings_highResFog" name="settings_fogLevel" value="2" hidden>
        <label for="settings_highResFog">High</label>
      </span>
      </div>
    <!-- -- -- -- -->
      <div class="cellMargin settings_icon" id="settings_bloom"></div>
      <div class="settings_optionHeader">Bloom Effects</div>
      <div class="settings_radio" id="settingsRadioBlock_bloom">
      <span>
        <input type="radio" id="settings_noBloom" name="settings_bloomEffects" value="0" hidden>
        <label for="settings_noBloom">Off</label>
      </span>
      <span>
        <input type="radio" id="settings_bloomActive" name="settings_bloomEffects" value="1" hidden>
        <label for="settings_bloomActive">On</label>
      </span>
      </div>
    <!-- -- -- -- -->
      </div>
    </div>
      <div class="settingsGridSpan settingsEmptySpacer"></div>
    </div>
    <div class="guiSettingsFooterButtons">
    <div class="guiButton" id="guiSettingsBackButton">close</div>
    </div>
  </div>
    </div>
  `,e.innerHTML=i,this.guiWindows.settingsGui.gui=e;let s=this;this.qualitySlider=document.getElementById("SettingsGraphicsQualitySlider");let r=document.getElementById("guiSettingsBackButton");r.onclick=u=>{s.svgCheckClick(u,"close")},[[this.guiRoot+"settings_user.svg","settings_user",["settings_icon_scale"],!1],[this.guiRoot+"settings_left_right.svg","settings_left_right",["settings_icon"],!1],[this.guiRoot+"settings_mouse.svg","settings_mouse",["settings_icon"],!1],[this.guiRoot+"settings_graphics.svg","settings_graphics",["settings_icon"],!1],[this.guiRoot+"settings_render.svg","settings_render",["settings_icon"],!1],[this.guiRoot+"settings_fog.svg","settings_fog",["settings_icon"],!1],[this.guiRoot+"settings_bloom.svg","settings_bloom",["settingsIconStyle"],!1]].forEach(u=>{oe.svgButtonPromise(...u)});let o=document.getElementById("settings_usernameInput");if(o){o.onkeyup=p=>{s.keyUsernameSet(p)},o.onkeydown=p=>{s.keyDownUsernameSet(p)},this.guiWindows.settingsGui.usernameInput=o,document.getElementById("settings_sendUsername").addEventListener("click",()=>{s.sendUsernameUpdate(o)});let c=document.getElementById("settings_usernameResponseMessage");c&&(this.guiWindows.settingsGui.usernameReturn=c)}let n,h;this.guiWindows.settingsGui.advObj=document.getElementById("gui_advancedSettings"),this.guiWindows.settingsGui.customObj=document.getElementById("settings_graphicsQuality_custom"),n=["settings_graphicsQuality_low","settings_graphicsQuality_med","settings_graphicsQuality_high","settings_graphicsQuality_custom"],h=n.length;for(let u=0;u<h;++u){let c=n[u],p=document.getElementById(c);this.setRadioStyle(p,u,h);let d=parseInt(p.value);p.addEventListener("change",g=>{s.pxlQuality.setQualityLevel(d),s.setRadioValues()})}n=["settings_render_25","settings_render_50","settings_render_75","settings_render_100"],h=n.length;for(let u=0;u<h;++u){let c=n[u],p=document.getElementById(c);this.setRadioStyle(p,u,h);let d=parseFloat(p.value);p.addEventListener("change",g=>{s.guiWindows.settingsGui.customObj.checked=!0,s.pxlQuality.setGraphicsSettings({resolution:d}),s.pxlQuality.setQualityCookie(3)})}n=["settings_noRedFog","settings_cheapResFog","settings_highResFog"],h=n.length;for(let u=0;u<h;++u){let c=n[u],p=document.getElementById(c);this.setRadioStyle(p,u,h);let d=p.value;p.addEventListener("change",g=>{s.guiWindows.settingsGui.customObj.checked=!0,s.pxlQuality.setGraphicsSettings({fog:d}),s.pxlQuality.setQualityCookie(3)})}n=["settings_noBloom","settings_bloomActive"],h=n.length;for(let u=0;u<h;++u){let c=n[u],p=document.getElementById(c);this.setRadioStyle(p,u,h);let d=p.value===1;p.addEventListener("change",g=>{s.guiWindows.settingsGui.customObj.checked=!0,s.pxlQuality.setGraphicsSettings({bloom:d}),s.pxlQuality.setQualityCookie(3)})}n=["settings_tankTurning","settings_strafing"],h=n.length;for(let u=0;u<h;++u){let c=n[u],p=document.getElementById(c);this.setRadioStyle(p,u,h);let d=p.value===1;p.addEventListener("change",g=>{s.pxlQuality.setGraphicsSettings({leftRight:d},null)})}n=["settings_dragLooking","settings_pointLooking"],h=n.length;for(let u=0;u<h;++u){let c=n[u],p=document.getElementById(c);this.setRadioStyle(p,u,h);let d=p.value===1;p.addEventListener("change",g=>{s.pxlQuality.setGraphicsSettings({mouse:d},null)})}this.setRadioValues()}setRadioStyle(e,t,i){let s="settings_radio_label_mid";t===0?s="settings_radio_label_start":t===i-1&&(s="settings_radio_label_end"),e.parentNode.children[1].classList.add(s)}setRadioValues(){let e=this.pxlQuality.settings;Object.keys(e).forEach(i=>{let s=document.getElementById("settingsRadioBlock_"+i);if(s){let r=i==="resolution"?e[i]*4-1:~~e[i];s.children[r].children[0].checked=!0}})}settingsGuiAdvObjSizing(e=!0){let t=this.guiWindows.settingsGui.advObj,i=t.offsetHeight;t.style.maxHeight=(e?i:0)+"px",t.setAttribute("maxHeight",i)}settingsGuiToggle(e=null,t=!0){var i,s;this.guiWindows.settingsGui||this.settingsGuiBuild(),e=e===null?!this.guiWindows.settingsGui.active:e,e&&((s=(i=this.guiWindows)==null?void 0:i.settingsGui)!=null&&s.usernameReturn)&&(this.guiWindows.settingsGui.usernameReturn.innerText=""),this.guiWindows.settingsGui.active=e,this.promptFader(this.guiWindows.settingsGui.gui,e),this.toggleGuiWindowContainer(null,e),this.hudBlock.active&&this.toggleHudBlock(e),this.toggleHudBlock(e,!1),this.togglePxlNavDataDisplay(e),this.introHelpActive&&!e&&(this.introHelpActive=!1,this.pxlEnv.postHelpIntro())}togglePxlNavDataDisplay(e=null){var i;e===null&&(this.guiWindows.settingsGui?e=this.guiWindows.settingsGui.active:e=!1),this.pxlNavData.active=e;let t=this.pxlNavData.height||200;(i=this.pxlNavData)!=null&&i.gui&&(this.pxlNavData.gui.style.maxHeight=e?t+"px":"0px",e||(this.pxlNavData.height=this.pxlNavData.gui.offsetHeight))}renderRadius(e){this.pxlEnv.mapGlowPass.strength=Number(e),this.pxlEnv.roomBloomPass.strength=Number(e)}renderThreshold(e){this.pxlEnv.mapGlowPass.threshold=Number(e),this.pxlEnv.roomBloomPass.threshold=Number(e)}renderGlowRadius(e){this.pxlEnv.mapGlowPass.radius=Number(e),this.pxlEnv.roomBloomPass.radius=Number(e)}renderResolution(e){this.pxlQuality.screenResPerc=e*.75+.25,this.pxlDevice.resizeRenderResolution()}inviteUserBuild(){this.guiWindows.inviteUserGui={},this.guiWindows.inviteUserGui.gui=null,this.guiWindows.inviteUserGui.active=!1;let e=document.createElement("div");e.id="gui_inviteUserWindow",e.classList.add("gui_inviteUserParentStyle"),this.prepPromptFader(e),this.addToContainer(e);let t=window.location+"";t=t.replace(/^https?:\/\//,"");let i="";i+=`
        <div class="gui_inviteUserBody">
          <div class="iu_urlStyle">${t}</div>
          <div id="iu_copy" class="iu_copyStyle">Copy</div>
        </div>
    `,e.innerHTML=i;let s=this.pxlUtils,r=document.getElementById("iu_copy");r.addEventListener("click",()=>{s.copyRoomUrl()?r.innerText="Copied":r.innerText="Error",r.timeout&&clearTimeout(r.timeout),r.timeout=setTimeout(()=>{r.innerText="Copy",clearTimeout(r.timeout)},2e3)}),this.guiWindows.inviteUserGui.gui=e}inviteUserPosition(){if(this.guiWindows.inviteUserGui&&this.guiWindows.inviteUserGui.active){let t=document.getElementById("ft3Button").getBoundingClientRect();this.guiWindows.inviteUserGui.gui.style.display="grid",this.guiWindows.inviteUserGui.gui.style.top=t.y,this.guiWindows.inviteUserGui.gui.style.right=this.pxlDevice.sW-t.x+5,this.guiWindows.inviteUserGui.gui.style.minHeight=t.height}}toggleInviteUser(e=null){this.guiWindows.inviteUserGui||this.inviteUserBuild(),e=e===null?!this.guiWindows.inviteUserGui.active:e,this.guiWindows.inviteUserGui.active=e,this.promptFader(this.guiWindows.inviteUserGui.gui,e),this.inviteUserPosition()}formatWelcomeMessage(e){let t=this.projectTitle;return e.replace(/%projectTitle%/g,t)}buildMobileWelcome(){var u,c,p,d;this.guiWindows.mobileGui={},this.guiWindows.mobileGui.gui=null,this.guiWindows.mobileGui.active=!1;let e=document.createElement("div");e.id="gui_mobileWelcomeGuiWindow",e.classList.add("gui_helpGuiParentStyle"),this.prepPromptFader(e),this.guiWindowBG.appendChild(e);let t="",i="";if(((u=this.pxlOptions.onboarding.mobile)==null?void 0:u.message)!==""){t=this.pxlOptions.onboarding.mobile.message,t=this.formatWelcomeMessage(t);let g="";((c=this.pxlOptions.onboarding.mobile)==null?void 0:c.messageStyle.length)>0&&(g=this.pxlOptions.onboarding.mobile.messageStyle.join(" "),g=`class="${g}"`),i=`<div id="gui_mobileWelcomeMessage" ${g}>${t}</div>`}let s="guiButton";((p=this.pxlOptions.onboarding.mobile)==null?void 0:p.buttonStyle.length)>0&&(s=this.pxlOptions.onboarding.mobile.buttonStyle.join(" "));let r="enter";((d=this.pxlOptions.onboarding.mobile)==null?void 0:d.buttonText)!==""&&(r=this.pxlOptions.onboarding.mobile.buttonText);let a="";a+=`
    <div id="gui_helpContent" class="gui_contentStyle">
  <div class="pxlGui-mobile-body">
    ${i}
  </div>
  <div id="gui_helpGui_hotKeys" class="gui_helpGui_mobileHud">
    Tap-&-Drag the <span class="gui_boldText">Left Circle</span> to move you,
    <br>The <span class="gui_boldText">Right Circle</span> to look around;
    <br>
    <br> Tap the <span class="gui_boldText">upper</span> half of the screen to jump
    <br>
    <br> If the screen is black behind this message,
    <br> Please <span id="refeshPxlPage">refresh</span> the page
  </div>
  <div id="guiHelpFooter" class="gui_footer">
    <div class="${s}" id="guiMobileWelcomeButton">${r}</div>
  </div>
  <div class="gui_spacer"></div>
    </div>
  `,e.innerHTML=a;let o=document.getElementById("refeshPxlPage");o&&(o.onclick=g=>{g.preventDefault(),this.refreshPage()});let n=this,h=document.getElementById("guiMobileWelcomeButton");h.onclick=g=>{n.toggleMobileWelcome(!1),n.pxlEnv.postHelpIntro(),n.promptFader(this.guiWindowBG,!1,null,!1),this.pxlDevice.requestFullScreen()},this.guiWindows.mobileGui.gui=e}toggleMobileWelcome(e=null){if(this.guiWindows.mobileGui||this.buildMobileWelcome(),e!==null&&this.guiWindows.mobileGui.active===e){console.error("Mobile welcome already set to active: "+e);return}e=e===null?!this.guiWindows.mobileGui.active:e,this.guiWindows.mobileGui.active=e,e?this.promptFader(this.guiWindows.mobileGui.gui,e):this.promptFader(this.guiWindows.mobileGui.gui,e,null,!0),this.toggleGuiWindowContainer(null,e),this.hudBlock.active&&this.toggleHudBlock(e)}ctaBuildPopup(e=""){this.ctaContentLoading||(this.googleDocHTML?this.ctaDisplayPopup():(this.ctaContentLoading=!0,this.pxlFile.getURLContent(this.ctaLocalDocURL.cta).then(t=>{this.ctaContentLoading=!1,this.googleDocHTML=t,this.ctaDisplayPopup()})))}ctaDisplayPopup(){this.actionPopUp&&this.actionPopUp.parentNode.removeChild(this.actionPopUp);let e=this.googleDocHTML;this.actionPopUp=document.createElement("div"),this.actionPopUp.setAttribute("id","ctaPopup"),this.actionPopUp.classList.add("parentGoogleLinkDoc"),this.actionPopUp.classList.add("fader"),this.actionPopUp.classList.add("visOff");let t=document.createElement("div");t.setAttribute("id","ctaPopupInner"),this.actionPopUp.appendChild(t),this.addToContainer(this.actionPopUp);let i=null;e===""||!e?(i=document.createElement("iframe"),i.src="",i.classList.add("iframeGoogleLinkDoc"),t.appendChild(i),i.referrerpolicy="unsafe-url"):(t.innerHTML=e,t.classList.add("iframeGoogleLinkDoc"));let s=this;this.actionPopUp.onclick=function(r){r.srcElement.getAttribute("id")==="ctaPopup"&&(s.promptFader(this,!1,null,!0),s.actionPopUp=null)},i?i.onload=function(){setTimeout(()=>{this.promptFader(this.actionPopUp,!0,null,!1)},100)}:setTimeout(()=>{this.promptFader(this.actionPopUp,!0,null,!1)},100)}getUserControls(e){if(!e)return[null];let t=e,i=t.userStatusGui,s=t.audio,r=t.audioMuted,a=t.userSoundGui,o=t.displayName,n=t.userNameGui,h=t.verse;return{curAvatar:t,curName:o,curAudio:s,curAudioMuted:r,curGui:i,curNameGui:n,curAudioGui:a,curVerse:h}}async setUserControlPosition(){if(this.userControlBlock){let e=0;if(this.hudTopBar){let t=this.hudTopBar.getBoundingClientRect();e=t.y+t.height}this.userControlBlock.gui.style.top=e+"px"}}buildUserSpeaker(){let e={},t=this.userControlBlock.speakerIcon.svg.cloneNode(!0);t.classList.add("userControlSpeakerStyle"),t.classList.add("userControlSpeakerButtonStyle"),e.gui=t,e.remoteMuted=!1,e.volPrev=0;let i=t.children;for(let r=0;r<i.length;++r){let a=i[r],o=a.getAttribute("id");e[o]=a,o==="mute"?a.classList.add("userControlVisStyle"):o==="button"&&a.classList.add("userControlSpeakerButtonStyle")}let s=e.volLines.children;for(let r=0;r<s.length;++r){let a=s[r],o=a.getAttribute("id");e[o]=a}s=e.remoteMutedLines.children;for(let r=0;r<s.length;++r){let a=s[r],o=a.getAttribute("id");e[o]=a}return e}async addUserControls(e,t=!1){let{curAvatar:i,curName:s}=this.getUserControls(e),r=document.createElement("div");r.classList.add("userControlProximityOff"),r.classList.add("userControlParentStyle"),r.classList.add("userControlSpeakerButtonStyle"),this.mobile&&(r.style.display="none");let a=this;r.onclick=()=>{a.setUserControlMute(e)},i.userStatusGui=r,this.userControlBlock.gui.appendChild(r);let o=document.createElement("div");o.classList.add("userControlInnerParentStyle"),r.appendChild(o);let n=document.createElement("div");n.classList.add("userControlSpeakerParentStyle");let h=this.buildUserSpeaker();n.appendChild(h.gui),i.userSoundGui=h,o.appendChild(n);let u=document.createElement("div");u.classList.add("userControlNameStyle"),u.innerText=s,i.userNameGui=u,o.appendChild(u),this.setUserControlColor(e)}async setUserControlVolume(e,t,i=!0){if(this.userControlBlock.activeList.includes(e)){let{curAudioGui:s,curAudioMuted:r}=this.getUserControls(e);s&&(!r||t===0)&&(s.remoteMuted?t=0:i&&t>0&&(t*=2,t=Math.min(1,Math.max(t,(t+s.volPrev)*.5))),s.volPrev=t,s.volLines.style.opacity=t,s.volLines.style.filter="alpha(opacity="+t*100+")")}}async setUserControlMute(e){let{curAvatar:t,curAudio:i,curAudioMuted:s,curAudioGui:r}=this.getUserControls(e);if(i){let a=!s;a?(this.setUserControlVolume(e,0,!1),r.mute.classList.add("userControlVisible"),i.volume=0,i.muted=!0):(r.mute.classList.remove("userControlVisible"),i.muted=!1,i.volume=1),t.audioMuted=a}}async setUserControlRemoteMute(e,t=null,i=!0,s="#ffffff"){let{curAudio:r,curAudioGui:a}=this.getUserControls(e);if(a){t===null&&(r?t=r.muted:t=!1);let o=typeof t=="object"?t.muted:t;a.remoteMuted=o,a.base.setAttribute("fill",o?"#ff0000":s),a.remoteMutedLines.style.display=o||!i?"inline-block":"none",a.remoteS1.setAttribute("stroke",i?"#ff0000":s),a.remoteS2.setAttribute("stroke",i?"#ff0000":s),this.setUserControlVolume(e,0,!1)}}async setUserControlVis(e,t=null,i=!1){let{curGui:s}=this.getUserControls(e);if(s){let r="userControlProximityOff";if(t===null&&(t=!s.classList.contains(r)),t)s.classList.remove(r),s.style.maxWidth=s.children[0].getBoundingClientRect().width+"px",this.setUserControlVolume(e,0),this.userControlBlock.activeList.includes(e)||this.userControlBlock.activeList.push(e);else{s.classList.add(r),s.style.maxWidth="30px";let a=this.userControlBlock.activeList.indexOf(e);a>-1&&this.userControlBlock.activeList.splice(a,1)}this.userControlBlock.gui.style.padding=this.userControlBlock.activeList.length===0?"0px":"5px"}}async deleteUserControlVis(e){let{curGui:t}=this.getUserControls(e);if(t){t.classList.add("userControlProximityOff"),t.style.maxWidth="30px";let s=this.userControlBlock.activeList.indexOf(e);s>-1&&this.userControlBlock.activeList.splice(s,1),this.userControlBlock.gui.style.padding=this.userControlBlock.activeList.length===0?"0px":"5px",t&&t.parentNode.removeChild(t)}}userControlsSwap(e,t){let i=this.userControlBlock.activeList.indexOf(e);i>-1&&(this.userControlBlock.activeList.splice(i,1),this.userControlBlock.activeList.includes(t)||this.userControlBlock.activeList.push(t))}setUserControlColor(e,t=null){let{curAvatar:i,curGui:s,curAudioGui:r,curVerse:a}=this.getUserControls(e),o=!0;if(t===null)if(o)t="#ffffff";else{let h=this.pxlUtils.stringToRgb(a,.3);t=this.pxlUtils.rgbToHex(...h)}s.style.color=t,r.base.setAttribute("fill",t),r.mute.setAttribute("stroke",t),r.mid.setAttribute("fill",t),r.max.setAttribute("fill",t),r.volPrev=0,r.volLines.style.opacity=0,r.volLines.style.filter="alpha(opacity=0)";let n=this;i.userStatusGui.onclick=()=>{n.setUserControlMute(e)},this.setUserControlRemoteMute(e,null,o,t)}toggleUserControls(e){if(!e)return null}};import{Vector3 as LA}from"three";var Xi=class{constructor(e,t){this.active=!1,this.isEditing=!1,this.name="GLSL Editor",this.type="shaderGui",this.pxlCore=e,this.pxlEnv=e.pxlEnv,this.guiManager=t,this.parent=null,this.gui=null,this.helpGui=null,this.shaderEditorDisplay=null,this.children={},this.uniformsObj=null,this.vertObj=null,this.fragObj=null,this.currentShader=null,this.clickThroughListener=this.clickThroughCheck.bind(this),this.shaderSliderValues=new LA,this.editorWidthMinMax={min:30,max:70}}addSlider(e,t,i,s,r,a,o,n){typeof e=="string"&&(e=document.getElementById(e));let h=document.createElement("div");h.style.display="grid",h.style.gridAutoFlow="column",h.style.alignItems="center",h.style.gridAutoColumns="max-content auto max-content",h.innerHTML="<div class='input_sliderLabel'>"+t+" : </div>";let u=document.createElement("input");u.type="range",u.classList.add("input_sliderRange"),u.min=s,u.max=r,u.step=a,u.value=i,h.appendChild(u);let c=document.createElement("input");c.type="number",c.classList.add("gui_defaultInput"),c.classList.add("input_numberInput"),c.value=i,h.appendChild(c),c.onchange=p=>{u.value=p.target.value},u.onchange=p=>{c.value=p.target.value,o(p.target.value,...n)},u.oninput=p=>{c.value=p.target.value,o(p.target.value,...n)},e.appendChild(h)}updateShaderTextFields(e=null){let t;e||(e=this.pxlEnv.currentRoom===this.pxlEnv.mainRoom?this.currentShader:this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].getCurrentShader());try{t=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].readShader(e,this.shaderSliderValues)}catch(a){return}let i,s,r;i=s=r="Unable To Load";try{t.uniforms.sliders={type:"v",value:this.shaderSliderValues},i=JSON.stringify(t.uniforms),s=t.vertexShader,r=t.fragmentShader,i="";for(let a in t.uniforms){let o="float",n={t:"sampler2D",b:"bool",i:"int",f:"float",v:"vec",c:"vec"};if(o=typeof t.uniforms[a].value,o==="object"){if(o="",!t.uniforms[a].value)continue;"image"in t.uniforms[a].value?o="sampler2D":o=o+"vec"+Object.keys(t.uniforms[a].value).length}else n.hasOwnProperty(t.uniforms[a].type)&&(o=t.uniforms[a].type==="i"?"i":""),n.hasOwnProperty(t.uniforms[a].type)&&(o=n[t.uniforms[a].type]);i+=`uniform ${o} ${a};   `}s=s.replace(/[\t]/g,"  "),r=r.replace(/[\t]/g,"  ")}catch(a){console.log("Error Reading Shader"),console.log(a)}t&&(t.needsUpdate=!0,this.children.uniformsObj.value=i,this.children.vertObj.value=s,this.children.fragObj.value=r)}buildShaderEditor(){let e="shaderGui",t=document.createElement("div");t.id="guiShaderEditorBlock",t.classList.add("gui_shaderEditorBlockStyle"),t.style.transition="max-width .5s ease, opacity .8s, filter .8s",this.pxlEnv.pxlGuiDraws.prepPromptFader(t),this.pxlEnv.pxlGuiDraws.guiWindows[e]={},this.pxlEnv.pxlGuiDraws.guiWindows[e].gui=t,this.pxlEnv.pxlGuiDraws.guiWindows[e].active=!1,this.gui=t;let i=document.createElement("div");i.id="guiShaderHelpBlock",i.classList.add("gui_shaderHelpBlockStyle"),i.style.transition="left .3s ease, opacity .8s, filter .8s",this.pxlEnv.pxlGuiDraws.prepPromptFader(i),this.pxlEnv.pxlGuiDraws.guiWindows[e].help=i,this.helpGui=i;let s=this.pxlEnv.currentRoom,r=this.pxlEnv.roomSceneList[s].geoList,a=Object.keys(r),o="";a.forEach(x=>{if(["Mesh","Points"].includes(r[x].type)&&r[x].material.type==="ShaderMaterial"){let b=x.substring(0,1).toUpperCase()+x.substring(1,x.length);o+="<option value='geo_"+x+"'>"+b+"</option>"}});let n="",h="selected";this.pxlEnv.pxlGuiDraws.guiWindows[e].currentShader="script_fog";let u=`
    <div id="gui_shaderEditorParent" class="gui_shaderEditorParentStyle">
      <div id="gui_shaderEditorHeaderBlock" class="gui_shaderEditorHeaderBlock">
      <div class="gui_shaderEditorOptionBlock">
        <div class="gui_shaderEditorTitleBlock">
        <div id="gui_shaderEditorTitleParent" class="gui_shaderEditorTitleParentStyle">
            <div id="gui_shaderEditorTitle" clsss="gui_shaderEditorTitleStyle">GLSL Shader Editor</div>
            <div id="gui_shaderEditorHeaderList" clsss="gui_shaderEditorHeaderListStyle">
              <span id="gui_shaderEditorPulldownHeader" clsss="gui_shaderEditorPulldownHeaderStyle">Edit Shader</span>
              <select name="shaderEditor_loadShader" id="shaderEditor_loadShader" class="pickerStyle gui_shaderPickerStyle">
                <option value="script_avatar" ${n}>Avatar</option>
                <option value="script_fog" ${h}>Fog</option>
                <option value="script_dArrows">Direction Arrows</option>
                <option value="script_userScreens">User Screens</option>
                <option value="script_warpZonePortals">Warp Zone Portals</option>
                <option value="script_lizardking">Item; Lizard King</option>
                <option value="script_majorTom">Item; Major Tom</option>
                <option value="script_fractalSubstrate">Item; Fractal Substrate</option>
                <option value="script_fractalEcho">Item; Fractal Echo Pass</option>
                ${o}
              </select>
            </div>
            <div id="gui_shaderEditorFontSize" clsss="gui_shaderEditorFontSizeStyle">
              <span  style="font-size:.75em;margin-right:5px;">Font Size</span>
              <span id="gui_shaderEditorFontSmaller" class="shaderEditor_settingsButton">-</span>
              <span id="gui_shaderEditorFontLarger" class="shaderEditor_settingsButton">+</span>
              <span class="gui_shaderEditorOptionBarSpacer"> </span>
              <span id="gui_shaderEditorCloseButton" class="shaderEditor_settingsButton">X</span>
            </div>
          </div>
        </div>
        <div class="gui_shaderEditorHeaderLine"></div>
        <div id="guiShaderUserSliders"></div>
        <div class="gui_shaderEditorHeaderLine"></div>
      </div>
      </div>

      <div id="guiShaderFieldParent" class="gui_shaderEditorFieldParentStyle">
        <span style='height:12px'>Uniforms -</span>
        <textarea spellcheck="false" placeholder="Shader Uniforms" rows="3" id="shaderEditor_uniformInput" style="height:unset;" readonly></textarea>
        <span style='height:12px'>Vertex Shader -</span>
        <textarea spellcheck="false" placeholder="Vertex Shader" id="shaderEditor_vertInput"></textarea>
        <span style='height:12px'>Fragment Shader -</span>
        <textarea spellcheck="false" placeholder="Fragment Shader" id="shaderEditor_fragInput"></textarea>
      </div>
      <div id="shader_updateShader" class="shaderEditor_sendMessage">Update Shader</div>
    </div>
    `,c="<div class='gui_shaderHelpSpacerStyle'></div>";u+=`
    <div id="gui_shaderHelpBlock" class="gui_shaderHelpBlockStyle">
      <div class="gui_shaderHelpTitle">:: Keyboard Shortcuts ::</div>
      ${c}
      <span><span class="gui_boldText">Ctrl + Enter</span><br> - Update Shader on Material</span>
      <br>&nbsp;&nbsp;<span>Returns use existing indent type (Spaces or Tabs)</span>
      ${c}
      <span><span class="gui_boldText">Ctrl + D</span><br> - Duplicate current line</span>
      ${c}
      <span><span class="gui_boldText">Ctrl + K</span><br> - Comment current/selected lines</span>
      ${c}
      <span><span class="gui_boldText">Ctrl + Shift + K</span><br> - Uncomment current/selected lines</span>
      ${c}
      <span><span class="gui_boldText">Ctrl + NumPad {1,2,3}</span><br> - Add selection or '.0' into float(), vec2(), vec3() </span>
      ${c}
      <span><span class="gui_boldText">Ctrl + {Up,Down,Left,Right}</span><br> - Searches for current selection in direction</span>
      ${c}
      <span><span class="gui_boldText">Y</span><br> - To opn/close the Shader Editor</span>
      ${c}
    </div>
    `,t.innerHTML=u,document.body.appendChild(t);let p=document.getElementById("guiShaderUserSliders");this.parentObj=p;let d=this.shaderSliderValues,g=(x,...b)=>{d[b[0]]=x};this.addSlider(p,"sliders.x",0,-1,1,1e-4,g,["x"]),this.addSlider(p,"sliders.y",0,-5,5,.001,g,["y"]),this.addSlider(p,"sliders.z",0,-10,10,.001,g,["z"]),this.children.shaderSliders=p,this.children.shaderParentObj=document.getElementById("shaderEditor_uniformInput").parentNode,this.children.shaderEditor=document.getElementById("gui_shaderEditorParent"),this.children.headerBar=document.getElementById("gui_shaderEditorHeaderBlock"),this.children.titleParentObj=document.getElementById("gui_shaderEditorTitleParent"),this.children.titleObj=document.getElementById("gui_shaderEditorTitle"),this.children.pulldownHeaderObj=document.getElementById("gui_shaderEditorPulldownHeader"),this.children.uniformsObj=document.getElementById("shaderEditor_uniformInput"),this.children.vertObj=document.getElementById("shaderEditor_vertInput"),this.children.fragObj=document.getElementById("shaderEditor_fragInput"),this.children.updateObj=document.getElementById("shader_updateShader"),this.children.helpDiv=document.getElementById("gui_shaderHelpBlock"),this.children.shaderList=document.getElementById("gui_shaderEditorHeaderList"),this.children.shaderFieldParent=document.getElementById("guiShaderFieldParent"),this.shaderEditorDisplay=document.getElementById("shaderEditorDisplay"),this.children.shaderSelect=document.getElementById("shaderEditor_loadShader");let m=document.getElementById("gui_shaderEditorFontSize");m.style.justifySelf="end",m.style.marginTop="2px",m.style.marginRight="3px",m.style.userSelect="none",m.style.display="flex",m.style.alignItems="center";let A=this;this.children.shaderSelect.onchange=x=>{A.updateShaderTextFields(this.children.shaderSelect.value)};let f=document.getElementById("gui_shaderEditorFontSmaller");f.onclick=x=>{A.shiftFontSize(-.15)};let C=document.getElementById("gui_shaderEditorFontLarger");C.onclick=x=>{A.shiftFontSize(.15)};let v=document.getElementById("gui_shaderEditorCloseButton");v.onclick=x=>{A.toggleShaderEditor()},this.children.updateObj.addEventListener("click",()=>{this.isEditing=!1;let b=document.getElementById("shaderEditor_uniformInput").value,I=document.getElementById("shaderEditor_vertInput"),E=I.value,B=document.getElementById("shaderEditor_fragInput"),w=B.value,D=document.createElement("div");D.innerHTML=b,b=D.innerText,D.innerHTML=E,E=D.innerText,D.innerHTML=w,w=D.innerText,A.pxlEnv.roomSceneList[A.pxlEnv.currentRoom].setShader(b,E,w),I.blur(),B.blur(),A.guiManager.pxlNavCanvas.focus()}),this.children.vertObj.onfocus=x=>{A.focusShaderMessage(x,"vertObj")},this.children.vertObj.onkeydown=x=>{A.keyShaderMessage(x)},this.children.vertObj.onmousedown=x=>{A.mDownShaderMessage(x)},this.children.vertObj.onclick=x=>{A.clickShaderMessage(x)},this.children.vertObj.ondblclick=x=>{A.dblclickShaderMessage(x)},this.children.fragObj.onfocus=x=>{A.focusShaderMessage(x,"fragObj")},this.children.fragObj.onkeydown=x=>{A.keyShaderMessage(x)},this.children.fragObj.onmousedown=x=>{A.mDownShaderMessage(x)},this.children.fragObj.onclick=x=>{A.clickShaderMessage(x)},this.children.fragObj.ondblclick=x=>{A.dblclickShaderMessage(x)},this.mouseX=0,this.mouseY=0,this.prevSelectStart=0,this.prevSelectEnd=0}shiftFontSize(e){let t=document.getElementById("gui_shaderEditorParent");if(!t)return;t.hasAttribute("styleStore")||t.setAttribute("styleStore",1);let r=parseFloat(t.getAttribute("styleStore"))+e;t.setAttribute("styleStore",r),t.style.fontSize=r+"em";let a=document.getElementById("shaderEditor_uniformInput");a&&(a.style.fontSize=r+"em");let o=document.getElementById("shaderEditor_vertInput");o&&(o.style.fontSize=r+"em");let n=document.getElementById("shaderEditor_fragInput");n&&(n.style.fontSize=r+"em"),setTimeout(()=>{this.resizeShaderElements()},130)}updateHeaderBar(){this.isEditing?(this.children.titleParentObj.style.fontSize="2.05em",this.children.titleObj.style.fontSize="1.15em"):(this.children.titleParentObj.style.fontSize="1.3em",this.children.titleObj.style.fontSize="1em")}mDownShaderMessage(e){this.mouseX=e.x,this.mouseY=e.y}clickShaderMessage(e){if(!this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.dcActive){let t=Math.abs(this.mouseX-e.x),i=Math.abs(this.mouseY-e.y);if(Math.max(t,i)<5){let r=e.target,a=r.selectionStart,o=r.selectionEnd;a!==o&&(this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.prevSelectStart=a,this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.prevSelectEnd=o)}}}dblclickShaderMessage(e){let t=this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.prevSelectStart,i=this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.prevSelectEnd,s=e.target,a=s.value.substring(t,i+20),o=a.match(/[a-zA-Z0-9._[\]]+/);o&&!a[0].match(/\n/)&&(i=t+o[0].length),s.setSelectionRange(t,i),this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.dcActive=!0,setTimeout(()=>{this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.dcActive=!1},500)}keyShaderMessage(e){if(e.repeat)return!1;let t=e.key,i=e.code,s=e.shiftKey,r=e.ctrlKey,a=i.includes("Numpad");if(!(t==="Enter"||t==="Tab"||i==="KeyD"&&r||i==="KeyK"&&r||a&&r||i.includes("Arrow")&&r))return!1;e.preventDefault();let n=e.target;if(i==="NumpadAdd"){let m=window.getComputedStyle(n),A=parseFloat(m.fontSize)+2;return n.style.fontSize=A,!1}if(i==="NumpadSubtract"){let m=window.getComputedStyle(n),A=parseFloat(m.fontSize)-2;return n.style.fontSize=A,!1}let h=n.selectionStart,u=n.selectionEnd,c=n.value;if(i.includes("Arrow")){if(h===u)return!1;let m=c.substring(h,u),A,f,C;if(i==="ArrowUp"?(f=c.substring(0,h),h=f.search(/.*$/),i="ArrowLeft"):i==="ArrowDown"&&(f=c.substring(u,c.length),u=f.search(/\n/)+u,i="ArrowRight"),i==="ArrowLeft"){A=new RegExp(m+".*","gm"),f=c.substring(0,h);let v=[...f.matchAll(m,"g")];if(v.length===0&&(v=[...c.matchAll(m,"g")],v.length===0))return!1;C=v.pop().index}if(i==="ArrowRight"){A=new RegExp(m,"m"),f=c.substring(u,c.length);let v=A.exec(f);if(v)C=v.index+u;else{if(v=A.exec(c),!v)return!1;C=v.index}}if(C>-1){let v=C+m.length;n.setSelectionRange(C,v);let x=n.getBoundingClientRect(),I=window.getComputedStyle(n).font,E=[c.slice(0,C),"<span id='tmpShaderPosition'>.</span>",c.slice(C)].join("");E=E.replace(/(?:\r\n|\r|\n)/g,"<br>");let B=document.createElement("div");B.style.position="fixed",B.style.width=x.width,B.style.height=x.height,B.style.overflowY="scroll",B.style.font=I,B.innerHTML=E,document.body.appendChild(B);let D=B.querySelector("#tmpShaderPosition").offsetTop-200;document.body.removeChild(B),n.scrollTo(0,D)}return!1}if(t==="Enter"&&r)return this.children.updateObj.click(),n.focus(),n.setSelectionRange(h,u),!1;if(a){let A=c.substring(h,u),f=A.length>0,C=c.substr(h-1,1);C=/[\w|\d]/.test(C)&&A.length===0?" ":"";let v=c.substr(u+1,1);v=/[\w|\d]/.test(v)&&A.length===0?" ":"";let x=h+C.length;if(i==="Numpad1"){let b="float(";x+=b.length,A=f?A:".0",A=b+A+")"}else if(i==="Numpad2"){let b="vec2(";x+=b.length,A=f?A:".0, .0",A=b+A+")"}else if(i==="Numpad3"){let b="vec3(";x+=b.length,A=f?A:".0, .0, .0",A=b+A+")"}return A=C+A+v,document.execCommand("insertText",!1,A),f||n.setSelectionRange(x,x),!1}let p=Math.min(h,u),d=c.substr(0,p);if(i==="KeyK"){let m=!1,A,f,C;if(h!==u&&(A=d.search(/.*$/),f=u,C=c.substring(A,u),m=/\n/.test(C)),!m){let v=d.search(/[\S\w].*$/);if(v===-1){if(v=c.substring(p,c.length).search(/(?:[^\s])/),v===-1)return!1;v+=p}let x=v,b=x,I="";if(s){if(b+=2,c.substr(x,2)!=="//")return!1;h-=2,u-=2}else{if(c.substr(x,2)==="//")return!1;I="//",h+=2,u+=2}return n.setSelectionRange(x,b),document.execCommand("insertText",!1,I),n.setSelectionRange(h,u),!1}if(m){let v=c.substring(f,c.length),x=f+v.search(/\n./),b=c.substring(A,x),I=s?-2:2,E=[...b.matchAll(/[\S\w].*/g)],B=[],w=h-A,D=f-A;return E.forEach(S=>{let P=S.index;B.push(P)}),B=B.reverse(),B.forEach(S=>{let P=b.substr(S,2);if(s){if(P!=="//")return;b=b.substring(0,S)+b.substring(S+2,b.length)}else{if(P==="//")return;b=b.substring(0,S)+"//"+b.substring(S,b.length)}h+=S<w?I:0,u+=S<D?I:0}),n.setSelectionRange(A,x),document.execCommand("insertText",!1,b),n.setSelectionRange(h,u),!1}return!1}let g=d.split(`
`);if(t==="Enter"||t==="Tab"){let m=g.pop();m.length===0&&(m=g.pop());let A=m.replace(/[\S\w].*$/g,"");t==="Tab"?(A=A.length===0?" ":A.substr(0,1),A===" "?A="  ":A="	"):A=`
`+A;let f=A,C=h,v=u;if(t==="Tab"&&h!==u){let x=c.substring(h,u);x=x.split(`
`),s?x=x.map(b=>b===""?b:b.replace(A,"")):x=x.map(b=>b===""?b:A+b),f=x.join(`
`),v=C+f.length}else C=C+f.length,v=C;return document.execCommand("insertText",!1,f),n.setSelectionRange(C,v),!1}if(i==="KeyD"&&r)if(h===u){let m=c.split(`
`);g.pop();let A=g.length,f=m[A],x=[...g,f].join(`
`).length;f=`
`+f,n.setSelectionRange(x,x),document.execCommand("insertText",!1,f),x=p+f.length,n.setSelectionRange(x,x)}else{let m=c.substring(h,u);n.setSelectionRange(u,u),document.execCommand("insertText",!1,m),u+=m.length,n.setSelectionRange(u,u)}return!1}updateShaderList(){let e=this.children.shaderSelect;if(!e){console.log("No Object shader pulldown found."),console.log(this.gui);return}let t=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].getShaderList(),i=Object.keys(t),s="",r=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].getCurrentShader();i.forEach(a=>{s+=`<option value="${a}" ${a===r?" selected":""}>${t[a]}</option>`}),e.innerHTML=s}resize(e){this.resizeShaderElements()}resizeShaderElements(){let e=0;if(this.hudBottomBar&&(e=this.hudBottomBar.offsetHeight),this.children.headerBar&&(e+=this.children.headerBar.offsetHeight),this.gui){this.gui.style.height=window.innerHeight-e;let t=this.children.vertObj.getBoundingClientRect().top,i=this.children.updateObj.getBoundingClientRect().height;i+=40;let s=window.innerHeight-i-t;this.children.vertObj.style.maxHeight=s*.4+"px",this.children.vertObj.displayHeight=s*.4,this.children.fragObj.style.maxHeight=s*.6+"px",this.children.fragObj.displayHeight=s*.6,this.children.fieldBodyHeight=s}}toggleShaderEditor(e=null){this.gui||this.buildShaderEditor(),this.updateShaderList(),this.updateShaderTextFields(this.children.shaderSelect.value),e=e===null?!this.active:e,this.active=e,this.guiManager.promptFader(this.gui,e),this.guiManager.promptFader(this.helpGui,e),this.pxlEnv.emit("shaderEditorVis",e),e?this.guiManager.pxlNavCanvas.addEventListener("mousedown",this.blurShaderEditor.bind(this)):this.guiManager.pxlNavCanvas.removeEventListener("mousedown",this.blurShaderEditor.bind(this)),setTimeout(()=>{this.resizeShaderElements()},130)}blurShaderEditor(){this.isEditing=!1,document.activeElement.blur();let e=document.getElementById("guiShaderEditorBlock");e.style.maxWidth=this.editorWidthMinMax.min+"vw";let t=document.getElementById("gui_shaderHelpBlock");t&&(t.style.left="max("+this.editorWidthMinMax.min+"vw, 430px)");let i=document.getElementById("shaderEditor_loadShader");i&&(i.style.maxWidth="85px"),this.disconnectFocusListener(),this.updateHeaderBar(),setTimeout(()=>{this.resizeShaderElements()},130)}focusShaderMessage(e,t){var h;this.isEditing=!0;let i=this.children,s=i.vertObj.displayHeight,r=i.fragObj.displayHeight,a=Math.max(150,window.innerHeight*.135),o=i.fieldBodyHeight-a;s=t==="vertObj"?o:a,r=t==="fragObj"?o:a,i.vertObj.style.maxHeight=s+"px",i.fragObj.style.maxHeight=r+"px",this.gui.style.maxWidth=this.editorWidthMinMax.max+"vw",(h=this.children)!=null&&h.shaderSelect&&(this.children.shaderSelect.style.maxWidth="225px");let n=document.getElementById("gui_shaderHelpBlock");n&&(n.style.left=this.editorWidthMinMax.max+"vw"),this.connectFocusListener(),this.updateHeaderBar()}clickThroughCheck(e){let t=e.x,i=e.y,s=document.elementsFromPoint(t,i);for(let r=0;r<s.length;++r)if(s[r].id==="gui_shaderEditorParent")return;this.blurShaderEditor()}connectFocusListener(){document.addEventListener("mousedown",this.clickThroughListener)}disconnectFocusListener(){document.removeEventListener("mousedown",this.clickThroughListener)}};var Ji=class extends Yi{constructor(e,t="Metal-Asylum",i="images/assets/",s="images/GUI/"){super(e,t,i,s),this.verbose=e,this.lableBoxSize=40,this.optionWidthRound=10,this.optionWidthAdd=25,this.deviceOptionHeight=[0,300],this.ShaderEditor=null,this.pxlLoaderTotal=5,this.hudVisibility=!0,this.camChoicesActive=!1,this.micChoicesActive=!1,this.textDescriptions={chatIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">C</span> )</span><br>chat',pos:[1,-1.5]},multiverseIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">U</span> )</span><br>multiverse<br>selection',pos:[0,-1.3]},djPlayerVolumeParent:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">B</span> )</span><br>music volume',pos:[0,-1.5]},speakerIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">N</span> )</span><br>mute people<br>pick audio output',pos:[0,-1.5]},micIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">M</span> )</span><br>mute/pick<br>mic input',pos:[0,-1.5]},camIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">V</span> )</span><br>enable/pick<br>video input',pos:[0,-1.5]},helpIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">?</span> )</span><br>help &<br>instructions',pos:[0,-1.5]},infoIconParent:{text:'Info <span class="helpHotKeyParent">( <span class="helpHotKey">I</span> )</span>',pos:[-1,0],offset:[-10,0]},settingsIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">G</span> )</span><br>graphics &<br>navigation',pos:[0,-1.5]},muteAllIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">N</span> )</span><br>mute all users',pos:[1,0]},fullScreenIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">F</span> )</span><br>toggle full screen',pos:[-1,0]},videoQualityIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">H</span> )</span><br>video quality settings',pos:[-1,0]},statsIcon:{text:"jitsi connection status; toggle connection ",pos:[1,0]},usersIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">T</span> )</span> user moderator tools',pos:[1,0]},ft2Button:{text:"Environment",pos:[-1,0],offset:[-10,0]},ft3Button:{text:"Invite Friends",pos:[-1,0],offset:[-10,0]},hud_userCount:{text:"# of People",pos:[-1,0],offset:[-10,0]}},this.activeItem=null,this.actionPopUp=null,this.init()}setDependencies(e){super.setDependencies(e),this.ShaderEditor=new Xi(e,this)}init(){super.init()}booted(){super.booted()}step(){super.step()}toggleShaderEditor(){this.ShaderEditor.toggleShaderEditor()}resize(e){super.resize(),this.ShaderEditor&&this.ShaderEditor.resize(e)}};var Se=class{constructor(e="hudRegion",t={}){this.name=e,this.object=null,this.type=ne.REGION,this.pxlOptions=null,this.pxlEnums=null,this.pxlDevice=null,this.touchId=-1,this.isDown=!1,this.isDragging=!1,this.dragCount=0,this.dragThreshold=10,this.startPos=null,this.currentPos=null,this.previousPos=null,this.startDelta={x:0,y:0},this.stepDelta={x:0,y:0},this.defaultObject={pos:{x:0,y:0},bbox:{width:0,height:0},draw:Xr.DEFAULT,style:[],objectStyles:[],objectStyleKeys:[]},this.defaultObjectStyleEntry={object:"parent",base:["pxlNav-hudElement-thumbstick-default"],hover:["pxlNav-hudElement-thumbstick-hover"],active:["pxlNav-hudElement-thumbstick-active"]},typeof t!="object"&&(t={}),t=Object.assign(this.defaultObject,t),t.objectStyles.length>0&&t.objectStyles.forEach(i=>{t.objectStyleKeys.push(i.object)}),this.data=t,this.callbacks=[]}setDependencies(e){this.pxlOptions=e.pxlOptions,this.pxlEnums=e.pxlEnums,this.pxlDevice=e.pxlDevice}build(){let e=this.createMainElement();return e.classList.add("pxlNav-hudElement-region"),this.object=e,this.object.ontouchstart=this.ontouchstart.bind(this),this.object.ontouchend=this.ontouchend.bind(this),e}createMainElement(){let e=document.createElement("div");return this.data.hasOwnProperty("id")&&(e.id=this.data.id),this.data.hasOwnProperty("style")&&this.data.style.forEach(t=>{e.classList.add(t)}),this.object=e,e}ontouchstart(e){this.emit(!0)}ontouchmove(e){}ontouchend(e){this.emit(!1)}updateStyle(){}subscribe(e){this.callbacks.push(e)}emit(e){this.callbacks.forEach(function(t){t(e)})}};var Zi=class extends Se{constructor(e="hudDrawRegion",t={}){super(e,t),this.type=ne.DRAG_REGION,this.dragThreshold=10}build(){let e=this.createMainElement();return e.classList.add("pxlNav-hudElement-dragRegion"),e}ontouchstart(e){}ontouchmove(e){}ontouchend(e){}};var $i=class extends Se{constructor(e,t={}){super(e,t),this.type=ne.THUMBSTICK,this.block=null,this.currentState=ft.NONE,this.innerObj=null,this.blockStyleOverrides=null,this.parentStyleOverrides=null,this.innerStyleOverrides=null}build(){let e=this.createMainElement();e.classList.add("pxlNav-hudElement-thumbstick-block");let t=document.createElement("div");t.classList.add("pxlNav-hudElement-thumbstick"),e.appendChild(t);let i=document.createElement("div");if(i.classList.add("pxlNav-hudElement-thumbstick-inner"),t.appendChild(i),e.ontouchstart=this.ontouchstart.bind(this),e.ontouchmove=this.ontouchmove.bind(this),e.ontouchend=this.ontouchend.bind(this),this.block=e,this.object=t,this.innerObj=i,this.data.hasOwnProperty("objectStyleKeys")&&this.data.objectStyleKeys.length>0){let s=this.data.objectStyleKeys.indexOf("block"),r=this.data.objectStyleKeys.indexOf("parent"),a=this.data.objectStyleKeys.indexOf("inner");s>=0&&(this.blockStyleOverrides=this.data.objectStyles[s],this.blockStyleOverrides.currentAction=this.pxlEnums.HUD_ACTION.NONE,this.blockStyleOverrides[this.pxlEnums.HUD_ACTION.NONE].forEach(o=>{e.classList.add(o)})),r>=0&&(this.parentStyleOverrides=this.data.objectStyles[r],this.parentStyleOverrides.currentAction=this.pxlEnums.HUD_ACTION.NONE,this.parentStyleOverrides[this.pxlEnums.HUD_ACTION.NONE].forEach(o=>{t.classList.add(o)})),a>=0&&(this.innerStyleOverrides=this.data.objectStyles[a],this.innerStyleOverrides.currentAction=this.pxlEnums.HUD_ACTION.NONE,this.innerStyleOverrides[this.pxlEnums.HUD_ACTION.NONE].forEach(o=>{i.classList.add(o)}))}return e}getTouchId(e){if(!e.touches||e.touches.length<1)return-1;if(e.touches.length===1)return e.touches[0].identifier;let t=null;for(let i=0;i<e.touches.length;++i){let s=e.touches[i];if(s.target===this.block){t=s.identifier;break}}return t}getTouchInfo(e){if(this.touchId===-1||!e.touches||e.touches.length<1)return null;let t=null;for(let i=0;i<e.touches.length;++i)if(e.touches[i].identifier===this.touchId){t=e.touches[i];break}return t}ontouchstart(e){e.preventDefault(),e.stopPropagation(),this.isDown=!0,this.isDragging=!1,this.dragCount=-1,this.touchId=this.getTouchId(e);let t=this.getTouchInfo(e);t&&(this.startPos={x:t.clientX,y:t.clientY},this.updateStyle())}ontouchmove(e){var t,i;if(e.preventDefault(),e.stopPropagation(),this.isDown){this.dragCount++,this.isDragging||(Math.abs(this.startDelta.x)>this.pxlOptions.userSettings.deadZone.touch||Math.abs(this.startDelta.y)>this.pxlOptions.userSettings.deadZone.touch)&&(this.isDragging=!0);let s=this.getTouchInfo(e);if(!s)return;let r=((t=this.currentPos)==null?void 0:t.x)||s.clientX,a=((i=this.currentPos)==null?void 0:i.y)||s.clientY;this.previousPos={x:r,y:a},this.currentPos={x:s.clientX,y:s.clientY},this.startDelta={x:this.currentPos.x-this.startPos.x,y:this.currentPos.y-this.startPos.y},this.stepDelta={x:this.currentPos.x-this.previousPos.x,y:this.currentPos.y-this.previousPos.y},this.emit({startPos:this.startPos,previousPos:this.previousPos,currentPos:this.currentPos,startDelta:this.startDelta,stepDelta:this.stepDelta,dragCount:this.dragCount,status:!0}),this.updateStyle()}}ontouchend(e){e.preventDefault(),e.stopPropagation(),this.emit({startPos:this.startPos,previousPos:this.previousPos,currentPos:Object.assign({},this.currentPos),startDelta:this.startDelta,stepDelta:this.stepDelta,dragCount:this.dragCount,status:!1}),this.touchId=-1,this.isDown=!1,this.isDragging=!1,this.dragCount=-1,this.currentPos=null,this.startPos=null,this.prevPos=null,this.updateStyle()}updateStyle(){if(!(!this.innerObj||!this.object))if(this.isDown&&!this.isDragging)this.blockStyleOverrides&&this.toggleStyle(this.pxlEnums.HUD_ACTION.HOVER,this.blockStyleOverrides),this.parentStyleOverrides&&this.toggleStyle(this.pxlEnums.HUD_ACTION.HOVER,this.parentStyleOverrides),this.innerStyleOverrides&&this.toggleStyle(this.pxlEnums.HUD_ACTION.HOVER,this.innerStyleOverrides),this.innerObj.style.left="0px",this.innerObj.style.top="0px",this.currentState=ft.HOVER;else if(this.isDragging){if(this.blockStyleOverrides&&this.toggleStyle(this.pxlEnums.HUD_ACTION.ACTIVE,this.blockStyleOverrides),this.parentStyleOverrides&&this.toggleStyle(this.pxlEnums.HUD_ACTION.ACTIVE,this.parentStyleOverrides),this.innerStyleOverrides&&this.toggleStyle(this.pxlEnums.HUD_ACTION.ACTIVE,this.innerStyleOverrides),this.currentState!==ft.ACTIVE){let s=this.object.getBoundingClientRect(),r=s.width/2+s.left,a=s.height/2+s.top,o=Math.max(-this.pxlDevice.sW*.085,Math.min(this.pxlDevice.sW*.085,this.startPos.x-r)),n=Math.max(-this.pxlDevice.sH*.095,this.startPos.y-a);this.object.style.left=o+"px",this.object.style.top=n+"px"}let e=this.startDelta.x,t=this.startDelta.y,i=Math.max((e**2+t**2)**.5,1);i>80&&(e=e/i*80,t=t/i*80),this.innerObj.style.left=e+"px",this.innerObj.style.top=t+"px",this.currentState=ft.ACTIVE}else this.blockStyleOverrides&&this.toggleStyle(this.pxlEnums.HUD_ACTION.NONE,this.blockStyleOverrides),this.parentStyleOverrides&&this.toggleStyle(this.pxlEnums.HUD_ACTION.NONE,this.parentStyleOverrides),this.innerStyleOverrides&&this.toggleStyle(this.pxlEnums.HUD_ACTION.NONE,this.innerStyleOverrides),this.innerObj.style.left="0px",this.innerObj.style.top="0px",this.object.style.left="0px",this.object.style.top="0px",this.currentState=ft.NONE}toggleStyle(e,t){if(e===t.currentAction)return;let i=[this.pxlEnums.HUD_ACTION.NONE,this.pxlEnums.HUD_ACTION.HOVER,this.pxlEnums.HUD_ACTION.ACTIVE],s=i.indexOf(e),r=null;t.object==="block"?r=this.block:t.object==="parent"?r=this.object:t.object==="inner"&&(r=this.innerObj),i.forEach((a,o)=>{o!==s?t[a].forEach(n=>{r.classList.remove(n)}):t[a].forEach(n=>{r.classList.add(n)})}),t.currentAction=e}subscribe(e){this.callbacks.push(e)}};var es=class{constructor(){this.pxlOptions=null,this.pxlEnums=null,this.pxlGuiDraws=null,this.pxlDevice=null,this.hudParent=null,this.huds={},this.mobileHUD={}}setDependencies(e){this.pxlOptions=e.pxlOptions,this.pxlEnums=e.pxlEnums,this.pxlGuiDraws=e.pxlGuiDraws,this.pxlDevice=e.pxlDevice}init(){let e=document.createElement("div");e.classList.add("pxlNav-hud-parent"),this.pxlGuiDraws.addToContainer(e),this.hudParent=e,this.pxlOptions.mobile&&!this.pxlOptions.staticCamera&&(e.classList.add("pxlNav-hud-parent-mobile"),this.createMobileHUD())}addToHUD(e){e.hasOwnProperty("block")&&e.block!==null?this.hudParent.appendChild(e.block):(e==null?void 0:e.object)!==null?this.hudParent.appendChild(e.object):this.hudParent.appendChild(e)}addItem(e="default",t,i,s=null,r=null){this.huds.hasOwnProperty(e)||(this.huds[e]=[]);let a=null;switch(t){case ne.REGION:a=this.createRegion(e,i,s,r),this.huds[e].push(a);break;case ne.DRAG_REGION:a=this.createDragRegion(e,i,s,r),this.huds[e].push(a);break;case ne.BUTTON:a=this.createButton(e,i,s,r),this.huds[e].push(a);break;case ne.THUMBSTICK:a=this.createThumbstick(e,i,s,r),this.huds[e].push(a);break;case ne.SLIDER:a=this.createSlider(e,i,s,r),this.huds[e].push(a);break;case ne.IMAGE:a=this.createImage(e,i,s,r),this.huds[e].push(a);break;case ne.TEXT:a=this.createText(e,i,s,r),this.huds[e].push(a);break;default:break}return a!==null&&(r!==null?r.appendChild(a.object):this.addToHUD(a),s!==null&&a.subscribe(s)),a}createRegion(e,t,i=null,s=null){let r=new Se(e,t);return r.setDependencies({pxlOptions:this.pxlOptions,pxlEnums:this.pxlEnums,pxlDevice:this.pxlDevice}),r.build(),i!==null&&r.subscribe(i),s!==null&&s.appendChild(r.object),r}createDragRegion(e,t,i=null,s=null){let r=new Zi(e,t);return r.setDependencies({pxlOptions:this.pxlOptions,pxlEnums:this.pxlEnums,pxlDevice:this.pxlDevice}),r.build(),i!==null&&r.subscribe(i),s!==null&&s.appendChild(r.object),r}createButton(e,t,i=null,s=null){let r=new Se(e,t);return r.setDependencies({pxlOptions:this.pxlOptions,pxlEnums:this.pxlEnums,pxlDevice:this.pxlDevice}),r.build(),i!==null&&r.subscribe(i),s!==null&&s.appendChild(r.object),r}createThumbstick(e,t,i=null){let s=new $i(e,t);return s.setDependencies({pxlOptions:this.pxlOptions,pxlEnums:this.pxlEnums,pxlDevice:this.pxlDevice}),s.build(),i!==null&&s.subscribe(i),s}createSlider(e,t,i=null,s=null){let r=new Se(e,t);return r.setDependencies({pxlOptions:this.pxlOptions,pxlEnums:this.pxlEnums,pxlDevice:this.pxlDevice}),r.build(),i!==null&&r.subscribe(i),s!==null&&s.appendChild(r.object),r}createImage(e,t,i=null,s=null){let r=new Se(e,t);return r.setDependencies({pxlOptions:this.pxlOptions,pxlEnums:this.pxlEnums,pxlDevice:this.pxlDevice}),r.build(),i!==null&&r.subscribe(i),s!==null&&s.appendChild(r.object),r}createText(e,t,i=null,s=null){let r=new Se(e,t);return r.setDependencies({pxlOptions:this.pxlOptions,pxlEnums:this.pxlEnums,pxlDevice:this.pxlDevice}),r.build(),i!==null&&r.subscribe(i),s!==null&&s.appendChild(r.object),r}createMobileHUD(){let e="",t="",i={},s=document.createElement("div");s.classList.add("pxlNav-hudMobile-parent"),s.classList.add(),this.hudParent.appendChild(s);let r=this.pxlEnums.HUD_ACTION.NONE,a=this.pxlEnums.HUD_ACTION.HOVER,o=this.pxlEnums.HUD_ACTION.ACTIVE;e="thumbstick_left",i={style:["pxlNav-hudMobile-joystick-left"],objectStyles:[{object:"block"},{object:"parent"},{object:"inner"}]},i.objectStyles[0][r]=["pxlNav-hudElement-thumbstick-block-default"],i.objectStyles[0][a]=["pxlNav-hudElement-thumbstick-block-hover"],i.objectStyles[0][o]=["pxlNav-hudElement-thumbstick-block-active"],i.objectStyles[1][r]=["pxlNav-hudElement-thumbstick-default"],i.objectStyles[1][a]=["pxlNav-hudElement-thumbstick-hover"],i.objectStyles[1][o]=["pxlNav-hudElement-thumbstick-active","pxlNav-hudElement-thumbstick-left"],i.objectStyles[2][r]=["pxlNav-hudElement-thumbstick-inner-default"],i.objectStyles[2][a]=["pxlNav-hudElement-thumbstick-inner-hover"],i.objectStyles[2][o]=["pxlNav-hudElement-thumbstick-inner-active"],t=this.addItem(e,ne.THUMBSTICK,Object.assign({},i)),t.subscribe(n=>{this.mobileDeligate(Dt.MOVE,n)}),this.mobileHUD[e]=t,e="thumbstick_right",i=Object.assign({},i),i.style=["pxlNav-hudMobile-joystick-right"],i.objectStyles[1]={object:"parent"},i.objectStyles[1][r]=["pxlNav-hudElement-thumbstick-default"],i.objectStyles[1][a]=["pxlNav-hudElement-thumbstick-hover"],i.objectStyles[1][o]=["pxlNav-hudElement-thumbstick-active","pxlNav-hudElement-thumbstick-right"],t=this.addItem(e,ne.THUMBSTICK,i),t.subscribe(n=>{this.mobileDeligate(Dt.LOOK,n)}),this.mobileHUD[e]=t,e="mobile_jump",i={style:["pxlNav-hudMobile-region-jump"]},t=this.addItem(e,ne.REGION,i,n=>{this.mobileDeligate(Dt.JUMP,{},n)}),this.mobileHUD.jump=t,e="mobile_ACTION",i={style:["pxlNav-hudMobile-region-action"]},t=this.addItem(e,ne.REGION,i),t.subscribe(n=>{this.mobileDeligate(Dt.ACTION,n)}),this.mobileHUD.item=t}mobileDeligate(e,t={},i=!0){this.pxlDevice.deviceAction(e,t,i)}subscribe(e,t){this.huds.hasOwnProperty(e)&&(this.huds[e].hasOwnProperty("callbacks")||(this.huds[e].callbacks=[]),this.huds[e].callbacks.push(t))}emit(e,t){this.huds.hasOwnProperty(e)&&this.huds[e].hasOwnProperty("callbacks")&&this.huds[e].callbacks.forEach(i=>{i(t)})}};import{Vector2 as ts,Vector3 as J,Quaternion as Ye,Euler as is}from"three";var ss=class{constructor(){this.standingHeight=1.75,this.movementScalar=1,this.hasMovementLimit=!0,this.movementMax=100,this.jumpScalar=1,this.userScale=1,this.maxStepHeight=5,this.cameraEasing=[.55,.45],this.touchMaxSensitivity=800,this.cameraJumpImpulse=[.75,1.5],this.cameraMaxJumpHold=[2.85,2],this.gravityCount=0,this.gravityRate=0,this.gravityMax=15.5,this.gravityUPS=[.3,.15],this.pxlAudio=null,this.pxlTimer=null,this.pxlAutoCam=null,this.pxlRendering=null,this.pxlEnv=null,this.pxlColliders=null,this.pxlUser=null,this.pxlUtils=null,this.pxlDevice=null,this.pxlGuiDraws=null,this.pxlQuality=null,this.pxlOptions=null,this.socket=null,this.camera=null,this.canMove=!0,this.HDRView=!1,this.camUpdated=!0,this.cameraBooted=!1,this.hasMoved=!1,this.hasRotated=!1,this.hasJumped=!1,this.hasJumpLock=!1,this.hasGravity=!1,this.userInputMoveScalar={x:1,y:1},this.userInputLookScalar=1,this.roomStandingHeight={default:this.standingHeight},this.standingHeightGravInfluence=0,this.standingMaxGravityOffset=.5,this.walkBounceSeed=230,this.walkBounceHeight=.3,this.walkBounce=0,this.walkBouncePerc=0,this.walkBounceRate=.025,this.walkBounceEaseIn=.03,this.walkBounceEaseOut=.95,this.posRotEasingThreshold=.01,this.cameraMovement=[0,0],this.cameraMovementEase=.85,this.cameraMoveLength=0,this.cameraMoveLengthMult=.1,this.camPosBlend=.65,this.camRotXYZ=new J(0,0,0),this.camRotPitch=new ts(0,0),this.cameraJumpActive=!1,this.cameraAllowJump=!0,this.cameraJumpHeight=0,this.cameraJumpVelocity=0,this.cameraJumpVelocityEaseOut=.9,this.cameraJumpInAir=!1,this.floorColliderInitialHit=!1,this.colliderValidityChecked=!0,this.nearestFloorHit=new J(0,0,0),this.nearestFloorObjName=null,this.nearestFloorHitPrev=new J(0,0,0),this.nearestFloorObjNamePrev=null,this.gravitySourceActive=!1,this.gravityDirection=new J(0,-1,0),this.gravityEaseOutRate=.5,this.jump=0,this.releaseJumpLockTime=0,this.releaseJumpLockDelay=.08,this.runMain=!0,this.workerActive=!1,this.worker=null,this.workerTransfers=!1,this.workerMessage=()=>{},this.workerFunc=()=>{},this.deviceKey=()=>{},this.portalList={},this.roomWarpZone=[],this.colliderCurObjHit=null,this.colliderPrevObjHit=null,this.colliderValid=!1,this.colliderFail=!1,this.warpActive=!1,this.warpType=0,this.warpObj=null,this.warpTarget=null,this.hotKeyTriggered=!1,this.eventCheckStatus=!1,this.proximityScaleTrigger=!1,this.colliderShiftActive=!0,this.colliderAdjustPerc=0,this.colliderAdjustRate=.02,this.gyroGravity=[0,0,0],this.cameraPose={alpha:null,beta:null,gamma:null,alphaOffset:0,betaOffset:0,gammaOffset:0,orientation:window.orientation||0,pos:[0,0,0],posOffset:[0,0,0],rx:()=>this.beta,ry:()=>this.alpha,rz:()=>this.gamma,accelZeroed:[0,0,0],accelCalibration:10,accelCalDiv:1/10,accelCalCount:0,accelTotal:[0,0,0],accelPrev:null,accelDelta:[0,0,0],accelClearDelta:()=>{this.accelDelta=[0,0,0]}},this.uniformScalars={curExp:1,darkBase:.1,brightBase:.5,exposureUniformBase:1},this.cameraPosLookAtNames={default:{pos:"position",lookAt:"lookat"},mobile:{pos:"positionmobile",lookAt:"lookatmobile"},vr:{pos:"positionvr",lookAt:"lookatvr"}},this.cameraPos=new J(0,0,0),this.cameraPrevPos=new J(0,0,0),this.cameraPrevLookAt=new J(0,0,0),this.cameraAim=new J(0,0,1),this.cameraAimTarget=new J(0,0,0),this.cameraCross=new J(1,0,0),this.lookAtTargetActive=new J(0,0,0),this.lookAtPerc=new ts(1,0),this.lookAtLockPerc=0,this.lookAtLockFader=0,this.lookAtLockFadeRate=.01,this.prevQuaternion=new Ye,this.pi=3.141592653589793,this.touchSensitivityLimits=this.touchMaxSensitivity*this.pi,this.callbacks={},this.init()}setDependencies(e){this.pxlAudio=e.pxlAudio,this.pxlTimer=e.pxlTimer,this.pxlAutoCam=e.pxlAutoCam,this.pxlRendering=e.pxlRendering,this.pxlEnv=e.pxlEnv,this.pxlColliders=e.pxlColliders,this.pxlUser=e.pxlUser,this.pxlUtils=e.pxlUtils,this.pxlDevice=e.pxlDevice,this.pxlGuiDraws=e.pxlGuiDraws,this.pxlQuality=e.pxlQuality,this.pxlOptions=e.pxlOptions,this.socket=e.socket}log(e){this.verbose>=te.INFO&&console.log(e)}warn(e){this.verbose>=te.WARN&&console.warn(e)}error(e){this.verbose>=te.ERROR&&console.error(e)}init(){var e}updateMainValues(e){let{gravityRate:t,standingHeightGravInfluence:i,cameraJumpImpulse:s}=e;t!=null&&(this.gravityRate=t),i!=null&&(this.standingHeightGravInfluence=i),s!=null&&(this.cameraJumpVelocity+=s),this.camUpdated=!0}setUserHeight(e,t="default"){e=Math.max(e,.01),this.roomStandingHeight.hasOwnProperty(t)||(this.roomStandingHeight[t]=this.standingHeight),t==="default"&&(this.standingHeight=e),this.roomStandingHeight[t]=e}setMaxStepHeight(e){e=Math.max(e,.01),this.maxStepHeight=e}setUserScale(e){e=Math.max(e,.01),this.userScale=e}setMovementScalar(e){e=Math.max(e,.01),this.movementScalar=e}setMovementMax(e){e=Math.max(e,.01),this.movementMax=e}setMovementEase(e){e=Math.min(1,Math.max(e,.01)),this.cameraMovementEase=e}setPositionBlend(e){e=Math.min(1,Math.max(e,.01)),this.camPosBlend=e}setInputMovementMult(e){e=Math.max(e,.01),this.cameraMoveLengthMult=e}setJumpScalar(e){e=Math.max(e,.01),this.jumpScalar=e}setJumpImpulse(e){e=Math.max(e,.01),this.cameraJumpImpulse[0]=e}setJumpHoldMax(e){e=Math.max(e,.01),this.cameraMaxJumpHold[0]=e}setJumpRepeatDelay(e){e=Math.max(e,.01),this.releaseJumpLockDelay=e}setCameraRotateEasing(e){Array.isArray(e)||(typeof e=="number"?(e=[e,e],this.warn("Warning : Camera.setCameraEasing() expects an array of two numeric values, [PC Easing 0-1, Mobile Easing 0-1]; Default is [.55,.45]")):this.error("Error : Camera.setCameraEasing() unexpected values type; expecting an array of two numeric values, [PC Easing 0-1, Mobile Easing 0-1]; Default is [.55,.45]")),this.cameraEasing=e}setTouchSensitivity(e){e<=0&&(e=1),this.touchMaxSensitivity=e,this.touchSensitivityLimits=this.touchMaxSensitivity*this.pi}setGravityRate(e){e<=0&&(e=1),this.gravityRate=e}setGravityMax(e){e<=0&&(e=1),this.gravityMax=e}setWalkBounceHeight(e){e<=0&&(e=0),this.walkBounceHeight=e}setWalkBounceRate(e){e<=0&&(e=1e-4),this.walkBounceRate=e}setWalkBounceEaseIn(e){e=Math.min(1,Math.max(e,1e-4)),this.walkBounceEaseIn=e}setWalkBounceEaseOut(e){e=Math.min(1,Math.max(e,.01)),this.walkBounceEaseOut=e}setUserSettings(e){e.hasOwnProperty("height")&&(e.height.hasOwnProperty("standing")&&this.setUserHeight(e.height.standing),e.height.hasOwnProperty("stepSize")&&this.setMaxStepHeight(e.height.stepSize)),e.hasOwnProperty("movement")&&(e.movement.hasOwnProperty("scalar")&&this.setMovementScalar(e.movement.scalar),e.movement.hasOwnProperty("max")&&this.setMovementMax(e.movement.max),e.movement.hasOwnProperty("easing")&&this.setMovementEase(e.movement.easing)),e.hasOwnProperty("headBounce")&&(e.headBounce.hasOwnProperty("height")&&this.setWalkBounceHeight(e.headBounce.height),e.headBounce.hasOwnProperty("rate")&&this.setWalkBounceRate(e.headBounce.rate),e.headBounce.hasOwnProperty("easeIn")&&this.setWalkBounceEaseIn(e.headBounce.easeIn),e.headBounce.hasOwnProperty("easeOut")&&this.setWalkBounceEaseOut(e.headBounce.easeOut)),e.hasOwnProperty("jump")&&(e.jump.hasOwnProperty("impulse")&&this.setJumpScalar(e.jump.impulse),e.jump.hasOwnProperty("holdMax")&&this.setJumpHoldMax(e.jump.holdMax),e.jump.hasOwnProperty("repeatDelay")&&this.setJumpRepeatDelay(e.jump.repeatDelay)),e.hasOwnProperty("gravity")&&(e.gravity.hasOwnProperty("ups")&&this.setGravityRate(e.gravity.ups),e.gravity.hasOwnProperty("max")&&this.setGravityMax(e.gravity.max))}step(){this.pxlDevice.directionKeyDown&&this.updateMovement(this.pxlTimer.prevMS),this.runMain&&(this.hasJumpLock&&this.pxlTimer.runtime>this.releaseJumpLockTime&&(this.hasJumpLock=!1,this.hasGravity=!1,this.cameraAllowJump=!0,this.camInitJump()),this.hasGravity&&this.cameraJumpActive?this.camJump(this.pxlTimer.prevMS):this.cameraJumpVelocity>0&&this.killJumpImpulse()),this.camUpdated=this.camUpdated||this.hasMoved||this.hasRotated||this.hasGravity||this.cameraMovement[0]!==0||this.cameraMovement[1]!==0,this.updateCamera(),this.lowQualityUpdates(),this.midQualityUpdates(),this.eventCheck()}eventCheck(){this.colliderValid&&this.eventCheckStatus&&this.eventTrigger(this.nearestFloorObjName)&&this.warpEventTriggered(1,this.nearestFloorObjName)}updateDeviceValues(e){if(!this.pxlQuality.settings.leftRight){let t=-this.cameraMovement[0];this.pxlDevice.touchMouseData.active||(this.pxlDevice.touchMouseData.velocity.x+=t),this.pxlDevice.touchMouseData.netDistance.x+=t*4}if(this.pxlDevice.touchMouseData.velocity!=null&&!this.pxlDevice.mobile){if(e<this.posRotEasingThreshold)this.pxlDevice.touchMouseData.velocity.multiplyScalar(0);else{let t=this.cameraEasing[this.pxlDevice.mobile?1:0];this.pxlDevice.touchMouseData.velocity.multiplyScalar(t)}this.pxlDevice.touchMouseData.netDistance.add(this.pxlDevice.touchMouseData.velocity.clone().multiply(this.pxlDevice.touchMouseData.moveMult))}}buildDeviceMonitors(){}updateCameraMatrices(){this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.updateWorldMatrix()}resetCameraCalculations(e){this.cameraMovement[0]=0,this.cameraMovement[1]=0,this.pxlDevice.touchMouseData.curFadeOut.multiplyScalar(0),this.pxlDevice.touchMouseData.velocity.multiplyScalar(0),this.pxlDevice.touchMouseData.netDistance.set(0,0),e===null&&(e=this.camera.position.clone()),this.camera.position.copy(e),this.updateCameraMatrices(),this.cameraPos.copy(e),this.cameraPrevPos.copy(e),this.colliderCurObjHit=null,this.colliderPrevObjHit=null,this.camUpdated=!0,this.hasMoved=!0}setFOV(e){this.camera.fov=e,this.camera.updateProjectionMatrix(),this.camUpdated=!0}setStats(e,t,i,s){this.camera.near=i,this.camera.far=s,this.setFOV(e)}setAspect(e){this.camera.aspect=e,this.camera.updateProjectionMatrix()}setTransform(e,t=null){this.resetCameraCalculations(e),t&&(this.cameraAimTarget.position.copy(t),this.camera.lookAt(t),this.cameraPrevLookAt.copy(t),this.updateCameraMatrices(),this.pxlDevice.touchMouseData.initialQuat=this.camera.quaternion.clone()),this.resetGravity(),this.camUpdated=!0}setToObj(e,t=null){if(this.resetCameraCalculations(e.position),t){let i=t.position.clone();this.cameraAimTarget.position.copy(i),this.camera.lookAt(i),this.cameraPrevLookAt.copy(i),this.updateCameraMatrices(),this.pxlDevice.touchMouseData.initialQuat=this.camera.quaternion.clone()}else this.pxlDevice.touchMouseData.initialQuat=e.quaternion.clone(),this.camera.setRotationFromQuaternion(this.pxlDevice.touchMouseData.initialQuat),this.updateCameraMatrices();this.resetGravity(),this.camUpdated=!0,this.hasMoved=!0,this.hasRotated=!0,this.colliderCheck(e.position),this.nearestFloorObjName=null}warpToRoom(e,t=!1,i=null){let s=Object.keys(this.pxlEnv.roomSceneList),r=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom];i=i||r.defaultCamLocation||"",i=i.toLowerCase(),typeof e=="object"&&(e=e.roomName||this.pxlEnv.currentRoom);let a=(e||"").toLowerCase(),o=this.pxlEnv.roomSceneList.hasOwnProperty(this.pxlEnv.currentRoom);r&&!s.includes(e)&&r.camLocation.hasOwnProperty(a)?(i=a,e=this.pxlEnv.currentRoom):(o&&this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].stop(),r=this.pxlEnv.roomSceneList[e]);let n=this.pxlEnv.currentRoom,h=!1;o&&this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].hasOwnProperty("camHoldWarpPos")&&(h=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].camHoldWarpPos),this.pxlEnv.currentRoom=e,this.pxlAutoCam.curRoom=e;let u=e===this.pxlEnv.mainRoom;if(this.pxlUser.iZoom){let d=u?this.pxlEnv.roomComposer:this.pxlEnv.mapComposer,g=u?this.pxlEnv.mapComposer:this.pxlEnv.roomComposer;this.pxlEnv.delayPass.uniforms.tDiffusePrev.value=d.renderTarget1.texture,this.pxlEnv.delayPass.uniforms.tDiffusePrevRoom.value=g.renderTarget1.texture,setTimeout(()=>{n!==e&&(u?this.pxlEnv.roomComposer.reset():this.pxlEnv.mapComposer.reset()),setTimeout(()=>{this.pxlEnv.mapComposerWarpPass.needsSwap=!1},500)},100)}if(t){if(!r){this.warn("pxlCamera.warpToRoom(); pxlRoom not found - "+this.pxlEnv.currentRoom);return}e!==n&&r.start(),this.pxlRendering.roomRenderPass.scene=r.scene;let d=i.toLowerCase();if(r.camLocation.hasOwnProperty(d)){let g=this.cameraPosLookAtNames.default.pos,m=this.cameraPosLookAtNames.default.lookAt;this.pxlDevice.mobile&&(r.camLocation[d].hasOwnProperty(this.cameraPosLookAtNames.mobile.pos)&&(g=this.cameraPosLookAtNames.mobile.pos),r.camLocation[d].hasOwnProperty(this.cameraPosLookAtNames.mobile.lookAt)&&(m=this.cameraPosLookAtNames.mobile.lookAt));let A=r.camLocation[d][g],f=r.camLocation[d][m];this.setTransform(A,f)}else r.camInitPos&&r.camInitLookAt&&(!h||!this.pxlEnv.postIntro||this.hotKeyTriggered)&&(this.setTransform(r.camInitPos,r.camInitLookAt),this.hotKeyTriggered=!1)}else(!h||!this.pxlEnv.postIntro||this.hotKeyTriggered)&&(i!=null?this.setToObj(i):this.setTransform(r.camReturnPos,r.camReturnLookAt),this.hotKeyTriggered=!1);this.pxlGuiDraws.prepArtistInfo(r.getArtistInfo()),this.camUpdated=!0;let c=r.pxlCamFOV[this.pxlDevice.mobile?"MOBILE":"PC"];this.camera.fov=c,this.camera.zoom=r.pxlCamZoom,this.camera.aspect=r.pxlCamAspect,this.camera.near=r.pxlCamNearClipping,this.camera.far=r.pxlCamFarClipping,this.camera.updateProjectionMatrix();let p=this.getUserHeight();this.emitCameraTransforms(this.camera.position.clone(),p,!0),this.canMove&&(this.colliderValid=!1,this.hasGravity=!0),this.pxlAutoCam.checkStatus()}warpToRoomSnapshot(e){this.pxlEnv.currentRoom=e;let t=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom],i=t.pxlCamFOV[this.pxlDevice.mobile?"MOBILE":"PC"];this.camera.fov=i,this.camera.zoom=t.pxlCamZoom,this.camera.aspect=t.pxlCamAspect,this.camera.near=t.pxlCamNearClipping,this.camera.far=t.pxlCamFarClipping,this.camera.updateProjectionMatrix(),this.setTransform(t.camThumbPos,t.camThumbLookAt);let s=this.getUserHeight();this.emitCameraTransforms(this.camera.position.clone(),s,!0)}fastTravel(e=0){this.pxlAutoCam.enabled||((this.pxlAutoCam.active||this.pxlAutoCam.autoCamActive)&&this.pxlAutoCam.preAutoCamToggle(),this.hotKeyTriggered=!0,e===0&&this.warpEventTriggered(1,this.pxlEnv.currentRoom,"init"))}camJumpKey(e=!1){e?this.camInitJump():(this.cameraJumpActive&&(this.cameraJumpActive=!1),this.cameraAllowJump=!0,this.hasJumpLock=!1)}camInitJump(){this.canMove&&!this.hasGravity&&this.cameraAllowJump&&(this.pxlDevice.keyDownCount[2]=this.pxlTimer.prevMS,this.cameraAllowJump=!1,this.cameraJumpActive=!0,this.cameraJumpInAir=!0,this.hasGravity=!0,this.gravityRate=0,this.cameraJumpVelocity=this.cameraJumpImpulse[this.pxlUser.lowGrav]*this.userScale,this.hasJumpLock&&(this.hasJumpLock=!1,this.nearestFloorHit=this.nearestFloorHitPrev))}camJump(e){let t=e-this.pxlDevice.keyDownCount[2],i=Math.min(1,t/this.cameraMaxJumpHold[this.pxlUser.lowGrav]);if(this.cameraJumpActive){let s=i;s===1?this.cameraJumpActive=!1:(s=(1-s)*(1-s),s=s*(s*.5+.5)),this.cameraJumpVelocity+=Math.max(0,s)*this.cameraJumpImpulse[this.pxlUser.lowGrav]*this.jumpScalar*this.pxlTimer.deltaTime}this.cameraJumpVelocity*=1-i,i===1&&(this.cameraJumpActive=!1)}killJumpImpulse(e=1){let t=this.cameraJumpVelocity*e*this.cameraJumpVelocityEaseOut;this.cameraJumpVelocity=t>.1?t:0,this.workerFunc("killJumpImpulse")}updateGravity(e){if(this.runMain){this.gravityRate=Math.max(0,this.gravityRate-this.cameraJumpVelocity);let t=this.gravityUPS[this.pxlUser.lowGrav];this.hasGravity&&(this.gravityCount+=t*2.5*e,this.gravityRate=Math.min(1,this.gravityRate+this.gravityMax)*this.gravityCount),this.gravityRate!==0&&(this.hasGravity||(this.gravityRate=this.gravityRate>.01?this.gravityRate*this.gravityEaseOutRate*t*e:0),this.standingHeightGravInfluence=Math.min(1,this.gravityRate/this.gravityMax)*this.standingMaxGravityOffset)}}resetGravity(){this.gravityCount=0,this.gravityRate=0,this.workerFunc("resetGravity"),this.jumpLanding(!1)}jumpLanding(e=!0){this.cameraJumpActive&&(this.hasJumpLock=!0,this.releaseJumpLockTime=this.pxlTimer.runtime+this.releaseJumpLockDelay),this.gravityCount=0,this.hasGravity=!1,this.cameraJumpVelocity=0,this.cameraJumpInAir=!1,this.cameraJumpActive=!1,e&&this.workerFunc("jumpLanding")}colliderCheck(e){if(!this.canMove)return e;let t=null;if(this.movementBlocked=!1,(this.cameraMoveLength>0||this.colliderPrevObjHit===null||this.nearestFloorObjName===null)&&this.cameraBooted&&this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].collidersExist){this.colliderValidityChecked=!0;let a=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom],o=new J(0,-1,0),n=e.clone(),h=150*this.maxStepHeight;n.y+=h+this.maxStepHeight;var i=[];if(a.hasColliderType(T.WALL)&&(i=this.pxlColliders.castRay(this.pxlEnv.currentRoom,n,o,T.WALL)),i.length>0)if(a.hitColliders(i,T.WALL),a.hasColliderType(T.WALL_TOP)){let u=this.pxlColliders.castRay(this.pxlEnv.currentRoom,n,o,T.WALL_TOP);u.length>0&&a.hitColliders(u,T.WALL_TOP);let c=-99999,p,d=this.nearestFloorHit,g=!1;for(var s=0;s<u.length;++s){var r=u[s];p=r.object.name;let A=r.pos,f=r.dist,v=A.y<this.maxStepHeight;g=g||v,(f<c&&v||t===null)&&(t=p,c=f,d=A)}let m;(!g||e.y<d.y&&this.nearestFloorHitPrev.y-d.y>this.maxStepHeight+this.getStandingHeight()&&!this.hasGravity&&e.y+this.maxStepHeight+this.getStandingHeight()<d.y&&this.hasGravity)&&((this.cameraMovement[0]!==0||this.cameraMovement[1]!==0)&&(g=!0,this.hasGravity=!1,this.hasJumpLock=!0),m=this.cameraPos.clone(),m.y=Math.min(e.y,m.y),e=m,d=e,this.hasGravity?d.y=this.nearestFloorHitPrev.y:d.y=this.cameraPos.y,this.cameraJumpActive=!1,this.cameraAllowJump=!0,this.cameraJumpInAir=!1,this.cameraMovement[0]=0,this.cameraMovement[1]=0,this.pxlDevice.touchMouseData.curFadeOut.multiplyScalar(0),this.pxlDevice.touchMouseData.velocity.multiplyScalar(0)),g&&(t===null?(this.nearestFloorHit=this.nearestFloorHitPrev,this.nearestFloorObjName=this.nearestFloorObjNamePrev,Math.abs(e.y-this.nearestFloorHit.y)>this.maxStepHeight+this.getStandingHeight()&&(this.colliderValid=!1,this.hasGravity=!0)):(this.nearestFloorHitPrev=this.nearestFloorHit,this.nearestFloorObjNamePrev=this.nearestFloorObjName,this.nearestFloorHit=d,this.nearestFloorObjName=t))}else this.colliderFail=!0,this.movementBlocked=!0;else{let u=this.maxStepHeight;if(n=e.clone(),n.y+=h+this.maxStepHeight,this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].hasColliders())i=this.pxlColliders.castRay(this.pxlEnv.currentRoom,n,o,T.FLOOR);else return e;if(i.length>0){if(i.length>1){let g=Math.abs(i[0].pos.y-e.y);if(g<u)i=[i[0]];else if(g>u&&i[0].pos.y>i[1].pos.y&&i[1].pos.y>e.y-this.maxStepHeight)return e}this.floorColliderInitialHit=!0;let c=-99999,p,d=this.nearestFloorHit;for(let g=0;g<i.length;++g){let m=i[g],A=m.pos,f=!1;p=m.object.name;let C=A.distanceTo(e);if(f=C<this.maxStepHeight,(this.portalList[p]||this.roomWarpZone.includes(p))&&f){t=p,d=A;break}else this.itemCheck(p,f)||(C<c||t===null)&&(t=p,c=C,d=A)}this.nearestFloorObjName===null&&t!=null&&(this.nearestFloorHitPrev=d,this.nearestFloorObjNamePrev=t,this.nearestFloorHit=d,this.nearestFloorObjName=t),this.nearestFloorHitPrev.y-d.y>this.maxStepHeight+this.getStandingHeight()&&!this.hasGravity?(this.nearestFloorHit=this.nearestFloorHitPrev,this.nearestFloorObjName=this.nearestFloorObjNamePrev,t?e=this.cameraPos.clone():e=this.cameraPrevPos.clone(),t=this.nearestFloorObjName,this.cameraMovement[0]=0,this.cameraMovement[1]=0,this.pxlDevice.touchMouseData.curFadeOut.multiplyScalar(0),this.pxlDevice.touchMouseData.velocity.multiplyScalar(0)):(this.nearestFloorHitPrev=this.nearestFloorHit,this.nearestFloorObjNamePrev=this.nearestFloorObjName,this.nearestFloorHit=d,this.nearestFloorObjName=t,t===null&&(this.colliderValid=!1,this.hasGravity=!0))}else this.colliderFail=!0,this.movementBlocked=!0,this.colliderValidityChecked=!1,e=this.cameraPos.clone()}}else this.colliderValidityChecked=!1;return this.colliderValidityChecked=!1,e}checkColliderValid(e){this.colliderValidityChecked=!0;let t=this.maxStepHeight+this.gravityRate,i=e.distanceTo(this.nearestFloorHit),s=i<t;return this.colliderValid=s,i}eventTrigger(e=null){if(!this.canMove||!e)return!1;if(this.portalList[e])return this.warpEventTriggered(0,this.portalList[e]),this.eventCheckStatus=!1,!0;if(this.roomWarpZone.includes(e))return this.warpEventTriggered(1,e),this.eventCheckStatus=!1,!0;if(this.colliderShiftActive=this.colliderCurObjHit!==e||this.colliderShiftActive,this.colliderPrevObjHit=this.colliderCurObjHit,this.colliderCurObjHit=e,this.colliderShiftActive=this.colliderShiftActive||!(this.colliderAdjustPerc===1||this.colliderAdjustPerc===0),this.colliderShiftActive&&this.colliderCurObjHit){let t=1;this.colliderCurObjHit.includes("AudioTrigger")&&(t=-1),this.colliderAdjustPerc=Math.min(1,Math.max(0,this.colliderAdjustPerc+this.colliderAdjustRate*t));let s=1-this.colliderAdjustPerc,r=1;if(this.colliderCurObjHit==="AudioTrigger_1"?(this.pxlEnv.currentAudioZone=1,r=r-s*this.uniformScalars.darkBase,this.uniformScalars.exposureUniformBase=r):this.colliderCurObjHit==="AudioTrigger_2"?(this.pxlEnv.currentAudioZone=2,r=this.uniformScalars.curExp+s*this.uniformScalars.brightBase*1,this.uniformScalars.exposureUniformBase=r,this.proximityScaleTrigger=!0,this.pxlAudio.setFadeActive(-1)):(this.pxlEnv.currentAudioZone=0,r=r*(1-s)+this.uniformScalars.exposureUniformBase*s),this.colliderShiftActive=!(this.colliderAdjustPerc===1||this.colliderAdjustPerc===0),this.colliderPrevObjHit==="AudioTrigger_2"&&this.colliderCurObjHit!==this.colliderPrevObjHit&&(this.proximityScaleTrigger=!0,this.pxlAudio.setFadeActive(1)),this.pxlDevice.mobile&&(r=this.colliderAdjustPerc),this.pxlRendering.updateCompUniforms(r),this.proximityScaleTrigger&&!this.pxlDevice.mobile&&!this.pxlAutoCam.enabled){let a=this.colliderAdjustPerc;a=1-(1-a)*(1-a),this.pxlEnv.fogMult.x=a,this.colliderShiftActive||(this.proximityScaleTrigger=!1)}this.eventCheckStatus=this.colliderShiftActive}}itemCheck(e,t){if(!t)return!1;let i=e.split("_").shift();return this.pxlUser.itemListNames.includes(e)&&this.pxlUser.checkItemPickUp(i)?this.itemActive(i,e):!1}itemTrigger(){if(this.pxlUser.itemActiveTimer.length>0)this.pxlUser.itemActiveTimer[0]=this.pxlTimer.curMS;else{this.pxlUser.mPick.length===0&&(this.pxlUser.mPick=this.pxlUtils.randomizeArray(["LizardKing","StarField","InfinityZoom"]));let e=this.pxlUser.mPick.pop();this.pxlUser.checkItemPickUp(e),this.itemActive(e)}}itemActive(e=null,t=null){if(e===null)return!1;let i=this.pxlTimer.prevMS+this.pxlUser.itemRunTime,s="",r="";if(e==="LowGravity")r="Low Gravity",s="this.lowGrav=0;this.itemGroupList['"+t+"'].visible=true;",i=this.pxlTimer.prevMS+this.pxlUser.itemRunTime;else if(e==="LizardKing")r="I am the Lizard King",s="this.lKing=0;this.lKingWarp.set(...this.lKingInactive);this.lizardKingPass.enabled=false;"+(!this.pxlDevice.mobile&&"this.itemGroupList['"+t+"'].visible=true;"),i=this.pxlTimer.prevMS+this.pxlUser.itemRunTime;else if(e==="StarField")r="Major Tom",s="this.sField=0;this.starFieldPass.enabled=false;"+(!this.pxlDevice.mobile&&"this.itemGroupList['"+t+"'].visible=true;"),i=this.pxlTimer.prevMS+this.pxlUser.itemRunTime;else if(e==="InfinityZoom")r="Fractal Substrate",s="this.iZoom=0;this.crystallinePass.enabled=false;"+(!this.pxlDevice.mobile&&"this.itemGroupList['"+t+"'].visible=true;this.pxlEnv.mapComposerWarpPass.needsSwap=true;this.pxlEnv.mapComposerWarpPass.enabled=false;"),i=this.pxlTimer.prevMS+this.pxlUser.itemRunTime,this.pxlEnv.mapComposerWarpPass.needsSwap=!0,setTimeout(()=>{this.pxlEnv.mapComposer.render(),this.pxlEnv.roomComposer.render(),setTimeout(()=>{this.pxlEnv.mapComposerWarpPass.needsSwap=!1,this.pxlEnv.mapComposerWarpPass.enabled=!0},500)},500);else return!1;return this.pxlGuiDraws.buildItemHud(e,r),this.pxlDevice.mobile||(this.pxlUser.itemGroupList[t].visible=!1),this.pxlUser.itemInactiveCmd.push(s),this.pxlUser.itemActiveTimer.push(i),this.pxlUser.itemActiveList.push(r),!0}toggleMovement(e=null){e===null&&(e=!this.canMove),this.canMove=e,this.hasGravity=e}updateMovement(e){if(!this.canMove||this.pxlDevice.mobile)return;let t=[0,0],i=[...this.pxlDevice.directionKeysPressed],s=0,r=0,a=[e-this.pxlDevice.keyDownCount[0],e-this.pxlDevice.keyDownCount[1]],o=this.mobile?1:0;if(i[0]+i[2]===1){s=i[2]-i[0];let n=this.pxlQuality.settings.leftRight?this.cameraEasing[o]:(1-Math.min(1,Math.abs(this.cameraMovement[1]*.3)))*.5;t[0]=((this.pxlQuality.settings.leftRight?1:6)+a[0]*a[0]*.1)*n,t[0]=Math.min(this.pxlUser.moveSpeed,t[0])*this.movementScalar*this.userInputMoveScalar.x}else this.pxlDevice.keyDownCount[0]=e;if(i[1]+i[3]===1){r=i[3]-i[1];let n=(1-Math.min(1,Math.abs(this.cameraMovement[0]*.07)))*this.cameraEasing[o];t[1]=a[1]*(a[1]*3+2+this.pxlUser.moveSpeed)*.5*n,t[1]=Math.min(this.pxlUser.moveSpeed,t[1])*this.movementScalar*this.userInputMoveScalar.y}else this.pxlDevice.keyDownCount[1]=e;this.hasMovementLimit=!0,this.movementMax=10,this.cameraMovement[0]+=s*t[0],this.cameraMovement[1]+=r*t[1]}initFrameCamPosition(){let e=this.cameraPos.clone();if(!this.cameraBooted)this.cameraAimTarget.position.set(0,0,0),this.cameraPrevPos=new J(e.clone()),this.cameraPrevLookAt=new J(0,0,1),this.hasMoved=!0,this.hasRotated=!0;else{let t;t=new J(this.pxlQuality.settings.leftRight?this.cameraMovement[0]*.5:0,0,this.cameraMovement[1]),this.cameraMoveLength=t.length(),t.applyQuaternion(this.camera.quaternion);let i=this.cameraMoveLength*this.cameraMoveLengthMult;if(i!==0){let s=.1;i=i>0?Math.max(s,i):Math.min(-s,i),t.normalize().multiply(new J(1,0,1)).multiplyScalar(i),e.add(t),this.cameraMovement[0]=Math.abs(this.cameraMovement[0])<this.posRotEasingThreshold?0:this.cameraMovement[0]*this.cameraMovementEase,this.cameraMovement[1]=Math.abs(this.cameraMovement[1])<this.posRotEasingThreshold?0:this.cameraMovement[1]*this.cameraMovementEase,this.cameraMovement[0]===0&&(this.userInputMoveScalar.x=1),this.cameraMovement[1]===0&&(this.userInputMoveScalar.y=1),this.hasMoved=!0}e.y=this.cameraPos.y+this.cameraJumpVelocity,this.workerActive&&(this.cameraJumpVelocity=0)}return this.cameraCross=new J(1,0,0).applyQuaternion(this.camera.quaternion),e}applyGravity(e){if(this.canMove&&this.hasGravity)if(e.y<this.nearestFloorHit.y){let i=this.nearestFloorHitPrev;e.y=Math.max(i.y,e.y),e.y<0&&(e.x=i.x,e.z=i.z)}else e.y=Math.max(this.nearestFloorHit.y,e.y-this.gravityRate),e.y===this.nearestFloorHit.y&&e.y<this.cameraPrevPos.y&&this.jumpLanding();else if(e.distanceTo(this.nearestFloorHit)<this.maxStepHeight)e.y=this.nearestFloorHit.y;else{e=this.cameraPos.clone();let i=e.y>this.nearestFloorHit.y;this.hasGravity=i,this.hasMoved=this.hasMoved||i,this.colliderFail=!i,this.workerFunc("jumpLanding")}return e}getStandingHeight(){let e=this.standingHeight;return this.roomStandingHeight.hasOwnProperty(this.pxlEnv.currentRoom)&&(e=this.roomStandingHeight[this.pxlEnv.currentRoom]),e*this.userScale}getUserHeight(){let e=Math.min(1,Math.abs(this.cameraMovement[1]));this.walkBouncePerc=this.walkBouncePerc>=1?1:this.walkBouncePerc+this.walkBounceEaseIn*e,this.walkBounce+=e*this.walkBounceRate,this.walkBouncePerc=this.walkBouncePerc*this.walkBounceEaseOut+e,this.walkBouncePerc<.03&&(this.walkBouncePerc=0,this.walkBounce=0,this.walkBounceSeed=Math.random()*2351.3256);let t=Math.sin(this.walkBounce+this.walkBounceSeed)*this.walkBouncePerc*this.walkBounceHeight;return this.getStandingHeight()-this.standingHeightGravInfluence+t}camApplyMobileRotation(){if(this.cameraPose.alpha!=null){let e=.017453292519943278,t=2.23606797749979,i=new Ye,s=this.cameraPose.alpha*e+this.cameraPose.alphaOffset+2.1,r=this.cameraPose.beta*e,a=this.cameraPose.gamma*e,o=new J(0,0,1),n=new Ye,h=new Ye(-t,0,0,t),u=new is;u.set(r,s,-a,"YXZ"),i.setFromEuler(u),i.multiply(h),i.multiply(n.setFromAxisAngle(o,-this.cameraPose.orientation)),i.normalize();let c=new Ye;Ye.slerp(this.camera.quaternion,i,c,.35);let p=new is().setFromQuaternion(c);p.x=Math.max(-.95*Math.PI/2,Math.min(.95*Math.PI/2,p.x)),c.setFromEuler(p),this.camera.setRotationFromQuaternion(c),this.hasRotated=!0}}updateRoamRotation(){if(this.cameraPose.alpha===null){let e=this.pxlDevice.gyroGravity[2];this.pxlDevice.touchMouseData.velocity.y=Math.min(this.touchSensitivityLimits,Math.max(-this.touchSensitivityLimits,this.pxlDevice.touchMouseData.velocity.y));let t=new is,i;if(this.pxlDevice.mobile){let a=this.pxlOptions.userSettings.look.mobile.invert||!1?-1:1;t.set(this.pxlDevice.touchMouseData.netDistance.y/this.pxlDevice.sH*4*a,this.pxlDevice.touchMouseData.netDistance.x/this.pxlDevice.sW*7*a+e,0,"YXZ"),i=new Ye,i.setFromEuler(t),i=this.pxlDevice.touchMouseData.initialQuat.clone().multiply(i)}else{let a=this.pxlOptions.userSettings.look.pc.invert||!1?-1:1;t.set(this.pxlDevice.touchMouseData.velocity.y*.005*a,this.pxlDevice.touchMouseData.velocity.x*.008*a+e,0,"YXZ"),i=new Ye,i.setFromEuler(t),i=this.camera.quaternion.clone().multiply(i)}i.normalize();let s=new J(0,0,-10).applyQuaternion(i).add(this.camera.position);this.camera.setRotationFromQuaternion(i),this.camera.lookAt(s),this.camera.up.set(0,1,0),this.hasRotated=!0}}updateStaticRotation(){let e=1;this.touchBlender?(e=Math.min(1,Math.max(0,this.pxlTimer.curMS-this.pxlDevice.touchMouseData.releaseTime)),e*=e,this.pxlDevice.touchMouseData.netDistance.multiplyScalar(1-e),this.touchBlender=e<1):this.pxlDevice.touchMouseData.netDistance.multiplyScalar(.5);let t=new is;t.set(this.pxlDevice.touchMouseData.netDistance.y/this.pxlDevice.sH*2,this.pxlDevice.touchMouseData.netDistance.x/this.pxlDevice.sW*2,0,"YXZ");let i=new Ye().clone(this.camera.quaternion);i.setFromEuler(t),i=this.camera.quaternion.clone().multiply(i),i.normalize(),this.touchBlender&&i.slerp(this.camera.quaternion.clone(),e).normalize();let s=new J(0,0,-10).applyQuaternion(i).add(this.camera.position);this.camera.setRotationFromQuaternion(i),this.camera.lookAt(s),this.camera.up.set(0,1,0),this.hasRotated=!0}lookAtTargetLock(){if(this.lookAtTargetActive&&this.lookAtTargetActive&&(this.lookAtLockFader!==0&&(this.lookAtLockPerc+=(this.lookAtLockFader+Math.min(1,this.pxlDevice.touchMouseData.velocity.length()*.001))*this.lookAtLockFadeRate,(this.lookAtLockPerc<0||this.lookAtLockPerc>1)&&(this.lookAtLockPerc=this.lookAtLockPerc<0?0:1,this.lookAtLockFader=0),this.lookAtPerc.x=this.lookAtLockPerc),this.lookAtLockPerc>0)){let e=this.camera.quaternion.clone();this.camera.lookAt(this.cameraAimTarget.position);let t=this.camera.quaternion.clone();this.lookAtLockPerc===1?this.camera.setRotationFromQuaternion(t):this.camera.setRotationFromQuaternion(t.slerp(e,Math.cos(this.lookAtLockPerc*this.pi)*.5+.5)),this.hasRotated=!0}}warpEventTriggered(e=0,t=null,i="init"){this.warpActive||(this.pxlEnv.mapComposerWarpPass.needsSwap=!0,this.warpType=e,this.warpObj=t,this.warpTarget=i,this.warpActive=!0,this.pxlEnv.initWarpVisual(e))}warpCamRun(){if(this.warpType===0)this.setToObj(this.warpObj);else if(this.warpType===1){let e=this.warpTarget==="init";this.warpToRoom(this.warpObj,e,this.warpTarget)}this.pxlEnv.setExposure(this.uniformScalars.exposureUniformBase),this.warpObj=null,this.warpTarget=null,this.warpActive=!1}lowQualityUpdates(){if(this.HDRView){let e=new J(0,0,-1).applyQuaternion(this.camera.quaternion),t=e.clone().multiply(new J(1,0,1)).normalize();this.camRotPitch.set(-Math.atan2(t.x,t.z)*.1591549430918955,e.y*.5)}}midQualityUpdates(){if(this.pxlQuality.settings.motion){let e=new J(0,0,0);e.applyQuaternion(this.camera.quaternion),this.camRotXYZ.multiplyScalar(.8).add(e.multiplyScalar(.2));let t;if(this.pxlDevice.mobile){let r=this.pxlDevice.sW*.5,a=this.pxlDevice.sH*.5,o=new J(0,0,10),n=new J(0,0,10);o.applyQuaternion(this.camera.quaternion.clone()).project(this.camera),n.applyQuaternion(this.prevQuaternion).project(this.camera),o.x=(o.x+1)*r,o.y=-(o.y-1)*a,n.x=(n.x+1)*r,n.y=-(n.y-1)*a,t=n.clone().sub(o.clone()).multiplyScalar(.6).multiply(new J(this.pxlDevice.screenRes.x,this.pxlDevice.screenRes.y,0));let h=.1;t.length>h&&t.normalize().multiplyScalar(h)}else t=this.pxlDevice.touchMouseData.velocity.clone().multiplyScalar(Math.max(this.pxlDevice.screenRes.x,this.pxlDevice.screenRes.y));let i=new ts(t.x,-t.y),s=new ts(0,0).lerpVectors(this.pxlEnv.blurDirPrev,i,.85);this.pxlEnv.blurDirPrev.set(this.pxlEnv.blurDirCur),this.pxlEnv.blurDirCur.set(s)}}emitCameraTransforms(e,t,i=!1){this.emit("cameraTransforms",{cameraPos:e,standingHeight:t,force:i})}jogServerMemory(){let e=this.cameraPos.clone(),t=this.getUserHeight();this.emitCameraTransforms(e,t,!0)}updateCamera(){let e=this.pxlDevice.touchMouseData.velocity.length();if(this.hasRotated=this.hasRotated||e>0,this.camUpdated=this.camUpdated||this.hasRotated,this.pxlDevice.touchMouseData.curFadeOut.multiplyScalar(.7),this.camUpdated){this.camUpdated=!1;let t=!1;this.updateDeviceValues(e),this.prevQuaternion.copy(this.camera.quaternion);let i=this.initFrameCamPosition(),s=this.getUserHeight();if(this.pxlOptions.staticCamera){this.hasGravity=!1,this.hasMoved=!1,this.pxlOptions.allowStaticRotation&&this.hasRotated&&(this.updateStaticRotation(),this.camera.updateMatrixWorld()),this.hasRotated=!1;return}(this.hasMoved||this.hasGravity)&&(i=this.colliderCheck(i),this.updateGravity(this.pxlTimer.deltaTime),!this.colliderValid&&!this.colliderValidityChecked?this.jump=this.checkColliderValid(i):this.jump=0,this.eventCheckStatus=!0,i=this.applyGravity(i),this.cameraPrevPos=this.cameraPos.clone(),this.cameraPos=i.clone(),t=this.cameraPos.distanceTo(this.cameraPrevPos)>0,i.y+=s+this.cameraJumpHeight,this.camera.position.copy(i)),this.hasRotated&&this.canMove?(this.updateRoamRotation(),t=t||this.hasRotated):this.hasRotated&&(this.updateStaticRotation(),t=t||this.hasRotated),t&&(this.camera.updateMatrixWorld(),this.emitCameraTransforms(i,s)),this.hasMoved=!1,this.hasRotated=!1,this.cameraBooted=!0}}subscribe(e,t){this.callbacks.hasOwnProperty(e)||(this.callbacks[e]=[]),this.callbacks[e].push(t)}unsubscribe(e,t){let i=!1;return this.callbacks.hasOwnProperty(e)&&(i=this.callbacks[e].includes(t),i&&(this.callbacks[e]=this.callbacks[e].filter(s=>s!==t))),i}emit(e,t){this.callbacks.hasOwnProperty(e)&&this.callbacks[e].forEach(i=>{i(t)})}};import{Vector2 as Pn,Vector3 as $r,Quaternion as kA,Euler as QA}from"three";var rs=class{constructor(e=!1){this.enabled=e,this.active=!1,this.mobile=null,this.pxlTimer=null,this.pxlUtils=null,this.pxlDevice=null,this.pxlAudio=null,this.pxlCamera=null,this.pxlEnv=null,this.camera=null,this.netDistance=new Pn,this.prevCamChange=0,this.nextCamChange=0,this.delayRange=[25,45],this.autoCamActive=!1,this.autoCamMode=0,this.autoCamPaths={},this.resetAutoCam=!0,this.autoCamPrevPos=null,this.autoCamPrevLookAt=null,this.touchBlender=!1,this.autoCamId=0,this.camMode=0,this.curModeCount=0,this.curRoom="",this.curRoomIndex=0,this.curPath=0,this.roomList=[],this.pathCounts={},this.forceNewRoom=!1,this.curRoomCount=0,this.avatarMin=0,this.avatarValid=!1,this.curAvatar=null,this.clusterReturn=!1,this.curCluster=[],this.clusterValid=2,this.clusterRotation=0,this.clusterRotRate=.005}setDependencies(e){this.pxlTimer=e.pxlTimer,this.pxlUtils=e.pxlUtils,this.pxlDevice=e.pxlDevice,this.pxlAudio=e.pxlAudio,this.pxlCamera=e.pxlCamera,this.pxlEnv=e.pxlEnv,this.camera=e.pxlCamera.camera}init(){this.active=this.enabled||this.mobile,this.autoCamActive=this.autoCamActive||this.mobile;let{roomList:e,pathCounts:t}=this.getAutoCamData();this.roomList=e,this.curRoom=this.roomList[0],this.pathCounts=t,this.setRoom(!1,!0),this.getNextPath(),this.checkStatus()}step(e=!1){if(this.autoCamActive===null||this.active===null)return this.autoCamActive=!1,this.active=!1,!0;if(this.active===!1)if(this.autoCamActive)this.updateAutoCamera();else return!0;if((this.pxlTimer.curMS>=this.nextCamChange||e)&&this.active&&!this.pxlDevice.touchMouseData.active){if(!e||!this.enabled){let t=this.checkCamMode();this.setNextTrigger(t)}this.curAvatar=0,this.camera.up.set(0,1,0),this.pxlDevice.touchMouseData.netDistance.multiplyScalar(0),this.camMode===1?this.setCamMode(0):this.camMode===2?this.setCamMode(0):(this.curCluster=[],this.stepDroneCam()),this.setAutoCamMode(this.camMode)}return this.updateAutoCamera(),this.applyTouchRotate(),!1}checkCamMode(){let e=1,t=this.camMode;return this.camMode=0,!this.enabled||!this.active||this.camMode!==t&&this.camMode===0&&(this.forceNewRoom=!0),e}setCamMode(e){let t=1;return e.type===1||e.type===2?t=1:(this.camMode=0,this.forceNewRoom=!0),this.step(!0),t}stepDroneCam(){let e=!0,t=Math.random(this.nextCamChange),i=this.pathCounts[this.pxlEnv.currentRoom];this.curRoomCount>=i*2&&(this.forceNewRoom=!0),(t<.3||this.forceNewRoom)&&(this.setRoom(),e=!1),this.curRoomCount+=1,this.getNextPath(e)}setRoom(e=!1,t=!1){if(this.active||this.autoCamActive){let i=this.curRoomIndex,s=this.roomList.length;this.pxlEnv.postIntro?t||(e?i=(i+1)%s:(i=Math.floor(Math.random()*s),i===this.curRoomIndex&&(i=(i+1)%s))):i=0,this.curRoomIndex=i,this.curRoom!==this.roomList[i]&&(this.curRoom=this.roomList[i],this.forceNewRoom=!1,this.curRoomCount=0,this.pxlCamera.warpEventTriggered(1,this.curRoom,"init"))}}setNextTrigger(e=1){let t=Math.random(this.nextCamChange);t=(this.delayRange[1]-this.delayRange[0])*t+this.delayRange[0],this.nextCamChange=this.pxlTimer.curMS+t*e}getNextPath(e=!0,t=1){if(this.enabled&&this.active&&this.autoCamPaths.hasOwnProperty(this.pxlEnv.currentRoom)){let i=this.autoCamPaths[this.pxlEnv.currentRoom].length;if(this.curPath=(this.curPath+t)%i,e&&t===0){let s=Math.random(this.nextCamChange);s=Math.floor(s*this.autoCamPaths[this.pxlEnv.currentRoom].length),this.curPath===s&&(s=(s+1)%i),this.curPath=s}else this.curPath=this.curPath<0?i-1:this.curPath,this.setNextTrigger(1);this.setAutoCamPath(this.curPath)}}checkStatus(){(this.autoCamActive||this.pxlDevice.mobile||this.active)&&this.toggleAutoCam(!0)}preAutoCamToggle(){this.autoCamActive||this.pxlCamera.colliderCurObjHit==="AudioTrigger_2"&&(this.pxlCamera.proximityScaleTrigger=!0,this.exposureShiftActive=!0),this.toggleAutoCam()}setAutoCamMode(e=0){this.autoCamMode=e,e===1&&(this.resetAutoCam=!0)}setPosQuat(e,t){this.camera.quaternion.copy(t),this.camera.position.copy(e),this.pxlCamera.updateCameraMatrices(),this.pxlCamera.camUpdated=!0}toggleAutoCam(e=null,t=1){if(this.pxlEnv.fogMult.x=1,this.autoCamPaths[this.pxlEnv.currentRoom]){this.curRoom=this.pxlEnv.currentRoom;let i=this.autoCamPaths[this.pxlEnv.currentRoom].length;isNaN(this.autoCamId)&&(this.autoCamId=i-1);let s=this.autoCamActive;if(this.autoCamActive=e===null&&i>0?!this.autoCamActive:e,this.autoCamActive=this.mobile||this.autoCamActive,!s&&this.autoCamActive&&(this.netDistance=new Pn().copy(this.pxlDevice.touchMouseData.netDistance)),this.pxlDevice.touchMouseData.netDistance.multiplyScalar(0),this.autoCamActive){this.pxlCamera.resetGravity(),this.autoCamId=(this.autoCamId+t)%i,this.autoCamId=this.autoCamId<0?i-1:this.autoCamId;let r=this.autoCamPaths[this.pxlEnv.currentRoom][this.autoCamId];this.totalLoopDuration=r.position.userData.duration;try{this.autoCamPositions=r.position.geometry.attributes.position,this.autoCamLookAt=r.lookAt.geometry.attributes.position,r.up?this.autoCamUp=r.up.geometry.attributes.position:(this.autoCamUp=null,this.camera.up.set(0,1,0)),this.numControlPoints=this.autoCamPositions.array.length/3,this.autoCamStartTime=this.pxlTimer.curMS-this.totalLoopDuration*Math.random()}catch(a){}}else this.setPosQuat(this.pxlCamera.cameraPrevPos.clone(),this.pxlCamera.prevQuaternion.clone()),this.pxlDevice.touchMouseData.netDistance.copy(this.netDistance)}}prevNextAutoCam(e=1,t=!1){this.autoCamActive&&(this.enabled&&this.active&&!t?this.nextCamChange=this.pxlTimer.curMS:this.toggleAutoCam(!0,e))}setAutoCamPath(e=0){this.autoCamActive&&(this.autoCamId=e,this.toggleAutoCam(!0,0))}getAutoCamData(){let e=Object.keys(this.autoCamPaths),t={};return e.forEach(i=>{t[i]=this.autoCamPaths[i].length}),{roomList:e,pathCounts:t}}getAutoCamValueFromCurve(e,t,i,s=!1){let r=e[t*3],a=e[t*3+1],o=e[t*3+2],n=(t+1)%this.numControlPoints,h=e[n*3],u=e[n*3+1],c=e[n*3+2],p=new $r(r,a,o),d=new $r(h,u,c);return p.lerp(d,i),p}updateAutoCamera(){if(!this.autoCamPositions||!this.autoCamPositions.array)return;let t=(this.pxlTimer.curMS-this.autoCamStartTime)%this.totalLoopDuration/this.totalLoopDuration;t*=this.numControlPoints-1;let i=Math.floor(t),s=t-i,r=this.getAutoCamValueFromCurve(this.autoCamPositions.array,i,s,!1);this.camera.position.copy(r);let a=this.getAutoCamValueFromCurve(this.autoCamLookAt.array,i,s);if(this.camera.lookAt(a),this.autoCamUp){let o=this.getAutoCamValueFromCurve(this.autoCamUp.array,i,s);o=o.sub(r).normalize(),this.camera.up.copy(o)}}applyTouchRotate(){let e=1;this.touchBlender?(e=Math.min(1,Math.max(0,this.pxlTimer.curMS-this.pxlDevice.touchMouseData.releaseTime)),e*=e,this.pxlDevice.touchMouseData.netDistance.multiplyScalar(1-e),this.touchBlender=e<1):this.pxlDevice.touchMouseData.netDistance.multiplyScalar(.5);let t=new QA;t.set(this.pxlDevice.touchMouseData.netDistance.y/this.pxlDevice.sH*2,this.pxlDevice.touchMouseData.netDistance.x/this.pxlDevice.sW*2,0,"YXZ");let i=new kA().clone(this.camera.quaternion);i.setFromEuler(t),i=this.camera.quaternion.clone().multiply(i),i.normalize(),this.touchBlender&&i.slerp(this.camera.quaternion.clone(),e).normalize();let s=new $r(0,0,-10).applyQuaternion(i).add(this.camera.position);this.camera.setRotationFromQuaternion(i),this.camera.lookAt(s),this.camera.up.set(0,1,0)}};ra();var ns=class{constructor(){this.audioObject=null}};import{Vector3 as GA,Vector4 as NA}from"three";var ls=class{constructor(){this.pxlTimer=null,this.pxlVideo=null,this.pxlDevice=null,this.pxlEnv=null,this.pxlGuiDraws=null,this.pxlSocket=null,this.active=!1,this.audioTimer=new GA(0,0,0),this.audioEq=new NA(0,0,0,0),this.audioWorker=null,this.audioProcessor=null,this.audioCtx=null,this.djUrlSource="//",this.djMuted=!1,this.djAudioVolume=0,this.djAudioVolumeMax=.65,this.djAudioVolumeMin=.25,this.djAudioVolumeScalar=.25,this.djAudioObj=null,this.djTimecodeObj=null,this.djVolumeParentObj=null,this.djVolumeObj=null,this.roomAudioStopped=!0,this.videoStreamObjects=[],this.colliderVolActive=!1,this.isVideoObject=!1,this.activeObject=null,this.fadeActive=!1,this.fadeAdjustRate=.02,this.fadeDir=0,this.fadePerc=0,this.audioContext=null}setDependencies(e){this.pxlTimer=e.pxlTimer,this.pxlVideo=e.pxlVideo,this.pxlDevice=e.pxlDevice,this.pxlEnv=e.pxlEnv,this.pxlGuiDraws=e.pxlGuiDraws,this.pxlSocket=e.pxlSocket}init(){this.active=!0}postBoot(){if(this.djAudioObj){if(this.pxlEnv.pxlAutoCam.enabled)this.djAudioVolumeMax=1,this.djAudioVolumeMin=0;else if(this.pxlEnv.mobile){let a=function(o){setTimeout(()=>{i.djAudioVolume=0,i.djAudioVolumeMax=s,i.djAudioVolumeMin=0,i.djAudioObj.byScript=!0,i.djAudioObj.volume=0,e.play().then(()=>{i.djPlayerMuteToggle(!1),i.setFadeActive(.5)}),r.removeEventListener("click",a),r.removeEventListener("touchstart",a)},500)},i=this,s=this.djAudioVolumeMax,r=document.getElementById("guiMobileWelcomeButton");r.addEventListener("click",a),r.addEventListener("touchstart",a)}this.djAudioVolume=this.pxlEnv.enabled?0:this.djAudioVolumeMin,this.djAudioObj.volume=this.pxlEnv.enabled?0:this.djAudioVolumeMin,this.djPlayerMuteToggle(!1),this.djPlayerAdjustVolume({}),this.djPlayerSetSliderGui();let e=this.djAudioObj;e.setAttribute("autoplay",!0);let t=this;this.djAudioObj.addEventListener("volumechange",i=>{t.djPlayerSetSliderGui()},!0)}}start(){}step(){this.djAudioObj&&this.djAudioObj.paused&&(this.djAudioObj.play().catch(e=>{}),this.djAudioObj.muted=this.djMuted||!this.roomAudioStopped),this.fadeAudioEvent()}isPaused(){let e=!0;return this.djAudioObj&&(e=this.djAudioObj.paused),e}pausePlayback(){this.active=this.pxlTimer.active,this.active?this.play():this.stop()}initPlay(){this.pxlVideo.canUnmute("dj")&&!this.isPaused()&&(this.djPlayerMuteToggle(!1),this.setFadeActive(1),this.pxlDevice.mobile&&this.pxlGuiDraws.toggleIcon(this.pxlGuiDraws.hudIcons.musicIcon,!this.djMuted,!0))}play(){if(this.active=!0,this.isVideoObject)this.pxlVideo.setVolume("dj",this.djAudioVolume),this.pxlVideo.setMuted("dj",this.djMuted);else{this.djAudioObj.byScript=!0;let e=this.djAudioObj;e.children[0].setAttribute("src",this.djUrlSource),setTimeout(()=>{e.load(),setTimeout(()=>{e.volume=this.djAudioVolume,e.muted=this.djMuted||!this.roomAudioStopped,e.paused&&e.play()},20)},20)}}stop(){if(this.active=!1,this.isVideoObject)this.pxlVideo.setMuted("dj",!0);else{let e=this.djAudioObj;e.children[0].setAttribute("src",""),e.pause(),setTimeout(()=>{e.load()},20)}}djBuildPlayer(){this.djAudioObj=document.getElementById("djStream"),this.djVolumeParentObj=document.getElementById("djPlayerVolumeParent"),this.djVolumeObj=document.getElementById("djPlayerVolume"),this.djAudioObj.byScript=!1,this.djAudioObj.volume=0,this.djVolumeObj.style.width="0%";let e=this;this.pxlDevice.objectPercList.push("djPlayerVolume"),this.pxlDevice.objectPercList.push("djPlayerVolumeParent"),this.pxlDevice.objectPercFuncList.djPlayerVolumeParent=t=>{e.djPlayerAdjustVolume(t)},this.djVolumeParentObj.down=!1,this.djVolumeParentObj.addEventListener("mousedown",t=>{e.djVolumeParentObj.down=!0,e.djPlayerAdjustVolume(t)}),this.djVolumeParentObj.addEventListener("mousemove",t=>{e.djPlayerAdjustVolume(t)}),this.djVolumeParentObj.addEventListener("mouseup",t=>{e.djVolumeParentObj.down=!1}),this.pxlDevice.mobile&&(this.djVolumeParentObj.style.width="30vw",this.djVolumeParentObj.addEventListener("touchstart",t=>{e.djVolumeParentObj.down=!0},{passive:!0}),this.djVolumeParentObj.addEventListener("touchmove",t=>{e.djPlayerAdjustVolume(t)},{passive:!0}),this.djVolumeParentObj.addEventListener("touchend",t=>{e.djVolumeParentObj.down=!1},{passive:!0})),this.djAudioObj.muted=!0,this.prepAudioProcessor()}prepAudioProcessor(){}stepAudioProcessor(){}recieveAudioProcessor(e){}buildRemoteAudioMixer(e,t){if(0)var i,s,r;return!1}loadStreamPromise(){let e=this.djAudioObj;return new Promise((t,i)=>{this.djAudioObj.byScript=!0,e.children[0].setAttribute("src",this.djUrlSource),e.load(),e.muted=this.djMuted||!this.roomAudioStopped}).then(()=>{}).catch(t=>{console.log("error source")})}djPlayerSetSliderGui(){this.djAudioObj.byScript||!this.pxlEnv.postIntro||this.pxlEnv.pxlAutoCam.enabled?this.djAudioObj.byScript=!1:(this.fadeActive=!1,this.djAudioVolumeMax=this.djAudioVolume,this.djAudioVolumeMin=this.djAudioVolume*this.djAudioVolumeScalar),this.djVolumeObj.style.width=this.djAudioVolume*100*~~!this.djMuted+"%"}djPlayerAdjustVolume(e){if(this.djVolumeParentObj.down||this.djVolumeParentObj.down&&e.touches){let t=this.djVolumeParentObj.offsetWidth,i=0;e.touches?i=this.pxlDevice.objectPerc.percX:i=e.offsetX/t;let s=Math.max(0,Math.min(1,i));this.djAudioVolume=s,this.djAudioVolumeMax=s,this.djAudioVolumeMin=s*.1,s*=s,this.djAudioObj&&(this.djAudioObj.volume=s),e.touches&&this.djPlayerSetSliderGui()}this.pxlVideo&&this.pxlEnv.posted&&this.pxlVideo.setVolume("dj",this.djAudioVolume)}djPlayerMuteToggle(e=null){this.djMuted=e===null?!this.djMuted:e,e!=null&&this.pxlGuiDraws.toggleIcon(this.pxlGuiDraws.hudIcons.musicIcon,!e,!0),this.djAudioObj&&(this.djAudioObj.muted=this.djMuted,this.djAudioObj.byScript=!0),this.pxlVideo&&this.pxlEnv.posted&&this.pxlVideo.setMuted("dj",this.djMuted)}setFadeActive(e=1){this.fadeDir!==e&&(this.fadeDir=e,this.fadeActive=!0)}fadeAudioEvent(){if(this.djVolumeParentObj&&!this.djVolumeParentObj.down&&this.fadeActive&&this.pxlEnv.postIntro){if(this.fadePerc+=this.fadeAdjustRate*this.fadeDir,this.fadePerc<0||this.fadePerc>1){this.fadePerc=this.fadeDir===1?1:0,this.fadeActive=!1;return}let e=(this.djAudioVolumeMax-this.djAudioVolumeMin)*this.fadePerc+this.djAudioVolumeMin;this.djAudioVolume=e,e*=e,this.djAudioObj&&(this.djAudioObj.byScript=!0,this.djAudioObj.volume=e),this.pxlVideo.setVolume("dj",this.djAudioVolume)}}};var hs=class{constructor(e=null,t=null,i=null,s=null,r=null){this.pxlUtils=t,this.pxlAudio=i,this.pxlFile=s,this.pxlGuiDraws=r,this.pxlEnv=null,this.videojs=null,this.Hls=null,this.IVSPlayer=null,this.posted=!1,this.djStreamUrl="",this.performerStreamUrl="",this.screenVideoBlock=null,this.screenVideos={},this.videoStreams={},this.videoStreamFailCount=0,this.videoStreamFailMax=5,this.videoAudioEvent={dj:!1,performer:!1},this.checkForDjStream=!1,this.checkForPerformerStream=!1,this.videoStills={dj:{texture:null,url:e+"SoftNoise_512.jpg"},performer:{texture:null,url:e+"SoftNoise_512.jpg"}}}init(){this.buildVideoBlock(),this.buildPromoVideos()}buildVideoBlock(){if(this.screenVideoBlock===null){let e=document.createElement("div");e.classList.add("videoScreenBlockStyle"),document.body.appendChild(e),this.screenVideoBlock=e}}buildPromoVideos(){[].forEach(t=>{let i=t.name,s=t.type,r=t.intensity,a=t.boost,o=t.file,n=t.landscape,h=this.pxlFile.vidRoot+o,u=document.createElement("video");u.id="screenVideo_"+i+"_"+(n?"port":"land"),u.src=h,u.classList.add("bgMediaAssets"),u.controls=!1,u.muted=!0,u.preload="true",u.setAttribute("autoplay",""),u.setAttribute("muted",""),u.setAttribute("playsinline",""),u.setAttribute("loop",""),this.screenVideoBlock.appendChild(u),this.screenVideos[i]||(this.screenVideos[i]={}),this.screenVideos[i].name=i,this.screenVideos[i].type=s,r&&(this.screenVideos[i].intensity=r),a&&(this.screenVideos[i].boost=a);let c=this.screenVideos[i].file||[];this.screenVideos[i].file?c[~~n]=h:c=[h,h],this.screenVideos[i].file=c;let p=this.pxlUtils.getVideoTexture(u),d=this.screenVideos[i].texture||[];this.screenVideos[i].texture?d[~~n]=p:d=[p,p],this.screenVideos[i].texture=d;let g=[];this.screenVideos[i].videoObjs?g[~~n]=u:g=[u,u],this.screenVideos[i].videoObjs=g})}async boot(){this.videoAudioEvent.dj?this.buildVideoPlayer("dj"):this.videoStills.dj.texture=this.pxlUtils.loadTexture(this.videoStills.dj.url)}buildVideoPlayer(e){let t=this,i=document.createElement("video");i.id="antibodyDjStream",i.classList.add("bgMediaAssets"),i.controls=!1,i.volume=0,i.muted=!0,i.setAttribute("autoplay","true"),i.setAttribute("playsinline","true"),i.addEventListener("volumechange",s=>{i.volume=Math.min(i.volume,t.pxlAudio.djAudioVolume)},!0),this.screenVideoBlock.appendChild(i),this.videoStreams[e]={},this.videoStreams[e].mode=0,this.videoStreams[e].active=!1,this.videoStreams[e].loading=!1,this.videoStreams[e].checkResolve=!1,this.videoStreams[e].prevCheck=this.pxlUtils.curMS+5,this.videoStreams[e].delayCheck=5,this.videoStreams[e].obj=i,this.videoStreams[e].url=this.djStreamUrl,this.videoStreams[e].urlStatus=!1,this.videoStreams[e].player=null,this.videoStreams[e].checkScreens=!1,this.videoStreams[e].activeLevel=-1,this.videoStreams[e].prevFrame=0,this.videoStreams[e].prevFrameCount=0,this.videoStreams[e].canvasObj=null,this.videoStreams[e].videoTexture=this.getTexture(e),this.pxlFile.urlExists(this.djStreamUrl).then(s=>{this.videoStreams[e].urlStatus=s}),this.buildVideoStream(e,!1)}postBoot(e){this.videoStreams[e]&&this.videoStreams[e].urlStatus&&this.load(e,this.videoStreams[e].url),this.posted=!0,this.checkForDjStream=this.videoAudioEvent.dj}step(){let e=!1,t="dj";if(this.videoAudioEvent[t]){let i=this.videoStreams[t];i&&(i.active||this.checkVideoStreamStatus(t),this.pxlUtils.mobile?i.active&&i.videoTexture&&i.checkScreens&&(i.checkScreens=!1,this.setScreensToStreams(1,i.videoTexture)):(e=i.checkScreens,i.checkScreens=!1))}else this.videoStills[t].texture&&this.pxlUtils.mobile&&this.setScreensToStreams(1,this.videoStills[t].texture);return e}setScreensToStreams(e=0,t="dj"){let i=t;typeof i=="string"&&(i=this.getTexture(t),i||(e=0,this.videoStreams[t].active=!1,this.videoStreams[t].checkScreens=!0)),this.pxlEnv.camScreenData.screenGeoList.forEach((s,r)=>{s.material.uniforms.camExists.value=e,s.material.uniforms.videoFeed.value=i})}isActive(e){let t=!1;return this.videoStreams.hasOwnProperty(e)?this.videoStreams[e].active&&this.videoStreams[e].videoTexture&&(t=!0):t=this.videoStills[e].texture!=null,t}getTexture(e){let t=null;return this.videoAudioEvent[e]?(this.videoStreams[e].videoTexture||(this.videoStreams[e].videoTexture=this.buildVideoTexture(e)),t=this.videoStreams[e].videoTexture):this.videoStills[e].texture&&(t=this.videoStills[e].texture),t}buildVideoTexture(e){return this.disposeVideoTexture(e),this.videoStreams[e].obj&&this.videoStreams[e].player?this.pxlUtils.getVideoTexture(this.videoStreams[e].obj):null}disposeVideoTexture(e,t=null){this.videoStreams[e].videoTexture&&(this.videoStreams[e].videoTexture.dispose(),this.videoStreams[e].videoTexture=null,this.videoStreams[e].checkScreens=t===null?!0:t)}resetvideoTexture(e){this.setScreensToStreams(0,e),this.disposeVideoTexture(e,!1);let t=this.getTexture(e);this.videoStreams[e].videoTexture=t,this.videoStreams[e].checkScreens=!0}resetEnvSettings(e){this.resetvideoTexture(e),this.videoStreams[e].checkScreens=!1}hlsPreflight(){let e=window.MediaSource||window.WebKitMediaSource;e=e&&typeof e.isTypeSupported=="function"&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"');let t=window.SourceBuffer||window.WebKitSourceBuffer;return t=(!t||t.prototype)&&typeof t.prototype.appendBuffer=="function"&&typeof t.prototype.remove=="function",e&&t}buildVideoStream(e,t=!1){let i=this,s=this.videoStreams[e].obj;typeof this.IVSPlayer!="undefined"?this.buildIvsPlayer(e):this.pxlFile.loadScript("https://player.live-video.net/1.1.2/amazon-ivs-player.min.js").then(()=>{i.buildIvsPlayer(e)})}buildVhsPlayer(e){if(this.videojs){this.videoStreams[e].mode=1;let t=this.videoStreams[e].obj,i=this.videojs(t,{controls:!1,autoplay:!0,preload:"auto"});this.videojs.log.level("off"),this.videojs.log.level("error"),this.videoStreams[e].player=i;let s=this;i.ready(function(){let r=i.play();r&&r.catch(function(a){document.addEventListener("click",function o(n){let h=i.networkState();(h===1||h===2)&&(i.play(),document.removeEventListener("click",o))})})}),i.on("play",r=>{s.ready(e)}),i.on("loadedmetadata",r=>{s.start(e)}),i.on("waiting",r=>{let a=i.currentTime(),o=i.duration();o>0&&setTimeout(()=>{let n=i.currentTime(),h=i.duration();a===n&&o===h&&this.pxlFile.urlExists(i.src()).then(u=>{u||s.ended(e)}).catch(()=>{s.ended(e)})},500)}),i.on("ended",r=>{s.ended(e)}),i.on("error",r=>{s.ended(e)})}else this.buildFallbackPlayer(e)}buildHlsPlayer(e){if(this.Hls&&this.Hls.isSupported()){this.videoStreams[e].mode=4;let i=this.videoStreams[e].obj;var t=new this.Hls({enableWorker:!0,liveBackBufferLength:900,startLevel:2,stretchShortVideoTrack:!0,nudgeOffset:.5,fragLoadingTimeOut:2e3});t.attachMedia(i),this.videoStreams[e].player=t;let s=this;t.on(this.Hls.Events.MEDIA_ATTACHED,function(r){s.ready(e)}),t.on(this.Hls.Events.BUFFER_CREATED,function(r){}),t.on(this.Hls.Events.MANIFEST_PARSED,function(r){s.start(e)}),t.streamController.onMediaEnded=function(r){s.ended(e)},t.on(this.Hls.Events.ERROR,function(r,a){a.fatal?s.ended(e):(a.details==="bufferFullError"||a.details==="bufferAppendingError")&&t.recoverMediaError()}),t.on(this.Hls.Events.STREAM_STATE_TRANSITION,function(r,a){a.previousState==="PARSED"&&a.nextState==="IDLE"&&(s.videoStreams[e].activeLevel=t.currentLevel,t.currentLevel===-1&&setTimeout(()=>{t.currentLevel===-1&&t.recoverMediaError()},1e3))})}else this.buildFallbackPlayer(e)}sendModMessage(e,t,i){let s={msg:e,init:t,data:i};this.pxlEnv.pxlSocket.sendErrorMsg(s)}buildFallbackPlayer(e){let t=this.videoStreams[e].obj;this.videoStreams[e].mode=2,t.setAttribute("src",this.videoStreams[e].urlStatus?this.videoStreams[e].url:"");let i=this;t.addEventListener("error",function(s,r){}),t.addEventListener("loadedmetadata",function(s){i.ready(e)}),t.addEventListener("canplay",function(s){t.play(),i.start(e)}),t.addEventListener("suspend",function(s){i.ended(e)}),t.addEventListener("ended",function(s){i.ended(e)})}buildIvsPlayer(e){if(this.IVSPlayer.isPlayerSupported){this.videoStreams[e].mode=3;let t=this.videoStreams[e].obj,i=this.IVSPlayer.create();i.attachHTMLVideoElement(t),i.setAutoplay(!0),i.setLogLevel("Error"),this.videoStreams[e].loading=!0,this.videoStreams[e].player=i,this.videoStreams[e].checkScreens=!1;let s=this,r=this.IVSPlayer.PlayerState;i.addEventListener(r.READY,o=>{s.ready(e)}),i.addEventListener(r.PLAYING,o=>{s.start(e)}),i.addEventListener(r.ENDED,o=>{s.ended(e)});let a=this.IVSPlayer.PlayerEventType;i.addEventListener(a.ERROR,(o,n,h,u)=>{s.ended(e,o)})}else this.buildFallbackPlayer(e)}unload(e){}load(e,t){let i=this.videoStreams[e];if(i)switch(i.mode){case 1:this.videoStreams[e].url=t,i.player.src({type:"application/x-mpegURL",src:t}),i.player.load();break;case 2:i.obj.setAttribute("src",t),i.obj.load();break;case 3:i.player.load(t);break;case 4:i.player&&this.destroyPlayer(e,!0),i.player.attachMedia(this.videoStreams[e].obj);var s=decodeURIComponent(t);i.player.loadSource(s);break;default:break}}newStream(e){}canUnmute(e){let t=!0;return this.videoStreams[e]&&(t=this.videoStreams[e].active),t}setMuted(e,t=!1){let i=this.videoStreams[e];i&&(i.obj.muted=t)}setVolume(e,t){let i=this.videoStreams[e];i&&(i.obj.volume=t)}getStreamState(e){let t=!1,i=this.videoStreams[e];switch(i.mode){case 1:t=!i.obj.paused;break;case 2:t=!i.obj.paused;break;case 3:let s=i.player;t=s.core.isLoaded&&!s.core.paused;break;case 4:t=i.player.streamController.lastCurrentTime!=null;break;default:break}return t}checkVideoError(e){let t=this.videoStreams[e];t.active&&t.mode===4&&(t.obj.videoWidth===0?!t.obj.paused&&t.player.streamController.lastCurrentTime>10&&(this.destroyPlayer(e),this.videoStreams[e].active=!1,this.checkForDjStream=!0,this.buildHlsPlayer(e),this.videoStreams[e].player.recoverMediaError()):t.obj.webkitDecodedFrameCount===t.prevFrame?(this.videoStreams[e].prevFrameCount+=1,this.videoStreams[e].prevFrameCount>50&&(this.videoStreams[e].prevFrameCount=0,this.videoStreams[e].player.recoverMediaError(),this.videoStreams[e].player.nextLoadLevel=Math.max(0,this.videoStreams[e].player.currentLevel-1),this.videoStreams[e].player.recoverMediaError())):(this.videoStreams[e].prevFrame=t.obj.webkitDecodedFrameCount,this.videoStreams[e].player.nextLevel!==-1&&(this.videoStreams[e].player.nextLevel=-1),this.videoStreams[e].prevFrameCount=0))}ready(e){this.videoStreams[e].loading=!1,this.videoStreams[e].obj.volume=0,this.videoStreams[e].activeLevel=1}start(e){let t=this.videoStreams[e];if(t.active)return;let i=this.getStreamState(e);this.videoStreams[e].active=i,this.videoStreams[e].videoTexture||(this.videoStreams[e].videoTexture=this.getTexture(e)),this.pxlAudio.isVideoObject=!0,this.videoStreamFailCount=0,this.checkForDjStream=!1,this.videoStreams[e].checkScreens=!0,this.pxlAudio.djAudioObj.byScript=!0;let s=this.pxlAudio.djAudioObj;s.children[0].setAttribute("src",""),s.pause(),s.muted=!0,setTimeout(()=>{s.load(),setTimeout(()=>{this.pxlAudio.roomAudioStopped&&(t.obj.volume=this.pxlAudio.djAudioVolume),t.obj.muted=this.pxlAudio.djMuted||!this.pxlAudio.roomAudioStopped,t.obj.click()},20)},20)}restart(e){let t=!1,i=this.videoStreams[e].player,s=this.videoStreams[e].obj;switch(this.videoStreams[e].mode){case 1:case 2:t=!s.paused;break;case 3:t=i.core.isLoaded&&!i.core.paused;break;case 4:t=i.currentLevel>-1;break;default:break}this.videoStreams[e].active=t,this.videoStreams[e].checkScreens=t}ended(e){let t=this.videoStreams[e];if(!t.active)return;this.destroyPlayer(e);let i=t.mode===4?!t.player.liveTracker.atLiveEdge():!t.obj.paused;this.videoStreams[e].active=i,this.checkForDjStream=this.videoAudioEvent.dj,this.pxlAudio.isVideoObject=!1,this.videoStreams[e].checkScreens=!0,this.pxlAudio.roomAudioStopped&&(t.obj.volume=0),t.obj.pause(),t.obj.muted=!0,this.pxlAudio.djAudioObj.byScript=!0;let s=this.pxlAudio.djAudioObj,r=s.children[0];r.getAttribute("src")===""&&(r.setAttribute("src",this.pxlAudio.djUrlSource),s.load(),s.muted=this.pxlAudio.djMuted||!this.pxlAudio.roomAudioStopped,s.play()),this.videoStreams[e].prevCheck=this.pxlUtils.curMS+15,this.videoStreams[e].activeLevel=-1}error(e,t){let i;typeof t=="object"?i=t.type:i=t,["ErrorNetworkIO","networkError","mediaError","internalException"].includes(i)&&(this.videoStreams[e].active=!1)}destroyPlayer(e,t=!1){this.videoStreams[e].mode===4&&(this.videoStreams[e].active||t)&&this.videoStreams[e].player&&this.videoStreams[e].player.detachMedia()}async streamState(e){let t=!0,i=!0;this.videoStreams.dj&&(t=!this.videoStreams.dj.active),this.videoStreams.performer&&(i=!this.videoStreams.performer.active),e.hasOwnProperty("dj")===!0&&t&&(this.checkForDjStream=e.dj&&this.videoAudioEvent.dj),e.hasOwnProperty("performer")===!0&&i&&(this.checkForPerformerStream=e.performer&&this.videoAudioEvent.performer)}async checkVideoStreamStatus(e){let t=this.videoStreams[e];t&&this.checkForDjStream&&this.posted&&!t.active&&t.prevCheck+t.delayCheck<this.pxlUtils.curMS&&(this.checkForDjStream=!1,this.pxlFile.urlExists(this.videoStreams[e].url).then(i=>{this.videoStreams[e].urlStatus=i,this.checkForDjStream=!i,this.videoStreams[e].prevCheck=this.pxlUtils.curMS,this.videoStreams[e].checkResolve=this.pxlUtils.curMS,i?this.load(e,this.videoStreams[e].url):this.videoStreamFailCount+=1}).catch(i=>{console.log(i),this.videoStreamFailCount+=1,this.checkForDjStream=!0,this.videoStreams[e].prevCheck=this.pxlUtils.curMS}))}};var ce={Utils:Si,FileIO:qe,QualityController:Fi,CookieManager:Oi,Timer:Ui,User:Gi,Device:Ni,Colliders:Hi,Animation:ji,Rendering:Ki,Environment:qi,GUI:Ji,HUD:es,Camera:ss,AutoCamera:rs,Extensions:ti,MusicUtils:ns,Audio:ls,Video:hs};var aa={};ve(aa,{camPosVert:()=>Kn,defaultShiftVert:()=>jn,defaultVert:()=>Hn,discardFrag:()=>zn,shaderHeader:()=>R});function R(){return`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
    #else
      precision mediump float;
    #endif
        `}function Hn(){let l=R();return l+=`
varying vec2 vUv;
void main(){
  vUv=uv;
  vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);
  gl_Position = projectionMatrix*modelViewPosition;
}`,l}function jn(){let l=R();return l+=`
varying vec2 vUv;
varying vec2 vUvShift;
void main(){
  vUv=uv;
      vUvShift=uv-.5;
  vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);
  gl_Position = projectionMatrix*modelViewPosition;
}`,l}function Kn(){let l=R();return l+=`
varying vec3 camPos;
varying vec2 vUv;
void main(){
  vUv=uv;
  vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);
  gl_Position = projectionMatrix*modelViewPosition;
  camPos=(modelViewMatrix*vec4(0.0,0.0,1.0,1.0)).xyz;
}`,l}function zn(){let l=R();return l+=`
void main(){
  discard;
  gl_FragColor=vec4(.0,.0,.0,0.0);
}`,l}var oa={};ve(oa,{animTextureFrag:()=>qn,animTextureVert:()=>Wn,clickableBevelFrag:()=>Xn,clickableBevelVert:()=>Yn,portalBaseFrag:()=>Zn,portalBaseVert:()=>Jn});function Wn(){let l=R();return l+=`
varying vec2 vUv;
void main(){
  vUv=uv;
  vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);
  gl_Position = projectionMatrix*modelViewPosition;
}`,l}function qn(){let l=R();return l+=`
uniform vec2 time;
uniform float rate;
uniform float freq;
uniform float intensity;
uniform vec3 glowColor;
uniform sampler2D glowTexture;
varying vec2 vUv;
float pi=3.14159265358979;

void main(){
  vec4 glowCd=texture2D(glowTexture, vUv);
  vec4 Cd=vec4(glowColor,1.0);
  Cd.rgb*=(cos(glowCd.g*pi*freq+time.x*rate)*.5+.5)*(1.0-glowCd.b)*intensity+glowCd.b;
  Cd.rgb*=glowCd.r*glowCd.a;
  gl_FragColor=Cd;
}`,l}function Yn(){let l=R();return l+=`
uniform vec2 time;
uniform float rate;
varying vec3 pos;
varying float nDot;
varying vec2 vUv;

void main(){
  vUv=uv+vec2(rate*time.x, 0.0);
  vec3 camDir=normalize( (projectionMatrix*viewMatrix*vec4(0.0,0.0,-1.0,1.0)).xyz );
  nDot=dot( normal, camDir );

  pos=position;
  vec4 modelViewPosition=modelViewMatrix * vec4(pos, 1.0);
  gl_Position = projectionMatrix*modelViewPosition;

}`,l}function Xn(){let l=R();return l+=`
uniform sampler2D alphaMap;
uniform sampler2D cloudNoise;
uniform vec2 time;
uniform vec2 intensity;
uniform float rate;
varying vec3 pos;
varying float nDot;
varying vec2 vUv;

void main() {
  vec4 Cd=vec4( 1.0 );
  Cd.rgb= mix( vec3(.05,.1,.5), vec3(.3,.5,1.0), intensity.x);

  vec2 nUV=pos.xy*.01+vec2(time.x*rate*.1, time.x*rate*.1);
  vec4 noiseCd=texture2D(cloudNoise,nUV);
  noiseCd.xyz=noiseCd.xyz*2.0-1.0;
  nUV=vUv+noiseCd.xy*.05;

  float alpha=texture2D(alphaMap,nUV).r;
  float blender=(nDot*.5+.5);
  Cd.rgb=Cd.rgb*(1.0+alpha);//mix( vec3(0.5,0.5,1.0), vec3(0.0,0.2,0.8), blender); // Center Color, Edge Color
  alpha=1.0-(1.0-alpha)*(1.0-alpha);
  alpha*=alpha;
  Cd.a=alpha+alpha;
  gl_FragColor = Cd;
}`,l}function Jn(){let l=R();return l+=`
uniform vec2 time;
uniform float rate;
varying vec2 shiftUv;
varying vec2 wUv;

void main(){
    shiftUv=(uv-.5);

    float t=time.x*rate;
    vec2 rot=vec2( sin(t), cos(t) );
    vec2 rotUV=vec2(0.0);
    rotUV.x=rot.y*(uv.x-.5) + rot.x*(uv.y-.5);
    rotUV.y=rot.y*(uv.y-.5) - rot.x*(uv.x-.5);
    wUv=rotUV+.5;

    vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);
    gl_Position = projectionMatrix*modelViewPosition;

}`,l}function Zn(){let l=R();return l+=`
uniform vec3 color;
uniform sampler2D alphaMap;
uniform sampler2D cloudNoise;
uniform vec2 intensity;
varying vec2 shiftUv;
varying vec2 wUv;

#define TAU 6.28318530717958
void main() {
    float suvLength=length(shiftUv)+.1;
    vec2 suvSign=sign(shiftUv);

    vec2 rUv=sin( (suvLength+wUv*10.*shiftUv)*.5 );
    rUv *= suvLength ;

    vec4 noiseCd=texture2D(cloudNoise,rUv);
    vec2 aUv=wUv*(noiseCd.xy*.5+wUv);

    float alpha=texture2D(alphaMap,aUv).r;

    vec4 Cd=vec4( color*intensity.x*(1.0+alpha)*mix( noiseCd.rgb, vec3(1.0), alpha), 1.);
    alpha*=max(0.0, alpha-noiseCd.r*noiseCd.g*noiseCd.b );
    Cd.a=min(1.0, alpha);

    gl_FragColor = Cd;
}`,l}var na={};ve(na,{itemBaseFrag:()=>tl,itemBaseVert:()=>el,itemFrag:()=>sl,itemVert:()=>il,itemZoomFrag:()=>rl,pxlPrincipledFrag:()=>us,pxlPrincipledVert:()=>cs,rgbaMapFrag:()=>$n});function $n(){let l=R();return l+=`
uniform sampler2D rgbMap;
uniform sampler2D alphaMap;

varying vec2 vUv;

main(){
  vec3 rgb=texture2D( rgbMap, vUv ).rgb;
  float alpha=texture2D( alphaMap, vUv ).r;

  vec4 outCd = vec4( rgb, alpha );
  gl_FragColor=outCd;
}
`,l}function el(){let l=R();return l+=`
uniform vec2 time;
uniform float intensity;
uniform float rate;
varying vec3 pos;
varying float nDot;
varying vec2 vUv;

void main(){
  vUv=uv+vec2(rate*time.x, 0.0);
  vec3 camDir=normalize( (projectionMatrix*viewMatrix*vec4(0.0,0.0,-1.0,1.0)).xyz );
  nDot=dot( normal, camDir );

  pos=position;
  vec4 modelViewPosition=modelViewMatrix * vec4(pos, 1.0);
  gl_Position = projectionMatrix*modelViewPosition;

}`,l}function tl(){let l=R();return l+=`
uniform vec3 color;
uniform sampler2D alphaMap;
uniform sampler2D cloudNoise;
uniform vec2 time;
uniform float intensity;
uniform float rate;
varying vec3 pos;
varying float nDot;
varying vec2 vUv;

void main() {
  vec4 Cd=vec4( color, 1.0);

  vec2 nUV=pos.xy*.01+vec2(time.x*rate*.1, time.x*rate*.1);
  vec4 noiseCd=texture2D(cloudNoise,nUV);
  noiseCd.xyz=noiseCd.xyz*2.0-1.0;
  nUV=vUv+noiseCd.xy*.05;

  float alpha=texture2D(alphaMap,nUV).r;
  float blender=(nDot*.5+.5);
  Cd.rgb=color*intensity*(1.0+alpha);//mix( vec3(0.5,0.5,1.0), vec3(0.0,0.2,0.8), blender); // Center Color, Edge Color
  alpha=1.0-(1.0-alpha)*(1.0-alpha);
  alpha*=alpha;
  Cd.a=alpha+alpha;
  gl_FragColor = Cd;
}`,l}function il(){let l=R();return l+=`
uniform vec2 time;
uniform float intensity;
uniform float rate;
varying vec3 pos;
varying float nDot;
varying vec2 vUv;
varying vec2 nUv;

void main(){
  vUv=uv;
  nUv=uv*.5+vec2(rate*time.x*-.1, 0.0);
  nUv.x=sin(nUv.x)*.5+.5;
  vec3 camDir=normalize( (projectionMatrix*viewMatrix*vec4(0.0,0.0,-1.0,1.0)).xyz );
  nDot=dot( normal, camDir );

  vec2 nUV=position.xy*.01+vec2(time.x*rate*.1, time.x*rate*.1);
  vec3 pos=position;
  vec4 modelViewPosition=modelViewMatrix * vec4(pos, 1.0);
  gl_Position = projectionMatrix*modelViewPosition;

}`,l}function sl(){let l=R();return l+=`
uniform vec3 color;
uniform sampler2D alphaMap;
uniform vec2 time;
uniform float intensity;
uniform float rate;
uniform sampler2D cloudNoise;
varying vec3 pos;
varying float nDot;
varying vec2 vUv;
varying vec2 nUv;

void main() {
  vec4 Cd=vec4( color, 1.0);
  float alpha=texture2D(alphaMap,vUv).r;
  float noise=length(texture2D(cloudNoise,nUv).rgb)*.5;
  float blender=(nDot*.5+.5);
  Cd.rgb=color*blender;
  Cd.rgb*=intensity*alpha;
  Cd.a=blender*alpha+noise*alpha;
  gl_FragColor = Cd;
}`,l}function rl(){let l=R();return l+=`
uniform sampler2D color;
uniform vec2 time;
uniform float intensity;
uniform sampler2D cloudNoise;
varying vec2 vUv;

void main() {
  vec4 Cd=texture2D(color,vUv);
  Cd.a=Cd.b;
  Cd.rgb=vec3( Cd.rg*Cd.a, 0.0 );
  Cd.rgb*=Cd.a* mix(.7, 1.0, gl_FrontFacing);
  gl_FragColor = Cd;
}`,l}import{ShaderChunk as ii}from"three";function cs(l=!1){let e=`
    attribute vec3 color;
    attribute vec3 shading;

    varying float vFlicker;
    varying vec2 vUv;
    varying vec3 vCd;
    varying vec3 vPos;
    varying vec3 vLocalPos;
    varying vec3 vN;
    varying vec3 vLocalN;
    varying vec3 vShading;
    `;return l&&(e+=`
        ${ii.common}
        ${ii.shadowmap_pars_vertex}
      `),e+=`
void main(){
    vUv=uv;

    vShading=shading;

    vCd=color;

    vec3 transformed = vec3( position );
    vec3 objectNormal = vec3( normal );
    vec3 transformedNormal = objectNormal;

    vLocalPos = position;
    vN = (modelViewMatrix * vec4(normal, 0.0)).xyz;
    vLocalN = ( modelMatrix * vec4(normal, 0.0)).xyz;
    vec4 mvPos=modelViewMatrix * vec4(position, 1.0);
    gl_Position = projectionMatrix*mvPos;
    vPos = mvPos.xyz;
    `,l&&(e+=`
            ${ii.worldpos_vertex}
            ${ii.shadowmap_vertex}
          `),e+=`
    }`,e}function us(l,e,t,i,s,r){let a=!1,o=1;l.hasOwnProperty("Specular")&&l.Specular>0&&(a=!0,o=l.Specular);let n=!1;l.PointColor&&(n=!0);let h=!0,u="1.0";l.hasOwnProperty("SurfaceNoise")&&(l.SurfaceNoise%1===0&&(u=l.SurfaceNoise+".0"),u==="0.0"&&(h=!1));let c=`
        `;if(e||(c+="uniform sampler2D dTexture;"),c+=`
uniform sampler2D noiseTexture;
uniform sampler2D detailTexture;

uniform vec2 time;
uniform float cdMult;
uniform vec3 fogColor;

varying vec2 vUv;
varying vec3 vCd;
varying vec3 vPos;
varying vec3 vLocalPos;
varying vec3 vN;
varying vec3 vLocalN;
varying vec3 vShading;

varying float vFlicker;

#define PI 3.14159265358979

struct PointLight {
  vec3 color;
  float decay;
  float distance;
  vec3 position;
};
struct DirLight {
  vec3 color;
  vec3 direction;
};
`,i&&(c+=`
#if NUM_POINT_LIGHTS > 0
  uniform PointLight pointLights[NUM_POINT_LIGHTS];
#endif
#if NUM_DIR_LIGHTS > 0
  uniform DirLight directionalLights[NUM_DIR_LIGHTS];
#endif
  `),s&&(c+=`
${ii.packing}

#if NUM_POINT_LIGHT_SHADOWS > 0
    uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
    varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
    struct PointLightShadow {
        float shadowBias;
        float shadowNormalBias;
        float shadowRadius;
        vec2 shadowMapSize;
        float shadowCameraNear;
        float shadowCameraFar;
    };
    uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
#endif
float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
    return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
}
vec2 cubeToUV( vec3 v, float texelSizeY ) {
    vec3 absV = abs( v );
    float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
    absV *= scaleToCube;
    v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
    vec2 planar = v.xy;
    float almostATexel = 1.5 * texelSizeY;
    float almostOne = 1.0 - almostATexel;
    if ( absV.z >= almostOne ) {
        if ( v.z > 0.0 )
            planar.x = 4.0 - v.x;
    } else if ( absV.x >= almostOne ) {
        float signX = sign( v.x );
        planar.x = v.z * signX + 2.0 * signX;
    } else if ( absV.y >= almostOne ) {
        float signY = sign( v.y );
        planar.x = v.x + 2.0 * signY + 2.0;
        planar.y = v.z * signY - 2.0;
    }
    return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
}
float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
    vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
    vec3 lightToPosition = shadowCoord.xyz;
    float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );
     dp += shadowBias;
    vec3 bd3D = normalize( lightToPosition );
    #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
        vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
        return (
            texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
            texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
            texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
            texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
            texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
            texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
            texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
            texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
            texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
        ) * ( .11111111111 ) * (1.0-dp);
    #else
        return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) * (1.0-dp);
    #endif
}

vec3 directionToLight( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar  ){
    vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
    vec3 lightToPosition = shadowCoord.xyz;
    float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );
    dp += shadowBias;
    vec3 bd3D = normalize( lightToPosition );
    vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
    return texture2D( pointShadowMap[0], cubeToUV( bd3D, texelSize.y )).rgb;
}
`),c+=`
void main(){
  `,n)c+="vec3 vertCd = vCd;";else if(e){let m=v=>v%1===0?v+".0":v+"",A=m(e.r),f=m(e.g),C=m(e.b);c+=`vec3 vertCd = vec3( ${A}, ${f}, ${C} ) ;`}else c+="vec3 vertCd = texture2D(dTexture,vUv).rgb ;";c+=`

        vec4 Cd=vec4( vertCd, 1.0 );
        float specular = 0.0;
        `,t&&(c+=`
          float depth = gl_FragCoord.z / gl_FragCoord.w *.0004;
          Cd.rgb=  mix( Cd.rgb, fogColor, depth );
          `);let p="",d="",g="";if(h&&(u!=="1.0"&&(p="*"+u),c+=`
            float detailMult = (texture2D(detailTexture,vUv*4.0).r)*.5+.5;
            `,d=`+detailMult * (shadowInf*.5+.5) ${p}`,g=`(detailMult+.5) ${p}`),i&&(c+=`
          #if NUM_POINT_LIGHTS > 0 || NUM_DIR_LIGHTS > 0
            vec4 lights = vec4(0.0, 0.0, 0.0, 1.0);
          #endif

          #if NUM_POINT_LIGHTS > 0
            for(int i = 0; i < NUM_POINT_LIGHTS; i++) {
                vec3 lightVector = normalize(vPos - pointLights[i].position);
                vec3 lightInf= clamp(dot(-lightVector, vN), 0.0, 1.0) * pointLights[i].color;
                //lightInf = mix( lightInf, 1.0-(1.0-lightInf)*(1.0-lightInf), .2);
                float distFalloff =  1.0-min(1.0, length(vPos - pointLights[i].position) * pointLights[i].decay*.008 );
                lightInf *=  distFalloff;
                lights.rgb += lightInf;
                `,a&&(c+=`
                  distFalloff = (dot(vN, normalize(-vPos)) )*distFalloff;
                  specular += distFalloff;
                  `),c+=`
            }
          #endif

          #if NUM_DIR_LIGHTS > 0
            for(int i = 0; i < NUM_DIR_LIGHTS; i++) {
                vec3 lightInf= max(0.0, dot(directionalLights[i].direction, vN)*.65+.35) * directionalLights[i].color;
                lights.rgb += lightInf;
            }
          #endif

          #if NUM_POINT_LIGHTS > 0 || NUM_DIR_LIGHTS > 0
            Cd.rgb *= lights.rgb;
          #endif
          `,a&&(c+=`
            Cd.rgb += vertCd * specular * ${o};
            `)),s){c+=`
          #if NUM_POINT_LIGHT_SHADOWS > 0

            float shadowInf = 0.0;
            float detailInf = 0.0;
            float lShadow = 0.0;
            int i = 0;
            `;for(let m=0;m<r;++m)c+=`
                i=${m};
                lShadow = getPointShadow( pointShadowMap[${m}], pointLightShadows[i].shadowMapSize, pointLightShadows[i].shadowBias*.75, pointLightShadows[i].shadowRadius*1.65, vPointShadowCoord[i], pointLightShadows[i].shadowCameraNear, pointLightShadows[i].shadowCameraFar );
                shadowInf = max( lShadow, shadowInf);
                `;c+=`
            shadowInf = shadowInf;
            Cd.rgb*=shadowInf ${d} ;
            `,h&&(c+=`
              #else
                Cd.rgb*=${g};
              `),c+=`
          #endif
          `}else h&&(c+=`
            Cd.rgb*=${g};
            `);return c+=`
        Cd*=cdMult;

        // Convert to sRGB
        Cd.rgb = mix( 12.92 * Cd.rgb, 1.055 * pow(Cd.rgb, vec3(1.0 / 2.4)) - 0.055, step(0.0031308, Cd.rgb) );

        gl_FragColor=Cd;
    }`,c}var Aa={};ve(Aa,{dustFrag:()=>Tt,dustSettings:()=>ha,dustVert:()=>Rt,emberWispsFrag:()=>As,emberWispsSettings:()=>la,emberWispsVert:()=>ps,heightMapFrag:()=>fs,heightMapSettings:()=>ca,heightMapVert:()=>ds,smokeFrag:()=>gs,smokeSettings:()=>ua,smokeVert:()=>ms,snowFallFrag:()=>ol,snowFallVert:()=>al,snowSettings:()=>pa});var la={BaseSpeed:.77,EmberSpread:10,EmberFadeDistance:.04,ShiftFromZero:.6,MultPosXZ:1.313};function ps(l={}){l=Object.assign({},la,l);let e=i=>(i+"").includes(".")?i:i+".0",t=`
// Ember Settings
  const vec3 EmberEarlyCd = vec3( 0.8, 0.5, .1 );
  const vec3 EmberOldCd = vec3( 0.634, 0.20, 0.20 );
  const float BaseSpeed = ${e(l.BaseSpeed)};
  const float EmberSpread = ${e(l.EmberSpread)};
  const float EmberFadeDistance = ${e(l.EmberFadeDistance)};
  const float ShiftFromZero = ${e(l.ShiftFromZero)};
  const float MultPosXZ = ${e(l.MultPosXZ)};

// -- -- --
  `;return t+=R(),t+=`
// -- -- --

uniform sampler2D noiseTexture;
uniform vec2 time;
uniform vec3 windDir;
uniform vec3 offsetPos;
uniform float rate;
uniform float pointScale;

attribute vec4 seeds;
attribute vec2 atlas;

varying vec3 vCd;
varying vec2 vAtlas;
varying vec2 vRot;
varying float vAlpha;
varying float vBrightness;

float colDetect( vec2 pos, vec2 pt, vec2 n1, vec2 n2 ){
    vec2 ref=pos-pt;
    float ret = step( dot( ref, n1 ), 0.0 );
    ret *= step( dot( ref, n2 ), 0.0 );

    return ret;
}

void main(){
    vAtlas=atlas;

    float rot=seeds.z+time.x*seeds.z*3.;
    vRot=vec2( sin(rot), cos(rot) );

    vec3 pOff=vec3(seeds.z, seeds.y, seeds.w) ;

    vec2 sinUV=abs(sin(pOff.xz*.5+seeds.zw+time.x*.1)*.5+.5);
    vec3 noiseCd=texture2D(noiseTexture, sinUV ).rgb*4.5 + 0.50;

    float rateShift = (BaseSpeed*(seeds.x*.4+.6));
    float t=time.x*rate*rateShift;

    // Random shift to a cycle y movement
    //float shiftY= mod( t+t*seeds.x+seeds.z*8.0+noiseCd.r*10.20*(seeds.y*2.0-1.0)+noiseCd.b+(-seeds.x+seeds.y)*4.0, 10.0);

    float shiftY = (t+t*seeds.x+seeds.z*8.0+noiseCd.r*10.20*(seeds.y*2.0-1.0)+noiseCd.b+(-seeds.x+seeds.y)*4.0) * 0.1;
    float lifePerc = fract( shiftY );
    float loopSeed = floor( shiftY ) * seeds.w * 20.0;
    shiftY = lifePerc * 10.0;

    // Change up ages of embers
    float fadeDrop = min(1.0, lifePerc*lifePerc*4. );
    //
    float life = 1.0-max(0.0,abs(shiftY-seeds.x*.1)*(1.0-(seeds.x*1.0)) );
    life = 1.0-((shiftY*.001-seeds.x*.2) );

    pOff.y=shiftY*seeds.y;

    pOff.y=(pOff.y)+shiftY;
    vec3 pos= pOff ;

    float spreadPerc = min(1.0, life*2.) * EmberSpread;
    pos.xz=fract(noiseCd.rg*noiseCd.r + loopSeed)*(seeds.x)*(life*seeds.zy*fract(seeds.w*30.0 )) * spreadPerc ;

    // Add gap from (0,0) and scale to spread after shift
    pos.x = ( pos.x + (step( 0.0, pos.x )-.5) * ShiftFromZero ) * MultPosXZ;
    pos.z = ( pos.z + (step( 0.0, pos.z )-.5) * ShiftFromZero ) * MultPosXZ;

    // Directional push
    float yPush = ( life * (life*.5+.5))  * min(1.0,pos.y*.03) * 4.2;
    pos.xz += windDir.xz * yPush * max(0.0,pos.y-.5)*(.5+life*.5);
    pos.y += yPush;

    float pToCamLen = length(pos-cameraPosition);
    float pScalar = max( 0., (1.-pToCamLen *  0.0806 )); // 0.0385
    pScalar += max(0.0,pToCamLen - 0.4) * 0.005;

    vAlpha = min(1.0, (seeds.x*.15+.7) * pScalar*3.0 );

    vAlpha=max(0.0, life*life-seeds.z-seeds.z);
    float distMult = ( length( pos )*EmberFadeDistance );
    distMult = 1.0 - ( distMult * distMult );
    vAlpha *= distMult;

    float pScale = pointScale * seeds.w * pScalar + 2.0;

    gl_PointSize =  pScale*fadeDrop ;

    float tightenBase = min( 1.0, pos.y* 0.12 + .32 );
    pos.xz *= tightenBase*tightenBase;

    // Apply Offset Position and move to camera space
    vec4 mvPos=modelViewMatrix * vec4(pos+offsetPos, 1.0);
    gl_Position = projectionMatrix*mvPos;

    float cdAge = clamp( 1.0 - life, 0.0, 1.0);

    vCd = mix( EmberEarlyCd, EmberOldCd, cdAge )  ;

    vBrightness = 1.045 + fadeDrop*2.;
}`,t}function As(){let l=R();return l+=`
uniform sampler2D atlasTexture;
uniform vec2 time;
uniform float rate;

varying vec3 vCd;
varying vec2 vAtlas;
varying vec2 vRot;
varying float vAlpha;
varying float vBrightness;

// -- -- --

// Human Eye Adjusted Luminance
//   https://en.wikipedia.org/wiki/Grayscale
float luma(vec3 color) {
  return dot( color, vec3(0.2126, 0.7152, 0.0722) );
}

// -- -- --

void main(){
    vec2 uv=gl_PointCoord;

    vec2 pos = (uv-.5)*.85;

    vec2 rotUV;
    rotUV.x = vRot.y * pos.x - vRot.x * pos.y;
    rotUV.y = vRot.x * pos.x + vRot.y * pos.y;
    rotUV=(rotUV+.5)*.25+vAtlas;

    vec4 dustCd=texture2D(atlasTexture,rotUV);
    float alpha= clamp( dustCd.a*vAlpha, 0.0, 1.0) ;

    dustCd.rgb *= vBrightness;

    float dirtLuma = luma( dustCd.rgb );
    vec4 Cd=vec4( dirtLuma * vCd * vBrightness, alpha );

    gl_FragColor=Cd;
}`,l}var ha={pOpacity:1,proxDist:200,hasLights:!1,fadeOutScalar:1.59,wanderInf:1,wanderRate:1,wanderFrequency:2.85};function Rt(l={}){l=Object.assign({},ha,l);let e=i=>(i+"").includes(".")?i:i+".0",t=`
    // Fade-Out Influence multiplier
        const float ParticleOpacity = ${e(l.pOpacity)};
        const float FadeOutScalar = ${e(l.fadeOutScalar)};
        const float WanderInf = ${e(l.wanderInf)};
        const float WanderRate = ${e(l.wanderRate)};
        const float WanderFrequency = ${e(l.wanderFrequency)};

        #define PROX ${l.proxDist.toFixed(3)}
        #define PROX_INV 1.0/${(l.proxDist*.8).toFixed(3)}

    // -- -- --
  `;return t+=R(),t+=`
// -- -- --

uniform sampler2D noiseTexture;
uniform vec2 time;
uniform float rate;
uniform vec2 pointScale;
uniform vec3 positionOffset;
uniform vec3 windDir;
`,l.hasLights&&(t+=`
#if NUM_POINT_LIGHTS > 0
  struct PointLight {
    vec3 color;
    float decay;
    float distance;
    vec3 position;
  };
  uniform PointLight pointLights[NUM_POINT_LIGHTS];
#endif
  `),t+=`
attribute vec4 seeds;
attribute vec2 atlas;

varying vec2 vAtlas;
varying vec2 vRot;
varying float vScalar;
varying float vAlpha;

// -- -- --

float colDetect( vec2 pos, vec2 pt, vec2 n1, vec2 n2 ){
    vec2 ref=pos-pt;
    float ret = step( dot( ref, n1 ), 0.0 );
    ret *= step( dot( ref, n2 ), 0.0 );

    return ret;
}

vec3 randomVec( vec3 seed ) {
  return vec3(
    fract( dot(seed,vec3(12.9898, 78.233, 45.164)) * 43758.5453 ),
    fract( dot(seed,vec3(93.9898, 67.345, 12.345)) * 43758.5453 ),
    fract( dot(seed,vec3(54.123, 98.765, 32.123)) * 43758.5453 )
  );
}

// -- -- --

void main(){
    vAtlas=atlas;

    float rot=seeds.z+time.x*(seeds.z*2.);
    vRot=vec2( sin(rot), cos(rot) );

    float t=time.x*rate*0.;

    vec3 pOff=seeds.xyz * vec3(PROX);

    // Loop point positions based on camera location
    float yFract=fract(t+seeds.x);
    pOff.xyz += time.x * windDir.xyz;
    vec3 pos= pOff ;

    vec3 noiseCd=texture2D(noiseTexture, sin(pos.xz*.05+seeds.xz+time.x*2.1) ).rgb-.5;
    vec3 noiseCdb=texture2D(noiseTexture, sin((1.0-pos.xz)*.05+seeds.yw+time.x*.1) ).rgb-.5;

    // -- -- --

    // Meandering points

    vec3 randDirA = randomVec( seeds.xyz );
    vec3 randDirB = randomVec( seeds.wyz );
    vec3 randDirC = randomVec( seeds.zxy );
    vec3 randDirBlend = mix( randDirA, randDirB, sin( randDirC * time.x * WanderFrequency ) ) * WanderInf;

    // -- -- --

    pos += randDirBlend * sin( seeds.x+seeds.z+noiseCd.r*noiseCd.g*seeds.y+noiseCdb.b + (time.x+seeds.y*10.) * WanderRate * seeds.w*noiseCdb.g ) * WanderRate * ( 5. + seeds.z );

    pos += (noiseCd * noiseCdb ) * 50. * ( (seeds.w+.75)*4.);

    pos = mod( pos-cameraPosition, PROX) + cameraPosition - PROX*.5;
    pos+=positionOffset;

    float pScalar = clamp( (1.-length(pos-cameraPosition )*PROX_INV) * FadeOutScalar, 0.0, 1.0  );
    float aMult = min(1.0, pScalar*3.0);
    vAlpha = (seeds.x*.5+.7) * aMult;
`,l.hasLights&&(t+=`
      #if NUM_POINT_LIGHTS > 0
        float lightInf = 1.0;
        for(int x = 0; x < NUM_POINT_LIGHTS; ++x ){
            vec3 lightVector = normalize(pos - pointLights[x].position);
            lightInf = min(lightInf, length(pos - pointLights[x].position) *.05 );
        }
        vAlpha*=(1.0-lightInf)*.8+.2;
      #endif
    `),t+=`
        vScalar = pScalar * ParticleOpacity ;
        float pScale = pointScale.x * (seeds.w*.5+.5)*pScalar + 1.0;
        pScale *= 1.0 - clamp( ((1.0-pScalar)-.5)*10.0 * FadeOutScalar, 0.0, 1.0 );
        pScale *= step( .5, atlas.x )*.5+1.;

        gl_PointSize = pScale;

        vec4 mvPos=viewMatrix * vec4(pos, 1.0);
        gl_Position = projectionMatrix*mvPos;
    }`,t}function Tt(l=!1){let e=R();return e+=`
uniform sampler2D atlasTexture;
uniform sampler2D atlasAlphaTexture;
uniform vec2 time;
uniform float rate;

varying vec2 vAtlas;
varying vec2 vRot;
varying float vScalar;
varying float vAlpha;

void main(){

    if( vAlpha < .01 ){
      discard;
    }

    vec2 uv=gl_PointCoord;

    vec2 pos = (uv-.5)*.85;

    vec2 rotUV;
    rotUV.x = vRot.y * pos.x - vRot.x * pos.y;
    rotUV.y = vRot.x * pos.x + vRot.y * pos.y;
    rotUV=(rotUV+.5)*.25+vAtlas;
`,l?e+=`
        vec4 dustCd=vec4(
                        texture2D(atlasTexture,rotUV).rgb, // rgb
                        texture2D(atlasAlphaTexture,rotUV).r // alpha
                      );

    `:e+=`
        vec4 dustCd= texture2D(atlasTexture,rotUV);

    `,e+=`
        float alpha = clamp( dustCd.a * vAlpha * vScalar, 0.0, 1.0 );
        vec4 Cd=vec4( dustCd.rgb, alpha );

        gl_FragColor=Cd;
    }`,e}var ca={pOpacity:1,proxDist:200,hasLights:!1,fadeOutScalar:1.59,wanderInf:1,wanderRate:1,wanderFrequency:2.85,jumpHeightMult:15};function ds(l={}){l=Object.assign({},ca,l);let e=i=>(i+"").includes(".")?i:i+".0",t=`
    // Fade-Out Influence multiplier
        const float ParticleOpacity = ${e(l.pOpacity)};
        const float FadeOutScalar = ${e(l.fadeOutScalar)};
        const float WanderInf = ${e(l.wanderInf)};
        const float WanderRate = ${e(l.wanderRate)};
        const float WanderFrequency = ${e(l.wanderFrequency)};
        const float JumpHeightMult = ${e(l.jumpHeightMult)};

        #define PROX ${l.proxDist.toFixed(3)}
        #define PROX_INV 1.0/${(l.proxDist*.98).toFixed(3)}

    // -- -- --
  `;return t+=R(),t+=`
// -- -- --

uniform sampler2D heightMap;
uniform sampler2D spawnMap;
uniform vec3 tankSize;

uniform sampler2D noiseTexture;
uniform vec2 time;
uniform float rate;
uniform vec2 pointScale;
uniform vec3 positionOffset;
uniform vec3 windDir;
`,l.hasLights&&(t+=`
#if NUM_POINT_LIGHTS > 0
  struct PointLight {
    vec3 color;
    float decay;
    float distance;
    vec3 position;
  };
  uniform PointLight pointLights[NUM_POINT_LIGHTS];
#endif
  `),t+=`
attribute vec4 seeds;
attribute vec2 atlas;

varying vec3 vCd;
varying vec2 vAtlas;
varying vec2 vRot;
varying float vAlpha;

// -- -- --

float colDetect( vec2 pos, vec2 pt, vec2 n1, vec2 n2 ){
    vec2 ref=pos-pt;
    float ret = step( dot( ref, n1 ), 0.0 );
    ret *= step( dot( ref, n2 ), 0.0 );

    return ret;
}

vec3 randomVec( vec3 seed ) {
  return vec3(
    fract( dot(seed,vec3(12.9898, 78.233, 45.164)) * 43758.5453 ),
    fract( dot(seed,vec3(93.9898, 67.345, 12.345)) * 43758.5453 ),
    fract( dot(seed,vec3(54.123, 98.765, 32.123)) * 43758.5453 )
  );
}

// -- -- --

#define oneThird 0.3333333333333333
#define srgbLow 1.0 / 12.92
#define srgbHigh 1.0 / 1.055

vec3 sRGBToLinear(vec3 srgb) {
  return vec3(
    mix( srgb.r * srgbLow,  pow((srgb.r + 0.055) * srgbHigh, 2.4), step(0.04045, srgb.r) ),
    mix( srgb.g * srgbLow,  pow((srgb.g + 0.055) * srgbHigh, 2.4), step(0.04045, srgb.g) ),
    mix( srgb.b * srgbLow,  pow((srgb.b + 0.055) * srgbHigh, 2.4), step(0.04045, srgb.b) )
  );
}

void main(){
  vAtlas=atlas;

  float rot=seeds.z+time.x*(seeds.z*2.);
  vRot=vec2( sin(rot), cos(rot) );

  float t=time.x*rate;
  vec2 sizeXZ = tankSize.xz;
  vec2 scaleXZ = 1.0 / (sizeXZ);

  vec3 pOff= (seeds.xyz - vec3(0.5,0.0,0.5)) * vec3(PROX);

  // Loop point positions based on camera location
  float yFract=fract(t+seeds.x);
  pOff.xyz += time.x * windDir.xyz;
  vec3 pos= pOff ;

  vec3 noiseCd=texture2D(noiseTexture, sin(pos.xz*.05+seeds.xz+(time.x + seeds.y)*2.1) ).rgb-.5;
  vec3 noiseCdb=texture2D(noiseTexture, sin((1.0-pos.xz)*.05+seeds.yw+time.x*.1) ).rgb-.5;

  // -- -- --

  // Meandering points

  vec3 randDirA = randomVec( seeds.xyz );
  vec3 randDirB = randomVec( seeds.wyz );
  vec3 randDirC = randomVec( seeds.zxy );
  vec3 randDirBlend = mix( randDirA, randDirB, sin( randDirC * (time.x + seeds.w) * WanderFrequency ) ) * WanderInf;

  float jumpHeight = randDirBlend.y * abs(max(noiseCd.x,noiseCd.y));

  // -- -- --

  pos += randDirBlend * sin( seeds.x+seeds.z+noiseCd.r*noiseCd.g*seeds.y+noiseCdb.b + (time.x+seeds.y*10.) * WanderRate * seeds.w*noiseCdb.g ) * WanderRate * ( 5. + seeds.z );
  pos += (noiseCd * noiseCdb ) * 50. * ( (seeds.w+.75)*4.);

  vec3 mPos = modelMatrix[3].xyz;
  pos.xz = mod( pos.xz - cameraPosition.xz , PROX) + cameraPosition.xz - PROX*.5 + positionOffset.xz;

  vec2 fitPos = clamp( ( pos.xz - mPos.xz  ) * scaleXZ + .5, vec2(0.0), vec2(1.0));

  vec3 heightCd=texture2D(heightMap, fitPos ).rgb;
  vec2 spawnOffset = vec2( 0.0161 );
  float spawnInf= min(1.0, texture2D(spawnMap, fitPos ).r +
                  texture2D(spawnMap, fitPos + spawnOffset ).r +
                  texture2D(spawnMap, fitPos - spawnOffset ).r );
  heightCd = sRGBToLinear( heightCd );
  float heightVal = heightCd[0] * oneThird + heightCd[1] * oneThird + heightCd[2] * oneThird;

  pos.y = tankSize.y * heightVal + mPos.y;

  float pScalar = clamp( (1.-length(pos-cameraPosition )*PROX_INV) * FadeOutScalar, 0.0, 1.0  );
  float aMult = min(1.0, pScalar*pScalar*4.0);
  vAlpha = min( 1.0, (seeds.x*.5+.75) * aMult * spawnInf * 2.5 * ParticleOpacity );

  pos.y += max(1.0, (jumpHeight*pScalar + positionOffset.y) * JumpHeightMult * WanderInf);
`,l.hasLights&&(t+=`
      #if NUM_POINT_LIGHTS > 0
        float lightInf = 1.0;
        for(int x = 0; x < NUM_POINT_LIGHTS; ++x ){
            vec3 lightVector = normalize(pos - pointLights[x].position);
            lightInf = min(lightInf, length(pos - pointLights[x].position) *.05 );
        }
        vAlpha*=(1.0-lightInf)*.8+.2;
      #endif

    `),t+=`
        float pScale = pointScale.x * (seeds.w*.25+1.0) * pScalar * 2.;
        pScale *= 1.0 - clamp( ((1.0-pScalar)-.5)*10.0 * FadeOutScalar, 0.0, 1.0 );

        gl_PointSize = pScale;

        vec4 mvPos=viewMatrix * vec4(pos, 1.0);
        gl_Position = projectionMatrix*mvPos;
    }`,t}function fs(l=!1){let e=R();return e+=`
uniform sampler2D atlasTexture;
uniform sampler2D atlasAlphaTexture;
uniform vec3 tint;
uniform vec2 time;
uniform float rate;

varying vec3 vCd;
varying vec2 vAtlas;
varying vec2 vRot;
varying float vAlpha;

void main(){

    if( vAlpha < .01 ){
      discard;
    }

    vec2 uv=gl_PointCoord;

    /*vec2 pos = uv*.25-.125;
    float vis = max(0.0, 1.0-max(0.0,length(pos)-.09)*20.);

    vec2 rotUV;
    rotUV.x = vRot.y * pos.x - vRot.x * pos.y;
    rotUV.y = vRot.x * pos.x + vRot.y * pos.y;
    rotUV=(rotUV+.125) + vAtlas;*/

    vec2 pos = (uv-.5)*.85;

    vec2 rotUV;
    rotUV.x = vRot.y * pos.x - vRot.x * pos.y;
    rotUV.y = vRot.x * pos.x + vRot.y * pos.y;
    rotUV=(rotUV+.5)*.25+vAtlas;
    `,l?e+=`
        vec4 dustCd=vec4(
                        texture2D(atlasTexture,rotUV).rgb, // rgb
                        texture2D(atlasAlphaTexture,rotUV).r // alpha
                      );

    `:e+=`
        vec4 dustCd= texture2D(atlasTexture,rotUV);

    `,e+=`
        float alpha = min(1.0, dustCd.a*1.75) * vAlpha ;
        vec4 Cd=vec4( dustCd.rgb * tint, alpha );

        gl_FragColor=Cd;
    }`,e}var ua={BaseSpread:200,SmokeBrightness:.65,InnerBulster:-.05,SmokeDensity:.12,WindInfluenceBoost:.45,TightenBaseSpread:1,TightenMidSpread:.08,TightenTipSpread:.2};function ms(l={}){l=Object.assign({},ua,l);let e=i=>(i+"").includes(".")?i:i+".0",t=`
// Billowy goodness!
  const float BaseSpread = ${e(l.BaseSpread)};
  const float SmokeBrightness = ${e(l.SmokeBrightness)};
  const float InnerBulster = ${e(l.InnerBulster)};
  const float SmokeDensity = ${e(l.SmokeDensity)};
  const float WindInfluenceBoost = ${e(l.WindInfluenceBoost)};

  const float TightenBaseSpread = ${e(l.TightenBaseSpread)};
  const float TightenMidSpread = ${e(l.TightenMidSpread)};
  const float TightenTipSpread = ${e(l.TightenTipSpread)};

  // -- -- --
  `;return t+=R(),t+=`
// -- -- --

  uniform sampler2D noiseTexture;
  uniform vec2 time;
  uniform float rate;
  uniform vec3 windDir;
  uniform vec3 offsetPos;
  uniform vec2 pointScale;
  uniform vec3 sliders;

  attribute vec4 seeds;
  attribute vec2 atlas;

  varying vec2 vAtlas;
  varying vec2 vRot;
  varying float vAlpha;
  varying float vBrightness;

  #define PROX 6.0

  float colDetect( vec2 pos, vec2 pt, vec2 n1, vec2 n2 ){
    vec2 ref=pos-pt;
    float ret = step( dot( ref, n1 ), 0.0 );
    ret *= step( dot( ref, n2 ), 0.0 );

    return ret;
  }

  void main(){
    vAtlas=atlas;

    float rot=seeds.z+time.x*(seeds.z*2.);
    vRot=vec2( sin(rot), cos(rot) );

    vec3 pOff=vec3(seeds.z, seeds.y, seeds.w) ;

    vec2 sinUV=abs(sin(pOff.xz*.5+seeds.zw+time.x*.1)*.5+.5);
    vec3 noiseCd=texture2D(noiseTexture, sinUV ).rgb*4.5 + 0.50;

    float t=time.x*rate;
    float shiftY= mod( t+t*seeds.x+seeds.z*24.0+noiseCd.r+noiseCd.b+(seeds.x+seeds.y)*2.0, 14.0);
    float life = max(0.0,(shiftY-seeds.x)*0.07142857142857142)*.9+.2;
    float alphaMult = (1.0-(1.0-life)*(1.0-life))*SmokeDensity;

    pOff.y=shiftY*seeds.y*life - (1.0-life);

    pOff.y=(pOff.y)+shiftY;
    vec3 pos= pOff ;

    // Magic numbers!  Boo!!
    float tightenTip = max(0.0,life-.73);
    tightenTip = 1.0 - (1.0-tightenTip) * (1.0-tightenTip);
    //tightenTip *= tightenTip;
    float tightenBase = max(0.0, (1.0-life)*InnerBulster);
    float tightenMid = max(0.0, TightenBaseSpread - tightenTip - tightenBase - seeds.x*.2);

    float curBaseSpread = BaseSpread * tightenBase +
                          BaseSpread * tightenMid * TightenMidSpread +
                          BaseSpread * tightenTip * TightenTipSpread ;

    //pos.xz=clamp((noiseCd.rg*noiseCd.b)*seeds.w, vec2(0.0), vec2(1.0))*curBaseSpread*(life*(seeds.zy*.6));
    pos.xz=(noiseCd.rg*noiseCd.b)*seeds.w*curBaseSpread*life;

    // Wind -- Forces
    //   Magic numbers, yarb!
    float windInf = life * life * (life*.5+.5);
    vec2 curWindDir = windInf * windDir.xz ;

    float yPush = ( life * (life*.5+.5))* min(1.0,pos.y*.12) * .08;
    pos.xz += curWindDir*life + curWindDir * WindInfluenceBoost ;

    // Alpha with cam distance inf
    float pScalar = 1.0-min( 1.0, (length(pos-cameraPosition )*0.004) );
    pScalar=1.0-(pScalar*pScalar);
    float aMult = min(1.0, pScalar*2.0);
    vAlpha = (seeds.x*.5+.7) * aMult;

    // Alpha from gettin' old
    vAlpha=(1.0-life)*min(1.0,alphaMult);
    vec3 doubleCd=texture2D(noiseTexture, sinUV+pos.xz*.5+vec2(seeds.y,pos.y)).rgb ;
    pos.xz=(pos.xz*(0.9+seeds.xy*.2)+doubleCd.rb*10.0)*min(1.0,life+seeds.y);

    // Draw size, particle scale
    pScalar = 1.0-(1.0-pScalar)*.75*(1.0-pScalar);
    float pScale = pointScale.x * seeds.w * 0.6 * pScalar + (175.0+125.0*life*pScalar)*(1.0-pScalar);
    pScale += 150.0*(clamp(-(pScalar-.45)*10.0,0.0,1.0));

    gl_PointSize = pScale;

    // Brightness multiplier
    vBrightness = 1.0-tightenMid*.1 - tightenTip + tightenBase;
    float originDelta = length(pos)*(-InnerBulster);
    vBrightness *= max(0.0, 1.0-originDelta * life * 0.807) * SmokeBrightness;

    // Apply Offset Position and move to camera space
    vec4 mvPos=modelViewMatrix * vec4(pos+offsetPos, 1.0);
    gl_Position = projectionMatrix*mvPos;
  }`,t}function gs(l=!1){let e=R();return e+=`
// -- -- --

uniform sampler2D atlasTexture;
uniform sampler2D atlasAlphaTexture;
uniform vec2 time;
uniform float rate;

varying vec2 vAtlas;
varying vec2 vRot;
varying float vAlpha;
varying float vBrightness;

// -- -- --

// Human Eye Adjusted Luminance
//   https://en.wikipedia.org/wiki/Grayscale
float luma(vec3 color) {
  return dot( color, vec3(0.2126, 0.7152, 0.0722) );
}

// -- -- --

void main(){
    vec2 uv=gl_PointCoord;

    vec2 pos = (uv-.5)*.85;

    vec2 rotUV;
    rotUV.x = vRot.y * pos.x - vRot.x * pos.y;
    rotUV.y = vRot.x * pos.x + vRot.y * pos.y;
    rotUV=(rotUV+.5)*.25+vAtlas;
    `,l?e+=`
        vec4 dustCd=vec4(
                        texture2D(atlasTexture,rotUV).rgb, // rgb
                        texture2D(atlasAlphaTexture,rotUV).r // alpha
                      );

    `:e+=`
        vec4 dustCd= texture2D(atlasTexture,rotUV);

    `,e+=`
        float alpha=dustCd.a*vAlpha;
        vec4 Cd=vec4( dustCd.rgb, alpha );

        float lumaCd = luma( Cd.rgb );

        Cd.rgb = mix( vec3( lumaCd ), Cd.rgb, vBrightness*.2 );

        Cd.rgb *= vec3(vBrightness);
        //Cd.rgb *= Cd.rgb*.5+.5;

        gl_FragColor=Cd;
    }`,e}var pa={ProxDist:1e3,CalculateCollisions:!0,LandHeight:50};function al(l={}){l=Object.assign({},pa,l);let e=i=>(i+"").includes(".")?i:i+".0",t=R();return t+=`
uniform vec2 time;
uniform float rate;
uniform float pointScale;

attribute vec4 seeds;
attribute vec2 atlas;

varying vec2 vAtlas;
varying vec2 vRot;
varying float vScalar;

#define PROX ${e(l.ProxDist)}
#define LAND ${e(l.LandHeight)}

float colDetect( vec2 pos, vec2 pt, vec2 n1, vec2 n2 ){
    vec2 ref=pos-pt;
    float ret = step( dot( ref, n1 ), 0.0 );
    ret *= step( dot( ref, n2 ), 0.0 );

    return ret;
}

void main(){
    vAtlas=atlas;

    float rot=seeds.z+time.x*(seeds.z*2.);
    vRot=vec2( sin(rot), cos(rot) );

    float t=time.x*rate;

    vec3 pOff=vec3( seeds.x, 0, seeds.y)* vec3(PROX);

    // Loop point positions based on camera location
    float yFract=fract(t+seeds.z);
    pOff.y=PROX-yFract*(PROX+LAND);
    vec3 pos= pOff ;
    vec2 camXZ=cameraPosition.xz;
    pos.xz= mod( pos.xz-camXZ, PROX) + camXZ - PROX*.5;

    // Get some roof tops working
    //   Using opposing points and 2 normals in xz space to determin y floor position
    // Find rooves from xz pos + dot products
    float floor=0.0;
`,l.CalculateCollisions&&(t+=`
        // -- --
        vec2 lp1=vec2( -186.0, -1002.0 ); // Point 1
        vec2 l1n1=vec2(-.1,1.); // Normal 1
        vec2 l1n2=vec2(1.,-.1); // Normal 2
        vec2 lp2=vec2( -1101.0, -1720.0 ); // Point 2
        vec2 l2n1=vec2(.1,-1.1);
        vec2 l2n2=vec2(-1.,.1);
        floor = max( floor, 170.0*colDetect( pos.xz, lp1,l1n1,l1n2 ) * colDetect( pos.xz, lp2,l2n1,l2n2 ) ); // Lobby roof

        lp1=vec2( -217.0, 786.0 ); // Point 1
        l1n1=vec2(.2,-1.); // Normal 1
        l1n2=vec2(1.,.1); // Normal 2
        lp2=vec2( -940.0, 1293.0 ); // Point 2
        l2n1=vec2(-.2,1.);
        l2n2=vec2(-1.,-.1);
        floor = max( floor, 500.0*colDetect( pos.xz, lp1,l1n1,l1n2 ) * colDetect( pos.xz, lp2,l2n1,l2n2 ) ); // sunflower roof

        lp1=vec2( 204.028, 56.7629 ); // Point 1
        l1n1=vec2( 0.152344, -0.988327 ); // Normal 1
        l1n2=vec2( -0.999862, 0.0165819 ); // Normal 2
        lp2=vec2( 755.264, 754.843 ); // Point 2
        l2n1=vec2( -0.160366, 0.987058 );
        l2n2=vec2( 0.999849, 0.0173488 );
        floor = max( floor, 150.0*colDetect( pos.xz, lp1,l1n1,l1n2 ) * colDetect( pos.xz, lp2,l2n1,l2n2 ) ); // sunflower roof
        `),t+=`
        // Prevent snow drifting after hitting the ground
        float yLimit=max( floor, pos.y ) * .08 * seeds.z;
        pos.xz+=vec2( sin(pos.x+yLimit*seeds.x), sin(pos.z+pos.x+yLimit*seeds.y) )*10.; // Snow sway in the sky

        // Shift Y position per camera height
        pos.y+=cameraPosition.y-yFract*(cameraPosition.y);
        pos.y=max( floor+1.5, pos.y );

        float melt=min(1.0, (pOff.y+LAND-floor)*.02);
        float pScalar = max( 0., (1.-length(pos-cameraPosition )*0.001) * melt );

        vScalar = pScalar;
        float pScale = pointScale * seeds.w * pScalar ;
        gl_PointSize = pScale;

        vec4 mvPos=viewMatrix * vec4(pos, 1.0);
        gl_Position = projectionMatrix*mvPos;
    }`,t}function ol(){let l=R();return l+=`
uniform sampler2D snowTexture;
uniform vec2 time;
uniform float rate;

varying vec2 vAtlas;
varying vec2 vRot;
varying float vScalar;

void main(){
    vec2 uv=gl_PointCoord;

    vec2 pos = uv-.5;

    vec2 rotUV;
    rotUV.x = vRot.y * pos.x - vRot.x * pos.y;
    rotUV.y = vRot.x * pos.x + vRot.y * pos.y;
    rotUV=(rotUV+.5)*.25+vAtlas;

    float alpha=texture2D(snowTexture,rotUV).r * vScalar;
    vec4 Cd=vec4( vec3(1.), alpha );

    gl_FragColor=Cd;
}`,l}var da={};ve(da,{boxAntiAliasPass:()=>Al,chroAberPostProcess:()=>gl,compLayersPostProcess:()=>ul,crossAntiAliasPass:()=>pl,directionalBlurPass:()=>dl,finalOverlayHeavyShader:()=>El,finalOverlayShader:()=>Il,finalOverlaySlimShader:()=>Bl,glowPassPostProcess:()=>hl,iZoomPostProcess:()=>xl,lKingPostProcess:()=>vl,mixBlurShaderPass:()=>fl,motionBlurPostProcess:()=>ml,sFieldPostProcessFrag:()=>bl,sFieldPostProcessVert:()=>Cl,textureStorePass:()=>cl,warpPostProcess:()=>yl,worldPositionFrag:()=>ll,worldPositionVert:()=>nl});function nl(){let l=R();return l+=`
varying vec3 pos;

void main(){
  vec3 transformed = vec3( position );
    vec4 mvPosition = modelViewMatrix  * vec4( transformed, 1.0 );
  pos=((projectionMatrix * modelMatrix * vec4( transformed-vec3(0.0,0.0,-500.0), 1.0 )).xyz*.0001)*.5+.5;

  gl_Position = projectionMatrix * mvPosition;
}`,l}function ll(){let l=R();return l=`#include <packing>
  `+l,l+=`
uniform sampler2D diffuse;
uniform sampler2D depth;
uniform float camNear;
uniform float camFar;
varying vec3 pos;

void main() {

  vec4 Cd=vec4( pos, 1.0 );
  gl_FragColor = Cd;
}`,l}function hl(){let l=R();return l+=`
uniform sampler2D tDiffuse;
uniform sampler2D gDiffuse;
uniform sampler2D rDiffuse;
uniform sampler2D sceneDepth;
uniform vec2 time;
uniform vec2 ratio;
varying vec2 vUv;

    #define PI 3.14159265358979

void main() {
  vec4 Cd=texture2D( tDiffuse, vUv );
  vec4 gCd=texture2D( gDiffuse, vUv );
  vec4 rCd=texture2D( rDiffuse, vUv );

  Cd.rgb=gCd.rgb + gCd.rgb*length(gCd.rgb) + rCd.rgb  + Cd.rgb ;

  Cd.a=1.0;
  gl_FragColor = Cd;
}`,l}function cl(){let l=R();return l+=`
uniform sampler2D tDiffuse;
uniform sampler2D tDiffusePrev;
uniform sampler2D tDiffusePrevRoom;
uniform float roomComposer;
varying vec2 vUv;

void main() {
  vec4 Cd = texture2D( tDiffusePrev, vUv );
  vec3 prevRoomCd = texture2D( tDiffusePrevRoom, vUv ).rgb;
  Cd.rgb=mix( Cd.rgb, prevRoomCd, roomComposer);
  //Cd.rgb=Cd.rgb + prevRoomCd;
  Cd.a=1.0;
  gl_FragColor = Cd;
}`,l}function ul(){let l="";return l+=`
  uniform sampler2D tDiffuse;
  uniform sampler2D mtDiffuse;
  uniform sampler2D sceneDepth;
  uniform sampler2D noiseTexture;
  uniform float exposure;
  uniform vec2 camRotPitch;
  uniform vec2 time;
  varying vec2 vUv;

  void main() {
    vec4 Cd=texture2D(tDiffuse,vUv)*exposure;
    vec4 mBlurCd=texture2D(mtDiffuse,vUv)*exposure;
    vec4 depth=texture2D(sceneDepth,vUv);

////////////////////////
/*
    vec2 uv=vUv;
    float pi=3.14159265358979;
    float t=-time.x*.007;
    float pitch=camRotPitch.y;//depth.w*2.0-1.0;
    float yaw=camRotPitch.x;

    float distMult=depth.x*2.0;
    vec2 noiseUV=vec2(fract(uv.x*distMult+t+yaw), fract(uv.y*distMult+pitch));
    vec3 noiseCd=texture2D(noiseTexture,noiseUV).rgb;
    noiseUV=vec2(fract(uv.x*distMult+t*.5+yaw), fract(uv.y*.5*distMult+t*.25+pitch));
    noiseCd.g=texture2D(noiseTexture,noiseUV).g;
    noiseUV=vec2(fract(uv.x*.8*distMult+t*1.3+yaw), fract(uv.y*.3*distMult+t*.5+ pitch + depth.x*2.0));
    noiseCd.b=texture2D(noiseTexture,noiseUV).b;
    float mult=noiseCd.x*noiseCd.y*noiseCd.z*1.3;
    mult*=max(0.0, 1.0-depth.x) + (1.0-depth.z*.6);

    float bg=length(depth.rgb)<.02 ? 0.0 : 1.0;
    float bval=length(bloomCd.rgb);
    mult= mult*(bg+bval) ;//*(1.0-depth.z);
    Cd.rgb= mix( Cd.rgb, vec3(mult*.2), mult );
    */

    Cd.rgb+=mBlurCd.rgb;
    Cd.a=1.0;
    gl_FragColor = Cd;
  }`,l}function pl(){let l=R();return l+=`
uniform sampler2D tDiffuse;
uniform vec2 resUV;
uniform float ratio;
uniform vec3 gamma;
varying vec2 vUv;

// 1/4 ==  0.25
//  + 2 center samples, 1/6 ==  0.166...
#define AADIV 0.1666666666666666
const int runCount = 4;
const vec2 runDir[4] = vec2[4](
                          vec2( -1.0, -1.0 ),
                          vec2( -1.0, 1.0 ),
                          vec2( 1.0, -1.0 ),
                          vec2( 1.0, 1.0 )
                        );

void main() {
  vec4 Cd=texture2D(tDiffuse,vUv)*2.0;

  float dist = 1.0;
  vec2 baseUV=vUv;
  vec2 curUV;
  vec3 curCd;
  for(int s=0; s<runCount; ++s){
    curUV = baseUV+runDir[s]*(resUV);//*dist);
    curCd = texture2D(tDiffuse,curUV).rgb;
    Cd.rgb+=curCd;
  }
  Cd.rgb=Cd.rgb*AADIV;
  Cd.a=1.0;

  //Cd.rgb = pow(Cd.rgb, vec3(gamma.x));
  Cd.rgb = vec3(1.0)-(vec3(1.0)-Cd.rgb)*gamma.y + Cd.rgb*(1.0-min(1.0,length(Cd.rgb)))*gamma.z;
  gl_FragColor = Cd;
}`,l}function Al(){let l=R();return l+=`
uniform sampler2D tDiffuse;
uniform vec2 resUV;
uniform float ratio;
uniform vec3 gamma;
varying vec2 vUv;

// 1/8 ==  0.125
//  + 2 center samples, 1/10 ==  0.1
#define AADIV 0.1
const int runCount = 8;
const vec2 runDir[8] = vec2[8](
                          vec2( -1.0, -1.0 ),
                          vec2( -1.0, 1.0 ),
                          vec2( 1.0, -1.0 ),
                          vec2( 1.0, 1.0 ),

                          vec2( -1.0, 0.0 ),
                          vec2( 0.0, -1.0 ),
                          vec2( 0.0, 1.0 ),
                          vec2( 1.0, 0.0 )
                        );

void main() {
  vec4 Cd=texture2D(tDiffuse,vUv)*2.0;

  float dist = 1.0;
  vec2 baseUV=vUv;
  vec2 curUV;
  vec3 curCd;
  for(int s=0; s<runCount; ++s){
    curUV = baseUV+runDir[s]*(resUV);//*dist);
    curCd = texture2D(tDiffuse,curUV).rgb;
            Cd.rgb+=curCd;
  }
  Cd.rgb=Cd.rgb*AADIV;
  Cd.a=1.0;

  //Cd.rgb = pow(Cd.rgb, vec3(gamma.x));
  Cd.rgb = vec3(1.0)-(vec3(1.0)-Cd.rgb)*gamma.y + Cd.rgb*(1.0-min(1.0,length(Cd.rgb)))*gamma.z;
  gl_FragColor = Cd;
}`,l}function dl(l,e,t,i){let s=R();return s+=`
uniform sampler2D tDiffuse;
uniform sampler2D pDiffuse;
uniform vec2 resUV;
varying vec2 vUv;

#define PI 3.14159265358979

void main() {

  float dist = 2.0;
  float fade = 1.0;
  vec2 baseUV=vUv;

  const int blurCount=${t};
  const int runCount=2;
  vec2 runDir[runCount];
  runDir[0]=vec2(${e[0]}.0, ${e[1]}.0);
  runDir[1]=vec2(-${e[0]}.0, -${e[1]}.0);
  vec2 curUV;
  vec4 curCd;
  vec4 blurCd=vec4(.0);
  for(int b=0; b<blurCount; ++b){
    dist = 1.0 + float(b)*${i};
    fade = (1.0-float(b+1)/float(blurCount+2));
    //fade = 1.- (1.-fade)*(1.-fade);
    for(int s=0; s<runCount; ++s){
      curUV = baseUV+runDir[s]*(resUV*dist);
      curUV = min( vec2(1.), max( vec2(0.), curUV ));
      curCd = texture2D(${l},curUV);
      curCd.a *= fade*(length(curCd.rgb)*.6);
      blurCd.r = max( blurCd.r, curCd.r );
      blurCd.g = max( blurCd.g, curCd.g );
      blurCd.b = max( blurCd.b, curCd.b );
      //blurCd.rgb += curCd.rgb;
      blurCd.a = max( blurCd.a, curCd.a );
    }
  }
  vec4 Cd=blurCd;
  //Cd.a=.01;
  gl_FragColor = Cd;
}`,s}function fl(){let l=R();return l+=`
uniform sampler2D tDiffuse;
uniform sampler2D pDiffuse;
uniform vec2 resUV;
varying vec2 vUv;

#define PI 3.14159265358979

void main() {

  float dist = 3.0;
  float fade = 1.0;
  vec2 baseUV=vUv;
  const int blurCount=3;
  const int runCount=8;
  vec2 runDir[runCount];
  runDir[0]=vec2(1.0, 0.0);
  runDir[1]=vec2(1.0, 1.0);
  runDir[2]=vec2(0.0, 1.0);
  runDir[3]=vec2(-1.0, 1.0);
  runDir[4]=vec2(-1.0, 0.0);
  runDir[5]=vec2(-1.0, -1.0);
  runDir[6]=vec2(0.0, -1.0);
  runDir[7]=vec2(1.0, -1.0);
  vec2 curUV;
  vec4 curCd;
  vec4 scatterCd=vec4(.0);
  for(int b=0; b<blurCount; ++b){
    dist = 1.5*(1.0+float(b));
    fade = .1*(1.0-float(b)/float(blurCount));
    for(int s=0; s<runCount; ++s){
      curUV = baseUV+runDir[s]*(resUV*dist);
      curCd = texture2D(pDiffuse,curUV);
      curCd.a *= fade;
      scatterCd.rgb += curCd.rgb;
      scatterCd.a = max( scatterCd.a, curCd.a );
    }
  }
  vec4 Cd=scatterCd;

  vec4 blurCd=texture2D(tDiffuse,vUv);
  blurCd.rgb = normalize( blurCd.rgb );

  Cd = mix( blurCd, Cd, Cd.a);
  Cd = texture2D(tDiffuse,vUv);
  //Cd.a=.01;
  gl_FragColor = Cd;
}`,l}function ml(l,e){let t=R();return t+=`
uniform sampler2D tDiffuse;
uniform sampler2D rDiffuse;
uniform sampler2D noiseTexture;

uniform float exposure;
uniform vec2 time;
uniform vec3 camRotXYZ;
uniform vec2 blurDirCur;
uniform vec2 blurDirPrev;
varying vec2 vUv;

vec4 getTexture( sampler2D texelToLinearTexture ) {
  return mapTexelToLinear( texture2D( texelToLinearTexture , vUv ) );
}

vec3 directionalBlur(vec3 origCd, sampler2D tex, vec2 uv, vec2 dir, vec2 deltaDir, float dist, float thresh){
  float perc;
  float curPerc=1.0;
  vec2 curUV;
  float origLength=length(origCd.rgb);
  vec3 curCd;
  vec3 retCd=origCd;
  float delta;
  float threshTrigger=1.0;
  float dropoff;
  float percCurve;
  float d=dot(dir,deltaDir)*.5+.5;
  for(int r=0; r<10; ++r){
    perc=(float(r)/10.0);
    percCurve=perc*.5;
    dropoff=(dist*float(r))*perc*d;
    curUV=uv+normalize(deltaDir*percCurve+dir*(1.0-percCurve))*dropoff;
    //curUV=uv+dir*dropoff;
    curCd=texture2D(tex,curUV).rgb;
    delta=length(curCd.rgb);
    delta=origLength<delta?1.0-perc*perc:0.0;
    //delta=1.0-perc*perc;
    retCd+=curCd.rgb*delta;
    curPerc+=delta;

    percCurve*=percCurve;
    curUV=uv-normalize(-deltaDir*percCurve+dir*(1.0-percCurve))*dropoff*.4;
    //curUV=uv-dir*dropoff*.4;
    curCd=texture2D(tex,curUV).rgb;
    delta=length(curCd.rgb);
    delta=origLength<delta?1.0-perc*perc:0.0;
    //delta=1.0-perc*perc;
    retCd+=curCd.rgb*delta;
    curPerc+=delta;

  }
  return retCd /curPerc;
}

void main() {

  vec4 bloomCd=getTexture( rDiffuse );
  float noise=sin(time.x*1.8+vUv.x*length(bloomCd.rgb)*12.523+cos(time.x*.4+vUv.y*length(bloomCd.rgb)*2.352)*1.9)*.4+.8;
  noise=1.0-min(1.0, max(0.0, noise*sin(time.x*.4+24.512)*3.0+1.0));
  vec2 noiseUV=vUv*0.1;//+vec2(camRotXYZ.x+time.x*.05,-camRotXYZ.y);
  vec4 noiseCd=texture2D(noiseTexture,noiseUV);
  float blurDist=length(blurDirCur);
  blurDist=min(1.0,blurDist*15.0);
  //blurDist=(1.0-(1.0-blurDist)*(1.0-blurDist));
  vec2 blurDir=normalize(blurDirCur);//+(vUv-.5)*2.0);`,e||(t+=`
        blurDir=normalize( blurDir + (noiseCd.gb-.5)*(dot(blurDir,noiseCd.gb)*.5+.5) );
      `),t+=`
      vec2 deltaDir=normalize(blurDirPrev);
      deltaDir.x+=sin((blurDir.x-deltaDir.x));
      deltaDir.y+=sin((blurDir.y-deltaDir.y));

      vec4 bloomAdd=vec4( directionalBlur(bloomCd.rgb, rDiffuse, vUv, blurDir, deltaDir, `+l.y+"*"+(e?"3.0":"5.0")+`*(1.5)*blurDist, .5)*(1.0+exposure*.4), 1.0);
      vec4 Cd= bloomAdd* ( 0.50+bloomCd)*exposure;//getTexture( rDiffuse ) + bloomAdd;//+ vec4( 1.0 ) * bloomCd + bloomAdd;
      //Cd.a=bloomAdd.a-bloomCd.a;

      Cd.a=1.0;
      gl_FragColor = Cd;

    }`,t}function gl(){let l=R();return l+=`
uniform sampler2D tDiffuse;
uniform sampler2D chroAberUVTexture;
uniform sampler2D chroAberUVAlpha;
uniform vec2 ratio;

uniform vec2 warpMult;
uniform vec2 lKing;

varying vec2 vUv;

void main() {
  // I don't know, sRGB to Linear. Keeping it Linear doesn't work, PNG encoding to blame
  vec4 caCd= vec4(
    texture2D( chroAberUVTexture, vUv ).rgb - 0.7294118,
    texture2D( chroAberUVAlpha, vUv ).r - 0.5019608
  );
  //caCd*=mix( .025, .018, length(caCd.rg)*4.0 );
  caCd*=mix( lKing.x, lKing.y, length(caCd.rg)*4.0 )+warpMult.x;

  vec2 bUv=vUv+caCd.rg;
  vec2 rUv=vUv+caCd.ba;
  vec2 gUv=vUv+(caCd.rg+caCd.ba);
  vec4 rCd=texture2D( tDiffuse, rUv );
  vec4 Cd=texture2D( tDiffuse, gUv );
  vec4 bCd=texture2D( tDiffuse, bUv );

  Cd.rgb=vec3( rCd.r, Cd.g, bCd.b );
  Cd.a=1.0;
  gl_FragColor = Cd;
}`,l}function vl(){let l=R();return l+=`
uniform sampler2D tDiffuse;
uniform sampler2D noiseTexture;
uniform vec2 time;
uniform vec2 ratio;
varying vec2 vUv;

    #define PI 3.14159265358979

void main() {
  vec4 Cd=texture2D( tDiffuse, vUv )*.2;
  vec4 noiseCd= (texture2D( noiseTexture, vec2( fract(vUv.x*.2-time.x*.02+sin(time.x*.1+vUv.y*PI+Cd.r+Cd.g)),fract( vUv.y*.2+time.x*.01+cos(-time.x*.2+1.15+vUv.x*PI+Cd.g+Cd.b)) ) )-.5)*.025;

  vec2 bUv=vUv+noiseCd.rg;
  vec2 rUv=vUv+noiseCd.gb;
  vec2 gUv=vUv+noiseCd.br;
  vec4 rCd=texture2D( tDiffuse, rUv );
  vec4 gCd=texture2D( tDiffuse, gUv );
  vec4 bCd=texture2D( tDiffuse, bUv );

  Cd.rgb=vec3( rCd.r, gCd.g, bCd.b );
  Cd.a=1.0;
  gl_FragColor = Cd;
}`,l}function xl(){let l=R();return l+=`
uniform sampler2D tDiffuse;
uniform sampler2D tDiffusePrev;
uniform sampler2D noiseTexture;
uniform vec2 time;
uniform vec2 ratio;
varying vec2 vUv;

    #define PI 3.14159265358979

void main() {
  vec4 Cd=texture2D( tDiffuse, vUv );
        vec4 pCd=texture2D( tDiffusePrev, vUv );
        vec3 dCd=Cd.rgb-pCd.rgb;
        vec3 b1Cd= texture2D( tDiffuse, vUv-vec2( dCd.rg*.1 ) ).rgb;
        vec3 b2Cd= texture2D( tDiffusePrev, vUv+vec2( dCd.rg*.1 ) ).rgb;
        b1Cd=mix( b1Cd, b2Cd, step( length(b1Cd), length(b2Cd) ) );

        vec4 outCd=vec4(1.0);
        outCd.rgb= mix(  Cd.rgb, b1Cd, length(dCd) );

  vec3 noiseCd=texture2D( noiseTexture, fract( vUv*50.0+dCd.rg*.1 + length(Cd.rgb*30.0) + time.x) ).rgb;

        outCd.rgb= mix( vec3(length(outCd.rgb)*.333-length(noiseCd)*.1), outCd.rgb, min(1.0,length(dCd))*.5+.5 );
        outCd.rgb+= dCd.gbr;

  outCd.a=1.0;
  gl_FragColor = outCd;
}`,l}function Cl(){let l=R();return l+=`
uniform vec2 time;
varying vec2 vUv;
varying vec2 vUvShift;
varying vec2 starUv;
varying float vTimer;

void main(){
    vUv=uv;
    vUvShift=uv-.5;

    vec2 rUv=vUvShift*0.7071067811865476;
    vec2 tmpUv=rUv;
    float rot=time.x*.1;
    vec2 sinCos=vec2( sin(rot), cos(rot) );
    rUv.x=sinCos.x*tmpUv.x + sinCos.y*tmpUv.y;
    rUv.y=sinCos.y*tmpUv.x - sinCos.x*tmpUv.y;
    rUv=(rUv+.5);

    float starTimer=sin(time.x*.2)*.1+.1;
    starUv=mix( vUv, rUv, starTimer);

    vTimer=time.x*.5;

    vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);
    gl_Position = projectionMatrix*modelViewPosition;
}`,l}function bl(){let l=R();return l+=`
uniform sampler2D tDiffuse;
uniform sampler2D starTexture;
varying vec2 vUv;
varying vec2 vUvShift;
varying vec2 starUv;
varying float vTimer;

#define PI 3.14159265358979

void main() {
    float uvDist=length(vUvShift);

    vec3 starCd=texture2D( starTexture, starUv ).rgb*uvDist;

    float blender=uvDist*starCd.b * abs((fract(starCd.b*PI+vTimer))*2.0-1.0)*.5;
    vec2 starBlendUV=starCd.rg*blender;

    vec2 cdUv = vUv+starBlendUV;
    vec4 Cd=texture2D( tDiffuse, cdUv );

    vec3 negCd= mix( Cd.brg, Cd.gbr, length(Cd.rgb-Cd.rgb) );
    float cdBlender=step(.015,starBlendUV.x*uvDist)+starCd.b;
    Cd.rgb= mix( Cd.rgb, negCd, cdBlender );

    gl_FragColor = Cd;
}`,l}function yl(){let l=R();return l+=`
uniform sampler2D tDiffuse;
uniform sampler2D noiseTexture;
uniform sampler2D animTexture;
uniform vec2 time;
uniform vec2 fader;
varying vec2 vUv;

void main() {
  vec4 Cd=texture2D( tDiffuse, vUv );
  vec4 animCd=texture2D( animTexture, vUv );
  float timer=time.x*.2;
  vec2 animUV=vec2( mod(animCd.r+Cd.r+Cd.g+timer, 1.0), mod(animCd.g+Cd.g+Cd.b+timer, 1.0) );
  animCd=texture2D( animTexture, animUV );

  vec2 noiseUV=animUV+animCd.rg;
  vec4 noiseCd=texture2D(noiseTexture,noiseUV);
  noiseCd.rgb=vec3( length( noiseCd.rgb )*.5-.25 );

  float blend=fader.x*fader.y;
  Cd=mix( Cd, noiseCd, blend);

  Cd.a=1.0;
  Cd.r=1.0;
  gl_FragColor = Cd;
}`,l}function El(){let l=R();return l+=`
    uniform sampler2D tDiffuse;
    uniform sampler2D rDiffuse;
    uniform sampler2D bloomTexture;
    uniform sampler2D sceneDepth;
    uniform sampler2D scenePos;
    uniform sampler2D noiseTexture;
    uniform vec3 camPos;
    uniform vec2 time;
    uniform vec2 fogMult;
    uniform vec2 proximityMult;
    uniform float ratio;
    uniform float exposure;
    varying vec2 vUv;

    vec3 fogValue( vec3 worldPos, float time ){
        float wpDist = worldPos.x+worldPos.z*2.0;
        vec2 noiseUV = vec2( ((time*.5+wpDist*.60)), (worldPos.y*.7+time*.25 ));
        vec3 noiseCd = texture2D(noiseTexture,noiseUV).rgb;
        noiseUV=vec2( ((time*.3+wpDist*.55)), (worldPos.x*.5+time*.35 ));
        noiseCd.g=texture2D(noiseTexture,noiseUV+vec2(0.0,time)).g;
        noiseUV=vec2( ((time*1.2+wpDist*.83)), (worldPos.y+time*.15  ));
        noiseCd.b=texture2D(noiseTexture,noiseUV).b;

        return noiseCd;
    }

    #define PROX_WARP 3.14159265358979*.45

    void main() {
        vec4 Cd=texture2D(rDiffuse,vUv);
        float depth=texture2D(sceneDepth,vUv).r;

        vec3 worldPos = texture2D(scenePos,vUv).rgb;
        float t = -time.x*.003;
        vec3 baseNoiseCd=fogValue( worldPos, t );

        float mult=0.0;
        vec3 noiseCd;
        vec3 curNoiseCd;
        vec3 samplePos;
        float samples=4.3;//+sin(time.x*.001);
        float blender;
        float blenderMax=0.0;
        for( int x=0; x<=3; ++x){
            blender=( float(x+1) / samples );
            samplePos=worldPos*blender;
            curNoiseCd=fogValue( samplePos, t );
            noiseCd=max(noiseCd, curNoiseCd * blender );
            blenderMax+=blender;
        }
        noiseCd += baseNoiseCd*.2;
        mult= noiseCd.x*noiseCd.y*noiseCd.z*1.2;
        //mult*=mult;

        // Distance Mapping
        float proxWarp= cos(( vUv.x-.5 ) * PROX_WARP*ratio );
        float mDepth= pow( depth, 28.*proxWarp );

        float fogDap= max(0.0, 1.0-mDepth);
        fogDap=1.0-fogDap*fogDap;
        mult*=max(0.0, (worldPos.y-0.04)*1.65) * fogMult.x * fogDap ;

        Cd.rgb= mix( Cd.rgb, vec3(mult*.7), mult)-mult*.35;

        vec3 bloomCd=texture2D(bloomTexture,vUv).rgb;
        Cd.rgb+= bloomCd;
        Cd.rgb*=exposure;

        // Proximity Draw Over
        float dProx=  ((mDepth-.5)*-10.);
        dProx= max(0.0, (1.0-dProx)*step( 0., dProx));
        float yProxMult= 1.0-min(1.0, max(0.0, (worldPos.y-.5 )*1000.));
        dProx*= dProx* yProxMult * proximityMult.x;
        vec3 proxCd = (vec3(.5,.5,.2)*dProx)*.5;
        Cd.rgb+=proxCd*mult;

        Cd.a=1.0;
        gl_FragColor = Cd;
}`,l}function Il(){let l=R();return l+=`
uniform sampler2D tDiffuse;
uniform sampler2D rDiffuse;
uniform sampler2D bloomTexture;
uniform sampler2D sceneDepth;
uniform sampler2D scenePos;
uniform sampler2D noiseTexture;
uniform vec2 time;
uniform vec2 fogMult;
uniform vec2 proximityMult;
uniform vec2 lookAtPerc;
uniform vec2 resUV;
uniform float ratio;
uniform float exposure;
varying vec2 vUv;

#define PROX_WARP 3.14159265358979*.45

void main() {
    vec4 Cd=texture2D(rDiffuse,vUv);
    float depth=texture2D(sceneDepth,vUv).r;

    vec3 worldPos = texture2D(scenePos,vUv).rgb;
    float wpDist = worldPos.x+worldPos.z*2.0;
    float t = -time.x*.003;

    vec2 noiseUV = vec2( ((t*.5+wpDist*.60)), (worldPos.y*.7+t*.25 ));
    vec3 noiseCd = texture2D(noiseTexture,noiseUV).rgb;
    noiseUV=vec2( ((t*.3+wpDist*.55)), (worldPos.x*.5+t*.35 ));
    noiseCd.g=texture2D(noiseTexture,noiseUV+vec2(0.0,t)).g;
    noiseUV=vec2( ((t*1.2+wpDist*.83)), (worldPos.y+t*.15  ));
    noiseCd.b=texture2D(noiseTexture,noiseUV).b;

    // Distance Mapping
    float proxWarp= cos(( vUv.x-.5 ) * PROX_WARP*ratio );
    float mDepth= pow( depth, 28.*proxWarp );

    float fogDap= max(0.0, 1.0-mDepth);
    fogDap=1.0-fogDap*fogDap;
    float mult=noiseCd.x*noiseCd.y*noiseCd.z*1.3;
    mult*=max(0.0, (worldPos.y-0.04)*1.65) * fogMult.x * fogDap;

    Cd.rgb= mix( Cd.rgb, vec3(mult), mult)-mult*.4;

    vec3 bloomCd=texture2D(bloomTexture,vUv).rgb;
    Cd.rgb+= bloomCd;
    Cd.rgb*=exposure;

    // Proximity Draw Over
    float dProx=  ((mDepth-.5)*-10.);
    dProx= max(0.0, (1.0-dProx)*step( 0., dProx));
    float yProxMult= 1.0-min(1.0, max(0.0, (worldPos.y-.5 )*1000.));
    dProx*= dProx* yProxMult * proximityMult.x;
    vec3 proxCd = (vec3(.5,.5,.2)*dProx)*.5;
    Cd.rgb+=proxCd*mult;

    Cd.a=1.0;
    gl_FragColor = Cd;
}`,l}function Bl(){let l=R();return l+=`
uniform sampler2D tDiffuse;
uniform sampler2D rDiffuse;
uniform sampler2D bloomTexture;
uniform sampler2D sceneDepth;
uniform vec2 time;
uniform vec2 proximityMult;
uniform vec2 lookAtPerc;
uniform vec2 resUV;
uniform float ratio;
uniform float exposure;
varying vec2 vUv;

#define PROX_WARP 3.14159265358979*.4
#define PI 3.14159265358979

vec3 boostHighs( vec3 Cd ){
    float sat=max(max(Cd.r,Cd.g),Cd.b) - min(min(Cd.r,Cd.g),Cd.b);
    sat=(1.0-sat);
    sat=1.0-sat*sat;
    Cd+=Cd*sat;
    return Cd;
}

vec3 boostMids( vec3 Cd ){
    float sat=max(max(Cd.r,Cd.g),Cd.b) - min(min(Cd.r,Cd.g),Cd.b);
    sat=sin( sat*PI );
    Cd+=Cd*sat;
    return Cd;
}

void main() {
    vec4 Cd=texture2D(rDiffuse,vUv);
    vec2 uv=vUv;

    vec3 bloomCd=texture2D(bloomTexture,uv).rgb;
    bloomCd= mix( boostHighs(Cd.rgb), bloomCd,  step( 0.01, length( bloomCd )) );

    Cd.rgb+= bloomCd;

    // Proximity Draw Over
    float depth=texture2D(sceneDepth,vUv).r;

    // Distance Mapping
    float proxWarp= cos(( vUv.x-.5 ) * PROX_WARP*ratio );
    float mDepth= pow( depth, 28.*proxWarp );

    // Proximity Draw Over
    float dProx=  ((mDepth-.5)*-10.);
    dProx= max(0.0, (1.0-dProx)*step( 0., dProx));
    dProx*= dProx * proximityMult.x;
    vec3 proxCd = (vec3(.5,.5,.2)*dProx)*.5;
    Cd.rgb+=proxCd;
    Cd.r=1.0;
    Cd.a=1.0;
    gl_FragColor = Cd;
}`,l}var fa={};ve(fa,{bgScreenFrag:()=>Sl,bgScreenVert:()=>wl,skyObjectFrag:()=>Rl,skyObjectVert:()=>Dl});function wl(){let l=R();return l+=`
uniform vec2 time;

varying vec2 vUv;
varying vec3 vCamNormal;
varying vec3 vWorldNormal;
varying vec3 vWorldCross;
varying vec3 vSunPos;

void main(){
    vUv=uv;

    mat4 pvMat=projectionMatrix * viewMatrix;
    pvMat[3] = vec4(.0, .0, .0, 1.0);
    mat3 pvRot = inverse( mat3( pvMat ) );
    vCamNormal= pvRot * vec3( position*.2 + vec3(.0, .0, 1.0));
    vWorldNormal= normalize( pvRot[2] *vec3(1.,0.,1.));
    vWorldCross= normalize( pvRot[0]*vec3(1.,0.,1.));

    float timeRate = time.x * .1;
    vec3 sunPos = normalize( vec3(.3, 1.0, 1.0) );
    vec3 sunRef = sunPos;
    sunPos.y= sin(timeRate) * sunRef.y + cos(timeRate)*sunRef.z;
    sunPos.z= sin(timeRate) * sunRef.z - cos(timeRate)*sunRef.y;
    sunPos.x = sin( timeRate ) * .1;

    vSunPos = normalize( sunPos );

    vec4 modelViewPosition= vec4(position*2.0 + vec3(.0, .0, 1.0), 1.0);
    gl_Position = modelViewPosition;
}`,l}function Sl(){let l=R();return l+=`
uniform sampler2D noiseTexture;
varying vec2 vUv;
varying vec3 vCamNormal;
varying vec3 vWorldNormal;
varying vec3 vWorldCross;
varying vec3 vSunPos;

void main(){
    vec4 Cd=vec4( vec3(1.0, .10, .10), 1.0);

    float sunDot = dot( vSunPos, vCamNormal )*.5 +.5;
    sunDot *= max(0.0, dot( vSunPos, vec3(.0, 1.0, .0)) );

    vec2 xOffset = vec2( .0, .0);
    vec3 nCd=texture2D(noiseTexture,vUv*.1+vSunPos.zy*vec2(.15,.22) + xOffset ).rgb;
    nCd*=texture2D(noiseTexture,vUv*.1+vSunPos.yx*.2).rgb;
    sunDot *= nCd.x*nCd.y*nCd.z;
    nCd= vec3( length( nCd ) );

    float mixVal= min(1.0, sunDot+(1.-(vWorldNormal.y*.5+.5)));
    Cd.rgb= mix(vec3(0.0, .20, 1.0)+nCd*vWorldNormal.y, vec3(.0, .0, .0), mixVal);
    Cd.rgb=mix( vec3(.0), Cd.rgb, vWorldNormal.y );
    Cd.rgb=vec3(mix( vWorldNormal, vWorldCross, step(.4, vUv.x)));
    Cd.rgb=vec3(mix( vWorldCross, Cd.rgb, step(vUv.y,.9)));
    gl_FragColor=Cd;
}`,l}function Dl(){let l=R();return l+=`
uniform float camFar;
uniform vec2 resUV;

varying vec2 vUv;
varying vec3 vN;
varying vec3 vLocalPos;
varying vec4 vWorldPos;

void main(){
    vUv=uv;
    vLocalPos=position;
    vN = normal;

    vec3 pos = position;
    vec4 modelViewPosition=projectionMatrix * vec4(mat3(viewMatrix)*normalize(pos)*camFar, 1.0);
    gl_Position = modelViewPosition;

    vWorldPos = modelViewPosition;

}`,l}function Rl(l=Qi.OFF){let e=R();return e+=`
uniform sampler2D diffuse;
uniform sampler2D noiseTexture;
uniform vec2 time;
uniform float camNear;
uniform float camFar;
uniform vec2 resUV;

uniform float rate;
uniform vec3 fogColor;

varying vec2 vUv;
varying vec3 vN;
varying vec3 vLocalPos;
varying vec4 vWorldPos;

#define PI 3.14159265358979323

void main(){
    vec2 uv=vUv;
    vec2 screenUV=(vec2(vWorldPos.xy/vWorldPos.w))*.5+.5;
    vec4 Cd=texture2D(diffuse,uv);
`,l===Qi.VAPOR&&(e+=`

        // -- -- -- -- -- -- -- -- --
        // -- Horizon Vapor Code - -- --
        // -- -- -- -- -- -- -- -- -- -- --

        vec3 lPos = vLocalPos;
        lPos.y = abs(lPos.y)*0.05;

        float t = time.x*.6;

        // Duel noise texture sampling
        //   Creates a flowing vapor effect flowing through the noise texture
        vec2 nUv =  vec2(vUv.x*0.40, vUv.y*.5 - t*.0065  - vN.y );
        vec3 noiseBaseCd = texture2D( noiseTexture, nUv ).rgb;
        nUv = ( nUv*vec2(1.0,.5)+noiseBaseCd.rg*(noiseBaseCd.b) + t*.02);
        vec3 noiseCd = texture2D( noiseTexture, nUv ).rgb;
        noiseCd.rg = noiseCd.rg*2.0-1.0;

        float reachDepth = 0.0 ;

        // Calculate mask based on the local position
        //   Assuming for a sky-box / sky-sphere object
        vec3 normPos = normalize(vLocalPos);
        normPos.y = 1.0-min(1.0,(normPos.y)*3.0);
        normPos.y = normPos.y*normPos.y*normPos.y;

        // Noise-influence of the normal vector to drive the vapoe mask
        reachDepth =  min(1.0, (vN.y * 1. * noiseCd.x  * max(noiseCd.y, noiseCd.z))) ;

        float vaporMask = clamp(reachDepth+normPos.y * max(.95, noiseBaseCd.x*noiseBaseCd.z+vN.y*.5), 0.0, 1.0)*.1;

        float fogMixer = (Cd.r+Cd.g+Cd.b) - (fogColor.r+fogColor.g+fogColor.b) ;
        vec3 toFogColor = mix(  Cd.rgb, fogColor,  fogMixer );
        float blender = (sin(noiseCd.r*PI+t+uv.x))*max(0.0,1.0-(vaporMask+fogMixer))*.1 ;
        vec3 baseColor = (toFogColor-min(1.0,blender+ vaporMask*10.0)) ;

        Cd.rgb = mix(Cd.rgb, baseColor, vaporMask * step( -0.10, vN.y ));

        // -- -- -- -- -- -- -- -- -- -- --
        // -- End of Horizon Vapor -- --
        // -- -- -- -- -- -- -- -- --

    `),e+=`

        gl_FragColor=Cd;
    }`,e}var ma={animated:oa,core:aa,objects:na,particles:Aa,rendering:da,scene:fa};import{Points as VA,Float32BufferAttribute as si,Vector2 as Tl,Vector3 as Pl,NearestFilter as ga,NearestMipmapNearestFilter as va,BufferGeometry as HA,AdditiveBlending as Ml}from"three";var Ee=class{constructor(e=null,t="particles"){this.type="particleSystem",this.name=t,this.room=e,this.geometry=null,this.material=null,this.points=null,this.count=-1,this.pscale=new Tl(0,0),this.position=new Pl(0,0,0),this.atlasPath="sprite_dustAtlas_rgb.jpg",this.atlasAlphaPath="sprite_dustAtlas_alpha.jpg",this.hasAlphaMap=!0,this.shaderSettings={vertCount:1e3,pScale:7,atlasRes:4,atlasPicks:[],randomAtlas:!1,additiveBlend:!1,hasLights:!1},this.knownKeys=Object.keys(this.shaderSettings)}build(e={},t={},i=null,s=null){if(!i||!s){console.error("No Shader Found; Cannot Build Particle System");return}if(e&&typeof e===Object){let a=Object.keys(e);this.knownKeys.forEach(o=>{a.includes(o)?this.shaderSettings[o]=e[o]:e[o]=this.shaderSettings[o]})}(!this.shaderSettings.atlasPicks||this.shaderSettings.atlasPicks.length<1)&&(this.shaderSettings.atlasPicks=this.elementDuplicator([[0,.75],[0,.5],[.25,.75],[.25,.5]],4));let r=this.room.pxlFile.pxlShaderBuilder(t,i,s);this.material=r,this.material.transparent=!0,this.material.depthTest=!0,this.material.depthWrite=!1,this.shaderSettings.hasOwnProperty("additiveBlend")&&this.shaderSettings.additiveBlend&&(this.material.blending=Ml),this.addToScene()}setPosition(...e){e.length===1?this.position=e[0]:this.position=new Pl(...e),this.points&&this.points.position.copy(this.position)}setMaterial(e){if(!e&&!e.isMaterial){console.error("No Material Found; Cannot Set Particle System Material");return}this.material=e,this.points&&(this.points.material=e)}setGeometry(e){if(!e&&!e.isBufferGeometry){console.error("No Geometry Found; Cannot Set Particle System Geometry");return}this.shaderSettings.vertCount=e.attributes.position.count,this.geometry=e,this.points&&(this.points.geometry=e)}getSettings(){return this.shaderSettings}setSettings(e={}){if(!e||typeof e!="object"){console.error("No Settings Found; Cannot Set Particle System Settings");return}let t=Object.keys(e);this.knownKeys.forEach(i=>{t.includes(i)?this.shaderSettings[i]=e[i]:e[i]=this.shaderSettings[i]}),this.points&&(this.points.material.uniforms.pointScale.value=new Tl(this.shaderSettings.pScale*this.room.pxlEnv.pxlQuality.screenResPerc,this.shaderSettings.pScale*this.room.pxlEnv.pxlQuality.screenResPerc))}addToScene(){if(!this.shaderSettings){console.error("No Shader Settings Found; Somehow deleted?");return}let e=this.shaderSettings.vertCount,t=this.shaderSettings.pScale,i=this.material,s=this.shaderSettings.atlasRes,r=this.shaderSettings.atlasPicks,a=this.shaderSettings.randomAtlas,o=this.shaderSettings.additiveBlend;this.geometry&&this.geometry.attributes.position.count>0&&(e=this.geometry.attributes.position.count,this.shaderSettings.vertCount=e),this.room.materialList[this.name]=i,this.count=e,this.pscale.x=t*this.room.pxlEnv.pxlQuality.screenResPerc;let n=null;a?(n=this.atlasRandomGen,r=s):n=this.atlasArrayPicker,i||(i=this.newMaterial());let h=[],u=[],c=[],p=null;if(this.geometry){p=this.geometry;let g=!1,m=!1;if(e=p.attributes.position.count,this.count=e,p.attributes.hasOwnProperty("atlas")||(m=!0),p.attributes.hasOwnProperty("seeds")||(g=!0),m||g)for(let A=0;A<e;++A)g&&u.push(Math.random(),Math.random()*2-1,Math.random(),Math.random()*2-1),m&&c.push(...n(r));if(g){let A=new si(u,4);p.setAttribute("seeds",A)}if(m){let A=new si(c,2);p.setAttribute("atlas",A)}}else{for(let f=0;f<e;++f)h.push(0,0,0),u.push(Math.random(),Math.random()*2-1,Math.random(),Math.random()*2-1),c.push(...n(r));let g=new si(h,3),m=new si(u,4),A=new si(c,2);p=new HA,p.setAttribute("position",g),p.setAttribute("seeds",m),p.setAttribute("atlas",A)}i.depthTest=!0,i.depthWrite=!1;let d=new VA(p,i);return d.sortParticles=!1,d.frustumCulled=!1,this.room.scene.add(d),d.layers.set(1),d.renderOrder=Yr.PARTICLES,d.pBaseScale=t,this.room.geoList[this.name]=d,this.geometry=p,this.material=i,this.points=d,o&&(d.material.blending=Ml),d}atlasRandomGen(e=4,t=2){let i=1/e;return Array.from({length:t}).map(()=>Math.floor(Math.random()*648405.71%e)*i)}atlasRandomList(e=4,t=4,i=2){return Array.from({length:e}).map(s=>this.atlasRandomGen(t,i))}atlasArrayPicker(e){return e[Math.floor(Math.random()*92314.75%e.length)]}dupeArray(e,t){return Array.from({length:t}).fill(e)}elementDuplicator(e,t=4){return e.map(i=>this.dupeArray(i,t)).flat(1)}findLightPositions(){let e=[];return this.room.lightList.hasOwnProperty("PointLight")&&this.room.lightList.PointLight.forEach(t=>{e.push(t.position.clone())}),e}hasPointLights(){return this.room.lightList.hasOwnProperty("PointLight")}setAtlasPath(e,t=null){this.atlasPath=e,t?(this.atlasAlphaPath=t,this.hasAlphaMap=!0):this.hasAlphaMap=!1}newMaterial(e=!0){let t=this.hasPointLights(),i={atlasTexture:{type:"t",value:null},noiseTexture:{type:"t",value:null},time:{type:"f",value:this.room.msRunner},pointScale:{type:"f",value:this.pscale},intensity:{type:"f",value:1},rate:{type:"f",value:.035},lightPos:{value:t}};this.hasAlphaMap&&(i.atlasAlphaTexture={type:"t",value:null});let s=this.room.pxlFile.pxlShaderBuilder(i,Rt(this.shaderSettings),Tt(this.hasAlphaMap));return s.transparent=!0,this.hasAlphaMap?(s.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasPath,4,{magFilter:ga,minFilter:va}),this.atlasAlphaPath&&(s.uniforms.atlasAlphaTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,1,{magFilter:ga,minFilter:va}))):s.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,4,{magFilter:ga,minFilter:va}),s.uniforms.noiseTexture.value=this.room.smoothNoiseTexture,s.depthTest=!0,s.depthWrite=!1,e&&(this.room.materialList[this.name]=s),s}};import{Vector3 as Ll,AdditiveBlending as jA,NearestFilter as xa,NearestMipmapNearestFilter as Ca}from"three";var ri=class extends Ee{constructor(e=null,t="billowSmoke"){super(e,t),this.name=t,this.room=e,this.shaderSettings={vertCount:600,pScale:56,pOpacity:1,proxDist:200,atlasRes:4,atlasPicks:[],randomAtlas:!0,additiveBlend:!1,windDir:new Ll(0,0,1),offsetPos:new Ll(0,0,0)},this.knownKeys=Object.keys(this.shaderSettings)}build(e={}){if(e&&typeof e===Object){let s=Object.keys(e);this.knownKeys.forEach(r=>{s.includes(r)?this.shaderSettings[r]=e[r]:e[r]=this.shaderSettings[r]})}(!this.shaderSettings.atlasPicks||this.shaderSettings.atlasPicks.length===0)&&(this.shaderSettings.atlasPicks=[...super.dupeArray([.5,0],2),...super.dupeArray([.5,.25],2),...super.dupeArray([.5,.5],2),...super.dupeArray([.5,.75],2),...super.dupeArray([.75,.75],4),...super.dupeArray([.75,.25],3),...super.dupeArray([.75,.25],3)]);let t={atlasTexture:{type:"t",value:null},noiseTexture:{type:"t",value:null},time:{type:"f",value:this.room.msRunner},windDir:{type:"f",value:e.windDir},offsetPos:{type:"f",value:e.offsetPos},pointScale:{type:"f",value:this.pscale},intensity:{type:"f",value:.8},rate:{type:"f",value:2.85}};this.hasAlphaMap&&(t.atlasAlphaTexture={type:"t",value:null});let i=this.room.pxlFile.pxlShaderBuilder(t,ms(),gs(this.hasAlphaMap));i.transparent=!0,this.shaderSettings.additiveBlend&&(i.blending=jA),this.hasAlphaMap?(i.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasPath,4,{magFilter:xa,minFilter:Ca}),this.atlasAlphaPath&&(i.uniforms.atlasAlphaTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,1,{magFilter:xa,minFilter:Ca}))):i.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,4,{magFilter:xa,minFilter:Ca}),i.uniforms.noiseTexture.value=this.room.softNoiseTexture,i.depthTest=!0,i.depthWrite=!1,this.room.materialList[this.name]=i,this.material=i,super.addToScene()}};import{Vector3 as kl,AdditiveBlending as KA,DoubleSide as zA,NearestFilter as ba,NearestMipmapNearestFilter as ya}from"three";var ai=class extends Ee{constructor(e=null,t="emberWisps"){super(e,t),this.name=t,this.room=e,this.shaderSettings={vertCount:600,pScale:7,pOpacity:1,proxDist:200,atlasRes:4,atlasPicks:[],randomAtlas:!0,additiveBlend:!1,windDir:new kl(0,0,1),offsetPos:new kl(0,0,0)},this.knownKeys=Object.keys(this.shaderSettings)}build(e={}){if(e&&typeof e===Object){let s=Object.keys(e);this.knownKeys.forEach(r=>{s.includes(r)?this.shaderSettings[r]=e[r]:e[r]=this.shaderSettings[r]})}(!this.shaderSettings.atlasPicks||this.shaderSettings.atlasPicks.length===0)&&(this.shaderSettings.atlasPicks=super.elementDuplicator([[0,.75],[0,.5],[.25,.75],[.25,.5]],4));let t={atlasTexture:{type:"t",value:null},noiseTexture:{type:"t",value:null},time:{type:"f",value:this.room.msRunner},windDir:{type:"v",value:this.shaderSettings.windDir},offsetPos:{type:"v",value:this.shaderSettings.offsetPos},pointScale:{type:"f",value:this.shaderSettings.pScale},intensity:{type:"f",value:1},rate:{type:"f",value:5.5}};this.hasAlphaMap&&(t.atlasAlphaTexture={type:"t",value:null});let i=this.room.pxlFile.pxlShaderBuilder(t,ps(),As(this.hasAlphaMap));i.side=zA,i.transparent=!0,this.shaderSettings.additiveBlend&&(i.blending=KA),this.hasAlphaMap?(i.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasPath,4,{magFilter:ba,minFilter:ya}),this.atlasAlphaPath&&(i.uniforms.atlasAlphaTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,1,{magFilter:ba,minFilter:ya}))):i.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,4,{magFilter:ba,minFilter:ya}),i.uniforms.noiseTexture.value=this.room.softNoiseTexture,i.depthTest=!0,i.depthWrite=!1,this.room.materialList[this.name]=i,this.material=i,super.addToScene()}};import{Vector3 as vs,NearestFilter as Ea,NearestMipmapNearestFilter as Ia,AdditiveBlending as WA}from"three";var oi=class extends Ee{constructor(e=null,t="floatingDust"){super(e,t),this.name=t,this.room=e,this.material=null,this.shaderSettings={vertCount:1e3,pScale:7,pOpacity:1,proxDist:200,atlasRes:4,atlasPicks:[],randomAtlas:!1,additiveBlend:!1,windDir:new vs(0,0,1),offsetPos:new vs(0,0,0),hasLights:!1,fadeOutScalar:1.59,wanderInf:1,wanderRate:1,wanderFrequency:2.85},this.knownKeys=Object.keys(this.shaderSettings)}build(e={}){if(e&&typeof e===Object){let a=Object.keys(e);this.knownKeys.forEach(o=>{a.includes(o)?this.shaderSettings[o]=e[o]:e[o]=this.shaderSettings[o]})}(!this.shaderSettings.atlasPicks||this.shaderSettings.atlasPicks.length<1)&&(this.shaderSettings.atlasPicks=[...super.dupeArray([0,0],4),...super.dupeArray([.25,0],4),...super.dupeArray([.5,0],2),...super.dupeArray([.5,.25],2),...super.dupeArray([.5,.5],2),...super.dupeArray([.5,.75],2),...super.dupeArray([.75,.75],4),...super.dupeArray([.75,.25],3),...super.dupeArray([.75,.25],3)]),this.shaderSettings.hasLights=super.hasPointLights();let t=e.windDir;t&&typeof t===Object&&typeof t!==vs&&t.length===3&&this.shaderSettings.windDir.set(t[0],t[1],t[2]);let i=e.offsetPos;i&&typeof i===Object&&typeof i!==vs&&i.length===3&&this.shaderSettings.offsetPos.set(i[0],i[1],i[2]);let s={atlasTexture:{type:"t",value:null},atlasAlphaTexture:{type:"t",value:null},noiseTexture:{type:"t",value:null},time:{type:"f",value:this.room.msRunner},pointScale:{type:"f",value:this.pscale},intensity:{type:"f",value:1},rate:{type:"f",value:.035},positionOffset:{type:"v",value:this.shaderSettings.offsetPos},windDir:{type:"v",value:this.shaderSettings.windDir}},r=this.room.pxlFile.pxlShaderBuilder(s,Rt(this.shaderSettings),Tt(this.hasAlphaMap));r.transparent=!0,this.hasAlphaMap?(r.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasPath,4,{magFilter:Ea,minFilter:Ia}),this.atlasAlphaPath&&(r.uniforms.atlasAlphaTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,1,{magFilter:Ea,minFilter:Ia}))):r.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,4,{magFilter:Ea,minFilter:Ia}),this.shaderSettings.additiveBlend&&(r.blending=WA),r.uniforms.noiseTexture.value=this.room.softNoiseTexture,r.depthTest=!0,r.depthWrite=!1,this.room.materialList[this.name]=r,this.material=r,super.addToScene()}};import{Vector3 as Pt,NearestFilter as xs,LinearFilter as qA,NearestMipmapNearestFilter as Cs,LinearMipmapLinearFilter as YA,AdditiveBlending as XA}from"three";var ni=class extends Ee{constructor(e=null,t="heightMap"){super(e,t),this.name=t,this.room=e,this.heightMapPath=null,this.spawnMapPath=null,this.spawnMapMode=1,this.material=null,this.shaderSettings={vertCount:1e3,pScale:7,pOpacity:1,proxDist:200,atlasRes:4,atlasPicks:[],randomAtlas:!1,additiveBlend:!1,tint:new Pt(1,1,1),jumpHeightMult:0,offsetPos:new Pt(0,0,0),windDir:new Pt(0,0,0),size:new Pt(0,0,0),hasLights:!1,fadeOutScalar:1.59,wanderInf:1,wanderRate:1,wanderFrequency:2.85},this.knownKeys=Object.keys(this.shaderSettings)}setHeightMapPath(e){this.heightMapPath=e}setSpawnMapPath(e,t=1){this.spawnMapPath=e,t===3&&(t=4),this.spawnMapMode=t}build(e={},t=null){if(e&&typeof e===Object){let c=Object.keys(e);this.knownKeys.forEach(p=>{c.includes(p)?this.shaderSettings[p]=e[p]:e[p]=this.shaderSettings[p]})}e.hasOwnProperty("atlasPicks")?this.shaderSettings.atlasPicks=e.atlasPicks:(!this.shaderSettings.atlasPicks||this.shaderSettings.atlasPicks.length<1)&&(this.shaderSettings.atlasPicks=[...super.dupeArray([0,0],4),...super.dupeArray([.25,0],4),...super.dupeArray([.5,0],2),...super.dupeArray([.5,.25],2),...super.dupeArray([.5,.5],2),...super.dupeArray([.5,.75],2),...super.dupeArray([.75,.75],4),...super.dupeArray([.75,.25],3),...super.dupeArray([.75,.25],3)]),this.shaderSettings.hasLights=super.hasPointLights();let i=e.offsetPos;i&&typeof i===Object&&typeof i!==Pt&&i.length===3&&this.shaderSettings.offsetPos.set(i[0],i[1],i[2]);let s=100,r=100,a=100;e.hasOwnProperty("size")&&(e.size.x>0&&(s=e.size.x),e.size.y>0&&(r=e.size.y),e.size.z>0&&(a=e.size.z)),this.shaderSettings.pScale>=0&&(this.pscale.x=this.shaderSettings.pScale),t&&(t.hasOwnProperty("userData")&&t.userData.hasOwnProperty("SizeX")?s=t.userData.SizeX:s=t.scale.x,t.hasOwnProperty("userData")&&t.userData.hasOwnProperty("SizeY")?r=t.userData.SizeY:r=t.scale.y,t.hasOwnProperty("userData")&&t.userData.hasOwnProperty("SizeZ")?a=t.userData.SizeZ:a=t.scale.z,this.pscale.x=t.pScale);let o=new Pt(s,r,a),n={heightMap:{type:"t",value:null},spawnMap:{type:"t",value:null},tankSize:{type:"v",value:o},atlasTexture:{type:"t",value:null},atlasAlphaTexture:{type:"t",value:null},noiseTexture:{type:"t",value:null},time:{type:"f",value:this.room.msRunner},pointScale:{type:"f",value:this.pscale},intensity:{type:"f",value:1},tint:{type:"v",value:this.shaderSettings.tint},rate:{type:"f",value:.035},positionOffset:{type:"v",value:this.shaderSettings.offsetPos},windDir:{type:"v",value:this.shaderSettings.windDir}},h=this.room.pxlFile.pxlShaderBuilder(n,ds(this.shaderSettings),fs(this.hasAlphaMap));h.transparent=!0,this.hasAlphaMap?(h.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasPath,4,{magFilter:xs,minFilter:Cs}),this.atlasAlphaPath&&(h.uniforms.atlasAlphaTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,1,{magFilter:xs,minFilter:Cs}))):h.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,4,{magFilter:xs,minFilter:Cs}),this.heightMapPath&&(h.uniforms.heightMap.value=this.room.pxlUtils.loadTexture(this.heightMapPath,4,{magFilter:qA,minFilter:YA})),this.spawnMapPath&&(h.uniforms.spawnMap.value=this.room.pxlUtils.loadTexture(this.spawnMapPath,this.spawnMapMode,{magFilter:xs,minFilter:Cs})),this.shaderSettings.additiveBlend&&(h.blending=XA),h.uniforms.noiseTexture.value=this.room.softNoiseTexture,h.depthTest=!0,h.depthWrite=!1,this.room.materialList[this.name]=h,this.material=h;let u=super.addToScene();return t&&u.position.set(t.position.x,t.position.y,t.position.z),u.userData.tankRes=o,u}};var Ql={pxlParticles:{ParticleBase:Ee,BillowSmoke:ri,EmberWisps:ai,FloatingDust:oi,HeightMap:ni}};import{Vector2 as _l,Vector3 as Mt,Object3D as JA,Color as ZA,FogExp2 as $A,Group as ed,RepeatWrapping as bs,UniformsUtils as td,UniformsLib as Ba}from"three";var ys=class{constructor(e="pxlRoomEnvironment",t=""){this.roomName=e,this.pxlOptions=null,this.pxlEnums=null,this.pxlFile=null,this.pxlUtils=null,this.pxlTimer=null,this.pxlAnim=null,this.pxlColliders=null,this.pxlDevice=null,this.pxlHUD=null,this.pxlRendering=null,this.pxlEnv=null,this.booted=!1,this.initScene=!0,this.active=!0,t===""&&(t="./pxlRooms/"+e+"/"),this.assetPath=t+"Assets/",this.mobile=!1,this.sceneFile=null,this.animFile=null,this.animClips={},this.animMixer=null,this.spiralizerUniforms={},this.materialList={},this.revertColorSpaceList=[],this.particleList={},this.camInitPos=null,this.camInitLookAt=null,this.camThumbPos=new Mt(0,0,-30),this.camThumbLookAt=new Mt(0,35,-1e3),this.cameraBooted=!1,this.cameraPrevPos=new Mt(0,0,0),this.cameraAimTarget=new JA(0,0,0),this.camHoldWarpPos=!0,this.defaultCamLocation="default",this.camLocation={},this.pxlCamFOV={PC:60,MOBILE:80},this.pxlCamZoom=1,this.pxlCamAspect=1,this.pxlCamNearClipping=5,this.pxlCamFarClipping=1e4,this.fogColor=new ZA(.01,.02,.05),this.fogExp=7e-4,this.fog=new $A(this.fogColor,this.fogExp),this.userAvatarGroup=new ed,this.packedTextureMaterial=null,this.coreTextureMaterial=null,this.projectedMaterial=null,this.voidMaterial=null,this.holoMaterial=null,this.aspectRatio=null,this.flag=null,this.initPos=[],this.finalPos=[],this.midPos=new Mt(0,30,-50),this.perspectiveInstances=160,this.startTime=0,this.runTime=new _l(0,0),this.msRunner=null,this.camera=null,this.autoCamPaths={},this.scene=null,this.lightList={},this.geoList={},this.glassGroup=null,this.glassList=[],this.particleList={},this.lodList=[],this.enableRaycast=!1,this.hasHoverables=!1,this.hoverableList=[],this.hoverableObj=null,this.hasClickables=!1,this.clickableList=[],this.clickableObj=null,this.collidersExist=!1,this.colliderActive=!1,this.colliderHashMap={},this.colliderList=[],this.antiColliderActive=!1,this.antiColliderList=[],this.antiColliderTopActive=!1,this.antiColliderTopList=[],this.hasPortalExit=!1,this.portalList={},this.hasRoomWarp=!1,this.roomWarp=[],this.warpPortalTexture=null,this.warpZoneRenderTarget=null,this.worldPosMaterial=null,this.worldPosRenderTarget=null,this.spiralizerPass=null,this.bloomPreState=!1,this.cloud3dTexture=null,this.smoothNoiseTexture=null,this.hasHelpers=!1,this.helperObjects={},this.currentShader=null}setDependencies(e){this.pxlOptions=e.pxlOptions,this.pxlEnums=e.pxlEnums,this.pxlRendering=e.pxlRendering,this.pxlEnv=e,this.pxlFile=e.pxlFile,this.pxlAnim=e.pxlAnim,this.pxlTimer=e.pxlTimer,this.pxlUtils=e.pxlUtils,this.pxlDevice=e.pxlDevice,this.pxlHUD=e.pxlHUD,this.pxlColliders=e.pxlColliders,this.mobile=e.mobile,this.msRunner=this.pxlTimer.msRunner,this.cloud3dTexture=this.pxlEnv.cloud3dTexture,this.cloud3dTexture&&(this.cloud3dTexture.wrapS=bs,this.cloud3dTexture.wrapT=bs),this.smoothNoiseTexture=this.pxlEnv.softNoiseTexture,this.smoothNoiseTexture&&(this.smoothNoiseTexture.wrapS=bs,this.smoothNoiseTexture.wrapT=bs)}get deltaTime(){return this.pxlTimer.deltaTime}get avgDeltaTime(){return this.pxlTimer.avgDeltaTime}getLerpRate(e){return this.pxlTimer.getLerpRate(e)}getLerpAvgRate(e){return this.pxlTimer.getLerpAvgRate(e)}init(){this.scene.fog=this.fog,this.scene.background=this.fogColor}start(){this.booted,this.pxlRendering.engine.setClearColor(this.fogColor,0)}step(){this.runTime.x=this.msRunner.x}stop(){}resize(e,t){}setUserHeight(e=1){this.pxlEnv.pxlCamera.setUserHeight(e,this.roomName)}resetCamera(){(this.camInitPos===null||this.camInitLookAt===null)&&this.pxlOptions.verbose>=this.pxlEnums.VERBOSE_LEVEL.WARN&&console.warn("pxlRoomEnvironment: Room Initial Camera Positions not initialized, \n Ensure `this.booted=true` is ran in `build()` or `fbxPostLoad()` \n -&-\n That there is a `Camera` group with `position` & `lookAt` child nulls in your scene file."),this.pxlEnv.pxlCamera.setTransform(this.camInitPos,this.camInitLookAt)}prepPortalRender(){this.geoList.intro.visible=!1,this.geoList.MainRoomWarp.visible=!1}cleanupPortalRender(){this.geoList.intro.visible=!0,this.geoList.MainRoomWarp.visible=!0}setPortalTexture(e,t=null){this.geoList.MainRoomWarp.material.map=e}applyRoomPass(e=null){}getName(){return this.roomName}getArtistInfo(){return null}setFog(e){}getShaderList(){let e={};return Object.keys(this.materialList).forEach(i=>{e[i]=i}),e}getCurrentShader(){return this.currentShader||Object.keys(this.materialList)[0]}readShader(e="",t=null){return this.currentShader!=null&&this.materialList[this.currentShader].hasOwnProperty("uniforms")&&(t||(t=new Mt),this.materialList[this.currentShader].uniforms.sliders.value=t,this.materialList[this.currentShader].needsUpdate=!0),this.currentShader=e,this.materialList[this.currentShader]}setShader(e,t,i){this.emitterList&&this.emitterList[this.currentShader]&&this.emitterList[this.currentShader].Particles.length>0&&this.emitterList[this.currentShader].Particles.forEach(s=>{let r=s.material;r.vertexShader=t,r.fragmentShader=i,r.needsUpdate=!0}),this.materialList[this.currentShader].vertexShader=t,this.materialList[this.currentShader].fragmentShader=i,this.materialList[this.currentShader].needsUpdate=!0}castRay(e,t){if(!this.enableRaycast)return;if(!e&&!this.hasHoverables||e&&!this.hasClickables){this.mouseRayHits=[];return}let i=[];!e&&this.hasHoverables?i=this.hoverableList:e&&this.hasClickables&&(i=this.clickableList);var s=[];if(i.length>0){let r=new _l(this.pxlDevice.mouseX/this.pxlDevice.sW*2-1,-this.pxlDevice.mouseY/this.pxlDevice.sH*2+1);this.pxlEnv.pxlCamera.objRaycast.setFromCamera(r,this.pxlEnv.pxlCamera.camera),s=this.pxlEnv.pxlCamera.objRaycast.intersectObjects(i)}this.mouseRayHits=s}hitColliders(e=[],t=T.FLOOR){e.length}hasColliders(){return this.collidersExist}hasColliderType(e=T.FLOOR){let t=!1;if(!this.hasColliders())return t;switch(e){case T.FLOOR:t=this.colliderActive;break;case T.WALL:t=this.antiColliderActive;break;case T.WALL_TOP:t=this.antiColliderTopActive;break;case T.CEILING:break;case T.PORTAL_WARP:t=this.hasPortalExit;break;case T.ROOM_WARP:t=this.hasRoomWarp;break;case T.ITEM:break;case T.SCRIPTED:break;case T.HOVERABLE:t=this.hasHoverables;break;case T.CLICKABLE:t=this.hasClickables;break;default:t=!1;break}return t}getColliders(e=T.FLOOR){let t=[];if(!this.hasColliders())return t;if(e===T.WALL&&!this.antiColliderActive)return t=this.antiColliderList,t;if(e===T.WALL_TOP&&!this.antiColliderTopActive)return t=this.antiColliderTopList,t;if(e===T.PORTAL_WARP&&!this.hasPortalExit)return t=this.portalList,t;if(e===T.ROOM_WARP&&!this.hasRoomWarp)return t=this.roomWarp,t;if(e===T.HOVERABLE&&!this.hasHoverables)return t=this.hoverableList,t;if(e===T.CLICKABLE&&!this.hasClickables)return t=this.clickableList,t;switch(e){case T.FLOOR:t=[...this.colliderList];break;case T.WALL:t=[...this.colliderList];break;case T.WALL_TOP:t=[...this.antiColliderTopList];break;case T.CEILING:break;case T.PORTAL_WARP:t=this.portalList;break;case T.ROOM_WARP:t=this.roomWarp;break;case T.ITEM:break;case T.SCRIPTED:break;default:break}return t}addColliderHelper(e=T.FLOOR){this.hasColliders()&&(this.helperObjects.hasOwnProperty("colliders")?this.helperObjects.colliders.hasOwnProperty(e)||(this.helperObjects.colliders[e]=null):(this.helperObjects.colliders={},this.helperObjects.colliders[e]=null),this.helperObjects.colliders[e]=this.pxlColliders.buildHelper(this,e),this.helperObjects.colliders[e]&&(this.scene.add(this.helperObjects.colliders[e]),this.hasHelpers=!0))}stepColliderHelper(e=T.FLOOR){!this.hasHelpers||!this.hasColliders()||!this.helperObjects.hasOwnProperty("colliders")||!this.helperObjects.colliders.hasOwnProperty(e)||this.helperObjects.colliders[e].stepHelper(this,e)}toCameraPos(e=null){if(e===null&&(e=this.defaultCamLocation),e=e.toLowerCase(),this.cameraBooted&&this.camLocation.hasOwnProperty(e)){let t=this.mobile?"positionmobile":"position",i=this.mobile?"lookatmobile":"lookat",s=this.camLocation[e][t],r=this.camLocation[e][i];r||(r=new Mt(0,0,1),r.addVectors(s,r)),this.pxlEnv.pxlCamera.setTransform(this.camLocation[e][t],this.camLocation[e][i]),this.setUserHeight(this.camInitPos.y)}}fbxPostLoad(){this.booted=!0,this.toCameraPos(this.defaultCamLocation);let e=0;this.lightList.hasOwnProperty("PointLight")&&(e=this.lightList.PointLight.length);let t=Object.keys(this.lightList);if(t.length>0&&t.forEach(s=>{this.lightList[s].forEach(r=>{s==="DirectionalLight"?r.castShadow=!1:s==="PointLight"&&r.castShadow&&(r.shadow.radius=5,r.shadow.receiveShadow=!0,r.shadow.mapSize.width=512,r.shadow.mapSize.height=512,r.shadow.camera.near=.5,r.shadow.camera.far=35,r.shadow.bias=.025,r.shadow.radius=5)})}),this.shaderGeoList)for(let s in this.shaderGeoList){let r=this.shaderGeoList[s];if(r.userData&&r.userData.Shader==="pxlPrincipled"){let a=td.merge([Ba.common,Ba.lights,Ba.shadowmap,{dTexture:{type:"t",value:null},noiseTexture:{type:"t",value:null},detailTexture:{type:"t",value:null},cdMult:{type:"f",value:1},fogColor:{type:"c",value:this.scene.fog.color}}]);var i={};i.USE_MAP="";let o={},n=!0,h=r.userData.castShadow===!0||r.userData.receiveShadow===!0,u=!0,c=!1;r.material.map||(c=r.material.color.clone()),r.userData.ShaderParms&&r.userData.ShaderParms!==""&&(o=JSON.parse(r.userData.ShaderParms));let p=this.pxlFile.pxlShaderBuilder(a,cs(h),us(o,c,u,n,h,e),i);p.transparent=!1,p.lights=!0,c||(p.uniforms.dTexture.value=r.material.map),p.uniforms.noiseTexture.value=this.cloud3dTexture,p.uniforms.detailTexture.value=this.pxlEnv.detailNoiseTexture,r.material=p,this.materialList[r.name]=p}}}animPostLoad(e,t){if(this.pxlAnim.hasClip(e,this.animInitCycle)){let i=this.pxlAnim.getMixer(e);this.animMixer=i,this.pxlAnim.playClip(e,this.animInitCycle)}else{let i=this.pxlAnim.getFallbackCycle(e);this.animInitCycle=i,this.log("No animation cycle '"+this.animInitCycle+"' found; Using '"+i+"' instead")}}build(){this.sceneFile}onMessage(e,t){switch(console.log("Room : "+this.roomName+" - Message Received: "+e),console.log("Message : "+t),e=e.toLowerCase(),e){case"roomwarp":this.roomWarp=t;break;default:case"roommessage":console.log("-- Message Type Not Recognized -- "),console.log("Room : "+this.roomName),console.log("Message Received: "+e),console.log("Message : "+t);break}}};var Es="pxlNav-coreCanvas",id,sd,wa=window.innerWidth,Sa=window.innerHeight,Da=class{constructor(e,t,i,s){this._active=!1,this.loaderStepTotalCount=9,this.pxlEnums=z,this.assetsToLoadDict={Cloud3d:!0,SoftNoise:!0,SmoothNoise:!0,ChromaticAberration:!1,WarpAnimTexture:!1,MathFuncs:!1},this.knownPostProcessPasses={mapComposerWarpPass:["cloud3dTexture"],chromaticAberrationPass:["ChromaticAberration"],lizardKingPass:["cloud3dTexture"],starFieldPass:["cloud3dTexture"],crystallinePass:["cloud3dTexture"]},this.pxlOptions=Object.assign({},e);let r=Object.keys(this.pxlOptions);Object.keys(at).forEach(n=>{r.includes(n)||(this.pxlOptions[n]=at[n])}),this.pxlOptions.hasOwnProperty("userSettings")||(this.pxlOptions.userSettings=Object.assign({},zi)),this.verbose=this.pxlOptions.verbose,this.projectTitle=t,this.startingRoom=i,this.startingRoomName=i.roomName;let o=[];s.forEach(n=>{o.push(n.roomName)}),this.roomBootList=s,s.includes(i)||s.push(i),this.callbacks={},this.uriHashParms=this.findHashParms(),this.mobile=this.isMobile(),this.pxlOptions.mobile=this.mobile,this.autoCam=this.getHashParm("autoCam",!1),this.loadPercent=0,this.folderDict={assetRoot:this.pxlOptions.pxlAssetRoot+"/",guiRoot:this.pxlOptions.pxlAssetRoot+"/GUI/",roomRoot:this.pxlOptions.pxlAssetRoot+"/rooms/",vidRoot:this.pxlOptions.pxlAssetRoot+"/screenContent/"},this.validEvents={booted:"Emitted after the engine has fully booted and is ready to be addressed.",step:"Emitted when frame update occurs, pre render.","render-prep":"Emitted when the pxlNav engine starting to prepare for scene rendering.","render-post":"Emitted when the pxlNav engine has finished rendering the scene.",shaderEditorVis:"Returns a [bool]; Emitted when the shader editor is toggled on or off.","roomChange-Start":"Emitted when the room change transition begins.","roomChange-Middle":"Emitted when the room change process occurs mid transition.","roomChange-End":"Returns a [bool]; Emitted when the room change transition ends.",fromRoom:"Returns a custom object; Emitted from your Room code you choose to emit during run time.","device-keydown":"Returns an [int]; The just pressed key.","device-keyup":"Returns an [int]; The just released key.","device-resize":"Returns an [{height:#,width:#}]; Height Width object of the new window size.","camera-move":"Returns a {'pos':vec3(),'dist':float}; Emitted when the camera moves.","camera-rotate":"Returns a [quaternion]; Emitted when the camera rotates.","camera-jump":"Returns a [bool]; Emitted when the camera jumps to a new position.","camera-fall":"Returns a [bool]; Emitted when the camera starts to free-fall / gravity.","camera-landed":"Returns a [bool]; Emitted when the camera lands from a jump / fall.","camera-collision":"Returns a [bool]; Emitted when the camera collides with an object.",pxlNavEventNameHere:"Never emitted; You did some copy'pasta.",".":"** NOTE : callbacks get an event object shaped - **","..":"**  callbackFn( eventType, eventValue ) **","...":"**  eventValue = { 'type' : *eventName*, 'value' : *data* } **","....":"",help:"Hello! I'm here to help you!",pingPong:"Send 'ping', Get 'pong'! - pxlNav.trigger('ping');"},this.validEventsKeys=Object.keys(this.validEvents),this.loadEnvAssetFile=this.pxlOptions.loadEnvAssetFile||!1,this.loadEnvAssetFile=!0,this.pxlTimer=new ce.Timer,this.pxlShaders=ma,this.pxlCookie=new ce.CookieManager(this.verbose,t,"/"),this.pxlCookie.hasCookie("forceMobile")&&(this.mobile=this.pxlCookie.parseCookie("forceMobile")),this.pxlQuality=new ce.QualityController(this.verbose,this.mobile,this.uriHashParms),this.pxlUtils=new ce.Utils(this.folderDict.assetRoot,this.mobile),this.pxlFile=new ce.FileIO(this.folderDict),this.pxlExtensions=null,this.pxlAudio=new ce.Audio(this.pxlTimer),this.pxlAutoCam=new ce.AutoCamera(this.autoCam,this.mobile),this.pxlAutoCam.active=!1,this.pxlUser=new ce.User,this.pxlRendering=new ce.Rendering(this.pxlOptions),this.pxlEnv=new ce.Environment(this.pxlOptions,this.startingRoomName,this.mobile),this.pxlDevice=new ce.Device(t,Es,this.mobile,this.autoCam),this.pxlColliders=new ce.Colliders(this.verbose,this.pxlOptions.collisionScale.gridSize,this.pxlOptions.collisionScale.gridReference),this.pxlCamera=new ce.Camera,this.pxlOptions.staticCamera&&this.pxlCamera.toggleMovement(!1),this.pxlCamera.setUserSettings(this.pxlOptions.userSettings),this.pxlAnim=new ce.Animation(this.folderDict.assetRoot,this.pxlTimer),this.pxlGuiDraws=new ce.GUI(this.verbose,t,this.folderDict.assetRoot,this.folderDict.guiRoot),this.pxlGuiDraws.pxlLoaderTotal=this.loaderStepTotalCount,this.pxlHUD=new ce.HUD,this.pxlQuality.setDependencies(this),this.pxlUtils.setDependencies(this),this.pxlFile.setDependencies(this),this.pxlAudio.setDependencies(this),this.pxlAutoCam.setDependencies(this),this.pxlUser.setDependencies(this),this.pxlEnv.setDependencies(this),this.pxlAnim.setDependencies(this),this.pxlDevice.setDependencies(this),this.pxlColliders.setDependencies(this),this.pxlCamera.setDependencies(this),this.pxlGuiDraws.setDependencies(this),this.pxlHUD.setDependencies(this),this.pxlRendering.setDependencies(this),this.pxlDevice.init(),this.pxlGuiDraws.prepLoader(),this.pxlOptions.hasOwnProperty("loaderPhrases")||(this.pxlOptions.loaderPhrases=["...loading the pixels..."]),this.pxlGuiDraws.setLoaderPhrases(this.pxlOptions.loaderPhrases),this.verbose>=z.VERBOSE_LEVEL.INFO&&(console.log("pxlNav v1.0.0-dev set to Verbose Info Mode"),console.log("  With Three.js v171"),console.log("Booting pxlNav...")),this.pxlQuality.init()}set active(e=null){e==null&&(e=!this.pxlTimer.active),e===!0?(this.pxlTimer.play(),this.step(!1)):this.pxlTimer.stop()}get active(){return this.pxlTimer.active}start(){this.active=!0}stop(){this.active=!1}log(...e){this.verbose>=z.VERBOSE_LEVEL.INFO&&console.log(...e)}warn(...e){this.verbose>=z.VERBOSE_LEVEL.WARN&&console.warn(...e)}error(...e){this.verbose>=z.VERBOSE_LEVEL.ERROR&&console.error(...e)}debug(...e){this.verbose>=z.VERBOSE_LEVEL.DEBUG&&console.debug(...e)}init(){this.pxlTimer.active||this.bootTimer(),this.pxlEnv.boot(),this.pxlQuality.startBenchmark(),this.checkPxlOptions(),this.buildGui().then(()=>{this.tickLoader(),this.pxlGuiDraws.stepLoader("Build Engine"),this.bootEnvironment()}).then(()=>{this.tickLoader(),this.pxlGuiDraws.stepLoader("Boot Engine"),this.bootEngine()}).then(()=>{this.tickLoader(),this.pxlGuiDraws.stepLoader("Build Composers"),this.pxlEnv.buildComposers(),this.pxlHUD.init()}).then(()=>{this.tickLoader(),this.cameraRunAnimatorMobile(this),this.pxlGuiDraws.stepLoader("postBoot"),this.pxlEnv.mapRender(!1),this.pxlDevice.setCursor("grab")}).catch(e=>{this.verbose>z.VERBOSE_LEVEL.NONE&&(console.error("Error in pxlNavCore.init(); Load level - ",e),console.error(e))}).finally(()=>{this.verbose>=z.VERBOSE_LEVEL.DEBUG&&(console.log("'pxlNavCore' Room Build Promise-Chain Completed; ",this.loadPercent),console.log("-- Starting pxlNav in Room `"+this.pxlEnv.bootRoom+"`")),this.start()})}checkPxlOptions(){if(this.pxlOptions.hasOwnProperty("postProcessPasses")){let e=Object.keys(this.pxlOptions.postProcessPasses),t=Object.keys(this.knownPostProcessPasses);e.forEach(i=>{t.includes(i)&&this.pxlOptions.postProcessPasses[i]&&this.knownPostProcessPasses[i].forEach(r=>{this.assetsToLoadDict[r]=!0})})}}buildGui(){return new Promise((e,t)=>{if(this.pxlGuiDraws.booted(),this.pxlGuiDraws.pxlNavCanvas=document.getElementById(Es),this.pxlGuiDraws.guiWindows.container.gui.appendChild(this.pxlGuiDraws.pxlNavCanvas),!this.pxlGuiDraws.pxlNavCanvas){console.error("pxlNav: Canvas element with ID '"+Es+"' not found in DOM"),t(new Error("Canvas element not found: "+Es));return}this.pxlGuiDraws.pxlNavCanvas.width=window.innerWidth*this.pxlQuality.screenResPerc,this.pxlGuiDraws.pxlNavCanvas.height=window.innerHeight*this.pxlQuality.screenResPerc,this.pxlDevice.canCursorLock&&(this.pxlGuiDraws.pxlNavCanvas.requestPointerLock=this.pxlGuiDraws.pxlNavCanvas.requestPointerLock||this.pxlGuiDraws.pxlNavCanvas.mozRequestPointerLock||this.pxlGuiDraws.pxlNavCanvas.webkitRequestPointerLock,document.requestPointerLock=this.pxlGuiDraws.pxlNavCanvas.exitPointerLock||this.pxlGuiDraws.pxlNavCanvas.mozExitPointerLock||this.pxlGuiDraws.pxlNavCanvas.webkitExitPointerLock),this.pxlGuiDraws.mapPrepPrompts(),e(!0)})}isMobile(){var e=!1;return e=/\b(BlackBerry|webOS|iPhone|IEMobile|Android|Windows Phone|iPad|iPod)\b/i.test(navigator.userAgent),e=this.getHashParm("m",e),e}findHashParms(){var e={},t=window.location.hash;if(t.length>1){t=t.substring(1);for(var i=t.split("&"),s=0;s<i.length;s++){var r=i[s].split("=");e[r[0]]=r[1]}}return e}getHashParm(e,t){return Object.keys(this.uriHashParms).includes(e)?this.uriHashParms[e]:t}tickLoader(){this.loadPercent+=1}bootEngine(){return new Promise((e,t)=>{let i=[];for(let s=0;s<this.roomBootList.length;++s)i.push(this.pxlEnv.loadRoom(this.roomBootList[s]));Promise.all(i).then(()=>{e(!0)}).catch(s=>{this.verbose>=z.VERBOSE_LEVEL.ERROR&&console.error("Error loading rooms:",s),t(s)})})}bootEnvironment(){return new Promise((e,t)=>{if(!this.pxlGuiDraws.pxlNavCanvas){console.error("pxlNav: Canvas not available for WebGLRenderer"),t(new Error("Canvas not available for WebGLRenderer"));return}try{this.pxlRendering.engine=new y.WebGLRenderer({canvas:this.pxlGuiDraws.pxlNavCanvas,powerPreference:"low-power",alpha:!0,antialias:!1,sortObjects:!0,depth:!0})}catch(c){console.error("pxlNav: Failed to create WebGLRenderer:",c),t(new Error("Failed to create WebGLRenderer: "+c.message));return}var i={format:y.RGBAFormat,antialias:!1,sortObjects:!0,alpha:!0,type:/(iPad|iPhone|iPod)/g.test(navigator.userAgent)?y.HalfFloatType:y.FloatType};this.pxlEnv.engine=this.pxlRendering.engine,this.pxlRendering.engine.autoClear=!0,y.ColorManagement.enabled=!0,this.pxlRendering.engine.outputColorSpace=y.LinearSRGBColorSpace,this.pxlRendering.engine.debug.checkShaderErrors=!1,this.pxlRendering.engine.debug.checkShaderErrors=!0;let s="#000000";this.pxlRendering.engine.setClearColor(this.pxlRendering.fogColor,0),this.pxlRendering.engine.setSize(id/this.pxlQuality.screenResPerc,sd/this.pxlQuality.screenResPerc),this.pxlRendering.engine.setSize(window.innerWidth,window.innerHeight),this.pxlRendering.engine.setPixelRatio(1),this.pxlOptions.shadowMapBiasing===z.SHADOW_MAP.OFF?this.pxlRendering.engine.shadowMap.enabled=!1:(this.pxlRendering.engine.shadowMap.enabled=!0,this.pxlRendering.engine.shadowMap.type=y.BasicShadowMap),this.pxlEnv.scene=new y.Scene,this.pxlEnv.scene.fog=this.pxlEnv.fog,this.pxlEnv.scene.background=new y.Color(s),this.pxlEnv.scene.renderTarget=new y.WebGLRenderTarget(wa*this.pxlQuality.screenResPerc,Sa*this.pxlQuality.screenResPerc,i),this.pxlEnv.scene.renderTarget.texture.format=y.RGBAFormat,this.pxlEnv.scene.renderTarget.texture.minFilter=y.LinearFilter,this.pxlEnv.scene.renderTarget.texture.magFilter=y.LinearFilter,this.pxlEnv.scene.renderTarget.texture.generateMipmaps=!1,this.pxlEnv.scene.renderTarget.depthBuffer=!0,this.pxlEnv.scene.renderTarget.depthTexture=new y.DepthTexture,this.pxlEnv.scene.renderTarget.depthTexture.format=y.DepthFormat,this.pxlEnv.scene.renderTarget.depthTexture.type=y.UnsignedIntType,this.pxlEnv.scene.renderWorldPos=new y.WebGLRenderTarget(wa*this.pxlQuality.screenResPerc,Sa*this.pxlQuality.screenResPerc,i),this.pxlEnv.scene.renderWorldPos.texture.format=y.RGBAFormat,this.pxlEnv.scene.renderWorldPos.texture.minFilter=y.NearestFilter,this.pxlEnv.scene.renderWorldPos.texture.magFilter=y.NearestFilter,this.pxlEnv.scene.renderWorldPos.texture.generateMipmaps=!1,i.alpha=!0,this.pxlEnv.scene.renderGlowTarget=new y.WebGLRenderTarget(parseInt(wa*this.pxlQuality.screenResPerc),parseInt(Sa*this.pxlQuality.screenResPerc),i),this.pxlEnv.scene.renderGlowTarget.texture.format=y.RGBAFormat,this.pxlEnv.scene.renderGlowTarget.texture.generateMipmaps=!1;let r=this.pxlEnv.pxlCamFOV[this.pxlDevice.mobile?"MOBILE":"PC"];if(this.pxlCamera.camera=new y.PerspectiveCamera(r,1,this.pxlEnv.camNear,this.pxlEnv.camFar),this.pxlAutoCam.camera=this.pxlCamera.camera,this.pxlCamera.cameraAimTarget=new y.Object3D,this.pxlEnv.scene.add(this.pxlCamera.cameraAimTarget),this.pxlCamera.camera.target=this.pxlCamera.cameraAimTarget,this.pxlCamera.camera.layers.enable(1),this.pxlCamera.camera.layers.enable(2),this.pxlEnv.scene.add(this.pxlEnv.userAvatarGroup),this.assetsToLoadDict.Cloud3d&&(this.pxlEnv.cloud3dTexture=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"Noise_Cloud3d.jpg",null,{encoding:y.LinearSRGBColorSpace}),this.pxlEnv.cloud3dTexture&&(this.pxlEnv.cloud3dTexture.wrapS=y.RepeatWrapping,this.pxlEnv.cloud3dTexture.wrapT=y.RepeatWrapping)),this.assetsToLoadDict.SoftNoise&&(this.pxlEnv.softNoiseTexture=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"Noise_Soft3d.jpg"),this.pxlEnv.softNoiseTexture&&(this.pxlEnv.softNoiseTexture.wrapS=y.RepeatWrapping,this.pxlEnv.softNoiseTexture.wrapT=y.RepeatWrapping)),this.assetsToLoadDict.SmoothNoise&&(this.pxlEnv.detailNoiseTexture=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"Noise_UniformSmooth.jpg"),this.pxlEnv.detailNoiseTexture&&(this.pxlEnv.detailNoiseTexture.wrapS=y.RepeatWrapping,this.pxlEnv.detailNoiseTexture.wrapT=y.RepeatWrapping)),this.assetsToLoadDict.ChromaticAberration){let c=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"uv_ChromaticAberration_rgb.jpg");c.minFilter=y.LinearFilter,c.magFilter=y.LinearFilter,this.pxlEnv.chroAberUVTexture=c;let p=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"uv_ChromaticAberration_alpha.jpg");p.minFilter=y.LinearFilter,p.magFilter=y.LinearFilter,this.pxlEnv.chroAberUVAlpha=p}this.assetsToLoadDict.WarpAnimTexture&&(this.pxlEnv.blockAnimTexture=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"uv_blockPortalWarp.jpg"),this.pxlEnv.blockAnimTexture.minFilter=y.LinearFilter,this.pxlEnv.blockAnimTexture.magFilter=y.LinearFilter);var a,o,n=(c=null)=>{var p={t:[0,0,0],r:[0,0,0],s:[1,1,1]};return c!=null&&(p[c[0]]=c[1]),p};if(o=n(),this.loadEnvAssetFile){let c=this.folderDict.assetRoot+"EnvironmentAssets.fbx";this.pxlFile.loadSceneFBX(c,a,o,this.verbose,"EnvironmentAssets",[this.pxlEnv.scene])}this.pxlOptions.shadowMapBiasing===z.SHADOW_MAP.OFF?this.pxlEnv.engine.shadowMap.enabled=!1:(this.pxlEnv.engine.shadowMap.enabled=!0,this.pxlOptions.shadowMapBiasing===z.SHADOW_MAP.BASIC||this.mobile?this.pxlEnv.engine.shadowMap.type=y.BasicShadowMap:this.pxlOptions.shadowMapBiasing===z.SHADOW_MAP.SOFT&&(this.pxlEnv.engine.shadowMap.type=y.PCFSoftShadowMap));var h=new y.AmbientLight(16777215,.05);this.pxlEnv.lightList.push(h),this.pxlEnv.scene.add(h);var u=new y.DirectionalLight(16777215,.1);u.position.set(1e3,550,1200),this.pxlEnv.lightList.push(u),this.pxlEnv.scene.add(u),e(!0)})}cameraRunAnimatorMobile(e){var s;let t=!1,i=Object.keys(e.pxlEnv.geoLoadList);for(let r=0;r<i.length&&(t=e.pxlEnv.geoLoadList[i[r]]===0,t=t&&!((s=e.pxlEnv.roomSceneList[r])!=null&&s.booted),!t);++r);t?setTimeout(()=>{e.cameraRunAnimatorMobile(e)},300):e.initRoomList(e)}initRoomList(e){e.pxlGuiDraws.stepLoader("camAnim"),e.pxlCamera.setTransform(e.pxlEnv.camInitPos,e.pxlEnv.camInitLookAt),e.pxlCamera.updateCamera(),e.pxlEnv.buildRoomEnvironments(),e.monitorRoomLoad(e)}monitorRoomLoad(e,t=0,i=25){var o;let s=!1,r=Object.keys(e.pxlEnv.geoLoadList),a=!at.fullLoadPreBoot;for(let n=0;n<r.length&&(s=e.pxlEnv.geoLoadList[r[n]]===0,s=s&&!((o=e.pxlEnv.roomSceneList[n])!=null&&o.booted),!(a&&r[n]===this.startingRoomName&&s));++n);t>i&&(this.warn("pxlNav: Room Load Monitor timed out, continuing with boot"),s=!1),s?setTimeout(()=>{e.monitorRoomLoad(e,t+1,i)},300):(e.pxlQuality.mapAutoQualityUpdate(1,!0),e.runPrepDrawScenes(0,!0,[]))}runPrepDrawScenes(e=0,t=!0,i=[]){if(e===0&&this.pxlGuiDraws.stepLoader("Room Prep"),e++,i.length>0){if(t){t=!1;let s=i[i.length-1];this.pxlCamera.warpToRoom(s)}if(this.pxlCamera.colliderPrevObjHit=null,this.pxlEnv.mapRender(!1),e%10===0){let s=i.pop();t=!0,this.pxlGuiDraws.stepLoader(s)}requestAnimationFrame(()=>{this.runPrepDrawScenes(e,t,i)})}else this.pxlGuiDraws.stepLoader("Post Room Prep"),this.pxlNavPrepSettings()}pxlNavPrepSettings(){this.pxlCamera.warpToRoom(this.pxlEnv.bootRoom,!0),this.pxlQuality.endBenchmark(),this.pxlGuiDraws.stepLoader("Nav Settings"),this.startPxlNav()}startPxlNav(){this.pxlTimer.init(),this.pxlTimer.play(),this.pxlGuiDraws.applyCookies(),this.pxlGuiDraws.pxlNavCanvas&&this.pxlGuiDraws.pxlNavCanvas.focus();let e=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom];e.active=!0,e.startTime=this.pxlTimer.msRunner.x,this.pxlEnv.roomPostGuiCalls.forEach(i=>{i.postGuiEvent()}),this.pxlEnv.roomPostGuiCalls=[],this.pxlAutoCam.enabled&&this.pxlGuiDraws.guiToggleVisibility(!1),this.pxlAutoCam.init(),this.pxlDevice.resizeRenderResolution(),this.pxlEnv.mapRender(),this.pxlQuality.setDependentSettings(),this.pxlGuiDraws.stepLoader("Starting...");let t=this;setTimeout(()=>{t.pxlEnv.postBoot(),t.pxlGuiDraws.mapPrompt&&t.pxlGuiDraws.promptFader(t.pxlGuiDraws.mapPrompt,!1,null,!0),t.pxlGuiDraws.mapPromptBG&&t.pxlGuiDraws.promptFader(t.pxlGuiDraws.mapPromptBG,!1,null,!1),this.pxlDevice.hideAddressBar(),t.emit("booted",!0)},200)}step(e=!1){this.pxlTimer.active&&(this.pxlTimer.step(),e&&requestAnimationFrame(()=>{this.step()}))}bootTimer(){this.pxlTimer.init(),this.pxlTimer.play()}stopTimer(){this.pxlTimer.stop()}pauseTimer(){this.pxlTimer.pause()}prepPromptFader(e,t=!1){let i=e;typeof i=="string"&&(i=document.getElementById(i)),i&&(i.classList.add("fader"),i.classList.add(t?"visOn":"visOff"),i.style.display=t?"inline-block":"none")}promptFader(e,t,i=null,s=!1){var r;typeof e=="string"&&(e=document.getElementById(e)),e&&(((r=e.classList)==null?void 0:r.value.indexOf("fader"))<0&&e.classList.add("fader"),t?(e.style.display="inline-block",setTimeout(()=>{e.classList.contains("visOff")&&(e.classList.remove("visOff"),e.classList.add("visOn"),i!=null&&e.setAttribute("fadeOut",i*1e3))},50)):(e.classList.remove("visOn"),e.classList.add("visOff"),s?["webkitTransitionEnd","otransitionend","oTransitionEnd","msTransitionEnd","transitionend"].forEach(o=>{e.addEventListener(o,()=>{let n=e.parentNode;n&&n.removeChild(e)})}):setTimeout(()=>{e.classList.contains("visOff")&&(e.style.display="none")},1e3)))}addRooms(e){for(let t=0;t<e.length;++t)this.pxlEnv.roomNameList.includes(e[t])||(this.booted?this.warn("pxlNav: Cannot add rooms after boot, room '"+e[t]+"' not added."):this.roomBootList.push(e[t]))}setBootRoom(e,t){this.pxlEnv.bootRoom=e,this.pxlEnv.bootLocation=t}setLoaderPhrases(e){this.pxlGuiDraws.setLoaderPhrases(e)}initExtension(e,t,i){this.pxlExtensions.init(e,t,i)}startExtension(e,t,i){this.pxlExtensions.start(e,t,i)}stopExtension(e,t,i){this.pxlExtensions.stop(e,t,i)}extensionStatus(e){return this.pxlExtensions.status(e)}trigger(e,t=null,i=null){switch(e=e.toLowerCase(),e){case"warptoroom":this.pxlCamera.warpToRoom(t,!0,i);break;case"camera":let s=t.toLowerCase();s==="roam"?this.pxlCamera.toggleMovement(!0):s==="static"&&this.pxlCamera.toggleMovement(!1);break;case"ping":this.emit("pingPong","pong");break;case"roommessage":let r=i.type,a=i.value;t===null&&(t=this.pxlEnv.currentRoom),this.pxlEnv.sendRoomMessage(t,r,a);break;default:break}}subscribe(e,t){if(this.validEventsKeys.includes(e))if(e==="test")console.log("Test Event : `pxlNav.subscribe( 'test', ... )` was used; subscription list -");else if(e==="pxlNavEventNameHere"||e==="help")e==="pxlNavEventNameHere"?console.warn("Warning : `pxlNav.subscribe( 'pxlNavEventNameHere', ... )` was used; need some help?"):e==="help"&&console.log("Help Requested : `pxlNav.subscribe( 'help', ... )` was used; Subscription items--"),console.log("Valid Event Types : "),this.validEventsKeys.forEach(i=>{console.log("  - ",i," : ",this.validEvents[i])});else{let i=e.split("-");if(i[0]==="device")this.pxlDevice.subscribe(i[1],t);else if(i[0]==="camera"){let s=z.CAMERA_EVENT.MOVE;switch(i[1]){case"move":s=z.CAMERA_EVENT.MOVE;break;case"rotate":s=z.CAMERA_EVENT.ROTATE;break;case"jump":s=z.CAMERA_EVENT.JUMP;break;case"fall":s=z.CAMERA_EVENT.FALL;break;case"landed":s=z.CAMERA_EVENT.LANDED;break;case"collision":s=z.CAMERA_EVENT.COLLISION;break;default:console.warn("Warning : `pxlNav.subscribe( 'camera-"+i[1]+"', ... )` was used; use 'help' for a list of valid events.");break}this.pxlCamera.subscribe(s,t)}else this.callbacks.hasOwnProperty(e)||(this.callbacks[e]=[]),this.callbacks[e].push(t)}else console.warn("Warning : `pxlNav.subscribe( '"+e+"', ... )` was used; use 'help' for a list of valid events.")}unsubscribe(e,t){let i=!1,s=e.split("-");if(s[0]==="device")i=this.pxlDevice.unsubscribe(s[1],t);else if(s[0]==="camera"){let r=z.CAMERA_EVENT.MOVE;switch(s[1]){case"move":r=z.CAMERA_EVENT.MOVE;break;case"rotate":r=z.CAMERA_EVENT.ROTATE;break;case"jump":r=z.CAMERA_EVENT.JUMP;break;case"fall":r=z.CAMERA_EVENT.FALL;break;case"landed":r=z.CAMERA_EVENT.LANDED;break;case"collision":r=z.CAMERA_EVENT.COLLISION;break;default:console.warn("Warning : `pxlNav.subscribe( 'camera-"+s[1]+"', ... )` was used; use 'help' for a list of valid events.");break}i=this.pxlCamera.unsubscribe(r,t)}else this.callbacks.hasOwnProperty(e)&&(this.callbacks.hasOwnProperty(e)&&this.callbacks[e]instanceof Array?(i=this.callbacks[e].includes(t),this.callbacks[e]=this.callbacks[e].filter(r=>r!==t)):console.warn("Warning : `pxlNav.unsubscribe( '"+e+"', ... )` was used; but the callback function does not match the one used in `pxlNav.subscribe()`."));return i}emit(e,t,i=null){if(this.callbacks.hasOwnProperty(e)){let s={type:e,value:t};i!==null&&(s.status=i);for(let r of this.callbacks[e])r(s)}}},rd="1.0.0",ad={pxlNav:Da,pxlNavVersion:rd,pxlEnums:z,pxlUserSettings:zi,pxlOptions:at,RoomEnvironment:ys,pxlEffects:Ql,pxlShaders:ma,pxlBase:ce};var qx=ad;export{ys as RoomEnvironment,qx as default,ce as pxlBase,Ql as pxlEffects,z as pxlEnums,Da as pxlNav,rd as pxlNavVersion,at as pxlOptions,ma as pxlShaders,zi as pxlUserSettings};
