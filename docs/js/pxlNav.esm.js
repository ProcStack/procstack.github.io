import*as u from"./libs/three/three.module.min.js";import*as d from"./libs/three/EffectComposer.js";import*as v from"./libs/three/RenderPass.js";import*as x from"./libs/three/ShaderPass.js";import*as y from"./libs/three/CopyShader.js";import*as b from"./libs/three/UnrealBloomPass.js";var _,w,S,C,P={527:(u,d,v)=>{var x={"./ExtensionBase.js":[535,9,535],"./Extensions.js":[261,9],"./Networking.js":[637,9,637],"./PoseEngine.js":[512,9,512],"./PoseEngine/MediaPipe.js":[475,9,475],"./PoseEngine/PoseEngine_worker.js":[745,7,745],"./WebCam.js":[654,9,654]};function webpackAsyncContext(u){if(!v.o(x,u))return Promise.resolve().then((()=>{var d=new Error("Cannot find module '"+u+"'");throw d.code="MODULE_NOT_FOUND",d}));var d=x[u],y=d[0];return Promise.all(d.slice(2).map(v.e)).then((()=>v.t(y,16|d[1])))}webpackAsyncContext.keys=()=>Object.keys(x),webpackAsyncContext.id=527,u.exports=webpackAsyncContext},436:u=>{function webpackEmptyAsyncContext(u){return Promise.resolve().then((()=>{var d=new Error("Cannot find module '"+u+"'");throw d.code="MODULE_NOT_FOUND",d}))}webpackEmptyAsyncContext.keys=()=>[],webpackEmptyAsyncContext.resolve=webpackEmptyAsyncContext,webpackEmptyAsyncContext.id=436,u.exports=webpackEmptyAsyncContext},261:(u,d,v)=>{function asyncGeneratorStep(u,d,v,x,y,b,_){try{var w=u[b](_),S=w.value}catch(u){return void v(u)}w.done?d(S):Promise.resolve(S).then(x,y)}v.r(d),v.d(d,{Extensions:()=>Extensions});var x=["PoseEngine"];class Extensions{constructor(){this.plugins={},this.verbose=!1}init(u,d,v){var x=arguments.length>3&&void 0!==arguments[3]&&arguments[3];!this.plugins[u]||x?this.load(u,((u,x)=>{u?v?v(u):this.verbose&&console.error(u):d&&d(x)})):(this.verbose&&console.log("Extension ".concat(u," already booted, skipping...")),d&&d(this.plugins[u]))}load(u,d){var y=this;return function _asyncToGenerator(u){return function(){var d=this,v=arguments;return new Promise((function(x,y){var b=u.apply(d,v);function _next(u){asyncGeneratorStep(b,x,y,_next,_throw,"next",u)}function _throw(u){asyncGeneratorStep(b,x,y,_next,_throw,"throw",u)}_next(void 0)}))}}((function*(){if(x.includes(u))try{var b=new((yield v(527)("./".concat(u,".js"))).default);try{y.boot(u,b)}catch(d){console.error("Error (2) Booting extension '".concat(u,"':"),d)}d&&d(null,b)}catch(v){console.error("Error (1) Importing / Parsing extension '".concat(u,"':"),v),d&&d(err,null)}else{var _=new Error("Extension ".concat(u," not found"));console.error(_),d&&d(_,null)}}))()}start(u){var d=this.get(u);d&&d.start()}pause(u){var d=this.get(u);d&&d.pause()}stop(u){var d=this.get(u);d&&d.stop()}status(u){var d=this.get(u);return!!d&&d.active}boot(u,d){this.plugins[u]=d,d.init()}get(u){return this.plugins[u]?this.plugins[u]:(console.warn("Extension ".concat(u," not found")),null)}unload(u){var d=this.get(u);d&&(d.destroy(),delete this.plugins[u])}}}},A={};function __webpack_require__(u){var d=A[u];if(void 0!==d)return d.exports;var v=A[u]={exports:{}};return P[u](v,v.exports,__webpack_require__),v.exports}__webpack_require__.m=P,w=Object.getPrototypeOf?u=>Object.getPrototypeOf(u):u=>u.__proto__,__webpack_require__.t=function(u,d){if(1&d&&(u=this(u)),8&d)return u;if("object"==typeof u&&u){if(4&d&&u.__esModule)return u;if(16&d&&"function"==typeof u.then)return u}var v=Object.create(null);__webpack_require__.r(v);var x={};_=_||[null,w({}),w([]),w(w)];for(var y=2&d&&u;"object"==typeof y&&!~_.indexOf(y);y=w(y))Object.getOwnPropertyNames(y).forEach((d=>x[d]=()=>u[d]));return x.default=()=>u,__webpack_require__.d(v,x),v},__webpack_require__.d=(u,d)=>{for(var v in d)__webpack_require__.o(d,v)&&!__webpack_require__.o(u,v)&&Object.defineProperty(u,v,{enumerable:!0,get:d[v]})},__webpack_require__.f={},__webpack_require__.e=u=>Promise.all(Object.keys(__webpack_require__.f).reduce(((d,v)=>(__webpack_require__.f[v](u,d),d)),[])),__webpack_require__.u=u=>"pxlNavChunkDir/"+u+".esm.js",__webpack_require__.miniCssF=u=>{},__webpack_require__.o=(u,d)=>Object.prototype.hasOwnProperty.call(u,d),__webpack_require__.r=u=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})},(()=>{var u;if("string"==typeof import.meta.url&&(u=import.meta.url),!u)throw new Error("Automatic publicPath is not supported in this browser");u=u.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),__webpack_require__.p=u})(),S={226:0},C=u=>{var d,v,{ids:x,modules:y,runtime:b}=u,_=0;for(d in y)__webpack_require__.o(y,d)&&(__webpack_require__.m[d]=y[d]);for(b&&b(__webpack_require__);_<x.length;_++)v=x[_],__webpack_require__.o(S,v)&&S[v]&&S[v][0](),S[x[_]]=0},__webpack_require__.f.j=(u,d)=>{var v=__webpack_require__.o(S,u)?S[u]:void 0;if(0!==v)if(v)d.push(v[1]);else{var x=import("./"+__webpack_require__.u(u)).then(C,(d=>{throw 0!==S[u]&&(S[u]=void 0),d}));x=Promise.race([x,new Promise((d=>v=S[u]=[d]))]),d.push(v[1]=x)}};var T={};__webpack_require__.d(T,{l$:()=>pxlNav_RoomEnvironment,eT:()=>Zs,vi:()=>Qs,Bn:()=>Fs,IF:()=>pxlNav_pxlNav,uU:()=>$s,Z$:()=>js,pL:()=>Js});var E={};__webpack_require__.r(E),__webpack_require__.d(E,{camPosVert:()=>pxlNav_camPosVert,defaultShiftVert:()=>pxlNav_defaultShiftVert,defaultVert:()=>pxlNav_defaultVert,discardFrag:()=>pxlNav_discardFrag,shaderHeader:()=>pxlNav_ShaderHeader_shaderHeader});var D={};__webpack_require__.r(D),__webpack_require__.d(D,{animTextureFrag:()=>pxlNav_animTextureFrag,animTextureVert:()=>pxlNav_animTextureVert,clickableBevelFrag:()=>pxlNav_clickableBevelFrag,clickableBevelVert:()=>pxlNav_clickableBevelVert,portalBaseFrag:()=>pxlNav_portalBaseFrag,portalBaseVert:()=>pxlNav_portalBaseVert});var I={};__webpack_require__.r(I),__webpack_require__.d(I,{itemBaseFrag:()=>pxlNav_itemBaseFrag,itemBaseVert:()=>pxlNav_itemBaseVert,itemFrag:()=>pxlNav_itemFrag,itemVert:()=>pxlNav_itemVert,itemZoomFrag:()=>pxlNav_itemZoomFrag,pxlPrincipledFrag:()=>pxlNav_pxlPrincipledFrag,pxlPrincipledVert:()=>pxlNav_pxlPrincipledVert});var k={};__webpack_require__.r(k),__webpack_require__.d(k,{dustFrag:()=>pxlNav_dustFrag,dustVert:()=>pxlNav_dustVert,emberWispsFrag:()=>pxlNav_emberWispsFrag,emberWispsVert:()=>pxlNav_emberWispsVert,smokeFrag:()=>pxlNav_smokeFrag,smokeVert:()=>pxlNav_smokeVert,snowFrag:()=>pxlNav_snowFrag,snowVert:()=>pxlNav_snowVert});var R={};__webpack_require__.r(R),__webpack_require__.d(R,{boxAntiAliasPass:()=>pxlNav_boxAntiAliasPass,chroAberPostProcess:()=>pxlNav_chroAberPostProcess,compLayersPostProcess:()=>pxlNav_compLayersPostProcess,crossAntiAliasPass:()=>pxlNav_crossAntiAliasPass,directionalBlurPass:()=>pxlNav_directionalBlurPass,finalOverlayHeavyShader:()=>pxlNav_finalOverlayHeavyShader,finalOverlayShader:()=>pxlNav_finalOverlayShader,finalOverlaySlimShader:()=>pxlNav_finalOverlaySlimShader,glowPassPostProcess:()=>pxlNav_glowPassPostProcess,iZoomPostProcess:()=>pxlNav_iZoomPostProcess,lKingPostProcess:()=>pxlNav_lKingPostProcess,mixBlurShaderPass:()=>pxlNav_mixBlurShaderPass,motionBlurPostProcess:()=>pxlNav_motionBlurPostProcess,sFieldPostProcessFrag:()=>pxlNav_sFieldPostProcessFrag,sFieldPostProcessVert:()=>pxlNav_sFieldPostProcessVert,textureStorePass:()=>pxlNav_textureStorePass,warpPostProcess:()=>pxlNav_warpPostProcess,worldPositionFrag:()=>pxlNav_worldPositionFrag,worldPositionVert:()=>pxlNav_worldPositionVert});var O={};__webpack_require__.r(O),__webpack_require__.d(O,{bgScreenFrag:()=>pxlNav_bgScreenFrag,bgScreenVert:()=>pxlNav_bgScreenVert,skyObjectFrag:()=>pxlNav_skyObjectFrag,skyObjectVert:()=>pxlNav_skyObjectVert});const j=(G={AlphaFormat:()=>u.AlphaFormat,AmbientLight:()=>u.AmbientLight,AnimationMixer:()=>u.AnimationMixer,BackSide:()=>u.BackSide,BasicShadowMap:()=>u.BasicShadowMap,Box3:()=>u.Box3,BufferGeometry:()=>u.BufferGeometry,CanvasTexture:()=>u.CanvasTexture,Clock:()=>u.Clock,Color:()=>u.Color,ColorManagement:()=>u.ColorManagement,DepthFormat:()=>u.DepthFormat,DepthTexture:()=>u.DepthTexture,DirectionalLight:()=>u.DirectionalLight,DoubleSide:()=>u.DoubleSide,DynamicDrawUsage:()=>u.DynamicDrawUsage,Euler:()=>u.Euler,Float32BufferAttribute:()=>u.Float32BufferAttribute,FloatType:()=>u.FloatType,FogExp2:()=>u.FogExp2,FrontSide:()=>u.FrontSide,Group:()=>u.Group,HalfFloatType:()=>u.HalfFloatType,ImageLoader:()=>u.ImageLoader,InstancedMesh:()=>u.InstancedMesh,LinearFilter:()=>u.LinearFilter,LinearSRGBColorSpace:()=>u.LinearSRGBColorSpace,LuminanceFormat:()=>u.LuminanceFormat,Matrix4:()=>u.Matrix4,Mesh:()=>u.Mesh,MeshBasicMaterial:()=>u.MeshBasicMaterial,MeshStandardMaterial:()=>u.MeshStandardMaterial,NearestFilter:()=>u.NearestFilter,NearestMipmapNearestFilter:()=>u.NearestMipmapNearestFilter,Object3D:()=>u.Object3D,PCFSoftShadowMap:()=>u.PCFSoftShadowMap,PerspectiveCamera:()=>u.PerspectiveCamera,Points:()=>u.Points,Quaternion:()=>u.Quaternion,RGBAFormat:()=>u.RGBAFormat,RGBFormat:()=>u.RGBFormat,RGFormat:()=>u.RGFormat,Raycaster:()=>u.Raycaster,RedFormat:()=>u.RedFormat,RepeatWrapping:()=>u.RepeatWrapping,SRGBColorSpace:()=>u.SRGBColorSpace,Scene:()=>u.Scene,ShaderChunk:()=>u.ShaderChunk,ShaderMaterial:()=>u.ShaderMaterial,Texture:()=>u.Texture,UniformsLib:()=>u.UniformsLib,UniformsUtils:()=>u.UniformsUtils,UnsignedIntType:()=>u.UnsignedIntType,UnsignedShortType:()=>u.UnsignedShortType,Vector2:()=>u.Vector2,Vector3:()=>u.Vector3,Vector4:()=>u.Vector4,VideoTexture:()=>u.VideoTexture,WebGLRenderTarget:()=>u.WebGLRenderTarget,WebGLRenderer:()=>u.WebGLRenderer},H={},__webpack_require__.d(H,G),H);var G,H;var X="attached",q=1e3,Z=1001,J=1002,Q=1015,K=1023,Y=2300,$=2301,ee=2302,te=2400,ie=2401,se=2402,re="srgb",ae="srgb-linear",ne="linear",oe="srgb",le=7680,he=35044,ue=2e3,ce=2001;class pxlNav_Ns{addEventListener(u,d){void 0===this._listeners&&(this._listeners={});var v=this._listeners;void 0===v[u]&&(v[u]=[]),-1===v[u].indexOf(d)&&v[u].push(d)}hasEventListener(u,d){if(void 0===this._listeners)return!1;var v=this._listeners;return void 0!==v[u]&&-1!==v[u].indexOf(d)}removeEventListener(u,d){if(void 0!==this._listeners){var v=this._listeners[u];if(void 0!==v){var x=v.indexOf(d);-1!==x&&v.splice(x,1)}}}dispatchEvent(u){if(void 0!==this._listeners){var d=this._listeners[u.type];if(void 0!==d){u.target=this;for(var v=d.slice(0),x=0,y=v.length;x<y;x++)v[x].call(this,u);u.target=null}}}}var pe=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],de=Math.PI/180,ve=180/Math.PI;function pxlNav_js(){var u=4294967295*Math.random()|0,d=4294967295*Math.random()|0,v=4294967295*Math.random()|0,x=4294967295*Math.random()|0;return(pe[255&u]+pe[u>>8&255]+pe[u>>16&255]+pe[u>>24&255]+"-"+pe[255&d]+pe[d>>8&255]+"-"+pe[d>>16&15|64]+pe[d>>24&255]+"-"+pe[63&v|128]+pe[v>>8&255]+"-"+pe[v>>16&255]+pe[v>>24&255]+pe[255&x]+pe[x>>8&255]+pe[x>>16&255]+pe[x>>24&255]).toLowerCase()}function pxlNav_Ds(u,d,v){return Math.max(d,Math.min(v,u))}function pxlNav_Hs(u,d){return(u%d+d)%d}function pxlNav_qs(u,d,v){return(1-v)*u+v*d}function pxlNav_Js(u,d){switch(d.constructor){case Float32Array:return u;case Uint32Array:return u/4294967295;case Uint16Array:return u/65535;case Uint8Array:return u/255;case Int32Array:return Math.max(u/2147483647,-1);case Int16Array:return Math.max(u/32767,-1);case Int8Array:return Math.max(u/127,-1);default:throw new Error("Invalid component type.")}}function pxlNav_Xs(u,d){switch(d.constructor){case Float32Array:return u;case Uint32Array:return Math.round(4294967295*u);case Uint16Array:return Math.round(65535*u);case Uint8Array:return Math.round(255*u);case Int32Array:return Math.round(2147483647*u);case Int16Array:return Math.round(32767*u);case Int8Array:return Math.round(127*u);default:throw new Error("Invalid component type.")}}var me=function degToRad(u){return u*de};class pxlNav_Zs{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;pxlNav_Zs.prototype.isVector2=!0,this.x=u,this.y=d}get width(){return this.x}set width(u){this.x=u}get height(){return this.y}set height(u){this.y=u}set(u,d){return this.x=u,this.y=d,this}setScalar(u){return this.x=u,this.y=u,this}setX(u){return this.x=u,this}setY(u){return this.y=u,this}setComponent(u,d){switch(u){case 0:this.x=d;break;case 1:this.y=d;break;default:throw new Error("index is out of range: "+u)}return this}getComponent(u){switch(u){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+u)}}clone(){return new this.constructor(this.x,this.y)}copy(u){return this.x=u.x,this.y=u.y,this}add(u){return this.x+=u.x,this.y+=u.y,this}addScalar(u){return this.x+=u,this.y+=u,this}addVectors(u,d){return this.x=u.x+d.x,this.y=u.y+d.y,this}addScaledVector(u,d){return this.x+=u.x*d,this.y+=u.y*d,this}sub(u){return this.x-=u.x,this.y-=u.y,this}subScalar(u){return this.x-=u,this.y-=u,this}subVectors(u,d){return this.x=u.x-d.x,this.y=u.y-d.y,this}multiply(u){return this.x*=u.x,this.y*=u.y,this}multiplyScalar(u){return this.x*=u,this.y*=u,this}divide(u){return this.x/=u.x,this.y/=u.y,this}divideScalar(u){return this.multiplyScalar(1/u)}applyMatrix3(u){var d=this.x,v=this.y,x=u.elements;return this.x=x[0]*d+x[3]*v+x[6],this.y=x[1]*d+x[4]*v+x[7],this}min(u){return this.x=Math.min(this.x,u.x),this.y=Math.min(this.y,u.y),this}max(u){return this.x=Math.max(this.x,u.x),this.y=Math.max(this.y,u.y),this}clamp(u,d){return this.x=pxlNav_Ds(this.x,u.x,d.x),this.y=pxlNav_Ds(this.y,u.y,d.y),this}clampScalar(u,d){return this.x=pxlNav_Ds(this.x,u,d),this.y=pxlNav_Ds(this.y,u,d),this}clampLength(u,d){var v=this.length();return this.divideScalar(v||1).multiplyScalar(pxlNav_Ds(v,u,d))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(u){return this.x*u.x+this.y*u.y}cross(u){return this.x*u.y-this.y*u.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(u){var d=Math.sqrt(this.lengthSq()*u.lengthSq());if(0===d)return Math.PI/2;var v=this.dot(u)/d;return Math.acos(pxlNav_Ds(v,-1,1))}distanceTo(u){return Math.sqrt(this.distanceToSquared(u))}distanceToSquared(u){var d=this.x-u.x,v=this.y-u.y;return d*d+v*v}manhattanDistanceTo(u){return Math.abs(this.x-u.x)+Math.abs(this.y-u.y)}setLength(u){return this.normalize().multiplyScalar(u)}lerp(u,d){return this.x+=(u.x-this.x)*d,this.y+=(u.y-this.y)*d,this}lerpVectors(u,d,v){return this.x=u.x+(d.x-u.x)*v,this.y=u.y+(d.y-u.y)*v,this}equals(u){return u.x===this.x&&u.y===this.y}fromArray(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=u[d],this.y=u[d+1],this}toArray(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return u[d]=this.x,u[d+1]=this.y,u}fromBufferAttribute(u,d){return this.x=u.getX(d),this.y=u.getY(d),this}rotateAround(u,d){var v=Math.cos(d),x=Math.sin(d),y=this.x-u.x,b=this.y-u.y;return this.x=y*v-b*x+u.x,this.y=y*x+b*v+u.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class pxlNav_Gs{constructor(u,d,v,x,y,b,_,w,S){pxlNav_Gs.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==u&&this.set(u,d,v,x,y,b,_,w,S)}set(u,d,v,x,y,b,_,w,S){var C=this.elements;return C[0]=u,C[1]=x,C[2]=_,C[3]=d,C[4]=y,C[5]=w,C[6]=v,C[7]=b,C[8]=S,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(u){var d=this.elements,v=u.elements;return d[0]=v[0],d[1]=v[1],d[2]=v[2],d[3]=v[3],d[4]=v[4],d[5]=v[5],d[6]=v[6],d[7]=v[7],d[8]=v[8],this}extractBasis(u,d,v){return u.setFromMatrix3Column(this,0),d.setFromMatrix3Column(this,1),v.setFromMatrix3Column(this,2),this}setFromMatrix4(u){var d=u.elements;return this.set(d[0],d[4],d[8],d[1],d[5],d[9],d[2],d[6],d[10]),this}multiply(u){return this.multiplyMatrices(this,u)}premultiply(u){return this.multiplyMatrices(u,this)}multiplyMatrices(u,d){var v=u.elements,x=d.elements,y=this.elements,b=v[0],_=v[3],w=v[6],S=v[1],C=v[4],P=v[7],A=v[2],T=v[5],E=v[8],D=x[0],I=x[3],k=x[6],R=x[1],O=x[4],j=x[7],G=x[2],H=x[5],X=x[8];return y[0]=b*D+_*R+w*G,y[3]=b*I+_*O+w*H,y[6]=b*k+_*j+w*X,y[1]=S*D+C*R+P*G,y[4]=S*I+C*O+P*H,y[7]=S*k+C*j+P*X,y[2]=A*D+T*R+E*G,y[5]=A*I+T*O+E*H,y[8]=A*k+T*j+E*X,this}multiplyScalar(u){var d=this.elements;return d[0]*=u,d[3]*=u,d[6]*=u,d[1]*=u,d[4]*=u,d[7]*=u,d[2]*=u,d[5]*=u,d[8]*=u,this}determinant(){var u=this.elements,d=u[0],v=u[1],x=u[2],y=u[3],b=u[4],_=u[5],w=u[6],S=u[7],C=u[8];return d*b*C-d*_*S-v*y*C+v*_*w+x*y*S-x*b*w}invert(){var u=this.elements,d=u[0],v=u[1],x=u[2],y=u[3],b=u[4],_=u[5],w=u[6],S=u[7],C=u[8],P=C*b-_*S,A=_*w-C*y,T=S*y-b*w,E=d*P+v*A+x*T;if(0===E)return this.set(0,0,0,0,0,0,0,0,0);var D=1/E;return u[0]=P*D,u[1]=(x*S-C*v)*D,u[2]=(_*v-x*b)*D,u[3]=A*D,u[4]=(C*d-x*w)*D,u[5]=(x*y-_*d)*D,u[6]=T*D,u[7]=(v*w-S*d)*D,u[8]=(b*d-v*y)*D,this}transpose(){var u,d=this.elements;return u=d[1],d[1]=d[3],d[3]=u,u=d[2],d[2]=d[6],d[6]=u,u=d[5],d[5]=d[7],d[7]=u,this}getNormalMatrix(u){return this.setFromMatrix4(u).invert().transpose()}transposeIntoArray(u){var d=this.elements;return u[0]=d[0],u[1]=d[3],u[2]=d[6],u[3]=d[1],u[4]=d[4],u[5]=d[7],u[6]=d[2],u[7]=d[5],u[8]=d[8],this}setUvTransform(u,d,v,x,y,b,_){var w=Math.cos(y),S=Math.sin(y);return this.set(v*w,v*S,-v*(w*b+S*_)+b+u,-x*S,x*w,-x*(-S*b+w*_)+_+d,0,0,1),this}scale(u,d){return this.premultiply(xe.makeScale(u,d)),this}rotate(u){return this.premultiply(xe.makeRotation(-u)),this}translate(u,d){return this.premultiply(xe.makeTranslation(u,d)),this}makeTranslation(u,d){return u.isVector2?this.set(1,0,u.x,0,1,u.y,0,0,1):this.set(1,0,u,0,1,d,0,0,1),this}makeRotation(u){var d=Math.cos(u),v=Math.sin(u);return this.set(d,-v,0,v,d,0,0,0,1),this}makeScale(u,d){return this.set(u,0,0,0,d,0,0,0,1),this}equals(u){for(var d=this.elements,v=u.elements,x=0;x<9;x++)if(d[x]!==v[x])return!1;return!0}fromArray(u){for(var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=0;v<9;v++)this.elements[v]=u[v+d];return this}toArray(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=this.elements;return u[d]=v[0],u[d+1]=v[1],u[d+2]=v[2],u[d+3]=v[3],u[d+4]=v[4],u[d+5]=v[5],u[d+6]=v[6],u[d+7]=v[7],u[d+8]=v[8],u}clone(){return(new this.constructor).fromArray(this.elements)}}var xe=new pxlNav_Gs;Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;function pxlNav_ei(u){return document.createElementNS("http://www.w3.org/1999/xhtml",u)}var ge=(new pxlNav_Gs).set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),fe=(new pxlNav_Gs).set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);var ye,be=function pxlNav_ci(){var u={enabled:!0,workingColorSpace:ae,spaces:{},convert:function convert(u,d,v){return!1!==this.enabled&&d!==v&&d&&v?(this.spaces[d].transfer===oe&&(u.r=pxlNav_di(u.r),u.g=pxlNav_di(u.g),u.b=pxlNav_di(u.b)),this.spaces[d].primaries!==this.spaces[v].primaries&&(u.applyMatrix3(this.spaces[d].toXYZ),u.applyMatrix3(this.spaces[v].fromXYZ)),this.spaces[v].transfer===oe&&(u.r=pxlNav_three_core_min_pi(u.r),u.g=pxlNav_three_core_min_pi(u.g),u.b=pxlNav_three_core_min_pi(u.b)),u):u},fromWorkingColorSpace:function fromWorkingColorSpace(u,d){return this.convert(u,this.workingColorSpace,d)},toWorkingColorSpace:function toWorkingColorSpace(u,d){return this.convert(u,d,this.workingColorSpace)},getPrimaries:function getPrimaries(u){return this.spaces[u].primaries},getTransfer:function getTransfer(u){return""===u?ne:this.spaces[u].transfer},getLuminanceCoefficients:function getLuminanceCoefficients(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.workingColorSpace;return u.fromArray(this.spaces[d].luminanceCoefficients)},define:function define(u){Object.assign(this.spaces,u)},_getMatrix:function _getMatrix(u,d,v){return u.copy(this.spaces[d].toXYZ).multiply(this.spaces[v].fromXYZ)},_getDrawingBufferColorSpace:function _getDrawingBufferColorSpace(u){return this.spaces[u].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function _getUnpackColorSpace(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.workingColorSpace;return this.spaces[u].workingColorSpaceConfig.unpackColorSpace}},d=[.64,.33,.3,.6,.15,.06],v=[.2126,.7152,.0722],x=[.3127,.329];return u.define({[ae]:{primaries:d,whitePoint:x,transfer:ne,toXYZ:ge,fromXYZ:fe,luminanceCoefficients:v,workingColorSpaceConfig:{unpackColorSpace:re},outputColorSpaceConfig:{drawingBufferColorSpace:re}},[re]:{primaries:d,whitePoint:x,transfer:oe,toXYZ:ge,fromXYZ:fe,luminanceCoefficients:v,outputColorSpaceConfig:{drawingBufferColorSpace:re}}}),u}();function pxlNav_di(u){return u<.04045?.0773993808*u:Math.pow(.9478672986*u+.0521327014,2.4)}function pxlNav_three_core_min_pi(u){return u<.0031308?12.92*u:1.055*Math.pow(u,.41666)-.055}class pxlNav_yi{static getDataURL(u){if(/^data:/i.test(u.src))return u.src;if("undefined"==typeof HTMLCanvasElement)return u.src;var d;if(u instanceof HTMLCanvasElement)d=u;else{void 0===ye&&(ye=pxlNav_ei("canvas")),ye.width=u.width,ye.height=u.height;var v=ye.getContext("2d");u instanceof ImageData?v.putImageData(u,0,0):v.drawImage(u,0,0,u.width,u.height),d=ye}return d.width>2048||d.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",u),d.toDataURL("image/jpeg",.6)):d.toDataURL("image/png")}static sRGBToLinear(u){if("undefined"!=typeof HTMLImageElement&&u instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&u instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&u instanceof ImageBitmap){var d=pxlNav_ei("canvas");d.width=u.width,d.height=u.height;var v=d.getContext("2d");v.drawImage(u,0,0,u.width,u.height);for(var x=v.getImageData(0,0,u.width,u.height),y=x.data,b=0;b<y.length;b++)y[b]=255*pxlNav_di(y[b]/255);return v.putImageData(x,0,0),d}if(u.data){for(var _=u.data.slice(0),w=0;w<_.length;w++)_ instanceof Uint8Array||_ instanceof Uint8ClampedArray?_[w]=Math.floor(255*pxlNav_di(_[w]/255)):_[w]=pxlNav_di(_[w]);return{data:_,width:u.width,height:u.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),u}}var _e=0;class pxlNav_gi{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.isSource=!0,Object.defineProperty(this,"id",{value:_e++}),this.uuid=pxlNav_js(),this.data=u,this.dataReady=!0,this.version=0}set needsUpdate(u){!0===u&&this.version++}toJSON(u){var d=void 0===u||"string"==typeof u;if(!d&&void 0!==u.images[this.uuid])return u.images[this.uuid];var v={uuid:this.uuid,url:""},x=this.data;if(null!==x){var y;if(Array.isArray(x)){y=[];for(var b=0,_=x.length;b<_;b++)x[b].isDataTexture?y.push(pxlNav_xi(x[b].image)):y.push(pxlNav_xi(x[b]))}else y=pxlNav_xi(x);v.url=y}return d||(u.images[this.uuid]=v),v}}function pxlNav_xi(u){return"undefined"!=typeof HTMLImageElement&&u instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&u instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&u instanceof ImageBitmap?pxlNav_yi.getDataURL(u):u.data?{data:Array.from(u.data),width:u.width,height:u.height,type:u.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var we=0;class pxlNav_vi extends pxlNav_Ns{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:pxlNav_vi.DEFAULT_IMAGE,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:pxlNav_vi.DEFAULT_MAPPING,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1001,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1001,y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1006,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1008,_=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1023,w=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1009,S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:pxlNav_vi.DEFAULT_ANISOTROPY,C=arguments.length>9&&void 0!==arguments[9]?arguments[9]:"";super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:we++}),this.uuid=pxlNav_js(),this.name="",this.source=new pxlNav_gi(u),this.mipmaps=[],this.mapping=d,this.channel=0,this.wrapS=v,this.wrapT=x,this.magFilter=y,this.minFilter=b,this.anisotropy=S,this.format=_,this.internalFormat=null,this.type=w,this.offset=new pxlNav_Zs(0,0),this.repeat=new pxlNav_Zs(1,1),this.center=new pxlNav_Zs(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new pxlNav_Gs,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=C,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(u){void 0===u&&(u=null),this.source.data=u}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(u){return this.name=u.name,this.source=u.source,this.mipmaps=u.mipmaps.slice(0),this.mapping=u.mapping,this.channel=u.channel,this.wrapS=u.wrapS,this.wrapT=u.wrapT,this.magFilter=u.magFilter,this.minFilter=u.minFilter,this.anisotropy=u.anisotropy,this.format=u.format,this.internalFormat=u.internalFormat,this.type=u.type,this.offset.copy(u.offset),this.repeat.copy(u.repeat),this.center.copy(u.center),this.rotation=u.rotation,this.matrixAutoUpdate=u.matrixAutoUpdate,this.matrix.copy(u.matrix),this.generateMipmaps=u.generateMipmaps,this.premultiplyAlpha=u.premultiplyAlpha,this.flipY=u.flipY,this.unpackAlignment=u.unpackAlignment,this.colorSpace=u.colorSpace,this.userData=JSON.parse(JSON.stringify(u.userData)),this.needsUpdate=!0,this}toJSON(u){var d=void 0===u||"string"==typeof u;if(!d&&void 0!==u.textures[this.uuid])return u.textures[this.uuid];var v={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(u).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(v.userData=this.userData),d||(u.textures[this.uuid]=v),v}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(u){if(300!==this.mapping)return u;if(u.applyMatrix3(this.matrix),u.x<0||u.x>1)switch(this.wrapS){case q:u.x=u.x-Math.floor(u.x);break;case Z:u.x=u.x<0?0:1;break;case J:1===Math.abs(Math.floor(u.x)%2)?u.x=Math.ceil(u.x)-u.x:u.x=u.x-Math.floor(u.x)}if(u.y<0||u.y>1)switch(this.wrapT){case q:u.y=u.y-Math.floor(u.y);break;case Z:u.y=u.y<0?0:1;break;case J:1===Math.abs(Math.floor(u.y)%2)?u.y=Math.ceil(u.y)-u.y:u.y=u.y-Math.floor(u.y)}return this.flipY&&(u.y=1-u.y),u}set needsUpdate(u){!0===u&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(u){!0===u&&this.pmremVersion++}}pxlNav_vi.DEFAULT_IMAGE=null,pxlNav_vi.DEFAULT_MAPPING=300,pxlNav_vi.DEFAULT_ANISOTROPY=1;class pxlNav_wi{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;pxlNav_wi.prototype.isVector4=!0,this.x=u,this.y=d,this.z=v,this.w=x}get width(){return this.z}set width(u){this.z=u}get height(){return this.w}set height(u){this.w=u}set(u,d,v,x){return this.x=u,this.y=d,this.z=v,this.w=x,this}setScalar(u){return this.x=u,this.y=u,this.z=u,this.w=u,this}setX(u){return this.x=u,this}setY(u){return this.y=u,this}setZ(u){return this.z=u,this}setW(u){return this.w=u,this}setComponent(u,d){switch(u){case 0:this.x=d;break;case 1:this.y=d;break;case 2:this.z=d;break;case 3:this.w=d;break;default:throw new Error("index is out of range: "+u)}return this}getComponent(u){switch(u){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+u)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(u){return this.x=u.x,this.y=u.y,this.z=u.z,this.w=void 0!==u.w?u.w:1,this}add(u){return this.x+=u.x,this.y+=u.y,this.z+=u.z,this.w+=u.w,this}addScalar(u){return this.x+=u,this.y+=u,this.z+=u,this.w+=u,this}addVectors(u,d){return this.x=u.x+d.x,this.y=u.y+d.y,this.z=u.z+d.z,this.w=u.w+d.w,this}addScaledVector(u,d){return this.x+=u.x*d,this.y+=u.y*d,this.z+=u.z*d,this.w+=u.w*d,this}sub(u){return this.x-=u.x,this.y-=u.y,this.z-=u.z,this.w-=u.w,this}subScalar(u){return this.x-=u,this.y-=u,this.z-=u,this.w-=u,this}subVectors(u,d){return this.x=u.x-d.x,this.y=u.y-d.y,this.z=u.z-d.z,this.w=u.w-d.w,this}multiply(u){return this.x*=u.x,this.y*=u.y,this.z*=u.z,this.w*=u.w,this}multiplyScalar(u){return this.x*=u,this.y*=u,this.z*=u,this.w*=u,this}applyMatrix4(u){var d=this.x,v=this.y,x=this.z,y=this.w,b=u.elements;return this.x=b[0]*d+b[4]*v+b[8]*x+b[12]*y,this.y=b[1]*d+b[5]*v+b[9]*x+b[13]*y,this.z=b[2]*d+b[6]*v+b[10]*x+b[14]*y,this.w=b[3]*d+b[7]*v+b[11]*x+b[15]*y,this}divide(u){return this.x/=u.x,this.y/=u.y,this.z/=u.z,this.w/=u.w,this}divideScalar(u){return this.multiplyScalar(1/u)}setAxisAngleFromQuaternion(u){this.w=2*Math.acos(u.w);var d=Math.sqrt(1-u.w*u.w);return d<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=u.x/d,this.y=u.y/d,this.z=u.z/d),this}setAxisAngleFromRotationMatrix(u){var d,v,x,y,b=.01,_=.1,w=u.elements,S=w[0],C=w[4],P=w[8],A=w[1],T=w[5],E=w[9],D=w[2],I=w[6],k=w[10];if(Math.abs(C-A)<b&&Math.abs(P-D)<b&&Math.abs(E-I)<b){if(Math.abs(C+A)<_&&Math.abs(P+D)<_&&Math.abs(E+I)<_&&Math.abs(S+T+k-3)<_)return this.set(1,0,0,0),this;d=Math.PI;var R=(S+1)/2,O=(T+1)/2,j=(k+1)/2,G=(C+A)/4,H=(P+D)/4,X=(E+I)/4;return R>O&&R>j?R<b?(v=0,x=.707106781,y=.707106781):(x=G/(v=Math.sqrt(R)),y=H/v):O>j?O<b?(v=.707106781,x=0,y=.707106781):(v=G/(x=Math.sqrt(O)),y=X/x):j<b?(v=.707106781,x=.707106781,y=0):(v=H/(y=Math.sqrt(j)),x=X/y),this.set(v,x,y,d),this}var q=Math.sqrt((I-E)*(I-E)+(P-D)*(P-D)+(A-C)*(A-C));return Math.abs(q)<.001&&(q=1),this.x=(I-E)/q,this.y=(P-D)/q,this.z=(A-C)/q,this.w=Math.acos((S+T+k-1)/2),this}setFromMatrixPosition(u){var d=u.elements;return this.x=d[12],this.y=d[13],this.z=d[14],this.w=d[15],this}min(u){return this.x=Math.min(this.x,u.x),this.y=Math.min(this.y,u.y),this.z=Math.min(this.z,u.z),this.w=Math.min(this.w,u.w),this}max(u){return this.x=Math.max(this.x,u.x),this.y=Math.max(this.y,u.y),this.z=Math.max(this.z,u.z),this.w=Math.max(this.w,u.w),this}clamp(u,d){return this.x=pxlNav_Ds(this.x,u.x,d.x),this.y=pxlNav_Ds(this.y,u.y,d.y),this.z=pxlNav_Ds(this.z,u.z,d.z),this.w=pxlNav_Ds(this.w,u.w,d.w),this}clampScalar(u,d){return this.x=pxlNav_Ds(this.x,u,d),this.y=pxlNav_Ds(this.y,u,d),this.z=pxlNav_Ds(this.z,u,d),this.w=pxlNav_Ds(this.w,u,d),this}clampLength(u,d){var v=this.length();return this.divideScalar(v||1).multiplyScalar(pxlNav_Ds(v,u,d))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(u){return this.x*u.x+this.y*u.y+this.z*u.z+this.w*u.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(u){return this.normalize().multiplyScalar(u)}lerp(u,d){return this.x+=(u.x-this.x)*d,this.y+=(u.y-this.y)*d,this.z+=(u.z-this.z)*d,this.w+=(u.w-this.w)*d,this}lerpVectors(u,d,v){return this.x=u.x+(d.x-u.x)*v,this.y=u.y+(d.y-u.y)*v,this.z=u.z+(d.z-u.z)*v,this.w=u.w+(d.w-u.w)*v,this}equals(u){return u.x===this.x&&u.y===this.y&&u.z===this.z&&u.w===this.w}fromArray(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=u[d],this.y=u[d+1],this.z=u[d+2],this.w=u[d+3],this}toArray(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return u[d]=this.x,u[d+1]=this.y,u[d+2]=this.z,u[d+3]=this.w,u}fromBufferAttribute(u,d){return this.x=u.getX(d),this.y=u.getY(d),this.z=u.getZ(d),this.w=u.getW(d),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class pxlNav_Ci{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.isQuaternion=!0,this._x=u,this._y=d,this._z=v,this._w=x}static slerpFlat(u,d,v,x,y,b,_){var w=v[x+0],S=v[x+1],C=v[x+2],P=v[x+3],A=y[b+0],T=y[b+1],E=y[b+2],D=y[b+3];if(0===_)return u[d+0]=w,u[d+1]=S,u[d+2]=C,void(u[d+3]=P);if(1===_)return u[d+0]=A,u[d+1]=T,u[d+2]=E,void(u[d+3]=D);if(P!==D||w!==A||S!==T||C!==E){var I=1-_,k=w*A+S*T+C*E+P*D,R=k>=0?1:-1,O=1-k*k;if(O>Number.EPSILON){var j=Math.sqrt(O),G=Math.atan2(j,k*R);I=Math.sin(I*G)/j,_=Math.sin(_*G)/j}var H=_*R;if(w=w*I+A*H,S=S*I+T*H,C=C*I+E*H,P=P*I+D*H,I===1-_){var X=1/Math.sqrt(w*w+S*S+C*C+P*P);w*=X,S*=X,C*=X,P*=X}}u[d]=w,u[d+1]=S,u[d+2]=C,u[d+3]=P}static multiplyQuaternionsFlat(u,d,v,x,y,b){var _=v[x],w=v[x+1],S=v[x+2],C=v[x+3],P=y[b],A=y[b+1],T=y[b+2],E=y[b+3];return u[d]=_*E+C*P+w*T-S*A,u[d+1]=w*E+C*A+S*P-_*T,u[d+2]=S*E+C*T+_*A-w*P,u[d+3]=C*E-_*P-w*A-S*T,u}get x(){return this._x}set x(u){this._x=u,this._onChangeCallback()}get y(){return this._y}set y(u){this._y=u,this._onChangeCallback()}get z(){return this._z}set z(u){this._z=u,this._onChangeCallback()}get w(){return this._w}set w(u){this._w=u,this._onChangeCallback()}set(u,d,v,x){return this._x=u,this._y=d,this._z=v,this._w=x,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(u){return this._x=u.x,this._y=u.y,this._z=u.z,this._w=u.w,this._onChangeCallback(),this}setFromEuler(u){var d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],v=u._x,x=u._y,y=u._z,b=u._order,_=Math.cos,w=Math.sin,S=_(v/2),C=_(x/2),P=_(y/2),A=w(v/2),T=w(x/2),E=w(y/2);switch(b){case"XYZ":this._x=A*C*P+S*T*E,this._y=S*T*P-A*C*E,this._z=S*C*E+A*T*P,this._w=S*C*P-A*T*E;break;case"YXZ":this._x=A*C*P+S*T*E,this._y=S*T*P-A*C*E,this._z=S*C*E-A*T*P,this._w=S*C*P+A*T*E;break;case"ZXY":this._x=A*C*P-S*T*E,this._y=S*T*P+A*C*E,this._z=S*C*E+A*T*P,this._w=S*C*P-A*T*E;break;case"ZYX":this._x=A*C*P-S*T*E,this._y=S*T*P+A*C*E,this._z=S*C*E-A*T*P,this._w=S*C*P+A*T*E;break;case"YZX":this._x=A*C*P+S*T*E,this._y=S*T*P+A*C*E,this._z=S*C*E-A*T*P,this._w=S*C*P-A*T*E;break;case"XZY":this._x=A*C*P-S*T*E,this._y=S*T*P-A*C*E,this._z=S*C*E+A*T*P,this._w=S*C*P+A*T*E;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+b)}return!0===d&&this._onChangeCallback(),this}setFromAxisAngle(u,d){var v=d/2,x=Math.sin(v);return this._x=u.x*x,this._y=u.y*x,this._z=u.z*x,this._w=Math.cos(v),this._onChangeCallback(),this}setFromRotationMatrix(u){var d=u.elements,v=d[0],x=d[4],y=d[8],b=d[1],_=d[5],w=d[9],S=d[2],C=d[6],P=d[10],A=v+_+P;if(A>0){var T=.5/Math.sqrt(A+1);this._w=.25/T,this._x=(C-w)*T,this._y=(y-S)*T,this._z=(b-x)*T}else if(v>_&&v>P){var E=2*Math.sqrt(1+v-_-P);this._w=(C-w)/E,this._x=.25*E,this._y=(x+b)/E,this._z=(y+S)/E}else if(_>P){var D=2*Math.sqrt(1+_-v-P);this._w=(y-S)/D,this._x=(x+b)/D,this._y=.25*D,this._z=(w+C)/D}else{var I=2*Math.sqrt(1+P-v-_);this._w=(b-x)/I,this._x=(y+S)/I,this._y=(w+C)/I,this._z=.25*I}return this._onChangeCallback(),this}setFromUnitVectors(u,d){var v=u.dot(d)+1;return v<Number.EPSILON?(v=0,Math.abs(u.x)>Math.abs(u.z)?(this._x=-u.y,this._y=u.x,this._z=0,this._w=v):(this._x=0,this._y=-u.z,this._z=u.y,this._w=v)):(this._x=u.y*d.z-u.z*d.y,this._y=u.z*d.x-u.x*d.z,this._z=u.x*d.y-u.y*d.x,this._w=v),this.normalize()}angleTo(u){return 2*Math.acos(Math.abs(pxlNav_Ds(this.dot(u),-1,1)))}rotateTowards(u,d){var v=this.angleTo(u);if(0===v)return this;var x=Math.min(1,d/v);return this.slerp(u,x),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(u){return this._x*u._x+this._y*u._y+this._z*u._z+this._w*u._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){var u=this.length();return 0===u?(this._x=0,this._y=0,this._z=0,this._w=1):(u=1/u,this._x=this._x*u,this._y=this._y*u,this._z=this._z*u,this._w=this._w*u),this._onChangeCallback(),this}multiply(u){return this.multiplyQuaternions(this,u)}premultiply(u){return this.multiplyQuaternions(u,this)}multiplyQuaternions(u,d){var v=u._x,x=u._y,y=u._z,b=u._w,_=d._x,w=d._y,S=d._z,C=d._w;return this._x=v*C+b*_+x*S-y*w,this._y=x*C+b*w+y*_-v*S,this._z=y*C+b*S+v*w-x*_,this._w=b*C-v*_-x*w-y*S,this._onChangeCallback(),this}slerp(u,d){if(0===d)return this;if(1===d)return this.copy(u);var v=this._x,x=this._y,y=this._z,b=this._w,_=b*u._w+v*u._x+x*u._y+y*u._z;if(_<0?(this._w=-u._w,this._x=-u._x,this._y=-u._y,this._z=-u._z,_=-_):this.copy(u),_>=1)return this._w=b,this._x=v,this._y=x,this._z=y,this;var w=1-_*_;if(w<=Number.EPSILON){var S=1-d;return this._w=S*b+d*this._w,this._x=S*v+d*this._x,this._y=S*x+d*this._y,this._z=S*y+d*this._z,this.normalize(),this}var C=Math.sqrt(w),P=Math.atan2(C,_),A=Math.sin((1-d)*P)/C,T=Math.sin(d*P)/C;return this._w=b*A+this._w*T,this._x=v*A+this._x*T,this._y=x*A+this._y*T,this._z=y*A+this._z*T,this._onChangeCallback(),this}slerpQuaternions(u,d,v){return this.copy(u).slerp(d,v)}random(){var u=2*Math.PI*Math.random(),d=2*Math.PI*Math.random(),v=Math.random(),x=Math.sqrt(1-v),y=Math.sqrt(v);return this.set(x*Math.sin(u),x*Math.cos(u),y*Math.sin(d),y*Math.cos(d))}equals(u){return u._x===this._x&&u._y===this._y&&u._z===this._z&&u._w===this._w}fromArray(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=u[d],this._y=u[d+1],this._z=u[d+2],this._w=u[d+3],this._onChangeCallback(),this}toArray(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return u[d]=this._x,u[d+1]=this._y,u[d+2]=this._z,u[d+3]=this._w,u}fromBufferAttribute(u,d){return this._x=u.getX(d),this._y=u.getY(d),this._z=u.getZ(d),this._w=u.getW(d),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(u){return this._onChangeCallback=u,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class pxlNav_Ii{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;pxlNav_Ii.prototype.isVector3=!0,this.x=u,this.y=d,this.z=v}set(u,d,v){return void 0===v&&(v=this.z),this.x=u,this.y=d,this.z=v,this}setScalar(u){return this.x=u,this.y=u,this.z=u,this}setX(u){return this.x=u,this}setY(u){return this.y=u,this}setZ(u){return this.z=u,this}setComponent(u,d){switch(u){case 0:this.x=d;break;case 1:this.y=d;break;case 2:this.z=d;break;default:throw new Error("index is out of range: "+u)}return this}getComponent(u){switch(u){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+u)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(u){return this.x=u.x,this.y=u.y,this.z=u.z,this}add(u){return this.x+=u.x,this.y+=u.y,this.z+=u.z,this}addScalar(u){return this.x+=u,this.y+=u,this.z+=u,this}addVectors(u,d){return this.x=u.x+d.x,this.y=u.y+d.y,this.z=u.z+d.z,this}addScaledVector(u,d){return this.x+=u.x*d,this.y+=u.y*d,this.z+=u.z*d,this}sub(u){return this.x-=u.x,this.y-=u.y,this.z-=u.z,this}subScalar(u){return this.x-=u,this.y-=u,this.z-=u,this}subVectors(u,d){return this.x=u.x-d.x,this.y=u.y-d.y,this.z=u.z-d.z,this}multiply(u){return this.x*=u.x,this.y*=u.y,this.z*=u.z,this}multiplyScalar(u){return this.x*=u,this.y*=u,this.z*=u,this}multiplyVectors(u,d){return this.x=u.x*d.x,this.y=u.y*d.y,this.z=u.z*d.z,this}applyEuler(u){return this.applyQuaternion(Ce.setFromEuler(u))}applyAxisAngle(u,d){return this.applyQuaternion(Ce.setFromAxisAngle(u,d))}applyMatrix3(u){var d=this.x,v=this.y,x=this.z,y=u.elements;return this.x=y[0]*d+y[3]*v+y[6]*x,this.y=y[1]*d+y[4]*v+y[7]*x,this.z=y[2]*d+y[5]*v+y[8]*x,this}applyNormalMatrix(u){return this.applyMatrix3(u).normalize()}applyMatrix4(u){var d=this.x,v=this.y,x=this.z,y=u.elements,b=1/(y[3]*d+y[7]*v+y[11]*x+y[15]);return this.x=(y[0]*d+y[4]*v+y[8]*x+y[12])*b,this.y=(y[1]*d+y[5]*v+y[9]*x+y[13])*b,this.z=(y[2]*d+y[6]*v+y[10]*x+y[14])*b,this}applyQuaternion(u){var d=this.x,v=this.y,x=this.z,y=u.x,b=u.y,_=u.z,w=u.w,S=2*(b*x-_*v),C=2*(_*d-y*x),P=2*(y*v-b*d);return this.x=d+w*S+b*P-_*C,this.y=v+w*C+_*S-y*P,this.z=x+w*P+y*C-b*S,this}project(u){return this.applyMatrix4(u.matrixWorldInverse).applyMatrix4(u.projectionMatrix)}unproject(u){return this.applyMatrix4(u.projectionMatrixInverse).applyMatrix4(u.matrixWorld)}transformDirection(u){var d=this.x,v=this.y,x=this.z,y=u.elements;return this.x=y[0]*d+y[4]*v+y[8]*x,this.y=y[1]*d+y[5]*v+y[9]*x,this.z=y[2]*d+y[6]*v+y[10]*x,this.normalize()}divide(u){return this.x/=u.x,this.y/=u.y,this.z/=u.z,this}divideScalar(u){return this.multiplyScalar(1/u)}min(u){return this.x=Math.min(this.x,u.x),this.y=Math.min(this.y,u.y),this.z=Math.min(this.z,u.z),this}max(u){return this.x=Math.max(this.x,u.x),this.y=Math.max(this.y,u.y),this.z=Math.max(this.z,u.z),this}clamp(u,d){return this.x=pxlNav_Ds(this.x,u.x,d.x),this.y=pxlNav_Ds(this.y,u.y,d.y),this.z=pxlNav_Ds(this.z,u.z,d.z),this}clampScalar(u,d){return this.x=pxlNav_Ds(this.x,u,d),this.y=pxlNav_Ds(this.y,u,d),this.z=pxlNav_Ds(this.z,u,d),this}clampLength(u,d){var v=this.length();return this.divideScalar(v||1).multiplyScalar(pxlNav_Ds(v,u,d))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(u){return this.x*u.x+this.y*u.y+this.z*u.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(u){return this.normalize().multiplyScalar(u)}lerp(u,d){return this.x+=(u.x-this.x)*d,this.y+=(u.y-this.y)*d,this.z+=(u.z-this.z)*d,this}lerpVectors(u,d,v){return this.x=u.x+(d.x-u.x)*v,this.y=u.y+(d.y-u.y)*v,this.z=u.z+(d.z-u.z)*v,this}cross(u){return this.crossVectors(this,u)}crossVectors(u,d){var v=u.x,x=u.y,y=u.z,b=d.x,_=d.y,w=d.z;return this.x=x*w-y*_,this.y=y*b-v*w,this.z=v*_-x*b,this}projectOnVector(u){var d=u.lengthSq();if(0===d)return this.set(0,0,0);var v=u.dot(this)/d;return this.copy(u).multiplyScalar(v)}projectOnPlane(u){return Se.copy(this).projectOnVector(u),this.sub(Se)}reflect(u){return this.sub(Se.copy(u).multiplyScalar(2*this.dot(u)))}angleTo(u){var d=Math.sqrt(this.lengthSq()*u.lengthSq());if(0===d)return Math.PI/2;var v=this.dot(u)/d;return Math.acos(pxlNav_Ds(v,-1,1))}distanceTo(u){return Math.sqrt(this.distanceToSquared(u))}distanceToSquared(u){var d=this.x-u.x,v=this.y-u.y,x=this.z-u.z;return d*d+v*v+x*x}manhattanDistanceTo(u){return Math.abs(this.x-u.x)+Math.abs(this.y-u.y)+Math.abs(this.z-u.z)}setFromSpherical(u){return this.setFromSphericalCoords(u.radius,u.phi,u.theta)}setFromSphericalCoords(u,d,v){var x=Math.sin(d)*u;return this.x=x*Math.sin(v),this.y=Math.cos(d)*u,this.z=x*Math.cos(v),this}setFromCylindrical(u){return this.setFromCylindricalCoords(u.radius,u.theta,u.y)}setFromCylindricalCoords(u,d,v){return this.x=u*Math.sin(d),this.y=v,this.z=u*Math.cos(d),this}setFromMatrixPosition(u){var d=u.elements;return this.x=d[12],this.y=d[13],this.z=d[14],this}setFromMatrixScale(u){var d=this.setFromMatrixColumn(u,0).length(),v=this.setFromMatrixColumn(u,1).length(),x=this.setFromMatrixColumn(u,2).length();return this.x=d,this.y=v,this.z=x,this}setFromMatrixColumn(u,d){return this.fromArray(u.elements,4*d)}setFromMatrix3Column(u,d){return this.fromArray(u.elements,3*d)}setFromEuler(u){return this.x=u._x,this.y=u._y,this.z=u._z,this}setFromColor(u){return this.x=u.r,this.y=u.g,this.z=u.b,this}equals(u){return u.x===this.x&&u.y===this.y&&u.z===this.z}fromArray(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=u[d],this.y=u[d+1],this.z=u[d+2],this}toArray(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return u[d]=this.x,u[d+1]=this.y,u[d+2]=this.z,u}fromBufferAttribute(u,d){return this.x=u.getX(d),this.y=u.getY(d),this.z=u.getZ(d),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){var u=Math.random()*Math.PI*2,d=2*Math.random()-1,v=Math.sqrt(1-d*d);return this.x=v*Math.cos(u),this.y=d,this.z=v*Math.sin(u),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}var Se=new pxlNav_Ii,Ce=new pxlNav_Ci;class pxlNav_Ei{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pxlNav_Ii(1/0,1/0,1/0),d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pxlNav_Ii(-1/0,-1/0,-1/0);this.isBox3=!0,this.min=u,this.max=d}set(u,d){return this.min.copy(u),this.max.copy(d),this}setFromArray(u){this.makeEmpty();for(var d=0,v=u.length;d<v;d+=3)this.expandByPoint(Pe.fromArray(u,d));return this}setFromBufferAttribute(u){this.makeEmpty();for(var d=0,v=u.count;d<v;d++)this.expandByPoint(Pe.fromBufferAttribute(u,d));return this}setFromPoints(u){this.makeEmpty();for(var d=0,v=u.length;d<v;d++)this.expandByPoint(u[d]);return this}setFromCenterAndSize(u,d){var v=Pe.copy(d).multiplyScalar(.5);return this.min.copy(u).sub(v),this.max.copy(u).add(v),this}setFromObject(u){var d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(u,d)}clone(){return(new this.constructor).copy(this)}copy(u){return this.min.copy(u.min),this.max.copy(u.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(u){return this.isEmpty()?u.set(0,0,0):u.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(u){return this.isEmpty()?u.set(0,0,0):u.subVectors(this.max,this.min)}expandByPoint(u){return this.min.min(u),this.max.max(u),this}expandByVector(u){return this.min.sub(u),this.max.add(u),this}expandByScalar(u){return this.min.addScalar(-u),this.max.addScalar(u),this}expandByObject(u){var d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];u.updateWorldMatrix(!1,!1);var v=u.geometry;if(void 0!==v){var x=v.getAttribute("position");if(!0===d&&void 0!==x&&!0!==u.isInstancedMesh)for(var y=0,b=x.count;y<b;y++)!0===u.isMesh?u.getVertexPosition(y,Pe):Pe.fromBufferAttribute(x,y),Pe.applyMatrix4(u.matrixWorld),this.expandByPoint(Pe);else void 0!==u.boundingBox?(null===u.boundingBox&&u.computeBoundingBox(),Me.copy(u.boundingBox)):(null===v.boundingBox&&v.computeBoundingBox(),Me.copy(v.boundingBox)),Me.applyMatrix4(u.matrixWorld),this.union(Me)}for(var _=u.children,w=0,S=_.length;w<S;w++)this.expandByObject(_[w],d);return this}containsPoint(u){return u.x>=this.min.x&&u.x<=this.max.x&&u.y>=this.min.y&&u.y<=this.max.y&&u.z>=this.min.z&&u.z<=this.max.z}containsBox(u){return this.min.x<=u.min.x&&u.max.x<=this.max.x&&this.min.y<=u.min.y&&u.max.y<=this.max.y&&this.min.z<=u.min.z&&u.max.z<=this.max.z}getParameter(u,d){return d.set((u.x-this.min.x)/(this.max.x-this.min.x),(u.y-this.min.y)/(this.max.y-this.min.y),(u.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(u){return u.max.x>=this.min.x&&u.min.x<=this.max.x&&u.max.y>=this.min.y&&u.min.y<=this.max.y&&u.max.z>=this.min.z&&u.min.z<=this.max.z}intersectsSphere(u){return this.clampPoint(u.center,Pe),Pe.distanceToSquared(u.center)<=u.radius*u.radius}intersectsPlane(u){var d,v;return u.normal.x>0?(d=u.normal.x*this.min.x,v=u.normal.x*this.max.x):(d=u.normal.x*this.max.x,v=u.normal.x*this.min.x),u.normal.y>0?(d+=u.normal.y*this.min.y,v+=u.normal.y*this.max.y):(d+=u.normal.y*this.max.y,v+=u.normal.y*this.min.y),u.normal.z>0?(d+=u.normal.z*this.min.z,v+=u.normal.z*this.max.z):(d+=u.normal.z*this.max.z,v+=u.normal.z*this.min.z),d<=-u.constant&&v>=-u.constant}intersectsTriangle(u){if(this.isEmpty())return!1;this.getCenter(ke),Re.subVectors(this.max,ke),Ae.subVectors(u.a,ke),Te.subVectors(u.b,ke),Ee.subVectors(u.c,ke),De.subVectors(Te,Ae),Ie.subVectors(Ee,Te),Le.subVectors(Ae,Ee);var d=[0,-De.z,De.y,0,-Ie.z,Ie.y,0,-Le.z,Le.y,De.z,0,-De.x,Ie.z,0,-Ie.x,Le.z,0,-Le.x,-De.y,De.x,0,-Ie.y,Ie.x,0,-Le.y,Le.x,0];return!!pxlNav_Ji(d,Ae,Te,Ee,Re)&&(!!pxlNav_Ji(d=[1,0,0,0,1,0,0,0,1],Ae,Te,Ee,Re)&&(Oe.crossVectors(De,Ie),pxlNav_Ji(d=[Oe.x,Oe.y,Oe.z],Ae,Te,Ee,Re)))}clampPoint(u,d){return d.copy(u).clamp(this.min,this.max)}distanceToPoint(u){return this.clampPoint(u,Pe).distanceTo(u)}getBoundingSphere(u){return this.isEmpty()?u.makeEmpty():(this.getCenter(u.center),u.radius=.5*this.getSize(Pe).length()),u}intersect(u){return this.min.max(u.min),this.max.min(u.max),this.isEmpty()&&this.makeEmpty(),this}union(u){return this.min.min(u.min),this.max.max(u.max),this}applyMatrix4(u){return this.isEmpty()||(Ne[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(u),Ne[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(u),Ne[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(u),Ne[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(u),Ne[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(u),Ne[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(u),Ne[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(u),Ne[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(u),this.setFromPoints(Ne)),this}translate(u){return this.min.add(u),this.max.add(u),this}equals(u){return u.min.equals(this.min)&&u.max.equals(this.max)}}var Ne=[new pxlNav_Ii,new pxlNav_Ii,new pxlNav_Ii,new pxlNav_Ii,new pxlNav_Ii,new pxlNav_Ii,new pxlNav_Ii,new pxlNav_Ii],Pe=new pxlNav_Ii,Me=new pxlNav_Ei,Ae=new pxlNav_Ii,Te=new pxlNav_Ii,Ee=new pxlNav_Ii,De=new pxlNav_Ii,Ie=new pxlNav_Ii,Le=new pxlNav_Ii,ke=new pxlNav_Ii,Re=new pxlNav_Ii,Oe=new pxlNav_Ii,Be=new pxlNav_Ii;function pxlNav_Ji(u,d,v,x,y){for(var b=0,_=u.length-3;b<=_;b+=3){Be.fromArray(u,b);var w=y.x*Math.abs(Be.x)+y.y*Math.abs(Be.y)+y.z*Math.abs(Be.z),S=d.dot(Be),C=v.dot(Be),P=x.dot(Be);if(Math.max(-Math.max(S,C,P),Math.min(S,C,P))>w)return!1}return!0}var Ve=new pxlNav_Ei,Ue=new pxlNav_Ii,Fe=new pxlNav_Ii;class pxlNav_Gi{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pxlNav_Ii,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this.isSphere=!0,this.center=u,this.radius=d}set(u,d){return this.center.copy(u),this.radius=d,this}setFromPoints(u,d){var v=this.center;void 0!==d?v.copy(d):Ve.setFromPoints(u).getCenter(v);for(var x=0,y=0,b=u.length;y<b;y++)x=Math.max(x,v.distanceToSquared(u[y]));return this.radius=Math.sqrt(x),this}copy(u){return this.center.copy(u.center),this.radius=u.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(u){return u.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(u){return u.distanceTo(this.center)-this.radius}intersectsSphere(u){var d=this.radius+u.radius;return u.center.distanceToSquared(this.center)<=d*d}intersectsBox(u){return u.intersectsSphere(this)}intersectsPlane(u){return Math.abs(u.distanceToPoint(this.center))<=this.radius}clampPoint(u,d){var v=this.center.distanceToSquared(u);return d.copy(u),v>this.radius*this.radius&&(d.sub(this.center).normalize(),d.multiplyScalar(this.radius).add(this.center)),d}getBoundingBox(u){return this.isEmpty()?(u.makeEmpty(),u):(u.set(this.center,this.center),u.expandByScalar(this.radius),u)}applyMatrix4(u){return this.center.applyMatrix4(u),this.radius=this.radius*u.getMaxScaleOnAxis(),this}translate(u){return this.center.add(u),this}expandByPoint(u){if(this.isEmpty())return this.center.copy(u),this.radius=0,this;Ue.subVectors(u,this.center);var d=Ue.lengthSq();if(d>this.radius*this.radius){var v=Math.sqrt(d),x=.5*(v-this.radius);this.center.addScaledVector(Ue,x/v),this.radius+=x}return this}union(u){return u.isEmpty()?this:this.isEmpty()?(this.copy(u),this):(!0===this.center.equals(u.center)?this.radius=Math.max(this.radius,u.radius):(Fe.subVectors(u.center,this.center).setLength(u.radius),this.expandByPoint(Ue.copy(u.center).add(Fe)),this.expandByPoint(Ue.copy(u.center).sub(Fe))),this)}equals(u){return u.center.equals(this.center)&&u.radius===this.radius}clone(){return(new this.constructor).copy(this)}}var je=new pxlNav_Ii,ze=new pxlNav_Ii,Ge=new pxlNav_Ii,He=new pxlNav_Ii,We=new pxlNav_Ii,Xe=new pxlNav_Ii,qe=new pxlNav_Ii;class pxlNav_rr{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pxlNav_Ii,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pxlNav_Ii(0,0,-1);this.origin=u,this.direction=d}set(u,d){return this.origin.copy(u),this.direction.copy(d),this}copy(u){return this.origin.copy(u.origin),this.direction.copy(u.direction),this}at(u,d){return d.copy(this.origin).addScaledVector(this.direction,u)}lookAt(u){return this.direction.copy(u).sub(this.origin).normalize(),this}recast(u){return this.origin.copy(this.at(u,je)),this}closestPointToPoint(u,d){d.subVectors(u,this.origin);var v=d.dot(this.direction);return v<0?d.copy(this.origin):d.copy(this.origin).addScaledVector(this.direction,v)}distanceToPoint(u){return Math.sqrt(this.distanceSqToPoint(u))}distanceSqToPoint(u){var d=je.subVectors(u,this.origin).dot(this.direction);return d<0?this.origin.distanceToSquared(u):(je.copy(this.origin).addScaledVector(this.direction,d),je.distanceToSquared(u))}distanceSqToSegment(u,d,v,x){ze.copy(u).add(d).multiplyScalar(.5),Ge.copy(d).sub(u).normalize(),He.copy(this.origin).sub(ze);var y,b,_,w,S=.5*u.distanceTo(d),C=-this.direction.dot(Ge),P=He.dot(this.direction),A=-He.dot(Ge),T=He.lengthSq(),E=Math.abs(1-C*C);if(E>0)if(b=C*P-A,w=S*E,(y=C*A-P)>=0)if(b>=-w)if(b<=w){var D=1/E;_=(y*=D)*(y+C*(b*=D)+2*P)+b*(C*y+b+2*A)+T}else b=S,_=-(y=Math.max(0,-(C*b+P)))*y+b*(b+2*A)+T;else b=-S,_=-(y=Math.max(0,-(C*b+P)))*y+b*(b+2*A)+T;else b<=-w?_=-(y=Math.max(0,-(-C*S+P)))*y+(b=y>0?-S:Math.min(Math.max(-S,-A),S))*(b+2*A)+T:b<=w?(y=0,_=(b=Math.min(Math.max(-S,-A),S))*(b+2*A)+T):_=-(y=Math.max(0,-(C*S+P)))*y+(b=y>0?S:Math.min(Math.max(-S,-A),S))*(b+2*A)+T;else b=C>0?-S:S,_=-(y=Math.max(0,-(C*b+P)))*y+b*(b+2*A)+T;return v&&v.copy(this.origin).addScaledVector(this.direction,y),x&&x.copy(ze).addScaledVector(Ge,b),_}intersectSphere(u,d){je.subVectors(u.center,this.origin);var v=je.dot(this.direction),x=je.dot(je)-v*v,y=u.radius*u.radius;if(x>y)return null;var b=Math.sqrt(y-x),_=v-b,w=v+b;return w<0?null:_<0?this.at(w,d):this.at(_,d)}intersectsSphere(u){return this.distanceSqToPoint(u.center)<=u.radius*u.radius}distanceToPlane(u){var d=u.normal.dot(this.direction);if(0===d)return 0===u.distanceToPoint(this.origin)?0:null;var v=-(this.origin.dot(u.normal)+u.constant)/d;return v>=0?v:null}intersectPlane(u,d){var v=this.distanceToPlane(u);return null===v?null:this.at(v,d)}intersectsPlane(u){var d=u.distanceToPoint(this.origin);return 0===d||u.normal.dot(this.direction)*d<0}intersectBox(u,d){var v,x,y,b,_,w,S=1/this.direction.x,C=1/this.direction.y,P=1/this.direction.z,A=this.origin;return S>=0?(v=(u.min.x-A.x)*S,x=(u.max.x-A.x)*S):(v=(u.max.x-A.x)*S,x=(u.min.x-A.x)*S),C>=0?(y=(u.min.y-A.y)*C,b=(u.max.y-A.y)*C):(y=(u.max.y-A.y)*C,b=(u.min.y-A.y)*C),v>b||y>x?null:((y>v||isNaN(v))&&(v=y),(b<x||isNaN(x))&&(x=b),P>=0?(_=(u.min.z-A.z)*P,w=(u.max.z-A.z)*P):(_=(u.max.z-A.z)*P,w=(u.min.z-A.z)*P),v>w||_>x?null:((_>v||v!=v)&&(v=_),(w<x||x!=x)&&(x=w),x<0?null:this.at(v>=0?v:x,d)))}intersectsBox(u){return null!==this.intersectBox(u,je)}intersectTriangle(u,d,v,x,y){We.subVectors(d,u),Xe.subVectors(v,u),qe.crossVectors(We,Xe);var b,_=this.direction.dot(qe);if(_>0){if(x)return null;b=1}else{if(!(_<0))return null;b=-1,_=-_}He.subVectors(this.origin,u);var w=b*this.direction.dot(Xe.crossVectors(He,Xe));if(w<0)return null;var S=b*this.direction.dot(We.cross(He));if(S<0)return null;if(w+S>_)return null;var C=-b*He.dot(qe);return C<0?null:this.at(C/_,y)}applyMatrix4(u){return this.origin.applyMatrix4(u),this.direction.transformDirection(u),this}equals(u){return u.origin.equals(this.origin)&&u.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class pxlNav_nr{constructor(u,d,v,x,y,b,_,w,S,C,P,A,T,E,D,I){pxlNav_nr.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==u&&this.set(u,d,v,x,y,b,_,w,S,C,P,A,T,E,D,I)}set(u,d,v,x,y,b,_,w,S,C,P,A,T,E,D,I){var k=this.elements;return k[0]=u,k[4]=d,k[8]=v,k[12]=x,k[1]=y,k[5]=b,k[9]=_,k[13]=w,k[2]=S,k[6]=C,k[10]=P,k[14]=A,k[3]=T,k[7]=E,k[11]=D,k[15]=I,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new pxlNav_nr).fromArray(this.elements)}copy(u){var d=this.elements,v=u.elements;return d[0]=v[0],d[1]=v[1],d[2]=v[2],d[3]=v[3],d[4]=v[4],d[5]=v[5],d[6]=v[6],d[7]=v[7],d[8]=v[8],d[9]=v[9],d[10]=v[10],d[11]=v[11],d[12]=v[12],d[13]=v[13],d[14]=v[14],d[15]=v[15],this}copyPosition(u){var d=this.elements,v=u.elements;return d[12]=v[12],d[13]=v[13],d[14]=v[14],this}setFromMatrix3(u){var d=u.elements;return this.set(d[0],d[3],d[6],0,d[1],d[4],d[7],0,d[2],d[5],d[8],0,0,0,0,1),this}extractBasis(u,d,v){return u.setFromMatrixColumn(this,0),d.setFromMatrixColumn(this,1),v.setFromMatrixColumn(this,2),this}makeBasis(u,d,v){return this.set(u.x,d.x,v.x,0,u.y,d.y,v.y,0,u.z,d.z,v.z,0,0,0,0,1),this}extractRotation(u){var d=this.elements,v=u.elements,x=1/Ze.setFromMatrixColumn(u,0).length(),y=1/Ze.setFromMatrixColumn(u,1).length(),b=1/Ze.setFromMatrixColumn(u,2).length();return d[0]=v[0]*x,d[1]=v[1]*x,d[2]=v[2]*x,d[3]=0,d[4]=v[4]*y,d[5]=v[5]*y,d[6]=v[6]*y,d[7]=0,d[8]=v[8]*b,d[9]=v[9]*b,d[10]=v[10]*b,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,this}makeRotationFromEuler(u){var d=this.elements,v=u.x,x=u.y,y=u.z,b=Math.cos(v),_=Math.sin(v),w=Math.cos(x),S=Math.sin(x),C=Math.cos(y),P=Math.sin(y);if("XYZ"===u.order){var A=b*C,T=b*P,E=_*C,D=_*P;d[0]=w*C,d[4]=-w*P,d[8]=S,d[1]=T+E*S,d[5]=A-D*S,d[9]=-_*w,d[2]=D-A*S,d[6]=E+T*S,d[10]=b*w}else if("YXZ"===u.order){var I=w*C,k=w*P,R=S*C,O=S*P;d[0]=I+O*_,d[4]=R*_-k,d[8]=b*S,d[1]=b*P,d[5]=b*C,d[9]=-_,d[2]=k*_-R,d[6]=O+I*_,d[10]=b*w}else if("ZXY"===u.order){var j=w*C,G=w*P,H=S*C,X=S*P;d[0]=j-X*_,d[4]=-b*P,d[8]=H+G*_,d[1]=G+H*_,d[5]=b*C,d[9]=X-j*_,d[2]=-b*S,d[6]=_,d[10]=b*w}else if("ZYX"===u.order){var q=b*C,Z=b*P,J=_*C,Q=_*P;d[0]=w*C,d[4]=J*S-Z,d[8]=q*S+Q,d[1]=w*P,d[5]=Q*S+q,d[9]=Z*S-J,d[2]=-S,d[6]=_*w,d[10]=b*w}else if("YZX"===u.order){var K=b*w,Y=b*S,$=_*w,ee=_*S;d[0]=w*C,d[4]=ee-K*P,d[8]=$*P+Y,d[1]=P,d[5]=b*C,d[9]=-_*C,d[2]=-S*C,d[6]=Y*P+$,d[10]=K-ee*P}else if("XZY"===u.order){var te=b*w,ie=b*S,se=_*w,re=_*S;d[0]=w*C,d[4]=-P,d[8]=S*C,d[1]=te*P+re,d[5]=b*C,d[9]=ie*P-se,d[2]=se*P-ie,d[6]=_*C,d[10]=re*P+te}return d[3]=0,d[7]=0,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,this}makeRotationFromQuaternion(u){return this.compose(Qe,u,Ke)}lookAt(u,d,v){var x=this.elements;return et.subVectors(u,d),0===et.lengthSq()&&(et.z=1),et.normalize(),Ye.crossVectors(v,et),0===Ye.lengthSq()&&(1===Math.abs(v.z)?et.x+=1e-4:et.z+=1e-4,et.normalize(),Ye.crossVectors(v,et)),Ye.normalize(),$e.crossVectors(et,Ye),x[0]=Ye.x,x[4]=$e.x,x[8]=et.x,x[1]=Ye.y,x[5]=$e.y,x[9]=et.y,x[2]=Ye.z,x[6]=$e.z,x[10]=et.z,this}multiply(u){return this.multiplyMatrices(this,u)}premultiply(u){return this.multiplyMatrices(u,this)}multiplyMatrices(u,d){var v=u.elements,x=d.elements,y=this.elements,b=v[0],_=v[4],w=v[8],S=v[12],C=v[1],P=v[5],A=v[9],T=v[13],E=v[2],D=v[6],I=v[10],k=v[14],R=v[3],O=v[7],j=v[11],G=v[15],H=x[0],X=x[4],q=x[8],Z=x[12],J=x[1],Q=x[5],K=x[9],Y=x[13],$=x[2],ee=x[6],te=x[10],ie=x[14],se=x[3],re=x[7],ae=x[11],ne=x[15];return y[0]=b*H+_*J+w*$+S*se,y[4]=b*X+_*Q+w*ee+S*re,y[8]=b*q+_*K+w*te+S*ae,y[12]=b*Z+_*Y+w*ie+S*ne,y[1]=C*H+P*J+A*$+T*se,y[5]=C*X+P*Q+A*ee+T*re,y[9]=C*q+P*K+A*te+T*ae,y[13]=C*Z+P*Y+A*ie+T*ne,y[2]=E*H+D*J+I*$+k*se,y[6]=E*X+D*Q+I*ee+k*re,y[10]=E*q+D*K+I*te+k*ae,y[14]=E*Z+D*Y+I*ie+k*ne,y[3]=R*H+O*J+j*$+G*se,y[7]=R*X+O*Q+j*ee+G*re,y[11]=R*q+O*K+j*te+G*ae,y[15]=R*Z+O*Y+j*ie+G*ne,this}multiplyScalar(u){var d=this.elements;return d[0]*=u,d[4]*=u,d[8]*=u,d[12]*=u,d[1]*=u,d[5]*=u,d[9]*=u,d[13]*=u,d[2]*=u,d[6]*=u,d[10]*=u,d[14]*=u,d[3]*=u,d[7]*=u,d[11]*=u,d[15]*=u,this}determinant(){var u=this.elements,d=u[0],v=u[4],x=u[8],y=u[12],b=u[1],_=u[5],w=u[9],S=u[13],C=u[2],P=u[6],A=u[10],T=u[14];return u[3]*(+y*w*P-x*S*P-y*_*A+v*S*A+x*_*T-v*w*T)+u[7]*(+d*w*T-d*S*A+y*b*A-x*b*T+x*S*C-y*w*C)+u[11]*(+d*S*P-d*_*T-y*b*P+v*b*T+y*_*C-v*S*C)+u[15]*(-x*_*C-d*w*P+d*_*A+x*b*P-v*b*A+v*w*C)}transpose(){var u,d=this.elements;return u=d[1],d[1]=d[4],d[4]=u,u=d[2],d[2]=d[8],d[8]=u,u=d[6],d[6]=d[9],d[9]=u,u=d[3],d[3]=d[12],d[12]=u,u=d[7],d[7]=d[13],d[13]=u,u=d[11],d[11]=d[14],d[14]=u,this}setPosition(u,d,v){var x=this.elements;return u.isVector3?(x[12]=u.x,x[13]=u.y,x[14]=u.z):(x[12]=u,x[13]=d,x[14]=v),this}invert(){var u=this.elements,d=u[0],v=u[1],x=u[2],y=u[3],b=u[4],_=u[5],w=u[6],S=u[7],C=u[8],P=u[9],A=u[10],T=u[11],E=u[12],D=u[13],I=u[14],k=u[15],R=P*I*S-D*A*S+D*w*T-_*I*T-P*w*k+_*A*k,O=E*A*S-C*I*S-E*w*T+b*I*T+C*w*k-b*A*k,j=C*D*S-E*P*S+E*_*T-b*D*T-C*_*k+b*P*k,G=E*P*w-C*D*w-E*_*A+b*D*A+C*_*I-b*P*I,H=d*R+v*O+x*j+y*G;if(0===H)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var X=1/H;return u[0]=R*X,u[1]=(D*A*y-P*I*y-D*x*T+v*I*T+P*x*k-v*A*k)*X,u[2]=(_*I*y-D*w*y+D*x*S-v*I*S-_*x*k+v*w*k)*X,u[3]=(P*w*y-_*A*y-P*x*S+v*A*S+_*x*T-v*w*T)*X,u[4]=O*X,u[5]=(C*I*y-E*A*y+E*x*T-d*I*T-C*x*k+d*A*k)*X,u[6]=(E*w*y-b*I*y-E*x*S+d*I*S+b*x*k-d*w*k)*X,u[7]=(b*A*y-C*w*y+C*x*S-d*A*S-b*x*T+d*w*T)*X,u[8]=j*X,u[9]=(E*P*y-C*D*y-E*v*T+d*D*T+C*v*k-d*P*k)*X,u[10]=(b*D*y-E*_*y+E*v*S-d*D*S-b*v*k+d*_*k)*X,u[11]=(C*_*y-b*P*y-C*v*S+d*P*S+b*v*T-d*_*T)*X,u[12]=G*X,u[13]=(C*D*x-E*P*x+E*v*A-d*D*A-C*v*I+d*P*I)*X,u[14]=(E*_*x-b*D*x-E*v*w+d*D*w+b*v*I-d*_*I)*X,u[15]=(b*P*x-C*_*x+C*v*w-d*P*w-b*v*A+d*_*A)*X,this}scale(u){var d=this.elements,v=u.x,x=u.y,y=u.z;return d[0]*=v,d[4]*=x,d[8]*=y,d[1]*=v,d[5]*=x,d[9]*=y,d[2]*=v,d[6]*=x,d[10]*=y,d[3]*=v,d[7]*=x,d[11]*=y,this}getMaxScaleOnAxis(){var u=this.elements,d=u[0]*u[0]+u[1]*u[1]+u[2]*u[2],v=u[4]*u[4]+u[5]*u[5]+u[6]*u[6],x=u[8]*u[8]+u[9]*u[9]+u[10]*u[10];return Math.sqrt(Math.max(d,v,x))}makeTranslation(u,d,v){return u.isVector3?this.set(1,0,0,u.x,0,1,0,u.y,0,0,1,u.z,0,0,0,1):this.set(1,0,0,u,0,1,0,d,0,0,1,v,0,0,0,1),this}makeRotationX(u){var d=Math.cos(u),v=Math.sin(u);return this.set(1,0,0,0,0,d,-v,0,0,v,d,0,0,0,0,1),this}makeRotationY(u){var d=Math.cos(u),v=Math.sin(u);return this.set(d,0,v,0,0,1,0,0,-v,0,d,0,0,0,0,1),this}makeRotationZ(u){var d=Math.cos(u),v=Math.sin(u);return this.set(d,-v,0,0,v,d,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(u,d){var v=Math.cos(d),x=Math.sin(d),y=1-v,b=u.x,_=u.y,w=u.z,S=y*b,C=y*_;return this.set(S*b+v,S*_-x*w,S*w+x*_,0,S*_+x*w,C*_+v,C*w-x*b,0,S*w-x*_,C*w+x*b,y*w*w+v,0,0,0,0,1),this}makeScale(u,d,v){return this.set(u,0,0,0,0,d,0,0,0,0,v,0,0,0,0,1),this}makeShear(u,d,v,x,y,b){return this.set(1,v,y,0,u,1,b,0,d,x,1,0,0,0,0,1),this}compose(u,d,v){var x=this.elements,y=d._x,b=d._y,_=d._z,w=d._w,S=y+y,C=b+b,P=_+_,A=y*S,T=y*C,E=y*P,D=b*C,I=b*P,k=_*P,R=w*S,O=w*C,j=w*P,G=v.x,H=v.y,X=v.z;return x[0]=(1-(D+k))*G,x[1]=(T+j)*G,x[2]=(E-O)*G,x[3]=0,x[4]=(T-j)*H,x[5]=(1-(A+k))*H,x[6]=(I+R)*H,x[7]=0,x[8]=(E+O)*X,x[9]=(I-R)*X,x[10]=(1-(A+D))*X,x[11]=0,x[12]=u.x,x[13]=u.y,x[14]=u.z,x[15]=1,this}decompose(u,d,v){var x=this.elements,y=Ze.set(x[0],x[1],x[2]).length(),b=Ze.set(x[4],x[5],x[6]).length(),_=Ze.set(x[8],x[9],x[10]).length();this.determinant()<0&&(y=-y),u.x=x[12],u.y=x[13],u.z=x[14],Je.copy(this);var w=1/y,S=1/b,C=1/_;return Je.elements[0]*=w,Je.elements[1]*=w,Je.elements[2]*=w,Je.elements[4]*=S,Je.elements[5]*=S,Je.elements[6]*=S,Je.elements[8]*=C,Je.elements[9]*=C,Je.elements[10]*=C,d.setFromRotationMatrix(Je),v.x=y,v.y=b,v.z=_,this}makePerspective(u,d,v,x,y,b){var _,w,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2e3,C=this.elements,P=2*y/(d-u),A=2*y/(v-x),T=(d+u)/(d-u),E=(v+x)/(v-x);if(S===ue)_=-(b+y)/(b-y),w=-2*b*y/(b-y);else{if(S!==ce)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+S);_=-b/(b-y),w=-b*y/(b-y)}return C[0]=P,C[4]=0,C[8]=T,C[12]=0,C[1]=0,C[5]=A,C[9]=E,C[13]=0,C[2]=0,C[6]=0,C[10]=_,C[14]=w,C[3]=0,C[7]=0,C[11]=-1,C[15]=0,this}makeOrthographic(u,d,v,x,y,b){var _,w,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2e3,C=this.elements,P=1/(d-u),A=1/(v-x),T=1/(b-y),E=(d+u)*P,D=(v+x)*A;if(S===ue)_=(b+y)*T,w=-2*T;else{if(S!==ce)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+S);_=y*T,w=-1*T}return C[0]=2*P,C[4]=0,C[8]=0,C[12]=-E,C[1]=0,C[5]=2*A,C[9]=0,C[13]=-D,C[2]=0,C[6]=0,C[10]=w,C[14]=-_,C[3]=0,C[7]=0,C[11]=0,C[15]=1,this}equals(u){for(var d=this.elements,v=u.elements,x=0;x<16;x++)if(d[x]!==v[x])return!1;return!0}fromArray(u){for(var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=0;v<16;v++)this.elements[v]=u[v+d];return this}toArray(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=this.elements;return u[d]=v[0],u[d+1]=v[1],u[d+2]=v[2],u[d+3]=v[3],u[d+4]=v[4],u[d+5]=v[5],u[d+6]=v[6],u[d+7]=v[7],u[d+8]=v[8],u[d+9]=v[9],u[d+10]=v[10],u[d+11]=v[11],u[d+12]=v[12],u[d+13]=v[13],u[d+14]=v[14],u[d+15]=v[15],u}}var Ze=new pxlNav_Ii,Je=new pxlNav_nr,Qe=new pxlNav_Ii(0,0,0),Ke=new pxlNav_Ii(1,1,1),Ye=new pxlNav_Ii,$e=new pxlNav_Ii,et=new pxlNav_Ii,tt=new pxlNav_nr,it=new pxlNav_Ci;class pxlNav_yr{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:pxlNav_yr.DEFAULT_ORDER;this.isEuler=!0,this._x=u,this._y=d,this._z=v,this._order=x}get x(){return this._x}set x(u){this._x=u,this._onChangeCallback()}get y(){return this._y}set y(u){this._y=u,this._onChangeCallback()}get z(){return this._z}set z(u){this._z=u,this._onChangeCallback()}get order(){return this._order}set order(u){this._order=u,this._onChangeCallback()}set(u,d,v){var x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=u,this._y=d,this._z=v,this._order=x,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(u){return this._x=u._x,this._y=u._y,this._z=u._z,this._order=u._order,this._onChangeCallback(),this}setFromRotationMatrix(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,v=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],x=u.elements,y=x[0],b=x[4],_=x[8],w=x[1],S=x[5],C=x[9],P=x[2],A=x[6],T=x[10];switch(d){case"XYZ":this._y=Math.asin(pxlNav_Ds(_,-1,1)),Math.abs(_)<.9999999?(this._x=Math.atan2(-C,T),this._z=Math.atan2(-b,y)):(this._x=Math.atan2(A,S),this._z=0);break;case"YXZ":this._x=Math.asin(-pxlNav_Ds(C,-1,1)),Math.abs(C)<.9999999?(this._y=Math.atan2(_,T),this._z=Math.atan2(w,S)):(this._y=Math.atan2(-P,y),this._z=0);break;case"ZXY":this._x=Math.asin(pxlNav_Ds(A,-1,1)),Math.abs(A)<.9999999?(this._y=Math.atan2(-P,T),this._z=Math.atan2(-b,S)):(this._y=0,this._z=Math.atan2(w,y));break;case"ZYX":this._y=Math.asin(-pxlNav_Ds(P,-1,1)),Math.abs(P)<.9999999?(this._x=Math.atan2(A,T),this._z=Math.atan2(w,y)):(this._x=0,this._z=Math.atan2(-b,S));break;case"YZX":this._z=Math.asin(pxlNav_Ds(w,-1,1)),Math.abs(w)<.9999999?(this._x=Math.atan2(-C,S),this._y=Math.atan2(-P,y)):(this._x=0,this._y=Math.atan2(_,T));break;case"XZY":this._z=Math.asin(-pxlNav_Ds(b,-1,1)),Math.abs(b)<.9999999?(this._x=Math.atan2(A,S),this._y=Math.atan2(_,y)):(this._x=Math.atan2(-C,T),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+d)}return this._order=d,!0===v&&this._onChangeCallback(),this}setFromQuaternion(u,d,v){return tt.makeRotationFromQuaternion(u),this.setFromRotationMatrix(tt,d,v)}setFromVector3(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(u.x,u.y,u.z,d)}reorder(u){return it.setFromEuler(this),this.setFromQuaternion(it,u)}equals(u){return u._x===this._x&&u._y===this._y&&u._z===this._z&&u._order===this._order}fromArray(u){return this._x=u[0],this._y=u[1],this._z=u[2],void 0!==u[3]&&(this._order=u[3]),this._onChangeCallback(),this}toArray(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return u[d]=this._x,u[d+1]=this._y,u[d+2]=this._z,u[d+3]=this._order,u}_onChange(u){return this._onChangeCallback=u,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}pxlNav_yr.DEFAULT_ORDER="XYZ";class pxlNav_fr{constructor(){this.mask=1}set(u){this.mask=1<<u>>>0}enable(u){this.mask|=1<<u}enableAll(){this.mask=-1}toggle(u){this.mask^=1<<u}disable(u){this.mask&=~(1<<u)}disableAll(){this.mask=0}test(u){return!!(this.mask&u.mask)}isEnabled(u){return!!(this.mask&1<<u)}}var st=0,rt=new pxlNav_Ii,at=new pxlNav_Ci,nt=new pxlNav_nr,ot=new pxlNav_Ii,lt=new pxlNav_Ii,ht=new pxlNav_Ii,ut=new pxlNav_Ci,ct=new pxlNav_Ii(1,0,0),pt=new pxlNav_Ii(0,1,0),dt=new pxlNav_Ii(0,0,1),vt={type:"added"},mt={type:"removed"},xt={type:"childadded",child:null},gt={type:"childremoved",child:null};class pxlNav_Er extends pxlNav_Ns{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:st++}),this.uuid=pxlNav_js(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=pxlNav_Er.DEFAULT_UP.clone();var u=new pxlNav_Ii,d=new pxlNav_yr,v=new pxlNav_Ci,x=new pxlNav_Ii(1,1,1);d._onChange((function(){v.setFromEuler(d,!1)})),v._onChange((function(){d.setFromQuaternion(v,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:u},rotation:{configurable:!0,enumerable:!0,value:d},quaternion:{configurable:!0,enumerable:!0,value:v},scale:{configurable:!0,enumerable:!0,value:x},modelViewMatrix:{value:new pxlNav_nr},normalMatrix:{value:new pxlNav_Gs}}),this.matrix=new pxlNav_nr,this.matrixWorld=new pxlNav_nr,this.matrixAutoUpdate=pxlNav_Er.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=pxlNav_Er.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new pxlNav_fr,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(u){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(u),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(u){return this.quaternion.premultiply(u),this}setRotationFromAxisAngle(u,d){this.quaternion.setFromAxisAngle(u,d)}setRotationFromEuler(u){this.quaternion.setFromEuler(u,!0)}setRotationFromMatrix(u){this.quaternion.setFromRotationMatrix(u)}setRotationFromQuaternion(u){this.quaternion.copy(u)}rotateOnAxis(u,d){return at.setFromAxisAngle(u,d),this.quaternion.multiply(at),this}rotateOnWorldAxis(u,d){return at.setFromAxisAngle(u,d),this.quaternion.premultiply(at),this}rotateX(u){return this.rotateOnAxis(ct,u)}rotateY(u){return this.rotateOnAxis(pt,u)}rotateZ(u){return this.rotateOnAxis(dt,u)}translateOnAxis(u,d){return rt.copy(u).applyQuaternion(this.quaternion),this.position.add(rt.multiplyScalar(d)),this}translateX(u){return this.translateOnAxis(ct,u)}translateY(u){return this.translateOnAxis(pt,u)}translateZ(u){return this.translateOnAxis(dt,u)}localToWorld(u){return this.updateWorldMatrix(!0,!1),u.applyMatrix4(this.matrixWorld)}worldToLocal(u){return this.updateWorldMatrix(!0,!1),u.applyMatrix4(nt.copy(this.matrixWorld).invert())}lookAt(u,d,v){u.isVector3?ot.copy(u):ot.set(u,d,v);var x=this.parent;this.updateWorldMatrix(!0,!1),lt.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?nt.lookAt(lt,ot,this.up):nt.lookAt(ot,lt,this.up),this.quaternion.setFromRotationMatrix(nt),x&&(nt.extractRotation(x.matrixWorld),at.setFromRotationMatrix(nt),this.quaternion.premultiply(at.invert()))}add(u){if(arguments.length>1){for(var d=0;d<arguments.length;d++)this.add(arguments[d]);return this}return u===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",u),this):(u&&u.isObject3D?(u.removeFromParent(),u.parent=this,this.children.push(u),u.dispatchEvent(vt),xt.child=u,this.dispatchEvent(xt),xt.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",u),this)}remove(u){if(arguments.length>1){for(var d=0;d<arguments.length;d++)this.remove(arguments[d]);return this}var v=this.children.indexOf(u);return-1!==v&&(u.parent=null,this.children.splice(v,1),u.dispatchEvent(mt),gt.child=u,this.dispatchEvent(gt),gt.child=null),this}removeFromParent(){var u=this.parent;return null!==u&&u.remove(this),this}clear(){return this.remove(...this.children)}attach(u){return this.updateWorldMatrix(!0,!1),nt.copy(this.matrixWorld).invert(),null!==u.parent&&(u.parent.updateWorldMatrix(!0,!1),nt.multiply(u.parent.matrixWorld)),u.applyMatrix4(nt),u.removeFromParent(),u.parent=this,this.children.push(u),u.updateWorldMatrix(!1,!0),u.dispatchEvent(vt),xt.child=u,this.dispatchEvent(xt),xt.child=null,this}getObjectById(u){return this.getObjectByProperty("id",u)}getObjectByName(u){return this.getObjectByProperty("name",u)}getObjectByProperty(u,d){if(this[u]===d)return this;for(var v=0,x=this.children.length;v<x;v++){var y=this.children[v].getObjectByProperty(u,d);if(void 0!==y)return y}}getObjectsByProperty(u,d){var v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];this[u]===d&&v.push(this);for(var x=this.children,y=0,b=x.length;y<b;y++)x[y].getObjectsByProperty(u,d,v);return v}getWorldPosition(u){return this.updateWorldMatrix(!0,!1),u.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(u){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(lt,u,ht),u}getWorldScale(u){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(lt,ut,u),u}getWorldDirection(u){this.updateWorldMatrix(!0,!1);var d=this.matrixWorld.elements;return u.set(d[8],d[9],d[10]).normalize()}raycast(){}traverse(u){u(this);for(var d=this.children,v=0,x=d.length;v<x;v++)d[v].traverse(u)}traverseVisible(u){if(!1!==this.visible){u(this);for(var d=this.children,v=0,x=d.length;v<x;v++)d[v].traverseVisible(u)}}traverseAncestors(u){var d=this.parent;null!==d&&(u(d),d.traverseAncestors(u))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(u){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||u)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,u=!0);for(var d=this.children,v=0,x=d.length;v<x;v++)d[v].updateMatrixWorld(u)}updateWorldMatrix(u,d){var v=this.parent;if(!0===u&&null!==v&&v.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===d)for(var x=this.children,y=0,b=x.length;y<b;y++)x[y].updateWorldMatrix(!1,!0)}toJSON(u){var d=void 0===u||"string"==typeof u,v={};d&&(u={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},v.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});var x={};function r(d,v){return void 0===d[v.uuid]&&(d[v.uuid]=v.toJSON(u)),v.uuid}if(x.uuid=this.uuid,x.type=this.type,""!==this.name&&(x.name=this.name),!0===this.castShadow&&(x.castShadow=!0),!0===this.receiveShadow&&(x.receiveShadow=!0),!1===this.visible&&(x.visible=!1),!1===this.frustumCulled&&(x.frustumCulled=!1),0!==this.renderOrder&&(x.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(x.userData=this.userData),x.layers=this.layers.mask,x.matrix=this.matrix.toArray(),x.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(x.matrixAutoUpdate=!1),this.isInstancedMesh&&(x.type="InstancedMesh",x.count=this.count,x.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(x.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(x.type="BatchedMesh",x.perObjectFrustumCulled=this.perObjectFrustumCulled,x.sortObjects=this.sortObjects,x.drawRanges=this._drawRanges,x.reservedRanges=this._reservedRanges,x.visibility=this._visibility,x.active=this._active,x.bounds=this._bounds.map((u=>({boxInitialized:u.boxInitialized,boxMin:u.box.min.toArray(),boxMax:u.box.max.toArray(),sphereInitialized:u.sphereInitialized,sphereRadius:u.sphere.radius,sphereCenter:u.sphere.center.toArray()}))),x.maxInstanceCount=this._maxInstanceCount,x.maxVertexCount=this._maxVertexCount,x.maxIndexCount=this._maxIndexCount,x.geometryInitialized=this._geometryInitialized,x.geometryCount=this._geometryCount,x.matricesTexture=this._matricesTexture.toJSON(u),null!==this._colorsTexture&&(x.colorsTexture=this._colorsTexture.toJSON(u)),null!==this.boundingSphere&&(x.boundingSphere={center:x.boundingSphere.center.toArray(),radius:x.boundingSphere.radius}),null!==this.boundingBox&&(x.boundingBox={min:x.boundingBox.min.toArray(),max:x.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?x.background=this.background.toJSON():this.background.isTexture&&(x.background=this.background.toJSON(u).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(x.environment=this.environment.toJSON(u).uuid);else if(this.isMesh||this.isLine||this.isPoints){x.geometry=r(u.geometries,this.geometry);var y=this.geometry.parameters;if(void 0!==y&&void 0!==y.shapes){var b=y.shapes;if(Array.isArray(b))for(var _=0,w=b.length;_<w;_++){var S=b[_];r(u.shapes,S)}else r(u.shapes,b)}}if(this.isSkinnedMesh&&(x.bindMode=this.bindMode,x.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(u.skeletons,this.skeleton),x.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){for(var C=[],P=0,A=this.material.length;P<A;P++)C.push(r(u.materials,this.material[P]));x.material=C}else x.material=r(u.materials,this.material);if(this.children.length>0){x.children=[];for(var T=0;T<this.children.length;T++)x.children.push(this.children[T].toJSON(u).object)}if(this.animations.length>0){x.animations=[];for(var E=0;E<this.animations.length;E++){var D=this.animations[E];x.animations.push(r(u.animations,D))}}if(d){var I=n(u.geometries),k=n(u.materials),R=n(u.textures),O=n(u.images),j=n(u.shapes),G=n(u.skeletons),H=n(u.animations),X=n(u.nodes);I.length>0&&(v.geometries=I),k.length>0&&(v.materials=k),R.length>0&&(v.textures=R),O.length>0&&(v.images=O),j.length>0&&(v.shapes=j),G.length>0&&(v.skeletons=G),H.length>0&&(v.animations=H),X.length>0&&(v.nodes=X)}return v.object=x,v;function n(u){var d=[];for(var v in u){var x=u[v];delete x.metadata,d.push(x)}return d}}clone(u){return(new this.constructor).copy(this,u)}copy(u){var d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=u.name,this.up.copy(u.up),this.position.copy(u.position),this.rotation.order=u.rotation.order,this.quaternion.copy(u.quaternion),this.scale.copy(u.scale),this.matrix.copy(u.matrix),this.matrixWorld.copy(u.matrixWorld),this.matrixAutoUpdate=u.matrixAutoUpdate,this.matrixWorldAutoUpdate=u.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=u.matrixWorldNeedsUpdate,this.layers.mask=u.layers.mask,this.visible=u.visible,this.castShadow=u.castShadow,this.receiveShadow=u.receiveShadow,this.frustumCulled=u.frustumCulled,this.renderOrder=u.renderOrder,this.animations=u.animations.slice(),this.userData=JSON.parse(JSON.stringify(u.userData)),!0===d)for(var v=0;v<u.children.length;v++){var x=u.children[v];this.add(x.clone())}return this}}pxlNav_Er.DEFAULT_UP=new pxlNav_Ii(0,1,0),pxlNav_Er.DEFAULT_MATRIX_AUTO_UPDATE=!0,pxlNav_Er.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var ft=new pxlNav_Ii,yt=new pxlNav_Ii,bt=new pxlNav_Ii,_t=new pxlNav_Ii,wt=new pxlNav_Ii,St=new pxlNav_Ii,Ct=new pxlNav_Ii,Nt=new pxlNav_Ii,Pt=new pxlNav_Ii,Mt=new pxlNav_Ii,At=new pxlNav_wi,Tt=new pxlNav_wi,Et=new pxlNav_wi;class pxlNav_Jr{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pxlNav_Ii,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pxlNav_Ii,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new pxlNav_Ii;this.a=u,this.b=d,this.c=v}static getNormal(u,d,v,x){x.subVectors(v,d),ft.subVectors(u,d),x.cross(ft);var y=x.lengthSq();return y>0?x.multiplyScalar(1/Math.sqrt(y)):x.set(0,0,0)}static getBarycoord(u,d,v,x,y){ft.subVectors(x,d),yt.subVectors(v,d),bt.subVectors(u,d);var b=ft.dot(ft),_=ft.dot(yt),w=ft.dot(bt),S=yt.dot(yt),C=yt.dot(bt),P=b*S-_*_;if(0===P)return y.set(0,0,0),null;var A=1/P,T=(S*w-_*C)*A,E=(b*C-_*w)*A;return y.set(1-T-E,E,T)}static containsPoint(u,d,v,x){return null!==this.getBarycoord(u,d,v,x,_t)&&_t.x>=0&&_t.y>=0&&_t.x+_t.y<=1}static getInterpolation(u,d,v,x,y,b,_,w){return null===this.getBarycoord(u,d,v,x,_t)?(w.x=0,w.y=0,"z"in w&&(w.z=0),"w"in w&&(w.w=0),null):(w.setScalar(0),w.addScaledVector(y,_t.x),w.addScaledVector(b,_t.y),w.addScaledVector(_,_t.z),w)}static getInterpolatedAttribute(u,d,v,x,y,b){return At.setScalar(0),Tt.setScalar(0),Et.setScalar(0),At.fromBufferAttribute(u,d),Tt.fromBufferAttribute(u,v),Et.fromBufferAttribute(u,x),b.setScalar(0),b.addScaledVector(At,y.x),b.addScaledVector(Tt,y.y),b.addScaledVector(Et,y.z),b}static isFrontFacing(u,d,v,x){return ft.subVectors(v,d),yt.subVectors(u,d),ft.cross(yt).dot(x)<0}set(u,d,v){return this.a.copy(u),this.b.copy(d),this.c.copy(v),this}setFromPointsAndIndices(u,d,v,x){return this.a.copy(u[d]),this.b.copy(u[v]),this.c.copy(u[x]),this}setFromAttributeAndIndices(u,d,v,x){return this.a.fromBufferAttribute(u,d),this.b.fromBufferAttribute(u,v),this.c.fromBufferAttribute(u,x),this}clone(){return(new this.constructor).copy(this)}copy(u){return this.a.copy(u.a),this.b.copy(u.b),this.c.copy(u.c),this}getArea(){return ft.subVectors(this.c,this.b),yt.subVectors(this.a,this.b),.5*ft.cross(yt).length()}getMidpoint(u){return u.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(u){return pxlNav_Jr.getNormal(this.a,this.b,this.c,u)}getPlane(u){return u.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(u,d){return pxlNav_Jr.getBarycoord(u,this.a,this.b,this.c,d)}getInterpolation(u,d,v,x,y){return pxlNav_Jr.getInterpolation(u,this.a,this.b,this.c,d,v,x,y)}containsPoint(u){return pxlNav_Jr.containsPoint(u,this.a,this.b,this.c)}isFrontFacing(u){return pxlNav_Jr.isFrontFacing(this.a,this.b,this.c,u)}intersectsBox(u){return u.intersectsTriangle(this)}closestPointToPoint(u,d){var v,x,y=this.a,b=this.b,_=this.c;wt.subVectors(b,y),St.subVectors(_,y),Nt.subVectors(u,y);var w=wt.dot(Nt),S=St.dot(Nt);if(w<=0&&S<=0)return d.copy(y);Pt.subVectors(u,b);var C=wt.dot(Pt),P=St.dot(Pt);if(C>=0&&P<=C)return d.copy(b);var A=w*P-C*S;if(A<=0&&w>=0&&C<=0)return v=w/(w-C),d.copy(y).addScaledVector(wt,v);Mt.subVectors(u,_);var T=wt.dot(Mt),E=St.dot(Mt);if(E>=0&&T<=E)return d.copy(_);var D=T*S-w*E;if(D<=0&&S>=0&&E<=0)return x=S/(S-E),d.copy(y).addScaledVector(St,x);var I=C*E-T*P;if(I<=0&&P-C>=0&&T-E>=0)return Ct.subVectors(_,b),x=(P-C)/(P-C+(T-E)),d.copy(b).addScaledVector(Ct,x);var k=1/(I+D+A);return v=D*k,x=A*k,d.copy(y).addScaledVector(wt,v).addScaledVector(St,x)}equals(u){return u.a.equals(this.a)&&u.b.equals(this.b)&&u.c.equals(this.c)}}var Dt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},It={h:0,s:0,l:0},Lt={h:0,s:0,l:0};function pxlNav_Gr(u,d,v){return v<0&&(v+=1),v>1&&(v-=1),v<1/6?u+6*(d-u)*v:v<.5?d:v<2/3?u+6*(d-u)*(2/3-v):u}class pxlNav_$r{constructor(u,d,v){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(u,d,v)}set(u,d,v){if(void 0===d&&void 0===v){var x=u;x&&x.isColor?this.copy(x):"number"==typeof x?this.setHex(x):"string"==typeof x&&this.setStyle(x)}else this.setRGB(u,d,v);return this}setScalar(u){return this.r=u,this.g=u,this.b=u,this}setHex(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:re;return u=Math.floor(u),this.r=(u>>16&255)/255,this.g=(u>>8&255)/255,this.b=(255&u)/255,be.toWorkingColorSpace(this,d),this}setRGB(u,d,v){var x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:be.workingColorSpace;return this.r=u,this.g=d,this.b=v,be.toWorkingColorSpace(this,x),this}setHSL(u,d,v){var x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:be.workingColorSpace;if(u=pxlNav_Hs(u,1),d=pxlNav_Ds(d,0,1),v=pxlNav_Ds(v,0,1),0===d)this.r=this.g=this.b=v;else{var y=v<=.5?v*(1+d):v+d-v*d,b=2*v-y;this.r=pxlNav_Gr(b,y,u+1/3),this.g=pxlNav_Gr(b,y,u),this.b=pxlNav_Gr(b,y,u-1/3)}return be.toWorkingColorSpace(this,x),this}setStyle(u){var d,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:re;function s(d){void 0!==d&&parseFloat(d)<1&&console.warn("THREE.Color: Alpha component of "+u+" will be ignored.")}if(d=/^(\w+)\(([^\)]*)\)/.exec(u)){var x,y=d[1],b=d[2];switch(y){case"rgb":case"rgba":if(x=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(b))return s(x[4]),this.setRGB(Math.min(255,parseInt(x[1],10))/255,Math.min(255,parseInt(x[2],10))/255,Math.min(255,parseInt(x[3],10))/255,v);if(x=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(b))return s(x[4]),this.setRGB(Math.min(100,parseInt(x[1],10))/100,Math.min(100,parseInt(x[2],10))/100,Math.min(100,parseInt(x[3],10))/100,v);break;case"hsl":case"hsla":if(x=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(b))return s(x[4]),this.setHSL(parseFloat(x[1])/360,parseFloat(x[2])/100,parseFloat(x[3])/100,v);break;default:console.warn("THREE.Color: Unknown color model "+u)}}else if(d=/^\#([A-Fa-f\d]+)$/.exec(u)){var _=d[1],w=_.length;if(3===w)return this.setRGB(parseInt(_.charAt(0),16)/15,parseInt(_.charAt(1),16)/15,parseInt(_.charAt(2),16)/15,v);if(6===w)return this.setHex(parseInt(_,16),v);console.warn("THREE.Color: Invalid hex color "+u)}else if(u&&u.length>0)return this.setColorName(u,v);return this}setColorName(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:re,v=Dt[u.toLowerCase()];return void 0!==v?this.setHex(v,d):console.warn("THREE.Color: Unknown color "+u),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(u){return this.r=u.r,this.g=u.g,this.b=u.b,this}copySRGBToLinear(u){return this.r=pxlNav_di(u.r),this.g=pxlNav_di(u.g),this.b=pxlNav_di(u.b),this}copyLinearToSRGB(u){return this.r=pxlNav_three_core_min_pi(u.r),this.g=pxlNav_three_core_min_pi(u.g),this.b=pxlNav_three_core_min_pi(u.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:re;return be.fromWorkingColorSpace(kt.copy(this),u),65536*Math.round(pxlNav_Ds(255*kt.r,0,255))+256*Math.round(pxlNav_Ds(255*kt.g,0,255))+Math.round(pxlNav_Ds(255*kt.b,0,255))}getHexString(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:re;return("000000"+this.getHex(u).toString(16)).slice(-6)}getHSL(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:be.workingColorSpace;be.fromWorkingColorSpace(kt.copy(this),d);var v,x,y=kt.r,b=kt.g,_=kt.b,w=Math.max(y,b,_),S=Math.min(y,b,_),C=(S+w)/2;if(S===w)v=0,x=0;else{var P=w-S;switch(x=C<=.5?P/(w+S):P/(2-w-S),w){case y:v=(b-_)/P+(b<_?6:0);break;case b:v=(_-y)/P+2;break;case _:v=(y-b)/P+4}v/=6}return u.h=v,u.s=x,u.l=C,u}getRGB(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:be.workingColorSpace;return be.fromWorkingColorSpace(kt.copy(this),d),u.r=kt.r,u.g=kt.g,u.b=kt.b,u}getStyle(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:re;be.fromWorkingColorSpace(kt.copy(this),u);var d=kt.r,v=kt.g,x=kt.b;return u!==re?"color(".concat(u," ").concat(d.toFixed(3)," ").concat(v.toFixed(3)," ").concat(x.toFixed(3),")"):"rgb(".concat(Math.round(255*d),",").concat(Math.round(255*v),",").concat(Math.round(255*x),")")}offsetHSL(u,d,v){return this.getHSL(It),this.setHSL(It.h+u,It.s+d,It.l+v)}add(u){return this.r+=u.r,this.g+=u.g,this.b+=u.b,this}addColors(u,d){return this.r=u.r+d.r,this.g=u.g+d.g,this.b=u.b+d.b,this}addScalar(u){return this.r+=u,this.g+=u,this.b+=u,this}sub(u){return this.r=Math.max(0,this.r-u.r),this.g=Math.max(0,this.g-u.g),this.b=Math.max(0,this.b-u.b),this}multiply(u){return this.r*=u.r,this.g*=u.g,this.b*=u.b,this}multiplyScalar(u){return this.r*=u,this.g*=u,this.b*=u,this}lerp(u,d){return this.r+=(u.r-this.r)*d,this.g+=(u.g-this.g)*d,this.b+=(u.b-this.b)*d,this}lerpColors(u,d,v){return this.r=u.r+(d.r-u.r)*v,this.g=u.g+(d.g-u.g)*v,this.b=u.b+(d.b-u.b)*v,this}lerpHSL(u,d){this.getHSL(It),u.getHSL(Lt);var v=pxlNav_qs(It.h,Lt.h,d),x=pxlNav_qs(It.s,Lt.s,d),y=pxlNav_qs(It.l,Lt.l,d);return this.setHSL(v,x,y),this}setFromVector3(u){return this.r=u.x,this.g=u.y,this.b=u.z,this}applyMatrix3(u){var d=this.r,v=this.g,x=this.b,y=u.elements;return this.r=y[0]*d+y[3]*v+y[6]*x,this.g=y[1]*d+y[4]*v+y[7]*x,this.b=y[2]*d+y[5]*v+y[8]*x,this}equals(u){return u.r===this.r&&u.g===this.g&&u.b===this.b}fromArray(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=u[d],this.g=u[d+1],this.b=u[d+2],this}toArray(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return u[d]=this.r,u[d+1]=this.g,u[d+2]=this.b,u}fromBufferAttribute(u,d){return this.r=u.getX(d),this.g=u.getY(d),this.b=u.getZ(d),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}var kt=new pxlNav_$r;pxlNav_$r.NAMES=Dt;var Rt=0;class pxlNav_tn extends pxlNav_Ns{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Rt++}),this.uuid=pxlNav_js(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new pxlNav_$r(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=le,this.stencilZFail=le,this.stencilZPass=le,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(u){this._alphaTest>0!=u>0&&this.version++,this._alphaTest=u}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(u){if(void 0!==u)for(var d in u){var v=u[d];if(void 0!==v){var x=this[d];void 0!==x?x&&x.isColor?x.set(v):x&&x.isVector3&&v&&v.isVector3?x.copy(v):this[d]=v:console.warn("THREE.Material: '".concat(d,"' is not a property of THREE.").concat(this.type,"."))}else console.warn("THREE.Material: parameter '".concat(d,"' has value of undefined."))}}toJSON(u){var d=void 0===u||"string"==typeof u;d&&(u={textures:{},images:{}});var v={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function i(u){var d=[];for(var v in u){var x=u[v];delete x.metadata,d.push(x)}return d}if(v.uuid=this.uuid,v.type=this.type,""!==this.name&&(v.name=this.name),this.color&&this.color.isColor&&(v.color=this.color.getHex()),void 0!==this.roughness&&(v.roughness=this.roughness),void 0!==this.metalness&&(v.metalness=this.metalness),void 0!==this.sheen&&(v.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(v.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(v.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(v.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(v.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(v.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(v.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(v.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(v.shininess=this.shininess),void 0!==this.clearcoat&&(v.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(v.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(v.clearcoatMap=this.clearcoatMap.toJSON(u).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(v.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(u).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(v.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(u).uuid,v.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(v.dispersion=this.dispersion),void 0!==this.iridescence&&(v.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(v.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(v.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(v.iridescenceMap=this.iridescenceMap.toJSON(u).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(v.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(u).uuid),void 0!==this.anisotropy&&(v.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(v.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(v.anisotropyMap=this.anisotropyMap.toJSON(u).uuid),this.map&&this.map.isTexture&&(v.map=this.map.toJSON(u).uuid),this.matcap&&this.matcap.isTexture&&(v.matcap=this.matcap.toJSON(u).uuid),this.alphaMap&&this.alphaMap.isTexture&&(v.alphaMap=this.alphaMap.toJSON(u).uuid),this.lightMap&&this.lightMap.isTexture&&(v.lightMap=this.lightMap.toJSON(u).uuid,v.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(v.aoMap=this.aoMap.toJSON(u).uuid,v.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(v.bumpMap=this.bumpMap.toJSON(u).uuid,v.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(v.normalMap=this.normalMap.toJSON(u).uuid,v.normalMapType=this.normalMapType,v.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(v.displacementMap=this.displacementMap.toJSON(u).uuid,v.displacementScale=this.displacementScale,v.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(v.roughnessMap=this.roughnessMap.toJSON(u).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(v.metalnessMap=this.metalnessMap.toJSON(u).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(v.emissiveMap=this.emissiveMap.toJSON(u).uuid),this.specularMap&&this.specularMap.isTexture&&(v.specularMap=this.specularMap.toJSON(u).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(v.specularIntensityMap=this.specularIntensityMap.toJSON(u).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(v.specularColorMap=this.specularColorMap.toJSON(u).uuid),this.envMap&&this.envMap.isTexture&&(v.envMap=this.envMap.toJSON(u).uuid,void 0!==this.combine&&(v.combine=this.combine)),void 0!==this.envMapRotation&&(v.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(v.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(v.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(v.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(v.gradientMap=this.gradientMap.toJSON(u).uuid),void 0!==this.transmission&&(v.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(v.transmissionMap=this.transmissionMap.toJSON(u).uuid),void 0!==this.thickness&&(v.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(v.thicknessMap=this.thicknessMap.toJSON(u).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(v.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(v.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(v.size=this.size),null!==this.shadowSide&&(v.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(v.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(v.blending=this.blending),0!==this.side&&(v.side=this.side),!0===this.vertexColors&&(v.vertexColors=!0),this.opacity<1&&(v.opacity=this.opacity),!0===this.transparent&&(v.transparent=!0),204!==this.blendSrc&&(v.blendSrc=this.blendSrc),205!==this.blendDst&&(v.blendDst=this.blendDst),100!==this.blendEquation&&(v.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(v.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(v.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(v.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(v.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(v.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(v.depthFunc=this.depthFunc),!1===this.depthTest&&(v.depthTest=this.depthTest),!1===this.depthWrite&&(v.depthWrite=this.depthWrite),!1===this.colorWrite&&(v.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(v.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(v.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(v.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(v.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==le&&(v.stencilFail=this.stencilFail),this.stencilZFail!==le&&(v.stencilZFail=this.stencilZFail),this.stencilZPass!==le&&(v.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(v.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(v.rotation=this.rotation),!0===this.polygonOffset&&(v.polygonOffset=!0),0!==this.polygonOffsetFactor&&(v.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(v.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(v.linewidth=this.linewidth),void 0!==this.dashSize&&(v.dashSize=this.dashSize),void 0!==this.gapSize&&(v.gapSize=this.gapSize),void 0!==this.scale&&(v.scale=this.scale),!0===this.dithering&&(v.dithering=!0),this.alphaTest>0&&(v.alphaTest=this.alphaTest),!0===this.alphaHash&&(v.alphaHash=!0),!0===this.alphaToCoverage&&(v.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(v.premultipliedAlpha=!0),!0===this.forceSinglePass&&(v.forceSinglePass=!0),!0===this.wireframe&&(v.wireframe=!0),this.wireframeLinewidth>1&&(v.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(v.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(v.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(v.flatShading=!0),!1===this.visible&&(v.visible=!1),!1===this.toneMapped&&(v.toneMapped=!1),!1===this.fog&&(v.fog=!1),Object.keys(this.userData).length>0&&(v.userData=this.userData),d){var x=i(u.textures),y=i(u.images);x.length>0&&(v.textures=x),y.length>0&&(v.images=y)}return v}clone(){return(new this.constructor).copy(this)}copy(u){this.name=u.name,this.blending=u.blending,this.side=u.side,this.vertexColors=u.vertexColors,this.opacity=u.opacity,this.transparent=u.transparent,this.blendSrc=u.blendSrc,this.blendDst=u.blendDst,this.blendEquation=u.blendEquation,this.blendSrcAlpha=u.blendSrcAlpha,this.blendDstAlpha=u.blendDstAlpha,this.blendEquationAlpha=u.blendEquationAlpha,this.blendColor.copy(u.blendColor),this.blendAlpha=u.blendAlpha,this.depthFunc=u.depthFunc,this.depthTest=u.depthTest,this.depthWrite=u.depthWrite,this.stencilWriteMask=u.stencilWriteMask,this.stencilFunc=u.stencilFunc,this.stencilRef=u.stencilRef,this.stencilFuncMask=u.stencilFuncMask,this.stencilFail=u.stencilFail,this.stencilZFail=u.stencilZFail,this.stencilZPass=u.stencilZPass,this.stencilWrite=u.stencilWrite;var d=u.clippingPlanes,v=null;if(null!==d){var x=d.length;v=new Array(x);for(var y=0;y!==x;++y)v[y]=d[y].clone()}return this.clippingPlanes=v,this.clipIntersection=u.clipIntersection,this.clipShadows=u.clipShadows,this.shadowSide=u.shadowSide,this.colorWrite=u.colorWrite,this.precision=u.precision,this.polygonOffset=u.polygonOffset,this.polygonOffsetFactor=u.polygonOffsetFactor,this.polygonOffsetUnits=u.polygonOffsetUnits,this.dithering=u.dithering,this.alphaTest=u.alphaTest,this.alphaHash=u.alphaHash,this.alphaToCoverage=u.alphaToCoverage,this.premultipliedAlpha=u.premultipliedAlpha,this.forceSinglePass=u.forceSinglePass,this.visible=u.visible,this.toneMapped=u.toneMapped,this.userData=JSON.parse(JSON.stringify(u.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(u){!0===u&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class pxlNav_en extends pxlNav_tn{constructor(u){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new pxlNav_$r(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new pxlNav_yr,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(u)}copy(u){return super.copy(u),this.color.copy(u.color),this.map=u.map,this.lightMap=u.lightMap,this.lightMapIntensity=u.lightMapIntensity,this.aoMap=u.aoMap,this.aoMapIntensity=u.aoMapIntensity,this.specularMap=u.specularMap,this.alphaMap=u.alphaMap,this.envMap=u.envMap,this.envMapRotation.copy(u.envMapRotation),this.combine=u.combine,this.reflectivity=u.reflectivity,this.refractionRatio=u.refractionRatio,this.wireframe=u.wireframe,this.wireframeLinewidth=u.wireframeLinewidth,this.wireframeLinecap=u.wireframeLinecap,this.wireframeLinejoin=u.wireframeLinejoin,this.fog=u.fog,this}}(function pxlNav_rn(){for(var u=new ArrayBuffer(4),d=new Float32Array(u),v=new Uint32Array(u),x=new Uint32Array(512),y=new Uint32Array(512),b=0;b<256;++b){var _=b-127;_<-27?(x[b]=0,x[256|b]=32768,y[b]=24,y[256|b]=24):_<-14?(x[b]=1024>>-_-14,x[256|b]=1024>>-_-14|32768,y[b]=-_-1,y[256|b]=-_-1):_<=15?(x[b]=_+15<<10,x[256|b]=_+15<<10|32768,y[b]=13,y[256|b]=13):_<128?(x[b]=31744,x[256|b]=64512,y[b]=24,y[256|b]=24):(x[b]=31744,x[256|b]=64512,y[b]=13,y[256|b]=13)}for(var w=new Uint32Array(2048),S=new Uint32Array(64),C=new Uint32Array(64),P=1;P<1024;++P){for(var A=P<<13,T=0;!(8388608&A);)A<<=1,T-=8388608;A&=-8388609,T+=947912704,w[P]=A|T}for(var E=1024;E<2048;++E)w[E]=939524096+(E-1024<<13);for(var D=1;D<31;++D)S[D]=D<<23;S[31]=1199570944,S[32]=2147483648;for(var I=33;I<63;++I)S[I]=2147483648+(I-32<<23);S[63]=3347054592;for(var k=1;k<64;++k)32!==k&&(C[k]=1024);return{floatView:d,uint32View:v,baseTable:x,shiftTable:y,mantissaTable:w,exponentTable:S,offsetTable:C}})();var Ot=new pxlNav_Ii,Bt=new pxlNav_Zs;class pxlNav_cn{constructor(u,d){var v=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Array.isArray(u))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=u,this.itemSize=d,this.count=void 0!==u?u.length/d:0,this.normalized=v,this.usage=he,this.updateRanges=[],this.gpuType=Q,this.version=0}onUploadCallback(){}set needsUpdate(u){!0===u&&this.version++}setUsage(u){return this.usage=u,this}addUpdateRange(u,d){this.updateRanges.push({start:u,count:d})}clearUpdateRanges(){this.updateRanges.length=0}copy(u){return this.name=u.name,this.array=new u.array.constructor(u.array),this.itemSize=u.itemSize,this.count=u.count,this.normalized=u.normalized,this.usage=u.usage,this.gpuType=u.gpuType,this}copyAt(u,d,v){u*=this.itemSize,v*=d.itemSize;for(var x=0,y=this.itemSize;x<y;x++)this.array[u+x]=d.array[v+x];return this}copyArray(u){return this.array.set(u),this}applyMatrix3(u){if(2===this.itemSize)for(var d=0,v=this.count;d<v;d++)Bt.fromBufferAttribute(this,d),Bt.applyMatrix3(u),this.setXY(d,Bt.x,Bt.y);else if(3===this.itemSize)for(var x=0,y=this.count;x<y;x++)Ot.fromBufferAttribute(this,x),Ot.applyMatrix3(u),this.setXYZ(x,Ot.x,Ot.y,Ot.z);return this}applyMatrix4(u){for(var d=0,v=this.count;d<v;d++)Ot.fromBufferAttribute(this,d),Ot.applyMatrix4(u),this.setXYZ(d,Ot.x,Ot.y,Ot.z);return this}applyNormalMatrix(u){for(var d=0,v=this.count;d<v;d++)Ot.fromBufferAttribute(this,d),Ot.applyNormalMatrix(u),this.setXYZ(d,Ot.x,Ot.y,Ot.z);return this}transformDirection(u){for(var d=0,v=this.count;d<v;d++)Ot.fromBufferAttribute(this,d),Ot.transformDirection(u),this.setXYZ(d,Ot.x,Ot.y,Ot.z);return this}set(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(u,d),this}getComponent(u,d){var v=this.array[u*this.itemSize+d];return this.normalized&&(v=pxlNav_Js(v,this.array)),v}setComponent(u,d,v){return this.normalized&&(v=pxlNav_Xs(v,this.array)),this.array[u*this.itemSize+d]=v,this}getX(u){var d=this.array[u*this.itemSize];return this.normalized&&(d=pxlNav_Js(d,this.array)),d}setX(u,d){return this.normalized&&(d=pxlNav_Xs(d,this.array)),this.array[u*this.itemSize]=d,this}getY(u){var d=this.array[u*this.itemSize+1];return this.normalized&&(d=pxlNav_Js(d,this.array)),d}setY(u,d){return this.normalized&&(d=pxlNav_Xs(d,this.array)),this.array[u*this.itemSize+1]=d,this}getZ(u){var d=this.array[u*this.itemSize+2];return this.normalized&&(d=pxlNav_Js(d,this.array)),d}setZ(u,d){return this.normalized&&(d=pxlNav_Xs(d,this.array)),this.array[u*this.itemSize+2]=d,this}getW(u){var d=this.array[u*this.itemSize+3];return this.normalized&&(d=pxlNav_Js(d,this.array)),d}setW(u,d){return this.normalized&&(d=pxlNav_Xs(d,this.array)),this.array[u*this.itemSize+3]=d,this}setXY(u,d,v){return u*=this.itemSize,this.normalized&&(d=pxlNav_Xs(d,this.array),v=pxlNav_Xs(v,this.array)),this.array[u+0]=d,this.array[u+1]=v,this}setXYZ(u,d,v,x){return u*=this.itemSize,this.normalized&&(d=pxlNav_Xs(d,this.array),v=pxlNav_Xs(v,this.array),x=pxlNav_Xs(x,this.array)),this.array[u+0]=d,this.array[u+1]=v,this.array[u+2]=x,this}setXYZW(u,d,v,x,y){return u*=this.itemSize,this.normalized&&(d=pxlNav_Xs(d,this.array),v=pxlNav_Xs(v,this.array),x=pxlNav_Xs(x,this.array),y=pxlNav_Xs(y,this.array)),this.array[u+0]=d,this.array[u+1]=v,this.array[u+2]=x,this.array[u+3]=y,this}onUpload(u){return this.onUploadCallback=u,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){var u={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(u.name=this.name),this.usage!==he&&(u.usage=this.usage),u}}class pxlNav_yn extends pxlNav_cn{constructor(u,d,v){super(new Uint16Array(u),d,v)}}class pxlNav_gn extends pxlNav_cn{constructor(u,d,v){super(new Uint32Array(u),d,v)}}class pxlNav_bn extends pxlNav_cn{constructor(u,d,v){super(new Float32Array(u),d,v)}}var Vt=0,Ut=new pxlNav_nr,Ft=new pxlNav_Er,jt=new pxlNav_Ii,zt=new pxlNav_Ei,Gt=new pxlNav_Ei,Ht=new pxlNav_Ii;class pxlNav_zn extends pxlNav_Ns{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Vt++}),this.uuid=pxlNav_js(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(u){return Array.isArray(u)?this.index=new(function pxlNav_Qs(u){for(var d=u.length-1;d>=0;--d)if(u[d]>=65535)return!0;return!1}(u)?pxlNav_gn:pxlNav_yn)(u,1):this.index=u,this}setIndirect(u){return this.indirect=u,this}getIndirect(){return this.indirect}getAttribute(u){return this.attributes[u]}setAttribute(u,d){return this.attributes[u]=d,this}deleteAttribute(u){return delete this.attributes[u],this}hasAttribute(u){return void 0!==this.attributes[u]}addGroup(u,d){var v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:u,count:d,materialIndex:v})}clearGroups(){this.groups=[]}setDrawRange(u,d){this.drawRange.start=u,this.drawRange.count=d}applyMatrix4(u){var d=this.attributes.position;void 0!==d&&(d.applyMatrix4(u),d.needsUpdate=!0);var v=this.attributes.normal;if(void 0!==v){var x=(new pxlNav_Gs).getNormalMatrix(u);v.applyNormalMatrix(x),v.needsUpdate=!0}var y=this.attributes.tangent;return void 0!==y&&(y.transformDirection(u),y.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(u){return Ut.makeRotationFromQuaternion(u),this.applyMatrix4(Ut),this}rotateX(u){return Ut.makeRotationX(u),this.applyMatrix4(Ut),this}rotateY(u){return Ut.makeRotationY(u),this.applyMatrix4(Ut),this}rotateZ(u){return Ut.makeRotationZ(u),this.applyMatrix4(Ut),this}translate(u,d,v){return Ut.makeTranslation(u,d,v),this.applyMatrix4(Ut),this}scale(u,d,v){return Ut.makeScale(u,d,v),this.applyMatrix4(Ut),this}lookAt(u){return Ft.lookAt(u),Ft.updateMatrix(),this.applyMatrix4(Ft.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(jt).negate(),this.translate(jt.x,jt.y,jt.z),this}setFromPoints(u){var d=this.getAttribute("position");if(void 0===d){for(var v=[],x=0,y=u.length;x<y;x++){var b=u[x];v.push(b.x,b.y,b.z||0)}this.setAttribute("position",new pxlNav_bn(v,3))}else{for(var _=Math.min(u.length,d.count),w=0;w<_;w++){var S=u[w];d.setXYZ(w,S.x,S.y,S.z||0)}u.length>d.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),d.needsUpdate=!0}return this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new pxlNav_Ei);var u=this.attributes.position,d=this.morphAttributes.position;if(u&&u.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new pxlNav_Ii(-1/0,-1/0,-1/0),new pxlNav_Ii(1/0,1/0,1/0));if(void 0!==u){if(this.boundingBox.setFromBufferAttribute(u),d)for(var v=0,x=d.length;v<x;v++){var y=d[v];zt.setFromBufferAttribute(y),this.morphTargetsRelative?(Ht.addVectors(this.boundingBox.min,zt.min),this.boundingBox.expandByPoint(Ht),Ht.addVectors(this.boundingBox.max,zt.max),this.boundingBox.expandByPoint(Ht)):(this.boundingBox.expandByPoint(zt.min),this.boundingBox.expandByPoint(zt.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new pxlNav_Gi);var u=this.attributes.position,d=this.morphAttributes.position;if(u&&u.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new pxlNav_Ii,1/0);if(u){var v=this.boundingSphere.center;if(zt.setFromBufferAttribute(u),d)for(var x=0,y=d.length;x<y;x++){var b=d[x];Gt.setFromBufferAttribute(b),this.morphTargetsRelative?(Ht.addVectors(zt.min,Gt.min),zt.expandByPoint(Ht),Ht.addVectors(zt.max,Gt.max),zt.expandByPoint(Ht)):(zt.expandByPoint(Gt.min),zt.expandByPoint(Gt.max))}zt.getCenter(v);for(var _=0,w=0,S=u.count;w<S;w++)Ht.fromBufferAttribute(u,w),_=Math.max(_,v.distanceToSquared(Ht));if(d)for(var C=0,P=d.length;C<P;C++)for(var A=d[C],T=this.morphTargetsRelative,E=0,D=A.count;E<D;E++)Ht.fromBufferAttribute(A,E),T&&(jt.fromBufferAttribute(u,E),Ht.add(jt)),_=Math.max(_,v.distanceToSquared(Ht));this.boundingSphere.radius=Math.sqrt(_),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){var u=this.index,d=this.attributes;if(null!==u&&void 0!==d.position&&void 0!==d.normal&&void 0!==d.uv){var v=d.position,x=d.normal,y=d.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new pxlNav_cn(new Float32Array(4*v.count),4));for(var b=this.getAttribute("tangent"),_=[],w=[],S=0;S<v.count;S++)_[S]=new pxlNav_Ii,w[S]=new pxlNav_Ii;var C=new pxlNav_Ii,P=new pxlNav_Ii,A=new pxlNav_Ii,T=new pxlNav_Zs,E=new pxlNav_Zs,D=new pxlNav_Zs,I=new pxlNav_Ii,k=new pxlNav_Ii,R=this.groups;0===R.length&&(R=[{start:0,count:u.count}]);for(var O=0,j=R.length;O<j;++O)for(var G=R[O],H=G.start,X=H,q=H+G.count;X<q;X+=3)f(u.getX(X+0),u.getX(X+1),u.getX(X+2));for(var Z=new pxlNav_Ii,J=new pxlNav_Ii,Q=new pxlNav_Ii,K=new pxlNav_Ii,Y=0,$=R.length;Y<$;++Y)for(var ee=R[Y],te=ee.start,ie=te,se=te+ee.count;ie<se;ie+=3)M(u.getX(ie+0)),M(u.getX(ie+1)),M(u.getX(ie+2))}else console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");function f(u,d,x){C.fromBufferAttribute(v,u),P.fromBufferAttribute(v,d),A.fromBufferAttribute(v,x),T.fromBufferAttribute(y,u),E.fromBufferAttribute(y,d),D.fromBufferAttribute(y,x),P.sub(C),A.sub(C),E.sub(T),D.sub(T);var b=1/(E.x*D.y-D.x*E.y);isFinite(b)&&(I.copy(P).multiplyScalar(D.y).addScaledVector(A,-E.y).multiplyScalar(b),k.copy(A).multiplyScalar(E.x).addScaledVector(P,-D.x).multiplyScalar(b),_[u].add(I),_[d].add(I),_[x].add(I),w[u].add(k),w[d].add(k),w[x].add(k))}function M(u){Q.fromBufferAttribute(x,u),K.copy(Q);var d=_[u];Z.copy(d),Z.sub(Q.multiplyScalar(Q.dot(d))).normalize(),J.crossVectors(K,d);var v=J.dot(w[u])<0?-1:1;b.setXYZW(u,Z.x,Z.y,Z.z,v)}}computeVertexNormals(){var u=this.index,d=this.getAttribute("position");if(void 0!==d){var v=this.getAttribute("normal");if(void 0===v)v=new pxlNav_cn(new Float32Array(3*d.count),3),this.setAttribute("normal",v);else for(var x=0,y=v.count;x<y;x++)v.setXYZ(x,0,0,0);var b=new pxlNav_Ii,_=new pxlNav_Ii,w=new pxlNav_Ii,S=new pxlNav_Ii,C=new pxlNav_Ii,P=new pxlNav_Ii,A=new pxlNav_Ii,T=new pxlNav_Ii;if(u)for(var E=0,D=u.count;E<D;E+=3){var I=u.getX(E+0),k=u.getX(E+1),R=u.getX(E+2);b.fromBufferAttribute(d,I),_.fromBufferAttribute(d,k),w.fromBufferAttribute(d,R),A.subVectors(w,_),T.subVectors(b,_),A.cross(T),S.fromBufferAttribute(v,I),C.fromBufferAttribute(v,k),P.fromBufferAttribute(v,R),S.add(A),C.add(A),P.add(A),v.setXYZ(I,S.x,S.y,S.z),v.setXYZ(k,C.x,C.y,C.z),v.setXYZ(R,P.x,P.y,P.z)}else for(var O=0,j=d.count;O<j;O+=3)b.fromBufferAttribute(d,O+0),_.fromBufferAttribute(d,O+1),w.fromBufferAttribute(d,O+2),A.subVectors(w,_),T.subVectors(b,_),A.cross(T),v.setXYZ(O+0,A.x,A.y,A.z),v.setXYZ(O+1,A.x,A.y,A.z),v.setXYZ(O+2,A.x,A.y,A.z);this.normalizeNormals(),v.needsUpdate=!0}}normalizeNormals(){for(var u=this.attributes.normal,d=0,v=u.count;d<v;d++)Ht.fromBufferAttribute(u,d),Ht.normalize(),u.setXYZ(d,Ht.x,Ht.y,Ht.z)}toNonIndexed(){function t(u,d){for(var v=u.array,x=u.itemSize,y=u.normalized,b=new v.constructor(d.length*x),_=0,w=0,S=0,C=d.length;S<C;S++){_=u.isInterleavedBufferAttribute?d[S]*u.data.stride+u.offset:d[S]*x;for(var P=0;P<x;P++)b[w++]=v[_++]}return new pxlNav_cn(b,x,y)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;var u=new pxlNav_zn,d=this.index.array,v=this.attributes;for(var x in v){var y=t(v[x],d);u.setAttribute(x,y)}var b=this.morphAttributes;for(var _ in b){for(var w=[],S=b[_],C=0,P=S.length;C<P;C++){var A=t(S[C],d);w.push(A)}u.morphAttributes[_]=w}u.morphTargetsRelative=this.morphTargetsRelative;for(var T=this.groups,E=0,D=T.length;E<D;E++){var I=T[E];u.addGroup(I.start,I.count,I.materialIndex)}return u}toJSON(){var u={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(u.uuid=this.uuid,u.type=this.type,""!==this.name&&(u.name=this.name),Object.keys(this.userData).length>0&&(u.userData=this.userData),void 0!==this.parameters){var d=this.parameters;for(var v in d)void 0!==d[v]&&(u[v]=d[v]);return u}u.data={attributes:{}};var x=this.index;null!==x&&(u.data.index={type:x.array.constructor.name,array:Array.prototype.slice.call(x.array)});var y=this.attributes;for(var b in y){var _=y[b];u.data.attributes[b]=_.toJSON(u.data)}var w={},S=!1;for(var C in this.morphAttributes){for(var P=this.morphAttributes[C],A=[],T=0,E=P.length;T<E;T++){var D=P[T];A.push(D.toJSON(u.data))}A.length>0&&(w[C]=A,S=!0)}S&&(u.data.morphAttributes=w,u.data.morphTargetsRelative=this.morphTargetsRelative);var I=this.groups;I.length>0&&(u.data.groups=JSON.parse(JSON.stringify(I)));var k=this.boundingSphere;return null!==k&&(u.data.boundingSphere={center:k.center.toArray(),radius:k.radius}),u}clone(){return(new this.constructor).copy(this)}copy(u){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var d={};this.name=u.name;var v=u.index;null!==v&&this.setIndex(v.clone(d));var x=u.attributes;for(var y in x){var b=x[y];this.setAttribute(y,b.clone(d))}var _=u.morphAttributes;for(var w in _){for(var S=[],C=_[w],P=0,A=C.length;P<A;P++)S.push(C[P].clone(d));this.morphAttributes[w]=S}this.morphTargetsRelative=u.morphTargetsRelative;for(var T=u.groups,E=0,D=T.length;E<D;E++){var I=T[E];this.addGroup(I.start,I.count,I.materialIndex)}var k=u.boundingBox;null!==k&&(this.boundingBox=k.clone());var R=u.boundingSphere;return null!==R&&(this.boundingSphere=R.clone()),this.drawRange.start=u.drawRange.start,this.drawRange.count=u.drawRange.count,this.userData=u.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}var Wt=new pxlNav_nr,Xt=new pxlNav_rr,qt=new pxlNav_Gi,Zt=new pxlNav_Ii,Jt=new pxlNav_Ii,Qt=new pxlNav_Ii,Kt=new pxlNav_Ii,Yt=new pxlNav_Ii,$t=new pxlNav_Ii,ei=new pxlNav_Ii,ti=new pxlNav_Ii;class pxlNav_Vn extends pxlNav_Er{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pxlNav_zn,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pxlNav_en;super(),this.isMesh=!0,this.type="Mesh",this.geometry=u,this.material=d,this.updateMorphTargets()}copy(u,d){return super.copy(u,d),void 0!==u.morphTargetInfluences&&(this.morphTargetInfluences=u.morphTargetInfluences.slice()),void 0!==u.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},u.morphTargetDictionary)),this.material=Array.isArray(u.material)?u.material.slice():u.material,this.geometry=u.geometry,this}updateMorphTargets(){var u=this.geometry.morphAttributes,d=Object.keys(u);if(d.length>0){var v=u[d[0]];if(void 0!==v){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var x=0,y=v.length;x<y;x++){var b=v[x].name||String(x);this.morphTargetInfluences.push(0),this.morphTargetDictionary[b]=x}}}}getVertexPosition(u,d){var v=this.geometry,x=v.attributes.position,y=v.morphAttributes.position,b=v.morphTargetsRelative;d.fromBufferAttribute(x,u);var _=this.morphTargetInfluences;if(y&&_){$t.set(0,0,0);for(var w=0,S=y.length;w<S;w++){var C=_[w],P=y[w];0!==C&&(Yt.fromBufferAttribute(P,u),b?$t.addScaledVector(Yt,C):$t.addScaledVector(Yt.sub(d),C))}d.add($t)}return d}raycast(u,d){var v=this.geometry,x=this.material,y=this.matrixWorld;if(void 0!==x){if(null===v.boundingSphere&&v.computeBoundingSphere(),qt.copy(v.boundingSphere),qt.applyMatrix4(y),Xt.copy(u.ray).recast(u.near),!1===qt.containsPoint(Xt.origin)){if(null===Xt.intersectSphere(qt,Zt))return;if(Xt.origin.distanceToSquared(Zt)>(u.far-u.near)**2)return}Wt.copy(y).invert(),Xt.copy(u.ray).applyMatrix4(Wt),null!==v.boundingBox&&!1===Xt.intersectsBox(v.boundingBox)||this._computeIntersections(u,d,Xt)}}_computeIntersections(u,d,v){var x,y=this.geometry,b=this.material,_=y.index,w=y.attributes.position,S=y.attributes.uv,C=y.attributes.uv1,P=y.attributes.normal,A=y.groups,T=y.drawRange;if(null!==_)if(Array.isArray(b))for(var E=0,D=A.length;E<D;E++)for(var I=A[E],k=b[I.materialIndex],R=Math.max(I.start,T.start),O=Math.min(_.count,Math.min(I.start+I.count,T.start+T.count));R<O;R+=3)(x=pxlNav_Wn(this,k,u,v,S,C,P,_.getX(R),_.getX(R+1),_.getX(R+2)))&&(x.faceIndex=Math.floor(R/3),x.face.materialIndex=I.materialIndex,d.push(x));else for(var j=Math.max(0,T.start),G=Math.min(_.count,T.start+T.count);j<G;j+=3)(x=pxlNav_Wn(this,b,u,v,S,C,P,_.getX(j),_.getX(j+1),_.getX(j+2)))&&(x.faceIndex=Math.floor(j/3),d.push(x));else if(void 0!==w)if(Array.isArray(b))for(var H=0,X=A.length;H<X;H++)for(var q=A[H],Z=b[q.materialIndex],J=Math.max(q.start,T.start),Q=Math.min(w.count,Math.min(q.start+q.count,T.start+T.count));J<Q;J+=3)(x=pxlNav_Wn(this,Z,u,v,S,C,P,J,J+1,J+2))&&(x.faceIndex=Math.floor(J/3),x.face.materialIndex=q.materialIndex,d.push(x));else for(var K=Math.max(0,T.start),Y=Math.min(w.count,T.start+T.count);K<Y;K+=3)(x=pxlNav_Wn(this,b,u,v,S,C,P,K,K+1,K+2))&&(x.faceIndex=Math.floor(K/3),d.push(x))}}function pxlNav_Wn(u,d,v,x,y,b,_,w,S,C){u.getVertexPosition(w,Jt),u.getVertexPosition(S,Qt),u.getVertexPosition(C,Kt);var P=function(u,d,v,x,y,b,_,w){if(null===(1===d.side?x.intersectTriangle(_,b,y,!0,w):x.intersectTriangle(y,b,_,0===d.side,w)))return null;ti.copy(w),ti.applyMatrix4(u.matrixWorld);var S=v.ray.origin.distanceTo(ti);return S<v.near||S>v.far?null:{distance:S,point:ti.clone(),object:u}}(u,d,v,x,Jt,Qt,Kt,ei);if(P){var A=new pxlNav_Ii;pxlNav_Jr.getBarycoord(ei,Jt,Qt,Kt,A),y&&(P.uv=pxlNav_Jr.getInterpolatedAttribute(y,w,S,C,A,new pxlNav_Zs)),b&&(P.uv1=pxlNav_Jr.getInterpolatedAttribute(b,w,S,C,A,new pxlNav_Zs)),_&&(P.normal=pxlNav_Jr.getInterpolatedAttribute(_,w,S,C,A,new pxlNav_Ii),P.normal.dot(x.direction)>0&&P.normal.multiplyScalar(-1));var T={a:w,b:S,c:C,normal:new pxlNav_Ii,materialIndex:0};pxlNav_Jr.getNormal(Jt,Qt,Kt,T.normal),P.face=T,P.barycoord=A}return P}class pxlNav_Un extends pxlNav_zn{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;super(),this.type="BoxGeometry",this.parameters={width:u,height:d,depth:v,widthSegments:x,heightSegments:y,depthSegments:b};var _=this;x=Math.floor(x),y=Math.floor(y),b=Math.floor(b);var w=[],S=[],C=[],P=[],A=0,T=0;function p(u,d,v,x,y,b,E,D,I,k,R){for(var O=b/I,j=E/k,G=b/2,H=E/2,X=D/2,q=I+1,Z=k+1,J=0,Q=0,K=new pxlNav_Ii,Y=0;Y<Z;Y++)for(var $=Y*j-H,ee=0;ee<q;ee++){var te=ee*O-G;K[u]=te*x,K[d]=$*y,K[v]=X,S.push(K.x,K.y,K.z),K[u]=0,K[d]=0,K[v]=D>0?1:-1,C.push(K.x,K.y,K.z),P.push(ee/I),P.push(1-Y/k),J+=1}for(var ie=0;ie<k;ie++)for(var se=0;se<I;se++){var re=A+se+q*ie,ae=A+se+q*(ie+1),ne=A+(se+1)+q*(ie+1),oe=A+(se+1)+q*ie;w.push(re,ae,oe),w.push(ae,ne,oe),Q+=6}_.addGroup(T,Q,R),T+=Q,A+=J}p("z","y","x",-1,-1,v,d,u,b,y,0),p("z","y","x",1,-1,v,d,-u,b,y,1),p("x","z","y",1,1,u,v,d,x,b,2),p("x","z","y",1,-1,u,v,-d,x,b,3),p("x","y","z",1,-1,u,d,v,x,y,4),p("x","y","z",-1,-1,u,d,-v,x,y,5),this.setIndex(w),this.setAttribute("position",new pxlNav_bn(S,3)),this.setAttribute("normal",new pxlNav_bn(C,3)),this.setAttribute("uv",new pxlNav_bn(P,2))}copy(u){return super.copy(u),this.parameters=Object.assign({},u.parameters),this}static fromJSON(u){return new pxlNav_Un(u.width,u.height,u.depth,u.widthSegments,u.heightSegments,u.depthSegments)}}class pxlNav_Xn extends pxlNav_Er{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new pxlNav_nr,this.projectionMatrix=new pxlNav_nr,this.projectionMatrixInverse=new pxlNav_nr,this.coordinateSystem=ue}copy(u,d){return super.copy(u,d),this.matrixWorldInverse.copy(u.matrixWorldInverse),this.projectionMatrix.copy(u.projectionMatrix),this.projectionMatrixInverse.copy(u.projectionMatrixInverse),this.coordinateSystem=u.coordinateSystem,this}getWorldDirection(u){return super.getWorldDirection(u).negate()}updateMatrixWorld(u){super.updateMatrixWorld(u),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(u,d){super.updateWorldMatrix(u,d),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}var ii=new pxlNav_Ii,si=new pxlNav_Zs,ri=new pxlNav_Zs;class pxlNav_$n extends pxlNav_Xn{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=u,this.zoom=1,this.near=v,this.far=x,this.focus=10,this.aspect=d,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(u,d){return super.copy(u,d),this.fov=u.fov,this.zoom=u.zoom,this.near=u.near,this.far=u.far,this.focus=u.focus,this.aspect=u.aspect,this.view=null===u.view?null:Object.assign({},u.view),this.filmGauge=u.filmGauge,this.filmOffset=u.filmOffset,this}setFocalLength(u){var d=.5*this.getFilmHeight()/u;this.fov=2*ve*Math.atan(d),this.updateProjectionMatrix()}getFocalLength(){var u=Math.tan(.5*de*this.fov);return.5*this.getFilmHeight()/u}getEffectiveFOV(){return 2*ve*Math.atan(Math.tan(.5*de*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(u,d,v){ii.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),d.set(ii.x,ii.y).multiplyScalar(-u/ii.z),ii.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),v.set(ii.x,ii.y).multiplyScalar(-u/ii.z)}getViewSize(u,d){return this.getViewBounds(u,si,ri),d.subVectors(ri,si)}setViewOffset(u,d,v,x,y,b){this.aspect=u/d,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=u,this.view.fullHeight=d,this.view.offsetX=v,this.view.offsetY=x,this.view.width=y,this.view.height=b,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){var u=this.near,d=u*Math.tan(.5*de*this.fov)/this.zoom,v=2*d,x=this.aspect*v,y=-.5*x,b=this.view;if(null!==this.view&&this.view.enabled){var _=b.fullWidth,w=b.fullHeight;y+=b.offsetX*x/_,d-=b.offsetY*v/w,x*=b.width/_,v*=b.height/w}var S=this.filmOffset;0!==S&&(y+=u*S/this.getFilmWidth()),this.projectionMatrix.makePerspective(y,y+x,d,d-v,u,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(u){var d=super.toJSON(u);return d.object.fov=this.fov,d.object.zoom=this.zoom,d.object.near=this.near,d.object.far=this.far,d.object.focus=this.focus,d.object.aspect=this.aspect,null!==this.view&&(d.object.view=Object.assign({},this.view)),d.object.filmGauge=this.filmGauge,d.object.filmOffset=this.filmOffset,d}}new pxlNav_Ii;new pxlNav_Ii,new pxlNav_Ii,new pxlNav_Ii,new pxlNav_Zs,new pxlNav_Zs,new pxlNav_nr,new pxlNav_Ii,new pxlNav_Ii,new pxlNav_Ii,new pxlNav_Zs,new pxlNav_Zs,new pxlNav_Zs;new pxlNav_Ii,new pxlNav_Ii;var ai=new pxlNav_Ii,ni=new pxlNav_wi,oi=new pxlNav_wi,li=new pxlNav_Ii,hi=new pxlNav_nr,ui=new pxlNav_Ii,ci=new pxlNav_Gi,di=new pxlNav_nr,vi=new pxlNav_rr;class pxlNav_No extends pxlNav_Vn{constructor(u,d){super(u,d),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=X,this.bindMatrix=new pxlNav_nr,this.bindMatrixInverse=new pxlNav_nr,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){var u=this.geometry;null===this.boundingBox&&(this.boundingBox=new pxlNav_Ei),this.boundingBox.makeEmpty();for(var d=u.getAttribute("position"),v=0;v<d.count;v++)this.getVertexPosition(v,ui),this.boundingBox.expandByPoint(ui)}computeBoundingSphere(){var u=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new pxlNav_Gi),this.boundingSphere.makeEmpty();for(var d=u.getAttribute("position"),v=0;v<d.count;v++)this.getVertexPosition(v,ui),this.boundingSphere.expandByPoint(ui)}copy(u,d){return super.copy(u,d),this.bindMode=u.bindMode,this.bindMatrix.copy(u.bindMatrix),this.bindMatrixInverse.copy(u.bindMatrixInverse),this.skeleton=u.skeleton,null!==u.boundingBox&&(this.boundingBox=u.boundingBox.clone()),null!==u.boundingSphere&&(this.boundingSphere=u.boundingSphere.clone()),this}raycast(u,d){var v=this.material,x=this.matrixWorld;void 0!==v&&(null===this.boundingSphere&&this.computeBoundingSphere(),ci.copy(this.boundingSphere),ci.applyMatrix4(x),!1!==u.ray.intersectsSphere(ci)&&(di.copy(x).invert(),vi.copy(u.ray).applyMatrix4(di),null!==this.boundingBox&&!1===vi.intersectsBox(this.boundingBox)||this._computeIntersections(u,d,vi)))}getVertexPosition(u,d){return super.getVertexPosition(u,d),this.applyBoneTransform(u,d),d}bind(u,d){this.skeleton=u,void 0===d&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),d=this.matrixWorld),this.bindMatrix.copy(d),this.bindMatrixInverse.copy(d).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){for(var u=new pxlNav_wi,d=this.geometry.attributes.skinWeight,v=0,x=d.count;v<x;v++){u.fromBufferAttribute(d,v);var y=1/u.manhattanLength();y!==1/0?u.multiplyScalar(y):u.set(1,0,0,0),d.setXYZW(v,u.x,u.y,u.z,u.w)}}updateMatrixWorld(u){super.updateMatrixWorld(u),this.bindMode===X?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(u,d){var v=this.skeleton,x=this.geometry;ni.fromBufferAttribute(x.attributes.skinIndex,u),oi.fromBufferAttribute(x.attributes.skinWeight,u),ai.copy(d).applyMatrix4(this.bindMatrix),d.set(0,0,0);for(var y=0;y<4;y++){var b=oi.getComponent(y);if(0!==b){var _=ni.getComponent(y);hi.multiplyMatrices(v.bones[_].matrixWorld,v.boneInverses[_]),d.addScaledVector(li.copy(ai).applyMatrix4(hi),b)}}return d.applyMatrix4(this.bindMatrixInverse)}}class pxlNav_Lo extends pxlNav_Er{constructor(){super(),this.isBone=!0,this.type="Bone"}}class pxlNav_Vo extends pxlNav_vi{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(null,arguments.length>5?arguments[5]:void 0,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:1003,arguments.length>9&&void 0!==arguments[9]?arguments[9]:1003,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>10?arguments[10]:void 0,arguments.length>11?arguments[11]:void 0),this.isDataTexture=!0,this.image={data:u,width:d,height:v},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}var mi=new pxlNav_nr,xi=new pxlNav_nr;class pxlNav_jo{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.uuid=pxlNav_js(),this.bones=u.slice(0),this.boneInverses=d,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){var u=this.bones,d=this.boneInverses;if(this.boneMatrices=new Float32Array(16*u.length),0===d.length)this.calculateInverses();else if(u.length!==d.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(var v=0,x=this.bones.length;v<x;v++)this.boneInverses.push(new pxlNav_nr)}}calculateInverses(){this.boneInverses.length=0;for(var u=0,d=this.bones.length;u<d;u++){var v=new pxlNav_nr;this.bones[u]&&v.copy(this.bones[u].matrixWorld).invert(),this.boneInverses.push(v)}}pose(){for(var u=0,d=this.bones.length;u<d;u++){var v=this.bones[u];v&&v.matrixWorld.copy(this.boneInverses[u]).invert()}for(var x=0,y=this.bones.length;x<y;x++){var b=this.bones[x];b&&(b.parent&&b.parent.isBone?(b.matrix.copy(b.parent.matrixWorld).invert(),b.matrix.multiply(b.matrixWorld)):b.matrix.copy(b.matrixWorld),b.matrix.decompose(b.position,b.quaternion,b.scale))}}update(){for(var u=this.bones,d=this.boneInverses,v=this.boneMatrices,x=this.boneTexture,y=0,b=u.length;y<b;y++){var _=u[y]?u[y].matrixWorld:xi;mi.multiplyMatrices(_,d[y]),mi.toArray(v,16*y)}null!==x&&(x.needsUpdate=!0)}clone(){return new pxlNav_jo(this.bones,this.boneInverses)}computeBoneTexture(){var u=Math.sqrt(4*this.bones.length);u=4*Math.ceil(u/4),u=Math.max(u,4);var d=new Float32Array(u*u*4);d.set(this.boneMatrices);var v=new pxlNav_Vo(d,u,u,K,Q);return v.needsUpdate=!0,this.boneMatrices=d,this.boneTexture=v,this}getBoneByName(u){for(var d=0,v=this.bones.length;d<v;d++){var x=this.bones[d];if(x.name===u)return x}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(u,d){this.uuid=u.uuid;for(var v=0,x=u.bones.length;v<x;v++){var y=u.bones[v],b=d[y];void 0===b&&(console.warn("THREE.Skeleton: No bone found with UUID:",y),b=new pxlNav_Lo),this.bones.push(b),this.boneInverses.push((new pxlNav_nr).fromArray(u.boneInverses[v]))}return this.init(),this}toJSON(){var u={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};u.uuid=this.uuid;for(var d=this.bones,v=this.boneInverses,x=0,y=d.length;x<y;x++){var b=d[x];u.bones.push(b.uuid);var _=v[x];u.boneInverses.push(_.toArray())}return u}}new pxlNav_nr,new pxlNav_nr,new pxlNav_Ei,new pxlNav_nr,new pxlNav_Vn,new pxlNav_Gi;var gi=new pxlNav_Ii,fi=new pxlNav_Ii,yi=new pxlNav_Gs;class pxlNav_ea{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pxlNav_Ii(1,0,0),d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.isPlane=!0,this.normal=u,this.constant=d}set(u,d){return this.normal.copy(u),this.constant=d,this}setComponents(u,d,v,x){return this.normal.set(u,d,v),this.constant=x,this}setFromNormalAndCoplanarPoint(u,d){return this.normal.copy(u),this.constant=-d.dot(this.normal),this}setFromCoplanarPoints(u,d,v){var x=gi.subVectors(v,d).cross(fi.subVectors(u,d)).normalize();return this.setFromNormalAndCoplanarPoint(x,u),this}copy(u){return this.normal.copy(u.normal),this.constant=u.constant,this}normalize(){var u=1/this.normal.length();return this.normal.multiplyScalar(u),this.constant*=u,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(u){return this.normal.dot(u)+this.constant}distanceToSphere(u){return this.distanceToPoint(u.center)-u.radius}projectPoint(u,d){return d.copy(u).addScaledVector(this.normal,-this.distanceToPoint(u))}intersectLine(u,d){var v=u.delta(gi),x=this.normal.dot(v);if(0===x)return 0===this.distanceToPoint(u.start)?d.copy(u.start):null;var y=-(u.start.dot(this.normal)+this.constant)/x;return y<0||y>1?null:d.copy(u.start).addScaledVector(v,y)}intersectsLine(u){var d=this.distanceToPoint(u.start),v=this.distanceToPoint(u.end);return d<0&&v>0||v<0&&d>0}intersectsBox(u){return u.intersectsPlane(this)}intersectsSphere(u){return u.intersectsPlane(this)}coplanarPoint(u){return u.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(u,d){var v=d||yi.getNormalMatrix(u),x=this.coplanarPoint(gi).applyMatrix4(u),y=this.normal.applyMatrix3(v).normalize();return this.constant=-x.dot(y),this}translate(u){return this.constant-=u.dot(this.normal),this}equals(u){return u.normal.equals(this.normal)&&u.constant===this.constant}clone(){return(new this.constructor).copy(this)}}var bi=new pxlNav_Gi,_i=new pxlNav_Ii;class pxlNav_ra{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pxlNav_ea,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pxlNav_ea,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new pxlNav_ea,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new pxlNav_ea,y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new pxlNav_ea,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new pxlNav_ea;this.planes=[u,d,v,x,y,b]}set(u,d,v,x,y,b){var _=this.planes;return _[0].copy(u),_[1].copy(d),_[2].copy(v),_[3].copy(x),_[4].copy(y),_[5].copy(b),this}copy(u){for(var d=this.planes,v=0;v<6;v++)d[v].copy(u.planes[v]);return this}setFromProjectionMatrix(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3,v=this.planes,x=u.elements,y=x[0],b=x[1],_=x[2],w=x[3],S=x[4],C=x[5],P=x[6],A=x[7],T=x[8],E=x[9],D=x[10],I=x[11],k=x[12],R=x[13],O=x[14],j=x[15];if(v[0].setComponents(w-y,A-S,I-T,j-k).normalize(),v[1].setComponents(w+y,A+S,I+T,j+k).normalize(),v[2].setComponents(w+b,A+C,I+E,j+R).normalize(),v[3].setComponents(w-b,A-C,I-E,j-R).normalize(),v[4].setComponents(w-_,A-P,I-D,j-O).normalize(),d===ue)v[5].setComponents(w+_,A+P,I+D,j+O).normalize();else{if(d!==ce)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+d);v[5].setComponents(_,P,D,O).normalize()}return this}intersectsObject(u){if(void 0!==u.boundingSphere)null===u.boundingSphere&&u.computeBoundingSphere(),bi.copy(u.boundingSphere).applyMatrix4(u.matrixWorld);else{var d=u.geometry;null===d.boundingSphere&&d.computeBoundingSphere(),bi.copy(d.boundingSphere).applyMatrix4(u.matrixWorld)}return this.intersectsSphere(bi)}intersectsSprite(u){return bi.center.set(0,0,0),bi.radius=.7071067811865476,bi.applyMatrix4(u.matrixWorld),this.intersectsSphere(bi)}intersectsSphere(u){for(var d=this.planes,v=u.center,x=-u.radius,y=0;y<6;y++)if(d[y].distanceToPoint(v)<x)return!1;return!0}intersectsBox(u){for(var d=this.planes,v=0;v<6;v++){var x=d[v];if(_i.x=x.normal.x>0?u.max.x:u.min.x,_i.y=x.normal.y>0?u.max.y:u.min.y,_i.z=x.normal.z>0?u.max.z:u.min.z,x.distanceToPoint(_i)<0)return!1}return!0}containsPoint(u){for(var d=this.planes,v=0;v<6;v++)if(d[v].distanceToPoint(u)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}new pxlNav_nr,new pxlNav_$r(1,1,1),new pxlNav_ra,new pxlNav_Ei,new pxlNav_Gi,new pxlNav_Ii,new pxlNav_Ii,new pxlNav_Ii,new class pxlNav_ha{constructor(){this.index=0,this.pool=[],this.list=[]}push(u,d,v,x){var y=this.pool,b=this.list;this.index>=y.length&&y.push({start:-1,count:-1,z:-1,index:-1});var _=y[this.index];b.push(_),this.index++,_.start=u,_.count=d,_.z=v,_.index=x}reset(){this.list.length=0,this.index=0}},new pxlNav_Vn;class pxlNav_Sa extends pxlNav_tn{constructor(u){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new pxlNav_$r(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(u)}copy(u){return super.copy(u),this.color.copy(u.color),this.map=u.map,this.linewidth=u.linewidth,this.linecap=u.linecap,this.linejoin=u.linejoin,this.fog=u.fog,this}}var wi=new pxlNav_Ii,Si=new pxlNav_Ii,Ci=new pxlNav_nr,Ni=new pxlNav_rr,Pi=new pxlNav_Gi,Mi=new pxlNav_Ii,Ai=new pxlNav_Ii;class pxlNav_ka extends pxlNav_Er{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pxlNav_zn,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pxlNav_Sa;super(),this.isLine=!0,this.type="Line",this.geometry=u,this.material=d,this.updateMorphTargets()}copy(u,d){return super.copy(u,d),this.material=Array.isArray(u.material)?u.material.slice():u.material,this.geometry=u.geometry,this}computeLineDistances(){var u=this.geometry;if(null===u.index){for(var d=u.attributes.position,v=[0],x=1,y=d.count;x<y;x++)wi.fromBufferAttribute(d,x-1),Si.fromBufferAttribute(d,x),v[x]=v[x-1],v[x]+=wi.distanceTo(Si);u.setAttribute("lineDistance",new pxlNav_bn(v,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(u,d){var v=this.geometry,x=this.matrixWorld,y=u.params.Line.threshold,b=v.drawRange;if(null===v.boundingSphere&&v.computeBoundingSphere(),Pi.copy(v.boundingSphere),Pi.applyMatrix4(x),Pi.radius+=y,!1!==u.ray.intersectsSphere(Pi)){Ci.copy(x).invert(),Ni.copy(u.ray).applyMatrix4(Ci);var _=y/((this.scale.x+this.scale.y+this.scale.z)/3),w=_*_,S=this.isLineSegments?2:1,C=v.index,P=v.attributes.position;if(null!==C){for(var A=Math.max(0,b.start),T=Math.min(C.count,b.start+b.count),E=A,D=T-1;E<D;E+=S){var I=C.getX(E),k=C.getX(E+1),R=pxlNav_Ea(this,u,Ni,w,I,k);R&&d.push(R)}if(this.isLineLoop){var O=C.getX(T-1),j=C.getX(A),G=pxlNav_Ea(this,u,Ni,w,O,j);G&&d.push(G)}}else{for(var H=Math.max(0,b.start),X=Math.min(P.count,b.start+b.count),q=H,Z=X-1;q<Z;q+=S){var J=pxlNav_Ea(this,u,Ni,w,q,q+1);J&&d.push(J)}if(this.isLineLoop){var Q=pxlNav_Ea(this,u,Ni,w,X-1,H);Q&&d.push(Q)}}}}updateMorphTargets(){var u=this.geometry.morphAttributes,d=Object.keys(u);if(d.length>0){var v=u[d[0]];if(void 0!==v){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var x=0,y=v.length;x<y;x++){var b=v[x].name||String(x);this.morphTargetInfluences.push(0),this.morphTargetDictionary[b]=x}}}}}function pxlNav_Ea(u,d,v,x,y,b){var _=u.geometry.attributes.position;if(wi.fromBufferAttribute(_,y),Si.fromBufferAttribute(_,b),!(v.distanceSqToSegment(wi,Si,Mi,Ai)>x)){Mi.applyMatrix4(u.matrixWorld);var w=d.ray.origin.distanceTo(Mi);return w<d.near||w>d.far?void 0:{distance:w,point:Ai.clone().applyMatrix4(u.matrixWorld),index:y,face:null,faceIndex:null,barycoord:null,object:u}}}new pxlNav_Ii,new pxlNav_Ii;new pxlNav_nr,new pxlNav_rr,new pxlNav_Gi,new pxlNav_Ii;class pxlNav_Ha extends pxlNav_Er{constructor(){super(),this.isGroup=!0,this.type="Group"}}class pxlNav_Qa{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(u,d){var v=this.getUtoTmapping(u);return this.getPoint(v,d)}getPoints(){for(var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,d=[],v=0;v<=u;v++)d.push(this.getPoint(v/u));return d}getSpacedPoints(){for(var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,d=[],v=0;v<=u;v++)d.push(this.getPointAt(v/u));return d}getLength(){var u=this.getLengths();return u[u.length-1]}getLengths(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===u+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var d,v=[],x=this.getPoint(0),y=0;v.push(0);for(var b=1;b<=u;b++)y+=(d=this.getPoint(b/u)).distanceTo(x),v.push(y),x=d;return this.cacheArcLengths=v,v}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(u,d){var v,x=this.getLengths(),y=0,b=x.length;v=d||u*x[b-1];for(var _,w=0,S=b-1;w<=S;)if((_=x[y=Math.floor(w+(S-w)/2)]-v)<0)w=y+1;else{if(!(_>0)){S=y;break}S=y-1}if(x[y=S]===v)return y/(b-1);var C=x[y];return(y+(v-C)/(x[y+1]-C))/(b-1)}getTangent(u,d){var v=1e-4,x=u-v,y=u+v;x<0&&(x=0),y>1&&(y=1);var b=this.getPoint(x),_=this.getPoint(y),w=d||(b.isVector2?new pxlNav_Zs:new pxlNav_Ii);return w.copy(_).sub(b).normalize(),w}getTangentAt(u,d){var v=this.getUtoTmapping(u);return this.getTangent(v,d)}computeFrenetFrames(u,d){for(var v=new pxlNav_Ii,x=[],y=[],b=[],_=new pxlNav_Ii,w=new pxlNav_nr,S=0;S<=u;S++){var C=S/u;x[S]=this.getTangentAt(C,new pxlNav_Ii)}y[0]=new pxlNav_Ii,b[0]=new pxlNav_Ii;var P=Number.MAX_VALUE,A=Math.abs(x[0].x),T=Math.abs(x[0].y),E=Math.abs(x[0].z);A<=P&&(P=A,v.set(1,0,0)),T<=P&&(P=T,v.set(0,1,0)),E<=P&&v.set(0,0,1),_.crossVectors(x[0],v).normalize(),y[0].crossVectors(x[0],_),b[0].crossVectors(x[0],y[0]);for(var D=1;D<=u;D++){if(y[D]=y[D-1].clone(),b[D]=b[D-1].clone(),_.crossVectors(x[D-1],x[D]),_.length()>Number.EPSILON){_.normalize();var I=Math.acos(pxlNav_Ds(x[D-1].dot(x[D]),-1,1));y[D].applyMatrix4(w.makeRotationAxis(_,I))}b[D].crossVectors(x[D],y[D])}if(!0===d){var k=Math.acos(pxlNav_Ds(y[0].dot(y[u]),-1,1));k/=u,x[0].dot(_.crossVectors(y[0],y[u]))>0&&(k=-k);for(var R=1;R<=u;R++)y[R].applyMatrix4(w.makeRotationAxis(x[R],k*R)),b[R].crossVectors(x[R],y[R])}return{tangents:x,normals:y,binormals:b}}clone(){return(new this.constructor).copy(this)}copy(u){return this.arcLengthDivisions=u.arcLengthDivisions,this}toJSON(){var u={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return u.arcLengthDivisions=this.arcLengthDivisions,u.type=this.type,u}fromJSON(u){return this.arcLengthDivisions=u.arcLengthDivisions,this}}class pxlNav_Ka extends pxlNav_Qa{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI,_=arguments.length>6&&void 0!==arguments[6]&&arguments[6],w=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=u,this.aY=d,this.xRadius=v,this.yRadius=x,this.aStartAngle=y,this.aEndAngle=b,this.aClockwise=_,this.aRotation=w}getPoint(u){for(var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pxlNav_Zs,v=2*Math.PI,x=this.aEndAngle-this.aStartAngle,y=Math.abs(x)<Number.EPSILON;x<0;)x+=v;for(;x>v;)x-=v;x<Number.EPSILON&&(x=y?0:v),!0!==this.aClockwise||y||(x===v?x=-v:x-=v);var b=this.aStartAngle+u*x,_=this.aX+this.xRadius*Math.cos(b),w=this.aY+this.yRadius*Math.sin(b);if(0!==this.aRotation){var S=Math.cos(this.aRotation),C=Math.sin(this.aRotation),P=_-this.aX,A=w-this.aY;_=P*S-A*C+this.aX,w=P*C+A*S+this.aY}return d.set(_,w)}copy(u){return super.copy(u),this.aX=u.aX,this.aY=u.aY,this.xRadius=u.xRadius,this.yRadius=u.yRadius,this.aStartAngle=u.aStartAngle,this.aEndAngle=u.aEndAngle,this.aClockwise=u.aClockwise,this.aRotation=u.aRotation,this}toJSON(){var u=super.toJSON();return u.aX=this.aX,u.aY=this.aY,u.xRadius=this.xRadius,u.yRadius=this.yRadius,u.aStartAngle=this.aStartAngle,u.aEndAngle=this.aEndAngle,u.aClockwise=this.aClockwise,u.aRotation=this.aRotation,u}fromJSON(u){return super.fromJSON(u),this.aX=u.aX,this.aY=u.aY,this.xRadius=u.xRadius,this.yRadius=u.yRadius,this.aStartAngle=u.aStartAngle,this.aEndAngle=u.aEndAngle,this.aClockwise=u.aClockwise,this.aRotation=u.aRotation,this}}function pxlNav_eh(){var u=0,d=0,v=0,x=0;function r(y,b,_,w){u=y,d=_,v=-3*y+3*b-2*_-w,x=2*y-2*b+_+w}return{initCatmullRom:function initCatmullRom(u,d,v,x,y){r(d,v,y*(v-u),y*(x-d))},initNonuniformCatmullRom:function initNonuniformCatmullRom(u,d,v,x,y,b,_){var w=(d-u)/y-(v-u)/(y+b)+(v-d)/b,S=(v-d)/b-(x-d)/(b+_)+(x-v)/_;r(d,v,w*=b,S*=b)},calc:function calc(y){var b=y*y;return u+d*y+v*b+x*(b*y)}}}var Ti=new pxlNav_Ii,Ei=new pxlNav_eh,Di=new pxlNav_eh,Ii=new pxlNav_eh;function pxlNav_ah(u,d,v,x,y){var b=.5*(x-d),_=.5*(y-v),w=u*u;return(2*v-2*x+b+_)*(u*w)+(-3*v+3*x-2*b-_)*w+b*u+v}function pxlNav_hh(u,d,v,x){return function(u,d){var v=1-u;return v*v*d}(u,d)+function(u,d){return 2*(1-u)*u*d}(u,v)+function(u,d){return u*u*d}(u,x)}function pxlNav_lh(u,d,v,x,y){return function(u,d){var v=1-u;return v*v*v*d}(u,d)+function(u,d){var v=1-u;return 3*v*v*u*d}(u,v)+function(u,d){return 3*(1-u)*u*u*d}(u,x)+function(u,d){return u*u*u*d}(u,y)}class pxlNav_ch extends pxlNav_Qa{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pxlNav_Zs,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pxlNav_Zs,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new pxlNav_Zs,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new pxlNav_Zs;super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=u,this.v1=d,this.v2=v,this.v3=x}getPoint(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pxlNav_Zs,v=this.v0,x=this.v1,y=this.v2,b=this.v3;return d.set(pxlNav_lh(u,v.x,x.x,y.x,b.x),pxlNav_lh(u,v.y,x.y,y.y,b.y)),d}copy(u){return super.copy(u),this.v0.copy(u.v0),this.v1.copy(u.v1),this.v2.copy(u.v2),this.v3.copy(u.v3),this}toJSON(){var u=super.toJSON();return u.v0=this.v0.toArray(),u.v1=this.v1.toArray(),u.v2=this.v2.toArray(),u.v3=this.v3.toArray(),u}fromJSON(u){return super.fromJSON(u),this.v0.fromArray(u.v0),this.v1.fromArray(u.v1),this.v2.fromArray(u.v2),this.v3.fromArray(u.v3),this}}class pxlNav_dh extends pxlNav_Qa{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pxlNav_Zs,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pxlNav_Zs;super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=u,this.v2=d}getPoint(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pxlNav_Zs;return 1===u?d.copy(this.v2):(d.copy(this.v2).sub(this.v1),d.multiplyScalar(u).add(this.v1)),d}getPointAt(u,d){return this.getPoint(u,d)}getTangent(u){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pxlNav_Zs).subVectors(this.v2,this.v1).normalize()}getTangentAt(u,d){return this.getTangent(u,d)}copy(u){return super.copy(u),this.v1.copy(u.v1),this.v2.copy(u.v2),this}toJSON(){var u=super.toJSON();return u.v1=this.v1.toArray(),u.v2=this.v2.toArray(),u}fromJSON(u){return super.fromJSON(u),this.v1.fromArray(u.v1),this.v2.fromArray(u.v2),this}}class pxlNav_mh extends pxlNav_Qa{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pxlNav_Zs,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pxlNav_Zs,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new pxlNav_Zs;super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=u,this.v1=d,this.v2=v}getPoint(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pxlNav_Zs,v=this.v0,x=this.v1,y=this.v2;return d.set(pxlNav_hh(u,v.x,x.x,y.x),pxlNav_hh(u,v.y,x.y,y.y)),d}copy(u){return super.copy(u),this.v0.copy(u.v0),this.v1.copy(u.v1),this.v2.copy(u.v2),this}toJSON(){var u=super.toJSON();return u.v0=this.v0.toArray(),u.v1=this.v1.toArray(),u.v2=this.v2.toArray(),u}fromJSON(u){return super.fromJSON(u),this.v0.fromArray(u.v0),this.v1.fromArray(u.v1),this.v2.fromArray(u.v2),this}}class pxlNav_yh extends pxlNav_Qa{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pxlNav_Ii,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pxlNav_Ii,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new pxlNav_Ii;super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=u,this.v1=d,this.v2=v}getPoint(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pxlNav_Ii,v=this.v0,x=this.v1,y=this.v2;return d.set(pxlNav_hh(u,v.x,x.x,y.x),pxlNav_hh(u,v.y,x.y,y.y),pxlNav_hh(u,v.z,x.z,y.z)),d}copy(u){return super.copy(u),this.v0.copy(u.v0),this.v1.copy(u.v1),this.v2.copy(u.v2),this}toJSON(){var u=super.toJSON();return u.v0=this.v0.toArray(),u.v1=this.v1.toArray(),u.v2=this.v2.toArray(),u}fromJSON(u){return super.fromJSON(u),this.v0.fromArray(u.v0),this.v1.fromArray(u.v1),this.v2.fromArray(u.v2),this}}class pxlNav_fh extends pxlNav_Qa{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=u}getPoint(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pxlNav_Zs,v=this.points,x=(v.length-1)*u,y=Math.floor(x),b=x-y,_=v[0===y?y:y-1],w=v[y],S=v[y>v.length-2?v.length-1:y+1],C=v[y>v.length-3?v.length-1:y+2];return d.set(pxlNav_ah(b,_.x,w.x,S.x,C.x),pxlNav_ah(b,_.y,w.y,S.y,C.y)),d}copy(u){super.copy(u),this.points=[];for(var d=0,v=u.points.length;d<v;d++){var x=u.points[d];this.points.push(x.clone())}return this}toJSON(){var u=super.toJSON();u.points=[];for(var d=0,v=this.points.length;d<v;d++){var x=this.points[d];u.points.push(x.toArray())}return u}fromJSON(u){super.fromJSON(u),this.points=[];for(var d=0,v=u.points.length;d<v;d++){var x=u.points[d];this.points.push((new pxlNav_Zs).fromArray(x))}return this}}var Li=Object.freeze({__proto__:null,ArcCurve:class pxlNav_th extends pxlNav_Ka{constructor(u,d,v,x,y,b){super(u,d,v,v,x,y,b),this.isArcCurve=!0,this.type="ArcCurve"}},CatmullRomCurve3:class pxlNav_oh extends pxlNav_Qa{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=u,this.closed=d,this.curveType=v,this.tension=x}getPoint(u){var d,v,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pxlNav_Ii,y=this.points,b=y.length,_=(b-(this.closed?0:1))*u,w=Math.floor(_),S=_-w;this.closed?w+=w>0?0:(Math.floor(Math.abs(w)/b)+1)*b:0===S&&w===b-1&&(w=b-2,S=1),this.closed||w>0?d=y[(w-1)%b]:(Ti.subVectors(y[0],y[1]).add(y[0]),d=Ti);var C=y[w%b],P=y[(w+1)%b];if(this.closed||w+2<b?v=y[(w+2)%b]:(Ti.subVectors(y[b-1],y[b-2]).add(y[b-1]),v=Ti),"centripetal"===this.curveType||"chordal"===this.curveType){var A="chordal"===this.curveType?.5:.25,T=Math.pow(d.distanceToSquared(C),A),E=Math.pow(C.distanceToSquared(P),A),D=Math.pow(P.distanceToSquared(v),A);E<1e-4&&(E=1),T<1e-4&&(T=E),D<1e-4&&(D=E),Ei.initNonuniformCatmullRom(d.x,C.x,P.x,v.x,T,E,D),Di.initNonuniformCatmullRom(d.y,C.y,P.y,v.y,T,E,D),Ii.initNonuniformCatmullRom(d.z,C.z,P.z,v.z,T,E,D)}else"catmullrom"===this.curveType&&(Ei.initCatmullRom(d.x,C.x,P.x,v.x,this.tension),Di.initCatmullRom(d.y,C.y,P.y,v.y,this.tension),Ii.initCatmullRom(d.z,C.z,P.z,v.z,this.tension));return x.set(Ei.calc(S),Di.calc(S),Ii.calc(S)),x}copy(u){super.copy(u),this.points=[];for(var d=0,v=u.points.length;d<v;d++){var x=u.points[d];this.points.push(x.clone())}return this.closed=u.closed,this.curveType=u.curveType,this.tension=u.tension,this}toJSON(){var u=super.toJSON();u.points=[];for(var d=0,v=this.points.length;d<v;d++){var x=this.points[d];u.points.push(x.toArray())}return u.closed=this.closed,u.curveType=this.curveType,u.tension=this.tension,u}fromJSON(u){super.fromJSON(u),this.points=[];for(var d=0,v=u.points.length;d<v;d++){var x=u.points[d];this.points.push((new pxlNav_Ii).fromArray(x))}return this.closed=u.closed,this.curveType=u.curveType,this.tension=u.tension,this}},CubicBezierCurve:pxlNav_ch,CubicBezierCurve3:class pxlNav_uh extends pxlNav_Qa{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pxlNav_Ii,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pxlNav_Ii,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new pxlNav_Ii,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new pxlNav_Ii;super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=u,this.v1=d,this.v2=v,this.v3=x}getPoint(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pxlNav_Ii,v=this.v0,x=this.v1,y=this.v2,b=this.v3;return d.set(pxlNav_lh(u,v.x,x.x,y.x,b.x),pxlNav_lh(u,v.y,x.y,y.y,b.y),pxlNav_lh(u,v.z,x.z,y.z,b.z)),d}copy(u){return super.copy(u),this.v0.copy(u.v0),this.v1.copy(u.v1),this.v2.copy(u.v2),this.v3.copy(u.v3),this}toJSON(){var u=super.toJSON();return u.v0=this.v0.toArray(),u.v1=this.v1.toArray(),u.v2=this.v2.toArray(),u.v3=this.v3.toArray(),u}fromJSON(u){return super.fromJSON(u),this.v0.fromArray(u.v0),this.v1.fromArray(u.v1),this.v2.fromArray(u.v2),this.v3.fromArray(u.v3),this}},EllipseCurve:pxlNav_Ka,LineCurve:pxlNav_dh,LineCurve3:class pxlNav_ph extends pxlNav_Qa{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pxlNav_Ii,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pxlNav_Ii;super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=u,this.v2=d}getPoint(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pxlNav_Ii;return 1===u?d.copy(this.v2):(d.copy(this.v2).sub(this.v1),d.multiplyScalar(u).add(this.v1)),d}getPointAt(u,d){return this.getPoint(u,d)}getTangent(u){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pxlNav_Ii).subVectors(this.v2,this.v1).normalize()}getTangentAt(u,d){return this.getTangent(u,d)}copy(u){return super.copy(u),this.v1.copy(u.v1),this.v2.copy(u.v2),this}toJSON(){var u=super.toJSON();return u.v1=this.v1.toArray(),u.v2=this.v2.toArray(),u}fromJSON(u){return super.fromJSON(u),this.v1.fromArray(u.v1),this.v2.fromArray(u.v2),this}},QuadraticBezierCurve:pxlNav_mh,QuadraticBezierCurve3:pxlNav_yh,SplineCurve:pxlNav_fh});class pxlNav_xh extends pxlNav_Qa{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(u){this.curves.push(u)}closePath(){var u=this.curves[0].getPoint(0),d=this.curves[this.curves.length-1].getPoint(1);if(!u.equals(d)){var v=!0===u.isVector2?"LineCurve":"LineCurve3";this.curves.push(new Li[v](d,u))}return this}getPoint(u,d){for(var v=u*this.getLength(),x=this.getCurveLengths(),y=0;y<x.length;){if(x[y]>=v){var b=x[y]-v,_=this.curves[y],w=_.getLength(),S=0===w?0:1-b/w;return _.getPointAt(S,d)}y++}return null}getLength(){var u=this.getCurveLengths();return u[u.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var u=[],d=0,v=0,x=this.curves.length;v<x;v++)d+=this.curves[v].getLength(),u.push(d);return this.cacheLengths=u,u}getSpacedPoints(){for(var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40,d=[],v=0;v<=u;v++)d.push(this.getPoint(v/u));return this.autoClose&&d.push(d[0]),d}getPoints(){for(var u,d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,v=[],x=0,y=this.curves;x<y.length;x++)for(var b=y[x],_=b.isEllipseCurve?2*d:b.isLineCurve||b.isLineCurve3?1:b.isSplineCurve?d*b.points.length:d,w=b.getPoints(_),S=0;S<w.length;S++){var C=w[S];u&&u.equals(C)||(v.push(C),u=C)}return this.autoClose&&v.length>1&&!v[v.length-1].equals(v[0])&&v.push(v[0]),v}copy(u){super.copy(u),this.curves=[];for(var d=0,v=u.curves.length;d<v;d++){var x=u.curves[d];this.curves.push(x.clone())}return this.autoClose=u.autoClose,this}toJSON(){var u=super.toJSON();u.autoClose=this.autoClose,u.curves=[];for(var d=0,v=this.curves.length;d<v;d++){var x=this.curves[d];u.curves.push(x.toJSON())}return u}fromJSON(u){super.fromJSON(u),this.autoClose=u.autoClose,this.curves=[];for(var d=0,v=u.curves.length;d<v;d++){var x=u.curves[d];this.curves.push((new Li[x.type]).fromJSON(x))}return this}}class pxlNav_bh extends pxlNav_xh{constructor(u){super(),this.type="Path",this.currentPoint=new pxlNav_Zs,u&&this.setFromPoints(u)}setFromPoints(u){this.moveTo(u[0].x,u[0].y);for(var d=1,v=u.length;d<v;d++)this.lineTo(u[d].x,u[d].y);return this}moveTo(u,d){return this.currentPoint.set(u,d),this}lineTo(u,d){var v=new pxlNav_dh(this.currentPoint.clone(),new pxlNav_Zs(u,d));return this.curves.push(v),this.currentPoint.set(u,d),this}quadraticCurveTo(u,d,v,x){var y=new pxlNav_mh(this.currentPoint.clone(),new pxlNav_Zs(u,d),new pxlNav_Zs(v,x));return this.curves.push(y),this.currentPoint.set(v,x),this}bezierCurveTo(u,d,v,x,y,b){var _=new pxlNav_ch(this.currentPoint.clone(),new pxlNav_Zs(u,d),new pxlNav_Zs(v,x),new pxlNav_Zs(y,b));return this.curves.push(_),this.currentPoint.set(y,b),this}splineThru(u){var d=[this.currentPoint.clone()].concat(u),v=new pxlNav_fh(d);return this.curves.push(v),this.currentPoint.copy(u[u.length-1]),this}arc(u,d,v,x,y,b){var _=this.currentPoint.x,w=this.currentPoint.y;return this.absarc(u+_,d+w,v,x,y,b),this}absarc(u,d,v,x,y,b){return this.absellipse(u,d,v,v,x,y,b),this}ellipse(u,d,v,x,y,b,_,w){var S=this.currentPoint.x,C=this.currentPoint.y;return this.absellipse(u+S,d+C,v,x,y,b,_,w),this}absellipse(u,d,v,x,y,b,_,w){var S=new pxlNav_Ka(u,d,v,x,y,b,_,w);if(this.curves.length>0){var C=S.getPoint(0);C.equals(this.currentPoint)||this.lineTo(C.x,C.y)}this.curves.push(S);var P=S.getPoint(1);return this.currentPoint.copy(P),this}copy(u){return super.copy(u),this.currentPoint.copy(u.currentPoint),this}toJSON(){var u=super.toJSON();return u.currentPoint=this.currentPoint.toArray(),u}fromJSON(u){return super.fromJSON(u),this.currentPoint.fromArray(u.currentPoint),this}}class pxlNav_vh extends pxlNav_zn{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[new pxlNav_Zs(0,-.5),new pxlNav_Zs(.5,0),new pxlNav_Zs(0,.5)],d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;super(),this.type="LatheGeometry",this.parameters={points:u,segments:d,phiStart:v,phiLength:x},d=Math.floor(d),x=pxlNav_Ds(x,0,2*Math.PI);for(var y=[],b=[],_=[],w=[],S=[],C=1/d,P=new pxlNav_Ii,A=new pxlNav_Zs,T=new pxlNav_Ii,E=new pxlNav_Ii,D=new pxlNav_Ii,I=0,k=0,R=0;R<=u.length-1;R++)switch(R){case 0:I=u[R+1].x-u[R].x,k=u[R+1].y-u[R].y,T.x=1*k,T.y=-I,T.z=0*k,D.copy(T),T.normalize(),w.push(T.x,T.y,T.z);break;case u.length-1:w.push(D.x,D.y,D.z);break;default:I=u[R+1].x-u[R].x,k=u[R+1].y-u[R].y,T.x=1*k,T.y=-I,T.z=0*k,E.copy(T),T.x+=D.x,T.y+=D.y,T.z+=D.z,T.normalize(),w.push(T.x,T.y,T.z),D.copy(E)}for(var O=0;O<=d;O++)for(var j=v+O*C*x,G=Math.sin(j),H=Math.cos(j),X=0;X<=u.length-1;X++){P.x=u[X].x*G,P.y=u[X].y,P.z=u[X].x*H,b.push(P.x,P.y,P.z),A.x=O/d,A.y=X/(u.length-1),_.push(A.x,A.y);var q=w[3*X+0]*G,Z=w[3*X+1],J=w[3*X+0]*H;S.push(q,Z,J)}for(var Q=0;Q<d;Q++)for(var K=0;K<u.length-1;K++){var Y=K+Q*u.length,$=Y,ee=Y+u.length,te=Y+u.length+1,ie=Y+1;y.push($,ee,ie),y.push(te,ie,ee)}this.setIndex(y),this.setAttribute("position",new pxlNav_bn(b,3)),this.setAttribute("uv",new pxlNav_bn(_,2)),this.setAttribute("normal",new pxlNav_bn(S,3))}copy(u){return super.copy(u),this.parameters=Object.assign({},u.parameters),this}static fromJSON(u){return new pxlNav_vh(u.points,u.segments,u.phiStart,u.phiLength)}}class pxlNav_wh extends pxlNav_vh{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,y=new pxlNav_bh;y.absarc(0,-d/2,u,1.5*Math.PI,0),y.absarc(0,d/2,u,0,.5*Math.PI),super(y.getPoints(v),x),this.type="CapsuleGeometry",this.parameters={radius:u,length:d,capSegments:v,radialSegments:x}}static fromJSON(u){return new pxlNav_wh(u.radius,u.length,u.capSegments,u.radialSegments)}}class pxlNav_Mh extends pxlNav_zn{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;super(),this.type="CircleGeometry",this.parameters={radius:u,segments:d,thetaStart:v,thetaLength:x},d=Math.max(3,d);var y=[],b=[],_=[],w=[],S=new pxlNav_Ii,C=new pxlNav_Zs;b.push(0,0,0),_.push(0,0,1),w.push(.5,.5);for(var P=0,A=3;P<=d;P++,A+=3){var T=v+P/d*x;S.x=u*Math.cos(T),S.y=u*Math.sin(T),b.push(S.x,S.y,S.z),_.push(0,0,1),C.x=(b[A]/u+1)/2,C.y=(b[A+1]/u+1)/2,w.push(C.x,C.y)}for(var E=1;E<=d;E++)y.push(E,E+1,0);this.setIndex(y),this.setAttribute("position",new pxlNav_bn(b,3)),this.setAttribute("normal",new pxlNav_bn(_,3)),this.setAttribute("uv",new pxlNav_bn(w,2))}copy(u){return super.copy(u),this.parameters=Object.assign({},u.parameters),this}static fromJSON(u){return new pxlNav_Mh(u.radius,u.segments,u.thetaStart,u.thetaLength)}}class pxlNav_Sh extends pxlNav_zn{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,b=arguments.length>5&&void 0!==arguments[5]&&arguments[5],_=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,w=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2*Math.PI;super(),this.type="CylinderGeometry",this.parameters={radiusTop:u,radiusBottom:d,height:v,radialSegments:x,heightSegments:y,openEnded:b,thetaStart:_,thetaLength:w};var S=this;x=Math.floor(x),y=Math.floor(y);var C=[],P=[],A=[],T=[],E=0,D=[],I=v/2,k=0;function g(v){for(var y=E,b=new pxlNav_Zs,D=new pxlNav_Ii,R=0,O=!0===v?u:d,j=!0===v?1:-1,G=1;G<=x;G++)P.push(0,I*j,0),A.push(0,j,0),T.push(.5,.5),E++;for(var H=E,X=0;X<=x;X++){var q=X/x*w+_,Z=Math.cos(q),J=Math.sin(q);D.x=O*J,D.y=I*j,D.z=O*Z,P.push(D.x,D.y,D.z),A.push(0,j,0),b.x=.5*Z+.5,b.y=.5*J*j+.5,T.push(b.x,b.y),E++}for(var Q=0;Q<x;Q++){var K=y+Q,Y=H+Q;!0===v?C.push(Y,Y+1,K):C.push(Y+1,Y,K),R+=3}S.addGroup(k,R,!0===v?1:2),k+=R}!function(){for(var b=new pxlNav_Ii,R=new pxlNav_Ii,O=0,j=(d-u)/v,G=0;G<=y;G++){for(var H=[],X=G/y,q=X*(d-u)+u,Z=0;Z<=x;Z++){var J=Z/x,Q=J*w+_,K=Math.sin(Q),Y=Math.cos(Q);R.x=q*K,R.y=-X*v+I,R.z=q*Y,P.push(R.x,R.y,R.z),b.set(K,j,Y).normalize(),A.push(b.x,b.y,b.z),T.push(J,1-X),H.push(E++)}D.push(H)}for(var $=0;$<x;$++)for(var ee=0;ee<y;ee++){var te=D[ee][$],ie=D[ee+1][$],se=D[ee+1][$+1],re=D[ee][$+1];(u>0||0!==ee)&&(C.push(te,ie,re),O+=3),(d>0||ee!==y-1)&&(C.push(ie,se,re),O+=3)}S.addGroup(k,O,0),k+=O}(),!1===b&&(u>0&&g(!0),d>0&&g(!1)),this.setIndex(C),this.setAttribute("position",new pxlNav_bn(P,3)),this.setAttribute("normal",new pxlNav_bn(A,3)),this.setAttribute("uv",new pxlNav_bn(T,2))}copy(u){return super.copy(u),this.parameters=Object.assign({},u.parameters),this}static fromJSON(u){return new pxlNav_Sh(u.radiusTop,u.radiusBottom,u.height,u.radialSegments,u.heightSegments,u.openEnded,u.thetaStart,u.thetaLength)}}class js_pxlNav_h extends pxlNav_Sh{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,y=arguments.length>4&&void 0!==arguments[4]&&arguments[4],b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,_=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2*Math.PI;super(0,u,d,v,x,y,b,_),this.type="ConeGeometry",this.parameters={radius:u,height:d,radialSegments:v,heightSegments:x,openEnded:y,thetaStart:b,thetaLength:_}}static fromJSON(u){return new js_pxlNav_h(u.radius,u.height,u.radialSegments,u.heightSegments,u.openEnded,u.thetaStart,u.thetaLength)}}class pxlNav_Ah extends pxlNav_zn{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;super(),this.type="PolyhedronGeometry",this.parameters={vertices:u,indices:d,radius:v,detail:x};var y=[],b=[];function o(u,d,v,x){for(var y=x+1,b=[],_=0;_<=y;_++){b[_]=[];for(var w=u.clone().lerp(v,_/y),S=d.clone().lerp(v,_/y),C=y-_,P=0;P<=C;P++)b[_][P]=0===P&&_===y?w:w.clone().lerp(S,P/C)}for(var A=0;A<y;A++)for(var T=0;T<2*(y-A)-1;T++){var E=Math.floor(T/2);T%2==0?(a(b[A][E+1]),a(b[A+1][E]),a(b[A][E])):(a(b[A][E+1]),a(b[A+1][E+1]),a(b[A+1][E]))}}function a(u){y.push(u.x,u.y,u.z)}function h(d,v){var x=3*d;v.x=u[x+0],v.y=u[x+1],v.z=u[x+2]}function l(u,d,v,x){x<0&&1===u.x&&(b[d]=u.x-1),0===v.x&&0===v.z&&(b[d]=x/2/Math.PI+.5)}function c(u){return Math.atan2(u.z,-u.x)}!function(u){for(var v=new pxlNav_Ii,x=new pxlNav_Ii,y=new pxlNav_Ii,b=0;b<d.length;b+=3)h(d[b+0],v),h(d[b+1],x),h(d[b+2],y),o(v,x,y,u)}(x),function(u){for(var d=new pxlNav_Ii,v=0;v<y.length;v+=3)d.x=y[v+0],d.y=y[v+1],d.z=y[v+2],d.normalize().multiplyScalar(u),y[v+0]=d.x,y[v+1]=d.y,y[v+2]=d.z}(v),function(){for(var u,d=new pxlNav_Ii,v=0;v<y.length;v+=3){d.x=y[v+0],d.y=y[v+1],d.z=y[v+2];var x=c(d)/2/Math.PI+.5,_=(u=d,Math.atan2(-u.y,Math.sqrt(u.x*u.x+u.z*u.z))/Math.PI+.5);b.push(x,1-_)}(function(){for(var u=new pxlNav_Ii,d=new pxlNav_Ii,v=new pxlNav_Ii,x=new pxlNav_Ii,_=new pxlNav_Zs,w=new pxlNav_Zs,S=new pxlNav_Zs,C=0,P=0;C<y.length;C+=9,P+=6){u.set(y[C+0],y[C+1],y[C+2]),d.set(y[C+3],y[C+4],y[C+5]),v.set(y[C+6],y[C+7],y[C+8]),_.set(b[P+0],b[P+1]),w.set(b[P+2],b[P+3]),S.set(b[P+4],b[P+5]),x.copy(u).add(d).add(v).divideScalar(3);var A=c(x);l(_,P+0,u,A),l(w,P+2,d,A),l(S,P+4,v,A)}})(),function(){for(var u=0;u<b.length;u+=6){var d=b[u+0],v=b[u+2],x=b[u+4],y=Math.max(d,v,x),_=Math.min(d,v,x);y>.9&&_<.1&&(d<.2&&(b[u+0]+=1),v<.2&&(b[u+2]+=1),x<.2&&(b[u+4]+=1))}}()}(),this.setAttribute("position",new pxlNav_bn(y,3)),this.setAttribute("normal",new pxlNav_bn(y.slice(),3)),this.setAttribute("uv",new pxlNav_bn(b,2)),0===x?this.computeVertexNormals():this.normalizeNormals()}copy(u){return super.copy(u),this.parameters=Object.assign({},u.parameters),this}static fromJSON(u){return new pxlNav_Ah(u.vertices,u.indices,u.radius,u.details)}}class pxlNav_Th extends pxlNav_Ah{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=(1+Math.sqrt(5))/2,x=1/v;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-x,-v,0,-x,v,0,x,-v,0,x,v,-x,-v,0,-x,v,0,x,-v,0,x,v,0,-v,0,-x,v,0,-x,-v,0,x,v,0,x],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],u,d),this.type="DodecahedronGeometry",this.parameters={radius:u,detail:d}}static fromJSON(u){return new pxlNav_Th(u.radius,u.detail)}}var ki=new pxlNav_Ii,Ri=new pxlNav_Ii,Oi=new pxlNav_Ii,Bi=new pxlNav_Jr;class pxlNav_Eh extends pxlNav_bh{constructor(u){super(u),this.uuid=pxlNav_js(),this.type="Shape",this.holes=[]}getPointsHoles(u){for(var d=[],v=0,x=this.holes.length;v<x;v++)d[v]=this.holes[v].getPoints(u);return d}extractPoints(u){return{shape:this.getPoints(u),holes:this.getPointsHoles(u)}}copy(u){super.copy(u),this.holes=[];for(var d=0,v=u.holes.length;d<v;d++){var x=u.holes[d];this.holes.push(x.clone())}return this}toJSON(){var u=super.toJSON();u.uuid=this.uuid,u.holes=[];for(var d=0,v=this.holes.length;d<v;d++){var x=this.holes[d];u.holes.push(x.toJSON())}return u}fromJSON(u){super.fromJSON(u),this.uuid=u.uuid,this.holes=[];for(var d=0,v=u.holes.length;d<v;d++){var x=u.holes[d];this.holes.push((new pxlNav_bh).fromJSON(x))}return this}}function pxlNav_Ph(u,d,v,x,y){var b,_;if(y===function(u,d,v,x){for(var y=0,b=d,_=v-x;b<v;b+=x)y+=(u[_]-u[b])*(u[b+1]+u[_+1]),_=b;return y}(u,d,v,x)>0)for(b=d;b<v;b+=x)_=pxlNav_el(b,u[b],u[b+1],_);else for(b=v-x;b>=d;b-=x)_=pxlNav_el(b,u[b],u[b+1],_);return _&&pxlNav_Zh(_,_.next)&&(pxlNav_sl(_),_=_.next),_}function pxlNav_Oh(u,d){if(!u)return u;d||(d=u);var v,x=u;do{if(v=!1,x.steiner||!pxlNav_Zh(x,x.next)&&0!==pxlNav_Yh(x.prev,x,x.next))x=x.next;else{if(pxlNav_sl(x),(x=d=x.prev)===x.next)break;v=!0}}while(v||x!==d);return d}function pxlNav_Fh(u,d,v,x,y,b,_){if(u){!_&&b&&function(u,d,v,x){var y=u;do{0===y.z&&(y.z=pxlNav_Hh(y.x,y.y,d,v,x)),y.prevZ=y.prev,y.nextZ=y.next,y=y.next}while(y!==u);y.prevZ.nextZ=null,y.prevZ=null,function(u){var d,v,x,y,b,_,w,S,C=1;do{for(v=u,u=null,b=null,_=0;v;){for(_++,x=v,w=0,d=0;d<C&&(w++,x=x.nextZ);d++);for(S=C;w>0||S>0&&x;)0!==w&&(0===S||!x||v.z<=x.z)?(y=v,v=v.nextZ,w--):(y=x,x=x.nextZ,S--),b?b.nextZ=y:u=y,y.prevZ=b,b=y;v=x}b.nextZ=null,C*=2}while(_>1)}(y)}(u,x,y,b);for(var w,S,C=u;u.prev!==u.next;)if(w=u.prev,S=u.next,b?pxlNav_Lh(u,x,y,b):pxlNav_Nh(u))d.push(w.i/v|0),d.push(u.i/v|0),d.push(S.i/v|0),pxlNav_sl(u),u=S.next,C=S.next;else if((u=S)===C){_?1===_?pxlNav_Fh(u=pxlNav_Vh(pxlNav_Oh(u),d,v),d,v,x,y,b,2):2===_&&pxlNav_Wh(u,d,v,x,y,b):pxlNav_Fh(pxlNav_Oh(u),d,v,x,y,b,1);break}}}function pxlNav_Nh(u){var d=u.prev,v=u,x=u.next;if(pxlNav_Yh(d,v,x)>=0)return!1;for(var y=d.x,b=v.x,_=x.x,w=d.y,S=v.y,C=x.y,P=y<b?y<_?y:_:b<_?b:_,A=w<S?w<C?w:C:S<C?S:C,T=y>b?y>_?y:_:b>_?b:_,E=w>S?w>C?w:C:S>C?S:C,D=x.next;D!==d;){if(D.x>=P&&D.x<=T&&D.y>=A&&D.y<=E&&pxlNav_Jh(y,w,b,S,_,C,D.x,D.y)&&pxlNav_Yh(D.prev,D,D.next)>=0)return!1;D=D.next}return!0}function pxlNav_Lh(u,d,v,x){var y=u.prev,b=u,_=u.next;if(pxlNav_Yh(y,b,_)>=0)return!1;for(var w=y.x,S=b.x,C=_.x,P=y.y,A=b.y,T=_.y,E=w<S?w<C?w:C:S<C?S:C,D=P<A?P<T?P:T:A<T?A:T,I=w>S?w>C?w:C:S>C?S:C,k=P>A?P>T?P:T:A>T?A:T,R=pxlNav_Hh(E,D,d,v,x),O=pxlNav_Hh(I,k,d,v,x),j=u.prevZ,G=u.nextZ;j&&j.z>=R&&G&&G.z<=O;){if(j.x>=E&&j.x<=I&&j.y>=D&&j.y<=k&&j!==y&&j!==_&&pxlNav_Jh(w,P,S,A,C,T,j.x,j.y)&&pxlNav_Yh(j.prev,j,j.next)>=0)return!1;if(j=j.prevZ,G.x>=E&&G.x<=I&&G.y>=D&&G.y<=k&&G!==y&&G!==_&&pxlNav_Jh(w,P,S,A,C,T,G.x,G.y)&&pxlNav_Yh(G.prev,G,G.next)>=0)return!1;G=G.nextZ}for(;j&&j.z>=R;){if(j.x>=E&&j.x<=I&&j.y>=D&&j.y<=k&&j!==y&&j!==_&&pxlNav_Jh(w,P,S,A,C,T,j.x,j.y)&&pxlNav_Yh(j.prev,j,j.next)>=0)return!1;j=j.prevZ}for(;G&&G.z<=O;){if(G.x>=E&&G.x<=I&&G.y>=D&&G.y<=k&&G!==y&&G!==_&&pxlNav_Jh(w,P,S,A,C,T,G.x,G.y)&&pxlNav_Yh(G.prev,G,G.next)>=0)return!1;G=G.nextZ}return!0}function pxlNav_Vh(u,d,v){var x=u;do{var y=x.prev,b=x.next.next;!pxlNav_Zh(y,b)&&pxlNav_Gh(y,x,x.next,b)&&pxlNav_Kh(y,b)&&pxlNav_Kh(b,y)&&(d.push(y.i/v|0),d.push(x.i/v|0),d.push(b.i/v|0),pxlNav_sl(x),pxlNav_sl(x.next),x=u=b),x=x.next}while(x!==u);return pxlNav_Oh(x)}function pxlNav_Wh(u,d,v,x,y,b){var _=u;do{for(var w=_.next.next;w!==_.prev;){if(_.i!==w.i&&pxlNav_Xh(_,w)){var S=pxlNav_tl(_,w);return _=pxlNav_Oh(_,_.next),S=pxlNav_Oh(S,S.next),pxlNav_Fh(_,d,v,x,y,b,0),void pxlNav_Fh(S,d,v,x,y,b,0)}w=w.next}_=_.next}while(_!==u)}function pxlNav_Uh(u,d){return u.x-d.x}function pxlNav_jh(u,d){var v=function(u,d){var v,x=d,y=-1/0,b=u.x,_=u.y;do{if(_<=x.y&&_>=x.next.y&&x.next.y!==x.y){var w=x.x+(_-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(w<=b&&w>y&&(y=w,v=x.x<x.next.x?x:x.next,w===b))return v}x=x.next}while(x!==d);if(!v)return null;var S,C=v,P=v.x,A=v.y,T=1/0;x=v;do{b>=x.x&&x.x>=P&&b!==x.x&&pxlNav_Jh(_<A?b:y,_,P,A,_<A?y:b,_,x.x,x.y)&&(S=Math.abs(_-x.y)/(b-x.x),pxlNav_Kh(x,u)&&(S<T||S===T&&(x.x>v.x||x.x===v.x&&pxlNav_Dh(v,x)))&&(v=x,T=S)),x=x.next}while(x!==C);return v}(u,d);if(!v)return d;var x=pxlNav_tl(v,u);return pxlNav_Oh(x,x.next),pxlNav_Oh(v,v.next)}function pxlNav_Dh(u,d){return pxlNav_Yh(u.prev,u,d.prev)<0&&pxlNav_Yh(d.next,u,u.next)<0}function pxlNav_Hh(u,d,v,x,y){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-v)*y|0)|u<<8))|u<<4))|u<<2))|u<<1))|(d=1431655765&((d=858993459&((d=252645135&((d=16711935&((d=(d-x)*y|0)|d<<8))|d<<4))|d<<2))|d<<1))<<1}function pxlNav_qh(u){var d=u,v=u;do{(d.x<v.x||d.x===v.x&&d.y<v.y)&&(v=d),d=d.next}while(d!==u);return v}function pxlNav_Jh(u,d,v,x,y,b,_,w){return(y-_)*(d-w)>=(u-_)*(b-w)&&(u-_)*(x-w)>=(v-_)*(d-w)&&(v-_)*(b-w)>=(y-_)*(x-w)}function pxlNav_Xh(u,d){return u.next.i!==d.i&&u.prev.i!==d.i&&!function(u,d){var v=u;do{if(v.i!==u.i&&v.next.i!==u.i&&v.i!==d.i&&v.next.i!==d.i&&pxlNav_Gh(v,v.next,u,d))return!0;v=v.next}while(v!==u);return!1}(u,d)&&(pxlNav_Kh(u,d)&&pxlNav_Kh(d,u)&&function(u,d){var v=u,x=!1,y=(u.x+d.x)/2,b=(u.y+d.y)/2;do{v.y>b!=v.next.y>b&&v.next.y!==v.y&&y<(v.next.x-v.x)*(b-v.y)/(v.next.y-v.y)+v.x&&(x=!x),v=v.next}while(v!==u);return x}(u,d)&&(pxlNav_Yh(u.prev,u,d.prev)||pxlNav_Yh(u,d.prev,d))||pxlNav_Zh(u,d)&&pxlNav_Yh(u.prev,u,u.next)>0&&pxlNav_Yh(d.prev,d,d.next)>0)}function pxlNav_Yh(u,d,v){return(d.y-u.y)*(v.x-d.x)-(d.x-u.x)*(v.y-d.y)}function pxlNav_Zh(u,d){return u.x===d.x&&u.y===d.y}function pxlNav_Gh(u,d,v,x){var y=pxlNav_Qh(pxlNav_Yh(u,d,v)),b=pxlNav_Qh(pxlNav_Yh(u,d,x)),_=pxlNav_Qh(pxlNav_Yh(v,x,u)),w=pxlNav_Qh(pxlNav_Yh(v,x,d));return y!==b&&_!==w||!(0!==y||!pxlNav_$h(u,v,d))||!(0!==b||!pxlNav_$h(u,x,d))||!(0!==_||!pxlNav_$h(v,u,x))||!(0!==w||!pxlNav_$h(v,d,x))}function pxlNav_$h(u,d,v){return d.x<=Math.max(u.x,v.x)&&d.x>=Math.min(u.x,v.x)&&d.y<=Math.max(u.y,v.y)&&d.y>=Math.min(u.y,v.y)}function pxlNav_Qh(u){return u>0?1:u<0?-1:0}function pxlNav_Kh(u,d){return pxlNav_Yh(u.prev,u,u.next)<0?pxlNav_Yh(u,d,u.next)>=0&&pxlNav_Yh(u,u.prev,d)>=0:pxlNav_Yh(u,d,u.prev)<0||pxlNav_Yh(u,u.next,d)<0}function pxlNav_tl(u,d){var v=new pxlNav_il(u.i,u.x,u.y),x=new pxlNav_il(d.i,d.x,d.y),y=u.next,b=d.prev;return u.next=d,d.prev=u,v.next=y,y.prev=v,x.next=v,v.prev=x,b.next=x,x.prev=b,x}function pxlNav_el(u,d,v,x){var y=new pxlNav_il(u,d,v);return x?(y.next=x.next,y.prev=x,x.next.prev=y,x.next=y):(y.prev=y,y.next=y),y}function pxlNav_sl(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function pxlNav_il(u,d,v){this.i=u,this.x=d,this.y=v,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class pxlNav_rl{static area(u){for(var d=u.length,v=0,x=d-1,y=0;y<d;x=y++)v+=u[x].x*u[y].y-u[y].x*u[x].y;return.5*v}static isClockWise(u){return pxlNav_rl.area(u)<0}static triangulateShape(u,d){var v=[],x=[],y=[];pxlNav_nl(u),pxlNav_ol(v,u);var b=u.length;d.forEach(pxlNav_nl);for(var _=0;_<d.length;_++)x.push(b),b+=d[_].length,pxlNav_ol(v,d[_]);for(var w=function Rh(u,d){var v,x,y,b,_,w,S,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,P=d&&d.length,A=P?d[0]*C:u.length,T=pxlNav_Ph(u,0,A,C,!0),E=[];if(!T||T.next===T.prev)return E;if(P&&(T=function(u,d,v,x){var y,b,_,w=[];for(y=0,b=d.length;y<b;y++)(_=pxlNav_Ph(u,d[y]*x,y<b-1?d[y+1]*x:u.length,x,!1))===_.next&&(_.steiner=!0),w.push(pxlNav_qh(_));for(w.sort(pxlNav_Uh),y=0;y<w.length;y++)v=pxlNav_jh(w[y],v);return v}(u,d,T,C)),u.length>80*C){v=y=u[0],x=b=u[1];for(var D=C;D<A;D+=C)(_=u[D])<v&&(v=_),(w=u[D+1])<x&&(x=w),_>y&&(y=_),w>b&&(b=w);S=0!==(S=Math.max(y-v,b-x))?32767/S:0}return pxlNav_Fh(T,E,C,v,x,S,0),E}(v,x),S=0;S<w.length;S+=3)y.push(w.slice(S,S+3));return y}}function pxlNav_nl(u){var d=u.length;d>2&&u[d-1].equals(u[0])&&u.pop()}function pxlNav_ol(u,d){for(var v=0;v<d.length;v++)u.push(d[v].x),u.push(d[v].y)}class pxlNav_al extends pxlNav_zn{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pxlNav_Eh([new pxlNav_Zs(.5,.5),new pxlNav_Zs(-.5,.5),new pxlNav_Zs(-.5,-.5),new pxlNav_Zs(.5,-.5)]),d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.type="ExtrudeGeometry",this.parameters={shapes:u,options:d},u=Array.isArray(u)?u:[u];for(var v=this,x=[],y=[],b=0,_=u.length;b<_;b++)n(u[b]);function n(u){var b,_,w,S,C,P=[],A=void 0!==d.curveSegments?d.curveSegments:12,T=void 0!==d.steps?d.steps:1,E=void 0!==d.depth?d.depth:1,D=void 0===d.bevelEnabled||d.bevelEnabled,I=void 0!==d.bevelThickness?d.bevelThickness:.2,k=void 0!==d.bevelSize?d.bevelSize:I-.1,R=void 0!==d.bevelOffset?d.bevelOffset:0,O=void 0!==d.bevelSegments?d.bevelSegments:3,j=d.extrudePath,G=void 0!==d.UVGenerator?d.UVGenerator:Vi,H=!1;j&&(b=j.getSpacedPoints(T),H=!0,D=!1,_=j.computeFrenetFrames(T,!1),w=new pxlNav_Ii,S=new pxlNav_Ii,C=new pxlNav_Ii),D||(O=0,I=0,k=0,R=0);var X=u.extractPoints(A),q=X.shape,Z=X.holes;if(!pxlNav_rl.isClockWise(q)){q=q.reverse();for(var J=0,Q=Z.length;J<Q;J++){var K=Z[J];pxlNav_rl.isClockWise(K)&&(Z[J]=K.reverse())}}for(var Y=pxlNav_rl.triangulateShape(q,Z),$=q,ee=0,te=Z.length;ee<te;ee++){var ie=Z[ee];q=q.concat(ie)}function z(u,d,v){return d||console.error("THREE.ExtrudeGeometry: vec does not exist"),u.clone().addScaledVector(d,v)}var se=q.length,re=Y.length;function B(u,d,v){var x,y,b,_=u.x-d.x,w=u.y-d.y,S=v.x-u.x,C=v.y-u.y,P=_*_+w*w,A=_*C-w*S;if(Math.abs(A)>Number.EPSILON){var T=Math.sqrt(P),E=Math.sqrt(S*S+C*C),D=d.x-w/T,I=d.y+_/T,k=((v.x-C/E-D)*C-(v.y+S/E-I)*S)/(_*C-w*S),R=(x=D+_*k-u.x)*x+(y=I+w*k-u.y)*y;if(R<=2)return new pxlNav_Zs(x,y);b=Math.sqrt(R/2)}else{var O=!1;_>Number.EPSILON?S>Number.EPSILON&&(O=!0):_<-Number.EPSILON?S<-Number.EPSILON&&(O=!0):Math.sign(w)===Math.sign(C)&&(O=!0),O?(x=-w,y=_,b=Math.sqrt(P)):(x=_,y=w,b=Math.sqrt(P/2))}return new pxlNav_Zs(x/b,y/b)}for(var ae=[],ne=0,oe=$.length,le=oe-1,he=ne+1;ne<oe;ne++,le++,he++)le===oe&&(le=0),he===oe&&(he=0),ae[ne]=B($[ne],$[le],$[he]);for(var ue,ce=[],pe=ae.concat(),de=0,ve=Z.length;de<ve;de++){var me=Z[de];ue=[];for(var xe=0,ge=me.length,fe=ge-1,ye=xe+1;xe<ge;xe++,fe++,ye++)fe===ge&&(fe=0),ye===ge&&(ye=0),ue[xe]=B(me[xe],me[fe],me[ye]);ce.push(ue),pe=pe.concat(ue)}for(var be=0;be<O;be++){for(var _e=be/O,we=I*Math.cos(_e*Math.PI/2),Se=k*Math.sin(_e*Math.PI/2)+R,Ce=0,Ne=$.length;Ce<Ne;Ce++){var Pe=z($[Ce],ae[Ce],Se);N(Pe.x,Pe.y,-we)}for(var Me=0,Ae=Z.length;Me<Ae;Me++){var Te=Z[Me];ue=ce[Me];for(var Ee=0,De=Te.length;Ee<De;Ee++){var Ie=z(Te[Ee],ue[Ee],Se);N(Ie.x,Ie.y,-we)}}}for(var Le=k+R,ke=0;ke<se;ke++){var Re=D?z(q[ke],pe[ke],Le):q[ke];H?(S.copy(_.normals[0]).multiplyScalar(Re.x),w.copy(_.binormals[0]).multiplyScalar(Re.y),C.copy(b[0]).add(S).add(w),N(C.x,C.y,C.z)):N(Re.x,Re.y,0)}for(var Oe=1;Oe<=T;Oe++)for(var Be=0;Be<se;Be++){var Ve=D?z(q[Be],pe[Be],Le):q[Be];H?(S.copy(_.normals[Oe]).multiplyScalar(Ve.x),w.copy(_.binormals[Oe]).multiplyScalar(Ve.y),C.copy(b[Oe]).add(S).add(w),N(C.x,C.y,C.z)):N(Ve.x,Ve.y,E/T*Oe)}for(var Ue=O-1;Ue>=0;Ue--){for(var Fe=Ue/O,je=I*Math.cos(Fe*Math.PI/2),ze=k*Math.sin(Fe*Math.PI/2)+R,Ge=0,He=$.length;Ge<He;Ge++){var We=z($[Ge],ae[Ge],ze);N(We.x,We.y,E+je)}for(var Xe=0,qe=Z.length;Xe<qe;Xe++){var Ze=Z[Xe];ue=ce[Xe];for(var Je=0,Qe=Ze.length;Je<Qe;Je++){var Ke=z(Ze[Je],ue[Je],ze);H?N(Ke.x,Ke.y+b[T-1].y,b[T-1].x+je):N(Ke.x,Ke.y,E+je)}}}function F(u,d){for(var v=u.length;--v>=0;){var x=v,y=v-1;y<0&&(y=u.length-1);for(var b=0,_=T+2*O;b<_;b++){var w=se*b,S=se*(b+1);V(d+x+w,d+y+w,d+y+S,d+x+S)}}}function N(u,d,v){P.push(u),P.push(d),P.push(v)}function L(u,d,y){W(u),W(d),W(y);var b=x.length/3,_=G.generateTopUV(v,x,b-3,b-2,b-1);U(_[0]),U(_[1]),U(_[2])}function V(u,d,y,b){W(u),W(d),W(b),W(d),W(y),W(b);var _=x.length/3,w=G.generateSideWallUV(v,x,_-6,_-3,_-2,_-1);U(w[0]),U(w[1]),U(w[3]),U(w[1]),U(w[2]),U(w[3])}function W(u){x.push(P[3*u+0]),x.push(P[3*u+1]),x.push(P[3*u+2])}function U(u){y.push(u.x),y.push(u.y)}!function(){var u=x.length/3;if(D){for(var d=0,y=se*d,b=0;b<re;b++){var _=Y[b];L(_[2]+y,_[1]+y,_[0]+y)}y=se*(d=T+2*O);for(var w=0;w<re;w++){var S=Y[w];L(S[0]+y,S[1]+y,S[2]+y)}}else{for(var C=0;C<re;C++){var P=Y[C];L(P[2],P[1],P[0])}for(var A=0;A<re;A++){var E=Y[A];L(E[0]+se*T,E[1]+se*T,E[2]+se*T)}}v.addGroup(u,x.length/3-u,0)}(),function(){var u=x.length/3,d=0;F($,d),d+=$.length;for(var y=0,b=Z.length;y<b;y++){var _=Z[y];F(_,d),d+=_.length}v.addGroup(u,x.length/3-u,1)}()}this.setAttribute("position",new pxlNav_bn(x,3)),this.setAttribute("uv",new pxlNav_bn(y,2)),this.computeVertexNormals()}copy(u){return super.copy(u),this.parameters=Object.assign({},u.parameters),this}toJSON(){var u=super.toJSON();return function(u,d,v){if(v.shapes=[],Array.isArray(u))for(var x=0,y=u.length;x<y;x++){var b=u[x];v.shapes.push(b.uuid)}else v.shapes.push(u.uuid);return v.options=Object.assign({},d),void 0!==d.extrudePath&&(v.options.extrudePath=d.extrudePath.toJSON()),v}(this.parameters.shapes,this.parameters.options,u)}static fromJSON(u,d){for(var v=[],x=0,y=u.shapes.length;x<y;x++){var b=d[u.shapes[x]];v.push(b)}var _=u.options.extrudePath;return void 0!==_&&(u.options.extrudePath=(new Li[_.type]).fromJSON(_)),new pxlNav_al(v,u.options)}}var Vi={generateTopUV:function generateTopUV(u,d,v,x,y){var b=d[3*v],_=d[3*v+1],w=d[3*x],S=d[3*x+1],C=d[3*y],P=d[3*y+1];return[new pxlNav_Zs(b,_),new pxlNav_Zs(w,S),new pxlNav_Zs(C,P)]},generateSideWallUV:function generateSideWallUV(u,d,v,x,y,b){var _=d[3*v],w=d[3*v+1],S=d[3*v+2],C=d[3*x],P=d[3*x+1],A=d[3*x+2],T=d[3*y],E=d[3*y+1],D=d[3*y+2],I=d[3*b],k=d[3*b+1],R=d[3*b+2];return Math.abs(w-P)<Math.abs(_-C)?[new pxlNav_Zs(_,1-S),new pxlNav_Zs(C,1-A),new pxlNav_Zs(T,1-D),new pxlNav_Zs(I,1-R)]:[new pxlNav_Zs(w,1-S),new pxlNav_Zs(P,1-A),new pxlNav_Zs(E,1-D),new pxlNav_Zs(k,1-R)]}};class pxlNav_ll extends pxlNav_Ah{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=(1+Math.sqrt(5))/2;super([-1,v,0,1,v,0,-1,-v,0,1,-v,0,0,-1,v,0,1,v,0,-1,-v,0,1,-v,v,0,-1,v,0,1,-v,0,-1,-v,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],u,d),this.type="IcosahedronGeometry",this.parameters={radius:u,detail:d}}static fromJSON(u){return new pxlNav_ll(u.radius,u.detail)}}class pxlNav_cl extends pxlNav_Ah{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],u,d),this.type="OctahedronGeometry",this.parameters={radius:u,detail:d}}static fromJSON(u){return new pxlNav_cl(u.radius,u.detail)}}class pxlNav_ul extends pxlNav_zn{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.type="PlaneGeometry",this.parameters={width:u,height:d,widthSegments:v,heightSegments:x};for(var y=u/2,b=d/2,_=Math.floor(v),w=Math.floor(x),S=_+1,C=w+1,P=u/_,A=d/w,T=[],E=[],D=[],I=[],k=0;k<C;k++)for(var R=k*A-b,O=0;O<S;O++){var j=O*P-y;E.push(j,-R,0),D.push(0,0,1),I.push(O/_),I.push(1-k/w)}for(var G=0;G<w;G++)for(var H=0;H<_;H++){var X=H+S*G,q=H+S*(G+1),Z=H+1+S*(G+1),J=H+1+S*G;T.push(X,q,J),T.push(q,Z,J)}this.setIndex(T),this.setAttribute("position",new pxlNav_bn(E,3)),this.setAttribute("normal",new pxlNav_bn(D,3)),this.setAttribute("uv",new pxlNav_bn(I,2))}copy(u){return super.copy(u),this.parameters=Object.assign({},u.parameters),this}static fromJSON(u){return new pxlNav_ul(u.width,u.height,u.widthSegments,u.heightSegments)}}class pxlNav_dl extends pxlNav_zn{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI;super(),this.type="RingGeometry",this.parameters={innerRadius:u,outerRadius:d,thetaSegments:v,phiSegments:x,thetaStart:y,thetaLength:b},v=Math.max(3,v);for(var _=[],w=[],S=[],C=[],P=u,A=(d-u)/(x=Math.max(1,x)),T=new pxlNav_Ii,E=new pxlNav_Zs,D=0;D<=x;D++){for(var I=0;I<=v;I++){var k=y+I/v*b;T.x=P*Math.cos(k),T.y=P*Math.sin(k),w.push(T.x,T.y,T.z),S.push(0,0,1),E.x=(T.x/d+1)/2,E.y=(T.y/d+1)/2,C.push(E.x,E.y)}P+=A}for(var R=0;R<x;R++)for(var O=R*(v+1),j=0;j<v;j++){var G=j+O,H=G,X=G+v+1,q=G+v+2,Z=G+1;_.push(H,X,Z),_.push(X,q,Z)}this.setIndex(_),this.setAttribute("position",new pxlNav_bn(w,3)),this.setAttribute("normal",new pxlNav_bn(S,3)),this.setAttribute("uv",new pxlNav_bn(C,2))}copy(u){return super.copy(u),this.parameters=Object.assign({},u.parameters),this}static fromJSON(u){return new pxlNav_dl(u.innerRadius,u.outerRadius,u.thetaSegments,u.phiSegments,u.thetaStart,u.thetaLength)}}class pxlNav_pl extends pxlNav_zn{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pxlNav_Eh([new pxlNav_Zs(0,.5),new pxlNav_Zs(-.5,-.5),new pxlNav_Zs(.5,-.5)]),d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;super(),this.type="ShapeGeometry",this.parameters={shapes:u,curveSegments:d};var v=[],x=[],y=[],b=[],_=0,w=0;if(!1===Array.isArray(u))h(u);else for(var S=0;S<u.length;S++)h(u[S]),this.addGroup(_,w,S),_+=w,w=0;function h(u){var _=x.length/3,S=u.extractPoints(d),C=S.shape,P=S.holes;!1===pxlNav_rl.isClockWise(C)&&(C=C.reverse());for(var A=0,T=P.length;A<T;A++){var E=P[A];!0===pxlNav_rl.isClockWise(E)&&(P[A]=E.reverse())}for(var D=pxlNav_rl.triangulateShape(C,P),I=0,k=P.length;I<k;I++){var R=P[I];C=C.concat(R)}for(var O=0,j=C.length;O<j;O++){var G=C[O];x.push(G.x,G.y,0),y.push(0,0,1),b.push(G.x,G.y)}for(var H=0,X=D.length;H<X;H++){var q=D[H],Z=q[0]+_,J=q[1]+_,Q=q[2]+_;v.push(Z,J,Q),w+=3}}this.setIndex(v),this.setAttribute("position",new pxlNav_bn(x,3)),this.setAttribute("normal",new pxlNav_bn(y,3)),this.setAttribute("uv",new pxlNav_bn(b,2))}copy(u){return super.copy(u),this.parameters=Object.assign({},u.parameters),this}toJSON(){var u=super.toJSON();return function(u,d){if(d.shapes=[],Array.isArray(u))for(var v=0,x=u.length;v<x;v++){var y=u[v];d.shapes.push(y.uuid)}else d.shapes.push(u.uuid);return d}(this.parameters.shapes,u)}static fromJSON(u,d){for(var v=[],x=0,y=u.shapes.length;x<y;x++){var b=d[u.shapes[x]];v.push(b)}return new pxlNav_pl(v,u.curveSegments)}}class pxlNav_ml extends pxlNav_zn{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,_=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;super(),this.type="SphereGeometry",this.parameters={radius:u,widthSegments:d,heightSegments:v,phiStart:x,phiLength:y,thetaStart:b,thetaLength:_},d=Math.max(3,Math.floor(d)),v=Math.max(2,Math.floor(v));for(var w=Math.min(b+_,Math.PI),S=0,C=[],P=new pxlNav_Ii,A=new pxlNav_Ii,T=[],E=[],D=[],I=[],k=0;k<=v;k++){var R=[],O=k/v,j=0;0===k&&0===b?j=.5/d:k===v&&w===Math.PI&&(j=-.5/d);for(var G=0;G<=d;G++){var H=G/d;P.x=-u*Math.cos(x+H*y)*Math.sin(b+O*_),P.y=u*Math.cos(b+O*_),P.z=u*Math.sin(x+H*y)*Math.sin(b+O*_),E.push(P.x,P.y,P.z),A.copy(P).normalize(),D.push(A.x,A.y,A.z),I.push(H+j,1-O),R.push(S++)}C.push(R)}for(var X=0;X<v;X++)for(var q=0;q<d;q++){var Z=C[X][q+1],J=C[X][q],Q=C[X+1][q],K=C[X+1][q+1];(0!==X||b>0)&&T.push(Z,J,K),(X!==v-1||w<Math.PI)&&T.push(J,Q,K)}this.setIndex(T),this.setAttribute("position",new pxlNav_bn(E,3)),this.setAttribute("normal",new pxlNav_bn(D,3)),this.setAttribute("uv",new pxlNav_bn(I,2))}copy(u){return super.copy(u),this.parameters=Object.assign({},u.parameters),this}static fromJSON(u){return new pxlNav_ml(u.radius,u.widthSegments,u.heightSegments,u.phiStart,u.phiLength,u.thetaStart,u.thetaLength)}}class pxlNav_yl extends pxlNav_Ah{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],u,d),this.type="TetrahedronGeometry",this.parameters={radius:u,detail:d}}static fromJSON(u){return new pxlNav_yl(u.radius,u.detail)}}class pxlNav_fl extends pxlNav_zn{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:48,y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI;super(),this.type="TorusGeometry",this.parameters={radius:u,tube:d,radialSegments:v,tubularSegments:x,arc:y},v=Math.floor(v),x=Math.floor(x);for(var b=[],_=[],w=[],S=[],C=new pxlNav_Ii,P=new pxlNav_Ii,A=new pxlNav_Ii,T=0;T<=v;T++)for(var E=0;E<=x;E++){var D=E/x*y,I=T/v*Math.PI*2;P.x=(u+d*Math.cos(I))*Math.cos(D),P.y=(u+d*Math.cos(I))*Math.sin(D),P.z=d*Math.sin(I),_.push(P.x,P.y,P.z),C.x=u*Math.cos(D),C.y=u*Math.sin(D),A.subVectors(P,C).normalize(),w.push(A.x,A.y,A.z),S.push(E/x),S.push(T/v)}for(var k=1;k<=v;k++)for(var R=1;R<=x;R++){var O=(x+1)*k+R-1,j=(x+1)*(k-1)+R-1,G=(x+1)*(k-1)+R,H=(x+1)*k+R;b.push(O,j,H),b.push(j,G,H)}this.setIndex(b),this.setAttribute("position",new pxlNav_bn(_,3)),this.setAttribute("normal",new pxlNav_bn(w,3)),this.setAttribute("uv",new pxlNav_bn(S,2))}copy(u){return super.copy(u),this.parameters=Object.assign({},u.parameters),this}static fromJSON(u){return new pxlNav_fl(u.radius,u.tube,u.radialSegments,u.tubularSegments,u.arc)}}class pxlNav_gl extends pxlNav_zn{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:64,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3;super(),this.type="TorusKnotGeometry",this.parameters={radius:u,tube:d,tubularSegments:v,radialSegments:x,p:y,q:b},v=Math.floor(v),x=Math.floor(x);for(var _=[],w=[],S=[],C=[],P=new pxlNav_Ii,A=new pxlNav_Ii,T=new pxlNav_Ii,E=new pxlNav_Ii,D=new pxlNav_Ii,I=new pxlNav_Ii,k=new pxlNav_Ii,R=0;R<=v;++R){var O=R/v*y*Math.PI*2;g(O,y,b,u,T),g(O+.01,y,b,u,E),I.subVectors(E,T),k.addVectors(E,T),D.crossVectors(I,k),k.crossVectors(D,I),D.normalize(),k.normalize();for(var j=0;j<=x;++j){var G=j/x*Math.PI*2,H=-d*Math.cos(G),X=d*Math.sin(G);P.x=T.x+(H*k.x+X*D.x),P.y=T.y+(H*k.y+X*D.y),P.z=T.z+(H*k.z+X*D.z),w.push(P.x,P.y,P.z),A.subVectors(P,T).normalize(),S.push(A.x,A.y,A.z),C.push(R/v),C.push(j/x)}}for(var q=1;q<=v;q++)for(var Z=1;Z<=x;Z++){var J=(x+1)*(q-1)+(Z-1),Q=(x+1)*q+(Z-1),K=(x+1)*q+Z,Y=(x+1)*(q-1)+Z;_.push(J,Q,Y),_.push(Q,K,Y)}function g(u,d,v,x,y){var b=Math.cos(u),_=Math.sin(u),w=v/d*u,S=Math.cos(w);y.x=x*(2+S)*.5*b,y.y=x*(2+S)*_*.5,y.z=x*Math.sin(w)*.5}this.setIndex(_),this.setAttribute("position",new pxlNav_bn(w,3)),this.setAttribute("normal",new pxlNav_bn(S,3)),this.setAttribute("uv",new pxlNav_bn(C,2))}copy(u){return super.copy(u),this.parameters=Object.assign({},u.parameters),this}static fromJSON(u){return new pxlNav_gl(u.radius,u.tube,u.tubularSegments,u.radialSegments,u.p,u.q)}}class pxlNav_xl extends pxlNav_zn{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pxlNav_yh(new pxlNav_Ii(-1,-1,0),new pxlNav_Ii(-1,1,0),new pxlNav_Ii(1,1,0)),d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,y=arguments.length>4&&void 0!==arguments[4]&&arguments[4];super(),this.type="TubeGeometry",this.parameters={path:u,tubularSegments:d,radius:v,radialSegments:x,closed:y};var b=u.computeFrenetFrames(d,y);this.tangents=b.tangents,this.normals=b.normals,this.binormals=b.binormals;var _=new pxlNav_Ii,w=new pxlNav_Ii,S=new pxlNav_Zs,C=new pxlNav_Ii,P=[],A=[],T=[],E=[];function m(y){C=u.getPointAt(y/d,C);for(var S=b.normals[y],T=b.binormals[y],E=0;E<=x;E++){var D=E/x*Math.PI*2,I=Math.sin(D),k=-Math.cos(D);w.x=k*S.x+I*T.x,w.y=k*S.y+I*T.y,w.z=k*S.z+I*T.z,w.normalize(),A.push(w.x,w.y,w.z),_.x=C.x+v*w.x,_.y=C.y+v*w.y,_.z=C.z+v*w.z,P.push(_.x,_.y,_.z)}}!function(){for(var u=0;u<d;u++)m(u);m(!1===y?d:0),function(){for(var u=0;u<=d;u++)for(var v=0;v<=x;v++)S.x=u/d,S.y=v/x,T.push(S.x,S.y)}(),function(){for(var u=1;u<=d;u++)for(var v=1;v<=x;v++){var y=(x+1)*(u-1)+(v-1),b=(x+1)*u+(v-1),_=(x+1)*u+v,w=(x+1)*(u-1)+v;E.push(y,b,w),E.push(b,_,w)}}()}(),this.setIndex(E),this.setAttribute("position",new pxlNav_bn(P,3)),this.setAttribute("normal",new pxlNav_bn(A,3)),this.setAttribute("uv",new pxlNav_bn(T,2))}copy(u){return super.copy(u),this.parameters=Object.assign({},u.parameters),this}toJSON(){var u=super.toJSON();return u.path=this.parameters.path.toJSON(),u}static fromJSON(u){return new pxlNav_xl((new Li[u.path.type]).fromJSON(u.path),u.tubularSegments,u.radius,u.radialSegments,u.closed)}}function pxlNav_vl(u,d,v){var x="".concat(u.x,",").concat(u.y,",").concat(u.z,"-").concat(d.x,",").concat(d.y,",").concat(d.z),y="".concat(d.x,",").concat(d.y,",").concat(d.z,"-").concat(u.x,",").concat(u.y,",").concat(u.z);return!0!==v.has(x)&&!0!==v.has(y)&&(v.add(x),v.add(y),!0)}Object.freeze({__proto__:null,BoxGeometry:pxlNav_Un,CapsuleGeometry:pxlNav_wh,CircleGeometry:pxlNav_Mh,ConeGeometry:js_pxlNav_h,CylinderGeometry:pxlNav_Sh,DodecahedronGeometry:pxlNav_Th,EdgesGeometry:class pxlNav_kh extends pxlNav_zn{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(super(),this.type="EdgesGeometry",this.parameters={geometry:u,thresholdAngle:d},null!==u){for(var v=Math.pow(10,4),x=Math.cos(de*d),y=u.getIndex(),b=u.getAttribute("position"),_=y?y.count:b.count,w=[0,0,0],S=["a","b","c"],C=new Array(3),P={},A=[],T=0;T<_;T+=3){y?(w[0]=y.getX(T),w[1]=y.getX(T+1),w[2]=y.getX(T+2)):(w[0]=T,w[1]=T+1,w[2]=T+2);var{a:E,b:D,c:I}=Bi;if(E.fromBufferAttribute(b,w[0]),D.fromBufferAttribute(b,w[1]),I.fromBufferAttribute(b,w[2]),Bi.getNormal(Oi),C[0]="".concat(Math.round(E.x*v),",").concat(Math.round(E.y*v),",").concat(Math.round(E.z*v)),C[1]="".concat(Math.round(D.x*v),",").concat(Math.round(D.y*v),",").concat(Math.round(D.z*v)),C[2]="".concat(Math.round(I.x*v),",").concat(Math.round(I.y*v),",").concat(Math.round(I.z*v)),C[0]!==C[1]&&C[1]!==C[2]&&C[2]!==C[0])for(var k=0;k<3;k++){var R=(k+1)%3,O=C[k],j=C[R],G=Bi[S[k]],H=Bi[S[R]],X="".concat(O,"_").concat(j),q="".concat(j,"_").concat(O);q in P&&P[q]?(Oi.dot(P[q].normal)<=x&&(A.push(G.x,G.y,G.z),A.push(H.x,H.y,H.z)),P[q]=null):X in P||(P[X]={index0:w[k],index1:w[R],normal:Oi.clone()})}}for(var Z in P)if(P[Z]){var{index0:J,index1:Q}=P[Z];ki.fromBufferAttribute(b,J),Ri.fromBufferAttribute(b,Q),A.push(ki.x,ki.y,ki.z),A.push(Ri.x,Ri.y,Ri.z)}this.setAttribute("position",new pxlNav_bn(A,3))}}copy(u){return super.copy(u),this.parameters=Object.assign({},u.parameters),this}},ExtrudeGeometry:pxlNav_al,IcosahedronGeometry:pxlNav_ll,LatheGeometry:pxlNav_vh,OctahedronGeometry:pxlNav_cl,PlaneGeometry:pxlNav_ul,PolyhedronGeometry:pxlNav_Ah,RingGeometry:pxlNav_dl,ShapeGeometry:pxlNav_pl,SphereGeometry:pxlNav_ml,TetrahedronGeometry:pxlNav_yl,TorusGeometry:pxlNav_fl,TorusKnotGeometry:pxlNav_gl,TubeGeometry:pxlNav_xl,WireframeGeometry:class pxlNav_bl extends pxlNav_zn{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(super(),this.type="WireframeGeometry",this.parameters={geometry:u},null!==u){var d=[],v=new Set,x=new pxlNav_Ii,y=new pxlNav_Ii;if(null!==u.index){var b=u.attributes.position,_=u.index,w=u.groups;0===w.length&&(w=[{start:0,count:_.count,materialIndex:0}]);for(var S=0,C=w.length;S<C;++S)for(var P=w[S],A=P.start,T=A,E=A+P.count;T<E;T+=3)for(var D=0;D<3;D++){var I=_.getX(T+D),k=_.getX(T+(D+1)%3);x.fromBufferAttribute(b,I),y.fromBufferAttribute(b,k),!0===pxlNav_vl(x,y,v)&&(d.push(x.x,x.y,x.z),d.push(y.x,y.y,y.z))}}else for(var R=u.attributes.position,O=0,j=R.count/3;O<j;O++)for(var G=0;G<3;G++){var H=3*O+G,X=3*O+(G+1)%3;x.fromBufferAttribute(R,H),y.fromBufferAttribute(R,X),!0===pxlNav_vl(x,y,v)&&(d.push(x.x,x.y,x.z),d.push(y.x,y.y,y.z))}this.setAttribute("position",new pxlNav_bn(d,3))}}copy(u){return super.copy(u),this.parameters=Object.assign({},u.parameters),this}}});class pxlNav_Tl extends pxlNav_tn{constructor(u){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new pxlNav_$r(16777215),this.specular=new pxlNav_$r(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new pxlNav_$r(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new pxlNav_Zs(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new pxlNav_yr,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(u)}copy(u){return super.copy(u),this.color.copy(u.color),this.specular.copy(u.specular),this.shininess=u.shininess,this.map=u.map,this.lightMap=u.lightMap,this.lightMapIntensity=u.lightMapIntensity,this.aoMap=u.aoMap,this.aoMapIntensity=u.aoMapIntensity,this.emissive.copy(u.emissive),this.emissiveMap=u.emissiveMap,this.emissiveIntensity=u.emissiveIntensity,this.bumpMap=u.bumpMap,this.bumpScale=u.bumpScale,this.normalMap=u.normalMap,this.normalMapType=u.normalMapType,this.normalScale.copy(u.normalScale),this.displacementMap=u.displacementMap,this.displacementScale=u.displacementScale,this.displacementBias=u.displacementBias,this.specularMap=u.specularMap,this.alphaMap=u.alphaMap,this.envMap=u.envMap,this.envMapRotation.copy(u.envMapRotation),this.combine=u.combine,this.reflectivity=u.reflectivity,this.refractionRatio=u.refractionRatio,this.wireframe=u.wireframe,this.wireframeLinewidth=u.wireframeLinewidth,this.wireframeLinecap=u.wireframeLinecap,this.wireframeLinejoin=u.wireframeLinejoin,this.flatShading=u.flatShading,this.fog=u.fog,this}}class pxlNav_Il extends pxlNav_tn{constructor(u){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new pxlNav_$r(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new pxlNav_$r(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new pxlNav_Zs(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new pxlNav_yr,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(u)}copy(u){return super.copy(u),this.color.copy(u.color),this.map=u.map,this.lightMap=u.lightMap,this.lightMapIntensity=u.lightMapIntensity,this.aoMap=u.aoMap,this.aoMapIntensity=u.aoMapIntensity,this.emissive.copy(u.emissive),this.emissiveMap=u.emissiveMap,this.emissiveIntensity=u.emissiveIntensity,this.bumpMap=u.bumpMap,this.bumpScale=u.bumpScale,this.normalMap=u.normalMap,this.normalMapType=u.normalMapType,this.normalScale.copy(u.normalScale),this.displacementMap=u.displacementMap,this.displacementScale=u.displacementScale,this.displacementBias=u.displacementBias,this.specularMap=u.specularMap,this.alphaMap=u.alphaMap,this.envMap=u.envMap,this.envMapRotation.copy(u.envMapRotation),this.combine=u.combine,this.reflectivity=u.reflectivity,this.refractionRatio=u.refractionRatio,this.wireframe=u.wireframe,this.wireframeLinewidth=u.wireframeLinewidth,this.wireframeLinecap=u.wireframeLinecap,this.wireframeLinejoin=u.wireframeLinejoin,this.flatShading=u.flatShading,this.fog=u.fog,this}}function pxlNav_Pl(u,d,v){return!u||!v&&u.constructor===d?u:"number"==typeof d.BYTES_PER_ELEMENT?new d(u):Array.prototype.slice.call(u)}function pxlNav_Ol(u){return ArrayBuffer.isView(u)&&!(u instanceof DataView)}function pxlNav_Fl(u){for(var d=u.length,v=new Array(d),x=0;x!==d;++x)v[x]=x;return v.sort((function(d,v){return u[d]-u[v]})),v}function pxlNav_Nl(u,d,v){for(var x=u.length,y=new u.constructor(x),b=0,_=0;_!==x;++b)for(var w=v[b]*d,S=0;S!==d;++S)y[_++]=u[w+S];return y}function pxlNav_Ll(u,d,v,x){for(var y=1,b=u[0];void 0!==b&&void 0===b[x];)b=u[y++];if(void 0!==b){var _=b[x];if(void 0!==_)if(Array.isArray(_))do{void 0!==(_=b[x])&&(d.push(b.time),v.push.apply(v,_)),b=u[y++]}while(void 0!==b);else if(void 0!==_.toArray)do{void 0!==(_=b[x])&&(d.push(b.time),_.toArray(v,v.length)),b=u[y++]}while(void 0!==b);else do{void 0!==(_=b[x])&&(d.push(b.time),v.push(_)),b=u[y++]}while(void 0!==b)}}class pxlNav_Wl{constructor(u,d,v,x){this.parameterPositions=u,this._cachedIndex=0,this.resultBuffer=void 0!==x?x:new d.constructor(v),this.sampleValues=d,this.valueSize=v,this.settings=null,this.DefaultSettings_={}}evaluate(u){var d=this.parameterPositions,v=this._cachedIndex,x=d[v],y=d[v-1];e:{t:{var b;i:{s:if(!(u<x)){for(var _=v+2;;){if(void 0===x){if(u<y)break s;return v=d.length,this._cachedIndex=v,this.copySampleValue_(v-1)}if(v===_)break;if(y=x,u<(x=d[++v]))break t}b=d.length;break i}if(u>=y)break e;var w=d[1];u<w&&(v=2,y=w);for(var S=v-2;;){if(void 0===y)return this._cachedIndex=0,this.copySampleValue_(0);if(v===S)break;if(x=y,u>=(y=d[--v-1]))break t}b=v,v=0}for(;v<b;){var C=v+b>>>1;u<d[C]?b=C:v=C+1}if(x=d[v],void 0===(y=d[v-1]))return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===x)return v=d.length,this._cachedIndex=v,this.copySampleValue_(v-1)}this._cachedIndex=v,this.intervalChanged_(v,y,x)}return this.interpolate_(v,y,u,x)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(u){for(var d=this.resultBuffer,v=this.sampleValues,x=this.valueSize,y=u*x,b=0;b!==x;++b)d[b]=v[y+b];return d}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class pxlNav_Ul extends pxlNav_Wl{constructor(u,d,v,x){super(u,d,v,x),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:te,endingEnd:te}}intervalChanged_(u,d,v){var x=this.parameterPositions,y=u-2,b=u+1,_=x[y],w=x[b];if(void 0===_)switch(this.getSettings_().endingStart){case ie:y=u,_=2*d-v;break;case se:_=d+x[y=x.length-2]-x[y+1];break;default:y=u,_=v}if(void 0===w)switch(this.getSettings_().endingEnd){case ie:b=u,w=2*v-d;break;case se:b=1,w=v+x[1]-x[0];break;default:b=u-1,w=d}var S=.5*(v-d),C=this.valueSize;this._weightPrev=S/(d-_),this._weightNext=S/(w-v),this._offsetPrev=y*C,this._offsetNext=b*C}interpolate_(u,d,v,x){for(var y=this.resultBuffer,b=this.sampleValues,_=this.valueSize,w=u*_,S=w-_,C=this._offsetPrev,P=this._offsetNext,A=this._weightPrev,T=this._weightNext,E=(v-d)/(x-d),D=E*E,I=D*E,k=-A*I+2*A*D-A*E,R=(1+A)*I+(-1.5-2*A)*D+(-.5+A)*E+1,O=(-1-T)*I+(1.5+T)*D+.5*E,j=T*I-T*D,G=0;G!==_;++G)y[G]=k*b[C+G]+R*b[S+G]+O*b[w+G]+j*b[P+G];return y}}class pxlNav_jl extends pxlNav_Wl{constructor(u,d,v,x){super(u,d,v,x)}interpolate_(u,d,v,x){for(var y=this.resultBuffer,b=this.sampleValues,_=this.valueSize,w=u*_,S=w-_,C=(v-d)/(x-d),P=1-C,A=0;A!==_;++A)y[A]=b[S+A]*P+b[w+A]*C;return y}}class pxlNav_Dl extends pxlNav_Wl{constructor(u,d,v,x){super(u,d,v,x)}interpolate_(u){return this.copySampleValue_(u-1)}}class pxlNav_Hl{constructor(u,d,v,x){if(void 0===u)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===d||0===d.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+u);this.name=u,this.times=pxlNav_Pl(d,this.TimeBufferType),this.values=pxlNav_Pl(v,this.ValueBufferType),this.setInterpolation(x||this.DefaultInterpolation)}static toJSON(u){var d,v=u.constructor;if(v.toJSON!==this.toJSON)d=v.toJSON(u);else{d={name:u.name,times:pxlNav_Pl(u.times,Array),values:pxlNav_Pl(u.values,Array)};var x=u.getInterpolation();x!==u.DefaultInterpolation&&(d.interpolation=x)}return d.type=u.ValueTypeName,d}InterpolantFactoryMethodDiscrete(u){return new pxlNav_Dl(this.times,this.values,this.getValueSize(),u)}InterpolantFactoryMethodLinear(u){return new pxlNav_jl(this.times,this.values,this.getValueSize(),u)}InterpolantFactoryMethodSmooth(u){return new pxlNav_Ul(this.times,this.values,this.getValueSize(),u)}setInterpolation(u){var d;switch(u){case Y:d=this.InterpolantFactoryMethodDiscrete;break;case $:d=this.InterpolantFactoryMethodLinear;break;case ee:d=this.InterpolantFactoryMethodSmooth}if(void 0===d){var v="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(u===this.DefaultInterpolation)throw new Error(v);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",v),this}return this.createInterpolant=d,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Y;case this.InterpolantFactoryMethodLinear:return $;case this.InterpolantFactoryMethodSmooth:return ee}}getValueSize(){return this.values.length/this.times.length}shift(u){if(0!==u)for(var d=this.times,v=0,x=d.length;v!==x;++v)d[v]+=u;return this}scale(u){if(1!==u)for(var d=this.times,v=0,x=d.length;v!==x;++v)d[v]*=u;return this}trim(u,d){for(var v=this.times,x=v.length,y=0,b=x-1;y!==x&&v[y]<u;)++y;for(;-1!==b&&v[b]>d;)--b;if(++b,0!==y||b!==x){y>=b&&(y=(b=Math.max(b,1))-1);var _=this.getValueSize();this.times=v.slice(y,b),this.values=this.values.slice(y*_,b*_)}return this}validate(){var u=!0,d=this.getValueSize();d-Math.floor(d)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),u=!1);var v=this.times,x=this.values,y=v.length;0===y&&(console.error("THREE.KeyframeTrack: Track is empty.",this),u=!1);for(var b=null,_=0;_!==y;_++){var w=v[_];if("number"==typeof w&&isNaN(w)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,_,w),u=!1;break}if(null!==b&&b>w){console.error("THREE.KeyframeTrack: Out of order keys.",this,_,w,b),u=!1;break}b=w}if(void 0!==x&&pxlNav_Ol(x))for(var S=0,C=x.length;S!==C;++S){var P=x[S];if(isNaN(P)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,S,P),u=!1;break}}return u}optimize(){for(var u=this.times.slice(),d=this.values.slice(),v=this.getValueSize(),x=this.getInterpolation()===ee,y=u.length-1,b=1,_=1;_<y;++_){var w=!1,S=u[_];if(S!==u[_+1]&&(1!==_||S!==u[0]))if(x)w=!0;else for(var C=_*v,P=C-v,A=C+v,T=0;T!==v;++T){var E=d[C+T];if(E!==d[P+T]||E!==d[A+T]){w=!0;break}}if(w){if(_!==b){u[b]=u[_];for(var D=_*v,I=b*v,k=0;k!==v;++k)d[I+k]=d[D+k]}++b}}if(y>0){u[b]=u[y];for(var R=y*v,O=b*v,j=0;j!==v;++j)d[O+j]=d[R+j];++b}return b!==u.length?(this.times=u.slice(0,b),this.values=d.slice(0,b*v)):(this.times=u,this.values=d),this}clone(){var u=this.times.slice(),d=this.values.slice(),v=new(0,this.constructor)(this.name,u,d);return v.createInterpolant=this.createInterpolant,v}}pxlNav_Hl.prototype.TimeBufferType=Float32Array,pxlNav_Hl.prototype.ValueBufferType=Float32Array,pxlNav_Hl.prototype.DefaultInterpolation=$;class pxlNav_ql extends pxlNav_Hl{constructor(u,d,v){super(u,d,v)}}pxlNav_ql.prototype.ValueTypeName="bool",pxlNav_ql.prototype.ValueBufferType=Array,pxlNav_ql.prototype.DefaultInterpolation=Y,pxlNav_ql.prototype.InterpolantFactoryMethodLinear=void 0,pxlNav_ql.prototype.InterpolantFactoryMethodSmooth=void 0;class pxlNav_Jl extends pxlNav_Hl{}pxlNav_Jl.prototype.ValueTypeName="color";class pxlNav_Xl extends pxlNav_Hl{}pxlNav_Xl.prototype.ValueTypeName="number";class pxlNav_Yl extends pxlNav_Wl{constructor(u,d,v,x){super(u,d,v,x)}interpolate_(u,d,v,x){for(var y=this.resultBuffer,b=this.sampleValues,_=this.valueSize,w=(v-d)/(x-d),S=u*_,C=S+_;S!==C;S+=4)pxlNav_Ci.slerpFlat(y,0,b,S-_,b,S,w);return y}}class pxlNav_Zl extends pxlNav_Hl{InterpolantFactoryMethodLinear(u){return new pxlNav_Yl(this.times,this.values,this.getValueSize(),u)}}pxlNav_Zl.prototype.ValueTypeName="quaternion",pxlNav_Zl.prototype.InterpolantFactoryMethodSmooth=void 0;class pxlNav_Gl extends pxlNav_Hl{constructor(u,d,v){super(u,d,v)}}pxlNav_Gl.prototype.ValueTypeName="string",pxlNav_Gl.prototype.ValueBufferType=Array,pxlNav_Gl.prototype.DefaultInterpolation=Y,pxlNav_Gl.prototype.InterpolantFactoryMethodLinear=void 0,pxlNav_Gl.prototype.InterpolantFactoryMethodSmooth=void 0;class pxlNav_$l extends pxlNav_Hl{}pxlNav_$l.prototype.ValueTypeName="vector";class pxlNav_Ql{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2500;this.name=u,this.tracks=v,this.duration=d,this.blendMode=x,this.uuid=pxlNav_js(),this.duration<0&&this.resetDuration()}static parse(u){for(var d=[],v=u.tracks,x=1/(u.fps||1),y=0,b=v.length;y!==b;++y)d.push(pxlNav_Kl(v[y]).scale(x));var _=new this(u.name,u.duration,d,u.blendMode);return _.uuid=u.uuid,_}static toJSON(u){for(var d=[],v=u.tracks,x={name:u.name,duration:u.duration,tracks:d,uuid:u.uuid,blendMode:u.blendMode},y=0,b=v.length;y!==b;++y)d.push(pxlNav_Hl.toJSON(v[y]));return x}static CreateFromMorphTargetSequence(u,d,v,x){for(var y=d.length,b=[],_=0;_<y;_++){var w=[],S=[];w.push((_+y-1)%y,_,(_+1)%y),S.push(0,1,0);var C=pxlNav_Fl(w);w=pxlNav_Nl(w,1,C),S=pxlNav_Nl(S,1,C),x||0!==w[0]||(w.push(y),S.push(S[0])),b.push(new pxlNav_Xl(".morphTargetInfluences["+d[_].name+"]",w,S).scale(1/v))}return new this(u,-1,b)}static findByName(u,d){var v=u;if(!Array.isArray(u)){var x=u;v=x.geometry&&x.geometry.animations||x.animations}for(var y=0;y<v.length;y++)if(v[y].name===d)return v[y];return null}static CreateClipsFromMorphTargetSequences(u,d,v){for(var x={},y=/^([\w-]*?)([\d]+)$/,b=0,_=u.length;b<_;b++){var w=u[b],S=w.name.match(y);if(S&&S.length>1){var C=S[1],P=x[C];P||(x[C]=P=[]),P.push(w)}}var A=[];for(var T in x)A.push(this.CreateFromMorphTargetSequence(T,x[T],d,v));return A}static parseAnimation(u,d){if(!u)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var v=function s(u,d,v,x,y){if(0!==v.length){var b=[],_=[];pxlNav_Ll(v,b,_,x),0!==b.length&&y.push(new u(d,b,_))}},x=[],y=u.name||"default",b=u.fps||30,_=u.blendMode,w=u.length||-1,S=u.hierarchy||[],C=0;C<S.length;C++){var P=S[C].keys;if(P&&0!==P.length)if(P[0].morphTargets){var A={},T=void 0;for(T=0;T<P.length;T++)if(P[T].morphTargets)for(var E=0;E<P[T].morphTargets.length;E++)A[P[T].morphTargets[E]]=-1;for(var D in A){for(var I=[],k=[],R=0;R!==P[T].morphTargets.length;++R){var O=P[T];I.push(O.time),k.push(O.morphTarget===D?1:0)}x.push(new pxlNav_Xl(".morphTargetInfluence["+D+"]",I,k))}w=A.length*b}else{var j=".bones["+d[C].name+"]";v(pxlNav_$l,j+".position",P,"pos",x),v(pxlNav_Zl,j+".quaternion",P,"rot",x),v(pxlNav_$l,j+".scale",P,"scl",x)}}return 0===x.length?null:new this(y,w,x,_)}resetDuration(){for(var u=0,d=0,v=this.tracks.length;d!==v;++d){var x=this.tracks[d];u=Math.max(u,x.times[x.times.length-1])}return this.duration=u,this}trim(){for(var u=0;u<this.tracks.length;u++)this.tracks[u].trim(0,this.duration);return this}validate(){for(var u=!0,d=0;d<this.tracks.length;d++)u=u&&this.tracks[d].validate();return u}optimize(){for(var u=0;u<this.tracks.length;u++)this.tracks[u].optimize();return this}clone(){for(var u=[],d=0;d<this.tracks.length;d++)u.push(this.tracks[d].clone());return new this.constructor(this.name,this.duration,u,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function pxlNav_Kl(u){if(void 0===u.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var d=function(u){switch(u.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return pxlNav_Xl;case"vector":case"vector2":case"vector3":case"vector4":return pxlNav_$l;case"color":return pxlNav_Jl;case"quaternion":return pxlNav_Zl;case"bool":case"boolean":return pxlNav_ql;case"string":return pxlNav_Gl}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+u)}(u.type);if(void 0===u.times){var v=[],x=[];pxlNav_Ll(u.keys,v,x,"value"),u.times=v,u.values=x}return void 0!==d.parse?d.parse(u):new d(u.name,u.times,u.values,u.interpolation)}var Ui={enabled:!1,files:{},add:function add(u,d){!1!==this.enabled&&(this.files[u]=d)},get:function get(u){if(!1!==this.enabled)return this.files[u]},remove:function remove(u){delete this.files[u]},clear:function clear(){this.files={}}};class pxlNav_ec{constructor(u,d,v){var x,y=this,b=!1,_=0,w=0,S=[];this.onStart=void 0,this.onLoad=u,this.onProgress=d,this.onError=v,this.itemStart=function(u){w++,!1===b&&void 0!==y.onStart&&y.onStart(u,_,w),b=!0},this.itemEnd=function(u){_++,void 0!==y.onProgress&&y.onProgress(u,_,w),_===w&&(b=!1,void 0!==y.onLoad&&y.onLoad())},this.itemError=function(u){void 0!==y.onError&&y.onError(u)},this.resolveURL=function(u){return x?x(u):u},this.setURLModifier=function(u){return x=u,this},this.addHandler=function(u,d){return S.push(u,d),this},this.removeHandler=function(u){var d=S.indexOf(u);return-1!==d&&S.splice(d,2),this},this.getHandler=function(u){for(var d=0,v=S.length;d<v;d+=2){var x=S[d],y=S[d+1];if(x.global&&(x.lastIndex=0),x.test(u))return y}return null}}}var Fi=new pxlNav_ec;class pxlNav_ic{constructor(u){this.manager=void 0!==u?u:Fi,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(u,d){var v=this;return new Promise((function(x,y){v.load(u,x,d,y)}))}parse(){}setCrossOrigin(u){return this.crossOrigin=u,this}setWithCredentials(u){return this.withCredentials=u,this}setPath(u){return this.path=u,this}setResourcePath(u){return this.resourcePath=u,this}setRequestHeader(u){return this.requestHeader=u,this}}pxlNav_ic.DEFAULT_MATERIAL_NAME="__DEFAULT";var ji={};class pxlNav_nc extends Error{constructor(u,d){super(u),this.response=d}}class pxlNav_oc extends pxlNav_ic{constructor(u){super(u)}load(u,d,v,x){void 0===u&&(u=""),void 0!==this.path&&(u=this.path+u),u=this.manager.resolveURL(u);var y=Ui.get(u);if(void 0!==y)return this.manager.itemStart(u),setTimeout((()=>{d&&d(y),this.manager.itemEnd(u)}),0),y;if(void 0===ji[u]){ji[u]=[],ji[u].push({onLoad:d,onProgress:v,onError:x});var b=new Request(u,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),_=this.mimeType,w=this.responseType;fetch(b).then((d=>{if(200===d.status||0===d.status){if(0===d.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===d.body||void 0===d.body.getReader)return d;var v=ji[u],x=d.body.getReader(),y=d.headers.get("X-File-Size")||d.headers.get("Content-Length"),b=y?parseInt(y):0,_=0!==b,w=0,S=new ReadableStream({start(u){!function e(){x.read().then((d=>{var{done:x,value:y}=d;if(x)u.close();else{w+=y.byteLength;for(var S=new ProgressEvent("progress",{lengthComputable:_,loaded:w,total:b}),C=0,P=v.length;C<P;C++){var A=v[C];A.onProgress&&A.onProgress(S)}u.enqueue(y),e()}}),(d=>{u.error(d)}))}()}});return new Response(S)}throw new pxlNav_nc('fetch for "'.concat(d.url,'" responded with ').concat(d.status,": ").concat(d.statusText),d)})).then((u=>{switch(w){case"arraybuffer":return u.arrayBuffer();case"blob":return u.blob();case"document":return u.text().then((u=>(new DOMParser).parseFromString(u,_)));case"json":return u.json();default:if(void 0===_)return u.text();var d=/charset="?([^;"\s]*)"?/i.exec(_),v=d&&d[1]?d[1].toLowerCase():void 0,x=new TextDecoder(v);return u.arrayBuffer().then((u=>x.decode(u)))}})).then((d=>{Ui.add(u,d);var v=ji[u];delete ji[u];for(var x=0,y=v.length;x<y;x++){var b=v[x];b.onLoad&&b.onLoad(d)}})).catch((d=>{var v=ji[u];if(void 0===v)throw this.manager.itemError(u),d;delete ji[u];for(var x=0,y=v.length;x<y;x++){var b=v[x];b.onError&&b.onError(d)}this.manager.itemError(u)})).finally((()=>{this.manager.itemEnd(u)})),this.manager.itemStart(u)}else ji[u].push({onLoad:d,onProgress:v,onError:x})}setResponseType(u){return this.responseType=u,this}setMimeType(u){return this.mimeType=u,this}}class pxlNav_lc extends pxlNav_ic{constructor(u){super(u)}load(u,d,v,x){void 0!==this.path&&(u=this.path+u),u=this.manager.resolveURL(u);var y=this,b=Ui.get(u);if(void 0!==b)return y.manager.itemStart(u),setTimeout((function(){d&&d(b),y.manager.itemEnd(u)}),0),b;var _=pxlNav_ei("img");function a(){l(),Ui.add(u,this),d&&d(this),y.manager.itemEnd(u)}function h(d){l(),x&&x(d),y.manager.itemError(u),y.manager.itemEnd(u)}function l(){_.removeEventListener("load",a,!1),_.removeEventListener("error",h,!1)}return _.addEventListener("load",a,!1),_.addEventListener("error",h,!1),"data:"!==u.slice(0,5)&&void 0!==this.crossOrigin&&(_.crossOrigin=this.crossOrigin),y.manager.itemStart(u),_.src=u,_}}class pxlNav_dc extends pxlNav_ic{constructor(u){super(u)}load(u,d,v,x){var y=new pxlNav_vi,b=new pxlNav_lc(this.manager);return b.setCrossOrigin(this.crossOrigin),b.setPath(this.path),b.load(u,(function(u){y.image=u,y.needsUpdate=!0,void 0!==d&&d(y)}),v,x),y}}class pxlNav_pc extends pxlNav_Er{constructor(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;super(),this.isLight=!0,this.type="Light",this.color=new pxlNav_$r(u),this.intensity=d}dispose(){}copy(u,d){return super.copy(u,d),this.color.copy(u.color),this.intensity=u.intensity,this}toJSON(u){var d=super.toJSON(u);return d.object.color=this.color.getHex(),d.object.intensity=this.intensity,void 0!==this.groundColor&&(d.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(d.object.distance=this.distance),void 0!==this.angle&&(d.object.angle=this.angle),void 0!==this.decay&&(d.object.decay=this.decay),void 0!==this.penumbra&&(d.object.penumbra=this.penumbra),void 0!==this.shadow&&(d.object.shadow=this.shadow.toJSON()),void 0!==this.target&&(d.object.target=this.target.uuid),d}}var zi=new pxlNav_nr,Gi=new pxlNav_Ii,Hi=new pxlNav_Ii;class pxlNav_xc{constructor(u){this.camera=u,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new pxlNav_Zs(512,512),this.map=null,this.mapPass=null,this.matrix=new pxlNav_nr,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new pxlNav_ra,this._frameExtents=new pxlNav_Zs(1,1),this._viewportCount=1,this._viewports=[new pxlNav_wi(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(u){var d=this.camera,v=this.matrix;Gi.setFromMatrixPosition(u.matrixWorld),d.position.copy(Gi),Hi.setFromMatrixPosition(u.target.matrixWorld),d.lookAt(Hi),d.updateMatrixWorld(),zi.multiplyMatrices(d.projectionMatrix,d.matrixWorldInverse),this._frustum.setFromProjectionMatrix(zi),v.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),v.multiply(zi)}getViewport(u){return this._viewports[u]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(u){return this.camera=u.camera.clone(),this.intensity=u.intensity,this.bias=u.bias,this.radius=u.radius,this.mapSize.copy(u.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){var u={};return 1!==this.intensity&&(u.intensity=this.intensity),0!==this.bias&&(u.bias=this.bias),0!==this.normalBias&&(u.normalBias=this.normalBias),1!==this.radius&&(u.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(u.mapSize=this.mapSize.toArray()),u.camera=this.camera.toJSON(!1).object,delete u.camera.matrix,u}}class pxlNav_bc extends pxlNav_xc{constructor(){super(new pxlNav_$n(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(u){var d=this.camera,v=2*ve*u.angle*this.focus,x=this.mapSize.width/this.mapSize.height,y=u.distance||d.far;v===d.fov&&x===d.aspect&&y===d.far||(d.fov=v,d.aspect=x,d.far=y,d.updateProjectionMatrix()),super.updateMatrices(u)}copy(u){return super.copy(u),this.focus=u.focus,this}}class pxlNav_vc extends pxlNav_pc{constructor(u,d){var v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2;super(u,d),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(pxlNav_Er.DEFAULT_UP),this.updateMatrix(),this.target=new pxlNav_Er,this.distance=v,this.angle=x,this.penumbra=y,this.decay=b,this.map=null,this.shadow=new pxlNav_bc}get power(){return this.intensity*Math.PI}set power(u){this.intensity=u/Math.PI}dispose(){this.shadow.dispose()}copy(u,d){return super.copy(u,d),this.distance=u.distance,this.angle=u.angle,this.penumbra=u.penumbra,this.decay=u.decay,this.target=u.target.clone(),this.shadow=u.shadow.clone(),this}}var Wi=new pxlNav_nr,Xi=new pxlNav_Ii,qi=new pxlNav_Ii;class js_pxlNav_c extends pxlNav_xc{constructor(){super(new pxlNav_$n(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new pxlNav_Zs(4,2),this._viewportCount=6,this._viewports=[new pxlNav_wi(2,1,1,1),new pxlNav_wi(0,1,1,1),new pxlNav_wi(3,1,1,1),new pxlNav_wi(1,1,1,1),new pxlNav_wi(3,0,1,1),new pxlNav_wi(1,0,1,1)],this._cubeDirections=[new pxlNav_Ii(1,0,0),new pxlNav_Ii(-1,0,0),new pxlNav_Ii(0,0,1),new pxlNav_Ii(0,0,-1),new pxlNav_Ii(0,1,0),new pxlNav_Ii(0,-1,0)],this._cubeUps=[new pxlNav_Ii(0,1,0),new pxlNav_Ii(0,1,0),new pxlNav_Ii(0,1,0),new pxlNav_Ii(0,1,0),new pxlNav_Ii(0,0,1),new pxlNav_Ii(0,0,-1)]}updateMatrices(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=this.camera,x=this.matrix,y=u.distance||v.far;y!==v.far&&(v.far=y,v.updateProjectionMatrix()),Xi.setFromMatrixPosition(u.matrixWorld),v.position.copy(Xi),qi.copy(v.position),qi.add(this._cubeDirections[d]),v.up.copy(this._cubeUps[d]),v.lookAt(qi),v.updateMatrixWorld(),x.makeTranslation(-Xi.x,-Xi.y,-Xi.z),Wi.multiplyMatrices(v.projectionMatrix,v.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Wi)}}class pxlNav_Ac extends pxlNav_pc{constructor(u,d){var v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;super(u,d),this.isPointLight=!0,this.type="PointLight",this.distance=v,this.decay=x,this.shadow=new js_pxlNav_c}get power(){return 4*this.intensity*Math.PI}set power(u){this.intensity=u/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(u,d){return super.copy(u,d),this.distance=u.distance,this.decay=u.decay,this.shadow=u.shadow.clone(),this}}class pxlNav_Tc extends pxlNav_Xn{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=u,this.right=d,this.top=v,this.bottom=x,this.near=y,this.far=b,this.updateProjectionMatrix()}copy(u,d){return super.copy(u,d),this.left=u.left,this.right=u.right,this.top=u.top,this.bottom=u.bottom,this.near=u.near,this.far=u.far,this.zoom=u.zoom,this.view=null===u.view?null:Object.assign({},u.view),this}setViewOffset(u,d,v,x,y,b){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=u,this.view.fullHeight=d,this.view.offsetX=v,this.view.offsetY=x,this.view.width=y,this.view.height=b,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){var u=(this.right-this.left)/(2*this.zoom),d=(this.top-this.bottom)/(2*this.zoom),v=(this.right+this.left)/2,x=(this.top+this.bottom)/2,y=v-u,b=v+u,_=x+d,w=x-d;if(null!==this.view&&this.view.enabled){var S=(this.right-this.left)/this.view.fullWidth/this.zoom,C=(this.top-this.bottom)/this.view.fullHeight/this.zoom;b=(y+=S*this.view.offsetX)+S*this.view.width,w=(_-=C*this.view.offsetY)-C*this.view.height}this.projectionMatrix.makeOrthographic(y,b,_,w,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(u){var d=super.toJSON(u);return d.object.zoom=this.zoom,d.object.left=this.left,d.object.right=this.right,d.object.top=this.top,d.object.bottom=this.bottom,d.object.near=this.near,d.object.far=this.far,null!==this.view&&(d.object.view=Object.assign({},this.view)),d}}class pxlNav_zc extends pxlNav_xc{constructor(){super(new pxlNav_Tc(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class pxlNav_Cc extends pxlNav_pc{constructor(u,d){super(u,d),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(pxlNav_Er.DEFAULT_UP),this.updateMatrix(),this.target=new pxlNav_Er,this.shadow=new pxlNav_zc}dispose(){this.shadow.dispose()}copy(u){return super.copy(u),this.target=u.target.clone(),this.shadow=u.shadow.clone(),this}}class pxlNav_Ic extends pxlNav_pc{constructor(u,d){super(u,d),this.isAmbientLight=!0,this.type="AmbientLight"}}class pxlNav_Pc{static decodeText(u){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),"undefined"!=typeof TextDecoder)return(new TextDecoder).decode(u);for(var d="",v=0,x=u.length;v<x;v++)d+=String.fromCharCode(u[v]);try{return decodeURIComponent(escape(d))}catch(u){return d}}static extractUrlBase(u){var d=u.lastIndexOf("/");return-1===d?"./":u.slice(0,d+1)}static resolveURL(u,d){return"string"!=typeof u||""===u?"":(/^https?:\/\//i.test(d)&&/^\//.test(u)&&(d=d.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(u)||/^data:.*,.*$/i.test(u)||/^blob:.*$/i.test(u)?u:d+u)}}new pxlNav_nr,new pxlNav_nr,new pxlNav_nr;new pxlNav_Ii,new pxlNav_Ci,new pxlNav_Ii,new pxlNav_Ii;new pxlNav_Ii,new pxlNav_Ci,new pxlNav_Ii,new pxlNav_Ii;var Zi="\\[\\]\\.:\\/",Ji=new RegExp("["+Zi+"]","g"),Qi="[^"+Zi+"]",Ki="[^"+Zi.replace("\\.","")+"]",Yi=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Qi)+/(WCOD+)?/.source.replace("WCOD",Ki)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Qi)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Qi)+"$"),$i=["material","materials","bones","map"];class pxlNav_gu{constructor(u,d,v){this.path=d,this.parsedPath=v||pxlNav_gu.parseTrackName(d),this.node=pxlNav_gu.findNode(u,this.parsedPath.nodeName),this.rootNode=u,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(u,d,v){return u&&u.isAnimationObjectGroup?new pxlNav_gu.Composite(u,d,v):new pxlNav_gu(u,d,v)}static sanitizeNodeName(u){return u.replace(/\s/g,"_").replace(Ji,"")}static parseTrackName(u){var d=Yi.exec(u);if(null===d)throw new Error("PropertyBinding: Cannot parse trackName: "+u);var v={nodeName:d[2],objectName:d[3],objectIndex:d[4],propertyName:d[5],propertyIndex:d[6]},x=v.nodeName&&v.nodeName.lastIndexOf(".");if(void 0!==x&&-1!==x){var y=v.nodeName.substring(x+1);-1!==$i.indexOf(y)&&(v.nodeName=v.nodeName.substring(0,x),v.objectName=y)}if(null===v.propertyName||0===v.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+u);return v}static findNode(u,d){if(void 0===d||""===d||"."===d||-1===d||d===u.name||d===u.uuid)return u;if(u.skeleton){var v=u.skeleton.getBoneByName(d);if(void 0!==v)return v}if(u.children){var x=function _s238(u){for(var v=0;v<u.length;v++){var x=u[v];if(x.name===d||x.uuid===d)return x;var y=_s238(x.children);if(y)return y}return null}(u.children);if(x)return x}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(u,d){u[d]=this.targetObject[this.propertyName]}_getValue_array(u,d){for(var v=this.resolvedProperty,x=0,y=v.length;x!==y;++x)u[d++]=v[x]}_getValue_arrayElement(u,d){u[d]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(u,d){this.resolvedProperty.toArray(u,d)}_setValue_direct(u,d){this.targetObject[this.propertyName]=u[d]}_setValue_direct_setNeedsUpdate(u,d){this.targetObject[this.propertyName]=u[d],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(u,d){this.targetObject[this.propertyName]=u[d],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(u,d){for(var v=this.resolvedProperty,x=0,y=v.length;x!==y;++x)v[x]=u[d++]}_setValue_array_setNeedsUpdate(u,d){for(var v=this.resolvedProperty,x=0,y=v.length;x!==y;++x)v[x]=u[d++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(u,d){for(var v=this.resolvedProperty,x=0,y=v.length;x!==y;++x)v[x]=u[d++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(u,d){this.resolvedProperty[this.propertyIndex]=u[d]}_setValue_arrayElement_setNeedsUpdate(u,d){this.resolvedProperty[this.propertyIndex]=u[d],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(u,d){this.resolvedProperty[this.propertyIndex]=u[d],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(u,d){this.resolvedProperty.fromArray(u,d)}_setValue_fromArray_setNeedsUpdate(u,d){this.resolvedProperty.fromArray(u,d),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(u,d){this.resolvedProperty.fromArray(u,d),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(u,d){this.bind(),this.getValue(u,d)}_setValue_unbound(u,d){this.bind(),this.setValue(u,d)}bind(){var u=this.node,d=this.parsedPath,v=d.objectName,x=d.propertyName,y=d.propertyIndex;if(u||(u=pxlNav_gu.findNode(this.rootNode,d.nodeName),this.node=u),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,u){if(v){var b=d.objectIndex;switch(v){case"materials":if(!u.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!u.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);u=u.material.materials;break;case"bones":if(!u.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);u=u.skeleton.bones;for(var _=0;_<u.length;_++)if(u[_].name===b){b=_;break}break;case"map":if("map"in u){u=u.map;break}if(!u.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!u.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);u=u.material.map;break;default:if(void 0===u[v])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);u=u[v]}if(void 0!==b){if(void 0===u[b])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,u);u=u[b]}}var w=u[x];if(void 0!==w){var S=this.Versioning.None;this.targetObject=u,void 0!==u.needsUpdate?S=this.Versioning.NeedsUpdate:void 0!==u.matrixWorldNeedsUpdate&&(S=this.Versioning.MatrixWorldNeedsUpdate);var C=this.BindingType.Direct;if(void 0!==y){if("morphTargetInfluences"===x){if(!u.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!u.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==u.morphTargetDictionary[y]&&(y=u.morphTargetDictionary[y])}C=this.BindingType.ArrayElement,this.resolvedProperty=w,this.propertyIndex=y}else void 0!==w.fromArray&&void 0!==w.toArray?(C=this.BindingType.HasFromToArray,this.resolvedProperty=w):Array.isArray(w)?(C=this.BindingType.EntireArray,this.resolvedProperty=w):this.propertyName=x;this.getValue=this.GetterByBindingType[C],this.setValue=this.SetterByBindingTypeAndVersioning[C][S]}else{var P=d.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+P+"."+x+" but it wasn't found.",u)}}else console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".")}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}pxlNav_gu.Composite=class{constructor(u,d,v){var x=v||pxlNav_gu.parseTrackName(d);this._targetGroup=u,this._bindings=u.subscribe_(d,x)}getValue(u,d){this.bind();var v=this._targetGroup.nCachedObjects_,x=this._bindings[v];void 0!==x&&x.getValue(u,d)}setValue(u,d){for(var v=this._bindings,x=this._targetGroup.nCachedObjects_,y=v.length;x!==y;++x)v[x].setValue(u,d)}bind(){for(var u=this._bindings,d=this._targetGroup.nCachedObjects_,v=u.length;d!==v;++d)u[d].bind()}unbind(){for(var u=this._bindings,d=this._targetGroup.nCachedObjects_,v=u.length;d!==v;++d)u[d].unbind()}},pxlNav_gu.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},pxlNav_gu.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},pxlNav_gu.prototype.GetterByBindingType=[pxlNav_gu.prototype._getValue_direct,pxlNav_gu.prototype._getValue_array,pxlNav_gu.prototype._getValue_arrayElement,pxlNav_gu.prototype._getValue_toArray],pxlNav_gu.prototype.SetterByBindingTypeAndVersioning=[[pxlNav_gu.prototype._setValue_direct,pxlNav_gu.prototype._setValue_direct_setNeedsUpdate,pxlNav_gu.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[pxlNav_gu.prototype._setValue_array,pxlNav_gu.prototype._setValue_array_setNeedsUpdate,pxlNav_gu.prototype._setValue_array_setMatrixWorldNeedsUpdate],[pxlNav_gu.prototype._setValue_arrayElement,pxlNav_gu.prototype._setValue_arrayElement_setNeedsUpdate,pxlNav_gu.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[pxlNav_gu.prototype._setValue_fromArray,pxlNav_gu.prototype._setValue_fromArray_setNeedsUpdate,pxlNav_gu.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];new Float32Array(1);new pxlNav_nr;new pxlNav_Zs;new pxlNav_Ii,new pxlNav_Ii;new pxlNav_Ii;new pxlNav_Ii,new pxlNav_nr,new pxlNav_nr;new pxlNav_Ii,new pxlNav_$r,new pxlNav_$r;new pxlNav_Ii,new pxlNav_Ii,new pxlNav_Ii;new pxlNav_Ii,new pxlNav_Xn;new pxlNav_Ei;new pxlNav_Ii;"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"171"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="171");var es=Uint8Array,ts=Uint16Array,is=Int32Array,ss=new es([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),rs=new es([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),as=new es([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ns=function freb(u,d){for(var v=new ts(31),x=0;x<31;++x)v[x]=d+=1<<u[x-1];var y=new is(v[30]);for(x=1;x<30;++x)for(var b=v[x];b<v[x+1];++b)y[b]=b-v[x]<<5|x;return{b:v,r:y}},os=ns(ss,2),ls=os.b,hs=os.r;ls[28]=258,hs[258]=28;for(var us=ns(rs,0),cs=us.b,ps=(us.r,new ts(32768)),ds=0;ds<32768;++ds){var vs=(43690&ds)>>1|(21845&ds)<<1;vs=(61680&(vs=(52428&vs)>>2|(13107&vs)<<2))>>4|(3855&vs)<<4,ps[ds]=((65280&vs)>>8|(255&vs)<<8)>>1}var ms=function hMap(u,d,v){for(var x=u.length,y=0,b=new ts(d);y<x;++y)u[y]&&++b[u[y]-1];var _,w=new ts(d);for(y=1;y<d;++y)w[y]=w[y-1]+b[y-1]<<1;if(v){_=new ts(1<<d);var S=15-d;for(y=0;y<x;++y)if(u[y])for(var C=y<<4|u[y],P=d-u[y],A=w[u[y]-1]++<<P,T=A|(1<<P)-1;A<=T;++A)_[ps[A]>>S]=C}else for(_=new ts(x),y=0;y<x;++y)u[y]&&(_[y]=ps[w[u[y]-1]++]>>15-u[y]);return _},xs=new es(288);for(ds=0;ds<144;++ds)xs[ds]=8;for(ds=144;ds<256;++ds)xs[ds]=9;for(ds=256;ds<280;++ds)xs[ds]=7;for(ds=280;ds<288;++ds)xs[ds]=8;var gs=new es(32);for(ds=0;ds<32;++ds)gs[ds]=5;var fs=ms(xs,9,1),ys=ms(gs,5,1),bs=function max(u){for(var d=u[0],v=1;v<u.length;++v)u[v]>d&&(d=u[v]);return d},_s=function bits(u,d,v){var x=d/8|0;return(u[x]|u[x+1]<<8)>>(7&d)&v},ws=function bits16(u,d){var v=d/8|0;return(u[v]|u[v+1]<<8|u[v+2]<<16)>>(7&d)},Ss=function shft(u){return(u+7)/8|0},Cs=function slc(u,d,v){return(null==d||d<0)&&(d=0),(null==v||v>u.length)&&(v=u.length),new es(u.subarray(d,v))},Ns=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ps=function err(u,d,v){var x=new Error(d||Ns[u]);if(x.code=u,Error.captureStackTrace&&Error.captureStackTrace(x,err),!v)throw x;return x},Ms=function inflt(u,d,v,x){var y=u.length,b=x?x.length:0;if(!y||d.f&&!d.l)return v||new es(0);var _=!v,w=_||2!=d.i,S=d.i;_&&(v=new es(3*y));var C=function cbuf(u){var d=v.length;if(u>d){var x=new es(Math.max(2*d,u));x.set(v),v=x}},P=d.f||0,A=d.p||0,T=d.b||0,E=d.l,D=d.d,I=d.m,k=d.n,R=8*y;do{if(!E){P=_s(u,A,1);var O=_s(u,A+1,3);if(A+=3,!O){var j=u[(ee=Ss(A)+4)-4]|u[ee-3]<<8,G=ee+j;if(G>y){S&&Ps(0);break}w&&C(T+j),v.set(u.subarray(ee,G),T),d.b=T+=j,d.p=A=8*G,d.f=P;continue}if(1==O)E=fs,D=ys,I=9,k=5;else if(2==O){var H=_s(u,A,31)+257,X=_s(u,A+10,15)+4,q=H+_s(u,A+5,31)+1;A+=14;for(var Z=new es(q),J=new es(19),Q=0;Q<X;++Q)J[as[Q]]=_s(u,A+3*Q,7);A+=3*X;var K=bs(J),Y=(1<<K)-1,$=ms(J,K,1);for(Q=0;Q<q;){var ee,te=$[_s(u,A,Y)];if(A+=15&te,(ee=te>>4)<16)Z[Q++]=ee;else{var ie=0,se=0;for(16==ee?(se=3+_s(u,A,3),A+=2,ie=Z[Q-1]):17==ee?(se=3+_s(u,A,7),A+=3):18==ee&&(se=11+_s(u,A,127),A+=7);se--;)Z[Q++]=ie}}var re=Z.subarray(0,H),ae=Z.subarray(H);I=bs(re),k=bs(ae),E=ms(re,I,1),D=ms(ae,k,1)}else Ps(1);if(A>R){S&&Ps(0);break}}w&&C(T+131072);for(var ne=(1<<I)-1,oe=(1<<k)-1,le=A;;le=A){var he=(ie=E[ws(u,A)&ne])>>4;if((A+=15&ie)>R){S&&Ps(0);break}if(ie||Ps(2),he<256)v[T++]=he;else{if(256==he){le=A,E=null;break}var ue=he-254;if(he>264){var ce=ss[Q=he-257];ue=_s(u,A,(1<<ce)-1)+ls[Q],A+=ce}var pe=D[ws(u,A)&oe],de=pe>>4;pe||Ps(3),A+=15&pe;ae=cs[de];if(de>3){ce=rs[de];ae+=ws(u,A)&(1<<ce)-1,A+=ce}if(A>R){S&&Ps(0);break}w&&C(T+131072);var ve=T+ue;if(T<ae){var me=b-ae,xe=Math.min(ae,ve);for(me+T<0&&Ps(3);T<xe;++T)v[T]=x[me+T]}for(;T<ve;++T)v[T]=v[T-ae]}}d.l=E,d.p=le,d.b=T,d.f=P,E&&(P=1,d.m=I,d.d=D,d.n=k)}while(!P);return T!=v.length&&_?Cs(v,0,T):v.subarray(0,T)},As=new es(0),Ts=function zls(u,d){return(8!=(15&u[0])||u[0]>>4>7||(u[0]<<8|u[1])%31)&&Ps(6,"invalid zlib data"),(u[1]>>5&1)==+!d&&Ps(6,"invalid zlib data: "+(32&u[1]?"need":"unexpected")+" dictionary"),2+(u[1]>>3&4)};function pxlNav_unzlibSync(u,d){return Ms(u.subarray(Ts(u,d&&d.dictionary),-4),{i:2},d&&d.out,d&&d.dictionary)}var Es="undefined"!=typeof TextDecoder&&new TextDecoder;try{Es.decode(As,{stream:!0})}catch(u){}var Ds,Is,Ls;"function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setTimeout&&setTimeout;function pxlNav_findSpan(u,d,v){var x=v.length-u-1;if(d>=v[x])return x-1;if(d<=v[u])return u;for(var y=u,b=x,_=Math.floor((y+b)/2);d<v[_]||d>=v[_+1];)d<v[_]?b=_:y=_,_=Math.floor((y+b)/2);return _}function pxlNav_calcBasisFunctions(u,d,v,x){var y=[],b=[],_=[];y[0]=1;for(var w=1;w<=v;++w){b[w]=d-x[u+1-w],_[w]=x[u+w]-d;for(var S=0,C=0;C<w;++C){var P=_[C+1],A=b[w-C],T=y[C]/(P+A);y[C]=S+P*T,S=A*T}y[w]=S}return y}function pxlNav_calcKoverI(u,d){for(var v=1,x=2;x<=u;++x)v*=x;for(var y=1,b=2;b<=d;++b)y*=b;for(var _=2;_<=u-d;++_)y*=_;return v/y}function pxlNav_calcNURBSDerivatives(u,d,v,x,y){var b=function pxlNav_calcBSplineDerivatives(u,d,v,x,y){for(var b=y<u?y:u,_=[],w=pxlNav_findSpan(u,x,d),S=function pxlNav_calcBasisFunctionDerivatives(u,d,v,x,y){for(var b=[],_=0;_<=v;++_)b[_]=0;for(var w=[],S=0;S<=x;++S)w[S]=b.slice(0);for(var C=[],P=0;P<=v;++P)C[P]=b.slice(0);C[0][0]=1;for(var A=b.slice(0),T=b.slice(0),E=1;E<=v;++E){A[E]=d-y[u+1-E],T[E]=y[u+E]-d;for(var D=0,I=0;I<E;++I){var k=T[I+1],R=A[E-I];C[E][I]=k+R;var O=C[I][E-1]/C[E][I];C[I][E]=D+k*O,D=R*O}C[E][E]=D}for(var j=0;j<=v;++j)w[0][j]=C[j][v];for(var G=0;G<=v;++G){for(var H=0,X=1,q=[],Z=0;Z<=v;++Z)q[Z]=b.slice(0);q[0][0]=1;for(var J=1;J<=x;++J){var Q=0,K=G-J,Y=v-J;G>=J&&(q[X][0]=q[H][0]/C[Y+1][K],Q=q[X][0]*C[K][Y]);for(var $=G-1<=Y?J-1:v-G,ee=K>=-1?1:-K;ee<=$;++ee)q[X][ee]=(q[H][ee]-q[H][ee-1])/C[Y+1][K+ee],Q+=q[X][ee]*C[K+ee][Y];G<=Y&&(q[X][J]=-q[H][J-1]/C[Y+1][G],Q+=q[X][J]*C[G][Y]),w[J][G]=Q;var te=H;H=X,X=te}}for(var ie=v,se=1;se<=x;++se){for(var re=0;re<=v;++re)w[se][re]*=ie;ie*=v-se}return w}(w,x,u,b,d),C=[],P=0;P<v.length;++P){var A=v[P].clone(),T=A.w;A.x*=T,A.y*=T,A.z*=T,C[P]=A}for(var E=0;E<=b;++E){for(var D=C[w-u].clone().multiplyScalar(S[E][0]),I=1;I<=u;++I)D.add(C[w-u+I].clone().multiplyScalar(S[E][I]));_[E]=D}for(var k=b+1;k<=y+1;++k)_[k]=new pxlNav_wi(0,0,0);return _}(u,d,v,x,y);return function pxlNav_calcRationalCurveDerivatives(u){for(var d=u.length,v=[],x=[],y=0;y<d;++y){var b=u[y];v[y]=new pxlNav_Ii(b.x,b.y,b.z),x[y]=b.w}for(var _=[],w=0;w<d;++w){for(var S=v[w].clone(),C=1;C<=w;++C)S.sub(_[w-C].clone().multiplyScalar(pxlNav_calcKoverI(w,C)*x[C]));_[w]=S.divideScalar(x[0])}return _}(b)}class pxlNav_NURBSCurve extends pxlNav_Qa{constructor(u,d,v,x,y){super();var b=d?d.length-1:0,_=v?v.length:0;this.degree=u,this.knots=d,this.controlPoints=[],this.startKnot=x||0,this.endKnot=y||b;for(var w=0;w<_;++w){var S=v[w];this.controlPoints[w]=new pxlNav_wi(S.x,S.y,S.z,S.w)}}getPoint(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pxlNav_Ii,v=this.knots[this.startKnot]+u*(this.knots[this.endKnot]-this.knots[this.startKnot]),x=function pxlNav_calcBSplinePoint(u,d,v,x){for(var y=pxlNav_findSpan(u,x,d),b=pxlNav_calcBasisFunctions(y,x,u,d),_=new pxlNav_wi(0,0,0,0),w=0;w<=u;++w){var S=v[y-u+w],C=b[w],P=S.w*C;_.x+=S.x*P,_.y+=S.y*P,_.z+=S.z*P,_.w+=S.w*C}return _}(this.degree,this.knots,this.controlPoints,v);return 1!==x.w&&x.divideScalar(x.w),d.set(x.x,x.y,x.z)}getTangent(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pxlNav_Ii,v=this.knots[0]+u*(this.knots[this.knots.length-1]-this.knots[0]),x=pxlNav_calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,v,1);return d.copy(x[1]).normalize(),d}toJSON(){var u=super.toJSON();return u.degree=this.degree,u.knots=[...this.knots],u.controlPoints=this.controlPoints.map((u=>u.toArray())),u.startKnot=this.startKnot,u.endKnot=this.endKnot,u}fromJSON(u){return super.fromJSON(u),this.degree=u.degree,this.knots=[...u.knots],this.controlPoints=u.controlPoints.map((u=>new pxlNav_wi(u[0],u[1],u[2],u[3]))),this.startKnot=u.startKnot,this.endKnot=u.endKnot,this}}class pxlNav_FBXLoader extends pxlNav_ic{constructor(u){super(u)}load(u,d,v,x){var y=this,b=""===y.path?pxlNav_Pc.extractUrlBase(u):y.path,_=new pxlNav_oc(this.manager);_.setPath(y.path),_.setResponseType("arraybuffer"),_.setRequestHeader(y.requestHeader),_.setWithCredentials(y.withCredentials),_.load(u,(function(v){try{d(y.parse(v,b))}catch(d){x?x(d):console.error(d),y.manager.itemError(u)}}),v,x)}parse(u,d){if(function pxlNav_isFbxFormatBinary(u){var d="Kaydara FBX Binary  \0";return u.byteLength>=d.length&&d===pxlNav_convertArrayBufferToString(u,0,d.length)}(u))Ds=(new pxlNav_BinaryParser).parse(u);else{var v=pxlNav_convertArrayBufferToString(u);if(!function pxlNav_isFbxFormatASCII(u){var d=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],v=0;function read(d){var x=u[d-1];return u=u.slice(v+d),v++,x}for(var x=0;x<d.length;++x){if(read(1)===d[x])return!1}return!0}(v))throw new Error("THREE.FBXLoader: Unknown format.");if(pxlNav_getFbxVersion(v)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+pxlNav_getFbxVersion(v));Ds=(new pxlNav_TextParser).parse(v)}var x=new pxlNav_dc(this.manager).setPath(this.resourcePath||d).setCrossOrigin(this.crossOrigin);return new pxlNav_FBXTreeParser(x,this.manager).parse(Ds)}}class pxlNav_FBXTreeParser{constructor(u,d){this.textureLoader=u,this.manager=d}parse(){Is=this.parseConnections();var u=this.parseImages(),d=this.parseTextures(u),v=this.parseMaterials(d),x=this.parseDeformers(),y=(new pxlNav_GeometryParser).parse(x);return this.parseScene(x,y,v),Ls}parseConnections(){var u=new Map;"Connections"in Ds&&Ds.Connections.connections.forEach((function(d){var v=d[0],x=d[1],y=d[2];u.has(v)||u.set(v,{parents:[],children:[]});var b={ID:x,relationship:y};u.get(v).parents.push(b),u.has(x)||u.set(x,{parents:[],children:[]});var _={ID:v,relationship:y};u.get(x).children.push(_)}));return u}parseImages(){var u={},d={};if("Video"in Ds.Objects){var v=Ds.Objects.Video;for(var x in v){var y=v[x];if(u[parseInt(x)]=y.RelativeFilename||y.Filename,"Content"in y){var b=y.Content instanceof ArrayBuffer&&y.Content.byteLength>0,_="string"==typeof y.Content&&""!==y.Content;if(b||_){var w=this.parseImage(v[x]);d[y.RelativeFilename||y.Filename]=w}}}}for(var S in u){var C=u[S];void 0!==d[C]?u[S]=d[C]:u[S]=u[S].split("\\").pop()}return u}parseImage(u){var d,v=u.Content,x=u.RelativeFilename||u.Filename,y=x.slice(x.lastIndexOf(".")+1).toLowerCase();switch(y){case"bmp":d="image/bmp";break;case"jpg":case"jpeg":d="image/jpeg";break;case"png":d="image/png";break;case"tif":d="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",x),d="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+y+'" is not supported.')}if("string"==typeof v)return"data:"+d+";base64,"+v;var b=new Uint8Array(v);return window.URL.createObjectURL(new Blob([b],{type:d}))}parseTextures(u){var d=new Map;if("Texture"in Ds.Objects){var v=Ds.Objects.Texture;for(var x in v){var y=this.parseTexture(v[x],u);d.set(parseInt(x),y)}}return d}parseTexture(u,d){var v=this.loadTexture(u,d);v.ID=u.id,v.name=u.attrName;var x=u.WrapModeU,y=u.WrapModeV,b=void 0!==x?x.value:0,_=void 0!==y?y.value:0;if(v.wrapS=0===b?q:Z,v.wrapT=0===_?q:Z,"Scaling"in u){var w=u.Scaling.value;v.repeat.x=w[0],v.repeat.y=w[1]}if("Translation"in u){var S=u.Translation.value;v.offset.x=S[0],v.offset.y=S[1]}return v}loadTexture(u,d){var v=new Set(["tga","tif","tiff","exr","dds","hdr","ktx2"]),x=u.FileName.split(".").pop().toLowerCase(),y=v.has(x)?this.manager.getHandler(".".concat(x)):this.textureLoader;if(!y)return console.warn("FBXLoader: ".concat(x.toUpperCase()," loader not found, creating placeholder texture for"),u.RelativeFilename),new pxlNav_vi;var b=y.path;b||y.setPath(this.textureLoader.path);var _,w=Is.get(u.id).children;void 0!==w&&w.length>0&&void 0!==d[w[0].ID]&&(0!==(_=d[w[0].ID]).indexOf("blob:")&&0!==_.indexOf("data:")||y.setPath(void 0));var S=y.load(_);return y.setPath(b),S}parseMaterials(u){var d=new Map;if("Material"in Ds.Objects){var v=Ds.Objects.Material;for(var x in v){var y=this.parseMaterial(v[x],u);null!==y&&d.set(parseInt(x),y)}}return d}parseMaterial(u,d){var v=u.id,x=u.attrName,y=u.ShadingModel;if("object"==typeof y&&(y=y.value),!Is.has(v))return null;var b,_=this.parseParameters(u,d,v);switch(y.toLowerCase()){case"phong":b=new pxlNav_Tl;break;case"lambert":b=new pxlNav_Il;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',y),b=new pxlNav_Tl}return b.setValues(_),b.name=x,b}parseParameters(u,d,v){var x={};u.BumpFactor&&(x.bumpScale=u.BumpFactor.value),u.Diffuse?x.color=be.toWorkingColorSpace((new pxlNav_$r).fromArray(u.Diffuse.value),re):!u.DiffuseColor||"Color"!==u.DiffuseColor.type&&"ColorRGB"!==u.DiffuseColor.type||(x.color=be.toWorkingColorSpace((new pxlNav_$r).fromArray(u.DiffuseColor.value),re)),u.DisplacementFactor&&(x.displacementScale=u.DisplacementFactor.value),u.Emissive?x.emissive=be.toWorkingColorSpace((new pxlNav_$r).fromArray(u.Emissive.value),re):!u.EmissiveColor||"Color"!==u.EmissiveColor.type&&"ColorRGB"!==u.EmissiveColor.type||(x.emissive=be.toWorkingColorSpace((new pxlNav_$r).fromArray(u.EmissiveColor.value),re)),u.EmissiveFactor&&(x.emissiveIntensity=parseFloat(u.EmissiveFactor.value)),x.opacity=1-(u.TransparencyFactor?parseFloat(u.TransparencyFactor.value):0),1!==x.opacity&&0!==x.opacity||(x.opacity=u.Opacity?parseFloat(u.Opacity.value):null,null===x.opacity&&(x.opacity=1-(u.TransparentColor?parseFloat(u.TransparentColor.value[0]):0))),x.opacity<1&&(x.transparent=!0),u.ReflectionFactor&&(x.reflectivity=u.ReflectionFactor.value),u.Shininess&&(x.shininess=u.Shininess.value),u.Specular?x.specular=be.toWorkingColorSpace((new pxlNav_$r).fromArray(u.Specular.value),re):u.SpecularColor&&"Color"===u.SpecularColor.type&&(x.specular=be.toWorkingColorSpace((new pxlNav_$r).fromArray(u.SpecularColor.value),re));var y=this;return Is.get(v).children.forEach((function(u){var v=u.relationship;switch(v){case"Bump":x.bumpMap=y.getTexture(d,u.ID);break;case"Maya|TEX_ao_map":x.aoMap=y.getTexture(d,u.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":x.map=y.getTexture(d,u.ID),void 0!==x.map&&(x.map.colorSpace=re);break;case"DisplacementColor":x.displacementMap=y.getTexture(d,u.ID);break;case"EmissiveColor":x.emissiveMap=y.getTexture(d,u.ID),void 0!==x.emissiveMap&&(x.emissiveMap.colorSpace=re);break;case"NormalMap":case"Maya|TEX_normal_map":x.normalMap=y.getTexture(d,u.ID);break;case"ReflectionColor":x.envMap=y.getTexture(d,u.ID),void 0!==x.envMap&&(x.envMap.mapping=303,x.envMap.colorSpace=re);break;case"SpecularColor":x.specularMap=y.getTexture(d,u.ID),void 0!==x.specularMap&&(x.specularMap.colorSpace=re);break;case"TransparentColor":case"TransparencyFactor":x.alphaMap=y.getTexture(d,u.ID),x.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",v)}})),x}getTexture(u,d){return"LayeredTexture"in Ds.Objects&&d in Ds.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),d=Is.get(d).children[0].ID),u.get(d)}parseDeformers(){var u={},d={};if("Deformer"in Ds.Objects){var v=Ds.Objects.Deformer;for(var x in v){var y=v[x],b=Is.get(parseInt(x));if("Skin"===y.attrType){var _=this.parseSkeleton(b,v);_.ID=x,b.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),_.geometryID=b.parents[0].ID,u[x]=_}else if("BlendShape"===y.attrType){var w={id:x};w.rawTargets=this.parseMorphTargets(b,v),w.id=x,b.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),d[x]=w}}}return{skeletons:u,morphTargets:d}}parseSkeleton(u,d){var v=[];return u.children.forEach((function(u){var x=d[u.ID];if("Cluster"===x.attrType){var y={ID:u.ID,indices:[],weights:[],transformLink:(new pxlNav_nr).fromArray(x.TransformLink.a)};"Indexes"in x&&(y.indices=x.Indexes.a,y.weights=x.Weights.a),v.push(y)}})),{rawBones:v,bones:[]}}parseMorphTargets(u,d){for(var v=[],x=0;x<u.children.length;x++){var y=u.children[x],b=d[y.ID],_={name:b.attrName,initialWeight:b.DeformPercent,id:b.id,fullWeights:b.FullWeights.a};if("BlendShapeChannel"!==b.attrType)return;_.geoID=Is.get(parseInt(y.ID)).children.filter((function(u){return void 0===u.relationship}))[0].ID,v.push(_)}return v}parseScene(u,d,v){Ls=new pxlNav_Ha;var x=this.parseModels(u.skeletons,d,v),y=Ds.Objects.Model,b=this;x.forEach((function(u){var d=y[u.ID];b.setLookAtProperties(u,d),Is.get(u.ID).parents.forEach((function(d){var v=x.get(d.ID);void 0!==v&&v.add(u)})),null===u.parent&&Ls.add(u)})),this.bindSkeleton(u.skeletons,d,x),this.addGlobalSceneSettings(),Ls.traverse((function(u){if(u.userData.transformData){u.parent&&(u.userData.transformData.parentMatrix=u.parent.matrix,u.userData.transformData.parentMatrixWorld=u.parent.matrixWorld);var d=pxlNav_generateTransform(u.userData.transformData);u.applyMatrix4(d),u.updateWorldMatrix()}}));var _=(new pxlNav_AnimationParser).parse();1===Ls.children.length&&Ls.children[0].isGroup&&(Ls.children[0].animations=_,Ls=Ls.children[0]),Ls.animations=_}parseModels(u,d,v){var x=this,y=new Map,b=Ds.Objects.Model,_=["Culling","DefaultAttributeIndex","InheritType","Lcl_Translation","Lcl_Rotation","Lcl_Scaling","RotationPivot","ScalingPivot","RotationActive","ScalingMax","RotationOffset","fbx_node_path","Shading","Version","attrName","attrType","currentUVSet","id","name","propertyList","singleProperty"],w=function _loop(){var w=parseInt(S),C=b[S],P=Is.get(w),A=x.buildSkeleton(P,u,w,C.attrName);if(!A){switch(C.attrType){case"Camera":A=x.createCamera(P);break;case"Light":A=x.createLight(P);break;case"Mesh":A=x.createMesh(P,d,v);break;case"NurbsCurve":A=x.createCurve(P,d);break;case"LimbNode":case"Root":A=new pxlNav_Lo;break;default:A=new pxlNav_Ha}A.name=C.attrName?pxlNav_gu.sanitizeNodeName(C.attrName):"",A.userData.originalName=C.attrName,A.ID=w}Object.keys(C).forEach((u=>{_.includes(u)||(A.userData[u]=C[u].value)})),x.getTransformData(A,C),y.set(w,A)};for(var S in b)w();return y}buildSkeleton(u,d,v,x){var y=null;return u.parents.forEach((function(u){var b=function _loop2(){var b=d[_];b.rawBones.forEach((function(d,_){if(d.ID===u.ID){var w=y;(y=new pxlNav_Lo).matrixWorld.copy(d.transformLink),y.name=x?pxlNav_gu.sanitizeNodeName(x):"",y.userData.originalName=x,y.ID=v,b.bones[_]=y,null!==w&&y.add(w)}}))};for(var _ in d)b()})),y}createCamera(u){var d,v;if(u.children.forEach((function(u){var d=Ds.Objects.NodeAttribute[u.ID];void 0!==d&&(v=d)})),void 0===v)d=new pxlNav_Er;else{var x=0;void 0!==v.CameraProjectionType&&1===v.CameraProjectionType.value&&(x=1);var y=1;void 0!==v.NearPlane&&(y=v.NearPlane.value/1e3);var b=1e3;void 0!==v.FarPlane&&(b=v.FarPlane.value/1e3);var _=window.innerWidth,w=window.innerHeight;void 0!==v.AspectWidth&&void 0!==v.AspectHeight&&(_=v.AspectWidth.value,w=v.AspectHeight.value);var S=_/w,C=45;void 0!==v.FieldOfView&&(C=v.FieldOfView.value);var P=v.FocalLength?v.FocalLength.value:null;switch(x){case 0:d=new pxlNav_$n(C,S,y,b),null!==P&&d.setFocalLength(P);break;case 1:console.warn("THREE.FBXLoader: Orthographic cameras not supported yet."),d=new pxlNav_Er;break;default:console.warn("THREE.FBXLoader: Unknown camera type "+x+"."),d=new pxlNav_Er}}return d}createLight(u){var d,v;if(u.children.forEach((function(u){var d=Ds.Objects.NodeAttribute[u.ID];void 0!==d&&(v=d)})),void 0===v)d=new pxlNav_Er;else{var x;x=void 0===v.LightType?0:v.LightType.value;var y=16777215;void 0!==v.Color&&(y=(new pxlNav_$r).fromArray(v.Color.value));var b=void 0===v.Intensity?1:v.Intensity.value/100;void 0!==v.CastLightOnObject&&0===v.CastLightOnObject.value&&(b=0);var _=0;void 0!==v.FarAttenuationEnd&&(_=void 0!==v.EnableFarAttenuation&&0===v.EnableFarAttenuation.value?0:v.FarAttenuationEnd.value);switch(x){case 0:d=new pxlNav_Ac(y,b,_,1);break;case 1:d=new pxlNav_Cc(y,b);break;case 2:var w=Math.PI/3;void 0!==v.InnerAngle&&(w=me(v.InnerAngle.value));var S=0;void 0!==v.OuterAngle&&(S=me(v.OuterAngle.value),S=Math.max(S,1)),d=new pxlNav_vc(y,b,_,w,S,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+v.LightType.value+", defaulting to a PointLight."),d=new pxlNav_Ac(y,b)}void 0!==v.CastShadows&&1===v.CastShadows.value&&(d.castShadow=!0)}return d}createMesh(u,d,v){var x,y=null,b=null,_=[];return u.children.forEach((function(u){d.has(u.ID)&&(y=d.get(u.ID)),v.has(u.ID)&&_.push(v.get(u.ID))})),_.length>1?b=_:_.length>0?b=_[0]:(b=new pxlNav_Tl({name:pxlNav_ic.DEFAULT_MATERIAL_NAME,color:13421772}),_.push(b)),"color"in y.attributes&&_.forEach((function(u){u.vertexColors=!0})),y.FBX_Deformer?(x=new pxlNav_No(y,b)).normalizeSkinWeights():x=new pxlNav_Vn(y,b),x}createCurve(u,d){var v=u.children.reduce((function(u,v){return d.has(v.ID)&&(u=d.get(v.ID)),u}),null),x=new pxlNav_Sa({name:pxlNav_ic.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new pxlNav_ka(v,x)}getTransformData(u,d){var v={};"InheritType"in d&&(v.inheritType=parseInt(d.InheritType.value)),v.eulerOrder=pxlNav_getEulerOrder("RotationOrder"in d?d.RotationOrder.value:0),"Lcl_Translation"in d&&(v.translation=d.Lcl_Translation.value),"PreRotation"in d&&(v.preRotation=d.PreRotation.value),"Lcl_Rotation"in d&&(v.rotation=d.Lcl_Rotation.value),"PostRotation"in d&&(v.postRotation=d.PostRotation.value),"Lcl_Scaling"in d&&(v.scale=d.Lcl_Scaling.value),"ScalingOffset"in d&&(v.scalingOffset=d.ScalingOffset.value),"ScalingPivot"in d&&(v.scalingPivot=d.ScalingPivot.value),"RotationOffset"in d&&(v.rotationOffset=d.RotationOffset.value),"RotationPivot"in d&&(v.rotationPivot=d.RotationPivot.value),u.userData.transformData=v}setLookAtProperties(u,d){"LookAtProperty"in d&&Is.get(u.ID).children.forEach((function(d){if("LookAtProperty"===d.relationship){var v=Ds.Objects.Model[d.ID];if("Lcl_Translation"in v){var x=v.Lcl_Translation.value;void 0!==u.target?(u.target.position.fromArray(x),Ls.add(u.target)):u.lookAt((new pxlNav_Ii).fromArray(x))}}}))}bindSkeleton(u,d,v){var x=this.parsePoseNodes(),y=function _loop3(){var y=u[b];Is.get(parseInt(y.ID)).parents.forEach((function(u){if(d.has(u.ID)){var b=u.ID;Is.get(b).parents.forEach((function(u){v.has(u.ID)&&v.get(u.ID).bind(new pxlNav_jo(y.bones),x[u.ID])}))}}))};for(var b in u)y()}parsePoseNodes(){var u={};if("Pose"in Ds.Objects){var d=Ds.Objects.Pose;for(var v in d)if("BindPose"===d[v].attrType&&d[v].NbPoseNodes>0){var x=d[v].PoseNode;Array.isArray(x)?x.forEach((function(d){u[d.Node]=(new pxlNav_nr).fromArray(d.Matrix.a)})):u[x.Node]=(new pxlNav_nr).fromArray(x.Matrix.a)}}return u}addGlobalSceneSettings(){if("GlobalSettings"in Ds){if("AmbientColor"in Ds.GlobalSettings){var u=Ds.GlobalSettings.AmbientColor.value,d=u[0],v=u[1],x=u[2];if(0!==d||0!==v||0!==x){var y=(new pxlNav_$r).setRGB(d,v,x);Ls.add(new pxlNav_Ic(y,1))}}"UnitScaleFactor"in Ds.GlobalSettings&&(Ls.userData.unitScaleFactor=Ds.GlobalSettings.UnitScaleFactor.value)}}}class pxlNav_GeometryParser{constructor(){this.negativeMaterialIndices=!1}parse(u){var d=new Map;if("Geometry"in Ds.Objects){var v=Ds.Objects.Geometry;for(var x in v){var y=Is.get(parseInt(x)),b=this.parseGeometry(y,v[x],u);d.set(parseInt(x),b)}}return!0===this.negativeMaterialIndices&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),d}parseGeometry(u,d,v){switch(d.attrType){case"Mesh":return this.parseMeshGeometry(u,d,v);case"NurbsCurve":return this.parseNurbsGeometry(d)}}parseMeshGeometry(u,d,v){var x=v.skeletons,y=[],b=u.parents.map((function(u){return Ds.Objects.Model[u.ID]}));if(0!==b.length){var _=u.children.reduce((function(u,d){return void 0!==x[d.ID]&&(u=x[d.ID]),u}),null);u.children.forEach((function(u){void 0!==v.morphTargets[u.ID]&&y.push(v.morphTargets[u.ID])}));var w=b[0],S={};"RotationOrder"in w&&(S.eulerOrder=pxlNav_getEulerOrder(w.RotationOrder.value)),"InheritType"in w&&(S.inheritType=parseInt(w.InheritType.value)),"GeometricTranslation"in w&&(S.translation=w.GeometricTranslation.value),"GeometricRotation"in w&&(S.rotation=w.GeometricRotation.value),"GeometricScaling"in w&&(S.scale=w.GeometricScaling.value);var C=pxlNav_generateTransform(S);return this.genGeometry(d,_,y,C)}}genGeometry(u,d,v,x){var y=new pxlNav_zn;u.attrName&&(y.name=u.attrName);var b=this.parseGeoNode(u,d),_=this.genBuffers(b),w=new pxlNav_bn(_.vertex,3);if(w.applyMatrix4(x),y.setAttribute("position",w),_.colors.length>0&&y.setAttribute("color",new pxlNav_bn(_.colors,3)),d&&(y.setAttribute("skinIndex",new pxlNav_yn(_.weightsIndices,4)),y.setAttribute("skinWeight",new pxlNav_bn(_.vertexWeights,4)),y.FBX_Deformer=d),_.normal.length>0){var S=(new pxlNav_Gs).getNormalMatrix(x),C=new pxlNav_bn(_.normal,3);C.applyNormalMatrix(S),y.setAttribute("normal",C)}if(_.uvs.forEach((function(u,d){var v=0===d?"uv":"uv".concat(d);y.setAttribute(v,new pxlNav_bn(_.uvs[d],2))})),b.material&&"AllSame"!==b.material.mappingType){var P=_.materialIndex[0],A=0;if(_.materialIndex.forEach((function(u,d){u!==P&&(y.addGroup(A,d-A,P),P=u,A=d)})),y.groups.length>0){var T=y.groups[y.groups.length-1],E=T.start+T.count;E!==_.materialIndex.length&&y.addGroup(E,_.materialIndex.length-E,P)}0===y.groups.length&&y.addGroup(0,_.materialIndex.length,_.materialIndex[0])}return this.addMorphTargets(y,u,v,x),y}parseGeoNode(u,d){var v={};if(v.vertexPositions=void 0!==u.Vertices?u.Vertices.a:[],v.vertexIndices=void 0!==u.PolygonVertexIndex?u.PolygonVertexIndex.a:[],u.LayerElementColor&&(v.color=this.parseVertexColors(u.LayerElementColor[0])),u.LayerElementMaterial&&(v.material=this.parseMaterialIndices(u.LayerElementMaterial[0])),u.LayerElementNormal&&(v.normal=this.parseNormals(u.LayerElementNormal[0])),u.LayerElementUV){v.uv=[];for(var x=0;u.LayerElementUV[x];)u.LayerElementUV[x].UV&&v.uv.push(this.parseUVs(u.LayerElementUV[x])),x++}return v.weightTable={},null!==d&&(v.skeleton=d,d.rawBones.forEach((function(u,d){u.indices.forEach((function(x,y){void 0===v.weightTable[x]&&(v.weightTable[x]=[]),v.weightTable[x].push({id:d,weight:u.weights[y]})}))}))),v}genBuffers(u){var d={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},v=0,x=0,y=!1,b=[],_=[],w=[],S=[],C=[],P=[],A=this;return u.vertexIndices.forEach((function(T,E){var D,I=!1;T<0&&(T=~T,I=!0);var k=[],R=[];if(b.push(3*T,3*T+1,3*T+2),u.color){var O=pxlNav_getData(E,v,T,u.color);w.push(O[0],O[1],O[2])}if(u.skeleton){if(void 0!==u.weightTable[T]&&u.weightTable[T].forEach((function(u){R.push(u.weight),k.push(u.id)})),R.length>4){y||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),y=!0);var j=[0,0,0,0],G=[0,0,0,0];R.forEach((function(u,d){var v=u,x=k[d];G.forEach((function(u,d,y){if(v>u){y[d]=v,v=u;var b=j[d];j[d]=x,x=b}}))})),k=j,R=G}for(;R.length<4;)R.push(0),k.push(0);for(var H=0;H<4;++H)C.push(R[H]),P.push(k[H])}if(u.normal){var X=pxlNav_getData(E,v,T,u.normal);_.push(X[0],X[1],X[2])}u.material&&"AllSame"!==u.material.mappingType&&(D=pxlNav_getData(E,v,T,u.material)[0])<0&&(A.negativeMaterialIndices=!0,D=0),u.uv&&u.uv.forEach((function(u,d){var x=pxlNav_getData(E,v,T,u);void 0===S[d]&&(S[d]=[]),S[d].push(x[0]),S[d].push(x[1])})),x++,I&&(A.genFace(d,u,b,D,_,w,S,C,P,x),v++,x=0,b=[],_=[],w=[],S=[],C=[],P=[])})),d}getNormalNewell(u){for(var d=new pxlNav_Ii(0,0,0),v=0;v<u.length;v++){var x=u[v],y=u[(v+1)%u.length];d.x+=(x.y-y.y)*(x.z+y.z),d.y+=(x.z-y.z)*(x.x+y.x),d.z+=(x.x-y.x)*(x.y+y.y)}return d.normalize(),d}getNormalTangentAndBitangent(u){var d=this.getNormalNewell(u),v=(Math.abs(d.z)>.5?new pxlNav_Ii(0,1,0):new pxlNav_Ii(0,0,1)).cross(d).normalize(),x=d.clone().cross(v).normalize();return{normal:d,tangent:v,bitangent:x}}flattenVertex(u,d,v){return new pxlNav_Zs(u.dot(d),u.dot(v))}genFace(u,d,v,x,y,b,_,w,S,C){var P;if(C>3){for(var A=[],T=d.baseVertexPositions||d.vertexPositions,E=0;E<v.length;E+=3)A.push(new pxlNav_Ii(T[v[E]],T[v[E+1]],T[v[E+2]]));var{tangent:D,bitangent:I}=this.getNormalTangentAndBitangent(A),k=[];for(var R of A)k.push(this.flattenVertex(R,D,I));P=pxlNav_rl.triangulateShape(k,[])}else P=[[0,1,2]];var O=function _loop4(C,P,A){u.vertex.push(d.vertexPositions[v[3*C]]),u.vertex.push(d.vertexPositions[v[3*C+1]]),u.vertex.push(d.vertexPositions[v[3*C+2]]),u.vertex.push(d.vertexPositions[v[3*P]]),u.vertex.push(d.vertexPositions[v[3*P+1]]),u.vertex.push(d.vertexPositions[v[3*P+2]]),u.vertex.push(d.vertexPositions[v[3*A]]),u.vertex.push(d.vertexPositions[v[3*A+1]]),u.vertex.push(d.vertexPositions[v[3*A+2]]),d.skeleton&&(u.vertexWeights.push(w[4*C]),u.vertexWeights.push(w[4*C+1]),u.vertexWeights.push(w[4*C+2]),u.vertexWeights.push(w[4*C+3]),u.vertexWeights.push(w[4*P]),u.vertexWeights.push(w[4*P+1]),u.vertexWeights.push(w[4*P+2]),u.vertexWeights.push(w[4*P+3]),u.vertexWeights.push(w[4*A]),u.vertexWeights.push(w[4*A+1]),u.vertexWeights.push(w[4*A+2]),u.vertexWeights.push(w[4*A+3]),u.weightsIndices.push(S[4*C]),u.weightsIndices.push(S[4*C+1]),u.weightsIndices.push(S[4*C+2]),u.weightsIndices.push(S[4*C+3]),u.weightsIndices.push(S[4*P]),u.weightsIndices.push(S[4*P+1]),u.weightsIndices.push(S[4*P+2]),u.weightsIndices.push(S[4*P+3]),u.weightsIndices.push(S[4*A]),u.weightsIndices.push(S[4*A+1]),u.weightsIndices.push(S[4*A+2]),u.weightsIndices.push(S[4*A+3])),d.color&&(u.colors.push(b[3*C]),u.colors.push(b[3*C+1]),u.colors.push(b[3*C+2]),u.colors.push(b[3*P]),u.colors.push(b[3*P+1]),u.colors.push(b[3*P+2]),u.colors.push(b[3*A]),u.colors.push(b[3*A+1]),u.colors.push(b[3*A+2])),d.material&&"AllSame"!==d.material.mappingType&&(u.materialIndex.push(x),u.materialIndex.push(x),u.materialIndex.push(x)),d.normal&&(u.normal.push(y[3*C]),u.normal.push(y[3*C+1]),u.normal.push(y[3*C+2]),u.normal.push(y[3*P]),u.normal.push(y[3*P+1]),u.normal.push(y[3*P+2]),u.normal.push(y[3*A]),u.normal.push(y[3*A+1]),u.normal.push(y[3*A+2])),d.uv&&d.uv.forEach((function(d,v){void 0===u.uvs[v]&&(u.uvs[v]=[]),u.uvs[v].push(_[v][2*C]),u.uvs[v].push(_[v][2*C+1]),u.uvs[v].push(_[v][2*P]),u.uvs[v].push(_[v][2*P+1]),u.uvs[v].push(_[v][2*A]),u.uvs[v].push(_[v][2*A+1])}))};for(var[j,G,H]of P)O(j,G,H)}addMorphTargets(u,d,v,x){if(0!==v.length){u.morphTargetsRelative=!0,u.morphAttributes.position=[];var y=this;v.forEach((function(v){v.rawTargets.forEach((function(v){var b=Ds.Objects.Geometry[v.geoID];void 0!==b&&y.genMorphGeometry(u,d,b,x,v.name)}))}))}}genMorphGeometry(u,d,v,x,y){for(var b=void 0!==d.Vertices?d.Vertices.a:[],_=void 0!==d.PolygonVertexIndex?d.PolygonVertexIndex.a:[],w=void 0!==v.Vertices?v.Vertices.a:[],S=void 0!==v.Indexes?v.Indexes.a:[],C=3*u.attributes.position.count,P=new Float32Array(C),A=0;A<S.length;A++){var T=3*S[A];P[T]=w[3*A],P[T+1]=w[3*A+1],P[T+2]=w[3*A+2]}var E={vertexIndices:_,vertexPositions:P,baseVertexPositions:b},D=this.genBuffers(E),I=new pxlNav_bn(D.vertex,3);I.name=y||v.attrName,I.applyMatrix4(x),u.morphAttributes.position.push(I)}parseNormals(u){var d=u.MappingInformationType,v=u.ReferenceInformationType,x=u.Normals.a,y=[];return"IndexToDirect"===v&&("NormalIndex"in u?y=u.NormalIndex.a:"NormalsIndex"in u&&(y=u.NormalsIndex.a)),{dataSize:3,buffer:x,indices:y,mappingType:d,referenceType:v}}parseUVs(u){var d=u.MappingInformationType,v=u.ReferenceInformationType,x=u.UV.a,y=[];return"IndexToDirect"===v&&(y=u.UVIndex.a),{dataSize:2,buffer:x,indices:y,mappingType:d,referenceType:v}}parseVertexColors(u){var d=u.MappingInformationType,v=u.ReferenceInformationType,x=u.Colors.a,y=[];"IndexToDirect"===v&&(y=u.ColorIndex.a);for(var b=0,_=new pxlNav_$r;b<x.length;b+=4)_.fromArray(x,b),be.toWorkingColorSpace(_,re),_.toArray(x,b);return{dataSize:4,buffer:x,indices:y,mappingType:d,referenceType:v}}parseMaterialIndices(u){var d=u.MappingInformationType,v=u.ReferenceInformationType;if("NoMappingInformation"===d)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:v};for(var x=u.Materials.a,y=[],b=0;b<x.length;++b)y.push(b);return{dataSize:1,buffer:x,indices:y,mappingType:d,referenceType:v}}parseNurbsGeometry(u){var d=parseInt(u.Order);if(isNaN(d))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",u.Order,u.id),new pxlNav_zn;for(var v,x,y=d-1,b=u.KnotVector.a,_=[],w=u.Points.a,S=0,C=w.length;S<C;S+=4)_.push((new pxlNav_wi).fromArray(w,S));if("Closed"===u.Form)_.push(_[0]);else if("Periodic"===u.Form){v=y,x=b.length-1-v;for(var P=0;P<y;++P)_.push(_[P])}var A=new pxlNav_NURBSCurve(y,b,_,v,x).getPoints(12*_.length);return(new pxlNav_zn).setFromPoints(A)}}class pxlNav_AnimationParser{parse(){var u=[],d=this.parseClips();if(void 0!==d)for(var v in d){var x=d[v],y=this.addClip(x);u.push(y)}return u}parseClips(){if(void 0!==Ds.Objects.AnimationCurve){var u=this.parseAnimationCurveNodes();this.parseAnimationCurves(u);var d=this.parseAnimationLayers(u);return this.parseAnimStacks(d)}}parseAnimationCurveNodes(){var u=Ds.Objects.AnimationCurveNode,d=new Map;for(var v in u){var x=u[v];if(null!==x.attrName.match(/S|R|T|DeformPercent/)){var y={id:x.id,attr:x.attrName,curves:{}};d.set(y.id,y)}}return d}parseAnimationCurves(u){var d=Ds.Objects.AnimationCurve;for(var v in d){var x={id:d[v].id,times:d[v].KeyTime.a.map(pxlNav_convertFBXTimeToSeconds),values:d[v].KeyValueFloat.a},y=Is.get(x.id);if(void 0!==y){var b=y.parents[0].ID,_=y.parents[0].relationship;_.match(/X/)?u.get(b).curves.x=x:_.match(/Y/)?u.get(b).curves.y=x:_.match(/Z/)?u.get(b).curves.z=x:_.match(/DeformPercent/)&&u.has(b)&&(u.get(b).curves.morph=x)}}}parseAnimationLayers(u){var d=Ds.Objects.AnimationLayer,v=new Map,x=function _loop5(){var d=[],x=Is.get(parseInt(y));void 0!==x&&(x.children.forEach((function(v,x){if(u.has(v.ID)){var y=u.get(v.ID);if(void 0!==y.curves.x||void 0!==y.curves.y||void 0!==y.curves.z){if(void 0===d[x]){var b=Is.get(v.ID).parents.filter((function(u){return void 0!==u.relationship}))[0].ID;if(void 0!==b){var _=Ds.Objects.Model[b.toString()];if(void 0===_)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",v);var w={modelName:_.attrName?pxlNav_gu.sanitizeNodeName(_.attrName):"",ID:_.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Ls.traverse((function(u){u.ID===_.id&&(w.transform=u.matrix,u.userData.transformData&&(w.eulerOrder=u.userData.transformData.eulerOrder))})),w.transform||(w.transform=new pxlNav_nr),"PreRotation"in _&&(w.preRotation=_.PreRotation.value),"PostRotation"in _&&(w.postRotation=_.PostRotation.value),d[x]=w}}d[x]&&(d[x][y.attr]=y)}else if(void 0!==y.curves.morph){if(void 0===d[x]){var S=Is.get(v.ID).parents.filter((function(u){return void 0!==u.relationship}))[0].ID,C=Is.get(S).parents[0].ID,P=Is.get(C).parents[0].ID,A=Is.get(P).parents[0].ID,T=Ds.Objects.Model[A],E={modelName:T.attrName?pxlNav_gu.sanitizeNodeName(T.attrName):"",morphName:Ds.Objects.Deformer[S].attrName};d[x]=E}d[x][y.attr]=y}}})),v.set(parseInt(y),d))};for(var y in d)x();return v}parseAnimStacks(u){var d=Ds.Objects.AnimationStack,v={};for(var x in d){var y=Is.get(parseInt(x)).children;y.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var b=u.get(y[0].ID);v[x]={name:d[x].attrName,layer:b}}return v}addClip(u){var d=[],v=this;return u.layer.forEach((function(u){d=d.concat(v.generateTracks(u))})),new pxlNav_Ql(u.name,-1,d)}generateTracks(u){var d=[],v=new pxlNav_Ii,x=new pxlNav_Ii;if(u.transform&&u.transform.decompose(v,new pxlNav_Ci,x),v=v.toArray(),x=x.toArray(),void 0!==u.T&&Object.keys(u.T.curves).length>0){var y=this.generateVectorTrack(u.modelName,u.T.curves,v,"position");void 0!==y&&d.push(y)}if(void 0!==u.R&&Object.keys(u.R.curves).length>0){var b=this.generateRotationTrack(u.modelName,u.R.curves,u.preRotation,u.postRotation,u.eulerOrder);void 0!==b&&d.push(b)}if(void 0!==u.S&&Object.keys(u.S.curves).length>0){var _=this.generateVectorTrack(u.modelName,u.S.curves,x,"scale");void 0!==_&&d.push(_)}if(void 0!==u.DeformPercent){var w=this.generateMorphTrack(u);void 0!==w&&d.push(w)}return d}generateVectorTrack(u,d,v,x){var y=this.getTimesForAllAxes(d),b=this.getKeyframeTrackValues(y,d,v);return new pxlNav_$l(u+"."+x,y,b)}generateRotationTrack(u,d,v,x,y){var b,_;if(void 0!==d.x&&void 0!==d.y&&void 0!==d.z){var w=this.interpolateRotations(d.x,d.y,d.z,y);b=w[0],_=w[1]}var S=pxlNav_getEulerOrder(0);void 0!==v&&((v=v.map(me)).push(S),v=(new pxlNav_yr).fromArray(v),v=(new pxlNav_Ci).setFromEuler(v)),void 0!==x&&((x=x.map(me)).push(S),x=(new pxlNav_yr).fromArray(x),x=(new pxlNav_Ci).setFromEuler(x).invert());var C=new pxlNav_Ci,P=new pxlNav_yr,A=[];if(!_||!b)return new pxlNav_Zl(u+".quaternion",[0],[0]);for(var T=0;T<_.length;T+=3){if(P.set(_[T],_[T+1],_[T+2],y),C.setFromEuler(P),void 0!==v&&C.premultiply(v),void 0!==x&&C.multiply(x),T>2)(new pxlNav_Ci).fromArray(A,(T-3)/3*4).dot(C)<0&&C.set(-C.x,-C.y,-C.z,-C.w);C.toArray(A,T/3*4)}return new pxlNav_Zl(u+".quaternion",b,A)}generateMorphTrack(u){var d=u.DeformPercent.curves.morph,v=d.values.map((function(u){return u/100})),x=Ls.getObjectByName(u.modelName).morphTargetDictionary[u.morphName];return new pxlNav_Xl(u.modelName+".morphTargetInfluences["+x+"]",d.times,v)}getTimesForAllAxes(u){var d=[];if(void 0!==u.x&&(d=d.concat(u.x.times)),void 0!==u.y&&(d=d.concat(u.y.times)),void 0!==u.z&&(d=d.concat(u.z.times)),(d=d.sort((function(u,d){return u-d}))).length>1){for(var v=1,x=d[0],y=1;y<d.length;y++){var b=d[y];b!==x&&(d[v]=b,x=b,v++)}d=d.slice(0,v)}return d}getKeyframeTrackValues(u,d,v){var x=v,y=[],b=-1,_=-1,w=-1;return u.forEach((function(u){if(d.x&&(b=d.x.times.indexOf(u)),d.y&&(_=d.y.times.indexOf(u)),d.z&&(w=d.z.times.indexOf(u)),-1!==b){var v=d.x.values[b];y.push(v),x[0]=v}else y.push(x[0]);if(-1!==_){var S=d.y.values[_];y.push(S),x[1]=S}else y.push(x[1]);if(-1!==w){var C=d.z.values[w];y.push(C),x[2]=C}else y.push(x[2])})),y}interpolateRotations(u,d,v,x){var y=[],b=[];y.push(u.times[0]),b.push(me(u.values[0])),b.push(me(d.values[0])),b.push(me(v.values[0]));for(var _=1;_<u.values.length;_++){var w=[u.values[_-1],d.values[_-1],v.values[_-1]];if(!(isNaN(w[0])||isNaN(w[1])||isNaN(w[2]))){var S=w.map(me),C=[u.values[_],d.values[_],v.values[_]];if(!(isNaN(C[0])||isNaN(C[1])||isNaN(C[2]))){var P=C.map(me),A=[C[0]-w[0],C[1]-w[1],C[2]-w[2]],T=[Math.abs(A[0]),Math.abs(A[1]),Math.abs(A[2])];if(T[0]>=180||T[1]>=180||T[2]>=180){var E=Math.max(...T)/180,D=new pxlNav_yr(...S,x),I=new pxlNav_yr(...P,x),k=(new pxlNav_Ci).setFromEuler(D),R=(new pxlNav_Ci).setFromEuler(I);k.dot(R)&&R.set(-R.x,-R.y,-R.z,-R.w);for(var O=u.times[_-1],j=u.times[_]-O,G=new pxlNav_Ci,H=new pxlNav_yr,X=0;X<1;X+=1/E)G.copy(k.clone().slerp(R.clone(),X)),y.push(O+X*j),H.setFromQuaternion(G,x),b.push(H.x),b.push(H.y),b.push(H.z)}else y.push(u.times[_]),b.push(me(u.values[_])),b.push(me(d.values[_])),b.push(me(v.values[_]))}}}return[y,b]}}class pxlNav_TextParser{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(u){this.nodeStack.push(u),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(u,d){this.currentProp=u,this.currentPropName=d}parse(u){this.currentIndent=0,this.allNodes=new pxlNav_FBXTree,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var d=this,v=u.split(/[\r\n]+/);return v.forEach((function(u,x){var y=u.match(/^[\s\t]*;/),b=u.match(/^[\s\t]*$/);if(!y&&!b){var _=u.match("^\\t{"+d.currentIndent+"}(\\w+):(.*){",""),w=u.match("^\\t{"+d.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),S=u.match("^\\t{"+(d.currentIndent-1)+"}}");_?d.parseNodeBegin(u,_):w?d.parseNodeProperty(u,w,v[++x]):S?d.popStack():u.match(/^[^\s\t}]/)&&d.parseNodePropertyContinued(u)}})),this.allNodes}parseNodeBegin(u,d){var v=d[1].trim().replace(/^"/,"").replace(/"$/,""),x=d[2].split(",").map((function(u){return u.trim().replace(/^"/,"").replace(/"$/,"")})),y={name:v},b=this.parseNodeAttr(x),_=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(v,y):v in _?("PoseNode"===v?_.PoseNode.push(y):void 0!==_[v].id&&(_[v]={},_[v][_[v].id]=_[v]),""!==b.id&&(_[v][b.id]=y)):"number"==typeof b.id?(_[v]={},_[v][b.id]=y):"Properties70"!==v&&(_[v]="PoseNode"===v?[y]:y),"number"==typeof b.id&&(y.id=b.id),""!==b.name&&(y.attrName=b.name),""!==b.type&&(y.attrType=b.type),this.pushStack(y)}parseNodeAttr(u){var d=u[0];""!==u[0]&&(d=parseInt(u[0]),isNaN(d)&&(d=u[0]));var v="",x="";return u.length>1&&(v=u[1].replace(/^(\w+)::/,""),x=u[2]),{id:d,name:v,type:x}}parseNodeProperty(u,d,v){var x=d[1].replace(/^"/,"").replace(/"$/,"").trim(),y=d[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===x&&","===y&&(y=v.replace(/"/g,"").replace(/,$/,"").trim());var b=this.getCurrentNode();if("Properties70"!==b.name){if("C"===x){var _=y.split(",").slice(1),w=parseInt(_[0]),S=parseInt(_[1]),C=y.split(",").slice(3);x="connections",function pxlNav_append(u,d){for(var v=0,x=u.length,y=d.length;v<y;v++,x++)u[x]=d[v]}(y=[w,S],C=C.map((function(u){return u.trim().replace(/^"/,"")}))),void 0===b[x]&&(b[x]=[])}"Node"===x&&(b.id=y),x in b&&Array.isArray(b[x])?b[x].push(y):"a"!==x?b[x]=y:b.a=y,this.setCurrentProp(b,x),"a"===x&&","!==y.slice(-1)&&(b.a=pxlNav_parseNumberArray(y))}else this.parseNodeSpecialProperty(u,x,y)}parseNodePropertyContinued(u){var d=this.getCurrentNode();d.a+=u,","!==u.slice(-1)&&(d.a=pxlNav_parseNumberArray(d.a))}parseNodeSpecialProperty(u,d,v){var x=v.split('",').map((function(u){return u.trim().replace(/^\"/,"").replace(/\s/,"_")})),y=x[0],b=x[1],_=x[2],w=x[3],S=x[4];switch(b){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":S=parseFloat(S);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":S=pxlNav_parseNumberArray(S)}this.getPrevNode()[y]={type:b,type2:_,flag:w,value:S},this.setCurrentProp(this.getPrevNode(),y)}}class pxlNav_BinaryParser{parse(u){var d=new pxlNav_BinaryReader(u);d.skip(23);var v=d.getUint32();if(v<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+v);for(var x=new pxlNav_FBXTree;!this.endOfContent(d);){var y=this.parseNode(d,v);null!==y&&x.add(y.name,y)}return x}endOfContent(u){return u.size()%16==0?(u.getOffset()+160+16&-16)>=u.size():u.getOffset()+160+16>=u.size()}parseNode(u,d){var v={},x=d>=7500?u.getUint64():u.getUint32(),y=d>=7500?u.getUint64():u.getUint32();d>=7500?u.getUint64():u.getUint32();var b=u.getUint8(),_=u.getString(b);if(0===x)return null;for(var w=[],S=0;S<y;S++)w.push(this.parseProperty(u));var C=w.length>0?w[0]:"",P=w.length>1?w[1]:"",A=w.length>2?w[2]:"";for(v.singleProperty=1===y&&u.getOffset()===x;x>u.getOffset();){var T=this.parseNode(u,d);null!==T&&this.parseSubNode(_,v,T)}return v.propertyList=w,"number"==typeof C&&(v.id=C),""!==P&&(v.attrName=P),""!==A&&(v.attrType=A),""!==_&&(v.name=_),v}parseSubNode(u,d,v){if(!0===v.singleProperty){var x=v.propertyList[0];Array.isArray(x)?(d[v.name]=v,v.a=x):d[v.name]=x}else if("Connections"===u&&"C"===v.name){var y=[];v.propertyList.forEach((function(u,d){0!==d&&y.push(u)})),void 0===d.connections&&(d.connections=[]),d.connections.push(y)}else if("Properties70"===v.name){Object.keys(v).forEach((function(u){d[u]=v[u]}))}else if("Properties70"===u&&"P"===v.name){var b,_=v.propertyList[0],w=v.propertyList[1],S=v.propertyList[2],C=v.propertyList[3];0===_.indexOf("Lcl ")&&(_=_.replace("Lcl ","Lcl_")),0===w.indexOf("Lcl ")&&(w=w.replace("Lcl ","Lcl_")),b="Color"===w||"ColorRGB"===w||"Vector"===w||"Vector3D"===w||0===w.indexOf("Lcl_")?[v.propertyList[4],v.propertyList[5],v.propertyList[6]]:v.propertyList[4],d[_]={type:w,type2:S,flag:C,value:b}}else void 0===d[v.name]?"number"==typeof v.id?(d[v.name]={},d[v.name][v.id]=v):d[v.name]=v:"PoseNode"===v.name?(Array.isArray(d[v.name])||(d[v.name]=[d[v.name]]),d[v.name].push(v)):void 0===d[v.name][v.id]&&(d[v.name][v.id]=v)}parseProperty(u){var d,v=u.getString(1);switch(v){case"C":return u.getBoolean();case"D":return u.getFloat64();case"F":return u.getFloat32();case"I":return u.getInt32();case"L":return u.getInt64();case"R":return d=u.getUint32(),u.getArrayBuffer(d);case"S":return d=u.getUint32(),u.getString(d);case"Y":return u.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var x=u.getUint32(),y=u.getUint32(),b=u.getUint32();if(0===y)switch(v){case"b":case"c":return u.getBooleanArray(x);case"d":return u.getFloat64Array(x);case"f":return u.getFloat32Array(x);case"i":return u.getInt32Array(x);case"l":return u.getInt64Array(x)}var _=pxlNav_unzlibSync(new Uint8Array(u.getArrayBuffer(b))),w=new pxlNav_BinaryReader(_.buffer);switch(v){case"b":case"c":return w.getBooleanArray(x);case"d":return w.getFloat64Array(x);case"f":return w.getFloat32Array(x);case"i":return w.getInt32Array(x);case"l":return w.getInt64Array(x)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+v)}}}class pxlNav_BinaryReader{constructor(u,d){this.dv=new DataView(u),this.offset=0,this.littleEndian=void 0===d||d,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(u){this.offset+=u}getBoolean(){return!(1&~this.getUint8())}getBooleanArray(u){for(var d=[],v=0;v<u;v++)d.push(this.getBoolean());return d}getUint8(){var u=this.dv.getUint8(this.offset);return this.offset+=1,u}getInt16(){var u=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,u}getInt32(){var u=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,u}getInt32Array(u){for(var d=[],v=0;v<u;v++)d.push(this.getInt32());return d}getUint32(){var u=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,u}getInt64(){var u,d;return this.littleEndian?(u=this.getUint32(),d=this.getUint32()):(d=this.getUint32(),u=this.getUint32()),2147483648&d?(d=4294967295&~d,4294967295===(u=4294967295&~u)&&(d=d+1&4294967295),-(4294967296*d+(u=u+1&4294967295))):4294967296*d+u}getInt64Array(u){for(var d=[],v=0;v<u;v++)d.push(this.getInt64());return d}getUint64(){var u,d;return this.littleEndian?(u=this.getUint32(),d=this.getUint32()):(d=this.getUint32(),u=this.getUint32()),4294967296*d+u}getFloat32(){var u=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,u}getFloat32Array(u){for(var d=[],v=0;v<u;v++)d.push(this.getFloat32());return d}getFloat64(){var u=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,u}getFloat64Array(u){for(var d=[],v=0;v<u;v++)d.push(this.getFloat64());return d}getArrayBuffer(u){var d=this.dv.buffer.slice(this.offset,this.offset+u);return this.offset+=u,d}getString(u){var d=this.offset,v=new Uint8Array(this.dv.buffer,d,u);this.skip(u);var x=v.indexOf(0);return x>=0&&(v=new Uint8Array(this.dv.buffer,d,x)),this._textDecoder.decode(v)}}class pxlNav_FBXTree{add(u,d){this[u]=d}}function pxlNav_getFbxVersion(u){var d=u.match(/FBXVersion: (\d+)/);if(d)return parseInt(d[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function pxlNav_convertFBXTimeToSeconds(u){return u/46186158e3}var ks=[];function pxlNav_getData(u,d,v,x){var y;switch(x.mappingType){case"ByPolygonVertex":y=u;break;case"ByPolygon":y=d;break;case"ByVertice":y=v;break;case"AllSame":y=x.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+x.mappingType)}"IndexToDirect"===x.referenceType&&(y=x.indices[y]);var b=y*x.dataSize,_=b+x.dataSize;return function pxlNav_slice(u,d,v,x){for(var y=v,b=0;y<x;y++,b++)u[b]=d[y];return u}(ks,x.buffer,b,_)}var Rs=new pxlNav_yr,Os=new pxlNav_Ii;function pxlNav_generateTransform(u){var d=new pxlNav_nr,v=new pxlNav_nr,x=new pxlNav_nr,y=new pxlNav_nr,b=new pxlNav_nr,_=new pxlNav_nr,w=new pxlNav_nr,S=new pxlNav_nr,C=new pxlNav_nr,P=new pxlNav_nr,A=new pxlNav_nr,T=new pxlNav_nr,E=u.inheritType?u.inheritType:0;u.translation&&d.setPosition(Os.fromArray(u.translation));var D=pxlNav_getEulerOrder(0);if(u.preRotation){var I=u.preRotation.map(me);I.push(D),v.makeRotationFromEuler(Rs.fromArray(I))}if(u.rotation){var k=u.rotation.map(me);k.push(u.eulerOrder||D),x.makeRotationFromEuler(Rs.fromArray(k))}if(u.postRotation){var R=u.postRotation.map(me);R.push(D),y.makeRotationFromEuler(Rs.fromArray(R)),y.invert()}u.scale&&b.scale(Os.fromArray(u.scale)),u.scalingOffset&&w.setPosition(Os.fromArray(u.scalingOffset)),u.scalingPivot&&_.setPosition(Os.fromArray(u.scalingPivot)),u.rotationOffset&&S.setPosition(Os.fromArray(u.rotationOffset)),u.rotationPivot&&C.setPosition(Os.fromArray(u.rotationPivot)),u.parentMatrixWorld&&(A.copy(u.parentMatrix),P.copy(u.parentMatrixWorld));var O=v.clone().multiply(x).multiply(y),j=new pxlNav_nr;j.extractRotation(P);var G=new pxlNav_nr;G.copyPosition(P);var H=G.clone().invert().multiply(P),X=j.clone().invert().multiply(H),q=b,Z=new pxlNav_nr;if(0===E)Z.copy(j).multiply(O).multiply(X).multiply(q);else if(1===E)Z.copy(j).multiply(X).multiply(O).multiply(q);else{var J=(new pxlNav_nr).scale((new pxlNav_Ii).setFromMatrixScale(A)).clone().invert(),Q=X.clone().multiply(J);Z.copy(j).multiply(O).multiply(Q).multiply(q)}var K=C.clone().invert(),Y=_.clone().invert(),$=d.clone().multiply(S).multiply(C).multiply(v).multiply(x).multiply(y).multiply(K).multiply(w).multiply(_).multiply(b).multiply(Y),ee=(new pxlNav_nr).copyPosition($),te=P.clone().multiply(ee);return T.copyPosition(te),($=T.clone().multiply(Z)).premultiply(P.invert()),$}function pxlNav_getEulerOrder(u){var d=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(u=u||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),d[0]):d[u]}function pxlNav_parseNumberArray(u){return u.split(",").map((function(u){return parseFloat(u)}))}function pxlNav_convertArrayBufferToString(u,d,v){return void 0===d&&(d=0),void 0===v&&(v=u.byteLength),(new TextDecoder).decode(new Uint8Array(u,d,v))}class pxlNav_FileIO{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.pxlTimer=null,this.pxlUtils=null,this.pxlQuality=null,this.pxlVideo=null,this.pxlCamera=null,this.pxlAutoCam=null,this.pxlUser=null,this.pxlEnv=null,this.pxlAnim=null,this.pxlDevice=null,this.pxlShaders=null,this.options={},this.runDebugger=!1,this.assetRoot=this.findInDict(u,"assetRoot","images/assets/"),this.guiRoot=this.findInDict(u,"guiRoot","images/GUI/"),this.roomRoot=this.findInDict(u,"roomRoot","images/rooms/"),this.vidRoot=this.findInDict(u,"vidRoot","images/screenContent/"),this.workerList=[]}setDependencies(pxlNav){this.pxlTimer=pxlNav.pxlTimer,this.pxlUtils=pxlNav.pxlUtils,this.pxlQuality=pxlNav.pxlQuality,this.pxlVideo=pxlNav.pxlVideo,this.pxlCamera=pxlNav.pxlCamera,this.pxlAutoCam=pxlNav.pxlAutoCam,this.pxlUser=pxlNav.pxlUser,this.pxlEnv=pxlNav.pxlEnv,this.pxlAnim=pxlNav.pxlAnim,this.pxlDevice=pxlNav.pxlDevice,this.pxlShaders=pxlNav.pxlShaders,this.options=pxlNav.options}log(){if(this.runDebugger){console.log("---");for(var u=arguments.length,d=new Array(u),v=0;v<u;v++)d[v]=arguments[v];d.forEach((u=>{console.log(u)}))}}toggleDebugger(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;u||(u=!this.runDebugger),this.runDebugger=u}findInDict(u,d,v){return u.hasOwnProperty(d)?u[d]:(u[d]=v,v)}tosRGB(u){return u<=.0031308?u*=12.92:u=1.055*Math.pow(u,1/2.4)-.055,u}checkForUserData(u,d,v){if(v.hasOwnProperty("userData")){if(v.hasOwnProperty("material")&&(v.userData.hasOwnProperty("doubleSided")&&v.userData.doubleSided?v.material.side=j.DoubleSide:v.material.side=j.FrontSide),v.userData.hasOwnProperty("GlowPass")&&v.userData.GlowPass&&(u.geoList.GlowPass||(u.geoList.GlowPass=[]),u.geoList.GlowPass.push(v)),v.userData.hasOwnProperty("GlowPassMask")&&v.userData.GlowPass&&(u.geoList.GlowPassMask||(u.geoList.GlowPassMask=[]),u.geoList.GlowPassMask.push(v)),v.userData.hasOwnProperty("castShadow")&&v.userData.castShadow&&(v.castShadow=!0),v.userData.hasOwnProperty("receiveShadow")&&v.userData.receiveShadow&&(v.receiveShadow=!0),v.userData.hasOwnProperty("Shader")&&""!=v.userData.Shader){v.userData.Shader.trim();u.shaderGeoList||(u.shaderGeoList={}),u.shaderGeoList[v.name]=v}if(v.userData.hasOwnProperty("Emitter")&&""!=v.userData.Emitter&&(u.emitterList||(u.emitterList={}),u.emitterList[v.userData.Emitter]||(u.emitterList[v.userData.Emitter]={},u.emitterList[v.userData.Emitter].Emitter=[],u.emitterList[v.userData.Emitter].Particles=[]),u.emitterList[v.userData.Emitter].Emitter.push(v)),v.userData.hasOwnProperty("Hover")&&v.userData.Hover&&(u.hoverableExists=!0,u.hoverableList.push(v)),v.userData.hasOwnProperty("Click")&&v.userData.Click&&(u.clickableExists=!0,u.clickableList.push(v)),this.checkObjectInstancing(u,d,v),v.userData.hasOwnProperty("Scripted"))u.geoList.hasOwnProperty("Scripted")||(u.geoList.Scripted={}),u.geoList.Scripted[v.name]=v,v.children.forEach((x=>{if(x.name.includes("Geo")){var y=v.position,b=v.rotation,_=v.scale;x.position.set(y.x,y.y,y.z),x.rotation.set(b.x,b.y,b.z),x.scale.set(_.x,_.y,_.z),x.updateMatrix(),x.children.forEach((v=>{this.checkForUserData(u,d,v),"Group"==v.type&&(v.position.set(y.x+v.position.x,y.y+v.position.y,y.z+v.position.z),v.rotation.set(b.x,b.y,b.z),v.scale.set(_.x,_.y,_.z)),v.updateMatrix()}))}else if(x.name.includes("Colliders")){var w=v.position,S=v.rotation,C=v.scale;x.position.set(w.x,w.y,w.z),x.rotation.set(S.x,S.y,S.z),x.scale.set(C.x,C.y,C.z),x.updateMatrix(),x.visible=!1}}))}}canAppendChildren(u,d){if("Group"!=d.type)return!1;var v=!0;return u.geoList.hasOwnProperty("Scripted")&&u.geoList.Scripted.hasOwnProperty(d.name)&&(console.log(u.geoList.Scripted,u.geoList.Scripted.hasOwnProperty(d.name),d.name),v=!1),v}canAddToScene(u,d){var v=!0;return d.hasOwnProperty("userData")&&d.userData.hasOwnProperty("Instance")&&u.hasOwnProperty("baseInstancesNames")&&u.baseInstancesNames.hasOwnProperty(d.userData.Instance)&&(v=!1),v}checkIsGlassLiquid(u,d,v,x){var y=!1;if(v.userData.hasOwnProperty("isGlass")&&v.userData.isGlass&&(y=!0),v.userData.hasOwnProperty("isLiquid")&&v.userData.isLiquid&&(y=!0),!y)return!1;if(this.log("Glass Detected - ",v.name),!u.glassGroup){var b=new j.Group;u.glassGroup=b,d.add(b)}var _=v.material.clone();v.material=_,v.material.transparent=!0,v.material.opacity=.5,v.material.shininess=20,v.material.specular=v.material.color.clone(),v.material.specular.r=.5*v.material.specular.r+.1,v.material.specular.g=.5*v.material.specular.g+.1,v.material.specular.b=.5*v.material.specular.b+.1,v.material.side=j.BackSide,v.material.depthWrite=!1,v.matrixAutoUpdate=!1,v.renderOrder=1,u.glassList.push(v),u.glassGroup.add(v);var w=v.geometry.clone(),S=v.material.clone();S.copy(v.material);var C=new j.Mesh(w,S);C.name=v.name+"_Front",C.material.shininess=40,C.material.side=j.FrontSide,C.matrixAutoUpdate=!1,C.renderOrder=2;var P=v.position,A=v.rotation,T=v.scale;return C.rotation.set(A.x,A.y,A.z),C.position.set(P.x,P.y,P.z),C.scale.set(T.x,T.y,T.z),C.updateMatrix(),v.parent.add(C),u.glassList.push(C),u.glassGroup.add(C),y}checkObjectInstancing(u,d,v){if(!u.hasOwnProperty("baseInstancesNames")||!u.hasOwnProperty("baseInstancesList"))return!1;if(v.hasOwnProperty("userData")&&v.userData.hasOwnProperty("Instance")&&u.baseInstancesList.hasOwnProperty(v.userData.Instance)){var x=v.name;this.log("Generate Instance - ",x),u.geoList.hasOwnProperty("InstanceObjects")||(u.geoList.InstanceObjects={});var y=v.position,b=v.rotation,_=v.scale,w=u.baseInstancesList[v.userData.Instance];if("Mesh"==v.type){for(var S=new j.Matrix4,C=new j.Vector3,P=new j.Vector3,A=new j.Quaternion,T=new j.Vector3(1,1,1),E=v.geometry.attributes.hasOwnProperty("color"),D={},I=[],k=0;k<v.geometry.attributes.position.count;++k){C.fromBufferAttribute(v.geometry.attributes.position,k);var R=C.toArray();if(R=R.join(","),!D.hasOwnProperty(R)){P.fromBufferAttribute(v.geometry.attributes.normal,k);var O=new j.Euler(0,2*Math.random()*Math.PI,0);A.setFromEuler(O);var G=T;if(E){var H=v.geometry.attributes.color.getX(k);H=this.tosRGB(H),G=new j.Vector3(H,H,H)}S.compose(C,A,G),I.push(S.clone()),D[R]=!0}}if(I.length>0){var X=new j.InstancedMesh(w.geometry,w.material,I.length);X.instanceMatrix.setUsage(j.DynamicDrawUsage),X.name=x+"Geo";for(var q=0;q<I.length;++q)X.setMatrixAt(q,I[q]);X.visible=!0,X.updateMatrix(),u.geoList.InstanceObjects[x]=X,v.parent.add(X)}v.visible=!1,v.parent.remove(v)}else{var Z=new j.InstancedMesh(w.geometry,w.material,1);Z.instanceMatrix.setUsage(j.DynamicDrawUsage),Z.name=x+"Geo";var J=!1;if(v.userData.hasOwnProperty("fixInstMatrix")&&(J=!!v.userData.fixInstMatrix),J)Z.rotation.set(b.x,b.y,b.z),Z.position.set(y.x,y.y,y.z),Z.scale.set(_.x,_.y,_.z);else{var Q=new j.Matrix4;Q.compose(y,(new j.Quaternion).setFromEuler(b),_),Z.setMatrixAt(0,Q)}Z.visible=!0,Z.updateMatrix(),u.geoList.InstanceObjects[x]=Z,v.parent.add(Z),v.visible=!1,v.parent.remove(v)}}}loadSceneFBX(u,d,v,x,y,b){var _=this;""!=y&&(this.pxlEnv.geoLoadListComplete=0,this.pxlEnv.geoLoadList[y]=0);var w=new pxlNav_FBXLoader;return w.load(u,(u=>{var d=u.children,v={},x=[];d.forEach(((u,d)=>{x.push(u.name),v[u.name]=d})),x.forEach((u=>{u.includes("Camera")&&(d[v[u]].children.forEach(((u,d)=>{if(u.matrixAutoUpdate=!1,u.name.includes("Position")){var v=u.position.clone();this.pxlCamera.cameraPrevPos=v.clone(),this.pxlCamera.camera.position.copy(v),this.pxlCamera.cameraPos.copy(v),this.pxlCamera.camera.updateMatrixWorld(),this.pxlCamera.cameraBooted=!0,this.pxlEnv.camInitPos=v,this.pxlEnv.camThumbPos=this.pxlEnv.camThumbPos.clone().add(v.clone())}else if(u.name.includes("LookAt")){var x=u.position.clone();this.pxlCamera.cameraAimTarget.position.copy(x),this.pxlCamera.camera.lookAt(x),this.pxlCamera.camera.updateMatrixWorld(),this.pxlCamera.cameraPrevLookAt=new j.Vector3,this.pxlEnv.camInitLookAt=x,this.pxlEnv.camThumbLookAt=this.pxlEnv.camThumbLookAt.clone().add(x.clone())}else if(u.name.includes("ReturnPosition")){var y=u.position.clone();this.pxlEnv.camReturnPos=y}else if(u.name.includes("ReturnLookAt")){var b=u.position.clone();this.pxlEnv.camReturnLookAt=b}})),this.pxlDevice.touchMouseData.initialQuat=this.pxlCamera.camera.quaternion.clone());if(u.includes("Items"))for(var x=d[v[u]].children,y=null,w=null,S=null,C=null,P=function _loop(){var u=x.pop();"Group"==u.type&&(u.children.forEach((d=>{d.name.includes("Item")?(u.name.includes("LowGravity")?(null==w&&(w=new j.ShaderMaterial({uniforms:{color:{value:d.material.emissive.clone()},alphaMap:{type:"t",value:d.material.map},cloudNoise:{type:"t",value:_.pxlEnv.cloud3dTexture},time:{value:_.pxlTimer.msRunner},intensity:{type:"f",value:1.5},rate:{type:"f",value:_.pxlUser.itemRotateRate}},vertexShader:_.pxlShaders.objects.itemVert(),fragmentShader:_.pxlShaders.objects.itemFrag(),transparent:!0,side:j.DoubleSide,depthTest:!0,depthWrite:!1})),d.material=w):u.name.includes("LizardKing")?(null==S&&((S=d.material.clone()).emissiveMap=S.map,S.emissive=new j.Color(8421504)),d.material=S):u.name.includes("StarField")||u.name.includes("InfinityZoom")&&(null==C&&(C=new j.ShaderMaterial({uniforms:{color:{value:d.material.map},cloudNoise:{type:"t",value:_.pxlEnv.cloud3dTexture},time:{value:_.pxlTimer.msRunner},intensity:{type:"f",value:1},rate:{type:"f",value:_.pxlUser.itemRotateRate}},vertexShader:_.pxlShaders.core.defaultVert(),fragmentShader:_.pxlShaders.objects.itemZoomFrag(),transparent:!0,side:j.DoubleSide,depthTest:!0,depthWrite:!0})),d.material=C),_.pxlUser.itemList[u.name]=d):d.name.includes("ItemBase")&&(null==y&&(y=new j.ShaderMaterial({uniforms:{color:{value:d.material.emissive.clone()},alphaMap:{type:"t",value:d.material.map},cloudNoise:{type:"t",value:_.pxlEnv.cloud3dTexture},time:{value:_.pxlTimer.msRunner},intensity:{type:"f",value:1.5},rate:{type:"f",value:_.pxlUser.itemBaseRotateRate}},vertexShader:_.pxlShaders.objects.itemBaseVert(),fragmentShader:_.pxlShaders.objects.itemBaseFrag(),transparent:!0,side:j.DoubleSide,depthTest:!0,depthWrite:!1})),d.material=y,_.pxlUser.itemBaseList.push(d))})),b[0].add(u),_.pxlUser.itemGroupList[u.name]=u,_.pxlUser.itemListNames.push(u.name))};x.length>0;)P()})),""!=y&&(this.pxlEnv.geoList[y]=u,this.pxlEnv.geoLoadList[y]=1),this.pxlEnv.geoLoadList[y]=1}),void 0,(u=>{""!=y&&(this.pxlEnv.geoLoadList[y]=1)})),w}loadRoomFBX(u){var d=this,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,y=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.runDebugger=!!y,null==x&&(x=u.roomName),v||(v=u.sceneFile);var b=u.sceneFile,_=u.materialList;this.pxlEnv.geoLoadListComplete=0,this.pxlEnv.geoLoadList[x]=0;var w=u.scene,S=new pxlNav_FBXLoader;return S.load(b,(v=>{var y=v.children,b={},S=[];y.forEach(((u,d)=>{var v=u.name.split("_")[0];S.push(v),b[v]=d}));if(S.indexOf("Camera")>-1){var C=[];this.log("Camera - ",y[b.Camera]);y[b.Camera].children.forEach(((u,d)=>{u.name.includes("Position")||u.name.includes("LookAt")||u.name.includes("ReturnPosition")||u.name.includes("ReturnLookAt")?(C.push(u),!0):u.children.length>0&&C.push(...u.children)})),C.forEach(((d,v)=>{d.matrixAutoUpdate=!1;var x=d.parent.name;if(x==y[b.Camera].name&&(x="Default"),u.camLocation.hasOwnProperty(x)||(u.camLocation[x]={},u.camLocation[x].Position=new j.Vector3(0,0,-10),u.camLocation[x].LookAt=new j.Vector3(0,0,0)),d.name.includes("PositionMobile")){var _=d.position.clone();u.cameraBooted=!0,u.camInitPos=_,u.camLocation[x].PositionMobile=_}else if(d.name.includes("LookAtMobile")){var w=d.position.clone();u.camInitLookAt=w,u.camLocation[x].LookAtMobile=w}else if(d.name.includes("Position")){var S=d.position.clone();u.cameraBooted=!0,u.camInitPos=S,u.camLocation[x].Position=S}else if(d.name.includes("LookAt")){var C=d.position.clone();u.camInitLookAt=C,u.camLocation[x].LookAt=C}else if(d.name.includes("ReturnPosition")){var P=d.position.clone();u.camReturnPos=P,u.camLocation[x].ReturnPosition=P}else if(d.name.includes("ReturnLookAt")){var A=d.position.clone();u.camReturnLookAt=A,u.camLocation[x].ReturnLookAt=A}})),Object.keys(u.camLocation).forEach((d=>{var v=u.camLocation[d];v.hasOwnProperty("PositionMobile")||(v.PositionMobile=v.Position),v.hasOwnProperty("LookAtMobile")||(v.LookAtMobile=v.LookAt)}))}if(S.indexOf("AutoCamPaths")>-1){var P=y[b.AutoCamPaths].children;this.log("AutoCamPaths - ",y[b.AutoCamPaths]),this.pxlAutoCam.autoCamPaths[u.roomName]=[];for(var A=function _loop2(){var v=P.pop();if("Group"==v.type){var x={};v.children.forEach((u=>{u.matrixAutoUpdate=!1,x[u.name]=u})),v.visible=!1,v.matrixAutoUpdate=!1,w.add(v),d.pxlAutoCam.autoCamPaths[u.roomName].push(x)}};P.length>0;)A()}if(S.indexOf("Instances")>-1&&0==this.pxlQuality.detailLimit){var T=[...y[b.Instances].children];if(this.log("Instances - ",y[b.Instances]),T.length>0){u.hasOwnProperty("baseInstancesNames")||(u.baseInstancesNames=[]),u.hasOwnProperty("baseInstancesList")||(u.baseInstancesList={});T.forEach(((d,v)=>{if(this.checkForUserData(u,w,d),_.hasOwnProperty(d.name)){var x=null;d.material.map&&(x=d.material.map),d.material=_[d.name],x&&(d.material.uniforms.hasOwnProperty("diffuse")&&(d.material.uniforms.diffuse.value=x),d.material.hasOwnProperty("emissiveMap")&&(d.material.emissiveMap=x,d.material.emissive.r>0&&(d.material.emissiveIntensity=d.material.emissive.r))),d.matrixAutoUpdate=!1}u.baseInstancesNames.push(d),u.baseInstancesList[d.name]=d}))}}if(S.indexOf("Lights")>-1){var E=y[b.Lights].children;for(this.log("Lights - ",y[b.Lights]);E.length>0;){var D=E.pop();E.push(...D.children),D.type.includes("Light")&&(u.hasOwnProperty("lightList")||(u.lightList={}),u.geoList.hasOwnProperty("lights")||(u.geoList.lights=[]),"PointLight"==D.type&&(D.decay=3,D.distance=20*D.intensity,D.intensity=2),u.lightList.hasOwnProperty(D.type)||(u.lightList[D.type]=[]),u.lightList[D.type].push(D),u.geoList.lights.push(D),D.matrixAutoUpdate=!1,w.add(D))}}if(S.includes("Scene")||S.includes("MainScene")){var I=b.Scene||b.MainScene,k=y[I].children;this.log("MainScene - ",y[I]);for(var R=-1,O=function _loop3(){if(++R>=k.length)return 1;var v=k[R];if(d.checkForUserData(u,w,v),v.isMesh){!v.userData.hasOwnProperty("Show")||v.userData.Show&&0!=v.userData.Show||(v.visible=!1),u.geoList[v.name]=v;var x=j.FrontSide;if(v.userData.doubleSided&&(x=j.DoubleSide),_.hasOwnProperty(v.name)){var y=null;v.material.map&&(y=v.material.map),v.material=_[v.name],y&&(v.material.uniforms.hasOwnProperty("diffuse")&&(v.material.uniforms.diffuse.value=y),v.material.hasOwnProperty("emissiveMap")&&(v.material.emissiveMap=y,v.material.emissive.r>0&&(v.material.emissiveIntensity=v.material.emissive.r))),v.matrixAutoUpdate=!1}else{var b=v.material;Array.isArray(v.material)||(b=[v.material]),d.checkIsGlassLiquid(u,w,v,b)||b.forEach((u=>{u.map&&!u.emissiveMap&&u.emissive.r>0&&(u.emissiveMap=u.map,u.emissiveIntensity=u.emissive.r,u.emissive=new j.Color(16777215)),u.side=x})),v.matrixAutoUpdate=!1}}else if(v.type.includes("Light"))u.lightList.hasOwnProperty(v.type)||(u.lightList[v.type]=[]),u.lightList[v.type].push(v);else if("Group"==v.type){if(u.geoList.hasOwnProperty("Scripted"))Object.keys(u.geoList.Scripted);k.push(...v.children)}};R<k.length&&!O(););w.add(y[I])}if(S.indexOf("Glass")>-1){var G=y[b.Glass].children;if(this.log("Glass - ",y[b.Glass]),G.length>0){if(!u.glassGroup){var H=new j.Group;u.glassGroup=H,w.add(H)}for(;G.length>0;){var X=G.pop();if(G.push(...X.children),X.isMesh){this.checkForUserData(u,w,X);var q=X.material.clone();X.material=q,X.material.transparent=!0,X.material.opacity=.5,X.material.shininess=20,X.material.specular=X.material.color.clone(),X.material.specular.r=.5*X.material.specular.r+.1,X.material.specular.g=.5*X.material.specular.g+.1,X.material.specular.b=.5*X.material.specular.b+.1,X.material.side=j.BackSide,X.material.depthWrite=!1,X.matrixAutoUpdate=!1,X.renderOrder=1,u.glassList.push(X),u.glassGroup.add(X);var Z=X.geometry.clone(),J=X.material.clone();J.copy(X.material);var Q=new j.Mesh(Z,J);Q.material.shininess=40,Q.material.side=j.FrontSide,Q.matrixAutoUpdate=!1,Q.renderOrder=2;var K=X.position,Y=X.rotation,$=X.scale;Q.rotation.set(Y.x,Y.y,Y.z),Q.position.set(K.x,K.y,K.z),Q.scale.set($.x,$.y,$.z),Q.updateMatrix(),w.add(Q),u.glassList.push(Q),u.glassGroup.add(Q)}}}}if(S.indexOf("Colliders")>-1){var ee=y[b.Colliders];this.log("Colliders - ",y[b.Colliders]);var te=ee.children;u.collidersExist=te.length>0;for(var ie=0;ie<te.length;++ie)for(var se=te[ie].name,re=te[ie].children;re.length>0;){var ae=re.pop();if(re.push(...ae.children),ae.isMesh){ae.visible=!1;var ne="noAxis";ae.userData.checkX&&ae.userData.checkZ&&(ne=~~(ae.userData.checkX>0)+""+~~(ae.userData.checkZ>0)),"ColliderWalls"==se?(u.antiColliderActive=!0,u.antiColliderList[ne].push(ae)):"ColliderTops"==se?(u.antiColliderTopActive=!0,u.antiColliderTopList[ne].push(ae)):("RoomWarpZone"==se&&u.roomWarp.push(ae),u.colliderActive=!0,u.colliderList[ne].push(ae)),ae.matrixAutoUpdate=!1,w.add(ae),u.geoList[ae.name]=ae}}}if(S.indexOf("PortalExit")>-1){var oe=y[b.PortalExit].children;for(this.log("PortalExit - ",y[b.PortalExit]);oe.length>0;){var le=oe.pop();le.matrixAutoUpdate=!1,u.portalList[le.name]=le}}if(S.indexOf("FlatColor")>-1){var he=y[b.FlatColor].children;for(this.log("FlatColor - ",y[b.FlatColor]);he.length>0;){var ue=he.pop();if(he.push(...ue.children),ue.isMesh){this.checkForUserData(u,w,ue);var ce=new MeshBasicMaterial({color:ue.material.color.clone()});ce.side=j.FrontSide,ce.flatShading=!0,ue.material=ce,ue.matrixAutoUpdate=!1,w.add(ue)}}}if(S.indexOf("LambertColor")>-1){var pe=y[b.LambertColor].children;for(this.log("LambertColor - ",y[b.LambertColor]);pe.length>0;){var de=pe.pop();if(pe.push(...de.children),de.isMesh){this.checkForUserData(u,w,de);var ve=new MeshLambertMaterial;if(de.material.map){var me=de.material.map.clone();ve.map=me,ve.emissiveMap=me,ve.emissiveIntensity=.5,de.material=ve}else ve.color=de.material.color.clone(),ve.emissive=de.material.emissive.clone(),ve.side=j.FrontSide,ve.flatShading=!0,de.material=ve;de.matrixAutoUpdate=!1,w.add(de)}}}if(S.indexOf("Sky")>-1){var xe=y[b.Sky].children;for(this.log("Sky - ",y[b.Sky]);xe.length>0;){var ge=xe.pop();if(xe.push(...ge.children),ge.isMesh){var fe=new j.ShaderMaterial({uniforms:{diffuse:{type:"t",value:ge.material.map},envDiffuse:{type:"t",value:null},noiseTexture:{type:"t",value:this.pxlEnv.cloud3dTexture},fogColor:{value:w.fog.color},time:{value:this.pxlTimer.msRunner},camNear:{type:"f",value:u.camera.near},camFar:{type:"f",value:.85*u.camera.far},resUV:{value:this.pxlDevice.screenRes}},vertexShader:this.pxlShaders.scene.skyObjectVert(),fragmentShader:this.pxlShaders.scene.skyObjectFrag(this.options.skyHaze)});ge.material=fe,ge.matrixAutoUpdate=!1,ge.frustumCulled=!1,ge.layers.set(this.pxlEnv.renderLayerEnum.SKY),u.geoList[ge.name]=ge,u.materialList[ge.name]=fe,w.add(ge)}}}if(S.indexOf("AnimatedTextures")>-1){var ye=y[b.AnimatedTextures].children;for(this.log("AnimatedTextures - ",y[b.AnimatedTextures]);ye.length>0;){var be=ye.pop();if(ye.push(...be.children),be.isMesh){this.checkForUserData(u,w,be);var _e={time:{value:this.pxlTimer.msRunner},glowTexture:{type:"t",value:be.material.map},cloudNoise:{type:"t",value:this.pxlEnv.cloud3dTexture},glowColor:{value:new j.Vector3(.01,.35,.55)},intensity:{type:"f",value:.35},rate:{type:"f",value:2},freq:{type:"f",value:1}},we=this.pxlShaders.animated.animTextureVert(),Se=this.pxlShaders.animated.animTextureFrag(),Ce=new j.ShaderMaterial({uniforms:_e,vertexShader:we,fragmentShader:Se,transparent:!0,side:j.FrontSide});be.material=Ce,be.matrixAutoUpdate=!1,w.add(be)}}}if(S.indexOf("ScrollingTextures")>-1){var Ne=y[b.ScrollingTextures].children;this.log("ScrollingTextures - ",y[b.ScrollingTextures]);for(var Pe=1;Ne.length>0;){Pe+=1;var Me=Ne.pop();if(Ne.push(...Me.children),Me.isMesh){this.checkForUserData(u,w,Me);var Ae=Me.name,Te=.05;Ae.indexOf("_")>-1&&(Te=Ae.split("_")[1],Te=.01*parseInt(Te));var Ee=new j.ShaderMaterial({uniforms:{scrollTexture:{type:"t",value:Me.material.map},time:{value:this.pxlTimer.msRunner},speed:{value:Te},seed:{type:"f",value:1.1423*Pe},boostPerc:{value:1}},vertexShader:this.pxlShaders.animated.scrollingTextureVert(),fragmentShader:this.pxlShaders.animated.scrollingTextureFrag(),transparent:!0,side:j.FrontSide});Me.material=Ee,Me.matrixAutoUpdate=!1,w.add(Me)}}}if(S.indexOf("UserScreens")>-1){var De=y[b.UserScreens].children;this.log("UserScreens - ",y[b.UserScreens]);for(var Ie=0,Le=[new j.Vector3(1,0,0),new j.Vector3(0,1,0),new j.Vector3(0,0,1)],ke=[this.assetRoot+"DJ_Vector_Masks_1.jpg",this.assetRoot+"DJ_Vector_Masks_2.jpg",this.assetRoot+"DJ_Vector_Masks_3.jpg"],Re=0,Oe=0,Be=Le.length;De.length>0;){var Ve=De.pop();if(De.push(...Ve.children),Ve.isMesh){var Ue=new j.ShaderMaterial({uniforms:{camExists:{type:"f",value:0},time:{value:this.pxlTimer.msRunner},seed:{type:"f",value:1.1423*Ie},alpha:{type:"f",value:1},boostPerc:{value:u.userScreenIntensity},scale:{value:new j.Vector2(100,100)},ratio:{value:new j.Vector2(1,1)},videoFeed:{type:"t",value:null},cloudNoise:{type:"t",value:this.pxlEnv.cloud3dTexture},maskChannel:{value:Le[Re]},maskMap:{type:"t",value:this.pxlUtils.loadTexture(ke[Oe])}},vertexShader:u.userScreenVert,fragmentShader:u.userScreenFrag,transparent:!0,side:j.FrontSide});Ve.material=Ue,Ve.matrixAutoUpdate=!1,u.pxlEnv.camScreenData.screenGeoList.push(Ve),w.add(Ve),Re=(Ie+=1)%Be,Oe=Math.floor(Ie/3)%Be}}}if(S.indexOf("Items")>-1){var Fe=y[b.Items].children;this.log("Items - ",y[b.Items]);for(var je=function _loop4(){var u=Fe.pop();if("Group"==u.type){var v=u.children;v.length>0&&(v.forEach((v=>{if(v.name.includes("Item")){var x=new j.ShaderMaterial({uniforms:{color:{value:v.material.emissive.clone()},alphaMap:{type:"t",value:v.material.map},cloudNoise:{type:"t",value:d.cloud3dTexture},time:{value:d.pxlTimer.msRunner},intensity:{type:"f",value:1.5},rate:{type:"f",value:d.pxlUser.itemRotateRate}},vertexShader:d.pxlShaders.objects.itemVert(),fragmentShader:d.pxlShaders.objects.itemFrag(),transparent:!0,side:j.DoubleSide,depthTest:!0,depthWrite:!1});v.material=x,d.pxlUser.itemList[u.name]=v}else if(v.name.includes("Base")){var y=new j.ShaderMaterial({uniforms:{color:{value:v.material.emissive.clone()},alphaMap:{type:"t",value:v.material.map},cloudNoise:{type:"t",value:d.cloud3dTexture},time:{value:d.pxlTimer.msRunner},intensity:{type:"f",value:1.5},rate:{type:"f",value:d.pxlUser.itemBaseRotateRate}},vertexShader:d.pxlShaders.objects.itemBaseVert(),fragmentShader:d.pxlShaders.objects.itemBaseFrag(),transparent:!0,side:j.DoubleSide,depthTest:!0,depthWrite:!1});v.material=y,d.pxlUser.itemBaseList.push(v)}})),w.add(u),d.pxlUser.itemGroupList[u.name]=u,d.pxlUser.itemListNames.push(u.name))}};Fe.length>0;)je()}if(S.includes("Scripted")){var ze=y[b.Scripted].children;for(this.log("Scripted - ",y[b.Scripted]);ze.length>0;){var Ge=ze.pop();Ge.isMesh&&(u.geoList[Ge.name]=Ge,w.add(Ge))}}if(S.includes("Clickable")){var He=y[b.Clickable];this.log("Clickable - ",y[b.Clickable]);for(var We=He.children,Xe=0;Xe<We.length;++Xe)for(var qe=We[Xe].name,Ze=We[Xe].children;Ze.length>0;){var Je=Ze.pop();if(Ze.push(...Je.children),Je.isMesh)(new MeshBasicMaterial).color=new j.Color(16777215),Je.material.emissive=new j.Color(4473924),Je.material.emissiveMap=Je.material.map,Je.matrixAutoUpdate=!1,u.objectClickableObjectList[Je.name]||(u.objectClickableObjectList[Je.name]={}),u.objectClickableObjectList[Je.name][qe]=Je,u.objectClickable.push(Je),w.add(Je),"Hover"==qe&&(Je.visible=!1)}}if(S.includes("Markers")){var Qe=y[b.Markers].children;for(this.log("Markers - ",y[b.Markers]);Qe.length>0;){var Ke=Qe.pop();u.marker[Ke.name]=Ke.position}}this.pxlEnv.geoList[x]=v,this.pxlEnv.geoLoadList[x]=1,u.fbxPostLoad(),this.runDebugger=!1}),null,(u=>{""!=x&&(this.pxlEnv.geoLoadList[x]=1),this.log("Error Loading FBX"),this.log(u),this.runDebugger=!1})),S}loadAnimFBX(u,d,v,x,y){""==d&&(d=u.roomName),this.pxlEnv.geoLoadListComplete=0,this.pxlEnv.geoLoadList[d]=0;var b=u.scene,_=new pxlNav_FBXLoader;return _.load(v,(v=>{var _=v.children,w={},S=[];_.forEach(((u,d)=>{var v=u.name.split("_")[0];S.push(v),w[v]=d})),v.traverse((d=>{this.checkForUserData(u,b,d),d.userData.hasOwnProperty("doubleSided")&&d.userData.doubleSided&&(d.material.side=j.DoubleSide)})),this.pxlAnim.initObject(d,v),this.log("Animation FBX - ",S[0]),b.add(v),v.frustumCulled=!1;var C=new pxlNav_FBXLoader,P=[];Object.keys(x).forEach((u=>{var v=x[u],y=new Promise(((x,y)=>{C.load(v,(y=>{0==y.animations.length&&(this.log("No animations found in file",v),this.log(y),x()),this.pxlAnim.addClips(d,u,y),this.log("Animation Loaded",u),x()}),null,(u=>{this.log("Animation Load Error"),this.log(u),y(u)}))}));P.push(y)})),Promise.all(P).then((()=>{this.pxlAnim.setStateConnections(d,y),u.geoList[d]=v,this.pxlEnv.geoLoadList[d]=1,u.animPostLoad(d)})).catch((u=>{this.log("Error loading animations",u)}))}),null,(u=>{""!=d&&(this.pxlEnv.geoLoadList[d]=1)})),_}pxlShaderBuilder(u,d,v){var x,y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b={diffuse:{type:"t",value:null},time:{value:this.pxlTimer.msRunner}};null!=u&&(b=Object.assign({},b,u));var _={uniforms:b,vertexShader:d,fragmentShader:v};return y&&(_.defines=y),(x=new j.ShaderMaterial(_)).transparent=!0,x.depthTest=!0,x}removeChildren(u){for(var d=0,v=u.children,x=0;x<v.length;++x)"Group"==v[x].type&&(u.remove(v[x]),d++);return d}findMesh(u){for(var d=null,v=u.children,x=0;x<v.length;++x)if("Mesh"==v[x].type){d=v[x];break}return d}getBBoxCentroid(u){try{var d=(new j.Box3).setFromObject(u),v=d.min,x=d.max,y=(new j.Vector3).addVectors(x,v).multiplyScalar(.5);u.userData={bbox:d,centroid:y},null!=mapBookHelper&&mapBookHelper.update()}catch(u){console.log("- - - - - - - - ERROR - - - - - - - -"),console.log("     Object does not exist.\n           - Error Info -"),console.log(u),console.log("- - - - - - - - - - - - - - - - - - -")}}loadScript(u){return new Promise(((d,v)=>{var x=document.createElement("script");x.type="text/javascript",x.src=u,x.async=!0,x.onreadystatechange=()=>{d(!0)},x.onload=()=>{d(!0)},document.head.appendChild(x)}))}xmlHttp(){return window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")}static getURLContent(u){return new Promise(((d,v)=>{var x=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");x.open("GET",u),x.onload=u=>{4==x.readyState&&x.status>=200&&x.status<300?d(x.response):d(x.statusText)},x.onerror=()=>v(x.statusText),x.send()}))}getExternalHTML(u,d){if(window.XMLHttpRequest){var v=this.xmlHttp();v.onreadystatechange=function(){4==this.readyState&&200==this.status&&d&&"function"==typeof d&&d(v.responseText)},v.open("GET",u,!0),v.responceType="document",v.send()}else window.open(u,"_blank")}fetchURLStatus(u,d,v){fetch(u,{method:"HEAD"}).then((u=>{d(u.status,v)})).catch((u=>{d(404,v)}))}urlExistsFallback(u){return new Promise(((d,v)=>{var x=this.xmlHttp();x.open("HEAD",u,!0),x.send(),console.log(x),x.onreadystatechange=function(){this.readyState==this.DONE&&d(this.status<400)},x.onerror=u=>{d(!1)},x.ontimeout=u=>{d(!1)}}))}urlExists(u){return new Promise(((d,v)=>{this.urlExistsFallback(u).then((u=>{d(u)}))})).then((u=>u)).catch((u=>!1))}}var Bs={NONE:0,ERROR:1,WARN:2,INFO:3},Vs={OFF:0,LOW:1,MEDIUM:2,HIGH:3},Us={OFF:0,VAPOR:1},Fs={VERBOSE_LEVEL:Bs,ANTI_ALIASING:Vs,SKY_HAZE:Us,SHADOW_MAP:{OFF:0,BASIC:1,SOFT:2}};function pxlNav_Device_asyncGeneratorStep(u,d,v,x,y,b,_){try{var w=u[b](_),S=w.value}catch(u){return void v(u)}w.done?d(S):Promise.resolve(S).then(x,y)}function pxlNav_Device_asyncToGenerator(u){return function(){var d=this,v=arguments;return new Promise((function(x,y){var b=u.apply(d,v);function _next(u){pxlNav_Device_asyncGeneratorStep(b,x,y,_next,_throw,"next",u)}function _throw(u){pxlNav_Device_asyncGeneratorStep(b,x,y,_next,_throw,"throw",u)}_next(void 0)}))}}var js={verbose:Fs.VERBOSE_LEVEL.NONE,pxlRoomRoot:"./pxlRooms",staticCamera:!1,autoCamera:!1,antiAliasing:Fs.ANTI_ALIASING.LOW,shadowMapBiasing:Fs.SHADOW_MAP.BASIC,LoadEnvAssetFile:!1,skyHaze:Fs.SKY_HAZE.OFF,loaderPhrases:["...loading the pixels..."]};const zs=(u=>{var d={};return __webpack_require__.d(d,u),d})({EffectComposer:()=>d.EffectComposer});const Gs=(u=>{var d={};return __webpack_require__.d(d,u),d})({RenderPass:()=>v.RenderPass});const Hs=(u=>{var d={};return __webpack_require__.d(d,u),d})({ShaderPass:()=>x.ShaderPass});const Ws=(u=>{var d={};return __webpack_require__.d(d,u),d})({CopyShader:()=>y.CopyShader});const Xs=(u=>{var d={};return __webpack_require__.d(d,u),d})({UnrealBloomPass:()=>b.UnrealBloomPass});function pxlNav_Environment_asyncGeneratorStep(u,d,v,x,y,b,_){try{var w=u[b](_),S=w.value}catch(u){return void v(u)}w.done?d(S):Promise.resolve(S).then(x,y)}class pxlNav_SVGUtils{static svgPromise(u,d){var v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,y={},b=document.getElementById(d);if(b){null!=v&&b.classList.add(v);var _=Promise.resolve(pxlNav_FileIO.getURLContent(u));return _.then((u=>{b.innerHTML=u,y.svg=b.getElementsByTagName("svg")[0],null!=x&&y.svg.classList.add(x)})),y.promise=_,y}}static svgRawPromise(u){var d={};return Promise.resolve(pxlNav_FileIO.getURLContent(u)).then((u=>{var v=document.createElement("div");v.innerHTML=u,d.svg=v.getElementsByTagName("svg")[0]})),d}static svgIconPromise(u,d,v){var x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=this,_={hover:null,mute:null,caret:null,indicator:null,waiting:[],state:null};_.eventType=v;var w=document.getElementById(d);if(w){y?w.classList.add(y):w.classList.add("iconStyle"),_.parent=w.parentNode,_.parent.classList.add("iconHover"),_.parent.addEventListener("click",(u=>{b.iconEvent("click",_,v)}));var S=Promise.resolve(pxlNav_FileIO.getURLContent(u));return S.then((u=>{if(w.innerHTML=u,_.svg=w.getElementsByTagName("svg")[0],_.svg){y?_.svg.classList.add(y):_.svg.classList.add("iconStyle");for(var v=_.svg.children,b=_.svg.getAttribute("xmlns"),S=_.svg.getAttribute("height"),C=_.svg.getAttribute("width"),P=0;P<v.length;++P){var A=v[P];if("speakerIcon"==d){var T=w.getAttribute("xmlns"),E=(parseInt(S),parseInt(C),document.createElementNS(T,"rect"));E.setAttribute("x",-1),E.setAttribute("y",-1),E.setAttribute("fill","white"),E.setAttribute("fill-opacity",0),E.setAttribute("height",S+2),E.setAttribute("width",C+2),E.setAttribute("z-index",-1),w.appendChild(E),_.hover=E,_.svg.setAttribute("fill-opacity",this.toggleOpacity[0])}var D=A.getAttribute("id");if("mute"==D){_.mute=A,_.mute.style.transformOrigin="50% 50%",_.mute.style.filter="alpha(opacity=0)",_.mute.style.opacity="0",_.mute.style.transform="scale(0,0)",_.mute.style.transition="scale 1s, opacity .5s, filter .5s";var I=document.createElement("style");I.type="text/css",I.innerHTML="\n                                @keyframes loadingSpinner{\n                                    0%{\n                                        transform: rotate(0deg);\n                                    }\n                                    100%{\n                                        transform: rotate(360deg);\n                                    }\n                                }\n                            ",_.svg.appendChild(I);var k=Math.max(2,.25*Math.min(S,C)),R=.5*C,O=.5*S,j=document.createElementNS(b,"path");j.setAttribute("d"," M ".concat(R," ").concat(O-k," A ").concat(k," ").concat(k," 0 1 1 ").concat(R-k," ").concat(O," ")),j.setAttribute("stroke","white"),j.setAttribute("stroke-width","2"),j.style.display="none",j.style.transformOrigin="50% 50%",j.style.animation="loadingSpinner 1s linear infinite",j.style.animationDuration="2s",j.style.animationPlayState="paused",_.indicator=j,_.svg.appendChild(j),this.toggleIcon(_,x)}else"caret"==D?(_.caret=A,_.caret.style.transformOrigin="50% 50%",_.caret.style.transition="transform .5s",this.flipIcon(_,!1)):"state"==D?(A.style.display="none",_.state=A):_.waiting.push(A)}var G=document.createElementNS(b,"rect");G.classList.add("iconHover"),G.setAttribute("x",0),G.setAttribute("y",0),G.setAttribute("height",S),G.setAttribute("width",C),_.svg.appendChild(G)}})),_.promise=S,_}}static svgButtonPromise(u,d){var v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=arguments.length>3&&void 0!==arguments[3]&&arguments[3],y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if("string"!=typeof d||(d=document.getElementById(d))){var b=this;Promise.resolve(pxlNav_FileIO.getURLContent(u)).then((u=>{d.innerHTML=u;var _=d.getElementsByTagName("svg");if(_.length>0&&(_=_[0],v&&(v="string"==typeof v?[v]:v).forEach((u=>{_.classList.add(u)})),x)){var w=_.getAttribute("xmlns"),S=parseInt(_.getAttribute("height")),C=parseInt(_.getAttribute("width")),P=document.createElementNS(w,"rect");P.setAttribute("x",-1),P.setAttribute("y",-1),P.setAttribute("fill","white"),P.setAttribute("fill-opacity",0),P.setAttribute("height",S+2),P.setAttribute("width",C+2),P.setAttribute("z-index",-1),_.appendChild(P);var A=_.getElementById("state");A&&A.setAttribute("fill-opacity",this.toggleOpacity[0]),y&&(_.onclick=u=>{b.svgCheckClick(u,y)},b.pxlDevice.mobile?(_.ontouchstart=u=>{b.svgStylize(u,!0)},_.ontouchend=u=>{b.svgStylize(u,!1)}):(_.onmouseover=u=>{b.svgStylize(u,!0)},_.onmouseout=u=>{b.svgStylize(u,!1)}))}}))}}}function pxlNav_GUIBase_asyncGeneratorStep(u,d,v,x,y,b,_){try{var w=u[b](_),S=w.value}catch(u){return void v(u)}w.done?d(S):Promise.resolve(S).then(x,y)}function pxlNav_GUIBase_asyncToGenerator(u){return function(){var d=this,v=arguments;return new Promise((function(x,y){var b=u.apply(d,v);function _next(u){pxlNav_GUIBase_asyncGeneratorStep(b,x,y,_next,_throw,"next",u)}function _throw(u){pxlNav_GUIBase_asyncGeneratorStep(b,x,y,_next,_throw,"throw",u)}_next(void 0)}))}}class pxlNav_GUIManager{constructor(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Metal-Asylum",v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"images/assets/",x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"images/GUI/";this.projectTitle=d,this.verbose=u,this.sW=window.innerWidth,this.sH=window.innerHeight,this.mobile=!1,this.pxlFile=null,this.pxlCookie=null,this.pxlTimer=null,this.pxlAudio=null,this.pxlUtils=null,this.pxlUser=null,this.pxlDevice=null,this.pxlAutoCam=null,this.pxlCamera=null,this.pxlNavCanvas=null,this.pxlQuality=null,this.pxlEnv=null,this.assetRoot=v,this.guiRoot=x,this.introHelpActive=!0,this.branding={title:d,loader:x+".svg",logo:x+".svg",medalion:x+".svg",stack:x+".svg"},this.loaderPhrases=["Loading..."],this.lableBoxSize=40,this.optionWidthRound=10,this.optionWidthAdd=25,this.deviceOptionHeight=[0,300],this.pxlLoader=null,this.pxlLoaderCount=0,this.pxlLoaderTotal=5,this.hudBlock={obj:null,active:!1},this.userControlBlock=null,this.hudVisibility=!0,this.hudIcons={},this.hudElements={},this.guiWindows={},this.msgCount=0,this.hudMedalionBar=null,this.userProfileMessageInput=null,this.userProfileReturnMessage=null,this.userCountObj=null,this.userCountCur=0,this.messageCountObj=null,this.messageCountCur=0,this.chatMessageDisplay=null,this.chatMessageInput=null,this.camChoicesActive=!1,this.micChoicesActive=!1,this.pxlNavData={active:!1,gui:null,height:null,fpsSet:0,fps:null,dl:null,ul:null},this.djPlayerObj=null,this.buildGuiStatus={hud:!1,userTopBar:!1,bottomBar:!1,djPlayer:!1,roomControls:!1,verseList:!1,medalion:!0,loadingBranding:!1},this.requestVerseList=!1,this.verseList=[],this.verseUserCounts={},this.verseTitlePrefix="",this.verseTitleSuffix="'s Room",this.multiverseData={fromVerse:null,toVerse:null,electedVerse:null,mitosisState:!1,mitosisBufferTime:15,mitosisTime:0,mitosisUpdateTime:0},this.textDescriptions={chatIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">C</span> )</span><br>chat',pos:[1,-1.5]},multiverseIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">U</span> )</span><br>multiverse<br>selection',pos:[0,-1.3]},djPlayerVolumeParent:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">B</span> )</span><br>music volume',pos:[0,-1.5]},speakerIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">N</span> )</span><br>mute people<br>pick audio output',pos:[0,-1.5]},micIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">M</span> )</span><br>mute/pick<br>mic input',pos:[0,-1.5]},camIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">V</span> )</span><br>enable/pick<br>video input',pos:[0,-1.5]},helpIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">?</span> )</span><br>help &<br>instructions',pos:[0,-1.5]},infoIconParent:{text:'Info <span class="helpHotKeyParent">( <span class="helpHotKey">I</span> )</span>',pos:[-1,0],offset:[-10,0]},settingsIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">G</span> )</span><br>graphics &<br>navigation',pos:[0,-1.5]},muteAllIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">N</span> )</span><br>mute all users',pos:[1,0]},fullScreenIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">F</span> )</span><br>toggle full screen',pos:[-1,0]},videoQualityIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">H</span> )</span><br>video quality settings',pos:[-1,0]},statsIcon:{text:"jitsi connection status; toggle connection ",pos:[1,0]},usersIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">T</span> )</span> user moderator tools',pos:[1,0]},ft2Button:{text:"Environment",pos:[-1,0],offset:[-10,0]},ft3Button:{text:"Invite Friends",pos:[-1,0],offset:[-10,0]},hud_userCount:{text:"# of People",pos:[-1,0],offset:[-10,0]}},this.loading=!0,this.disclaimer=!1,this.mapPrompt=null,this.mapPromptBG=null,this.delayLoadChatWindow=!1,this.renderSettings=null,this.controlSettings=null,this.shaderEditorDisplay=null,this.radioControls=[],this.controlState=[!0,!1,!1,!1],this.controlToggle=[!0,!0,!1,!1],this.buttonPadding=6,this.toggleOpacity=[.6,1],this.qualityText=["Netbook","Laptop","Desktop Computer","Gamer Rig"],this.activeItem=null,this.jmaWindowVis=!1,this.actionPopUp=null,this.ctaLocalDocURL={},this.ctaContentLoading=!1,this.googleDocHTML=null,this.googleDocURL=""}setDependencies(pxlNav){this.pxlFile=pxlNav.pxlFile,this.pxlCookie=pxlNav.pxlCookie,this.pxlTimer=pxlNav.pxlTimer,this.pxlAudio=pxlNav.pxlAudio,this.pxlUtils=pxlNav.pxlUtils,this.pxlUser=pxlNav.pxlUser,this.pxlDevice=pxlNav.pxlDevice,this.pxlAutoCam=pxlNav.pxlAutoCam,this.pxlCamera=pxlNav.pxlCamera,this.pxlNavCanvas=pxlNav.pxlNavCanvas,this.pxlQuality=pxlNav.pxlQuality,this.pxlEnv=pxlNav.pxlEnv,this.mobile=pxlNav.mobile,this.renderSettings=this.pxlCookie.readCookie(this.pxlUser.renderSettingsCookie),this.controlSettings=this.pxlCookie.readCookie(this.pxlUser.controlModeCookie),pxlNav.pxlDevice.subscribe("resize",this.resize.bind(this))}init(){this.cssBuildClasses(),this.buildConsole()}prepLoader(){this.mapPromptBG=document.createElement("div"),this.mapPromptBG.classList.add("mapPromptBackgroundStyle"),document.body.appendChild(this.mapPromptBG),this.mapPrompt=document.createElement("div"),this.mapPrompt.setAttribute("id","mapPrompt"),this.mapPrompt.classList.add("mapPromptStyle"),this.mapPrompt.classList.add("fader"),this.mapPrompt.classList.add("visOn"),this.mapPrompt.innerHTML="\n            <div id=\"loaderLogoBranding\" class='pxlLoaderLogo'></div>\n            <div class='loadStyleParent'>\n              <div id='pxlLoader' class='loadStyle'></div>\n              <div id='pxlLoaderBackground' class='loadStyleBackground'></div>\n            </div>\n            <div id=\"loaderBranding\" class='pxlLoaderTitle'>".concat(this.projectTitle,"</div>\n            <div id=\"loaderMessage\" class='pxlLoaderMessage'></div>\n          "),document.body.appendChild(this.mapPrompt);var u=document.getElementById("loaderMessage");if(u){var d=this.loaderPhrases[Math.floor(Math.random()*this.loaderPhrases.length)];u.innerHTML=d}this.buildGuiStatus.loadingBranding&&pxlNav_SVGUtils.svgPromise(this.branding.loader,"loaderBranding","pxlLoaderTitle","loadBrandingLogo"),this.pxlLoader=document.getElementById("pxlLoader"),this.pxlLoader.style.width="2%";var v=document.createElement("div");v.classList.add("canvasCrashPromptBackgroundStyle"),document.body.appendChild(v);var x,y=document.createElement("div");y.classList.add("canvasCrashPromptStyle"),v.appendChild(y),this.pxlQuality&&(x=0==parseInt(this.pxlQuality.detailLimit)?'Looks like your computer is having a hard time, but weve got your fix.\n          <br>Please click <a id="crashLink" class="crashLink">HERE</a> to reload '.concat(this.projectTitle,".\n          <br>If youre still having issues, drop us a line in the chat."):'Looks like your computer is still having trouble, but weve got another fix for ya.\n          <br>Please click <a id="crashLink" class="crashLink">HERE</a> to reload '.concat(this.projectTitle," again.\n          <br>Again, if youre still having issues, drop us a line in the chat.")),y.innerHTML=x;var b=document.getElementById("crashLink"),_=this;b&&(b.onclick=u=>{_.crashLinkTrigger(u,_)})}stepLoader(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.pxlLoaderCount+=1;var d=Math.min(100,this.pxlLoaderCount/(this.pxlLoaderTotal-1)*100);100==d&&(this.pxlLoader.style.borderRadius="5px"),this.pxlLoader.style.width=d+"%",this.verbose>=Bs.INFO&&console.log("Loader",this.pxlLoaderCount,this.pxlLoader.style.width,"; "+u)}setLoaderPhrases(u){var d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];u&&u.length>0&&(d&&(this.loaderPhrases=[]),this.loaderPhrases=this.loaderPhrases.concat(u),this.setLoaderObjMessage())}setLoaderObjMessage(){var u=document.getElementById("loaderMessage");if(u){var d=Math.floor(17391.537193*Math.random()*this.loaderPhrases.length%this.loaderPhrases.length),v=this.loaderPhrases[d];u.innerHTML=v}}booted(){this.buildHudBlock(),this.buildTopBar(),this.buildBottomBar(),this.buildGuiWindowContainer(),this.buildUserControlBlock(),this.buildRawHtml(),this.prepPageDisplay()}step(){var u;this.updateGuiPositions(),null!==(u=this.pxlUser)&&void 0!==u&&u.checkItemWearOff(this.pxlTimer.prevMS)&&this.hideItemHud(),this.pxlNavDataUpdate()}resize(){this.sW=window.innerWidth,this.sH=window.innerHeight,this.resetHelpTextPlacement();["videoinput","audioinput","audiooutput"].forEach((u=>{var d=null,v=null;"videoinput"==u?(d="camChoiceOptionsBlock",v=this.hudIcons.camChoiceIcon):"audioinput"==u?(d="micChoiceOptionsBlock",v=this.hudIcons.micChoiceIcon):"audiooutput"==u&&(d="speakerChoiceOptionsBlock",v=this.hudIcons.speakerChoiceIcon);var x=document.getElementById(d);if(x&&v){var y=x.getBoundingClientRect().width,b=v.parent.getBoundingClientRect();x.style.left=b.x-.5*y,x.style.bottom=this.sH-this.hudBottomBar.getBoundingClientRect().y}})),this.setUserControlPosition(),this.inviteUserPosition(),this.setArtistInfoSizing()}resetHelpTextPlacement(){Object.keys(this.textDescriptions).forEach((u=>{var d=this.textDescriptions[u];if(d){var v=document.getElementById("helpText_"+u);if(!v)return;var x=document.getElementById(u);if(x){var y=d.pos,b=d.offset?d.offset:[0,0],_=x.getBoundingClientRect(),w=v.getBoundingClientRect(),S=0,C=0,P=!1;y[1]<0?(C=_.y+w.height*y[1],P=!0):0==y[1]?C=_.y+.5*_.height-.5*w.height:y[1]>0&&(C=_.y+_.height+w.height*(y[1]-1),P=!0),P?y[0]<0?S=_.x+_.width+w.width*y[0]:0==y[0]?S=_.x+.5*_.width-.5*w.width:y[0]>0&&(S=_.x+_.width*(y[0]-1)):y[0]<0?S=_.x+w.width*y[0]:0==y[0]?S=_.x+.5*_.width-.5*w.width:y[0]>0&&(S=_.x+2*_.width*y[0]),(S+=b[0])+w.width>this.sW-2?S=this.sW-2-w.width:S<2&&(S=2),C+=b[1],v.style.left=S,v.style.top=C}else v.style.display="none"}}))}crashLinkTrigger(u,d){var v=location.search.match(/[a-zA-Z0-9=]+/g),x="?";v.forEach((u=>{var d=u.split("=");"dlimit"==d[0]?x+=d[0]+"="+(parseInt(d[1])+1)+"&":x+=u+"&"})),location.search=x}guiToggleVisibility(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(u=null==u?!this.hudVisibility:u,this.hudVisibility=u,this.hudTopBar&&!this.hudTopBar.origDisplay&&(this.hudTopBar.origDisplay=this.hudTopBar.style.display),this.fastTravelBar&&!this.fastTravelBar.origDisplay&&(this.fastTravelBar.origDisplay=this.fastTravelBar.style.display),this.hudBottomBar&&!this.hudBottomBar.origDisplay&&(this.hudBottomBar.origDisplay=this.hudBottomBar.style.display),u){if(this.hudTopBar&&this.hudTopBar.removeAttribute("style"),this.fastTravelBar&&this.fastTravelBar.removeAttribute("style"),this.hudBottomBar&&this.hudBottomBar.removeAttribute("style"),this.userControlBlock){var d=this.userControlBlock.gui.style.top;this.userControlBlock.gui.removeAttribute("style"),this.userControlBlock.gui.style.top=d}}else this.hudTopBar&&(this.hudTopBar.style.display="none"),this.fastTravelBar&&(this.fastTravelBar.style.display="none"),this.hudBottomBar&&(this.hudBottomBar.style.display="none"),this.userControlBlock&&(this.userControlBlock.gui.style.display="none");this.hudElements.artistInfo&&(this.hudElements.artistInfo.parent.style.display=u?"grid":"none")}cssBuildClasses(){var u=document.createElement("style");u.type="text/css",u.innerHTML="\n\t\t\t.fader{\n\t\t\t\ttransition: opacity .8s, filter .8s;\n\t\t\t}\n\t\t\t.visOn{\n\t\t\t\tfilter:alpha(opacity=100);\n\t\t\t\topacity:1.0;\n\t\t\t}\n\t\t\t.visOff{\n\t\t\t\tfilter:alpha(opacity=0);\n\t\t\t\topacity:0.0;\n\t\t\t}\n\t\t",document.getElementsByTagName("head")[0].appendChild(u)}prepPromptFader(u){var d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],v=u;("string"!=typeof v||(v=document.getElementById(v)))&&(v.classList.add("fader"),v.classList.add(d?"visOn":"visOff"),v.style.display=d?"inline-block":"none")}promptFader(u,d){var v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if("string"!=typeof u||(u=document.getElementById(u)))if(u.classList.value.indexOf("fader")<0&&u.classList.add("fader"),d)u.style.display="inline-block",setTimeout((()=>{u.classList.contains("visOff")&&(u.classList.remove("visOff"),u.classList.add("visOn"),null!=v&&(u.setAttribute("fadeOut",clockTime+1e3*v),fadeOutList.push(u)))}),50);else if(u.classList.remove("visOn"),u.classList.add("visOff"),x){["webkitTransitionEnd","otransitionend","oTransitionEnd","msTransitionEnd","transitionend"].forEach((d=>{u.addEventListener(d,(()=>{var d=u.parentNode;d&&d.removeChild(u)}))}))}else setTimeout((()=>{u.classList.contains("visOff")&&(u.style.display="none")}),1e3)}buildConsole(){var u=document.createElement("div");u.id="consoleBlock",u.classList.add("consoleBlockStyle"),document.body.appendChild(u),this.guiWindows.consoleBlock={active:!1,gui:u}}buildMessageBlock(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Info",v=document.createElement("div");this.msgCount++,v.id="messageBlock-"+this.msgCount,v.classList.add("messageBlockStyle"),v.classList.add("message"+d);var x=this,y=document.createElement("div");y.classList.add("messageCloseBtn"),y.innerHTML="X",y.addEventListener("click",(function(){x.removeMessage(v)}));var b=document.createElement("div");b.classList.add("messageTopBarStyle");var _=document.createElement("div");_.classList.add("messageHeaderStyle"),_.innerHTML=d,b.appendChild(_),b.appendChild(y),v.appendChild(b);var w=document.createElement("div");return w.classList.add("messageContentStyle"),w.innerHTML=u,v.appendChild(w),v}print(u){this.guiWindows.consoleBlock||this.buildConsole(),this.guiWindows.consoleBlock.active||(this.guiWindows.consoleBlock.active=!0,this.promptFader(this.guiWindows.consoleBlock.gui,!0));var d=this.guiWindows.consoleBlock.gui,v=this.buildMessageBlock(u);d.appendChild(v)}buildHudBlock(){if(this.buildGuiStatus.hud){var u=document.createElement("div");u.id="hudBlock",u.classList.add("hudBlockStyle"),this.hudBlock.obj=u,document.body.appendChild(this.hudBlock.obj),this.hudBlock.obj.style.display="none";var d=this;this.hudBlock.obj.addEventListener("click",(u=>{d.toggleHudBlock(!1,!0)}))}}toggleHudBlock(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hudBlock){u=null==u?!this.hudBlock.active:u,this.hudBlock.active=u;var v=!1;u?v="inline-block":this.checkOpenWindows(d)||(v="none",this.pxlNavCanvas&&this.pxlNavCanvas.focus()),this.hudBlock.obj&&this.hudBlock.obj.style&&0!=v&&(this.hudBlock.obj.style.display=v)}}checkOpenWindows(){var u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=Object.keys(this.guiWindows),v=!1;return d.forEach((d=>{"chatBoxGui"!=d&&(u&&(this.guiWindows[d].button&&this.flipIcon(this.guiWindows[d].button,!1),this.guiWindows[d].gui&&this.guiWindows[d].active&&(this.guiWindows[d].active=!1,this.promptFader(this.guiWindows[d].gui,!1),"settingsGui"==d&&this.togglePxlNavDataDisplay(!1))),v=v||this.guiWindows[d].active)})),v}checkFocus(){!0===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)&&this.guiWindows.inviteUserGui&&this.guiWindows.inviteUserGui.active&&this.toggleInviteUser(!1)}buildRawHtml(){}buildTopBar(){if(!this.mobile&&this.buildGuiStatus.userTopBar){var u=document.createElement("div");u.id="hud_topBar",u.classList.add("hud_topBarBlockStyle"),this.hudTopBar=u,document.body.appendChild(this.hudTopBar);var d;d='\n\t\t\t<div id="hud_localVideoStyle" class="hud_localVideoStyle"></div>\n\t\t\t<div id="hud_topBarParent" class="hud_topBarParentStyle">\n\t\t<div id="statsIconParent">\n\t\t\t'.concat('<div id="statsIcon"></div></div>\n\t\t<div id="usersIconParent">\n\t\t\t<div id="usersIcon"></div>','\n\t\t</div>\n\t\t<div  class="hud_topBarVSpacerStyle"></div>\n\t\t\t</div>\n\t\t'),u.innerHTML=d,this.hudIcons.statsIcon=pxlNav_SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_stats.svg"),"statsIcon","stats"),this.hudIcons.statsIcon.promise.finally((()=>{})),this.hudIcons.usersIcon=pxlNav_SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_user.svg"),"usersIcon","users");var v=document.createElement("div");v.id="hud_pxlNavData",v.classList.add("hud_pxlNavDataParentStyle"),u.appendChild(v),this.pxlNavData.gui=v;var x=document.createElement("div");x.id="hud_pxlNavData",x.classList.add("hud_pxlNavDataStyle"),v.appendChild(x),d='\n      <div class="hud_pxlNavData_FPS gui_boldText">FPS</div><div class="hud_pxlNavData_FPS">:</div><div id="hud_pxlFPS" class="hud_pxlNavData_FPS"> - </div>\n      <div class="hud_pxlNavData_UL gui_boldText"></div><div class="hud_pxlNavData_UL">:</div><div id="hud_pxlUL" class="hud_pxlNavData_UL"> - </div>\n      <div class="hud_pxlNavData_DL gui_boldText"></div><div class="hud_pxlNavData_DL">:</div><div id="hud_pxlDL" class="hud_pxlNavData_DL"> - </div>\n    ',x.innerHTML=d,this.pxlNavData.fps=document.getElementById("hud_pxlFPS"),this.pxlNavData.ul=document.getElementById("hud_pxlUL"),this.pxlNavData.dl=document.getElementById("hud_pxlDL")}}buildUserControlBlock(){this.userControlBlock={},this.userControlBlock.activeList=[],this.userControlBlock.userList={},this.userControlBlock.mutedList=[];var u=document.createElement("div");u.classList.add("userControlBlockStyle"),document.body.appendChild(u),this.userControlBlock.gui=u,this.userControlBlock.speakerIcon=null}buildMedalionBar(){if(this.buildGuiStatus.medalion){var u=document.createElement("div");u.id="hud_medalionBar",u.classList.add("hud_medalionIconBlockStyle"),this.hudMedalionBar=u,document.body.appendChild(this.hudMedalionBar);var d='\n        <div id="medalionIconParent" class="hud_speakerIconStyle">\n          <div id="medalionIcon"></div>\n        </div>\n        <div id="medalionTitle" class="medalionTitleStyle">'.concat(this.branding.title,"</div>\n      ");this.hudMedalionBar.innerHTML=d;var v=document.getElementById("medalionIcon"),x=document.getElementById("medalionTitle");v.addEventListener("mouseover",(()=>{x.classList.add("medalionTitleGrowStyle")})),v.addEventListener("mouseout",(()=>{x.classList.remove("medalionTitleGrowStyle")})),this.hudIcons.medalionIcon=pxlNav_SVGUtils.svgIconPromise(this.branding.medalion,"medalionIcon","info",null,"medalionStyle")}}buildBottomBar(){if(this.buildGuiStatus.bottomBar){var u=document.createElement("div");u.id="hud_bottomBar",u.classList.add("hud_bottomBarStyle"),this.hudBottomBar=u,document.body.appendChild(this.hudBottomBar);var d="";if(d+='\n    <div id="hud_chatIconBlock" class="hud_bottomLeftBlockStyle">\n        <div id="settingsIconParent" class="hud_settingsIconStyle">\n          <object id="settingsIcon"></object>\n        </div>\n  <div></div>\n        <div id="helpIconParent" class="hud_helpIconStyle">\n          <object id="helpIcon"></object>\n        </div>\n        ',!this.mobile&&this.buildGuiStatus.verseList&&(d+='<div class="hud_usersIconStyle">\n            <div id="multiverseIcon"></div>\n          </div>\n          <div></div>'),d+="</div>",this.mobile||(d+='\n        <div class="hud_micCamIconsBlockStyle">\n          <div id="speakerIconParent" class="hud_speakerIconStyle">\n            <div id="speakerIcon"></div>\n          </div>\n          <div id="speakerChoiceIconParent" class="hud_speakerChoiceIconStyle">\n            <div id="speakerChoiceOptionsBlock" class="gui_iconButtonPopup">\n            </div>\n            <div id="speakerChoiceIconParent">\n              <div id="speakerChoiceIcon" class="iconCaretStyle"></div>\n            </div>\n          </div>\n          <div class="hud_micCamSpacerStyle"></div>\n          <div id="micIconParent" class="hud_micIconStyle">\n            <div id="micIcon"></div>\n          </div>\n          <div id="micChoiceIconParent" class="hud_micChoiceIconStyle">\n            <div id="micChoiceOptionsBlock" class="gui_iconButtonPopup">\n            </div>\n            <div id="camChoiceIconParent">\n              <div id="micChoiceIcon" class="iconCaretStyle"></div>\n            </div>\n          </div>\n          <div class="hud_micCamSpacerStyle"></div>\n          <div id="camIconParent" class="hud_camIconStyle">\n            <div id="camIcon"></div>\n          </div>\n          <div id="camChoiceIconBlock" class="hud_camChoiceIconStyle">\n            <div id="camChoiceOptionsBlock" class="gui_iconButtonPopup">\n            </div>\n            <div id="camChoiceIconParent">\n              <div id="camChoiceIcon" class="iconCaretStyle"></div>\n            </div>\n          </div>\n        </div>\n        \n        <div id="hud_helpInfoSettingsBlock" class="hud_helpInfoSettingsBlockStyle">\n          <div class="guiVerseHudTitle">\n            <span id="guiVerseTitle"></span>\n          </div>\n          <div></div>\n          <div id="chatIconParent" class="hud_chatIconStyle">\n            <div id="chatIcon"></div>\n          </div>\n          <div id="hud_messageCount" class="hud_userCountStyle hud_messageCountBaseStyle">0</div>\n        </div>\n      '),this.hudBottomBar.innerHTML=d,this.messageCountObj=document.getElementById("hud_messageCount"),this.hudIcons.chatIcon=pxlNav_SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_chat.svg"),"chatIcon","chat"),this.mobile||this.pxlAutoCam.enabled){var v=document.getElementById("hud_chatIconBlock");v.style.gridAutoColumns="max-content max-content auto max-content",v.style.margin="0px 10px"}else{this.hudIcons.multiverseIcon=pxlNav_SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_multiverse.svg"),"multiverseIcon","multiverse"),this.hudIcons.speakerIcon=pxlNav_SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_ProxAudio.svg"),"speakerIcon","speakerToggle",!1),this.hudIcons.speakerChoiceIcon=pxlNav_SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_downcaret.svg"),"speakerChoiceIcon","speakerChoice",!1,"iconCaretStyle"),this.hudIcons.micIcon=pxlNav_SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_mic.svg"),"micIcon","micToggle",!1),this.hudIcons.micChoiceIcon=pxlNav_SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_downcaret.svg"),"micChoiceIcon","micChoice",!1,"iconCaretStyle"),this.hudIcons.camIcon=pxlNav_SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_camera.svg"),"camIcon","camToggle",!1),this.hudIcons.camChoiceIcon=pxlNav_SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_downcaret.svg"),"camChoiceIcon","camChoice",!1,"iconCaretStyle"),this.hudIcons.helpIcon=pxlNav_SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_help.svg"),"helpIcon","help"),this.hudIcons.settingsIcon=pxlNav_SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_settings.svg"),"settingsIcon","settings");document.getElementById("guiVerseTitle")}}}prepArtistInfo(){var u,d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null!==(u=this.pxlEnv)&&void 0!==u&&u.postIntro&&""!=d){if(!this.hudElements.artistInfo){this.hudElements.artistInfo={},this.hudElements.artistInfo.active=!1;var v=document.createElement("div");v.classList.add("hud_aristInfoParentStyle"),this.hudElements.artistInfo.parent=v;var x=document.createElement("div");x.classList.add("hud_aristInfoButtonStyle"),v.appendChild(x);var y=this;x.onclick=()=>{y.toggleArtistInfo()},this.hudElements.artistInfo.button=x;var b=document.createElement("div");b.classList.add("hud_aristInfoButtonTextStyle"),b.innerHTML="artwork info&nbsp;&nbsp;",x.appendChild(b),this.hudElements.artistInfo.buttonText=b;var _=document.createElement("div");_.classList.add("hud_aristInfoCarrotXStyle"),_.id="artistInfoCarrotX",x.appendChild(_);var w=document.createElement("div");w.classList.add("hud_aristInfoInner"),w.innerHTML=d,v.appendChild(w),this.hudElements.artistInfo.inner=w,document.body.appendChild(v),this.hudElements.artistInfo.closeSvg=pxlNav_SVGUtils.svgPromise("".concat(this.guiRoot,"global/carrotCloseAnimate.svg"),"artistInfoCarrotX"),this.hudElements.artistInfo.closeSvg.promise.finally((()=>{this.artistInfoButtonPrep()}))}this.toggleArtistInfo(!1),null!=d&&this.hudVisibility&&!this.pxlAutoCam.active?(this.hudElements.artistInfo.parent.style.zIndex=155,this.hudElements.artistInfo.parent.style.display="grid",this.hudElements.artistInfo.inner.innerHTML=d,setTimeout((()=>{this.setArtistInfoSizing()}),20)):(this.hudElements.artistInfo.parent.style.zIndex=-5,this.hudElements.artistInfo.parent.style.display="none")}}artistInfoButtonPrep(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=this.hudElements.artistInfo.closeSvg.svg;if(d){var v=d.getElementById("carrotToClone_on"),x=d.getElementById("carrotToClone_off");v&&x?(this.hudElements.artistInfo.onAnim=v,this.hudElements.artistInfo.offAnim=x):2==u||setTimeout((()=>{this.artistInfoButtonPrep(u+=1)}),100)}}setArtistInfoSizing(){if(this.hudElements.artistInfo){var u=this.hudElements.artistInfo.inner.clientHeight,d=this.hudElements.artistInfo.inner.clientWidth,v=this.hudElements.artistInfo.button.clientHeight,x=this.hudElements.artistInfo.button.clientWidth;this.hudElements.artistInfo.innerHeight=u,this.hudElements.artistInfo.innerWidth=d,this.hudElements.artistInfo.baseHeight=v,this.hudElements.artistInfo.baseWidth=x,this.hudElements.artistInfo.parent.style.height=u+"px",this.hudElements.artistInfo.parent.style.width=d+"px";var y=this.hudElements.artistInfo.buttonText.clientWidth;this.hudElements.artistInfo.buttonText.maxWidth=y,this.hudElements.artistInfo.buttonText.style.maxWidth=y+"px",this.toggleArtistInfo(this.hudElements.artistInfo.active)}}toggleArtistInfo(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;u=null==u?!this.hudElements.artistInfo.active:u,this.hudElements.artistInfo.active=u;var d=this.hudElements.artistInfo.innerHeight,v=Math.min(.3*this.pxlDevice.sW,this.hudElements.artistInfo.innerWidth),x=this.hudElements.artistInfo.baseHeight,y=this.hudElements.artistInfo.baseWidth;this.hudElements.artistInfo.parent.style.maxHeight=u?d+"px":x+"px",this.hudElements.artistInfo.parent.style.maxWidth=u?v+"px":y+"px",this.hudElements.artistInfo.parent.style.padding=u?"5px":"0px";var b=this.hudElements.artistInfo.buttonText.maxWidth;this.hudElements.artistInfo.buttonText.style.maxWidth=u?"0px":b+"px",this.hudElements.artistInfo.buttonText.style.opacity=u?"0":"1",this.hudElements.artistInfo.buttonText.style.filter="alpha(opacity="+(u?"0":"1000")+")",this.hudElements.artistInfo.inner.style.opacity=u?"1":"0",this.hudElements.artistInfo.inner.style.filter="alpha(opacity="+(u?"100":"0")+")",this.hudElements.artistInfo.onAnim&&(u?this.hudElements.artistInfo.onAnim.beginElement():this.hudElements.artistInfo.offAnim.beginElement())}prepPageDisplay(){var u,d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null!==(u=this.pxlEnv)&&void 0!==u&&u.postIntro&&""!=d){if(!this.hudElements.artistInfo){this.hudElements.artistInfo={},this.hudElements.artistInfo.active=!1;var v=document.createElement("div");v.classList.add("hud_aristInfoParentStyle"),this.hudElements.artistInfo.parent=v;var x=document.createElement("div");x.classList.add("hud_aristInfoButtonStyle"),v.appendChild(x);var y=this;x.onclick=()=>{y.togglePageDisplay()},this.hudElements.artistInfo.button=x;var b=document.createElement("div");b.classList.add("hud_aristInfoButtonTextStyle"),b.innerHTML="artwork info&nbsp;&nbsp;",x.appendChild(b),this.hudElements.artistInfo.buttonText=b;var _=document.createElement("div");_.classList.add("hud_aristInfoCarrotXStyle"),_.id="artistInfoCarrotX",x.appendChild(_);var w=document.createElement("div");w.classList.add("hud_aristInfoInner"),w.innerHTML=d,v.appendChild(w),this.hudElements.artistInfo.inner=w,document.body.appendChild(v)}this.togglePageDisplay(!1),null!=d&&this.hudVisibility&&!this.pxlAutoCam.active?(this.hudElements.artistInfo.parent.style.zIndex=155,this.hudElements.artistInfo.parent.style.display="grid",this.hudElements.artistInfo.inner.innerHTML=d,setTimeout((()=>{this.setArtistInfoSizing()}),20)):(this.hudElements.artistInfo.parent.style.zIndex=-5,this.hudElements.artistInfo.parent.style.display="none")}}setPageToDisplay(){if(this.hudElements.artistInfo){var u=this.hudElements.artistInfo.inner.clientHeight,d=this.hudElements.artistInfo.inner.clientWidth,v=this.hudElements.artistInfo.button.clientHeight,x=this.hudElements.artistInfo.button.clientWidth;this.hudElements.artistInfo.innerHeight=u,this.hudElements.artistInfo.innerWidth=d,this.hudElements.artistInfo.baseHeight=v,this.hudElements.artistInfo.baseWidth=x,this.hudElements.artistInfo.parent.style.height=u+"px",this.hudElements.artistInfo.parent.style.width=d+"px";var y=this.hudElements.artistInfo.buttonText.clientWidth;this.hudElements.artistInfo.buttonText.maxWidth=y,this.hudElements.artistInfo.buttonText.style.maxWidth=y+"px",this.toggleArtistInfo(this.hudElements.artistInfo.active)}}togglePageDisplay(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.hudElements.artistInfo){var d;u=null==u?!this.hudElements.artistInfo.active:u,null!==(d=this.hudElements)&&void 0!==d&&d.artistInfo&&(this.hudElements.artistInfo.active=u);var v=this.hudElements.artistInfo.innerHeight,x=Math.min(.3*this.pxlDevice.sW,this.hudElements.artistInfo.innerWidth),y=this.hudElements.artistInfo.baseHeight,b=this.hudElements.artistInfo.baseWidth;this.hudElements.artistInfo.parent.style.maxHeight=u?v+"px":y+"px",this.hudElements.artistInfo.parent.style.maxWidth=u?x+"px":b+"px",this.hudElements.artistInfo.parent.style.padding=u?"5px":"0px";var _=this.hudElements.artistInfo.buttonText.maxWidth;this.hudElements.artistInfo.buttonText.style.maxWidth=u?"0px":_+"px",this.hudElements.artistInfo.buttonText.style.opacity=u?"0":"1",this.hudElements.artistInfo.buttonText.style.filter="alpha(opacity="+(u?"0":"1000")+")",this.hudElements.artistInfo.inner.style.opacity=u?"1":"0",this.hudElements.artistInfo.inner.style.filter="alpha(opacity="+(u?"100":"0")+")",this.hudElements.artistInfo.onAnim&&(u?this.hudElements.artistInfo.onAnim.beginElement():this.hudElements.artistInfo.offAnim.beginElement())}}iconEvent(u,d){var v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this.hudBlock.obj&&(this.hudBlock.obj.style.display="none"),"click"==u){if("chat"==v)return void this.toggleChatBox();if("musicToggle"==v)return this.pxlAudio.djPlayerMuteToggle(),void this.toggleIcon(d,!this.pxlAudio.djMuted,!0);if("userSpeakerToggle"==v)return void this.setUserControls(d);if("speakerToggle"==v)return void this.toggleIcon(d,!1,!0);if("speakerChoice"==v){var x="audiooutput";return void this.flipIcon(d,this.guiWindows[x]&&this.guiWindows[x].active)}if("help"==v){var y=!!this.guiWindows.helpGui&&this.guiWindows.helpGui.active;return this.checkOpenWindows(!0),void this.helpGuiToggle(!y)}if("info"==v){var b=!!this.guiWindows.infoGui&&this.guiWindows.infoGui.active;return this.checkOpenWindows(!0),void this.infoGuiToggle(!b)}if("settings"==v){var _=!!this.guiWindows.settingsGui&&this.guiWindows.settingsGui.active;return this.checkOpenWindows(!0),void this.settingsGuiToggle(!_)}if("userProfile"==v)return void this.toggleUserProfile();if("users"==v);else if("stats"==v)return}}setMicVolumeLevel(u){this.hudIcons.micIcon.volumeMask||(this.hudIcons.micIcon.volumeMask=document.getElementById("gui_micVolumeMask"),this.hudIcons.micIcon.timer=this.pxlTimer.msRunner.x-1);var d=12-11*u;this.hudIcons.micIcon.volumeMask.setAttribute("y",d)}toggleIcon(u,d){var v=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(u){if(u.mute.style.filter=d?"alpha(opacity=0)":"alpha(opacity=100)",u.mute.style.opacity=d?"0":"1",u.mute.style.transform=d?"scale(0,0)":"scale(1,1)",["camToggle","speakerToggle"].includes(u.eventType))return;var x={speakerToggle:"speaker",micToggle:"audio",camToggle:"video"}[u.eventType];x&&v&&this.loadingDeviceChange(x,d)}}flipIcon(u,d){u.caret.style.transform="rotate( ".concat(d?"180deg":"0deg"," )")}loadingDeviceChange(u){var d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],v=null;"speaker"==u?v=this.hudIcons.speakerIcon:"audio"==u?v=this.hudIcons.micIcon:"video"==u&&(v=this.hudIcons.camIcon),v.indicator.style.display=d?"inline-block":"none",v.indicator.style.animationPlayState=d?"running":"paused",v.waiting.forEach((u=>{u.setAttribute("fill-opacity",d?".5":"1")})),d&&setTimeout((()=>{this.loadingDeviceChange(u,!1)}),1e3)}djBuildPlayer(){if(this.buildGuiStatus.djPlayer){this.djPlayerObj=document.createElement("div"),this.djPlayerObj.id="djPlayer";var u='\n          <audio id="djStream" playsinline muted>\n            <source src="'+this.pxlAudio.djUrlSource+'"></source>\n          </audio>\n          <table cellpadding=0 cellspacing=5 border=0 style="height:100%;"><tbody><tr>\n              <td align="left">\n                  <div id="djPlayerVol"></div>\n              <  d><td valign="center" align="left" width=100%>\n                  <div id="djPlayerVolumeParent" class="volParent"><div id="djPlayerVolume" class="volSlider"></div></div>\n              <  d><  r>\n          <  body><  able>';this.djPlayerObj.innerHTML=u,document.getElementById("musicControllerBlock").appendChild(this.djPlayerObj),this.hudIcons.musicIcon=pxlNav_SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_music.svg"),"djPlayerVol","musicToggle",!this.pxlAudio.djMuted),this.pxlAudio.djBuildPlayer()}}buildItemHud(u,d){this.activeItem.innerHTML=d,this.activeItem.style.opacity="1",this.activeItem.style.filter="alpha(opacity=100)",this.activeItem.style.textShadow="1px 1px 3px #000000",setTimeout((()=>{this.activeItem.style.fontSize="1.5em",this.activeItem.style.top=".5%",this.activeItem.style.right="140px",this.activeItem.style.transform="translateX(0%)"}),1500)}hideItemHud(){this.activeItem.innerHTML="",this.activeItem.style.fontSize="3em",this.activeItem.style.top="10%",this.activeItem.style.right="50%",this.activeItem.style.transform="translateX(50%)",this.activeItem.style.opacity="0",this.activeItem.style.filter="alpha(opacity=0)"}mapPrepPrompts(){this.activeItem=document.createElement("div"),this.activeItem.classList.add("activeItemStyle"),document.body.appendChild(this.activeItem)}updateGuiPositions(){if(this.loading){for(var u=this.radioControls.length,d=!1,v=0;v<u;++v){if(!this.radioControls[v][3]){d=!0;break}var x=this.radioControls[v][0],y=this.radioControls[v][2].getBoundingClientRect(),b=y.width+2*this.buttonPadding,_=y.height+2*this.buttonPadding,w=y.top-this.buttonPadding,S=y.left-this.buttonPadding;x.style.width=b,x.style.height=_,x.style.top=w,x.style.left=S,this.radioControls[v][1].style.width=b,this.radioControls[v][1].style.height=_,this.radioControls[v][1].style.top=w,this.radioControls[v][1].style.left=S}this.loading=d}}togglGuiWindow(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];"helpGui"==u?this.helpGuiToggle(d,!1):"infoGui"==u?this.infoGuiToggle(d,!1):"settingsGui"==u&&this.settingsGuiToggle(d,!1)}svgCheckClick(){var u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;u&&("close"!=u?"ft1"!=u&&"ft2"!=u&&("ft3"!=u?"ft4"!=u&&("ft5"!=u||this.pxlAutoCam.toggleAutoCam()):this.toggleInviteUser()):this.toggleGuiWindowContainer(null,!1,!0))}svgStylize(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(u){var v=u.path?u.path[1]:u.target.parentNode,x=v.getElementById("state");if(x){var y=d?"white":"none";x.setAttribute("fill",y)}var b=v.getElementById("hover");b&&b.setAttribute("fill",color)}}renderQualitySettings(u){this.pxlQuality.percent=u,this.pxlQuality.screenResPerc=.75*u+.25,this.pxlQuality.mapAutoQualityUpdate(u,!0),this.pxlDevice.resizeRenderResolution()}pxlNavDataUpdate(){this.pxlNavData.active&&this.pxlTimer.msRunner.x>this.pxlNavData.fpsSet&&(this.pxlNavData.fpsSet=this.pxlTimer.msRunner.x+1,this.pxlNavData.fps.innerText=parseInt(1/this.pxlTimer.msRunner.y))}buildGuiWindowContainer(){var u=document.createElement("div");u.classList.id="guiWindowBackground",u.classList.add("guiWindowBackground"),u.classList.add("fader"),u.classList.add("visOff"),u.style.display="none";var d=this;u.onclick=u=>{d.toggleGuiWindowContainer(u,!1,!0)},this.guiWindowBG=u,document.body.appendChild(u)}toggleGuiWindowContainer(u,d){var v=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(u){var x=(u.path?u.path[0]:u.target).getAttribute("id");if("guiWindowBackground"!=x){if(!["gui_helpGuiWindow","gui_helpContent","gui_infoGuiWindow","gui_infoContent","gui_settingsGuiWindow","gui_settingsContent"].includes(x))return null}}var y=this.checkOpenWindows(v);this.guiWindowBG&&y==d&&this.promptFader(this.guiWindowBG,d,null,!1),d?this.pxlNavCanvas.blur():this.pxlNavCanvas.focus()}helpGuiBuild(){this.guiWindows.helpGui={},this.guiWindows.helpGui.gui=null,this.guiWindows.helpGui.active=!1;var u=document.createElement("div");u.id="gui_helpGuiWindow",u.classList.add("gui_helpGuiParentStyle"),this.prepPromptFader(u),this.guiWindowBG.appendChild(u);u.innerHTML='\n    <div id="gui_helpContent" class="gui_contentStyle">\n  <div class="gui_body">\n    <div id="gui_helpGui_keyboardParent" class="gui_helpGui_keyboardParent">\n    <div id="gui_helpGui_controlsKeyboard" class="guiPadding settings_sectionHeader">keyboard controls</div>\n    <div class="gui_helpGui_ASDWorUDLR">\n      <div id="gui_helpGui_asdw" class="gui_helpGui_asdw"></div>\n      <div id="gui_helpGui_or" class="gui_helpGui_text">or</div>\n      <div id="gui_helpGui_udlr" class="gui_helpGui_udlr"></div>\n    </div>\n    <div id="gui_helpGui_useKeys" class="gui_helpGui_text" style="display:inline-block;">Use your keyboard <span class="gui_boldText">ARROWS</span> or<br><span class="gui_boldText">AWSD</span> keys to move around</div>\n    </div>\n    <div id="gui_helpGui_mouse" class="gui_helpGui_mouse">\n    <div id="gui_helpGui_MouseControls" class="guiPadding settings_sectionHeader">mouse controls</div>\n    <div id="gui_helpGui_MouseOutlined" class="gui_helpGui_mouseOutline"></div>\n    <div id="gui_helpGui_useMouse" class="guiPadding gui_helpGui_text" style="display:inline-block;">To orient your view:<br><span class="gui_boldText">LEFT CLICK</span> and drag your mouse<br><span class="gui_boldText">RIGHT CLICK</span> to lock your mouse</div>\n    </div>\n  </div>\n  <div id="gui_helpGui_hotKeys" class="gui_helpGui_hotKeys">\n          You can change <span class="gui_boldText">Navigation</span> and <span class="gui_boldText">Look controls</span> in the <span class="gui_boldText">Settings</span> <span id="gui_helpGui_settingIcon"></span> menu\n        </div>\n  <div id="guiHelpFooter" class="gui_footer">\n    <div class="guiButton" id="guiHelpBackButton">close</div>\n  </div>\n  <div class="gui_spacer"></div>\n    </div>\n  ',[[this.guiRoot+"keyboard/asdw.svg","gui_helpGui_asdw","guiKeyDispSVG",!1],[this.guiRoot+"keyboard/udlr.svg","gui_helpGui_udlr","guiKeyDispSVG",!1],[this.guiRoot+"mouse/MouseOutlined.svg","gui_helpGui_MouseOutlined","guiMouseDispSVG",!1]].forEach((u=>{pxlNav_SVGUtils.svgButtonPromise(...u)}));var d=this;document.getElementById("guiHelpBackButton").onclick=u=>{d.introHelpActive&&(d.introHelpActive=!1,d.pxlEnv.postHelpIntro()),d.svgCheckClick(u,"close")},Object.keys(this.textDescriptions).forEach((d=>{var v=this.textDescriptions[d];if(v){var x=v.text,y=(v.pos,document.createElement("div"));y.id="helpText_"+d,y.classList.add("helpTextDescriptionParent"),y.innerHTML=x,u.appendChild(y),this.textDescriptions[d].obj=y}}));var v=document.getElementById("gui_helpGui_settingIcon");v&&this.hudIcons.settingsIcon&&(v.innerHTML=this.hudIcons.settingsIcon.svg.parentNode.innerHTML,v.style.position="relative",v.style.top="7.3px",v.style.width="30px",v.style.padding="2px",v.style.cursor="pointer",v.children[0].style.height="26px",v.onclick=()=>{d.iconEvent("click",null,"settings")}),this.guiWindows.helpGui.gui=u,setTimeout((()=>{this.resize()}),50)}helpGuiToggle(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.guiWindows.helpGui||this.helpGuiBuild(),u=null==u?!this.guiWindows.helpGui.active:u,this.guiWindows.helpGui.active=u,this.promptFader(this.guiWindows.helpGui.gui,u),this.toggleGuiWindowContainer(null,u),this.hudBlock.active&&this.toggleHudBlock(u),this.introHelpActive&&!u&&(this.introHelpActive=!1,this.pxlEnv.postHelpIntro()),setTimeout((()=>{this.resetHelpTextPlacement()}),20)}infoGuiBuild(){this.guiWindows.infoGui={},this.guiWindows.infoGui.gui=null,this.guiWindows.infoGui.active=!1;var u=document.createElement("div");u.id="gui_infoGuiWindow",u.classList.add("gui_infoGuiParentStyle"),this.prepPromptFader(u),this.guiWindowBG.appendChild(u);var d="";d+='\n    <div id="gui_infoContent" class="gui_contentInfoStyle">\n  <div class="gui_infoBody">\n    <div id="gui_infoGuiParent" class="gui_infoGuiParent">\n    <br>'.concat(this.projectTitle,', created by <a href="https://www.theumbrella.nyc/">The Umbrella</a>,\n    <br>an experience design collective.\n    <br>\n    <br>Want to chat?\n    <br><a href="mailto:info@theumbrella.nyc">info@theumbrella.nyc</a>\n    <br>\n    <br>Were in active development. Get in touch if you have any issues.\n    <br>\n    </div>\n  </div>\n  <div id="guiInfoFooter" class="gui_footer">\n    <div class="guiButton" id="guiInfoBackButton">close</div>\n  </div>\n    </div>\n  '),u.innerHTML=d;var v=this;document.getElementById("guiInfoBackButton").onclick=u=>{v.svgCheckClick(u,"close")},this.guiWindows.infoGui.gui=u}infoGuiToggle(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.guiWindows.infoGui||this.infoGuiBuild(),u=null==u?!this.guiWindows.infoGui.active:u,this.guiWindows.infoGui.active=u,this.promptFader(this.guiWindows.infoGui.gui,u),this.toggleGuiWindowContainer(null,u),this.hudBlock.active&&this.toggleHudBlock(u),this.introHelpActive&&!u&&(this.introHelpActive=!1,this.pxlEnv.postHelpIntro())}applyCookies(){this.controlSettings&&(console.log(this.controlSettings),this.controlSettings=this.controlSettings),this.renderSettings&&(console.log(this.renderSettings),this.renderSettings=this.renderSettings)}settingsGuiBuild(){var u=this;this.guiWindows.settingsGui={},this.guiWindows.settingsGui.gui=null,this.guiWindows.settingsGui.active=!1;var d=document.createElement("div");d.id="gui_settingsGuiWindow",d.classList.add("gui_settingsGuiParentStyle"),this.prepPromptFader(d),this.guiWindowBG.appendChild(d);var v="Default",x='\n    <div id="gui_settingsContent" class="gui_contentSettingsStyle">\n  <div class="gui_settingsBody">\n    <div class="gui_settingsParentGrid">\n      \x3c!-- -- Username -- -- --\x3e\n    <div class="cellMargin settings_icon" id="settings_user"></div>\n    <div class="settings_optionHeader">Username</div>\n    <div class="settings_radio" style="grid-auto-flow: row; justify-content: start;">\n                    <div id="guiuserProfileBoxFieldParent" class="gui_userProfileBoxFieldParentStyle">\n                      <input type="text" placeholder="Set your username" value="'.concat(v=v||"",'" id="settings_usernameInput" class="settings_usernameInput"></input>\n                      <input type="button" value="Set" id="settings_sendUsername" class="sendUsername">\n                    </div>\n                    <div id="settings_usernameResponseMessage" class="usernameResponseMessageStyle"></div>\n                </div>\n      \x3c!-- -- -- -- -- -- --\x3e\n    <div class="settingsGridSpan settingsSpacer"></div>\n      \x3c!-- -- Left/Right -- -- --\x3e\n    <div class="cellMargin settings_icon" id="settings_left_right"></div>\n    <div class="settings_optionHeader">Left/Right</div>\n    <div class="settings_radio" id="settingsRadioBlock_leftRight">\n      <span>\n      <input type="radio" id="settings_tankTurning" name="settings_leftRight" value="0" hidden>\n      <label for="settings_tankTurning">Turn</label>\n      </span>\n      <span>\n      <input type="radio" id="settings_strafing" name="settings_leftRight" value="1" hidden>\n      <label for="settings_strafing">Strafe</label>\n      </span>\n    </div>\n      \x3c!-- -- Mouse -- -- --\x3e\n    <div class="cellMargin settings_icon" id="settings_mouse"></div>\n    <div class="settings_optionHeader">Mouse Looking</div>\n    <div class="settings_radio" id="settingsRadioBlock_mouse">\n      <span>\n      <input type="radio" id="settings_dragLooking" name="settings_mouse" value="0" hidden>\n      <label for="settings_dragLooking">Native</label>\n      </span>\n      <span>\n      <input type="radio" id="settings_pointLooking" name="settings_mouse" value="1" hidden>\n      <label for="settings_pointLooking">Inverted</label>\n      </span>\n    </div>\n      \x3c!-- -- -- -- -- -- --\x3e\n    <div class="settingsGridSpan settingsSpacer"></div>\n      \x3c!-- -- Graphics Quality -- -- --\x3e\n    <div class="cellMargin settings_icon" id="settings_graphics"></div>\n    <div class="settings_optionHeader">Graphics Quality</div>\n    <div class="settings_radio" id="settingsRadioBlock_graphics">\n      <span>\n      <input type="radio" id="settings_graphicsQuality_low" name="settings_autoQuality" value="0" hidden>\n      <label for="settings_graphicsQuality_low">Low</label>\n      </span>\n      <span>\n      <input type="radio" id="settings_graphicsQuality_med" name="settings_autoQuality" value="1" hidden>\n      <label for="settings_graphicsQuality_med">Medium</label>\n      </span>\n      <span>\n      <input type="radio" id="settings_graphicsQuality_high" name="settings_autoQuality" value="2" hidden>\n      <label for="settings_graphicsQuality_high">High</label>\n      </span>\n      <span>\n      <input type="radio" id="settings_graphicsQuality_custom" name="settings_autoQuality" value="3" hidden>\n      <label for="settings_graphicsQuality_custom">Custom</label>\n      </span>\n    </div>\n      \x3c!-- -- -- -- --\x3e\n      <div class="r7Adv gui_settingsAdvancedParentGrid" id="gui_advancedSettings">\n    \x3c!-- -- -- -- --\x3e\n      <div class="cellMargin settings_icon" id="settings_render"></div>\n      <div class="settings_optionHeader">Render Resolution</div>\n      <div class="settings_radio" id="settingsRadioBlock_resolution">\n      <span>\n        <input type="radio" id="settings_render_25" name="settings_renderPerc" value=".25" hidden>\n        <label for="settings_render_25">25%</label>\n      </span>\n      <span>\n        <input type="radio" id="settings_render_50" name="settings_renderPerc" value=".5" hidden>\n        <label for="settings_render_50">50%</label>\n      </span>\n      <span>\n        <input type="radio" id="settings_render_75" name="settings_renderPerc" value=".75" hidden>\n        <label for="settings_render_75">75%</label>\n      </span>\n      <span>\n        <input type="radio" id="settings_render_100" name="settings_renderPerc" value="1" hidden>\n        <label for="settings_render_100">100%</label>\n      </span>\n      </div>\n    \x3c!-- -- -- -- --\x3e\n      <div class="cellMargin settings_icon" id="settings_fog"></div>\n      <div class="settings_optionHeader">Fog Quality</div>\n      <div class="settings_radio" id="settingsRadioBlock_fog">\n      <span>\n        <input type="radio" id="settings_noRedFog" name="settings_fogLevel" value="0" hidden>\n        <label for="settings_noRedFog">Low</label>\n      </span>\n      <span>\n        <input type="radio" id="settings_cheapResFog" name="settings_fogLevel" value="1" hidden>\n        <label for="settings_cheapResFog">Medium</label>\n      </span>\n      <span>\n        <input type="radio" id="settings_highResFog" name="settings_fogLevel" value="2" hidden>\n        <label for="settings_highResFog">High</label>\n      </span>\n      </div>\n    \x3c!-- -- -- -- --\x3e\n      <div class="cellMargin settings_icon" id="settings_bloom"></div>\n      <div class="settings_optionHeader">Bloom Effects</div>\n      <div class="settings_radio" id="settingsRadioBlock_bloom">\n      <span>\n        <input type="radio" id="settings_noBloom" name="settings_bloomEffects" value="0" hidden>\n        <label for="settings_noBloom">Off</label>\n      </span>\n      <span>\n        <input type="radio" id="settings_bloomActive" name="settings_bloomEffects" value="1" hidden>\n        <label for="settings_bloomActive">On</label>\n      </span>\n      </div>\n    \x3c!-- -- -- -- --\x3e\n      </div>\n    </div>\n      <div class="settingsGridSpan settingsEmptySpacer"></div>\n    </div>\n    <div class="guiSettingsFooterButtons">\n    <div class="guiButton" id="guiSettingsBackButton">close</div>\n    </div>\n  </div>\n    </div>\n  ');d.innerHTML=x,this.guiWindows.settingsGui.gui=d;var y=this;this.qualitySlider=document.getElementById("SettingsGraphicsQualitySlider"),document.getElementById("guiSettingsBackButton").onclick=u=>{y.svgCheckClick(u,"close")},[[this.guiRoot+"settingsIcons/settings_user.svg","settings_user",["settings_icon_scale"],!1],[this.guiRoot+"settingsIcons/settings_left_right.svg","settings_left_right",["settings_icon"],!1],[this.guiRoot+"settingsIcons/settings_mouse.svg","settings_mouse",["settings_icon"],!1],[this.guiRoot+"settingsIcons/settings_graphics.svg","settings_graphics",["settings_icon"],!1],[this.guiRoot+"settingsIcons/settings_render.svg","settings_render",["settings_icon"],!1],[this.guiRoot+"settingsIcons/settings_fog.svg","settings_fog",["settings_icon"],!1],[this.guiRoot+"settingsIcons/settings_bloom.svg","settings_bloom",["settingsIconStyle"],!1]].forEach((u=>{pxlNav_SVGUtils.svgButtonPromise(...u)}));var b=document.getElementById("settings_usernameInput");b.onkeyup=u=>{y.keyUsernameSet(u)},b.onkeydown=u=>{y.keyDownUsernameSet(u)},this.guiWindows.settingsGui.usernameInput=b,document.getElementById("settings_sendUsername").addEventListener("click",(()=>{y.sendUsernameUpdate(b)}));var _,w,S=document.getElementById("settings_usernameResponseMessage");this.guiWindows.settingsGui.usernameReturn=S,this.guiWindows.settingsGui.advObj=document.getElementById("gui_advancedSettings"),this.guiWindows.settingsGui.customObj=document.getElementById("settings_graphicsQuality_custom"),w=(_=["settings_graphicsQuality_low","settings_graphicsQuality_med","settings_graphicsQuality_high","settings_graphicsQuality_custom"]).length;for(var C=function _loop(){var d=_[P],v=document.getElementById(d);u.setRadioStyle(v,P,w);var x=parseInt(v.value);v.addEventListener("change",(u=>{y.pxlQuality.setQualityLevel(x),y.setRadioValues()}))},P=0;P<w;++P)C();w=(_=["settings_render_25","settings_render_50","settings_render_75","settings_render_100"]).length;for(var A=function _loop2(){var d=_[T],v=document.getElementById(d);u.setRadioStyle(v,T,w);var x=parseFloat(v.value);v.addEventListener("change",(u=>{y.guiWindows.settingsGui.customObj.checked=!0,y.pxlQuality.setGraphicsSettings({resolution:x}),y.pxlQuality.setQualityCookie(3)}))},T=0;T<w;++T)A();w=(_=["settings_noRedFog","settings_cheapResFog","settings_highResFog"]).length;for(var E=function _loop3(){var d=_[D],v=document.getElementById(d);u.setRadioStyle(v,D,w);var x=v.value;v.addEventListener("change",(u=>{y.guiWindows.settingsGui.customObj.checked=!0,y.pxlQuality.setGraphicsSettings({fog:x}),y.pxlQuality.setQualityCookie(3)}))},D=0;D<w;++D)E();w=(_=["settings_noBloom","settings_bloomActive"]).length;for(var I=function _loop4(){var d=_[k],v=document.getElementById(d);u.setRadioStyle(v,k,w);var x=1==v.value;v.addEventListener("change",(u=>{y.guiWindows.settingsGui.customObj.checked=!0,y.pxlQuality.setGraphicsSettings({bloom:x}),y.pxlQuality.setQualityCookie(3)}))},k=0;k<w;++k)I();w=(_=["settings_tankTurning","settings_strafing"]).length;for(var R=function _loop5(){var d=_[O],v=document.getElementById(d);u.setRadioStyle(v,O,w);var x=1==v.value;v.addEventListener("change",(u=>{y.pxlQuality.setGraphicsSettings({leftRight:x},null)}))},O=0;O<w;++O)R();w=(_=["settings_dragLooking","settings_pointLooking"]).length;for(var j=function _loop6(){var d=_[G],v=document.getElementById(d);u.setRadioStyle(v,G,w);var x=1==v.value;v.addEventListener("change",(u=>{y.pxlQuality.setGraphicsSettings({mouse:x},null)}))},G=0;G<w;++G)j();this.setRadioValues()}setRadioStyle(u,d,v){var x="settings_radio_label_mid";0==d?x="settings_radio_label_start":d==v-1&&(x="settings_radio_label_end"),u.parentNode.children[1].classList.add(x)}setRadioValues(){var u=this.pxlQuality.settings;Object.keys(u).forEach((d=>{var v=document.getElementById("settingsRadioBlock_"+d);if(v){var x="resolution"==d?4*u[d]-1:~~u[d];v.children[x].children[0].checked=!0}}))}settingsGuiAdvObjSizing(){var u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],d=this.guiWindows.settingsGui.advObj,v=d.offsetHeight;d.style.maxHeight=(u?v:0)+"px",d.setAttribute("maxHeight",v)}settingsGuiToggle(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.guiWindows.settingsGui||this.settingsGuiBuild(),(u=null==u?!this.guiWindows.settingsGui.active:u)&&this.guiWindows.settingsGui&&(this.guiWindows.settingsGui.usernameReturn.innerText=""),this.guiWindows.settingsGui.active=u,this.promptFader(this.guiWindows.settingsGui.gui,u),this.toggleGuiWindowContainer(null,u),this.hudBlock.active&&this.toggleHudBlock(u),this.toggleHudBlock(u,!1),this.togglePxlNavDataDisplay(u),this.introHelpActive&&!u&&(this.introHelpActive=!1,this.pxlEnv.postHelpIntro())}togglePxlNavDataDisplay(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null==u&&(u=!!this.guiWindows.settingsGui&&this.guiWindows.settingsGui.active),this.pxlNavData.active=u;var d=this.pxlNavData.height||200;this.pxlNavData.gui.style.maxHeight=u?d+"px":"0px",u||(this.pxlNavData.height=this.pxlNavData.gui.offsetHeight)}renderRadius(u){this.pxlEnv.mapGlowPass.strength=Number(u),this.pxlEnv.roomBloomPass.strength=Number(u)}renderThreshold(u){this.pxlEnv.mapGlowPass.threshold=Number(u),this.pxlEnv.roomBloomPass.threshold=Number(u)}renderGlowRadius(u){this.pxlEnv.mapGlowPass.radius=Number(u),this.pxlEnv.roomBloomPass.radius=Number(u)}renderResolution(u){this.pxlQuality.screenResPerc=.75*u+.25,this.pxlDevice.resizeRenderResolution()}inviteUserBuild(){this.guiWindows.inviteUserGui={},this.guiWindows.inviteUserGui.gui=null,this.guiWindows.inviteUserGui.active=!1;var u=document.createElement("div");u.id="gui_inviteUserWindow",u.classList.add("gui_inviteUserParentStyle"),this.prepPromptFader(u),document.body.appendChild(u);var d=window.location+"";console.log(d),d=d.replace(/^https?:\/\//,""),console.log(d);var v="";v+='\n      <div class="gui_inviteUserBody">\n        <div class="iu_urlStyle">'.concat(d,'</div>\n        <div id="iu_copy" class="iu_copyStyle">Copy</div>\n      </div>\n  '),u.innerHTML=v;var x=this.pxlUtils,y=document.getElementById("iu_copy");y.addEventListener("click",(()=>{var u=x.copyRoomUrl();y.innerText=u?"Copied":"Error",y.timeout&&clearTimeout(y.timeout),y.timeout=setTimeout((()=>{y.innerText="Copy",clearTimeout(y.timeout)}),2e3)})),this.guiWindows.inviteUserGui.gui=u}inviteUserPosition(){if(this.guiWindows.inviteUserGui&&this.guiWindows.inviteUserGui.active){var u=document.getElementById("ft3Button").getBoundingClientRect();this.guiWindows.inviteUserGui.gui.style.display="grid",this.guiWindows.inviteUserGui.gui.style.top=u.y,this.guiWindows.inviteUserGui.gui.style.right=this.pxlDevice.sW-u.x+5,this.guiWindows.inviteUserGui.gui.style.minHeight=u.height}}toggleInviteUser(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.guiWindows.inviteUserGui||this.inviteUserBuild(),u=null==u?!this.guiWindows.inviteUserGui.active:u,this.guiWindows.inviteUserGui.active=u,this.promptFader(this.guiWindows.inviteUserGui.gui,u),this.inviteUserPosition()}buildMobileWelcome(){this.guiWindows.mobileGui={},this.guiWindows.mobileGui.gui=null,this.guiWindows.mobileGui.active=!1;var u=document.createElement("div");u.id="gui_mobileWelcomeGuiWindow",u.classList.add("gui_helpGuiParentStyle"),this.prepPromptFader(u),this.guiWindowBG.appendChild(u);var d="";d+='\n    <div id="gui_helpContent" class="gui_contentStyle" style="min-height:45%;">\n  <div class="gui_mobileBody">\n    welcome to\n          <br>'.concat(this.projectTitle,'\n  </div>\n  <div id="guiHelpFooter" class="gui_footer" style="margin-bottom: 4vh;">\n    <div class="guiButton" style="font-weight: 700; font-size: 5vw;" id="guiMobileWelcomeButton">enter</div>\n  </div>\n  <div class="gui_spacer"></div>\n    </div>\n  '),u.innerHTML=d;var v=this;document.getElementById("guiMobileWelcomeButton").onclick=u=>{v.toggleMobileWelcome(!1),v.pxlEnv.postHelpIntro()},this.guiWindows.mobileGui.gui=u}toggleMobileWelcome(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.guiWindows.mobileGui||this.buildMobileWelcome(),u=null==u?!this.guiWindows.mobileGui.active:u,this.guiWindows.mobileGui.active=u,this.promptFader(this.guiWindows.mobileGui.gui,u),this.toggleGuiWindowContainer(null,u),this.hudBlock.active&&this.toggleHudBlock(u)}ctaBuildPopup(){this.ctaContentLoading||(this.googleDocHTML?this.ctaDisplayPopup():(this.ctaContentLoading=!0,this.pxlFile.getURLContent(this.ctaLocalDocURL.blmSupport).then((u=>{this.ctaContentLoading=!1,this.googleDocHTML=u,this.ctaDisplayPopup()}))))}ctaDisplayPopup(){this.actionPopUp&&this.actionPopUp.parentNode.removeChild(this.actionPopUp);var u=this.googleDocHTML;this.actionPopUp=document.createElement("div"),this.actionPopUp.setAttribute("id","ctaPopup"),this.actionPopUp.classList.add("parentGoogleLinkDoc"),this.actionPopUp.classList.add("fader"),this.actionPopUp.classList.add("visOff");var d=document.createElement("div");d.setAttribute("id","ctaPopupInner"),this.actionPopUp.appendChild(d),document.body.appendChild(this.actionPopUp);var v=null;""!=u&&u?(d.innerHTML=u,d.classList.add("iframeGoogleLinkDoc")):((v=document.createElement("iframe")).src="",v.classList.add("iframeGoogleLinkDoc"),d.appendChild(v),v.referrerpolicy="unsafe-url");var x=this;this.actionPopUp.onclick=function(u){"ctaPopup"==u.srcElement.getAttribute("id")&&(x.promptFader(this,!1,null,!0),x.actionPopUp=null)},v?v.onload=function(){setTimeout((()=>{this.promptFader(this.actionPopUp,!0,null,!1)}),100)}:setTimeout((()=>{this.promptFader(this.actionPopUp,!0,null,!1)}),100)}getUserControls(u){if(!u)return[null];var d=u,v=d.userStatusGui,x=d.audio,y=d.audioMuted,b=d.userSoundGui;return{curAvatar:d,curName:d.displayName,curAudio:x,curAudioMuted:y,curGui:v,curNameGui:d.userNameGui,curAudioGui:b,curVerse:d.verse}}setUserControlPosition(){var u=this;return pxlNav_GUIBase_asyncToGenerator((function*(){if(u.userControlBlock){var d=0;if(u.hudTopBar){var v=u.hudTopBar.getBoundingClientRect();d=v.y+v.height}u.userControlBlock.gui.style.top=d+"px"}}))()}buildUserSpeaker(){var u={},d=this.userControlBlock.speakerIcon.svg.cloneNode(!0);d.classList.add("userControlSpeakerStyle"),d.classList.add("userControlSpeakerButtonStyle"),u.gui=d,u.remoteMuted=!1,u.volPrev=0;for(var v=d.children,x=0;x<v.length;++x){var y=v[x],b=y.getAttribute("id");u[b]=y,"mute"==b?y.classList.add("userControlVisStyle"):"button"==b&&y.classList.add("userControlSpeakerButtonStyle")}for(var _=u.volLines.children,w=0;w<_.length;++w){var S=_[w];u[S.getAttribute("id")]=S}_=u.remoteMutedLines.children;for(var C=0;C<_.length;++C){var P=_[C];u[P.getAttribute("id")]=P}return u}addUserControls(u){var d=this;return pxlNav_GUIBase_asyncToGenerator((function*(){var{curAvatar:v,curName:x,curGui:y}=d.getUserControls(u),b=document.createElement("div");b.classList.add("userControlProximityOff"),b.classList.add("userControlParentStyle"),b.classList.add("userControlSpeakerButtonStyle"),d.mobile&&(b.style.display="none");var _=d;b.onclick=()=>{_.setUserControlMute(u)},v.userStatusGui=b,d.userControlBlock.gui.appendChild(b);var w=document.createElement("div");w.classList.add("userControlInnerParentStyle"),b.appendChild(w);var S=document.createElement("div");S.classList.add("userControlSpeakerParentStyle");var C=d.buildUserSpeaker();S.appendChild(C.gui),v.userSoundGui=C,w.appendChild(S);var P=document.createElement("div");P.classList.add("userControlNameStyle"),P.innerText=x,v.userNameGui=P,w.appendChild(P),d.setUserControlColor(u)}))()}setUserControlVolume(u,d){var v=arguments,x=this;return pxlNav_GUIBase_asyncToGenerator((function*(){var y=!(v.length>2&&void 0!==v[2])||v[2];if(x.userControlBlock.activeList.includes(u)){var{curAudioGui:b,curAudioMuted:_}=x.getUserControls(u);!b||_&&0!=d||(b.remoteMuted?d=0:y&&d>0&&(d*=2,d=Math.min(1,Math.max(d,.5*(d+b.volPrev)))),b.volPrev=d,b.volLines.style.opacity=d,b.volLines.style.filter="alpha(opacity="+100*d+")")}}))()}setUserControlMute(u){var d=this;return pxlNav_GUIBase_asyncToGenerator((function*(){var{curAvatar:v,curAudio:x,curAudioMuted:y,curAudioGui:b}=d.getUserControls(u);if(x){var _=!y;_?(d.setUserControlVolume(u,0,!1),b.mute.classList.add("userControlVisible"),x.volume=0,x.muted=!0):(b.mute.classList.remove("userControlVisible"),x.muted=!1,x.volume=1),v.audioMuted=_}}))()}setUserControlRemoteMute(u){var d=arguments,v=this;return pxlNav_GUIBase_asyncToGenerator((function*(){var x=d.length>1&&void 0!==d[1]?d[1]:null,y=!(d.length>2&&void 0!==d[2])||d[2],b=d.length>3&&void 0!==d[3]?d[3]:"#ffffff",{curAudio:_,curAudioGui:w}=v.getUserControls(u);if(w){null==x&&(x=!!_&&_.muted);var S="object"==typeof x?x.muted:x;w.remoteMuted=S,w.base.setAttribute("fill",S?"#ff0000":b),w.remoteMutedLines.style.display=S||!y?"inline-block":"none",w.remoteS1.setAttribute("stroke",y?"#ff0000":b),w.remoteS2.setAttribute("stroke",y?"#ff0000":b),v.setUserControlVolume(u,0,!1)}}))()}setUserControlVis(u){var d=arguments,v=this;return pxlNav_GUIBase_asyncToGenerator((function*(){var x=d.length>1&&void 0!==d[1]?d[1]:null,{curAvatar:y,curGui:b,curAudio:_}=v.getUserControls(u);if(b){var w="userControlProximityOff";if(null==x&&(x=!b.classList.contains(w)),x)b.classList.remove(w),b.style.maxWidth=b.children[0].getBoundingClientRect().width+"px",v.setUserControlVolume(u,0),v.userControlBlock.activeList.includes(u)||v.userControlBlock.activeList.push(u);else{b.classList.add(w),b.style.maxWidth="30px";var S=v.userControlBlock.activeList.indexOf(u);S>-1&&v.userControlBlock.activeList.splice(S,1)}v.userControlBlock.gui.style.padding=0==v.userControlBlock.activeList.length?"0px":"5px"}}))()}deleteUserControlVis(u){var d=this;return pxlNav_GUIBase_asyncToGenerator((function*(){var{curAvatar:v,curGui:x}=d.getUserControls(u);if(x){x.classList.add("userControlProximityOff"),x.style.maxWidth="30px";var y=d.userControlBlock.activeList.indexOf(u);y>-1&&d.userControlBlock.activeList.splice(y,1),d.userControlBlock.gui.style.padding=0==d.userControlBlock.activeList.length?"0px":"5px",x&&x.parentNode.removeChild(x)}}))()}userControlsSwap(u,d){var v=this.userControlBlock.activeList.indexOf(u);v>-1&&(this.userControlBlock.activeList.splice(v,1),this.userControlBlock.activeList.includes(d)||this.userControlBlock.activeList.push(d))}setUserControlColor(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,{curAvatar:v,curGui:x,curAudioGui:y,curVerse:b}=this.getUserControls(u),_=!0;null==d&&(d="#ffffff");x.style.color=d,y.base.setAttribute("fill",d),y.mute.setAttribute("stroke",d),y.mid.setAttribute("fill",d),y.max.setAttribute("fill",d),y.volPrev=0,y.volLines.style.opacity=0,y.volLines.style.filter="alpha(opacity=0)";var w=this;v.userStatusGui.onclick=()=>{w.setUserControlMute(u)},this.setUserControlRemoteMute(u,null,_,d)}toggleUserControls(u){if(!u)return null}}class pxlNav_ShaderEditor{constructor(u,d){this.active=!1,this.isEditing=!1,this.name="GLSL Editor",this.type="shaderGui",this.pxlCore=u,this.pxlEnv=u.pxlEnv,this.guiManager=d,this.parent=null,this.gui=null,this.helpGui=null,this.shaderEditorDisplay=null,this.children={},this.uniformsObj=null,this.vertObj=null,this.fragObj=null,this.currentShader=null,this.shaderSliderValues=new j.Vector3,this.editorWidthMinMax={min:30,max:70}}addSlider(u,d,v,x,y,b,_,w){"string"==typeof u&&(u=document.getElementById(u));var S=document.createElement("div");S.style.display="grid",S.style.gridAutoFlow="column",S.style.alignItems="center",S.style.gridAutoColumns="max-content auto max-content",S.innerHTML="<div class='input_sliderLabel'>"+d+" : </div>";var C=document.createElement("input");C.type="range",C.classList.add("input_sliderRange"),C.min=x,C.max=y,C.step=b,C.value=v,S.appendChild(C);var P=document.createElement("input");P.type="number",P.classList.add("gui_defaultInput"),P.classList.add("input_numberInput"),P.value=v,S.appendChild(P),P.onchange=u=>{C.value=u.target.value},C.onchange=u=>{P.value=u.target.value,_(u.target.value,...w)},C.oninput=u=>{P.value=u.target.value,_(u.target.value,...w)},u.appendChild(S)}updateShaderTextFields(){var u,d,v,x,y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;y||(y=this.pxlEnv.currentRoom==this.pxlEnv.mainRoom?this.currentShader:this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].getCurrentShader());try{u=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].readShader(y,this.shaderSliderValues)}catch(u){return}d=v=x="Unable To Load";try{for(var b in u.uniforms.sliders={type:"v",value:this.shaderSliderValues},d=JSON.stringify(u.uniforms),v=u.vertexShader,x=u.fragmentShader,d="",u.uniforms){var _="float",w={t:"sampler2D",b:"bool",i:"int",f:"float",v:"vec",c:"vec"};if("object"==(_=typeof u.uniforms[b].value)){if(_="",!u.uniforms[b].value)continue;_="image"in u.uniforms[b].value?"sampler2D":_+"vec"+Object.keys(u.uniforms[b].value).length}else w.hasOwnProperty(u.uniforms[b].type)&&(_="i"==u.uniforms[b].type?"i":""),w.hasOwnProperty(u.uniforms[b].type)&&(_=w[u.uniforms[b].type]);d+="uniform ".concat(_," ").concat(b,";   ")}v=v.replace(/[\t]/g,"  "),x=x.replace(/[\t]/g,"  ")}catch(u){console.log("Error Reading Shader"),console.log(u)}u&&(u.needsUpdate=!0,this.children.uniformsObj.value=d,this.children.vertObj.value=v,this.children.fragObj.value=x)}buildShaderEditor(){var u="shaderGui",d=document.createElement("div");d.id="guiShaderEditorBlock",d.classList.add("gui_shaderEditorBlockStyle"),d.style.transition="max-width .5s ease, opacity .8s, filter .8s",this.pxlEnv.pxlGuiDraws.prepPromptFader(d),this.pxlEnv.pxlGuiDraws.guiWindows[u]={},this.pxlEnv.pxlGuiDraws.guiWindows[u].gui=d,this.pxlEnv.pxlGuiDraws.guiWindows[u].active=!1,this.gui=d;var v=document.createElement("div");v.id="guiShaderHelpBlock",v.classList.add("gui_shaderHelpBlockStyle"),v.style.transition="left .3s ease, opacity .8s, filter .8s",this.pxlEnv.pxlGuiDraws.prepPromptFader(v),this.pxlEnv.pxlGuiDraws.guiWindows[u].help=v,this.helpGui=v;var x=this.pxlEnv.currentRoom,y=this.pxlEnv.roomSceneList[x].geoList,b=Object.keys(y),_="";b.forEach((u=>{if(["Mesh","Points"].includes(y[u].type)&&"ShaderMaterial"==y[u].material.type){var d=u.substring(0,1).toUpperCase()+u.substring(1,u.length);_+="<option value='geo_"+u+"'>"+d+"</option>"}}));this.pxlEnv.pxlGuiDraws.guiWindows[u].currentShader="script_fog";var w='\n    <div id="gui_shaderEditorParent" class="gui_shaderEditorParentStyle">\n      <div id="gui_shaderEditorHeaderBlock" class="gui_shaderEditorHeaderBlock">\n      <div class="gui_shaderEditorOptionBlock">\n        <div class="gui_shaderEditorTitleBlock">\n        <div id="gui_shaderEditorTitleParent" class="gui_shaderEditorTitleParentStyle">\n            <div id="gui_shaderEditorTitle" clsss="gui_shaderEditorTitleStyle">GLSL Shader Editor</div>\n            <div id="gui_shaderEditorHeaderList" clsss="gui_shaderEditorHeaderListStyle">\n              <span id="gui_shaderEditorPulldownHeader" clsss="gui_shaderEditorPulldownHeaderStyle">Edit Shader</span>\n              <select name="shaderEditor_loadShader" id="shaderEditor_loadShader" class="pickerStyle gui_shaderPickerStyle">\n                <option value="script_avatar" '.concat("",'>Avatar</option>\n                <option value="script_fog" ').concat("selected",'>Fog</option>\n                <option value="script_dArrows">Direction Arrows</option>\n                <option value="script_userScreens">User Screens</option>\n                <option value="script_warpZonePortals">Warp Zone Portals</option>\n                <option value="script_lizardking">Item; Lizard King</option>\n                <option value="script_majorTom">Item; Major Tom</option>\n                <option value="script_fractalSubstrate">Item; Fractal Substrate</option>\n                <option value="script_fractalEcho">Item; Fractal Echo Pass</option>\n                ').concat(_,'\n              </select>\n            </div>\n            <div id="gui_shaderEditorFontSize" clsss="gui_shaderEditorFontSizeStyle">\n              <span  style="font-size:.75em;margin-right:5px;">Font Size</span>\n              <span id="gui_shaderEditorFontSmaller" class="shaderEditor_settingsButton">-</span>\n              <span id="gui_shaderEditorFontLarger" class="shaderEditor_settingsButton">+</span>\n              <span class="gui_shaderEditorOptionBarSpacer"> </span>\n              <span id="gui_shaderEditorCloseButton" class="shaderEditor_settingsButton">X</span>\n            </div>\n          </div>\n        </div>\n        <div class="gui_shaderEditorHeaderLine"></div>\n        <div id="guiShaderUserSliders"></div>\n        <div class="gui_shaderEditorHeaderLine"></div>\n      </div>\n      </div>\n      \n      \n      <div id="guiShaderFieldParent" class="gui_shaderEditorFieldParentStyle">\n        <span style=\'height:12px\'>Uniforms -</span>\n        <textarea spellcheck="false" placeholder="Shader Uniforms" rows="3" id="shaderEditor_uniformInput" style="height:unset;" readonly></textarea>\n        <span style=\'height:12px\'>Vertex Shader -</span>\n        <textarea spellcheck="false" placeholder="Vertex Shader" id="shaderEditor_vertInput"></textarea>\n        <span style=\'height:12px\'>Fragment Shader -</span>\n        <textarea spellcheck="false" placeholder="Fragment Shader" id="shaderEditor_fragInput"></textarea>\n      </div>\n      <div id="shader_updateShader" class="shaderEditor_sendMessage">Update Shader</div>\n    </div>\n    '),S="<div class='gui_shaderHelpSpacerStyle'></div>";w+='\n    <div id="gui_shaderHelpBlock" class="gui_shaderHelpBlockStyle">\n      <div class="gui_shaderHelpTitle">:: Keyboard Shortcuts ::</div>\n      '.concat(S,'\n      <span><span class="gui_boldText">Ctrl + Enter</span><br> - Update Shader on Material</span>\n      <br>&nbsp;&nbsp;<span>Returns use existing indent type (Spaces or Tabs)</span>\n      ').concat(S,'\n      <span><span class="gui_boldText">Ctrl + D</span><br> - Duplicate current line</span>\n      ').concat(S,'\n      <span><span class="gui_boldText">Ctrl + K</span><br> - Comment current/selected lines</span>\n      ').concat(S,'\n      <span><span class="gui_boldText">Ctrl + Shift + K</span><br> - Uncomment current/selected lines</span>\n      ').concat(S,"\n      <span><span class=\"gui_boldText\">Ctrl + NumPad {1,2,3}</span><br> - Add selection or '.0' into float(), vec2(), vec3() </span>\n      ").concat(S,'\n      <span><span class="gui_boldText">Ctrl + {Up,Down,Left,Right}</span><br> - Searches for current selection in direction</span>\n      ').concat(S,'\n      <span><span class="gui_boldText">Y</span><br> - To opn/close the Shader Editor</span>\n      ').concat(S,"\n    </div>\n    "),d.innerHTML=w,document.body.appendChild(d);var C=document.getElementById("guiShaderUserSliders");this.parentObj=C;var P=this.shaderSliderValues,A=function sliderSetShader(u){for(var d=arguments.length,v=new Array(d>1?d-1:0),x=1;x<d;x++)v[x-1]=arguments[x];P[v[0]]=u};this.addSlider(C,"sliders.x",0,-1,1,.01,A,["x"]),this.addSlider(C,"sliders.y",0,-5,5,.1,A,["y"]),this.addSlider(C,"sliders.z",0,-10,10,.1,A,["z"]),this.children.shaderSliders=C,this.children.shaderParentObj=document.getElementById("shaderEditor_uniformInput").parentNode,this.children.shaderEditor=document.getElementById("gui_shaderEditorParent"),this.children.headerBar=document.getElementById("gui_shaderEditorHeaderBlock"),this.children.titleParentObj=document.getElementById("gui_shaderEditorTitleParent"),this.children.titleObj=document.getElementById("gui_shaderEditorTitle"),this.children.pulldownHeaderObj=document.getElementById("gui_shaderEditorPulldownHeader"),this.children.uniformsObj=document.getElementById("shaderEditor_uniformInput"),this.children.vertObj=document.getElementById("shaderEditor_vertInput"),this.children.fragObj=document.getElementById("shaderEditor_fragInput"),this.children.updateObj=document.getElementById("shader_updateShader"),this.children.helpDiv=document.getElementById("gui_shaderHelpBlock"),this.children.shaderList=document.getElementById("gui_shaderEditorHeaderList"),this.children.shaderFieldParent=document.getElementById("guiShaderFieldParent"),this.shaderEditorDisplay=document.getElementById("shaderEditorDisplay"),this.children.shaderSelect=document.getElementById("shaderEditor_loadShader");var T=document.getElementById("gui_shaderEditorFontSize");T.style.justifySelf="end",T.style.marginTop="2px",T.style.marginRight="3px",T.style.userSelect="none",T.style.display="flex",T.style.alignItems="center";var E=this;this.children.shaderSelect.onchange=u=>{E.updateShaderTextFields(this.children.shaderSelect.value)},document.getElementById("gui_shaderEditorFontSmaller").onclick=u=>{E.shiftFontSize(-.15)},document.getElementById("gui_shaderEditorFontLarger").onclick=u=>{E.shiftFontSize(.15)},document.getElementById("gui_shaderEditorCloseButton").onclick=u=>{E.toggleShaderEditor()},this.children.updateObj.addEventListener("click",(()=>{this.isEditing=!1;var u=document.getElementById("shaderEditor_uniformInput").value,d=document.getElementById("shaderEditor_vertInput"),v=d.value,x=document.getElementById("shaderEditor_fragInput"),y=x.value,b=document.createElement("div");b.innerHTML=u,u=b.innerText,b.innerHTML=v,v=b.innerText,b.innerHTML=y,y=b.innerText,E.pxlEnv.roomSceneList[E.pxlEnv.currentRoom].setShader(u,v,y),d.blur(),x.blur(),E.guiManager.pxlNavCanvas.focus()})),this.children.vertObj.onfocus=u=>{E.focusShaderMessage(u,"vertObj")},this.children.vertObj.onkeydown=u=>{E.keyShaderMessage(u)},this.children.vertObj.onmousedown=u=>{E.mDownShaderMessage(u)},this.children.vertObj.onclick=u=>{E.clickShaderMessage(u)},this.children.vertObj.ondblclick=u=>{E.dblclickShaderMessage(u)},this.children.fragObj.onfocus=u=>{E.focusShaderMessage(u,"fragObj")},this.children.fragObj.onkeydown=u=>{E.keyShaderMessage(u)},this.children.fragObj.onmousedown=u=>{E.mDownShaderMessage(u)},this.children.fragObj.onclick=u=>{E.clickShaderMessage(u)},this.children.fragObj.ondblclick=u=>{E.dblclickShaderMessage(u)},this.mouseX=0,this.mouseY=0,this.prevSelectStart=0,this.prevSelectEnd=0}shiftFontSize(u){var d=document.getElementById("gui_shaderEditorParent");if(d){d.hasAttribute("styleStore")||d.setAttribute("styleStore",1);var v=parseFloat(d.getAttribute("styleStore"))+u;d.setAttribute("styleStore",v),d.style.fontSize=v+"em";var x=document.getElementById("shaderEditor_uniformInput");x&&(x.style.fontSize=v+"em");var y=document.getElementById("shaderEditor_vertInput");y&&(y.style.fontSize=v+"em");var b=document.getElementById("shaderEditor_fragInput");b&&(b.style.fontSize=v+"em"),setTimeout((()=>{this.resizeShaderElements()}),130)}}updateHeaderBar(){this.isEditing?(this.children.titleParentObj.style.fontSize="2.05em",this.children.titleObj.style.fontSize="1.15em"):(this.children.titleParentObj.style.fontSize="1.3em",this.children.titleObj.style.fontSize="1em")}mDownShaderMessage(u){this.mouseX=u.x,this.mouseY=u.y}clickShaderMessage(u){if(!this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.dcActive){var d=Math.abs(this.mouseX-u.x),v=Math.abs(this.mouseY-u.y);if(Math.max(d,v)<5){var x=u.target,y=x.selectionStart,b=x.selectionEnd;parseInt(.5*(y+b));y!=b&&(this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.prevSelectStart=y,this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.prevSelectEnd=b)}}}dblclickShaderMessage(u){var d=this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.prevSelectStart,v=this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.prevSelectEnd,x=u.target,y=(x.selectionStart,x.selectionEnd,x.value.substring(d,v+20)),b=y.match(/[a-zA-Z0-9\.\_\[\]]+/);b&&!y[0].match(/\n/)&&(v=d+b[0].length),x.setSelectionRange(d,v),this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.dcActive=!0,setTimeout((()=>{this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.dcActive=!1}),500)}keyShaderMessage(u){if(u.repeat)return!1;var d=u.key,v=u.code,x=u.shiftKey,y=u.ctrlKey,b=(u.altKey,v.includes("Numpad"));if(!("Enter"==d||"Tab"==d||"KeyD"==v&&y||"KeyK"==v&&y||b&&y||v.includes("Arrow")&&y))return!1;u.preventDefault();var _=u.target;if("NumpadAdd"==v){var w=window.getComputedStyle(_),S=parseFloat(w.fontSize)+2;return _.style.fontSize=S,!1}if("NumpadSubtract"==v){var C=window.getComputedStyle(_),P=parseFloat(C.fontSize)-2;return _.style.fontSize=P,!1}var A=_.selectionStart,T=_.selectionEnd,E=_.value;if(v.includes("Arrow")){if(A==T)return!1;var D,I,k,R=E.substring(A,T);if("ArrowUp"==v?(I=E.substring(0,A),A=I.search(/.*$/),v="ArrowLeft"):"ArrowDown"==v&&(I=E.substring(T,E.length),T=I.search(/\n/)+T,v="ArrowRight"),"ArrowLeft"==v){D=new RegExp(R+".*","gm");var O=[...(I=E.substring(0,A)).matchAll(R,"g")];if(0==O.length&&0==(O=[...E.matchAll(R,"g")]).length)return!1;k=O.pop().index}if("ArrowRight"==v){D=new RegExp(R,"m"),I=E.substring(T,E.length);var j=D.exec(I);if(j)k=j.index+T;else{if(!(j=D.exec(E)))return!1;k=j.index}}if(k>-1){var G=k+R.length;_.setSelectionRange(k,G);var H=_.getBoundingClientRect(),X=window.getComputedStyle(_).font,q=[E.slice(0,k),"<span id='tmpShaderPosition'>.</span>",E.slice(k)].join("");q=q.replace(/(?:\r\n|\r|\n)/g,"<br>");var Z=document.createElement("div");Z.style.position="fixed",Z.style.width=H.width,Z.style.height=H.height,Z.style.overflowY="scroll",Z.style.font=X,Z.innerHTML=q,document.body.appendChild(Z);var J=Z.querySelector("#tmpShaderPosition").offsetTop-200;document.body.removeChild(Z),_.scrollTo(0,J)}return!1}if("Enter"==d&&y)return this.children.updateObj.click(),_.focus(),_.setSelectionRange(A,T),!1;if(b){var Q=E.substring(A,T),K=Q.length>0,Y=E.substr(A-1,1);Y=/[\w|\d]/.test(Y)&&0==Q.length?" ":"";var $=E.substr(T+1,1);$=/[\w|\d]/.test($)&&0==Q.length?" ":"";var ee=A+Y.length;if("Numpad1"==v){var te="float(";ee+=6,Q=te+(Q=K?Q:".0")+")"}else if("Numpad2"==v){var ie="vec2(";ee+=5,Q=ie+(Q=K?Q:".0, .0")+")"}else if("Numpad3"==v){var se="vec3(";ee+=5,Q=se+(Q=K?Q:".0, .0, .0")+")"}return Q=Y+Q+$,document.execCommand("insertText",!1,Q),K||_.setSelectionRange(ee,ee),!1}var re=Math.min(A,T),ae=E.substr(0,re);if("KeyK"==v){var ne,oe,le,he=!1;if(A!=T&&(ne=ae.search(/.*$/),oe=T,le=E.substring(ne,T),he=/\n/.test(le)),!he){var ue=ae.search(/[\S\w].*$/);if(-1==ue){if(-1==(ue=E.substring(re,E.length).search(/(?:[^\s])/)))return!1;ue+=re}var ce=ue,pe=ce,de="";if(x){if(pe+=2,"//"!=E.substr(ce,2))return!1;A-=2,T-=2}else{if("//"==E.substr(ce,2))return!1;de="//",A+=2,T+=2}return _.setSelectionRange(ce,pe),document.execCommand("insertText",!1,de),_.setSelectionRange(A,T),!1}if(he){var ve=oe+E.substring(oe,E.length).search(/\n./),me=E.substring(ne,ve),xe=x?-2:2,ge=[...me.matchAll(/[\S\w].*/g)],fe=[],ye=A-ne,be=oe-ne;return ge.forEach((u=>{var d=u.index;fe.push(d)})),(fe=fe.reverse()).forEach((u=>{var d=me.substr(u,2);if(x){if("//"!=d)return;me=me.substring(0,u)+me.substring(u+2,me.length)}else{if("//"==d)return;me=me.substring(0,u)+"//"+me.substring(u,me.length)}A+=u<ye?xe:0,T+=u<be?xe:0})),_.setSelectionRange(ne,ve),document.execCommand("insertText",!1,me),_.setSelectionRange(A,T),!1}return!1}var _e=ae.split("\n");if("Enter"==d||"Tab"==d){var we=_e.pop();0==we.length&&(we=_e.pop());var Se=we.replace(/[\S\w].*$/g,""),Ce=Se="Tab"==d?" "===(Se=0==Se.length?" ":Se.substr(0,1))?"  ":"\t":"\n"+Se,Ne=A,Pe=T;if("Tab"==d&&A!=T){var Me=E.substring(A,T);Me=Me.split("\n"),Pe=Ne+(Ce=(Me=x?Me.map((u=>""==u?u:u.replace(Se,""))):Me.map((u=>""==u?u:Se+u))).join("\n")).length}else Pe=Ne+=Ce.length;return document.execCommand("insertText",!1,Ce),_.setSelectionRange(Ne,Pe),!1}if("KeyD"==v&&y)if(A==T){var Ae=E.split("\n");_e.pop();var Te=Ae[_e.length],Ee=[..._e,Te].join("\n").length;Te="\n"+Te,_.setSelectionRange(Ee,Ee),document.execCommand("insertText",!1,Te),Ee=re+Te.length,_.setSelectionRange(Ee,Ee)}else{var De=E.substring(A,T);_.setSelectionRange(T,T),document.execCommand("insertText",!1,De),T+=De.length,_.setSelectionRange(T,T)}return!1}updateShaderList(){var u=this.children.shaderSelect;if(!u)return console.log("No pulldown"),void console.log(this.gui);var d=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].getShaderList(),v=Object.keys(d),x="",y=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].getCurrentShader();v.forEach((u=>{var v=u==y?" selected":"";x+='<option value="'.concat(u,'" ').concat(v,">").concat(d[u],"</option>")})),u.innerHTML=x}resize(u){this.resizeShaderElements()}resizeShaderElements(){var u=0;if(this.hudBottomBar&&(u=this.hudBottomBar.offsetHeight),this.children.headerBar&&(u+=this.children.headerBar.offsetHeight),this.gui){this.gui.style.height=this.guiManager.sH-u;var d=this.children.vertObj.getBoundingClientRect().top,v=this.children.updateObj.getBoundingClientRect().height;v+=40;var x=this.guiManager.sH-v-d;this.children.vertObj.style.maxHeight=.4*x+"px",this.children.vertObj.displayHeight=.4*x,this.children.fragObj.style.maxHeight=.6*x+"px",this.children.fragObj.displayHeight=.6*x,this.children.fieldBodyHeight=x}}toggleShaderEditor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.gui||this.buildShaderEditor(),this.updateShaderList(),this.updateShaderTextFields(this.children.shaderSelect.value),u=null==u?!this.active:u,this.active=u,this.guiManager.promptFader(this.gui,u),this.guiManager.promptFader(this.helpGui,u),this.pxlEnv.emit("shaderEditorVis",u),u?this.guiManager.pxlNavCanvas.addEventListener("mousedown",this.blurShaderEditor.bind(this)):this.guiManager.pxlNavCanvas.removeEventListener("mousedown",this.blurShaderEditor.bind(this)),setTimeout((()=>{this.resizeShaderElements()}),130)}blurShaderEditor(){this.isEditing=!1,document.activeElement.blur(),document.getElementById("guiShaderEditorBlock").style.maxWidth=this.editorWidthMinMax.min+"vw";var u=document.getElementById("gui_shaderHelpBlock");u&&(u.style.left="max("+this.editorWidthMinMax.min+"vw, 430px)");var d=document.getElementById("shaderEditor_loadShader");d&&(d.style.maxWidth="85px"),this.updateHeaderBar(),setTimeout((()=>{this.resizeShaderElements()}),130)}focusShaderMessage(u,d){var v;this.isEditing=!0;var x=this.children,y=x.vertObj.displayHeight,b=x.fragObj.displayHeight,_=Math.max(150,.135*this.guiManager.sH),w=x.fieldBodyHeight-_;y="vertObj"==d?w:_,b="fragObj"==d?w:_,x.vertObj.style.maxHeight=y+"px",x.fragObj.style.maxHeight=b+"px";document.getElementById("gui_shaderEditorParent");this.gui.style.maxWidth=this.editorWidthMinMax.max+"vw",null!==(v=this.children)&&void 0!==v&&v.shaderSelect&&(this.children.shaderSelect.style.maxWidth="225px");var S=document.getElementById("gui_shaderHelpBlock");S&&(S.style.left=this.editorWidthMinMax.max+"vw"),this.updateHeaderBar()}}var qs=__webpack_require__(261);function pxlNav_Video_asyncGeneratorStep(u,d,v,x,y,b,_){try{var w=u[b](_),S=w.value}catch(u){return void v(u)}w.done?d(S):Promise.resolve(S).then(x,y)}function pxlNav_Video_asyncToGenerator(u){return function(){var d=this,v=arguments;return new Promise((function(x,y){var b=u.apply(d,v);function _next(u){pxlNav_Video_asyncGeneratorStep(b,x,y,_next,_throw,"next",u)}function _throw(u){pxlNav_Video_asyncGeneratorStep(b,x,y,_next,_throw,"throw",u)}_next(void 0)}))}}var Zs={Utils:class pxlNav_Utils{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"images/assets/",d=arguments.length>1?arguments[1]:void 0;this.assetRoot=u,this.mobile=d,this.pxlTimer=null,this.verboseLoading=!1,this.texLoader=new j.ImageLoader,this.textLoaderArray=[],this.channelFormats=[j.AlphaFormat,j.RedFormat,j.RGFormat,j.RGBFormat,j.RGBAFormat,j.LuminanceFormat,j.DepthFormat]}get curMS(){return this.pxlTimer.curMS}setDependencies(pxlNav){this.pxlTimer=pxlNav.pxlTimer}updateUrl(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";window.history.replaceState?window.history.replaceState(d,v,u):window.history.pushState(d,v,u)}copyRoomUrl(){var u=window.location,d=document.activeElement,v=document.createElement("textarea");v.value=u,document.body.appendChild(v),v.focus(),v.select();var x=!1;try{x=document.execCommand("copy")?"successful":"unsuccessful"}catch(u){}return document.body.removeChild(v),d.focus(),x}checkInt(u){return u%1==0}degToRad(u){return u*(Math.PI/180)}toHundreths(u){if(!u)return 0;if(Number.isInteger(u))return u;var d=(u+"").split(".");return parseFloat(d[0]+"."+d[1].substr(0,2))}toTenths(u){if(!u)return 0;if(Number.isInteger(u))return u;var d=(u+"").split(".");return parseFloat(d[0]+"."+d[1].substr(0,1))}getDateTime(){var u=new Date;return[(u.getFullYear()+"").padStart(2,"0")+"-"+(u.getMonth()+1+"").padStart(2,"0")+"-"+(u.getDate()+"").padStart(2,"0"),(u.getHours()+"").padStart(2,"0")+":"+(u.getMinutes()+"").padStart(2,"0")+":"+(u.getSeconds()+"").padStart(2,"0")]}cleanStrict(u){var d=document.createElement("div");d.innerHTML=u;var v=(d=d.innerText).match(/([a-zA-Z0-9])\w+/g);return v&&(d=v.join(" ")),d}cleanBasic(u){var d=document.createElement("div");d.innerHTML=u;var v=(d=d.innerText).match(/([a-zA-Z0-9\s\w-+()\[\]])+/g);return v&&(d=v.join("")),d}cleanString(u){var d=document.createElement("div");return d.innerHTML=u,d=d.innerText}randomFloat(u,d){return Math.random()*(d-u)+u}componentToHex(u){return u.toString(16).padStart(2,"0")}rgbToHex(u,d,v){return"#"+this.componentToHex(Math.min(255,Math.max(0,Math.round(u))))+this.componentToHex(Math.min(255,Math.max(0,Math.round(d))))+this.componentToHex(Math.min(255,Math.max(0,Math.round(v))))}hexToRgb(u){var d,v,x;return 3==(u="#"==u[0]?u.substr(1,6):u.substr(0,6)).length?(d=u[0]+u[0],v=u[1]+u[1],x=u[2]+u[2]):(d=u[0]+u[1],v=u[2]+u[3],x=u[4]+u[5]),[d=parseInt(d,16),v=parseInt(v,16),x=parseInt(x,16)]}stringToRgb(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=[255,0,0];if(u){for(var y=u.length,b="",_=0;_<y;++_)b+=u[y-1-_].charCodeAt(0).toString(16);var w=b.length;if(w>6){var S=1;"tussin"==u?S=0:"fexofenadine"==u&&(S=-1);var C=Math.max(0,parseInt((w-6)/2+S));b=b.substr(C,6)}x=this.hexToRgb(b)}if(null!=d){var P=Math.max(...x),A=Math.min(...x),T=P*d;x[0]=parseInt(Math.min(255,(x[0]-A)/(P-A)*255+T)),x[1]=parseInt(Math.min(255,(x[1]-A)/(P-A)*255+T)),x[2]=parseInt(Math.min(255,(x[2]-A)/(P-A)*255+T))}return 1==v&&(x[0]=x[0]/255,x[1]=x[1]/255,x[2]=x[2]/255),x}randomizeArray(u){for(var d=[...u],v=[];d.length>0;){var x=1==d.length?0:parseInt(21*Math.random()*d.length)%d.length;v.push(d.splice(x,1)[0])}return v}getRandom(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1.14;return u[Math.floor(Math.random(d)*u.length)]}applyTransformList(u,d){var v=d.r;u.rotateX(v[0]),u.rotateY(v[1]),u.rotateZ(v[2]),void 0!==d.rOrder&&(u.rotation.order=d.rOrder);var x=d.t;u.position.set(x[0],x[1],x[2]);var y=d.s;u.scale.set(y[0],y[1],y[2]),u.matrixAutoUpdate=!1,u.updateMatrix()}vec2(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new j.Vector2(u,d)}vec3(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return new j.Vector3(u,d,v)}loadTexture(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(void 0!==this.textLoaderArray[u])x=this.textLoaderArray[u];else{var x=new j.Texture;this.texLoader.load(u,(u=>{(null!=d&&(x.format=this.channelFormats[d]),x.image=u,x.needsUpdate=!0,v.length>0)&&Object.keys(v).forEach((u=>{x[u]=v[u]}))})),this.textLoaderArray[u]=x}return x}getVideoTexture(u){var d=new j.VideoTexture(u);return d.minFilter=j.LinearFilter,d.magFilter=j.LinearFilter,d.format=j.RGBFormat,d}getCanvasTexture(u){var d=new j.CanvasTexture(u);return{texture:d,material:new j.MeshBasicMaterial({map:d})}}},FileIO:pxlNav_FileIO,QualityController:class pxlNav_QualityController{constructor(u){var d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.pxlTimer=null,this.pxlCookie=null,this.pxlDevice=null,this.pxlEnv=null,this.msLog=0,this.prevMS=.001*(new Date).getTime(),this.autoQuality=!1,this.percent=1,this.verbose=u,this.screenResPerc=1,this.mBlurPercMult=d?.65:1,this.bloomPercMult=d?.65:1,this.bufferPercMult=1,this.renderTargetScale=10,this.percentSteps=[.3,.45,.85],this.fpsCounter=new j.Vector3(30,0,.001*(new Date).getTime()),this.countAtLevel=0,this.shiftRate=.01,this.moduleQualityList=[],this.qualityStep=-1,this.qualityMaxSteps=3,this.qualityStepValues=[.25,.5,.75,1],this.benchmarkStart=-1,this.benchmarkTime=-1,this.benchmarkRating=-1,this.benchmarkTimes=[9,17],this.setFromBenchmark=!0,this.benchmarkQuality=1,this.benchmarkQualityRange=[.25,1],this.settingsQualityChoice=null,this.detailLimitOverride=Object.keys(v).includes("dlimit")?v.dlimit:0,this.detailLimit=null!=this.detailLimitOverride?this.detailLimitOverride:0,this.settings={leftRight:!0,mouse:!0,graphics:2,resolution:1,fog:2,bloom:!0,motion:!1},this.settingsLow={resolution:.5,fog:0,bloom:!1,motion:!1},this.settingsMedium={resolution:.75,fog:1,bloom:!0,motion:!1},this.settingsHigh={resolution:1,fog:2,bloom:!0,motion:!1},this.settingsCustom=null}setDependencies(pxlNav){this.pxlTimer=pxlNav.pxlTimer,this.pxlCookie=pxlNav.pxlCookie,this.pxlDevice=pxlNav.pxlDevice,this.pxlEnv=pxlNav.pxlEnv}init(){null!=this.detailLimitOverride?this.detailLimit=this.detailLimitOverride:this.pxlCookie.hasCookie("detailLimit")&&(this.detailLimit=this.pxlCookie.parseCookie("detailLimit")),this.verbose>=Bs.INFO&&console.log("Graphics Limiting is set to level ",this.detailLimit),this.setFromBenchmark=!this.pxlCookie.parseDict(this.settings),this.pxlCookie.hasCookie("leftRight")&&(this.settings.leftRight=this.pxlCookie.parseCookie("leftRight")),this.pxlCookie.hasCookie("mouse")&&(this.settings.mouse=this.pxlCookie.parseCookie("mouse"));Object.keys(this.settingsHigh);if(this.pxlCookie.hasCookie("qualitySetting")){var u=this.pxlCookie.parseCookie("qualitySetting");this.settings.graphics=u,this.settingsQualityChoice=u}}step(){this.mapFpsQualitCheck()}attachModule(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;u&&this.moduleQualityList.push(u)}startBenchmark(){this.pxlTimer.step(),this.benchmarkStart=this.pxlTimer.curMS}endBenchmark(){this.pxlTimer.step();var u=this.pxlTimer.curMS-this.benchmarkStart;this.benchmarkTime=u,this.benchmarkRating=1-Math.min(1,Math.max(0,(u-this.benchmarkTimes[0])/(this.benchmarkTimes[1]-this.benchmarkTimes[0]))),this.benchmarkQuality=this.benchmarkRating*(this.benchmarkQualityRange[1]-this.benchmarkQualityRange[0])+this.benchmarkQualityRange[0];var d=Math.min(1,Math.max(0,this.benchmarkRating));if(d=Math.ceil(Math.max(.05,d)*this.qualityMaxSteps)-1,this.qualityStep=d,this.setFromBenchmark){this.qualityStep;this.setQualityLevel(this.qualityStep)}else{null==this.settingsQualityChoice&&(this.settingsQualityChoice=3),this.settingsCustom={},Object.keys(this.settingsHigh).forEach((u=>{this.settingsCustom[u]=this.settings[u]}))}this.setDependentSettings()}mapFpsQualitCheck(){if(this.pxlTimer.curMS-this.fpsCounter.z>1){this.fpsCounter.x=this.fpsCounter.y,this.fpsCounter.y=0,this.fpsCounter.z=this.pxlTimer.curMS;var u=1;this.fpsCounter.x<15&&(u=-1);var d=Math.min(1,Math.max(0,this.percent+this.shiftRate*u));this.autoQuality&&this.mapAutoQualityUpdate(d,!1)}this.fpsCounter.y+=1,this.pxlTimer.prevMS=this.pxlTimer.curMS}mapAutoQualityUpdate(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=Math.min(1,Math.max(0,u));d=Math.ceil(Math.max(.05,d)*this.qualityMaxSteps)-1,this.qualityStep=d}setGraphicsSettings(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(null==u)if(0==this.qualityStep)u=this.settingsLow;else if(1==this.qualityStep)u=this.settingsMedium;else{if(2!=this.qualityStep)return;u=this.settingsHigh}3==d&&this.checkCustomDict(),Object.keys(u).forEach((v=>{this.setComponentQuality(v,u[v]),this.settings[v]=u[v],3==d&&(this.settingsCustom[v]=u[v])})),this.setDependentSettings(),this.colliderPrevObjHit=null,null!=d&&(this.settings.graphics=d)}reapplySettings(){Object.keys(this.settingsLow).forEach((u=>{this.setComponentQuality(u,this.settings[u],!1)})),this.setDependentSettings()}setQualityLevel(u){this.pxlDevice.mobile&&(u=1),this.setQualityCookie(u),0==u?this.setLowQuality():1==u?this.setMediumQuality():2==u?this.setHighQuality():3==u&&this.setCustomQuality()}setLowQuality(){this.settingsQualityChoice=0,this.setGraphicsSettings(this.settingsLow,0)}setMediumQuality(){this.settingsQualityChoice=1,this.setGraphicsSettings(this.settingsMedium,1)}setHighQuality(){this.settingsQualityChoice=2,this.setGraphicsSettings(this.settingsHigh,2)}setCustomQuality(){this.checkCustomDict(),this.settingsQualityChoice=3,this.setGraphicsSettings(this.settingsCustom)}checkCustomDict(){if(null==this.settingsCustom){this.settingsCustom={};var u=this.settingsHigh;this.settingsQualityChoice&&(0==this.settingsQualityChoice?u=this.settingsLow:1==this.settingsQualityChoice?u=this.settingsMedium:2==this.settingsQualityChoice&&(u=this.settingsHigh)),Object.assign(this.settingsCustom,u)}}setQualityCookie(u){this.pxlCookie.setCookie("qualitySetting",u)}setComponentQuality(u,d){var v=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];switch(u){case"leftRight":case"mouse":this.settings[u]=d;break;case"resolution":this.screenResPerc=d,this.pxlDevice.resizeRenderResolution(),this.settings[u]=d,this.pxlEnv.geoList.snow&&this.pxlEnv.geoList.snow.material&&(this.pxlEnv.geoList.snow.material.uniforms.pointScale.value=this.pxlEnv.geoList.snow.pBaseScale*d);break;case"fog":this.pxlEnv.mapOverlayHeavyPass.enabled=2==d,this.pxlEnv.mapOverlayPass.enabled=1==d,this.pxlEnv.mapOverlaySlimPass.enabled=0==d,this.pxlEnv.mapBoxAAPass.enabled=2==d,this.pxlEnv.mapCrossAAPass.enabled=1==d,this.pxlEnv.portaluserScreenIntensity.x=1,this.pxlEnv.userScreenIntensity.x=.65,this.pxlEnv.userScreenIntensity.y=0,this.pxlEnv.geoList.HDRView&&(this.pxlEnv.geoList.HDRView.material.uniforms.cdMult.value=0==d?.7:.3),this.settings[u]=d;break;case"bloom":this.pxlEnv.portaluserScreenIntensity.x=d?.4:1,this.pxlEnv.mapGlowPass.enabled=d,this.pxlEnv.roomBloomPass.enabled=d,this.pxlEnv.roomGlowPass.enabled=d,this.pxlEnv.userScreenIntensity.x=d?.65:.8,this.pxlEnv.userScreenIntensity.y=d?0:.8,this.pxlEnv.geoList.HDRView&&(this.pxlEnv.geoList.HDRView.material.uniforms.cdMult.value=0==d?.7:.3),this.pxlEnv.mapMotionBlurPass.enabled=d,this.settings[u]=d;break;case"motion":this.pxlEnv.mapMotionBlurPass.enabled=d,this.settings[u]=d}v&&this.pxlCookie.setCookie(u,d)}setDependentSettings(){var u=1,d=0,v=.6;2==this.settings.fog?(this.pxlEnv.mapMotionBlurPass.enabled=!1,this.pxlEnv.mapOverlayHeavyPass.enabled=!0,this.pxlEnv.mapOverlayPass.enabled=!1,this.pxlEnv.mapOverlaySlimPass.enabled=!1,this.pxlEnv.mapBoxAAPass.enabled=!0,this.pxlEnv.mapCrossAAPass.enabled=!1,u=.5):1==this.settings.fog?(this.pxlEnv.mapMotionBlurPass.enabled=!1,this.pxlEnv.mapOverlayHeavyPass.enabled=!1,this.pxlEnv.mapOverlayPass.enabled=!0,this.pxlEnv.mapOverlaySlimPass.enabled=!1,this.pxlEnv.mapBoxAAPass.enabled=!1,this.pxlEnv.mapCrossAAPass.enabled=!0,u=.5):(this.pxlEnv.mapMotionBlurPass.enabled=!1,this.pxlEnv.mapOverlayPass.enabled=!1,this.pxlEnv.mapOverlaySlimPass.enabled=!0,this.pxlEnv.mapBoxAAPass.enabled=!1,this.pxlEnv.mapCrossAAPass.enabled=!1,u=.4),this.settings.bloom?(this.pxlEnv.mapGlowPass.enabled=!0,this.pxlEnv.roomBloomPass.enabled=!0,this.pxlEnv.roomGlowPass.enabled=!0,this.pxlEnv.userScreenIntensity.x=.65,this.pxlEnv.userScreenIntensity.y=0,d=1,v=.25):(this.pxlEnv.mapGlowPass.enabled=!1,this.pxlEnv.roomBloomPass.enabled=!1,this.pxlEnv.roomGlowPass.enabled=!1,this.pxlEnv.engine.setRenderTarget(this.pxlEnv.mapComposerGlow.renderTarget2),this.pxlEnv.engine.clear(),this.pxlEnv.engine.setRenderTarget(this.pxlEnv.roomGlowPass.renderTarget2),this.pxlEnv.engine.clear(),this.pxlEnv.engine.setRenderTarget(null),this.pxlEnv.userScreenIntensity.x=.8,this.pxlEnv.userScreenIntensity.y=0,u=1,d=0,v=.5);var x=this.pxlEnv.geoList.Circular_Gate;x&&(x.material.uniforms.bloomBoost.value=d),this.pxlEnv.geoList.HDRView&&(this.pxlEnv.geoList.HDRView.material.uniforms.cdMult.value=this.settings.bloom?.3:.7);var y=this.pxlEnv.geoList.CirculateGateVideoSphere;y&&(y.material.color.r=v,y.material.color.g=v,y.material.color.b=v),this.pxlEnv.portaluserScreenIntensity.x=u,this.pxlEnv.pxlCamera.colliderCurObjHit=null}},CookieManager:class pxlNav_CookieManager{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"pxlNav-",d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/",v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30,x="-"==u.substring(-1)?u:u+"-";this.prepend=x,this.exp=v,this.path="path="+d,this.deleteDate="expires=Thu, 01 Jan 1970 00:00:01 GMT;",this.sub="_%_"}pullData(){document.cookie}getExpiration(){var u=new Date;return u.setTime(u.getTime()+24*this.exp*60*60*1e3),"expires="+u.toGMTString()+";"}valueToString(u){var d=typeof u;return isNaN(Number(u))?"string"==d?"'"+u+"'":"boolean"==d?u?"true":"false":null==u?"null":isNaN(Number(u))?"NaN":u:u}variableToString(u){if(Array.isArray(u)){var d=u.map((u=>Array.isArray(u)?this.variableToString(u):this.valueToString(u)));return"["+d.join(",")+"]"}return this.valueToString(u)}hasCookie(u){return document.cookie.includes(this.prepend+u)}readCookie(u){if(this.hasCookie(u)){var d=new RegExp("(?="+this.prepend+u+").*?((?=;)|(?=$))","g");return document.cookie.match(d)[0].split("=")[1].replace(this.prepend,"").replace(this.sub,";")}return null}parseCookie(u){if(this.hasCookie(u)){var d=new RegExp("(?="+this.prepend+u+").*?((?=;)|(?=$))","g"),v=document.cookie.match(d)[0].split("=")[1].replace(this.prepend,"").replace(this.sub,";");return"true"==v?v=!0:"false"==v?v=!1:parseInt(v)==v?v=parseInt(v):parseFloat(v)==v&&(v=parseFloat(v)),v}return null}isEqual(u){return!!this.hasCookie(u)&&(console.log(u),this.readCookie(u)==this.variableToString(u))}evalCookie(u){if(u){if(this.hasCookie(u)){var d=new RegExp("(?="+this.prepend+u+").*?((?=;)|(?=$))","g");return console.log("Eval Cookie has been limited, responce is: "),console.log(document.cookie.match(d)[0].replace(this.prepend,"").replace(this.sub,";")),!0}return!1}var v=new RegExp("(?="+this.prepend+").*?((?=;)|(?=$))","g");return console.log("Eval Cookie has been limited, may error."),document.cookie.match(v).forEach((u=>{u.replace(this.prepend,"").replace(this.sub,";")})),!0}setCookie(u,d){(d=this.variableToString(d)).replace&&d.replace(";",this.sub),document.cookie=this.prepend+u+"="+d+";"+this.getExpiration()+this.path}addDictionary(u){for(var d=Object.keys(u),v=0;v<d.length;++v){var x=u[d[v]];(x=this.variableToString(x)).replace&&x.replace(";",this.sub),document.cookie=this.prepend+d[v]+"="+x+";"+this.getExpiration()+this.path}}parseDict(u){var d=Object.keys(u),v=!1;return d.forEach((d=>{this.hasCookie(d)&&(u[d]=this.parseCookie(d),v=!0)})),v}clearCookie(u){if(u)"string"==typeof u&&(u=[u]),u.forEach((u=>{document.cookie=u+"=;"+this.deleteDate+this.path}));else{var d=new RegExp("(?="+this.prepend+").*?(?==)","g");document.cookie.match(d).forEach((u=>{document.cookie=u+"=;"+this.deleteDate+this.path}))}}},Timer:class pxlNav_Timer{constructor(){this.active=!1,this.msRunner=new j.Vector2(0,0),this.msLog=0,this.fpsStats=-1;var u=.001*(new Date).getTime();this._bootMS=u,this._curMS=u,this._prevMS=u,this.videoFeeds=[],this.booted=!1}init(){this.booted||(this.prevMS=this.curMS,this.msRunner.x=0,this.msRunner.y=0,this.step(),this.booted=!0)}get runtime(){return this._curMS-this._bootMS}get curMS(){return this._curMS}updateTime(){this._curMS=.001*(new Date).getTime()}get prevMS(){return this._prevMS}set prevMS(u){this._prevMS=u}start(){this.play()}pause(){return this.active=!this.active,this.active}play(){return this.active=!0,this.active}stop(){return this.active=!1,this.active}toggleMSLog(){this.msLog=(this.msLog+1)%2}step(){this.prevMS=this._curMS,this.updateTime(),-1!=this.fpsStats&&this.fpsStats.update();var u=this.curMS-this.prevMS;this.msRunner.x+=u>0?u:0,this.msRunner.y=.5*(this.msRunner.y+u)}},User:class pxlNav_User{constructor(){this.id=null,this.jitsiUserId=null,this.jmaActive=!1,this.jmaConnectObj=!1,this.jmaServer=!1,this.jmaRoom=!1,this.jmaUserId=null,this.jmaUserName=null,this.jmaTempUserIdActive=!1,this.pxlEnv=null,this.welcome=!1,this.tankStrafe=!1,this.invertMouse=!1,this.renderSettingsCookie="settings_renderSettings",this.controlModeCookie="settings_controlMode",this.tankStrageCookie="settings_tankStrage",this.invertMouseCookie="settings_invertMouse",this.rootUserCookie="data_userEnlil",this.adminUserCookie="data_userNanna",this.localUserMoved=!1,this.localUserTurned=!1,this.itemRunTime=60,this.itemGroupList=[],this.itemList={},this.itemListNames=[],this.itemBaseList=[],this.itemActiveList=[],this.itemInactiveCmd=[],this.itemActiveTimer=[],this.itemRotateRate=.65,this.itemBaseRotateRate=.1,this.itemBobRate=.35,this.itemBobMag=0,this.mPick=[],this.activeEffects={},this.lowGrav=0,this.lKing=0,this.lKingInactive=[.025,.018],this.lKingActive=[.35,.25],this.lKingWarp=0,this.lKingPass=null,this.sField=0,this.sFieldWarp=0,this.sFieldPass=null,this.iZoom=0,this.iZoomWarp=0,this.iZoomPass=null}checkItemWearOff(u){if(this.itemActiveList.length>0&&this.itemActiveTimer[0]-u<=0)return this.itemInactiveCmd.shift()(),this.itemActiveTimer.shift(),this.itemActiveList.shift(),!0;return!1}checkItemPickUp(u){return"LowGravity"==u?0==this.lowGrav&&(this.lowGrav=1,!0):"LizardKing"==u?0==this.lKing&&(this.lKing=1,this.lKingWarp.set(...this.lKingActive),this.lKingPass.enabled=!0,!0):"StarField"==u?0==this.sField&&(this.sField=1,this.sFieldPass.enabled=!0,!0):"InfinityZoom"==u?0==this.iZoom&&(this.iZoom=1,this.iZoomPass.enabled=!0,!0):void 0}toggleTankRotate(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.tankStrafe=null==u?!this.tankStrafe:u,this.tankStrageText=this.tankStrafe?"Left/Right Rotation":"Left/Right Strafe"}toggleMouseInf(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.invertMouse=null==u?!this.invertMouse:u,this.invertMouseText=this.invertMouse?"Revert Mouse":"Invert Mouse"}toggleFpsStats(){-1==pxlTimer.fpsStats?(pxlTimer.fpsStats=new Stats,document.body.appendChild(pxlTimer.fpsStats.domElement),pxlTimer.fpsStats.update(),this.fpsDisplayText="Hide FPS Stats"):(pxlTimer.fpsStats.domElement.remove(),pxlTimer.fpsStats=-1,this.fpsDisplayText="Display FPS Stats")}},Device:class pxlNav_Device{constructor(u,d,v){this.projectTitle=u,this.pxlCore=d,this.pxlEnv=null,this.pxlTimer=null,this.pxlAudio=null,this.pxlUser=null,this.pxlCamera=null,this.pxlAutoCam=null,this.pxlGuiDraws=null,this.pxlQuality=null,this.allowCursorSwap=!1,this.longTouchLength=.75;var x=window.innerWidth,y=window.innerHeight;this.sW=x,this.sH=y,this.touchScreen=!1,this.x=.5*x,this.y=.5*y,this.screenRes=new j.Vector2(1/x,1/y),this.screenAspect=new j.Vector2(1,1),this.screenRatio=new j.Vector2(x/y,y/x),this.origRes=new j.Vector2(x,y),this.screenResDeltaPerc=new j.Vector2(1,1),this.mapW=1,this.mapH=1,this.gammaCorrection=new j.Vector3(1,1,1),this.lightShift=new j.Vector2(1,1),this.firefox=/Firefox/i.test(navigator.userAgent),this.mobile=v,this.button=0,this.inputActive=!1,this.startPos=[0,0],this.endPos=[0,0],this.dragCount=0,this.dragTotal=0,this.latched=!1,this.windowHidden=!1,this.mouseX=x/2,this.mouseY=y/2,this.keyDownCount=[0,0,0],this.directionKeyDown=!1,this.directionKeysPressed=[0,0,0,0],this.shiftBoost=1,this.controlKey=!1,this.objectPercList=[],this.objectPercFuncList={},this.objectPerc={active:!1,object:null,left:0,top:0,width:0,height:0,startX:0,startY:0,offsetX:0,offsetY:0,percX:0,percY:0,offsetPercX:0,offsetPercY:0},this.canCursorLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,this.cursorLockActive=!1,this.cursorRightButtonLockActive=!1,this.gyroGravity=[0,0,0],this.touchMouseData={active:!1,lock:!1,mode:0,updated:0,button:0,dragCount:0,dragTotal:0,startPos:null,moveMult:new j.Vector2(1,1),velocityEase:new j.Vector2(0,0),velocityEasePrev:null,velocity:new j.Vector2(0,0),mBlurVelInf:new j.Vector2(2*this.screenRes.x,2*this.screenRes.y),prevDeltaPos:[0,0,0],endPos:null,latchMatrix:null,netDistance:new j.Vector2(0,0),netDistYPerc:0,curDistance:new j.Vector2(0,0),curFadeOut:new j.Vector2(0,0),curStepDistance:new j.Vector2(0,0),initialQuat:new j.Quaternion,releaseTime:0},this.subscriptableEvents=["keydown","keyup","resize"],this.callbackList={},this.init()}setDependencies(pxlNav){this.pxlEnv=pxlNav.pxlEnv,this.pxlTimer=pxlNav.pxlTimer,this.pxlAudio=pxlNav.pxlAudio,this.pxlUser=pxlNav.pxlUser,this.pxlCamera=pxlNav.pxlCamera,this.pxlAutoCam=pxlNav.pxlAutoCam,this.pxlGuiDraws=pxlNav.pxlGuiDraws,this.pxlQuality=pxlNav.pxlQuality}init(){this.setGammaCorrection();var u=this;document.addEventListener("mousedown",(d=>{u.onmousedown(u,d)}),!1),document.addEventListener("mousemove",(d=>{u.onmousemove(u,d)}),!1),document.addEventListener("mouseup",(d=>{u.onmouseup(u,d)}),!1),document.addEventListener("contextmenu",(d=>{u.oncontextmenu(d)}),!1),window.addEventListener("resize",(d=>{u.resizeRenderResolution()}),!1),document.addEventListener("touchstart",(function(d){u.touchstart(u,d)}),{passive:!0}),document.addEventListener("touchmove",(function(d){u.touchmove(u,d)}),{passive:!0}),document.addEventListener("touchend",(function(d){u.touchend(u,d)}),{passive:!0}),document.onkeydown=d=>{u.onkeydown(u,d)},document.onkeyup=d=>{u.onkeyup(u,d)};var d=this;document.addEventListener("visibilitychange",(function(u){d.windowHidden=document.hidden,d.directionKeysPressed=[0,0,0,0],d.directionKeyDown=!1,d.shiftBoost=1,d.pxlCamera.workerFunc("focus",!document.hidden),d.runHiddenCalcs()})),"object"==typeof window.onblur&&(window.onblur=u=>{d.resetUserInput(u)}),window.addEventListener("beforeunload",(u=>{if(1==d.controlKey)return u.preventDefault(),u.returnValue="Close tab?",d.controlKey=!1,d.mapLockCursor(!1,0),"Close tab?"}))}setGammaCorrection(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null!=u)return this.gammaCorrection.x=1/u,this.gammaCorrection.y=u,void(this.gammaCorrection.z=u);var d=1.5,v=1.1,x=1.2,y=.5;if(window&&window.navigator&&window.navigator.userAgent){var b=window.navigator.userAgent.match(/(windows|win32|win64|wince)/i);if(b&&b.length>0)d=2.2,v=.95,x=1,y=0;else{var _=window.navigator.userAgent.match(/(macintosh|macintel|macppc|mac68k|iphone|ipad|ipod)/i);_&&_.length>0?(d=1.8,v=.9,x=.97,y=.1):(d=1.8,v=.7,x=.96,y=.1)}}this.gammaCorrection.x=1/d,this.gammaCorrection.y=x,this.gammaCorrection.z=y,this.lightShift.x=v}runHiddenCalcs(){this.windowHidden&&setTimeout((()=>{this.runHiddenCalcs()}),100)}resetUserInput(u){this.directionKeysPressed=[0,0,0,0],this.directionKeyDown=!1,this.shiftBoost=1,this.mapLockCursor(!1,0),this.pxlCamera.camJumpKey(!1),this.pxlCamera.deviceKey("space",!1),this.touchMouseData.active&&(this.touchScreen?this.endTouch(u):this.mapOnUp(u))}onmousemove(u,d){u.mapOnMove(d)}onmousedown(u,d){u.mapOnDown(d)}onmouseup(u,d){u.mapOnUp(d)}oncontextmenu(u){return u.preventDefault(),!1}touchstart(u,d){u.startTouch(d)}touchmove(u,d){u.doTouch(d)}touchend(u,d){u.endTouch(d)}onkeydown(u,d){u.keyDownCall(d)}onkeyup(u,d){u.keyUpCall(d)}get active(){return this.inputActive}set active(u){this.inputActive=!!u}preventDefault(u){(u=u||window.event).preventDefault(u)&&u.preventDefault(u)(),u.returnValue=!1}setCursor(u){if(this.allowCursorSwap){if("activeLatch"==u)this.touchMouseData.button;document.body.style.cursor=u}}getMouseXY(u){if(this.mobile)try{touch=u.touches[0],this.mouseX=touch.pageX,this.mouseY=touch.pageY}catch(u){}else{var d=this.pxlQuality.settings.mouse?-1:1;this.cursorLockActive?(this.mouseX+=(u.movementX||u.mozMovementX||u.webkitMovementX||0)*d,this.mouseY+=(u.movementY||u.mozMovementY||u.webkitMovementY||0)*d):(this.mouseX=u.clientX,this.mouseY=u.clientY)}}mapLockCursor(){var u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1?arguments[1]:void 0;this.canCursorLock&&!this.mobile&&(2==d?(!u&&this.cursorRightButtonLockActive?this.cursorRightButtonLockActive=!1:u||this.cursorRightButtonLockActive||(this.cursorRightButtonLockActive=!0),u=u||this.cursorRightButtonLockActive):u||(this.cursorRightButtonLockActive=u),1==u?(this.pxlGuiDraws.pxlNavCanvas.focus(),this.pxlGuiDraws.pxlNavCanvas.requestPointerLock().catch((u=>{}))):document.pointerLockElement&&document.exitPointerLock(),this.cursorLockActive=u)}mapOnDown(u){var d=u.target;d.getAttribute&&d.getAttribute("id")==this.pxlCore&&this.pxlTimer.active&&(this.pxlGuiDraws.chatMessageInput&&this.pxlGuiDraws.chatMessageInput.blur(),this.pxlGuiDraws.pxlNavCanvas.focus(),this.preventDefault(u),this.touchMouseData.button=u.which,this.touchMouseData.active=!0,this.touchMouseData.mode=this.touchMouseData.button,this.touchMouseData.startPos=new j.Vector2(this.mouseX,this.mouseY),this.touchMouseData.endPos=new j.Vector2(this.mouseX,this.mouseY),this.touchMouseData.curDistance=new j.Vector2(0,0),this.touchMouseData.curStepDistance=new j.Vector2(0,0),this.touchMouseData.dragCount=0,this.pxlAutoCam.touchBlender=!1,this.setCursor("grabbing"),this.mapLockCursor(!0,u.button))}mapOnMove(u){var d=u.target;if(d.getAttribute&&d.getAttribute("id")==this.pxlCore&&this.pxlTimer.active||this.cursorLockActive)if(this.preventDefault(u),this.getMouseXY(u),(this.touchMouseData.active||this.cursorLockActive)&&this.touchMouseData.startPos){this.touchMouseData.dragCount++;var v=this.touchMouseData.endPos.clone();this.touchMouseData.endPos=new j.Vector2(this.mouseX,this.mouseY),this.touchMouseData.curDistance=this.touchMouseData.startPos.clone().sub(this.touchMouseData.endPos),this.touchMouseData.curStepDistance=this.touchMouseData.endPos.clone().sub(v),this.touchMouseData.netDistance.add(this.touchMouseData.curStepDistance.clone());this.touchMouseData.velocity.clone();this.touchMouseData.velocity=this.touchMouseData.velocity.clone().multiplyScalar(3).add(this.touchMouseData.curStepDistance).multiplyScalar(.25),this.touchMouseData.netDistYPerc=8e-4*(this.touchMouseData.netDistance.y+this.touchMouseData.curDistance.y+250),this.touchMouseData.curFadeOut.add(v.sub(this.touchMouseData.endPos))}else this.pxlEnv.hoverUserDetect()}mapOnUp(u){var d=u.target;if(this.pxlAudio.djVolumeParentObj&&(this.pxlAudio.djVolumeParentObj.down=!1),d.getAttribute&&d.getAttribute("id")==this.pxlCore){if(this.pxlGuiDraws.checkFocus(d.getAttribute("id"),!0),!this.mobile)return this.preventDefault(u),this.touchMouseData.dragCount++,this.touchMouseData.dragTotal+=this.touchMouseData.dragCount,this.touchMouseData.active=!1,this.touchMouseData.releaseTime=this.pxlTimer.curMS,this.pxlAutoCam.touchBlender=!0,this.pxlAutoCam.setNextTrigger(),this.touchMouseData.dragCount<9&&this.pxlEnv.clickUserDetect(),this.touchMouseData.endPos=new j.Vector2(this.mouseX,this.mouseY),this.touchMouseData.netDistYPerc=(this.touchMouseData.netDistance.y+250)/1250,this.setCursor("grab"),this.mapLockCursor(!1,u.button),u.preventDefault(),!1;this.pxlAutoCam.getNextPath(!1,1)}}startTouch(u){var d=u.target;if(d.getAttribute&&d.getAttribute("id")==this.pxlCore&&this.pxlTimer.active){this.touchScreen=!0;var v=u.touches[0];this.mouseX=v.pageX,this.mouseY=v.pageY,this.touchMouseData.active=!0,this.touchMouseData.mode=this.touchMouseData.button,this.touchMouseData.startPos=new j.Vector2(this.mouseX,this.mouseY),this.touchMouseData.endPos=new j.Vector2(this.mouseX,this.mouseY),this.touchMouseData.curDistance=new j.Vector2(0,0),this.touchMouseData.curStepDistance=new j.Vector2(0,0),this.touchMouseData.dragCount=0,this.pxlAutoCam.touchBlender=!1,this.touchMouseData.releaseTime=this.pxlTimer.curMS;var x=d.getAttribute("id");if(this.objectPercList.includes(x)){"djPlayerVolume"==x&&(x=(d=this.pxlAudio.djVolumeParentObj).getAttribute("id"));var y=d.getBoundingClientRect();this.objectPerc.active=!0,this.objectPerc.object=d,this.objectPerc.left=y.left,this.objectPerc.top=y.top,this.objectPerc.width=y.width,this.objectPerc.height=y.height,this.objectPerc.startX=this.mouseX-y.left,this.objectPerc.startY=this.mouseY-y.top,this.objectPerc.percX=(this.mouseX-this.objectPerc.left)/this.objectPerc.width,this.objectPerc.percY=(this.mouseY-this.objectPerc.top)/this.objectPerc.height,this.objectPerc.offsetX=0,this.objectPerc.offsetY=0,this.objectPerc.offsetPercX=0,this.objectPerc.offsetPercY=0,this.objectPercFuncList[x]&&this.objectPercFuncList[x](u)}}}doTouch(u){if(this.touchMouseData.active){u.target;var d=u.touches[0];if(this.mouseX=d.pageX,this.mouseY=d.pageY,this.touchMouseData.active){if(this.touchMouseData.dragCount++,void 0!==u.touches[1]){u.touches[1];return void(u.touches.length>1&&this.touchMouseData.dragCount>10&&(this.touchMouseData.lock=!0,d=u.touches[1],this.pxlEnv.setFogHue([this.mouseX,this.mouseY],[d.pageX,d.pageY])))}var v=this.touchMouseData.endPos.clone();this.touchMouseData.endPos=new j.Vector2(this.mouseX,this.mouseY),this.touchMouseData.curDistance=this.touchMouseData.startPos.clone().sub(this.touchMouseData.endPos),this.touchMouseData.curStepDistance=this.touchMouseData.endPos.clone().sub(v),this.touchMouseData.netDistance.add(this.touchMouseData.curStepDistance.clone()),this.touchMouseData.velocity.add(this.touchMouseData.curStepDistance).multiplyScalar(.5),this.touchMouseData.velocityEase.add(this.touchMouseData.curStepDistance).multiplyScalar(.5),this.touchMouseData.netDistYPerc=(this.touchMouseData.netDistance.y+this.touchMouseData.curDistance.y+250)/1250,this.touchMouseData.curFadeOut.add(v.sub(this.touchMouseData.endPos))}this.objectPerc.active&&(this.objectPerc.percX=(this.mouseX-this.objectPerc.left)/this.objectPerc.width,this.objectPerc.percY=(this.mouseY-this.objectPerc.top)/this.objectPerc.height,this.objectPerc.offsetX=this.mouseX-this.objectPerc.startX,this.objectPerc.offsetY=this.mouseY-this.objectPerc.startY,this.objectPerc.offsetPercX=this.objectPerc.offsetX/this.objectPerc.width,this.objectPerc.offsetPercY=this.objectPerc.offsetY/this.objectPerc.height)}}endTouch(u){if(this.touchMouseData.active)if(this.touchScreen=!1,this.touchMouseData.dragCount++,this.touchMouseData.dragTotal+=this.touchMouseData.dragCount,this.touchMouseData.active=!1,this.touchMouseData.endPos=new j.Vector2(this.mouseX,this.mouseY),this.touchMouseData.netDistYPerc=(this.touchMouseData.netDistance.y+250)/1250,this.touchMouseData.curDistance.multiplyScalar(0),this.touchMouseData.curStepDistance.multiplyScalar(0),this.touchMouseData.releaseTime=this.pxlTimer.curMS,this.touchMouseData.lock)this.touchMouseData.lock=!1;else{this.pxlAutoCam.touchBlender=!0,this.pxlAutoCam.setNextTrigger();var d=u.target;this.touchMouseData.dragCount<10&&d.getAttribute&&d.getAttribute("id")==this.pxlCore&&this.pxlAutoCam.getNextPath(!1,0),this.objectPerc.active=!1,this.pxlAudio.djVolumeParentObj&&(this.pxlAudio.djVolumeParentObj.down=!1)}}keyDownCall(u){var d=this;return pxlNav_Device_asyncToGenerator((function*(){if(d.emit("keydown",u),u.ctrlKey&&(d.controlKey=!0),null==document.activeElement.type&&d.pxlTimer.active){if(u.repeat)return;var v=u.keyCode||u.which;37!=v&&65!=v||(d.directionKeyDown=!0,d.keyDownCount[0]=d.pxlQuality.fpsCounter.z,d.directionKeysPressed[0]=1,d.pxlCamera.deviceKey(0,!0)),u.ctrlKey&&87==v&&1==d.directionKeysPressed[1]&&u.this.preventDefault(u)(),38!=v&&87!=v||(d.directionKeyDown=!0,d.keyDownCount[1]=d.pxlQuality.fpsCounter.z,d.directionKeysPressed[1]=1,d.pxlCamera.deviceKey(1,!0)),39!=v&&68!=v||(d.directionKeyDown=!0,d.keyDownCount[0]=d.pxlQuality.fpsCounter.z,d.directionKeysPressed[2]=1,d.pxlCamera.deviceKey(2,!0)),40!=v&&83!=v||(d.directionKeyDown=!0,d.keyDownCount[1]=d.pxlQuality.fpsCounter.z,d.directionKeysPressed[3]=1,d.pxlCamera.deviceKey(3,!0)),16!=v&&224!=v||(d.shiftBoost=7,d.pxlCamera.deviceKey("shift",!0)),32==v&&(d.pxlCamera.camJumpKey(!0),d.pxlCamera.deviceKey("space",!0))}}))()}keyUpCall(u){var d=this;return pxlNav_Device_asyncToGenerator((function*(){if(d.emit("keyup",u),u.ctrlKey)return d.controlKey=!1,u.preventDefault(),!1;if(null==document.activeElement.type){var v=u.keyCode||u.which,x=u.code||u.which;if(!u.isTrusted)return!1;if(u.ctrlKey||u.altKey||u.code.includes("F"))return u.preventDefault(),!1;if("Backquote"==x)return void d.pxlGuiDraws.guiToggleVisibility();if(89==v&&d.pxlGuiDraws.toggleShaderEditor(),220==v){console.log("Saving screenshot");var y=d.pxlQuality.screenResPerc;d.pxlQuality.screenResPerc=1,d.pxlEnv.mapRender(!1);for(var b=d.pxlGuiDraws.pxlNavCanvas.toDataURL("image/png"),_=atob(b.split(",")[1]),w=_.length,S=new Uint8Array(w),C=0;C<w;++C)S[C]=_.charCodeAt(C);var P=URL.createObjectURL(new Blob([S])),A=new Date,T=A.getDate(),E=A.getMonth()+1,D=A.getFullYear()+"-"+E+"-"+T+"_"+A.getHours()+"-"+A.getMinutes()+"-"+A.getSeconds(),I=document.createElement("a");return I.download=d.projectTitle+"_"+D+".png",I.href=P,document.body.appendChild(I),I.click(),I.parentNode.removeChild(I),d.pxlQuality.screenResPerc=y,void d.pxlEnv.mapRender(!1)}if(d.pxlTimer.active){if(37!=v&&65!=v||(d.directionKeysPressed[0]=0,d.pxlCamera.deviceKey(0,!1)),38!=v&&87!=v||(d.directionKeysPressed[1]=0,d.pxlAutoCam.active&&d.pxlAutoCam.step(!0),d.pxlCamera.deviceKey(1,!1)),39!=v&&68!=v||(d.directionKeysPressed[2]=0,d.pxlCamera.deviceKey(2,!1)),40!=v&&83!=v||(d.directionKeysPressed[3]=0,d.pxlAutoCam.active&&d.pxlAutoCam.setRoom(!0),d.pxlCamera.deviceKey(3,!1)),d.directionKeysPressed.includes(1)||(d.directionKeyDown=!1),16==v||224==v)return d.shiftBoost=1,void d.pxlCamera.deviceKey("shift",!1);if(32==v)return d.pxlCamera.camJumpKey(!1),void d.pxlCamera.deviceKey("space",!1);if(!d.directionKeyDown){if(49==v||97==v)return void d.pxlCamera.fastTravel(0);if(50==v||98==v)return void d.pxlCamera.fastTravel(1);if(51==v||99==v)return void d.pxlCamera.fastTravel(2);if(52==v||100==v)return void d.pxlCamera.fastTravel(3);if(53==v||101==v)return void d.pxlAutoCam.preAutoCamToggle()}var k;if(221==v)return void((null===(k=d.pxlUser)||void 0===k||null===(k=k.itemInactiveCmd)||void 0===k?void 0:k.length)>0&&console.log(d.pxlUser.itemInactiveCmd.pop()))}if(27==v||13==v&&!u.ctrlKey)return d.pxlGuiDraws.toggleHudBlock(!1,!0),void d.pxlGuiDraws.toggleGuiWindowContainer(!1,!1,!0);if(u.altKey||u.ctrlKey||u.shiftKey)return;if(73==v)return void d.pxlGuiDraws.iconEvent("click",d.pxlGuiDraws.hudIcons.infoIcon,"info");if(71==v)return void d.pxlGuiDraws.iconEvent("click",d.pxlGuiDraws.hudIcons.settingsIcon,"settings");if(66==v)return void d.pxlGuiDraws.iconEvent("click",d.pxlGuiDraws.hudIcons.musicIcon,"musicToggle");if(78==v)return void d.pxlGuiDraws.iconEvent("click",d.pxlGuiDraws.hudIcons.speakerIcon,"speakerToggle");if(191==v)return void d.pxlGuiDraws.iconEvent("click",d.pxlGuiDraws.hudIcons.helpIcon,"help");if(80==v)return d.directionKeysPressed=[0,0,0,0],d.directionKeyDown=!1,d.pxlTimer.pause(),d.pxlTimer.active&&d.pxlEnv.mapRender(),void d.pxlCamera.workerFunc("activeToggle",d.pxlTimer.active)}}))()}resizeRenderResolution(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(u=u||window.innerWidth,d=d||window.innerHeight,this.mapW=(this.sW=u)*this.pxlQuality.screenResPerc,this.mapH=(this.sH=d)*this.pxlQuality.screenResPerc,this.screenRes.x=1/this.mapW,this.screenRes.y=1/this.mapH,this.screenRatio.x=this.sW/this.sH,this.screenRatio.y=this.sH/this.sW,this.pxlEnv.geoList.HDRView){var v=this.mapW>this.mapH?1:this.mapW/this.mapH;this.pxlEnv.geoList.HDRView.material.uniforms.ratioU.value=v}if(this.touchMouseData.mBlurVelInf=new j.Vector2(2*this.screenRes.x,2*this.screenRes.y),this.pxlEnv.mapGlowPass){this.pxlEnv.scene.renderTarget.setSize(this.mapW*this.pxlQuality.bufferPercMult,this.mapH*this.pxlQuality.bufferPercMult),this.pxlEnv.scene.renderWorldPos.setSize(this.mapW*this.pxlQuality.bufferPercMult,this.mapH*this.pxlQuality.bufferPercMult),this.pxlEnv.mapComposer.setSize(this.mapW,this.mapH),this.pxlEnv.mapComposerGlow.setSize(this.mapW,this.mapH),this.pxlEnv.roomComposer.setSize(this.mapW,this.mapH),this.pxlEnv.roomGlowPass.setSize(this.mapW*this.pxlQuality.bloomPercMult,this.mapH*this.pxlQuality.bloomPercMult),this.pxlEnv.delayComposer.setSize(this.mapW,this.mapH),this.pxlEnv.mapGlowPass.setSize(this.mapW*this.pxlQuality.bloomPercMult,this.mapH*this.pxlQuality.bloomPercMult),this.pxlEnv.mapMotionBlurPass.setSize(this.mapW*this.pxlQuality.mBlurPercMult,this.mapH*this.pxlQuality.mBlurPercMult),this.pxlEnv.mapOverlayHeavyPass.setSize(this.mapW,this.mapH),this.pxlEnv.mapOverlayPass.setSize(this.mapW,this.mapH),this.pxlEnv.mapOverlaySlimPass.setSize(this.mapW,this.mapH),this.pxlEnv.mapOverlayHeavyPass.uniforms.ratio.value=Math.min(1,this.mapW/this.mapH),this.pxlEnv.mapOverlayPass.uniforms.ratio.value=Math.min(1,this.mapW/this.mapH),this.pxlEnv.mapOverlaySlimPass.uniforms.ratio.value=Math.min(1,this.mapW/this.mapH),this.pxlGuiDraws.pxlNavCanvas.width=this.sW,this.pxlGuiDraws.pxlNavCanvas.height=this.sH,this.pxlGuiDraws.loading=!0,this.pxlEnv.engine.setPixelRatio(window.devicePixelRatio*this.pxlQuality.screenResPerc),this.pxlEnv.engine.setSize(this.sW,this.sH);var x=this.mapW/this.mapH;this.pxlCamera.camera.aspect=x,this.pxlCamera.camera.updateProjectionMatrix();var y=[this.sW/this.sH,this.sH/this.sW],b=[1,1];b[0]=x>y[0]?1:this.sW/(this.sH*y[0]),b[1]=x>y[1]?this.sH/(this.sW*y[1]):1,b[0]>1?(b[1]*=1/b[0],b[0]=1):b[1]>1&&(b[0]*=1/b[1],b[1]=1),this.screenAspect.x=b[0]*(1/.5**.5),this.screenAspect.y=b[1],this.screenResDeltaPerc.x=this.sW/this.origRes.x,this.screenResDeltaPerc.y=this.sH/this.origRes.y,this.pxlEnv.roomSubList.Lobby&&this.pxlEnv.roomSubList.Lobby.setShaders(),this.pxlEnv.updateCompUniforms(),this.pxlEnv.roomNameList.forEach((u=>{var d;this.pxlEnv.roomSceneList[u].pxlCamAspect=x,null!==(d=this.pxlEnv.roomSceneList[u])&&void 0!==d&&d.resize&&this.pxlEnv.roomSceneList[u].resize(this.mapW,this.mapH)})),this.emit("resize",{width:this.mapW,height:this.mapH,xPixelPerc:this.screenRes.x,yPixelPerc:this.screenRes.y,aspectRatio:x}),this.pxlTimer.active||this.pxlEnv.mapRender(!1)}}subscribe(u,d){this.subscriptableEvents.includes(u)?(this.callbackList[u]||(this.callbackList[u]=[]),this.callbackList[u].push(d)):console.error("Event type not subscribable: ",u)}unsubscribe(u,d){if(this.callbackList[u]){var v=this.callbackList[u].indexOf(d);v>=0&&this.callbackList[u].splice(v,1)}}emit(u,d){this.callbackList.hasOwnProperty(u)&&this.callbackList[u].forEach((u=>{u(d)}))}},Animation:class pxlNav_Animation{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.pxlEnv=null,this.assetPath=u,this.verbose=!1,this.animInitEntry={rig:null,mesh:null,mixer:null,clips:{},state:null,hasConnection:!1,prevTime:-1,connected:[],connections:{}},this.objNames=[],this.objects={},this.animMixer={},this.msRunner=d,this.clock=new j.Clock}setDependencies(u){this.pxlEnv=u}log(u){this.verbose&&console.log(u)}initObject(u,d){for(var v=null,x=null,y=d.children.length,b=0,_=[...d.children],w=0,S=0,C=0,P=0;b<y;){var A=_[b];switch(A.type){case"Bone":++S,v=A;break;case"Mesh":++w,A.visible=!1;break;case"SkinnedMesh":++C,x=A;break;case"Group":++P,y=(_=_.concat(A.children)).length}++b}var T=!1;if(v||(this.log("Error, No Bone/Rig Root Found; Please move your rig to the scene's root. Grouped rigs aren't supported yet."),T=!0),x||(this.log("Error, No SkinnedMesh Found; Please ensure your rig has a mesh to animate."),T=!0),T)return console.log("Unable to prepare '"+u+"' for animation"),console.log("Group Count: "+P),console.log("Bone Root Found : "+(S>0)),console.log("Bone Count : "+S),console.log("Mesh Count: "+w),void console.log("SkinnedMesh Count: "+C);if(!this.objNames.includes(u)){this.objNames.push(u);var E=Object.assign({},this.animInitEntry);E.rig=v,E.mesh=x,this.animMixer[u]=new j.AnimationMixer(v),E.mixer=this.animMixer[u],this.objects[u]=E;var D=new j.MeshStandardMaterial;D.map=x.material.map,x.material=D}}addClips(u,d,v){if(this.objNames.includes(u)){Object.keys(this.objects[u].clips).includes(d)&&this.log("Warning, '"+d+"' already exists in '"+u+"'");var x=this.animMixer[u].clipAction(v.animations[0]);this.objects[u].clips[d]=x}else this.log("Error, '"+u+"' not found in Animation Manager")}hasClip(u,d){return!!this.objNames.includes(u)&&Object.keys(this.objects[u].clips).includes(d)}getMixer(u){return this.objNames.includes(u)?this.animMixer[u]:null}getRig(u){return this.objNames.includes(u)?this.objects[u].rig:null}getMesh(u){return this.objNames.includes(u)?this.objects[u].mesh:null}playClip(u,d){if(this.objNames.includes(u)&&Object.keys(this.objects[u].clips).includes(d)){var v=this.objects[u].clips[d];this.objects[u].state=d,this.objects[u].prevTime=-1,this.objects[u].hasConnection=this.objects[u].connected.includes(d),this.setWeight(u,d,1,!0),v.reset(),v.play()}}setWeight(u,d,v){var x=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.objNames.includes(u)){var y=Object.keys(this.objects[u].clips);if(y.includes(d)){var b=this.objects[u].clips[d];b.enabled=!0,b.setEffectiveTimeScale(1),b.setEffectiveWeight(v),x&&y.forEach((v=>{if(v!=d){var x=this.objects[u].clips[v];x.enabled=!1,x.setEffectiveTimeScale(1),x.setEffectiveWeight(0)}}))}}}setStateConnections(u,d){if(this.objNames.includes(u)){var v=Object.keys(d);this.objects[u].connected=v,this.objects[u].connections=d}}step(u){if(this.objNames.includes(u)){if(!this.objects[u].hasConnection)return void this.animMixer[u].update(this.clock.getDelta());var d=this.objects[u].state;if(d){var v=this.objects[u].clips[d].time;if(this.objects[u].prevTime>v){var x=this.objects[u].connections[d],y=x[Math.floor(Math.random()*x.length)];this.playClip(u,y)}else this.animMixer[u].update(this.clock.getDelta()),this.objects[u].prevTime=v}else this.animMixer[u].update(this.clock.getDelta())}}destroy(u){if(this.objNames.includes(u)){this.animMixer[u].stopAllAction(),delete this.animMixer[u],delete this.objects[u];var d=this.objNames.indexOf(u);this.objNames.splice(d,1)}}},Environment:class pxlNav_Environment{constructor(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Default",v=arguments.length>2?arguments[2]:void 0;this.engine=null,this.scene=null,this.parentGroupList={},this.parentGroupList[d]=[],this.parentNameList=[],this.options=u,this.prevRenderMS=0,this.nextRenderMS=0,this.fps=v?30:60,this.renderInterval=1/this.fps;var x="Default";x=this.options.hasOwnProperty("pxlRoomName")?this.options.pxlRoomName:d,this.pxlRoomAbsRoot=x;var y=x.split("/");y.splice(0,1),y=y.join("/"),this.pxlRoomLclRoot=x,this.options.hasOwnProperty("pxlRoomRoot")?this.pxlRoomLclRoot=this.options.pxlRoomRoot:this.pxlRoomLclRoot="./"+x.split("/").pop(),this.mainRoom=d,this.bootRoom=d,this.bootLocation=null,this.currentRoom=d,this.roomNameList=[d],this.roomSubList={},this.roomSceneList={},this.roomSceneList[d]=this,this.roomPostGuiCalls=[],this.jmaCheckConnection=!1,this.checkContext=0,this.activeContext=!1,this.warpPortalTextures={},this.warpZoneRenderTarget=null,this.currentAudioZone=0,this.pxlUtils=null,this.pxlTimer=null,this.pxlAnim=null,this.pxlAutoCam=null,this.pxlAudio=null,this.pxlFile=null,this.pxlVideo=null,this.pxlQuality=null,this.pxlUser=null,this.pxlShaders=null,this.pxlDevice=null,this.pxlCamera=null,this.pxlGuiDraws=null,this.renderLayerEnum={SCENE:0,PARTICLES:1,GLOW:2,SKY:3},this.cloud3dTexture=null,this.softNoiseTexture=null,this.detailNoiseTexture=null,this.chroAberUVTexture=null,this.blockAnimTexture=null,this.userScreenIntensity=new j.Vector2(0,.8),this.portaluserScreenIntensity=new j.Vector2(1,0),this.portalMtlRate=.7,this.mobile=v,this.camNear=.1,this.camFar=5e3,this.fogMult=new j.Vector2(0,0),this.fogColor=new j.Color(.07,.07,.1),this.fogColorSky=new j.Color(.1,.1,.12),this.fogExp=3e-4,this.fog=new j.FogExp2(this.fogColor,this.fogExp),this.listener=null,this.posted=!1,this.postIntro=!1,this.camLocation={},this.camInitPos=new j.Vector3(0,15,0),this.camInitLookAt=new j.Vector3(0,15,0),this.camThumbPos=new j.Vector3(0,0,0),this.camThumbLookAt=new j.Vector3(0,20,0),this.camReturnPos=new j.Vector3(0,0,0),this.camReturnLookAt=new j.Vector3(0,0,0),this.camLobbyPos=new j.Vector3(0,15,0),this.camLobbyLookAt=new j.Vector3(0,15,-100),this.pxlCamFOV=v?80:60,this.pxlCamZoom=1,this.pxlCamAspect=1,this.pxlCamNearClipping=this.camNear,this.pxlCamFarClipping=this.camFar,this.groupList=[],this.geoList=[],this.geoLoadList=[],this.geoLoadListComplete=0,this.lightList=[],this.returnPortalGlowList=[],this.roomWarpVisuals={},this.proximityGeo=null,this.userAvatarGroup=new j.Group,this.warpVisualActive=!1,this.warpVisualMaxTime=[1.5,1],this.warpVisualStartTime=0,this.warpVisualFader=new j.Vector2(0,1),this.warpVisualCmd=null,this.stepShaderFuncArr=[],this.mapMotionBlurPass=null,this.mapCopyMotionBlurPass=null,this.mapOverlayHeavyPass=null,this.mapOverlayPass=null,this.mapOverlaySlimPass=null,this.mapBoxAAPass=null,this.mapCrossAAPass=null,this.mapWorldPosMaterial=null,this.mapGlowPass=null,this.mapGlowMotionBlur=null,this.mapComposer=null,this.mapComposerMotionBlur=null,this.mapComposerBloom=null,this.mapComposerGlow=null,this.chroAberrationPass=null,this.chroAberrationRoomPass=null,this.lizardKingPass=null,this.lizardKingRoomPass=null,this.mapComposerWarpPass=null,this.blurScreenMerge=null,this.pxlRenderSettings={exposure:1,mult:1,bloomStrength:.5,bloomThresh:.6,bloomRadius:.05},this.exposureShiftActive=!1,this.delayComposer=null,this.delayPass=null,this.chroAberMult=new j.Vector2(1,0),this.blurDirCur=new j.Vector2(0,0),this.blurDirPrev=new j.Vector2(0,0),this.shaderPasses={},this.roomComposer=null,this.roomRenderPass=null,this.roomBloomPass=null,this.roomGlowPass=null,this.blurComposer=null,this.glowPassMask=new j.Vector2(1,0),this.objectClickable=[],this.objectClickableObjectList={},this.clickablePrevActiveObject=null,this.promoClickable=[],this.promoClickableObjectList={},this.promoPrevActiveObject=null,this.promoClickableLinks={},this.remoteVideoTextureList=[],this.remoteUserNameList=[],this.remoteUserMediaList={},this.remoteUserVideoList=[],this.remoteUserAudioList=[],this.camScreenData={count:0,prevCount:0,checkUserCount:!0,checkVideoStatus:!0,findCamCount:()=>{},videoObjectList:[],screenGeoList:[],screenClickable:[],screenMtlUniforms:[],userDataList:[],camFindInfoList:[]},this.curUserCount=0,this.prevUserCount=0,this.emit=(u,d)=>{}}setDependencies(pxlNav){this.scene=pxlNav.scene,this.pxlUtils=pxlNav.pxlUtils,this.pxlTimer=pxlNav.pxlTimer,this.pxlAnim=pxlNav.pxlAnim,this.pxlAutoCam=pxlNav.pxlAutoCam,this.pxlAudio=pxlNav.pxlAudio,this.pxlFile=pxlNav.pxlFile,this.pxlVideo=pxlNav.pxlVideo,this.pxlQuality=pxlNav.pxlQuality,this.pxlUser=pxlNav.pxlUser,this.pxlShaders=pxlNav.pxlShaders,this.pxlDevice=pxlNav.pxlDevice,this.pxlCamera=pxlNav.pxlCamera,this.pxlGuiDraws=pxlNav.pxlGuiDraws,this.emit=pxlNav.emit.bind(pxlNav)}log(u){this.options.verbose>Bs.INFO&&console.log(u)}init(){var u=Object.keys(this.options);Object.keys(js).forEach((d=>{u.includes(d)||(this.options[d]=js[d])})),Object.keys(this.roomSubList).forEach((u=>{this.roomSubList[u].init()}))}boot(){}setBootRoom(u,d){console.log(u,d),this.bootRoom=u,this.bootLocation=d}postBoot(){this.pxlGuiDraws.togglePageDisplay(),this.roomSceneList[this.bootRoom].start(),this.posted=!0}postHelpIntro(){this.pxlDevice.mobile||this.pxlAutoCam.enabled?(this.pxlCamera.colliderValid=!0,this.pxlCamera.eventCheckStatus=!0,this.pxlCamera.colliderShiftActive=!0,this.pxlCamera.nearestFloorObjName="mobile",this.pxlCamera.colliderCurObjHit="AudioTrigger_2",this.pxlCamera.proximityScaleTrigger=!0,this.exposureShiftActive=!0,this.pxlDevice.mobile||(this.pxlAudio.play(),setTimeout((()=>{this.pxlAudio.initPlay()}),100))):this.pxlCamera.jogServerMemory(),this.postIntro=!0}start(){this.init()}step(){if(this.pxlTimer.step(),this.pxlAudio.step(),this.pxlQuality.step(),this.pxlAutoCam.step()&&this.pxlCamera.step(),this.pxlGuiDraws.step(),this.stepWarpPass(),this.pxlTimer.msRunner.x>this.checkContext&&this.activeContext){this.checkContext=this.pxlTimer.msRunner.x+1;var u=document.createElement("canvas");try{u.getContext("webgl")}catch(u){this.activeContext=!0,this.pxlGuiDraws.pxlNavCanvas.style.display="none"}}this.pxlDevice.mobile&&this.exposureShiftActive}stop(){var u=this;return function pxlNav_Environment_asyncToGenerator(u){return function(){var d=this,v=arguments;return new Promise((function(x,y){var b=u.apply(d,v);function _next(u){pxlNav_Environment_asyncGeneratorStep(b,x,y,_next,_throw,"next",u)}function _throw(u){pxlNav_Environment_asyncGeneratorStep(b,x,y,_next,_throw,"throw",u)}_next(void 0)}))}}((function*(){u.setExposure(0),Object.keys(u.roomSubList).forEach((d=>{u.roomSubList[d].stop()}))}))()}loadRoom(u){return new Promise(((d,v)=>{this.log("Loading Room - ",u);var x="".concat(this.pxlRoomLclRoot,"/").concat(u,"/").concat(u,".js");import(x).then((v=>{var x=new v[u](u,"".concat(this.pxlRoomLclRoot,"/").concat(u,"/"),this.pxlFile,this.pxlAnim,this.pxlUtils,this.pxlDevice,this,this.pxlTimer.msRunner,null,null,this.cloud3dTexture);x.camera=this.pxlCamera.camera,x.scene=new j.Scene,x.userAvatarGroup||(x.userAvatarGroup=new j.Group),x.scene.add(x.userAvatarGroup);var y={format:j.RGBAFormat,antialias:!1,sortObjects:!0,alpha:!0,type:/(iPad|iPhone|iPod)/g.test(navigator.userAgent)?HalfFloatType:j.FloatType};x.scene.renderTarget=new j.WebGLRenderTarget(this.pxlDevice.sW*this.pxlQuality.screenResPerc,this.pxlDevice.sH*this.pxlQuality.screenResPerc,y),x.scene.renderTarget.texture.format=j.RGBAFormat,x.scene.renderTarget.texture.minFilter=j.LinearFilter,x.scene.renderTarget.texture.magFilter=j.LinearFilter,x.scene.renderTarget.texture.generateMipmaps=!1,x.scene.renderTarget.depthBuffer=!0,x.scene.renderTarget.depthTexture=new j.DepthTexture(this.pxlDevice.sW*this.pxlQuality.screenResPerc,this.pxlDevice.sH*this.pxlQuality.screenResPerc),x.scene.renderTarget.depthTexture.format=j.DepthFormat,x.scene.renderTarget.depthTexture.type=j.UnsignedShortType,x.cloud3dTexture=this.cloud3dTexture,this.roomNameList.includes(u)||this.roomNameList.push(u),this.roomSceneList[u]=x,d(!0)}))}))}startAllRooms(){this.roomNameList.forEach((u=>{this.startRoom(this.roomSceneList[u])}))}startRoom(u){u.active=!1,u.startTime=this.pxlTimer.msRunner.x}newSubRoom(u){this.roomSubList[u.roomName]=u}addToRooms(u){var d={};return this.roomNameList.forEach((v=>{var x=u.clone();this.roomSceneList[v].scene.add(x),d[v]=x})),d}addToRoomLayers(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,v={};return this.roomNameList.forEach((x=>{var y=u.clone();this.roomSceneList[x].scene.add(y),v[x]=y,y.layers.set(d)})),v}addToRoomParents(u,d){var v={};return this.parentNameList.includes(d)||this.parentNameList.push(d),this.roomNameList.forEach((x=>{var y=u.clone();if(this.parentGroupList[x]||(this.parentGroupList[x]={}),!this.parentGroupList[x][d]){var b=new j.Group;this.parentGroupList[x][d]=b,this.roomSceneList[x].scene.add(b)}this.parentGroupList[x][d].add(y),v[x]=y})),v}buildRoomEnvironments(){this.log("Building Room Environments"),this.log(this.roomNameList);this.roomNameList.forEach((u=>{this.roomSceneList[u].init(),this.roomSceneList[u].build&&this.roomSceneList[u].build()}))}getArtistInfo(){return null}setFogHue(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0],d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1],v=(this.fog.color.getHSL(),[d[0]-u[0],d[1]-u[1]]),x=Math.abs(.3183098861837907*Math.atan2(v[0],v[1])),y=(v[0]**2+v[1]**2)**.5/Math.max(this.pxlDevice.sW,this.pxlDevice.sH);this.fog.color.setHSL(x,.5*y+.3,.5*y),this.roomSceneList[this.currentRoom]&&this.roomSceneList[this.currentRoom].setFog&&this.roomSceneList[this.currentRoom].setFog(this.fog.color)}readShader(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if("script_fog"==u){if(this.pxlGuiDraws.guiWindows.shaderGui.currentShader=u,1==this.mapOverlayHeavyPass.enabled)return this.mapOverlayHeavyPass.material;if(1==this.mapOverlayPass.enabled)return this.mapOverlayPass.material;if(1==this.mapOverlaySlimPass.enabled)return this.mapOverlaySlimPass.material}else{if("script_dArrows"==u)return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=u,this.geoList.dArrows[0].material;if("script_userScreens"==u)return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=u,this.camScreenData.screenGeoList[0].material;if("script_warpZonePortals"==u)return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=u,this.returnPortalGlowList[0].material;if("script_lizardking"==u)return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=u,this.lizardKingPass.material;if("script_majorTom"==u)return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=u,this.pxlUser.sFieldPass.material;if("script_fractalSubstrate"==u)return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=u,this.pxlUser.iZoomPass.material;if("script_fractalEcho"==u)return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=u,this.delayPass.material;var d=u.split("_");if(d.shift(),d=d.join("_"),this.geoList[d])return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=u,this.geoList[d].material}}setShader(u,d,v){var x,y=this.pxlGuiDraws.guiWindows.shaderGui.currentShader;if("script_fog"==y)1==this.mapOverlayHeavyPass.enabled?x=this.mapOverlayHeavyPass.material:1==this.mapOverlayPass.enabled?x=this.mapOverlayPass.material:1==this.mapOverlaySlimPass.enabled&&(x=this.mapOverlaySlimPass.material);else{if("script_dArrows"==y)return void this.geoList.dArrows.forEach((u=>{(x=u.material).vertexShader=d,x.fragmentShader=v,x.needsUpdate=!0}));if("script_userScreens"==y)return void this.camScreenData.screenGeoList.forEach((u=>{(x=u.material).vertexShader=d,x.fragmentShader=v,x.needsUpdate=!0}));if("script_warpZonePortals"==y)return void this.returnPortalGlowList.forEach((u=>{(x=u.material).vertexShader=d,x.fragmentShader=v,x.needsUpdate=!0}));if("script_lizardking"==y)x=this.lizardKingPass.material;else if("script_majorTom"==y)x=this.pxlUser.sFieldPass.material;else if("script_fractalSubstrate"==y)x=this.pxlUser.iZoomPass.material;else if("script_fractalEcho"==y)x=this.delayPass.material;else{var b=y.split("_");b.shift(),b=b.join("_"),this.geoList[b]&&(x=this.geoList[b].material)}}x&&(x.vertexShader=d,x.fragmentShader=v,x.needsUpdate=!0)}getAssetTexture(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.log("Get Internal Texture - ",u);var x=this.pxlUtils.assetRoot+u;if(!d){var y=u.split(".").pop().toLowerCase();"jpg"==y||"jpeg"==y?d=3:"png"==y&&(d=4)}return v||(v={encoding:j.LinearSRGBColorSpace,magFilter:j.LinearFilter,minFilter:j.LinearFilter}),this.pxlUtils.loadTexture(x,d,v)}buildSnow(){for(var u=new BufferGeometry,d=[],v=[],x=[],atlasGen=()=>.25*Math.floor(4e3*Math.random()%4),y=0;y<12e3;++y)d.push(0,0,0),v.push(Math.random(),Math.random(),2*Math.random()-1,.5*Math.random()+.5),x.push(atlasGen(),atlasGen());var b=new Float32BufferAttribute(d,3),_=new Float32BufferAttribute(v,4),w=new Float32BufferAttribute(x,2);u.setAttribute("position",b),u.setAttribute("seeds",_),u.setAttribute("atlas",w);var S={snowTexture:{type:"t",value:this.pxlUtils.loadTexture(this.pxlUtils.assetRoot+"snow.jpg",1,{encoding:j.LinearSRGBColorSpace,magFilter:NearestFilter,minFilter:NearestMipmapNearestFilter})},pointScale:{type:"f",value:12*this.pxlQuality.screenResPerc},intensity:{type:"f",value:1},rate:{type:"f",value:.035}};console.log(this.pxlShaders.particles);var C=this.pxlFile.pxlShaderBuilder(S,this.pxlShaders.particles.snowVert(this.mobile),this.pxlShaders.particles.snowFrag());C.side=DoubleSide,C.transparent=!0,C.blending=AdditiveBlending,C.depthTest=!0,C.depthWrite=!1;var P=new Points(u,C);P.sortParticles=!1,P.frustumCulled=!1,this.scene.add(P),P.layers.set(1),P.pBaseScale=12,this.geoList.snow=P}buildBackgroundObject(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=new PlaneBufferGeometry,y={};Object.assign(y,u),null!=d&&"string"==typeof d||(d=this.pxlShaders.scene.bgScreenVert()),null!=v&&"string"==typeof v||(v=this.pxlShaders.scene.bgScreenFrag());var b=this.pxlFile.pxlShaderBuilder(y,d,v);b.side=DoubleSide,b.depthTest=!0,b.depthWrite=!1;var _=new Mesh(x,b);return _.frustumCulled=!1,_}clickUserDetect(){if(this.roomSceneList[this.currentRoom].castRay&&this.roomSceneList[this.currentRoom].castRay(!0,this.pxlDevice.touchMouseData.button),!this.pxlDevice.mobile){var u=null,d=new j.Vector2(this.pxlDevice.mouseX/this.pxlDevice.sW*2-1,-this.pxlDevice.mouseY/this.pxlDevice.sH*2+1);this.pxlCamera.objRaycast.setFromCamera(d,this.pxlCamera.camera);var v=[];if(this.objectClickable.length>0&&(v=this.pxlCamera.objRaycast.intersectObjects(this.objectClickable)),v.length>0)for(var x=99999,y=0;y<v.length;++y){var b=(S=v[y]).distance;b<x&&(u=S.object,x=Math.min(x,b))}u&&this.clickableActions(u.name);var _=null;if(this.promoClickable.length>0&&(v=this.pxlCamera.objRaycast.intersectObjects(this.promoClickable)),v.length>0){var w=99999;for(y=0;y<v.length;++y){var S,C=(S=v[y]).distance;C<w&&(_=S.object,w=Math.min(w,C))}}_&&this.promoActions(_)}}clickableActions(){"CallToAction"==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)&&this.clickablePrevActiveObject&&(this.pxlGuiDraws.ctaBuildPopup(),this.objectClickableObjectList[this.clickablePrevActiveObject].Inactive.visible=!0,this.objectClickableObjectList[this.clickablePrevActiveObject].Hover.visible=!1,this.clickablePrevActiveObject=null)}promoActions(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=u.userData.video;u.name;this.promoClickableLinks.hasOwnProperty(d)&&window.open(this.promoClickableLinks[d],"_blank").focus()}hoverUserDetect(){this.roomSceneList[this.currentRoom].castRay&&this.roomSceneList[this.currentRoom].castRay(!1,this.pxlDevice.touchMouseData.button);var u=null,d=new j.Vector2(this.pxlDevice.mouseX/this.pxlDevice.sW*2-1,-this.pxlDevice.mouseY/this.pxlDevice.sH*2+1);this.pxlCamera.objRaycast.setFromCamera(d,this.pxlCamera.camera);var v=[];if(this.objectClickable.length>0&&(v=this.pxlCamera.objRaycast.intersectObjects(this.objectClickable)),v.length>0)for(var x=99999,y=0;y<v.length;++y){var b=(S=v[y]).distance;b<x&&(u=S.object,x=Math.min(x,b))}if(u)return this.pxlDevice.setCursor("help"),void(this.objectClickableObjectList[u.name]&&(null==this.clickablePrevActiveObject&&(this.clickablePrevActiveObject=u.name),this.objectClickableObjectList[u.name].Inactive.visible=!1,this.objectClickableObjectList[u.name].Hover.visible=!0));this.clickablePrevActiveObject&&(this.objectClickableObjectList[this.clickablePrevActiveObject].Inactive.visible=!0,this.objectClickableObjectList[this.clickablePrevActiveObject].Hover.visible=!1,this.clickablePrevActiveObject=null),this.pxlDevice.setCursor("grab");var _=null;if(this.promoClickable.length>0&&(v=this.pxlCamera.objRaycast.intersectObjects(this.promoClickable)),v.length>0){var w=99999;for(y=0;y<v.length;++y){var S,C=(S=v[y]).distance;C<w&&(_=S.object,w=Math.min(w,C))}}_?(this.pxlDevice.setCursor("alias"),this.promoClickableObjectList[_.name]&&(null==this.promoPrevActiveObject&&(this.promoPrevActiveObject=_.name),this.promoClickableObjectList[_.name].x=1)):(this.promoPrevActiveObject&&(this.promoClickableObjectList[this.promoPrevActiveObject].x=.1,this.promoPrevActiveObject=null),this.pxlDevice.setCursor("grab"))}updateCompUniforms(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;u&&(this.pxlRenderSettings.exposure=u*this.pxlRenderSettings.mult),this.mapOverlayPass&&(this.mapMotionBlurPass.uniforms.exposure.value=this.pxlRenderSettings.exposure,this.mapOverlayHeavyPass.uniforms.exposure.value=this.pxlRenderSettings.exposure,this.mapOverlayPass.uniforms.exposure.value=this.pxlRenderSettings.exposure,this.mapOverlaySlimPass.uniforms.exposure.value=this.pxlRenderSettings.exposure)}sendRoomMessage(u,d,v){this.roomSceneList[u]&&this.roomSceneList[u].onMessage(d,v)}buildComposers(){this.mapWorldPosMaterial=new j.ShaderMaterial({uniforms:{camNear:{type:"f",value:this.pxlCamera.camera.near},camFar:{type:"f",value:this.pxlCamera.camera.far}},vertexShader:this.pxlShaders.rendering.worldPositionVert(),fragmentShader:this.pxlShaders.rendering.worldPositionFrag()}),this.mapWorldPosMaterial.side=j.FrontSide,this.mapWorldPosMaterial.name="mapWorldPosMaterial",this.blurComposer=new zs.EffectComposer(this.engine),this.shaderPasses.blurXShaderPass=new Hs.ShaderPass(new j.ShaderMaterial({uniforms:{time:{value:this.time},tDiffuse:{value:null},pDiffuse:{value:null},resUV:{value:this.pxlDevice.screenRes}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.directionalBlurPass("pDiffuse",[1,0],4,1.8),defines:{}}),"tDiffuse"),this.shaderPasses.blurXShaderPass.material.uniforms.pDiffuse=this.scene.renderGlowTarget.texture,this.shaderPasses.blurXShaderPass.material.transparent=!0,this.shaderPasses.blurXShaderPass.needsSwap=!0,this.shaderPasses.blurXShaderPass.enabled=!1,this.shaderPasses.blurXShaderPass.name="blurXShaderPass",this.blurComposer.addPass(this.shaderPasses.blurXShaderPass),this.shaderPasses.dirBlurCopyPass=new Hs.ShaderPass(Ws.CopyShader),this.shaderPasses.dirBlurCopyPass.enabled=!1,this.shaderPasses.dirBlurCopyPass.name="dirBlurCopyPass",this.blurComposer.addPass(this.shaderPasses.dirBlurCopyPass),this.shaderPasses.blurYShaderPass=new Hs.ShaderPass(new j.ShaderMaterial({uniforms:{time:{value:this.time},tDiffuse:{value:null},pDiffuse:{value:null},resUV:{value:this.pxlDevice.screenRes}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.directionalBlurPass("pDiffuse",[0,1],4,1.3),defines:{}}),"tDiffuse"),this.shaderPasses.blurYShaderPass.material.uniforms.pDiffuse=this.scene.renderGlowTarget.texture,this.shaderPasses.blurYShaderPass.material.transparent=!0,this.shaderPasses.blurYShaderPass.enabled=!1,this.shaderPasses.blurYShaderPass.name="blurYShaderPass",this.blurComposer.addPass(this.shaderPasses.blurYShaderPass),this.shaderPasses.scatterMixShaderPass=new Hs.ShaderPass(new j.ShaderMaterial({uniforms:{time:{value:this.time},tDiffuse:{value:null},pDiffuse:{value:null},resUV:{value:this.pxlDevice.screenRes}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.mixBlurShaderPass(),defines:{}}),"tDiffuse"),this.shaderPasses.scatterMixShaderPass.material.uniforms.pDiffuse=this.scene.renderGlowTarget.texture,this.shaderPasses.scatterMixShaderPass.material.transparent=!0,this.shaderPasses.scatterMixShaderPass.enabled=!1,this.shaderPasses.scatterMixShaderPass.name="scatterMixShaderPass",this.blurComposer.addPass(this.shaderPasses.scatterMixShaderPass),this.options.antiAliasing==Vs.LOW?this.shaderPasses.scatterMixShaderPass.enabled=!0:this.options.antiAliasing==Vs.MEDIUM?(this.shaderPasses.blurXShaderPass.enabled=!0,this.shaderPasses.dirBlurCopyPass.enabled=!0,this.shaderPasses.blurYShaderPass.enabled=!0):this.options.antiAliasing==Vs.HIGH&&(this.shaderPasses.blurXShaderPass.enabled=!0,this.shaderPasses.dirBlurCopyPass.enabled=!0,this.shaderPasses.blurYShaderPass.enabled=!0,this.shaderPasses.scatterMixShaderPass.enabled=!0),this.mapComposerMotionBlur=new zs.EffectComposer(this.engine),this.mapMotionBlurPass=new Hs.ShaderPass(new j.ShaderMaterial({uniforms:{tDiffuse:{value:null},rDiffuse:{value:null},exposure:{type:"f",value:this.pxlRenderSettings.exposure},time:{value:this.pxlTimer.msRunner},camRotXYZ:{value:this.pxlCamera.camRotXYZ},blurDirCur:{type:"f",value:this.blurDirCur},blurDirPrev:{type:"f",value:this.blurDirPrev},noiseTexture:{value:this.cloud3dTexture}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.motionBlurPostProcess(this.pxlDevice.screenRes,this.pxlDevice.mobile),defines:{}}),"tDiffuse"),this.mapMotionBlurPass.material.uniforms.rDiffuse=this.scene.renderTarget.texture,this.mapMotionBlurPass.needsSwap=!0,this.mapMotionBlurPass.name="mapMotionBlurPass",this.mapComposerMotionBlur.addPass(this.mapMotionBlurPass),this.mapMotionBlurPass.enabled=!1,this.mapComposerMotionBlur.renderToScreen=!1,this.mapComposerGlow=new zs.EffectComposer(this.engine);var u=new Gs.RenderPass(this.scene,this.pxlCamera.camera);this.mapComposerGlow.addPass(u),this.blurScreenMerge=new Hs.ShaderPass(new j.ShaderMaterial({uniforms:{tDiffuse:{value:null},rDiffuse:{value:null},mtDiffuse:{value:null},exposure:{type:"f",value:this.pxlRenderSettings.exposure}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.compLayersPostProcess(),defines:{}}),"tDiffuse"),this.blurScreenMerge.material.uniforms.rDiffuse=this.scene.renderTarget.texture,this.blurScreenMerge.material.uniforms.mtDiffuse=this.scene.renderTarget.texture,this.blurScreenMerge.needsSwap=!0,this.blurScreenMerge.name="blurScreenMerge",this.mapComposerGlow.addPass(this.blurScreenMerge);var d=new Hs.ShaderPass(Ws.CopyShader);d.name="glowCopyPassBlur",this.mapComposerGlow.addPass(d),this.mapComposerGlow.renderToScreen=!1,this.mapComposerGlow.autoClear=!0,this.mapOverlayHeavyPass=new Hs.ShaderPass(new j.ShaderMaterial({uniforms:{gamma:{type:"f",value:this.pxlDevice.gammaCorrection},exposure:{type:"f",value:this.pxlRenderSettings.exposure},time:{value:this.pxlTimer.msRunner},camPos:{value:this.pxlCamera.camera.position},ratio:{type:"f",value:1},tDiffuse:{value:null},rDiffuse:{value:null},bloomTexture:{value:null},sceneDepth:{value:null},scenePos:{value:null},noiseTexture:{value:this.cloud3dTexture},fogMult:{value:this.fogMult},proximityMult:{value:1}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.finalOverlayHeavyShader(),defines:{}}),"tDiffuse"),this.mapOverlayHeavyPass.material.uniforms.rDiffuse=this.scene.renderTarget.texture,this.mapOverlayHeavyPass.material.uniforms.bloomTexture=this.mapComposerGlow.renderTarget2.texture,this.mapOverlayHeavyPass.material.uniforms.sceneDepth=this.scene.renderTarget.depthTexture,this.mapOverlayHeavyPass.material.uniforms.scenePos=this.scene.renderWorldPos.texture,this.mapOverlayHeavyPass.needsSwap=!0,this.mapOverlayHeavyPass.name="mapOverlayHeavyPass",this.mapOverlayPass=new Hs.ShaderPass(new j.ShaderMaterial({uniforms:{gamma:{type:"f",value:this.pxlDevice.gammaCorrection},exposure:{type:"f",value:this.pxlRenderSettings.exposure},time:{value:this.pxlTimer.msRunner},camPos:{value:this.pxlCamera.camera.position},ratio:{type:"f",value:1},tDiffuse:{value:null},rDiffuse:{value:null},bloomTexture:{value:null},sceneDepth:{value:null},scenePos:{value:null},noiseTexture:{value:this.cloud3dTexture},fogMult:{value:this.fogMult},proximityMult:{value:1}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.finalOverlayShader(),defines:{}}),"tDiffuse"),this.mapOverlayPass.material.uniforms.rDiffuse=this.scene.renderTarget.texture,this.mapOverlayPass.material.uniforms.bloomTexture=this.mapComposerGlow.renderTarget2.texture,this.mapOverlayPass.material.uniforms.sceneDepth=this.scene.renderTarget.depthTexture,this.mapOverlayPass.material.uniforms.scenePos=this.scene.renderWorldPos.texture,this.mapOverlayPass.needsSwap=!0,this.mapOverlayPass.name="mapOverlayPass",this.mapOverlaySlimPass=new Hs.ShaderPass(new j.ShaderMaterial({uniforms:{gamma:{type:"f",value:this.pxlDevice.gammaCorrection},exposure:{type:"f",value:this.pxlRenderSettings.exposure},time:{value:this.pxlTimer.msRunner},camPos:{value:this.pxlCamera.camera.position},ratio:{type:"f",value:1},tDiffuse:{value:null},rDiffuse:{value:null},bloomTexture:{value:null},sceneDepth:{value:null},fogMult:{value:this.fogMult},proximityMult:{value:1}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.finalOverlaySlimShader(),defines:{}}),"tDiffuse"),this.mapOverlaySlimPass.material.uniforms.rDiffuse=this.scene.renderTarget.texture,this.mapOverlaySlimPass.material.uniforms.bloomTexture=this.mapComposerGlow.renderTarget2.texture,this.mapOverlaySlimPass.material.uniforms.sceneDepth=this.scene.renderTarget.depthTexture,this.mapOverlaySlimPass.needsSwap=!0,this.mapOverlaySlimPass.name="mapOverlaySlimPass",this.mapGlowPass=new Hs.ShaderPass(new j.ShaderMaterial({uniforms:{time:{value:this.pxlTimer.msRunner},ratio:{type:"f",value:1},tDiffuse:{value:null},rDiffuse:{value:null},sceneDepth:{value:null}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.glowPassPostProcess(),defines:{}}),"tDiffuse"),this.mapGlowPass.material.uniforms.rDiffuse=this.scene.renderGlowTarget.texture,this.mapGlowPass.material.uniforms.sceneDepth=this.scene.renderTarget.depthTexture,this.mapGlowPass.needsSwap=!0,this.mapGlowPass.name="mapGlowPass",this.mapComposer=new zs.EffectComposer(this.engine),this.mapComposer.addPass(this.mapOverlayHeavyPass),this.mapComposer.addPass(this.mapOverlayPass),this.mapComposer.addPass(this.mapOverlaySlimPass),this.mapComposer.addPass(this.mapGlowPass),this.mapOverlayHeavyPass.enabled=!1,this.mapOverlayPass.enabled=!1,this.pxlUser.lKingWarp=new j.Vector2(...this.pxlUser.lKingInactive),this.lizardKingPass=new Hs.ShaderPass(new j.ShaderMaterial({uniforms:{tDiffuse:{value:null},time:{value:this.pxlTimer.msRunner},ratio:{value:this.pxlDevice.screenRes},noiseTexture:{value:this.cloud3dTexture}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.lKingPostProcess(),defines:{}}),"tDiffuse"),this.pxlUser.lKingPass=this.lizardKingPass,this.lizardKingPass.enabled=!1,this.pxlUser.lKingPass.name="lizardKingPass",this.pxlUser.sFieldPass=new Hs.ShaderPass(new j.ShaderMaterial({uniforms:{tDiffuse:{value:null},time:{value:this.pxlTimer.msRunner},ratio:{value:this.pxlDevice.screenRes},noiseTexture:{value:this.cloud3dTexture},starTexture:{value:this.pxlUtils.loadTexture(this.pxlUtils.assetRoot+"uv_starNoise.jpg",null,{encoding:j.LinearSRGBColorSpace})}},vertexShader:this.pxlShaders.rendering.sFieldPostProcessVert(),fragmentShader:this.pxlShaders.rendering.sFieldPostProcessFrag(),defines:{}}),"tDiffuse"),this.pxlUser.sFieldPass.enabled=!1,this.pxlUser.sFieldPass.name="sFieldPass",this.pxlUser.iZoomPass=new Hs.ShaderPass(new j.ShaderMaterial({uniforms:{tDiffuse:{value:null},tDiffusePrev:{type:"t",value:null},time:{value:this.pxlTimer.msRunner},ratio:{value:this.pxlDevice.screenRes},noiseTexture:{value:this.cloud3dTexture}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.iZoomPostProcess(),defines:{}}),"tDiffuse"),this.pxlUser.iZoomPass.enabled=!1,this.pxlUser.iZoomPass.name="iZoomPass",this.chroAberrationPass=new Hs.ShaderPass(new j.ShaderMaterial({uniforms:{tDiffuse:{value:null},ratio:{value:this.pxlDevice.screenRes},warpMult:{value:this.chroAberMult},chroAberUVTexture:{value:this.chroAberUVTexture},lKing:{value:this.pxlUser.lKingWarp}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.chroAberPostProcess(),defines:{}}),"tDiffuse"),this.chroAberrationPass.enabled=!1,this.chroAberrationPass.name="chroAberrationPass",this.mapComposer.addPass(this.chroAberrationPass),this.mapComposer.addPass(this.lizardKingPass),this.mapComposer.addPass(this.pxlUser.sFieldPass),this.mapComposer.addPass(this.pxlUser.iZoomPass),this.mapComposerWarpPass=new Hs.ShaderPass(new j.ShaderMaterial({uniforms:{time:{value:this.pxlTimer.msRunner},fader:{value:this.warpVisualFader},tDiffuse:{value:null},noiseTexture:{value:this.cloud3dTexture},animTexture:{value:this.blockAnimTexture}},vertexShader:this.pxlShaders.core.camPosVert(),fragmentShader:this.pxlShaders.rendering.warpPostProcess(),defines:{}}),"tDiffuse"),this.mapComposerWarpPass.needsSwap=!0,this.mapComposerWarpPass.enabled=!1,this.mapComposerWarpPass.name="mapComposerWarpPass",this.mapComposer.addPass(this.mapComposerWarpPass),this.mapBoxAAPass=new Hs.ShaderPass(new j.ShaderMaterial({uniforms:{tDiffuse:{value:null},resUV:{type:"f",value:this.pxlDevice.screenRes},ratio:{type:"f",value:1},gamma:{type:"f",value:this.pxlDevice.gammaCorrection}},vertexShader:this.pxlShaders.core.camPosVert(),fragmentShader:this.pxlShaders.rendering.boxAntiAliasPass(),defines:{}}),"tDiffuse"),this.mapBoxAAPass.enabled=!1,this.mapBoxAAPass.name="mapBoxAAPass",this.mapComposer.addPass(this.mapBoxAAPass),this.mapCrossAAPass=new Hs.ShaderPass(new j.ShaderMaterial({uniforms:{tDiffuse:{value:null},resUV:{type:"f",value:this.pxlDevice.screenRes},ratio:{type:"f",value:1},gamma:{type:"f",value:this.pxlDevice.gammaCorrection}},vertexShader:this.pxlShaders.core.camPosVert(),fragmentShader:this.pxlShaders.rendering.crossAntiAliasPass(),defines:{}}),"tDiffuse"),this.mapCrossAAPass.enabled=!1,this.mapCrossAAPass.name="mapCrossAAPass",this.mapComposer.addPass(this.mapCrossAAPass),this.mapComposer.autoClear=!0;var v=this.roomSceneList[this.bootRoom].scene;this.roomComposer=new zs.EffectComposer(this.engine),this.roomRenderPass=new Gs.RenderPass(v,this.pxlCamera.camera),this.roomRenderPass.name="roomRenderPass",this.roomComposer.addPass(this.roomRenderPass),this.roomNameList.forEach((u=>{if(u!=this.mainRoom){var d=this.roomSceneList[u].applyRoomPass(this.roomComposer);d&&(d.enabled=!1,this.roomComposer.addPass(d))}})),this.roomBloomPass=new Xs.UnrealBloomPass(new j.Vector2(.5*this.pxlDevice.mapW,.5*this.pxlDevice.mapH),1.5,.8,.85),this.roomBloomPass.threshold=this.pxlRenderSettings.bloomThresh,this.roomBloomPass.strength=this.pxlRenderSettings.bloomStrength,this.roomBloomPass.radius=this.pxlRenderSettings.bloomRadius,this.roomBloomPass.name="roomBloomPass",this.roomComposer.addPass(this.roomBloomPass),this.roomGlowPass=new Hs.ShaderPass(new j.ShaderMaterial({uniforms:{time:{value:this.pxlTimer.msRunner},ratio:{type:"f",value:1},tDiffuse:{value:null},gDiffuse:{value:null},rDiffuse:{value:null},sceneDepth:{value:null}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.glowPassPostProcess(),defines:{}}),"tDiffuse"),this.roomGlowPass.material.uniforms.gDiffuse=this.blurComposer.writeBuffer.texture,this.roomGlowPass.material.uniforms.rDiffuse=this.blurComposer.renderTarget2.texture,this.roomGlowPass.material.uniforms.sceneDepth=this.scene.renderTarget.depthTexture,this.roomGlowPass.needsSwap=!0,this.roomGlowPass.name="roomGlowPass",this.roomComposer.addPass(this.roomGlowPass),this.roomComposer.addPass(this.chroAberrationPass),this.roomComposer.addPass(this.lizardKingPass),this.roomComposer.addPass(this.pxlUser.sFieldPass),this.roomComposer.addPass(this.pxlUser.iZoomPass),this.roomComposer.addPass(this.mapComposerWarpPass),this.roomComposer.addPass(this.mapCrossAAPass),this.roomComposer.addPass(this.mapBoxAAPass),this.roomComposer.autoClear=!0,this.delayComposer=new zs.EffectComposer(this.engine);new Gs.RenderPass(this.scene,this.pxlCamera.camera);this.delayPass=new Hs.ShaderPass(new j.ShaderMaterial({uniforms:{tDiffuse:{value:null},roomComposer:{type:"f",value:0},tDiffusePrev:{value:null},tDiffusePrevRoom:{value:null}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.textureStorePass(),defines:{}}),"tDiffuse"),this.delayPass.material.uniforms.tDiffusePrev=this.mapComposer.renderTarget1.texture,this.delayPass.material.uniforms.tDiffusePrevRoom=this.roomComposer.renderTarget1.texture,this.delayPass.clear=!1,this.delayComposer.addPass(this.delayPass),this.delayComposer.renderToScreen=!1,this.delayComposer.autoClear=!1,this.pxlUser.iZoomPass.uniforms.tDiffusePrev.value=this.delayComposer.renderTarget2.texture}setExposure(u){u*=1,this.pxlCamera.uniformScalars.exposureUniformBase=u,this.updateCompUniforms(u)}stepWarpPass(){if(this.warpVisualActive){var u=(this.pxlTimer.curMS-this.warpVisualStartTime)/this.warpVisualMaxTime[this.pxlCamera.warpType],d=Math.min(1,3*u),v=Math.min(1,3-3*u);1==d&&1==v&&this.pxlCamera.warpActive&&this.pxlCamera.warpCamRun(),this.warpVisualFader.x=d,this.warpVisualFader.y=v,v<=0&&this.stopWarpVisual()}}checkUserVideoStatus(u){}remoteUserUpdateMedia(u){}userRemoveRemoteData(u){}stepShaderValues(){this.stepShaderFuncArr.forEach((u=>{"object"==typeof u?u.step():"string"==typeof u&&(console.log("Does this trigger?"),console.log(u))}))}stepAnimatedObjects(){this.pxlUser.itemListNames.length>0&&this.pxlUser.itemListNames.forEach((u=>{this.pxlUser.itemList[u].rotation.y=this.pxlTimer.msRunner.x*this.pxlUser.itemRotateRate}))}initWarpVisual(u){this.warpVisualActive=!0,this.warpVisualFader.x=0,this.warpVisualFader.y=1,this.warpVisualStartTime=this.pxlTimer.curMS,this.mapComposerWarpPass.enabled=!0}stopWarpVisual(){this.warpVisualActive=!1,this.warpVisualFader.x=1,this.warpVisualFader.y=0,this.mapComposerWarpPass.enabled=!!this.pxlUser.iZoom}prepPortalRender(){}cleanupPortalRender(){}setPortalTexture(u,d){this.roomWarpVisuals[d].material.map=u}warpPortalQueue(){return Object.keys(this.roomSceneList).reverse()}getSceneSnapshot(u){var d=this.roomSceneList[u];this.engine.setRenderTarget(d.warpZoneRenderTarget),d.prepPortalRender(),this.engine.render(d.scene||d.scene,this.pxlCamera.camera),d.cleanupPortalRender(),this.engine.setRenderTarget(null)}mapRender(){var u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.pxlTimer.active&&this.step(),this.pxlTimer.curMS>this.nextRenderMS||0==u){this.prevRenderMS=this.nextRenderMS,this.nextRenderMS=this.pxlTimer.curMS+this.renderInterval,this.stepShaderValues(),this.stepAnimatedObjects();var d=this.roomSceneList[this.currentRoom];d&&d.booted&&(d.step(),d.camera.layers.disable(this.renderLayerEnum.SKY),this.engine.setRenderTarget(d.scene.renderTarget),this.engine.clear(),this.engine.render(d.scene,d.camera),this.engine.setRenderTarget(null),d.camera.layers.enable(this.renderLayerEnum.SKY),this.mapComposerGlow&&(this.pxlQuality.settings.bloom||this.pxlQuality.settings.fog)&&this.mapComposerGlow.render(),this.mapRenderBlurStack(d,d.camera,d.scene,this.scene.renderGlowTarget),this.roomComposer.render()),this.pxlUser.iZoom&&this.delayComposer.render()}this.pxlTimer.active&&u&&requestAnimationFrame((()=>{this.mapRender()}))}mapRenderBlurStack(u,d,v,x){if(this.blurComposer){u.geoList.GlowPass&&(u.geoList.GlowPass.forEach((u=>{if(u.userData.hasOwnProperty("GlowPerc")){var d=u.userData.GlowPerc;u.material.hasOwnProperty("uniforms")&&u.material.uniforms.mult&&(u.material.uniforms.mult.value=d)}})),u.geoList.hasOwnProperty("GlowPassMask")&&u.geoList.GlowPassMask.forEach((u=>{u.material.uniforms&&u.material.uniforms.cdMult&&(u.material.uniforms.cdMult.value=0)}))),d.layers.disable(this.renderLayerEnum.SCENE),d.layers.disable(this.renderLayerEnum.PARTICLES),d.layers.disable(this.renderLayerEnum.SKY),this.engine.setRenderTarget(x);var y=v.background.clone();v.background.set(0),this.engine.setClearColor(0,0),this.engine.render(v,d),v.background.r=y.r,v.background.g=y.g,v.background.b=y.b,d.layers.enable(this.renderLayerEnum.SCENE),d.layers.enable(this.renderLayerEnum.PARTICLES),d.layers.enable(this.renderLayerEnum.SKY),this.engine.setRenderTarget(null),u.geoList.GlowPass&&(u.geoList.GlowPass.forEach((u=>{u.userData.hasOwnProperty("GlowPerc")&&u.material.hasOwnProperty("uniforms")&&u.material.uniforms.mult&&(u.material.uniforms.mult.value=1)})),u.geoList.hasOwnProperty("GlowPassMask")&&u.geoList.GlowPassMask.forEach((u=>{u.material.uniforms&&u.material.uniforms.cdMult&&(u.material.uniforms.cdMult.value=1)}))),this.blurComposer.render(),this.roomBloomPass.enabled=!1}}},GUI:class pxlNav_GUI extends pxlNav_GUIManager{constructor(u){super(u,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Metal-Asylum",arguments.length>2&&void 0!==arguments[2]?arguments[2]:"images/assets/",arguments.length>3&&void 0!==arguments[3]?arguments[3]:"images/GUI/"),this.verbose=u,this.lableBoxSize=40,this.optionWidthRound=10,this.optionWidthAdd=25,this.deviceOptionHeight=[0,300],this.ShaderEditor=null,this.pxlLoaderTotal=5,this.hudVisibility=!0,this.camChoicesActive=!1,this.micChoicesActive=!1,this.textDescriptions={chatIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">C</span> )</span><br>chat',pos:[1,-1.5]},multiverseIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">U</span> )</span><br>multiverse<br>selection',pos:[0,-1.3]},djPlayerVolumeParent:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">B</span> )</span><br>music volume',pos:[0,-1.5]},speakerIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">N</span> )</span><br>mute people<br>pick audio output',pos:[0,-1.5]},micIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">M</span> )</span><br>mute/pick<br>mic input',pos:[0,-1.5]},camIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">V</span> )</span><br>enable/pick<br>video input',pos:[0,-1.5]},helpIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">?</span> )</span><br>help &<br>instructions',pos:[0,-1.5]},infoIconParent:{text:'Info <span class="helpHotKeyParent">( <span class="helpHotKey">I</span> )</span>',pos:[-1,0],offset:[-10,0]},settingsIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">G</span> )</span><br>graphics &<br>navigation',pos:[0,-1.5]},muteAllIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">N</span> )</span><br>mute all users',pos:[1,0]},fullScreenIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">F</span> )</span><br>toggle full screen',pos:[-1,0]},videoQualityIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">H</span> )</span><br>video quality settings',pos:[-1,0]},statsIcon:{text:"jitsi connection status; toggle connection ",pos:[1,0]},usersIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">T</span> )</span> user moderator tools',pos:[1,0]},ft2Button:{text:"Environment",pos:[-1,0],offset:[-10,0]},ft3Button:{text:"Invite Friends",pos:[-1,0],offset:[-10,0]},hud_userCount:{text:"# of People",pos:[-1,0],offset:[-10,0]}},this.activeItem=null,this.actionPopUp=null,this.init()}setDependencies(pxlNav){super.setDependencies(pxlNav),this.ShaderEditor=new pxlNav_ShaderEditor(pxlNav,this)}init(){super.init()}booted(){super.booted()}step(){super.step()}toggleShaderEditor(){this.ShaderEditor.toggleShaderEditor()}resize(u){super.resize(),this.ShaderEditor&&this.ShaderEditor.resize(u)}},Camera:class pxlNav_Camera{constructor(){this.standingHeight=1.75,this.movementScalar=1,this.jumpScalar=1,this.userScale=1,this.cameraEasing=[.55,.45],this.cameraJumpImpulse=[.035,.075],this.cameraMaxJumpHold=[.55,1],this.gravityRate=0,this.gravityMax=2.5,this.gravityMPS=[1,.5],this.pxlAudio=null,this.pxlTimer=null,this.pxlAutoCam=null,this.pxlEnv=null,this.pxlUser=null,this.pxlUtils=null,this.pxlDevice=null,this.pxlGuiDraws=null,this.pxlQuality=null,this.socket=null,this.camera=null,this.canMove=!0,this.HDRView=!1,this.objRaycast=new j.Raycaster,this.camUpdated=!0,this.cameraBooted=!1,this.standingHeightGravInfluence=0,this.standingMaxGravityOffset=.5,this.maxStepHeight=.6,this.walkBounce=0,this.walkBounceSeed=230,this.walkBouncePerc=0,this.posRotEasingThreshold=.01,this.cameraMovement=[0,0],this.cameraMovementEase=.85,this.cameraMoveLength=0,this.cameraMoveLengthMult=.1,this.camPosBlend=.65,this.camRotXYZ=new j.Vector3(0,0,0),this.camRotPitch=new j.Vector2(0,0),this.cameraJumpActive=!1,this.cameraAllowJump=!0,this.cameraJumpHeight=0,this.cameraJumpVelocity=0,this.cameraJumpVelocityEaseOut=.8,this.cameraJumpInAir=!1,this.floorColliderInitialHit=!1,this.colliderValidityChecked=!0,this.nearestFloorHit=new j.Vector3(0,0,0),this.nearestFloorObjName=null,this.nearestFloorHitPrev=new j.Vector3(0,0,0),this.nearestFloorObjNamePrev=null,this.objectJumpLock=!1,this.gravityActive=!1,this.gravitySourceActive=!1,this.gravityDirection=new j.Vector3(0,-1,0),this.gravityEaseOutRate=.8,this.jump=0,this.hasJumpLock=!1,this.releaseJumpLockTime=0,this.releaseJumpLockDelay=.05,this.runMain=!0,this.workerActive=!1,this.worker=null,this.workerTransfers=!1,this.workerMessage=()=>{},this.workerFunc=()=>{},this.deviceKey=()=>{},this.portalList={},this.collidersExist=!1,this.colliderActive=!1,this.colliderList={noAxis:[],11:[],"01":[],10:[],"00":[]},this.antiColliderActive=!1,this.antiColliderList={noAxis:[],11:[],"01":[],10:[],"00":[]},this.antiColliderTopActive=!1,this.antiColliderTopList={noAxis:[],11:[],"01":[],10:[],"00":[]},this.roomWarpZone=[],this.colliderCurObjHit=null,this.colliderPrevObjHit=null,this.colliderValid=!1,this.colliderFail=!1,this.warpActive=!1,this.warpType=0,this.warpObj=null,this.warpTarget=null,this.hotKeyTriggered=!1,this.eventCheckStatus=!1,this.proximityScaleTrigger=!1,this.colliderShiftActive=!0,this.colliderAdjustPerc=0,this.colliderAdjustRate=.02,this.gyroGravity=[0,0,0],this.cameraPose={alpha:null,beta:null,gamma:null,alphaOffset:0,betaOffset:0,gammaOffset:0,orientation:window.orientation||0,pos:[0,0,0],posOffset:[0,0,0],rx:()=>this.beta,ry:()=>this.alpha,rz:()=>this.gamma,accelZeroed:[0,0,0],accelCalibration:10,accelCalDiv:.1,accelCalCount:0,accelTotal:[0,0,0],accelPrev:null,accelDelta:[0,0,0],accelClearDelta:()=>{this.accelDelta=[0,0,0]}},this.uniformScalars={curExp:1,darkBase:.1,brightBase:.5,exposureUniformBase:1},this.cameraPosLookAtNames={default:{pos:"Position",lookAt:"LookAt"},mobile:{pos:"PositionMobile",lookAt:"LookAtMobile"},vr:{pos:"PositionVR",lookAt:"LookAtVR"}},this.cameraPos=new j.Vector3(0,0,0),this.cameraPrevPos=new j.Vector3(0,0,0),this.cameraPrevLookAt=new j.Vector3(0,0,0),this.cameraAim=new j.Vector3(0,0,1),this.cameraAimTarget=new j.Vector3(0,0,0),this.cameraCross=new j.Vector3(1,0,0),this.lookAtTargetActive=new j.Vector3(0,0,0),this.lookAtPerc=new j.Vector2(1,0),this.lookAtLockPerc=0,this.lookAtLockFader=0,this.lookAtLockFadeRate=.01,this.prevQuaternion=new j.Quaternion,this.pi=3.14159265358979,this.init()}setDependencies(pxlNav){this.pxlAudio=pxlNav.pxlAudio,this.pxlTimer=pxlNav.pxlTimer,this.pxlAutoCam=pxlNav.pxlAutoCam,this.pxlEnv=pxlNav.pxlEnv,this.pxlUser=pxlNav.pxlUser,this.pxlUtils=pxlNav.pxlUtils,this.pxlDevice=pxlNav.pxlDevice,this.pxlGuiDraws=pxlNav.pxlGuiDraws,this.pxlQuality=pxlNav.pxlQuality,this.socket=pxlNav.socket}init(){}updateMainValues(u){var{gravityRate:d,standingHeightGravInfluence:v,cameraJumpImpulse:x}=u;null!=d&&(this.gravityRate=d),null!=v&&(this.standingHeightGravInfluence=v),null!=x&&(this.cameraJumpVelocity+=x),this.camUpdated=!0}step(){this.pxlDevice.directionKeyDown&&this.updateMovement(this.pxlTimer.prevMS),this.runMain&&(this.hasJumpLock&&this.pxlTimer.runtime>this.releaseJumpLockTime&&(this.hasJumpLock=!1,this.gravityActive=!1,this.cameraAllowJump=!0,this.camInitJump()),this.gravityActive&&this.cameraJumpActive?this.camJump(this.pxlTimer.prevMS):this.cameraJumpVelocity>0&&this.killJumpImpulse()),this.camUpdated=this.camUpdated||0!=this.cameraMovement[0]||this.cameraMovement[1]||this.gravityActive||this.pxlDevice.cursorLockActive,this.updateCamera(),this.lowQualityUpdates(),this.midQualityUpdates(),this.eventCheck()}eventCheck(){this.colliderValid&&this.eventCheckStatus&&this.eventTrigger(this.nearestFloorObjName)&&this.warpEventTriggered(1,this.nearestFloorObjName)}updateDeviceValues(u){if(!this.pxlQuality.settings.leftRight){var d=-this.cameraMovement[0];this.pxlDevice.touchMouseData.active||(this.pxlDevice.touchMouseData.velocity.x+=d),this.pxlDevice.touchMouseData.netDistance.x+=4*d}if(null!=this.pxlDevice.touchMouseData.velocity&&0==this.pxlDevice.mobile){if(u<this.posRotEasingThreshold)this.pxlDevice.touchMouseData.velocity.multiplyScalar(0);else{var v=this.cameraEasing[this.pxlDevice.mobile?1:0];this.pxlDevice.touchMouseData.velocity.multiplyScalar(v)}this.pxlDevice.touchMouseData.netDistance.add(this.pxlDevice.touchMouseData.velocity.clone().multiply(this.pxlDevice.touchMouseData.moveMult))}}buildDeviceMonitors(){}updateCameraMatrices(){this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.updateWorldMatrix()}resetCameraCalculations(u){this.cameraMovement[0]=0,this.cameraMovement[1]=0,this.pxlDevice.touchMouseData.curFadeOut.multiplyScalar(0),this.pxlDevice.touchMouseData.velocity.multiplyScalar(0),this.pxlDevice.touchMouseData.netDistance.set(0,0),this.camera.position.copy(u),this.updateCameraMatrices(),this.cameraPos.copy(u),this.cameraPrevPos.copy(u),this.colliderCurObjHit=null,this.colliderPrevObjHit=null,this.camUpdated=!0}setFOV(u){this.camera.fov=u,this.camera.updateProjectionMatrix(),this.camUpdated=!0}setStats(u,d,v,x){this.camera.near=v,this.camera.far=x,this.setFOV(u)}setTransform(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.resetCameraCalculations(u),d&&(this.cameraAimTarget.position.copy(d),this.camera.lookAt(d),this.cameraPrevLookAt.copy(d),this.updateCameraMatrices(),this.pxlDevice.touchMouseData.initialQuat=this.camera.quaternion.clone()),this.resetGravity(),this.camUpdated=!0}setToObj(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.resetCameraCalculations(u.position),d){var v=d.position.clone();this.cameraAimTarget.position.copy(v),this.camera.lookAt(v),this.cameraPrevLookAt.copy(v),this.updateCameraMatrices(),this.pxlDevice.touchMouseData.initialQuat=this.camera.quaternion.clone()}else this.pxlDevice.touchMouseData.initialQuat=u.quaternion.clone(),this.camera.setRotationFromQuaternion(this.pxlDevice.touchMouseData.initialQuat),this.updateCameraMatrices();this.resetGravity(),this.camUpdated=!0,this.mainColliderCheck(u.position,null),this.nearestFloorObjName=null}warpToRoom(u){var d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].stop();var x=this.pxlEnv.currentRoom,y=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].camHoldWarpPos;this.pxlEnv.currentRoom=u,this.pxlAutoCam.curRoom=u;var b=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom],_=u==this.pxlEnv.mainRoom;if(this.pxlUser.iZoom){var w=_?this.pxlEnv.roomComposer:this.pxlEnv.mapComposer,S=_?this.pxlEnv.mapComposer:this.pxlEnv.roomComposer;this.pxlEnv.delayPass.uniforms.tDiffusePrev.value=w.renderTarget1.texture,this.pxlEnv.delayPass.uniforms.tDiffusePrevRoom.value=S.renderTarget1.texture,setTimeout((()=>{x!=u&&(_?this.pxlEnv.roomComposer.reset():this.pxlEnv.mapComposer.reset()),setTimeout((()=>{this.pxlEnv.mapComposerWarpPass.needsSwap=!1}),500)}),100)}if(d)if(u!=x&&b.start(),this.pxlEnv.roomRenderPass.scene=b.scene,b.camLocation.hasOwnProperty(v)){var C=this.cameraPosLookAtNames.default.pos,P=this.cameraPosLookAtNames.default.lookAt;this.pxlDevice.mobile&&(b.camLocation[v].hasOwnProperty(this.cameraPosLookAtNames.mobile.pos)&&(C=this.cameraPosLookAtNames.mobile.pos),b.camLocation[v].hasOwnProperty(this.cameraPosLookAtNames.mobile.lookAt)&&(P=this.cameraPosLookAtNames.mobile.lookAt));var A=b.camLocation[v][C],T=b.camLocation[v][P];this.setTransform(A,T)}else!b.camInitPos||!b.camInitLookAt||y&&this.pxlEnv.postIntro&&!this.hotKeyTriggered||(this.setTransform(b.camInitPos,b.camInitLookAt),this.hotKeyTriggered=!1);else y&&this.pxlEnv.postIntro&&!this.hotKeyTriggered||(null!=v?this.setToObj(v):this.setTransform(b.camReturnPos,b.camReturnLookAt),this.hotKeyTriggered=!1);this.pxlGuiDraws.prepArtistInfo(b.getArtistInfo()),this.camUpdated=!0,this.camera.fov=b.pxlCamFOV,this.camera.zoom=b.pxlCamZoom,this.camera.aspect=b.pxlCamAspect,this.camera.near=b.pxlCamNearClipping,this.camera.far=b.pxlCamFarClipping,this.camera.updateProjectionMatrix();var E=this.getUserHeight();this.emitCameraTransforms(this.camera.position.clone(),E,!0),this.pxlAutoCam.checkStatus()}warpToRoomSnapshot(u){this.pxlEnv.currentRoom=u;var d=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom];this.camera.fov=d.pxlCamFOV,this.camera.zoom=d.pxlCamZoom,this.camera.aspect=d.pxlCamAspect,this.camera.near=d.pxlCamNearClipping,this.camera.far=d.pxlCamFarClipping,this.camera.updateProjectionMatrix(),this.setTransform(d.camThumbPos,d.camThumbLookAt);var v=this.getUserHeight();this.emitCameraTransforms(this.camera.position.clone(),v,!0)}fastTravel(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.pxlAutoCam.enabled||((this.pxlAutoCam.active||this.pxlAutoCam.autoCamActive)&&this.pxlAutoCam.preAutoCamToggle(),this.hotKeyTriggered=!0,0==u&&this.warpEventTriggered(1,this.pxlEnv.currentRoom,"init"))}camJumpKey(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.camInitJump():(this.cameraJumpActive&&(this.cameraJumpActive=!1),this.cameraAllowJump=!0,this.hasJumpLock=!1)}camInitJump(){this.canMove&&!this.gravityActive&&this.cameraAllowJump&&(this.pxlDevice.keyDownCount[2]=this.pxlTimer.prevMS,this.cameraAllowJump=!1,this.cameraJumpActive=!0,this.cameraJumpInAir=!0,this.gravityActive=!0,this.gravityRate=0,this.cameraJumpVelocity=this.cameraJumpImpulse[this.pxlUser.lowGrav]*this.userScale,this.objectJumpLock&&(this.objectJumpLock=!1,this.nearestFloorHit=this.nearestFloorHitPrev))}camJump(u){var d=u-this.pxlDevice.keyDownCount[2],v=Math.min(1,d/this.cameraMaxJumpHold[this.pxlUser.lowGrav]);if(this.cameraJumpActive){var x=v;1==x?this.cameraJumpActive=!1:(x=(1-x)*(1-x),x*=.5*x+.5),this.cameraJumpVelocity+=Math.max(0,x)*this.cameraJumpImpulse[this.pxlUser.lowGrav]*this.jumpScalar}this.cameraJumpVelocity*=1-v,1==v&&(this.cameraJumpActive=!1)}killJumpImpulse(){var u=this.cameraJumpVelocity*this.cameraJumpVelocityEaseOut;this.cameraJumpVelocity=u>.1?u:0,this.workerFunc("killJumpImpulse")}updateGravity(){if(this.runMain){this.gravityRate=Math.max(0,this.gravityRate-.2*this.cameraJumpVelocity);var u=this.gravityMPS[this.pxlUser.lowGrav];if(this.gravityActive&&(this.gravityRate=Math.min(this.gravityMax,this.gravityRate+this.gravityMax*this.pxlTimer.msRunner.y)*u),0!=this.gravityRate){var d=1;this.gravityActive?d=.08*this.gravityRate:(this.gravityRate=this.gravityRate>.01?this.gravityRate*this.gravityEaseOutRate*u:0,d=this.gravityRate),d=Math.min(1,d),this.standingHeightGravInfluence=Math.min(1,1.2*this.gravityRate/this.gravityMax)*this.standingMaxGravityOffset}}}resetGravity(){this.gravityRate=0,this.workerFunc("resetGravity"),this.jumpLanding(!1)}jumpLanding(){var u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.cameraJumpActive&&(this.hasJumpLock=!0,this.releaseJumpLockTime=this.pxlTimer.runtime+this.releaseJumpLockDelay),this.gravityActive=!1,this.cameraJumpVelocity=0,this.cameraJumpInAir=!1,this.cameraJumpActive=!1,u&&this.workerFunc("jumpLanding")}mainColliderCheck(u,d){if(!this.canMove)return u;var v=null;if(this.movementBlocked=!1,(this.cameraMoveLength>0||null==this.colliderPrevObjHit||null==this.nearestFloorObjName)&&this.cameraBooted&&this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].collidersExist){this.colliderValidityChecked=!0;var x=new j.Vector3(0,-1,0),y=u.clone();y.y=1500,this.objRaycast.set(y,x);var b=[],_=~~(y.x>0)+""+~~(y.z>0);if(this.antiColliderActive&&(b=this.objRaycast.intersectObjects([...this.antiColliderList.noAxis,...this.antiColliderList[_]])),b.length>0)if(this.antiColliderTopActive){for(var w,S,C=this.objRaycast.intersectObjects([...this.antiColliderTopList.noAxis,...this.antiColliderTopList[_]]),P=-99999,A=(u.y,this.nearestFloorHit),T=!1,E=0;E<C.length;++E){var D=C[E];w=D.object.name;var I=D.point,k=D.distance,R=I.y<this.maxStepHeight;T=T||R,(k<P&&valid||null==v)&&(v=w,P=k,A=I)}(!T||u.y<A.y&&this.nearestFloorHitPrev.y-A.y>this.maxStepHeight+this.getStandingHeight()&&!this.gravityActive&&u.y+this.maxStepHeight+this.getStandingHeight()<A.y&&this.gravityActive)&&(0==this.cameraMovement[0]&&0==this.cameraMovement[1]||(T=!0,this.gravityActive=!1,this.objectJumpLock=!0),(S=this.cameraPos.clone()).y=Math.min(u.y,S.y),A=u=S,this.gravityActive?A.y=this.nearestFloorHitPrev.y:A.y=this.cameraPos.y,this.cameraJumpActive=!1,this.cameraAllowJump=!0,this.cameraJumpInAir=!1,this.cameraMovement[0]=0,this.cameraMovement[1]=0,this.pxlDevice.touchMouseData.curFadeOut.multiplyScalar(0),this.pxlDevice.touchMouseData.velocity.multiplyScalar(0)),T&&(null==v?(this.nearestFloorHit=this.nearestFloorHitPrev,this.nearestFloorObjName=this.nearestFloorObjNamePrev,Math.abs(u.y-this.nearestFloorHit.y)>this.maxStepHeight+this.getStandingHeight()&&(this.colliderValid=!1,this.gravityActive=!0)):(this.nearestFloorHitPrev=this.nearestFloorHit,this.nearestFloorObjNamePrev=this.nearestFloorObjName,this.nearestFloorHit=A,this.nearestFloorObjName=v))}else this.colliderFail=!0,this.movementBlocked=!0;else{var O=this.maxStepHeight+this.cameraJumpVelocity;this.maxStepHeight,this.gravityRate;if(y.y=u.y+O,this.objRaycast.set(y,x),this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].colliderMasterList||(this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].colliderMasterList={}),!this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].colliderMasterList[_]){var G=[],H=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom];G.push(...H.colliderList.noAxis),G.push(...H.colliderList[_]),G.push(...H.antiColliderTopList.noAxis),G.push(...H.antiColliderTopList[_]),this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].colliderMasterList[_]=G}if(!(this.colliderActive&&this.antiColliderTopActive||this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].colliderActive))return u;if((b=this.objRaycast.intersectObjects(this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].colliderMasterList[_])).length>0){this.floorColliderInitialHit=!0;for(var X,q=-99999,Z=this.nearestFloorHit,J=0;J<b.length;++J){var Q,K=b[J],Y=K.distance,$=K.point;if(X=K.object.name,Q=$.distanceTo(u)<this.maxStepHeight,(this.portalList[X]||this.roomWarpZone.includes(X))&&Q){v=X,Z=$;break}this.itemCheck(X,Q)||(Y<q||null==v)&&(v=X,q=Y,Z=$)}null==this.nearestFloorObjName&&null!=v&&(this.nearestFloorHitPrev=Z,this.nearestFloorObjNamePrev=v,this.nearestFloorHit=Z,this.nearestFloorObjName=v),this.nearestFloorHitPrev.y-Z.y>this.maxStepHeight+this.getStandingHeight()&&!this.gravityActive?(u=v?this.cameraPos.clone():this.cameraPrevPos.clone(),v=this.nearestFloorObjName,this.cameraMovement[0]=0,this.cameraMovement[1]=0,this.pxlDevice.touchMouseData.curFadeOut.multiplyScalar(0),this.pxlDevice.touchMouseData.velocity.multiplyScalar(0)):(this.nearestFloorHitPrev=this.nearestFloorHit,this.nearestFloorObjNamePrev=this.nearestFloorObjName,this.nearestFloorHit=Z,this.nearestFloorObjName=v,null==v&&(this.colliderValid=!1,this.gravityActive=!0))}else this.colliderFail=!0,this.movementBlocked=!0,this.colliderValidityChecked=!1,u=this.cameraPos.clone()}}else this.colliderValidityChecked=!1;return this.colliderValidityChecked=!1,u}roomColliderCheck(u,d){if(!this.canMove)return u;this.colliderValidityChecked=!0,this.colliderValid=!1,this.colliderFail=!1,console.log("Room Collider Check");var v=u.clone();v.y=0,this.nearestFloorHit=v,this.nearestFloorObjName="None";var x=new j.Vector3(0,-1,0),y=u.clone();y.y=1500,this.objRaycast.set(y,x);var b=this.objRaycast.intersectObjects(this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].roomWarp);if(b.length>0)return this.pxlEnv.currentAudioZone=0,this.warpEventTriggered(1,this.pxlEnv.mainRoom),u;if(1==this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].colliderActive){if(!this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].colliderMasterList){var _=[];Object.keys(this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].colliderList).forEach((u=>{_.push(...this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].colliderList[u])})),this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].colliderMasterList=_}if(this.objRaycast.set(y,x),0==(b=this.objRaycast.intersectObjects(this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].colliderMasterList)).length){var w=this.cameraPrevPos.clone();return w.y=u.y,w}var S=!1,C=!1,P=!1,A=u.clone();if(A.y-=this.maxStepHeight,b.forEach((v=>{var x=v.distance,y=v.point.y;y>u.y-this.maxStepHeight&&y<u.y+this.maxStepHeight+d&&A.y<y?(S=!0,P=!1,A=v.point):y>u.y+this.maxStepHeight?C=!0:y<u.y-this.maxStepHeight&&0==S&&(P=!0)})),C){var T=this.cameraPrevPos.clone();return T.y=u.y,T}if(P&&(this.gravityActive=!0),S)return u.y<A.y&&this.jumpLanding(),A.clone()}return u}checkColliderValid(u){this.colliderValidityChecked=!0;var d=this.maxStepHeight+this.gravityRate,v=u.distanceTo(this.nearestFloorHit),x=v<d;return this.colliderValid=x,v}eventTrigger(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!this.canMove)return!1;if(!u)return!1;if(this.portalList[u])return this.warpEventTriggered(0,this.portalList[u]),this.eventCheckStatus=!1,!0;if(this.roomWarpZone.includes(u))return this.warpEventTriggered(1,u),this.eventCheckStatus=!1,!0;if(this.colliderShiftActive=this.colliderCurObjHit!=u||this.colliderShiftActive,this.colliderPrevObjHit=this.colliderCurObjHit,this.colliderCurObjHit=u,this.colliderShiftActive=this.colliderShiftActive||!(1==this.colliderAdjustPerc||0==this.colliderAdjustPerc),this.colliderShiftActive&&this.colliderCurObjHit){var d=1;this.colliderCurObjHit.includes("AudioTrigger")&&(d=-1),this.colliderAdjustPerc=Math.min(1,Math.max(0,this.colliderAdjustPerc+this.colliderAdjustRate*d));var v=1-this.colliderAdjustPerc,x=1;if("AudioTrigger_1"==this.colliderCurObjHit)this.pxlEnv.currentAudioZone=1,x-=v*this.uniformScalars.darkBase,this.uniformScalars.exposureUniformBase=x;else if("AudioTrigger_2"==this.colliderCurObjHit){this.pxlEnv.currentAudioZone=2;x=this.uniformScalars.curExp+v*this.uniformScalars.brightBase*1,this.uniformScalars.exposureUniformBase=x,this.proximityScaleTrigger=!0,this.pxlAudio.setFadeActive(-1)}else this.pxlEnv.currentAudioZone=0,x=x*(1-v)+this.uniformScalars.exposureUniformBase*v;if(this.colliderShiftActive=!(1==this.colliderAdjustPerc||0==this.colliderAdjustPerc),"AudioTrigger_2"==this.colliderPrevObjHit&&this.colliderCurObjHit!=this.colliderPrevObjHit&&(this.proximityScaleTrigger=!0,this.pxlAudio.setFadeActive(1)),this.pxlDevice.mobile&&(x=this.colliderAdjustPerc),this.pxlEnv.updateCompUniforms(x),this.proximityScaleTrigger&&!this.pxlDevice.mobile&&!this.pxlAutoCam.enabled){var y=this.colliderAdjustPerc;y=1-(1-y)*(1-y),this.pxlEnv.fogMult.x=y,this.colliderShiftActive||(this.proximityScaleTrigger=!1)}this.eventCheckStatus=this.colliderShiftActive}}itemCheck(u,d){if(!d)return!1;var v=u.split("_").shift();if(this.pxlUser.itemListNames.includes(u)&&this.pxlUser.checkItemPickUp(v))return this.itemActive(v,u);return!1}itemTrigger(){if(this.pxlUser.itemActiveTimer.length>0)this.pxlUser.itemActiveTimer[0]=this.pxlTimer.curMS;else{0==this.pxlUser.mPick.length&&(this.pxlUser.mPick=this.pxlUtils.randomizeArray(["LizardKing","StarField","InfinityZoom"]));var u=this.pxlUser.mPick.pop();this.pxlUser.checkItemPickUp(u),this.itemActive(u)}}itemActive(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null==u)return!1;var v=this.pxlTimer.prevMS+this.pxlUser.itemRunTime,x="",y="";if("LowGravity"==u)y="Low Gravity",x="this.lowGrav=0;this.itemGroupList['"+d+"'].visible=true;",v=this.pxlTimer.prevMS+this.pxlUser.itemRunTime;else if("LizardKing"==u)y="I am the Lizard King",x="this.lKing=0;this.lKingWarp.set(...this.lKingInactive);this.lKingPass.enabled=false;"+(!this.pxlDevice.mobile&&"this.itemGroupList['"+d+"'].visible=true;"),v=this.pxlTimer.prevMS+this.pxlUser.itemRunTime;else if("StarField"==u)y="Major Tom",x="this.sField=0;this.sFieldPass.enabled=false;"+(!this.pxlDevice.mobile&&"this.itemGroupList['"+d+"'].visible=true;"),v=this.pxlTimer.prevMS+this.pxlUser.itemRunTime;else{if("InfinityZoom"!=u)return!1;y="Fractal Substrate",x="this.iZoom=0;this.iZoomPass.enabled=false;"+(!this.pxlDevice.mobile&&"this.itemGroupList['"+d+"'].visible=true;this.pxlEnv.mapComposerWarpPass.needsSwap=true;this.pxlEnv.mapComposerWarpPass.enabled=false;"),v=this.pxlTimer.prevMS+this.pxlUser.itemRunTime,this.pxlEnv.mapComposerWarpPass.needsSwap=!0,setTimeout((()=>{this.pxlEnv.mapComposer.render(),this.pxlEnv.roomComposer.render(),setTimeout((()=>{this.pxlEnv.mapComposerWarpPass.needsSwap=!1,this.pxlEnv.mapComposerWarpPass.enabled=!0}),500)}),500)}return this.pxlGuiDraws.buildItemHud(u,y),this.pxlDevice.mobile||(this.pxlUser.itemGroupList[d].visible=!1),this.pxlUser.itemInactiveCmd.push(x),this.pxlUser.itemActiveTimer.push(v),this.pxlUser.itemActiveList.push(y),!0}toggleMovement(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null==u&&(u=!this.canMove),this.canMove=u}updateMovement(u){if(this.canMove){var d=[0,0],v=[...this.pxlDevice.directionKeysPressed],x=0,y=0,b=[u-this.pxlDevice.keyDownCount[0],u-this.pxlDevice.keyDownCount[1]],_=this.mobile?1:0;if(v[0]+v[2]==1){x=v[2]-v[0];var w=this.pxlQuality.settings.leftRight?this.cameraEasing[_]:.5*(1-Math.min(1,Math.abs(.3*this.cameraMovement[1])));d[0]=((this.pxlQuality.settings.leftRight?1:6)+b[0]*b[0]*.1)*w,d[0]=Math.min(this.pxlDevice.shiftBoost,d[0])*this.movementScalar}else this.pxlDevice.keyDownCount[0]=u;if(v[1]+v[3]==1){y=v[3]-v[1];var S=(1-Math.min(1,Math.abs(.07*this.cameraMovement[0])))*this.cameraEasing[_];d[1]=b[1]*(3*b[1]+2+this.pxlDevice.shiftBoost)*.15*S,d[1]=Math.min(this.pxlDevice.shiftBoost,d[1])*this.movementScalar}else this.pxlDevice.keyDownCount[1]=u;this.cameraMovement[0]+=x*d[0],this.cameraMovement[1]+=y*d[1]}}initFrameCamPosition(){var u=this.cameraPos.clone();if(this.cameraBooted){var d;d=new j.Vector3(this.pxlQuality.settings.leftRight?.5*this.cameraMovement[0]:0,0,this.cameraMovement[1]),this.cameraMoveLength=d.length(),d.applyQuaternion(this.camera.quaternion);var v=this.cameraMoveLength*this.cameraMoveLengthMult;if(0!=v){v=v>0?Math.max(.1,v):Math.min(-.1,v)}d.normalize().multiply(new j.Vector3(1,0,1)).multiplyScalar(v),u.add(d),this.cameraMovement[0]=Math.abs(this.cameraMovement[0])<this.posRotEasingThreshold?0:this.cameraMovement[0]*this.cameraMovementEase,this.cameraMovement[1]=Math.abs(this.cameraMovement[1])<this.posRotEasingThreshold?0:this.cameraMovement[1]*this.cameraMovementEase,u.y=this.cameraPos.y+this.cameraJumpVelocity,this.workerActive&&(this.cameraJumpVelocity=0)}else this.cameraAimTarget.position.set(0,0,0),this.cameraPrevPos=new j.Vector3(u.clone()),this.cameraPrevLookAt=new j.Vector3(0,0,1);return this.cameraCross=new j.Vector3(1,0,0).applyQuaternion(this.camera.quaternion),u}applyGravity(u){if(this.gravityActive){this.maxStepHeight,this.gravityRate;if(u.y<this.nearestFloorHit.y){var d=this.nearestFloorHitPrev;u.y=Math.max(d.y,u.y),u.y<0&&(u.x=d.x,u.z=d.z)}else u.y=Math.max(this.nearestFloorHit.y,u.y-this.gravityRate),u.y==this.nearestFloorHit.y&&u.y<this.cameraPrevPos.y&&this.jumpLanding()}else{if(u.distanceTo(this.nearestFloorHit)<this.maxStepHeight)u.y=this.nearestFloorHit.y;else{var v=(u=this.cameraPos.clone()).y>this.nearestFloorHit.y;this.gravityActive=v,this.colliderFail=!v,this.workerFunc("jumpLanding")}}return u}getStandingHeight(){return this.standingHeight*this.userScale}getUserHeight(){var u=Math.min(1,Math.abs(this.cameraMovement[1]));this.walkBouncePerc=this.walkBouncePerc>=1?1:this.walkBouncePerc+.05,this.walkBounce+=.1*u,this.walkBouncePerc=.9*this.walkBouncePerc+u,this.walkBouncePerc<.03&&(this.walkBouncePerc=0,this.walkBounce=0,this.walkBounceSeed=2351.3256*Math.random());var d=Math.sin(.4*this.walkBounce+this.walkBounceSeed+.2*this.cameraMovement[1])*this.walkBouncePerc*.3;return this.getStandingHeight()-this.standingHeightGravInfluence+d}camApplyMobileRotation(){if(null!=this.cameraPose.alpha){var u=.017453292519943278,d=2.23606797749979,v=new j.Quaternion,x=this.cameraPose.alpha*u+this.cameraPose.alphaOffset+2.1,y=this.cameraPose.beta*u,b=this.cameraPose.gamma*u,_=new j.Vector3(0,0,1),w=new j.Quaternion,S=new j.Quaternion(-d,0,0,d),C=new j.Euler;C.set(y,x,-b,"YXZ"),v.setFromEuler(C),v.multiply(S),v.multiply(w.setFromAxisAngle(_,-this.cameraPose.orientation)),v.normalize();var P=new j.Quaternion;j.Quaternion.slerp(this.camera.quaternion,v,P,.35);var A=(new j.Euler).setFromQuaternion(P);A.x=Math.max(-.95*Math.PI/2,Math.min(.95*Math.PI/2,A.x)),P.setFromEuler(A),this.camera.setRotationFromQuaternion(P)}}updateRoamCameraRotation(){if(null==this.cameraPose.alpha){var u=this.pxlDevice.gyroGravity[2];new j.Vector3(0,0,1),new j.Quaternion;this.pxlDevice.touchMouseData.velocity.y=Math.min(500*this.pi,Math.max(500*-this.pi,this.pxlDevice.touchMouseData.velocity.y));var d,v=new j.Euler;this.pxlDevice.mobile?(v.set(this.pxlDevice.touchMouseData.netDistance.y/this.pxlDevice.sH*2,this.pxlDevice.touchMouseData.netDistance.x/this.pxlDevice.sW*2,0,"YXZ"),(d=new j.Quaternion).setFromEuler(v),d=this.pxlDevice.touchMouseData.initialQuat.clone().multiply(d)):(v.set(.005*this.pxlDevice.touchMouseData.velocity.y,.008*this.pxlDevice.touchMouseData.velocity.x+u,0,"YXZ"),(d=new j.Quaternion).setFromEuler(v),d=this.camera.quaternion.clone().multiply(d)),d.normalize();var x=new j.Vector3(0,0,-10).applyQuaternion(d).add(this.camera.position);this.camera.setRotationFromQuaternion(d),this.camera.lookAt(x),this.camera.up.set(0,1,0)}}updateStaticCameraRotation(){var u=1;this.touchBlender?(u=Math.min(1,Math.max(0,this.pxlTimer.curMS-this.pxlDevice.touchMouseData.releaseTime)),u*=u,this.pxlDevice.touchMouseData.netDistance.multiplyScalar(1-u),this.touchBlender=u<1):this.pxlDevice.touchMouseData.netDistance.multiplyScalar(.5);var d=new j.Euler;d.set(this.pxlDevice.touchMouseData.netDistance.y/this.pxlDevice.sH*2,this.pxlDevice.touchMouseData.netDistance.x/this.pxlDevice.sW*2,0,"YXZ");var v=(new j.Quaternion).clone(this.camera.quaternion);v.setFromEuler(d),(v=this.camera.quaternion.clone().multiply(v)).normalize(),this.touchBlender&&v.slerp(this.camera.quaternion.clone(),u).normalize();var x=new j.Vector3(0,0,-10).applyQuaternion(v).add(this.camera.position);this.camera.setRotationFromQuaternion(v),this.camera.lookAt(x),this.camera.up.set(0,1,0)}lookAtTargetLock(){if(this.lookAtTargetActive&&this.lookAtTargetActive&&(0!=this.lookAtLockFader&&(this.lookAtLockPerc+=(this.lookAtLockFader+Math.min(1,.001*this.pxlDevice.touchMouseData.velocity.length()))*this.lookAtLockFadeRate,(this.lookAtLockPerc<0||this.lookAtLockPerc>1)&&(this.lookAtLockPerc=this.lookAtLockPerc<0?0:1,this.lookAtLockFader=0),this.lookAtPerc.x=this.lookAtLockPerc),this.lookAtLockPerc>0)){var u=this.camera.quaternion.clone();this.camera.lookAt(this.cameraAimTarget.position);var d=this.camera.quaternion.clone();1==this.lookAtLockPerc?this.camera.setRotationFromQuaternion(d):this.camera.setRotationFromQuaternion(d.slerp(u,.5*Math.cos(this.lookAtLockPerc*pi)+.5))}}warpEventTriggered(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"init";this.warpActive||(this.pxlEnv.mapComposerWarpPass.needsSwap=!0,this.warpType=u,this.warpObj=d,this.warpTarget=v,this.warpActive=!0,this.pxlEnv.initWarpVisual(u))}warpCamRun(){if(0==this.warpType)this.setToObj(this.warpObj);else if(1==this.warpType){var u="init"==this.warpTarget;this.warpToRoom(this.warpObj,u,this.warpTarget)}this.pxlEnv.setExposure(this.uniformScalars.exposureUniformBase),this.warpObj=null,this.warpTarget=null,this.warpActive=!1}lowQualityUpdates(){if(this.HDRView){var u=new j.Vector3(0,0,-1).applyQuaternion(this.camera.quaternion),d=u.clone().multiply(new j.Vector3(1,0,1)).normalize();this.camRotPitch.set(.1591549430918955*-Math.atan2(d.x,d.z),.5*u.y)}}midQualityUpdates(){if(this.pxlQuality.settings.motion){var u,d=new j.Vector3(0,0,0);if(d.applyQuaternion(this.camera.quaternion),this.camRotXYZ.multiplyScalar(.8).add(d.multiplyScalar(.2)),this.pxlDevice.mobile){var v=.5*sW,x=.5*sH,y=new j.Vector3(0,0,10),b=new j.Vector3(0,0,10);y.applyQuaternion(this.camera.quaternion.clone()).project(this.camera),b.applyQuaternion(this.prevQuaternion).project(this.camera),y.x=(y.x+1)*v,y.y=-(y.y-1)*x,b.x=(b.x+1)*v,b.y=-(b.y-1)*x;(u=b.clone().sub(y.clone()).multiplyScalar(.6).multiply(new j.Vector3(this.pxlDevice.screenRes.x,this.pxlDevice.screenRes.y,0))).length>.1&&u.normalize().multiplyScalar(.1)}else u=this.pxlDevice.touchMouseData.velocity.clone().multiplyScalar(Math.max(this.pxlDevice.screenRes.x,this.pxlDevice.screenRes.y));var _=new j.Vector2(u.x,-u.y),w=new j.Vector2(0,0).lerpVectors(this.pxlEnv.blurDirPrev,_,.85);this.pxlEnv.blurDirPrev.set(this.pxlEnv.blurDirCur),this.pxlEnv.blurDirCur.set(w)}}emitCameraTransforms(u,d){}jogServerMemory(){var u=this.cameraPos.clone(),d=this.getUserHeight();this.emitCameraTransforms(u,d,!0)}updateCamera(){this.updateStaticCameraRotation();var u=this.pxlDevice.touchMouseData.velocity.length();if(this.pxlDevice.touchMouseData.curFadeOut.multiplyScalar(.7),this.camUpdated||0!=u||this.pxlDevice.touchMouseData.active){this.camUpdated=!1;this.updateDeviceValues(u),this.pxlUser.localUserTurned=0==this.pxlDevice.touchMouseData.velocity.length(),this.prevQuaternion.copy(this.camera.quaternion);var d=this.initFrameCamPosition(),v=this.getUserHeight();if(this.canMove){if(this.pxlEnv.currentRoom==this.pxlEnv.mainRoom){d=this.mainColliderCheck(d,null)}else d=this.roomColliderCheck(d,v);this.updateGravity(),this.colliderValid||this.colliderValidityChecked?this.jump=0:this.jump=this.checkColliderValid(d),this.eventCheckStatus=!0,d=this.applyGravity(d),this.pxlUser.localUserMoved=this.gravityActive||(this.cameraMovement[0]**2+this.cameraMovement[1]**2)**.5>0,this.cameraPrevPos=this.cameraPos.clone(),this.cameraPos=d.clone(),d.y+=v,this.camera.position.copy(d)}this.canMove?this.updateRoamCameraRotation():this.updateStaticCameraRotation(),this.camera.updateMatrixWorld(),this.emitCameraTransforms(d,v),this.cameraBooted=!0}else this.pxlUser.localUserMoved=!1,this.pxlUser.localUserTurned=!1}},AutoCamera:class pxlNav_AutoCamera{constructor(){var u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.enabled=u,this.active=!1,this.mobile=null,this.pxlTimer=null,this.pxlUtils=null,this.pxlDevice=null,this.pxlAudio=null,this.pxlCamera=null,this.pxlEnv=null,this.camera=null,this.netDistance=new j.Vector2,this.prevCamChange=0,this.nextCamChange=0,this.delayRange=[25,45],this.autoCamActive=!1,this.autoCamMode=0,this.autoCamPaths={},this.resetAutoCam=!0,this.autoCamPrevPos=null,this.autoCamPrevLookAt=null,this.touchBlender=!1,this.autoCamId=0,this.camMode=0,this.curModeCount=0,this.curRoom="",this.curRoomIndex=0,this.curPath=0,this.roomList=[],this.pathCounts={},this.forceNewRoom=!1,this.curRoomCount=0,this.avatarMin=0,this.avatarValid=!1,this.curAvatar=null,this.clusterReturn=!1,this.curCluster=[],this.clusterValid=2,this.clusterRotation=0,this.clusterRotRate=.005}setDependencies(pxlNav){this.pxlTimer=pxlNav.pxlTimer,this.pxlUtils=pxlNav.pxlUtils,this.pxlDevice=pxlNav.pxlDevice,this.pxlAudio=pxlNav.pxlAudio,this.pxlCamera=pxlNav.pxlCamera,this.pxlEnv=pxlNav.pxlEnv,this.camera=pxlNav.pxlCamera.camera}init(){this.active=this.enabled||this.mobile,this.autoCamActive=this.autoCamActive||this.mobile;var{roomList:u,pathCounts:d}=this.getAutoCamData();this.roomList=u,this.curRoom=this.roomList[0],this.pathCounts=d,this.setRoom(!1,!0),this.getNextPath(),this.checkStatus()}step(){var u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(null==this.autoCamActive||null==this.active)return this.autoCamActive=!1,this.active=!1,!0;if(0==this.active){if(!this.autoCamActive)return!0;this.updateAutoCamera()}if((this.pxlTimer.curMS>=this.nextCamChange||u)&&this.active&&!this.pxlDevice.touchMouseData.active){if(!u||!this.enabled){var d=this.checkCamMode();this.setNextTrigger(d)}this.curAvatar=0,this.camera.up.set(0,1,0),this.pxlDevice.touchMouseData.netDistance.multiplyScalar(0),1==this.camMode||2==this.camMode?this.setCamMode(0):(this.curCluster=[],this.stepDroneCam()),this.setAutoCamMode(this.camMode)}return this.updateAutoCamera(),this.applyTouchRotate(),!1}checkCamMode(){var u=this.camMode;return this.camMode=0,this.enabled&&this.active?(this.camMode!=u&&0==this.camMode&&(this.forceNewRoom=!0),1):1}setCamMode(u){1==u.type||2==u.type||(this.camMode=0,this.forceNewRoom=!0),this.step(!0)}stepDroneCam(){var u=!0,d=Math.random(this.nextCamChange),v=this.pathCounts[this.pxlEnv.currentRoom];this.curRoomCount>=2*v&&(this.forceNewRoom=!0),(d<.3||this.forceNewRoom)&&(this.setRoom(),u=!1),this.curRoomCount+=1,this.getNextPath(u)}setRoom(){var u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.active||this.autoCamActive){var v=this.curRoomIndex,x=this.roomList.length;this.pxlEnv.postIntro?d||(u||(v=Math.floor(Math.random()*x))==this.curRoomIndex)&&(v=(v+1)%x):v=0,this.curRoomIndex=v,this.curRoom!=this.roomList[v]&&(this.curRoom=this.roomList[v],this.forceNewRoom=!1,this.curRoomCount=0,this.pxlCamera.warpEventTriggered(1,this.curRoom,"init"))}}setNextTrigger(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=Math.random(this.nextCamChange);d=(this.delayRange[1]-this.delayRange[0])*d+this.delayRange[0],this.nextCamChange=this.pxlTimer.curMS+d*u}getNextPath(){var u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(this.autoCamPaths.hasOwnProperty(this.pxlEnv.currentRoom)){var v=this.autoCamPaths[this.pxlEnv.currentRoom].length;if(this.curPath=(this.curPath+d)%v,u&&0==d){var x=Math.random(this.nextCamChange);x=Math.floor(x*this.autoCamPaths[this.pxlEnv.currentRoom].length),this.curPath==x&&(x=(x+1)%v),this.curPath=x}else this.curPath=this.curPath<0?v-1:this.curPath,this.setNextTrigger(1);this.setAutoCamPath(this.curPath)}}checkStatus(){(this.autoCamActive||this.pxlDevice.mobile||this.active)&&this.toggleAutoCam(!0)}preAutoCamToggle(){this.autoCamActive||"AudioTrigger_2"==this.pxlCamera.colliderCurObjHit&&(this.pxlCamera.proximityScaleTrigger=!0,this.exposureShiftActive=!0),this.toggleAutoCam()}setAutoCamMode(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.autoCamMode=u,1==u&&(this.resetAutoCam=!0)}setPosQuat(u,d){this.camera.quaternion.copy(d),this.camera.position.copy(u),this.pxlCamera.updateCameraMatrices(),this.pxlCamera.camUpdated=!0}toggleAutoCam(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(this.pxlEnv.fogMult.x=1,this.autoCamPaths[this.pxlEnv.currentRoom]){this.curRoom=this.pxlEnv.currentRoom;var v=this.autoCamPaths[this.pxlEnv.currentRoom].length;isNaN(this.autoCamId)&&(this.autoCamId=v-1);var x=this.autoCamActive;if(this.autoCamActive=null==u&&v>0?!this.autoCamActive:u,this.autoCamActive=this.mobile||this.autoCamActive,!x&&this.autoCamActive&&(this.netDistance=(new j.Vector2).copy(this.pxlDevice.touchMouseData.netDistance)),this.pxlDevice.touchMouseData.netDistance.multiplyScalar(0),this.autoCamActive){this.pxlCamera.resetGravity(),this.autoCamId=(this.autoCamId+d)%v,this.autoCamId=this.autoCamId<0?v-1:this.autoCamId;var y=this.autoCamPaths[this.pxlEnv.currentRoom][this.autoCamId];this.totalLoopDuration=y.position.userData.duration;try{this.autoCamPositions=y.position.geometry.attributes.position,this.autoCamLookAt=y.lookAt.geometry.attributes.position,y.up?this.autoCamUp=y.up.geometry.attributes.position:(this.autoCamUp=null,this.camera.up.set(0,1,0)),this.numControlPoints=this.autoCamPositions.array.length/3,this.autoCamStartTime=this.pxlTimer.curMS-this.totalLoopDuration*Math.random()}catch(u){}}else this.setPosQuat(this.pxlCamera.cameraPrevPos.clone(),this.pxlCamera.prevQuaternion.clone()),this.pxlDevice.touchMouseData.netDistance.copy(this.netDistance)}}prevNextAutoCam(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.autoCamActive&&(this.enabled&&this.active&&!d?this.nextCamChange=this.pxlTimer.curMS:this.toggleAutoCam(!0,u))}setAutoCamPath(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.autoCamActive&&(this.autoCamId=u,this.toggleAutoCam(!0,0))}getAutoCamData(){var u=Object.keys(this.autoCamPaths),d={};return u.forEach((u=>{d[u]=this.autoCamPaths[u].length})),{roomList:u,pathCounts:d}}getAutoCamValueFromCurve(u,d,v){var x=u[3*d],y=u[3*d+1],b=u[3*d+2],_=(d+1)%this.numControlPoints,w=u[3*_],S=u[3*_+1],C=u[3*_+2],P=new j.Vector3(x,y,b),A=new j.Vector3(w,S,C);return P.lerp(A,v),P}updateAutoCamera(){if(this.autoCamPositions&&this.autoCamPositions.array){var u=(this.pxlTimer.curMS-this.autoCamStartTime)%this.totalLoopDuration/this.totalLoopDuration;u*=this.numControlPoints-1;var d=Math.floor(u),v=u-d,x=this.getAutoCamValueFromCurve(this.autoCamPositions.array,d,v,!1);this.camera.position.copy(x);var y=this.getAutoCamValueFromCurve(this.autoCamLookAt.array,d,v);if(this.camera.lookAt(y),this.autoCamUp){var b=this.getAutoCamValueFromCurve(this.autoCamUp.array,d,v);b=b.sub(x).normalize(),this.camera.up.copy(b)}}}applyTouchRotate(){var u=1;this.touchBlender?(u=Math.min(1,Math.max(0,this.pxlTimer.curMS-this.pxlDevice.touchMouseData.releaseTime)),u*=u,this.pxlDevice.touchMouseData.netDistance.multiplyScalar(1-u),this.touchBlender=u<1):this.pxlDevice.touchMouseData.netDistance.multiplyScalar(.5);var d=new j.Euler;d.set(this.pxlDevice.touchMouseData.netDistance.y/this.pxlDevice.sH*2,this.pxlDevice.touchMouseData.netDistance.x/this.pxlDevice.sW*2,0,"YXZ");var v=(new j.Quaternion).clone(this.camera.quaternion);v.setFromEuler(d),(v=this.camera.quaternion.clone().multiply(v)).normalize(),this.touchBlender&&v.slerp(this.camera.quaternion.clone(),u).normalize();var x=new j.Vector3(0,0,-10).applyQuaternion(v).add(this.camera.position);this.camera.setRotationFromQuaternion(v),this.camera.lookAt(x),this.camera.up.set(0,1,0)}},Extensions:qs.Extensions,MusicUtils:class pxlNav_MusicUtils{constructor(){this.audioObject=null}},Audio:class pxlNav_Audio{constructor(){this.pxlTimer=null,this.pxlVideo=null,this.pxlDevice=null,this.pxlEnv=null,this.pxlGuiDraws=null,this.pxlSocket=null,this.active=!1,this.audioTimer=new j.Vector3(0,0,0),this.audioEq=new j.Vector4(0,0,0,0),this.audioWorker=null,this.audioProcessor=null,this.djUrlSource="//",this.djMuted=!1,this.djAudioVolume=0,this.djAudioVolumeMax=.65,this.djAudioVolumeMin=.25,this.djAudioVolumeScalar=.25,this.djAudioObj=null,this.djTimecodeObj=null,this.djVolumeParentObj=null,this.djVolumeObj=null,this.roomAudioStopped=!0,this.videoStreamObjects=[],this.colliderVolActive=!1,this.isVideoObject=!1,this.activeObject=null,this.fadeActive=!1,this.fadeAdjustRate=.02,this.fadeDir=0,this.fadePerc=0,this.audioContext=null}setDependencies(pxlNav){this.pxlTimer=pxlNav.pxlTimer,this.pxlVideo=pxlNav.pxlVideo,this.pxlDevice=pxlNav.pxlDevice,this.pxlEnv=pxlNav.pxlEnv,this.pxlGuiDraws=pxlNav.pxlGuiDraws,this.pxlSocket=pxlNav.pxlSocket}init(){this.active=!0}postBoot(){if(this.djAudioObj){if(this.pxlEnv.pxlAutoCam.enabled)this.djAudioVolumeMax=1,this.djAudioVolumeMin=0;else if(this.pxlEnv.mobile){var u=this,d=this.djAudioVolumeMax,v=document.getElementById("guiMobileWelcomeButton");function audioClickMonitor(y){setTimeout((()=>{u.djAudioVolume=0,u.djAudioVolumeMax=d,u.djAudioVolumeMin=0,u.djAudioObj.byScript=!0,u.djAudioObj.volume=0,x.play().then((()=>{u.djPlayerMuteToggle(!1),u.setFadeActive(.5)})),v.removeEventListener("click",audioClickMonitor),v.removeEventListener("touchstart",audioClickMonitor)}),500)}v.addEventListener("click",audioClickMonitor),v.addEventListener("touchstart",audioClickMonitor)}this.djAudioVolume=this.pxlEnv.enabled?0:this.djAudioVolumeMin,this.djAudioObj.volume=this.pxlEnv.enabled?0:this.djAudioVolumeMin,this.djPlayerMuteToggle(!1),this.djPlayerAdjustVolume({}),this.djPlayerSetSliderGui();var x=this.djAudioObj;x.setAttribute("autoplay",!0);var y=this;this.djAudioObj.addEventListener("volumechange",(u=>{y.djPlayerSetSliderGui()}),!0)}}start(){}step(){this.djAudioObj&&this.djAudioObj.paused&&(this.djAudioObj.play().catch((u=>{})),this.djAudioObj.muted=this.djMuted||!this.roomAudioStopped),this.fadeAudioEvent()}isPaused(){var u=!0;return this.djAudioObj&&(u=this.djAudioObj.paused),u}pausePlayback(){this.active=this.pxlTimer.active,this.active?this.play():this.stop()}initPlay(){this.pxlVideo.canUnmute("dj")&&!this.isPaused()&&(this.djPlayerMuteToggle(!1),this.setFadeActive(1),this.pxlDevice.mobile&&this.pxlGuiDraws.toggleIcon(this.pxlGuiDraws.hudIcons.musicIcon,!this.djMuted,!0))}play(){if(this.active=!0,this.isVideoObject)this.pxlVideo.setVolume("dj",this.djAudioVolume),this.pxlVideo.setMuted("dj",this.djMuted);else{this.djAudioObj.byScript=!0;var u=this.djAudioObj;u.children[0].setAttribute("src",this.djUrlSource),setTimeout((()=>{u.load(),setTimeout((()=>{u.volume=this.djAudioVolume,u.muted=this.djMuted||!this.roomAudioStopped,u.paused&&u.play()}),20)}),20)}}stop(){if(this.active=!1,this.isVideoObject)this.pxlVideo.setMuted("dj",!0);else{var u=this.djAudioObj;u.children[0].setAttribute("src",""),u.pause(),setTimeout((()=>{u.load()}),20)}}djBuildPlayer(){this.djAudioObj=document.getElementById("djStream"),this.djVolumeParentObj=document.getElementById("djPlayerVolumeParent"),this.djVolumeObj=document.getElementById("djPlayerVolume"),this.djAudioObj.byScript=!1,this.djAudioObj.volume=0,this.djVolumeObj.style.width="0%";var u=this;this.pxlDevice.objectPercList.push("djPlayerVolume"),this.pxlDevice.objectPercList.push("djPlayerVolumeParent"),this.pxlDevice.objectPercFuncList.djPlayerVolumeParent=d=>{u.djPlayerAdjustVolume(d)},this.djVolumeParentObj.down=!1,this.djVolumeParentObj.addEventListener("mousedown",(d=>{u.djVolumeParentObj.down=!0,u.djPlayerAdjustVolume(d)})),this.djVolumeParentObj.addEventListener("mousemove",(d=>{u.djPlayerAdjustVolume(d)})),this.djVolumeParentObj.addEventListener("mouseup",(d=>{u.djVolumeParentObj.down=!1})),this.pxlDevice.mobile&&(this.djVolumeParentObj.style.width="30vw",this.djVolumeParentObj.addEventListener("touchstart",(d=>{u.djVolumeParentObj.down=!0}),{passive:!0}),this.djVolumeParentObj.addEventListener("touchmove",(d=>{u.djPlayerAdjustVolume(d)}),{passive:!0}),this.djVolumeParentObj.addEventListener("touchend",(d=>{u.djVolumeParentObj.down=!1}),{passive:!0})),this.djAudioObj.muted=!0,this.prepAudioProcessor()}prepAudioProcessor(){}stepAudioProcessor(){}recieveAudioProcessor(u){}buildRemoteAudioMixer(u,d){return!1}loadStreamPromise(){var u=this.djAudioObj;return new Promise(((d,v)=>{this.djAudioObj.byScript=!0,u.children[0].setAttribute("src",this.djUrlSource),u.load(),u.muted=this.djMuted||!this.roomAudioStopped})).then((()=>{})).catch((u=>{console.log("error source")}))}djPlayerSetSliderGui(){this.djAudioObj.byScript||!this.pxlEnv.postIntro||this.pxlEnv.pxlAutoCam.enabled?this.djAudioObj.byScript=!1:(this.fadeActive=!1,this.djAudioVolumeMax=this.djAudioVolume,this.djAudioVolumeMin=this.djAudioVolume*this.djAudioVolumeScalar),this.djVolumeObj.style.width=100*this.djAudioVolume*~~!this.djMuted+"%"}djPlayerAdjustVolume(u){if(this.djVolumeParentObj.down||this.djVolumeParentObj.down&&u.touches){var d=this.djVolumeParentObj.offsetWidth,v=0;v=u.touches?this.pxlDevice.objectPerc.percX:u.offsetX/d;var x=Math.max(0,Math.min(1,v));this.djAudioVolume=x,this.djAudioVolumeMax=x,this.djAudioVolumeMin=.1*x,x*=x,this.djAudioObj&&(this.djAudioObj.volume=x),u.touches&&this.djPlayerSetSliderGui()}this.pxlVideo&&this.pxlEnv.posted&&this.pxlVideo.setVolume("dj",this.djAudioVolume)}djPlayerMuteToggle(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.djMuted=null==u?!this.djMuted:u,null!=u&&this.pxlGuiDraws.toggleIcon(this.pxlGuiDraws.hudIcons.musicIcon,!u,!0),this.djAudioObj&&(this.djAudioObj.muted=this.djMuted,this.djAudioObj.byScript=!0,this.djAudioObj.volume=this.djAudioObj.volume),this.pxlVideo&&this.pxlEnv.posted&&this.pxlVideo.setMuted("dj",this.djMuted)}setFadeActive(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.fadeDir!=u&&(this.fadeDir=u,this.fadeActive=!0)}fadeAudioEvent(){if(this.djVolumeParentObj&&!this.djVolumeParentObj.down&&this.fadeActive&&this.pxlEnv.postIntro){if(this.fadePerc+=this.fadeAdjustRate*this.fadeDir,this.fadePerc<0||this.fadePerc>1)return this.fadePerc=1==this.fadeDir?1:0,void(this.fadeActive=!1);var u=(this.djAudioVolumeMax-this.djAudioVolumeMin)*this.fadePerc+this.djAudioVolumeMin;this.djAudioVolume=u,u*=u,this.djAudioObj&&(this.djAudioObj.byScript=!0,this.djAudioObj.volume=u),this.pxlVideo.setVolume("dj",this.djAudioVolume)}}},Video:class pxlNav_Video{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.pxlUtils=d,this.pxlAudio=v,this.pxlFile=x,this.pxlGuiDraws=y,this.pxlEnv=null,this.posted=!1,this.djStreamUrl="",this.performerStreamUrl="",this.screenVideoBlock=null,this.screenVideos={},this.videoStreams={},this.videoStreamFailCount=0,this.videoStreamFailMax=5,this.videoAudioEvent={dj:!1,performer:!1},this.checkForDjStream=!1,this.checkForPerformerStream=!1,this.videoStills={dj:{texture:null,url:u+"SoftNoise_512.jpg"},performer:{texture:null,url:u+"SoftNoise_512.jpg"}}}init(){this.buildVideoBlock(),this.buildPromoVideos()}buildVideoBlock(){if(null==this.screenVideoBlock){var u=document.createElement("div");u.classList.add("videoScreenBlockStyle"),document.body.appendChild(u),this.screenVideoBlock=u}}buildPromoVideos(){[].forEach((u=>{var d=u.name,v=u.type,x=u.intensity,y=u.boost,b=u.file,_=u.landscape,w=this.pxlFile.vidRoot+b,S=document.createElement("video");S.id="screenVideo_"+d+"_"+(_?"port":"land"),S.src=w,S.classList.add("bgMediaAssets"),S.controls=!1,S.muted=!0,S.preload="true",S.setAttribute("autoplay",""),S.setAttribute("muted",""),S.setAttribute("playsinline",""),S.setAttribute("loop",""),this.screenVideoBlock.appendChild(S),this.screenVideos[d]||(this.screenVideos[d]={}),this.screenVideos[d].name=d,this.screenVideos[d].type=v,x&&(this.screenVideos[d].intensity=x),y&&(this.screenVideos[d].boost=y);var C=this.screenVideos[d].file||[];this.screenVideos[d].file?C[~~_]=w:C=[w,w],this.screenVideos[d].file=C;var P=this.pxlUtils.getVideoTexture(S),A=this.screenVideos[d].texture||[];this.screenVideos[d].texture?A[~~_]=P:A=[P,P],this.screenVideos[d].texture=A;var T=[];this.screenVideos[d].videoObjs?T[~~_]=S:T=[S,S],this.screenVideos[d].videoObjs=T}))}boot(){var u=this;return pxlNav_Video_asyncToGenerator((function*(){u.videoAudioEvent.dj?u.buildVideoPlayer("dj"):u.videoStills.dj.texture=u.pxlUtils.loadTexture(u.videoStills.dj.url)}))()}buildVideoPlayer(u){var d=this,v=document.createElement("video");v.id="antibodyDjStream",v.classList.add("bgMediaAssets"),v.controls=!1,v.volume=0,v.muted=!0,v.setAttribute("autoplay","true"),v.setAttribute("playsinline","true"),v.addEventListener("volumechange",(u=>{v.volume=Math.min(v.volume,d.pxlAudio.djAudioVolume)}),!0),this.screenVideoBlock.appendChild(v),this.videoStreams[u]={},this.videoStreams[u].mode=0,this.videoStreams[u].active=!1,this.videoStreams[u].loading=!1,this.videoStreams[u].checkResolve=!1,this.videoStreams[u].prevCheck=this.pxlUtils.curMS+5,this.videoStreams[u].delayCheck=5,this.videoStreams[u].obj=v,this.videoStreams[u].url=this.djStreamUrl,this.videoStreams[u].urlStatus=!1,this.videoStreams[u].player=null,this.videoStreams[u].checkScreens=!1,this.videoStreams[u].activeLevel=-1,this.videoStreams[u].prevFrame=0,this.videoStreams[u].prevFrameCount=0,this.videoStreams[u].canvasObj=null,this.videoStreams[u].videoTexture=this.getTexture(u),this.pxlFile.urlExists(this.djStreamUrl).then((d=>{this.videoStreams[u].urlStatus=d})),this.buildVideoStream(u,!1)}postBoot(u){this.videoStreams[u]&&this.videoStreams[u].urlStatus&&this.load(u,this.videoStreams[u].url),this.posted=!0,this.checkForDjStream=this.videoAudioEvent.dj}step(){var u=!1,d="dj";if(this.videoAudioEvent[d]){var v=this.videoStreams[d];v&&(v.active||this.checkVideoStreamStatus(d),this.pxlUtils.mobile?v.active&&v.videoTexture&&v.checkScreens&&(v.checkScreens=!1,this.setScreensToStreams(1,v.videoTexture)):(u=v.checkScreens,v.checkScreens=!1))}else this.videoStills[d].texture&&this.pxlUtils.mobile&&this.setScreensToStreams(1,this.videoStills[d].texture);return u}setScreensToStreams(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"dj",v=d;"string"==typeof v&&((v=this.getTexture(d))||(u=0,this.videoStreams[d].active=!1,this.videoStreams[d].checkScreens=!0)),this.pxlEnv.camScreenData.screenGeoList.forEach(((d,x)=>{d.material.uniforms.camExists.value=u,d.material.uniforms.videoFeed.value=v}))}isActive(u){var d=!1;return this.videoStreams.hasOwnProperty(u)?this.videoStreams[u].active&&this.videoStreams[u].videoTexture&&(d=!0):d=null!=this.videoStills[u].texture,d}getTexture(u){var d=null;return this.videoAudioEvent[u]?(this.videoStreams[u].videoTexture||(this.videoStreams[u].videoTexture=this.buildVideoTexture(u)),d=this.videoStreams[u].videoTexture):this.videoStills[u].texture&&(d=this.videoStills[u].texture),d}buildVideoTexture(u){return this.disposeVideoTexture(u),this.videoStreams[u].obj&&this.videoStreams[u].player?this.pxlUtils.getVideoTexture(this.videoStreams[u].obj):null}disposeVideoTexture(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.videoStreams[u].videoTexture&&(this.videoStreams[u].videoTexture.dispose(),this.videoStreams[u].videoTexture=null,this.videoStreams[u].checkScreens=null==d||d)}resetvideoTexture(u){this.setScreensToStreams(0,u),this.disposeVideoTexture(u,!1);var d=this.getTexture(u);this.videoStreams[u].videoTexture=d,this.videoStreams[u].checkScreens=!0}resetEnvSettings(u){this.resetvideoTexture(u),this.videoStreams[u].checkScreens=!1}hlsPreflight(){var u=window.MediaSource||window.WebKitMediaSource;u=u&&"function"==typeof u.isTypeSupported&&u.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"');var d=window.SourceBuffer||window.WebKitSourceBuffer;return d=!d||d.prototype&&"function"==typeof d.prototype.appendBuffer&&"function"==typeof d.prototype.remove,u&&d}buildVideoStream(u){var d=this;this.videoStreams[u].obj;if("undefined"!=typeof IVSPlayer)this.buildIvsPlayer(u);else{this.pxlFile.loadScript("https://player.live-video.net/1.1.2/amazon-ivs-player.min.js").then((()=>{d.buildIvsPlayer(u)}))}}buildVhsPlayer(u){if(videojs){this.videoStreams[u].mode=1;var d=this.videoStreams[u].obj,v=videojs(d,{controls:!1,autoplay:!0,preload:"auto"});videojs.log.level("off"),videojs.log.level("error"),this.videoStreams[u].player=v;var x=this;v.ready((function(){var u=v.play();u&&u.catch((function(u){document.addEventListener("click",(function vhsClickMonitor(u){var d=v.networkState();1!=d&&2!=d||(v.play(),document.removeEventListener("click",vhsClickMonitor))}))}))})),v.on("play",(d=>{x.ready(u)})),v.on("loadedmetadata",(d=>{x.start(u)})),v.on("waiting",(d=>{var y=v.currentTime(),b=v.duration();b>0&&setTimeout((()=>{var d=v.currentTime(),_=v.duration();y==d&&b==_&&this.pxlFile.urlExists(v.src()).then((d=>{d||x.ended(u)})).catch((()=>{x.ended(u)}))}),500)})),v.on("ended",(d=>{x.ended(u)})),v.on("error",(d=>{x.ended(u)}))}else this.buildFallbackPlayer(u)}buildHlsPlayer(u){if(Hls.isSupported()){this.videoStreams[u].mode=4;var d=this.videoStreams[u].obj,v=new Hls({enableWorker:!0,liveBackBufferLength:900,startLevel:2,stretchShortVideoTrack:!0,nudgeOffset:.5,fragLoadingTimeOut:2e3});v.attachMedia(d),this.videoStreams[u].player=v;var x=this;v.on(Hls.Events.MEDIA_ATTACHED,(function(d){x.ready(u)})),v.on(Hls.Events.BUFFER_CREATED,(function(u){})),v.on(Hls.Events.MANIFEST_PARSED,(function(d){x.start(u)})),v.streamController.onMediaEnded=function(d){x.ended(u)},v.on(Hls.Events.ERROR,(function(d,y){y.fatal?x.ended(u):"bufferFullError"!=y.details&&"bufferAppendingError"!=y.details||v.recoverMediaError()})),v.on(Hls.Events.STREAM_STATE_TRANSITION,(function(d,y){"PARSED"==y.previousState&&"IDLE"==y.nextState&&(x.videoStreams[u].activeLevel=v.currentLevel,-1==v.currentLevel&&setTimeout((()=>{-1==v.currentLevel&&v.recoverMediaError()}),1e3))}))}else this.buildFallbackPlayer(u)}sendModMessage(u,d,v){var x={msg:u,init:d,data:v};this.pxlEnv.pxlSocket.sendErrorMsg(x)}buildFallbackPlayer(u){var d=this.videoStreams[u].obj;this.videoStreams[u].mode=2,d.setAttribute("src",this.videoStreams[u].urlStatus?this.videoStreams[u].url:"");var v=this;d.addEventListener("error",(function(u,d){})),d.addEventListener("loadedmetadata",(function(d){v.ready(u)})),d.addEventListener("canplay",(function(x){d.play(),v.start(u)})),d.addEventListener("suspend",(function(d){v.ended(u)})),d.addEventListener("ended",(function(d){v.ended(u)}))}buildIvsPlayer(u){if(IVSPlayer.isPlayerSupported){this.videoStreams[u].mode=3;var d=this.videoStreams[u].obj,v=IVSPlayer.create();v.attachHTMLVideoElement(d),v.setAutoplay(!0),v.setLogLevel("Error"),this.videoStreams[u].loading=!0,this.videoStreams[u].player=v,this.videoStreams[u].checkScreens=!1;var x=this,y=IVSPlayer.PlayerState;v.addEventListener(y.READY,(d=>{x.ready(u)})),v.addEventListener(y.PLAYING,(d=>{x.start(u)})),v.addEventListener(y.ENDED,(d=>{x.ended(u)}));var b=IVSPlayer.PlayerEventType;v.addEventListener(b.ERROR,((d,v,y,b)=>{x.ended(u,d)}))}else this.buildFallbackPlayer(u)}unload(u){}load(u,d){var v=this.videoStreams[u];if(v)switch(v.mode){case 1:this.videoStreams[u].url=d,v.player.src({type:"application/x-mpegURL",src:d}),v.player.load();break;case 2:v.obj.setAttribute("src",d),v.obj.load();break;case 3:v.player.load(d);break;case 4:v.player&&this.destroyPlayer(u,!0),v.player.attachMedia(this.videoStreams[u].obj);var x=decodeURIComponent(d);v.player.loadSource(x)}}newStream(u){}canUnmute(u){var d=!0;return this.videoStreams[u]&&(d=this.videoStreams[u].active),d}setMuted(u){var d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],v=this.videoStreams[u];v&&(v.obj.muted=d)}setVolume(u,d){var v=this.videoStreams[u];v&&(v.obj.volume=d)}getStreamState(u){var d=!1,v=this.videoStreams[u];switch(v.mode){case 1:case 2:d=!v.obj.paused;break;case 3:var x=v.player;d=x.core.isLoaded&&!x.core.paused;break;case 4:d=null!=v.player.streamController.lastCurrentTime}return d}checkVideoError(u){var d=this.videoStreams[u];d.active&&4==d.mode&&(0==d.obj.videoWidth?!d.obj.paused&&d.player.streamController.lastCurrentTime>10&&(this.destroyPlayer(u),this.videoStreams[u].active=!1,this.checkForDjStream=!0,this.buildHlsPlayer(u),this.videoStreams[u].player.recoverMediaError()):d.obj.webkitDecodedFrameCount==d.prevFrame?(this.videoStreams[u].prevFrameCount+=1,this.videoStreams[u].prevFrameCount>50&&(console.log("trigger level drop"),this.videoStreams[u].prevFrameCount=0,this.videoStreams[u].player.recoverMediaError(),this.videoStreams[u].player.nextLoadLevel=Math.max(0,this.videoStreams[u].player.currentLevel-1),this.videoStreams[u].player.recoverMediaError())):(this.videoStreams[u].prevFrame=d.obj.webkitDecodedFrameCount,-1!=this.videoStreams[u].player.nextLevel&&(this.videoStreams[u].player.nextLevel=-1),this.videoStreams[u].prevFrameCount=0))}ready(u){this.videoStreams[u].loading=!1,this.videoStreams[u].obj.volume=0,this.videoStreams[u].activeLevel=1}start(u){var d=this.videoStreams[u];if(!d.active){d.obj,d.player;var v=this.getStreamState(u);this.videoStreams[u].active=v,this.videoStreams[u].videoTexture||(this.videoStreams[u].videoTexture=this.getTexture(u)),this.pxlAudio.isVideoObject=!0,this.videoStreamFailCount=0,this.checkForDjStream=!1,this.videoStreams[u].checkScreens=!0,this.pxlAudio.djAudioObj.byScript=!0;var x=this.pxlAudio.djAudioObj;x.children[0].setAttribute("src",""),x.pause(),x.muted=!0,setTimeout((()=>{x.load(),setTimeout((()=>{this.pxlAudio.roomAudioStopped&&(d.obj.volume=this.pxlAudio.djAudioVolume),d.obj.muted=this.pxlAudio.djMuted||!this.pxlAudio.roomAudioStopped,d.obj.click()}),20)}),20)}}restart(u){var d=!1,v=this.videoStreams[u].player,x=this.videoStreams[u].obj;switch(this.videoStreams[u].mode){case 1:case 2:d=!x.paused;break;case 3:d=v.core.isLoaded&&!v.core.paused;break;case 4:d=v.currentLevel>-1}this.videoStreams[u].active=d,this.videoStreams[u].checkScreens=d}ended(u){var d=this.videoStreams[u];if(d.active){this.destroyPlayer(u);var v=4==d.mode?!d.player.liveTracker.atLiveEdge():!d.obj.paused;this.videoStreams[u].active=v,this.checkForDjStream=this.videoAudioEvent.dj,this.pxlAudio.isVideoObject=!1,this.videoStreams[u].checkScreens=!0,this.pxlAudio.roomAudioStopped&&(d.obj.volume=0),d.obj.pause(),d.obj.muted=!0,this.pxlAudio.djAudioObj.byScript=!0;var x=this.pxlAudio.djAudioObj,y=x.children[0];""==y.getAttribute("src")&&(y.setAttribute("src",this.pxlAudio.djUrlSource),x.load(),x.muted=this.pxlAudio.djMuted||!this.pxlAudio.roomAudioStopped,x.play()),this.videoStreams[u].prevCheck=this.pxlUtils.curMS+15,this.videoStreams[u].activeLevel=-1}}error(u,d){var v;v="object"==typeof d?d.type:d;["ErrorNetworkIO","networkError","mediaError","internalException"].includes(v)&&(tmpThis.videoStreams[u].active=!1)}destroyPlayer(u){var d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];4==this.videoStreams[u].mode&&(this.videoStreams[u].active||d)&&this.videoStreams[u].player&&this.videoStreams[u].player.detachMedia()}streamState(u){var d=this;return pxlNav_Video_asyncToGenerator((function*(){var v=!0,x=!0;d.videoStreams.dj&&(v=!d.videoStreams.dj.active),d.videoStreams.performer&&(x=!d.videoStreams.performer.active),1==u.hasOwnProperty("dj")&&v&&(d.checkForDjStream=u.dj&&d.videoAudioEvent.dj),1==u.hasOwnProperty("performer")&&x&&(d.checkForPerformerStream=u.performer&&d.videoAudioEvent.performer)}))()}checkVideoStreamStatus(u){var d=this;return pxlNav_Video_asyncToGenerator((function*(){var v=d.videoStreams[u];v&&d.checkForDjStream&&d.posted&&!v.active&&v.prevCheck+v.delayCheck<d.pxlUtils.curMS&&(d.checkForDjStream=!1,d.pxlFile.urlExists(d.videoStreams[u].url).then((v=>{d.videoStreams[u].urlStatus=v,d.checkForDjStream=!v,d.videoStreams[u].prevCheck=d.pxlUtils.curMS,d.videoStreams[u].checkResolve=d.pxlUtils.curMS,v?d.load(u,d.videoStreams[u].url):d.videoStreamFailCount+=1})).catch((v=>{console.log(v),d.videoStreamFailCount+=1,d.checkForDjStream=!0,d.videoStreams[u].prevCheck=d.pxlUtils.curMS})))}))()}}};function pxlNav_ShaderHeader_shaderHeader(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        "}function pxlNav_defaultVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n  varying vec2 vUv;\n  void main(){\n    vUv=uv;\n    vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);\n    gl_Position = projectionMatrix*modelViewPosition;\n  }"}function pxlNav_defaultShiftVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n  varying vec2 vUv;\n  varying vec2 vUvShift;\n  void main(){\n    vUv=uv;\n        vUvShift=uv-.5;\n    vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);\n    gl_Position = projectionMatrix*modelViewPosition;\n  }"}function pxlNav_camPosVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n  varying vec3 camPos;\n  varying vec2 vUv;\n  void main(){\n    vUv=uv;\n    vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);\n    gl_Position = projectionMatrix*modelViewPosition;\n    camPos=(modelViewMatrix*vec4(0.0,0.0,1.0,1.0)).xyz;\n  }"}function pxlNav_discardFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n  void main(){\n    discard;\n    gl_FragColor=vec4(.0,.0,.0,0.0);\n  }"}function pxlNav_animTextureVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n  varying vec2 vUv;\n  void main(){\n    vUv=uv;\n    vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);\n    gl_Position = projectionMatrix*modelViewPosition;\n  }"}function pxlNav_animTextureFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n  uniform vec2 time;\n  uniform float rate;\n  uniform float freq;\n  uniform float intensity;\n  uniform vec3 glowColor;\n  uniform sampler2D glowTexture;\n  varying vec2 vUv;\n  float pi=3.14159265358979;\n  \n  void main(){\n    vec4 glowCd=texture2D(glowTexture, vUv);\n    vec4 Cd=vec4(glowColor,1.0);\n    Cd.rgb*=(cos(glowCd.g*pi*freq+time.x*rate)*.5+.5)*(1.0-glowCd.b)*intensity+glowCd.b;\n    Cd.rgb*=glowCd.r*glowCd.a;\n    gl_FragColor=Cd;\n  }"}function pxlNav_clickableBevelVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform vec2 time;\n    uniform float rate;\n    varying vec3 pos;\n    varying float nDot;\n    varying vec2 vUv;\n    \n    void main(){\n      vUv=uv+vec2(rate*time.x, 0.0);\n      vec3 camDir=normalize( (projectionMatrix*viewMatrix*vec4(0.0,0.0,-1.0,1.0)).xyz );\n      nDot=dot( normal, camDir );\n      \n      pos=position;\n      vec4 modelViewPosition=modelViewMatrix * vec4(pos, 1.0);\n      gl_Position = projectionMatrix*modelViewPosition;\n      \n    }"}function pxlNav_clickableBevelFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D alphaMap;\n    uniform sampler2D cloudNoise;\n    uniform vec2 time;\n    uniform vec2 intensity;\n    uniform float rate;\n    varying vec3 pos;\n    varying float nDot;\n    varying vec2 vUv;\n    \n    void main() {\n      vec4 Cd=vec4( 1.0 );\n      Cd.rgb= mix( vec3(.05,.1,.5), vec3(.3,.5,1.0), intensity.x);\n      \n      vec2 nUV=pos.xy*.01+vec2(time.x*rate*.1, time.x*rate*.1);\n      vec4 noiseCd=texture2D(cloudNoise,nUV);\n      noiseCd.xyz=noiseCd.xyz*2.0-1.0;\n      nUV=vUv+noiseCd.xy*.05;\n      \n      float alpha=texture2D(alphaMap,nUV).r;\n      float blender=(nDot*.5+.5);\n      Cd.rgb=Cd.rgb*(1.0+alpha);//mix( vec3(0.5,0.5,1.0), vec3(0.0,0.2,0.8), blender); // Center Color, Edge Color\n      alpha=1.0-(1.0-alpha)*(1.0-alpha);\n      alpha*=alpha;\n      Cd.a=alpha+alpha;\n      gl_FragColor = Cd;\n    }"}function pxlNav_portalBaseVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n        uniform vec2 time;\n        uniform float rate;\n        varying vec2 shiftUv;\n        varying vec2 wUv;\n        \n        void main(){\n            shiftUv=(uv-.5);\n            \n            float t=time.x*rate;\n            vec2 rot=vec2( sin(t), cos(t) );\n            vec2 rotUV=vec2(0.0);\n            rotUV.x=rot.y*(uv.x-.5) + rot.x*(uv.y-.5);\n            rotUV.y=rot.y*(uv.y-.5) - rot.x*(uv.x-.5);\n            wUv=rotUV+.5;\n            \n            vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix*modelViewPosition;\n            \n        }"}function pxlNav_portalBaseFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n        uniform vec3 color;\n        uniform sampler2D alphaMap;\n        uniform sampler2D cloudNoise;\n        uniform vec2 intensity;\n        varying vec2 shiftUv;\n        varying vec2 wUv;\n        \n        #define TAU 6.28318530717958\n        void main() {\n            float suvLength=length(shiftUv)+.1;\n            vec2 suvSign=sign(shiftUv);\n            \n            vec2 rUv=sin( (suvLength+wUv*10.*shiftUv)*.5 );\n            rUv *= suvLength ;\n            \n            vec4 noiseCd=texture2D(cloudNoise,rUv);\n            vec2 aUv=wUv*(noiseCd.xy*.5+wUv);\n            \n            float alpha=texture2D(alphaMap,aUv).r;\n            \n            vec4 Cd=vec4( color*intensity.x*(1.0+alpha)*mix( noiseCd.rgb, vec3(1.0), alpha), 1.);\n            alpha*=max(0.0, alpha-noiseCd.r*noiseCd.g*noiseCd.b );\n            Cd.a=min(1.0, alpha);\n            \n            gl_FragColor = Cd;\n        }"}function pxlNav_itemBaseVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform vec2 time;\n    uniform float intensity;\n    uniform float rate;\n    varying vec3 pos;\n    varying float nDot;\n    varying vec2 vUv;\n    \n    void main(){\n      vUv=uv+vec2(rate*time.x, 0.0);\n      vec3 camDir=normalize( (projectionMatrix*viewMatrix*vec4(0.0,0.0,-1.0,1.0)).xyz );\n      nDot=dot( normal, camDir );\n      \n      pos=position;\n      vec4 modelViewPosition=modelViewMatrix * vec4(pos, 1.0);\n      gl_Position = projectionMatrix*modelViewPosition;\n      \n    }"}function pxlNav_itemBaseFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform vec3 color;\n    uniform sampler2D alphaMap;\n    uniform sampler2D cloudNoise;\n    uniform vec2 time;\n    uniform float intensity;\n    uniform float rate;\n    varying vec3 pos;\n    varying float nDot;\n    varying vec2 vUv;\n    \n    void main() {\n      vec4 Cd=vec4( color, 1.0);\n      \n      \n      vec2 nUV=pos.xy*.01+vec2(time.x*rate*.1, time.x*rate*.1);\n      vec4 noiseCd=texture2D(cloudNoise,nUV);\n      noiseCd.xyz=noiseCd.xyz*2.0-1.0;\n      nUV=vUv+noiseCd.xy*.05;\n      \n      float alpha=texture2D(alphaMap,nUV).r;\n      float blender=(nDot*.5+.5);\n      Cd.rgb=color*intensity*(1.0+alpha);//mix( vec3(0.5,0.5,1.0), vec3(0.0,0.2,0.8), blender); // Center Color, Edge Color\n      alpha=1.0-(1.0-alpha)*(1.0-alpha);\n      alpha*=alpha;\n      Cd.a=alpha+alpha;\n      gl_FragColor = Cd;\n    }"}function pxlNav_itemVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform vec2 time;\n    uniform float intensity;\n    uniform float rate;\n    varying vec3 pos;\n    varying float nDot;\n    varying vec2 vUv;\n    varying vec2 nUv;\n    \n    void main(){\n      vUv=uv;\n      nUv=uv*.5+vec2(rate*time.x*-.1, 0.0);\n      nUv.x=sin(nUv.x)*.5+.5;\n      vec3 camDir=normalize( (projectionMatrix*viewMatrix*vec4(0.0,0.0,-1.0,1.0)).xyz );\n      nDot=dot( normal, camDir );\n      \n      vec2 nUV=position.xy*.01+vec2(time.x*rate*.1, time.x*rate*.1);\n      vec3 pos=position;\n      vec4 modelViewPosition=modelViewMatrix * vec4(pos, 1.0);\n      gl_Position = projectionMatrix*modelViewPosition;\n      \n    }"}function pxlNav_itemFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform vec3 color;\n    uniform sampler2D alphaMap;\n    uniform vec2 time;\n    uniform float intensity;\n    uniform float rate;\n    uniform sampler2D cloudNoise;\n    varying vec3 pos;\n    varying float nDot;\n    varying vec2 vUv;\n    varying vec2 nUv;\n    \n    void main() {\n      vec4 Cd=vec4( color, 1.0);\n      float alpha=texture2D(alphaMap,vUv).r;\n      float noise=length(texture2D(cloudNoise,nUv).rgb)*.5;\n      float blender=(nDot*.5+.5);\n      Cd.rgb=color*blender;\n      Cd.rgb*=intensity*alpha;\n      Cd.a=blender*alpha+noise*alpha;\n      gl_FragColor = Cd;\n    }"}function pxlNav_itemZoomFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D color;\n    uniform vec2 time;\n    uniform float intensity;\n    uniform sampler2D cloudNoise;\n    varying vec2 vUv;\n    \n    void main() {\n      vec4 Cd=texture2D(color,vUv);\n      Cd.a=Cd.b;\n      Cd.rgb=vec3( Cd.rg*Cd.a, 0.0 );\n      Cd.rgb*=Cd.a* mix(.7, 1.0, gl_FrontFacing);\n      gl_FragColor = Cd;\n    }"}function pxlNav_pxlPrincipledVert(){var u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d="\n    attribute vec3 color;\n    attribute vec3 shading;\n\n    varying float vFlicker;\n    varying vec2 vUv;\n    varying vec3 vCd;\n    varying vec3 vPos;\n    varying vec3 vLocalPos;\n    varying vec3 vN;\n    varying vec3 vLocalN;\n    varying vec3 vShading;\n    ";return u&&(d+="\n        ".concat(j.ShaderChunk.common,"\n        ").concat(j.ShaderChunk.shadowmap_pars_vertex,"\n      ")),d+="\n    \n    void main(){\n        vUv=uv;\n        \n        vShading=shading;\n        \n        vCd=color;\n        \n        vec3 transformed = vec3( position );\n        vec3 objectNormal = vec3( normal );\n        vec3 transformedNormal = objectNormal;\n        \n        \n        vLocalPos = position;\n        vN = (modelViewMatrix * vec4(normal, 0.0)).xyz;\n        vLocalN = ( modelMatrix * vec4(normal, 0.0)).xyz;\n        vec4 mvPos=modelViewMatrix * vec4(position, 1.0);\n        gl_Position = projectionMatrix*mvPos;\n        vPos = mvPos.xyz;\n        \n        ",u&&(d+="\n            ".concat(j.ShaderChunk.worldpos_vertex,"\n            ").concat(j.ShaderChunk.shadowmap_vertex,"\n          ")),d+="\n    }"}function pxlNav_pxlPrincipledFrag(u,d,v,x,y,b){var _=!1,w=1;u.hasOwnProperty("Specular")&&u.Specular>0&&(_=!0,w=u.Specular);var S=!1;u.PointColor&&(S=!0);var C=!0,P="1.0";u.hasOwnProperty("SurfaceNoise")&&(u.SurfaceNoise%1==0&&(P=u.SurfaceNoise+".0"),"0.0"==P&&(C=!1));var A="\n        ";if(d||(A+="uniform sampler2D dTexture;"),A+="\n    \n    uniform sampler2D noiseTexture;\n    uniform sampler2D detailTexture;\n        \n    uniform vec2 time;\n    uniform float cdMult;\n    uniform vec3 fogColor;\n    \n    varying vec2 vUv;\n    varying vec3 vCd;\n    varying vec3 vPos;\n    varying vec3 vLocalPos;\n    varying vec3 vN;\n    varying vec3 vLocalN;\n    varying vec3 vShading;\n    \n    varying float vFlicker;\n    \n    #define PI 3.14159265358979\n    \n    struct PointLight {\n      vec3 color;\n      float decay;\n      float distance;\n      vec3 position;\n    };\n    struct DirLight {\n      vec3 color;\n      vec3 direction;\n    };\n    ",x&&(A+="\n    #if NUM_POINT_LIGHTS > 0\n      uniform PointLight pointLights[NUM_POINT_LIGHTS];\n    #endif\n    #if NUM_DIR_LIGHTS > 0\n      uniform DirLight directionalLights[NUM_DIR_LIGHTS];\n    #endif\n      "),y&&(A+="\n      \n      ".concat(j.ShaderChunk.packing,"\n      \n      #if NUM_POINT_LIGHT_SHADOWS > 0\n          uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n          varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n          struct PointLightShadow {\n              float shadowBias;\n              float shadowNormalBias;\n              float shadowRadius;\n              vec2 shadowMapSize;\n              float shadowCameraNear;\n              float shadowCameraFar;\n          };\n          uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n      #endif\n      float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n          return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n      }\n      vec2 cubeToUV( vec3 v, float texelSizeY ) {\n          vec3 absV = abs( v );\n          float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n          absV *= scaleToCube;\n          v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n          vec2 planar = v.xy;\n          float almostATexel = 1.5 * texelSizeY;\n          float almostOne = 1.0 - almostATexel;\n          if ( absV.z >= almostOne ) {\n              if ( v.z > 0.0 )\n                  planar.x = 4.0 - v.x;\n          } else if ( absV.x >= almostOne ) {\n              float signX = sign( v.x );\n              planar.x = v.z * signX + 2.0 * signX;\n          } else if ( absV.y >= almostOne ) {\n              float signY = sign( v.y );\n              planar.x = v.x + 2.0 * signY + 2.0;\n              planar.y = v.z * signY - 2.0;\n          }\n          return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n      }\n      float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n          vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n          vec3 lightToPosition = shadowCoord.xyz;\n          float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\n           dp += shadowBias;\n          vec3 bd3D = normalize( lightToPosition );\n          #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n              vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n              return (\n                  texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n                  texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n                  texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n                  texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n                  texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n                  texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n                  texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n                  texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n                  texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n              ) * ( .11111111111 ) * (1.0-dp);\n          #else\n              return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) * (1.0-dp);\n          #endif\n      }\n    \n      vec3 directionToLight( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar  ){\n          vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n          vec3 lightToPosition = shadowCoord.xyz;\n          float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\n          dp += shadowBias;\n          vec3 bd3D = normalize( lightToPosition );\n          vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n          return texture2D( pointShadowMap[0], cubeToUV( bd3D, texelSize.y )).rgb;\n      }\n      ")),A+="\n    void main(){\n      ",S)A+="vec3 vertCd = vCd;";else if(d){var toFloatStr=u=>u%1==0?u+".0":u+"",T=toFloatStr(d.r),E=toFloatStr(d.g),D=toFloatStr(d.b);A+="vec3 vertCd = vec3( ".concat(T,", ").concat(E,", ").concat(D," ) ;")}else A+="vec3 vertCd = texture2D(dTexture,vUv).rgb ;";A+="\n        \n        vec4 Cd=vec4( vertCd, 1.0 );\n        float specular = 0.0;\n        ",v&&(A+="\n          float depth = gl_FragCoord.z / gl_FragCoord.w *.0004;\n          Cd.rgb=  mix( Cd.rgb, fogColor, depth );\n          ");var I="",k="",R="";if(C&&("1.0"!=P&&(I="*"+P),A+="\n            float detailMult = (texture2D(detailTexture,vUv*4.0).r)*.5+.5;\n            ",k="+detailMult * (shadowInf*.5+.5) ".concat(I),R="(detailMult+.5) ".concat(I)),x&&(A+="\n          #if NUM_POINT_LIGHTS > 0 || NUM_DIR_LIGHTS > 0\n            vec4 lights = vec4(0.0, 0.0, 0.0, 1.0);\n          #endif\n          \n          #if NUM_POINT_LIGHTS > 0\n            for(int i = 0; i < NUM_POINT_LIGHTS; i++) {\n                vec3 lightVector = normalize(vPos - pointLights[i].position);\n                vec3 lightInf= clamp(dot(-lightVector, vN), 0.0, 1.0) * pointLights[i].color;\n                //lightInf = mix( lightInf, 1.0-(1.0-lightInf)*(1.0-lightInf), .2);\n                float distFalloff =  1.0-min(1.0, length(vPos - pointLights[i].position) * pointLights[i].decay*.008 );\n                lightInf *=  distFalloff;\n                lights.rgb += lightInf;\n                ",_&&(A+="\n                  distFalloff = (dot(vN, normalize(-vPos)) )*distFalloff;\n                  specular += distFalloff;\n                  "),A+="\n            }\n          #endif\n            \n          #if NUM_DIR_LIGHTS > 0\n            for(int i = 0; i < NUM_DIR_LIGHTS; i++) {\n                vec3 lightInf= max(0.0, dot(directionalLights[i].direction, vN)*.65+.35) * directionalLights[i].color;\n                lights.rgb += lightInf;\n            }\n          #endif\n            \n            \n          #if NUM_POINT_LIGHTS > 0 || NUM_DIR_LIGHTS > 0\n            Cd.rgb *= lights.rgb;\n          #endif\n          ",_&&(A+="\n            Cd.rgb += vertCd * specular * ".concat(w,";\n            "))),y){A+="\n          #if NUM_POINT_LIGHT_SHADOWS > 0\n            \n            float shadowInf = 0.0;\n            float detailInf = 0.0;\n            float lShadow = 0.0;\n            int i = 0;\n            ";for(var O=0;O<b;++O)A+="\n                i=".concat(O,";\n                lShadow = getPointShadow( pointShadowMap[").concat(O,"], pointLightShadows[i].shadowMapSize, pointLightShadows[i].shadowBias*.75, pointLightShadows[i].shadowRadius*1.65, vPointShadowCoord[i], pointLightShadows[i].shadowCameraNear, pointLightShadows[i].shadowCameraFar );\n                shadowInf = max( lShadow, shadowInf);\n                ");A+="\n            shadowInf = shadowInf;\n            Cd.rgb*=shadowInf ".concat(k," ;\n            "),C&&(A+="\n              #else\n                Cd.rgb*=".concat(R,";\n              ")),A+="\n          #endif\n          "}else C&&(A+="\n            Cd.rgb*=".concat(R,";\n            "));return A+="\n        Cd*=cdMult;\n        \n        // Convert to sRGB\n        Cd.rgb = mix( 12.92 * Cd.rgb, 1.055 * pow(Cd.rgb, vec3(1.0 / 2.4)) - 0.055, step(0.0031308, Cd.rgb) );\n\n        gl_FragColor=Cd;\n    }"}function pxlNav_emberWispsVert(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-.13,.15],d="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return d+="\n        \n    uniform sampler2D noiseTexture;\n    uniform vec2 time;\n    uniform float rate;\n    uniform vec2 pointScale;\n    uniform vec3 sliders;\n    \n    attribute vec4 seeds;\n    attribute vec2 atlas;\n    \n    varying vec3 vCd;\n    varying vec2 vAtlas;\n    varying vec2 vRot;\n    varying float vAlpha;\n    varying float vBrightness;\n    \n    #define PROX 60.0\n    #define LAND 10.0\n    \n    const vec2 windForce = vec2(".concat(u[0],", ").concat(u[1],");\n    \n    const vec3 earlyCd = vec3( 1.0, 0.7, .1 );\n    const vec3 oldCd = vec3( 0.634, 0.50, 0.20 );\n    const float emberSpread = 15.0;\n    const float emberFadeDistance = 0.04;\n    const float baseSpeed = 0.47;\n    \n    \n    float colDetect( vec2 pos, vec2 pt, vec2 n1, vec2 n2 ){\n        vec2 ref=pos-pt;\n        float ret = step( dot( ref, n1 ), 0.0 );\n        ret *= step( dot( ref, n2 ), 0.0 );\n        \n        return ret;\n    }\n    \n    \n    void main(){\n        vAtlas=atlas;\n        \n        float rot=seeds.z+time.x*(seeds.z*2.);\n        vRot=vec2( sin(rot), cos(rot) );\n        \n        vec3 pOff=vec3(seeds.z, seeds.y, seeds.w) * vec3(PROX);\n        \n        vec2 sinUV=abs(sin(pOff.xz*.5+seeds.zw+time.x*.1)*.5+.5);\n        vec3 noiseCd=texture2D(noiseTexture, sinUV ).rgb*4.5 + 0.50;\n        \n        float rateShift = (baseSpeed*(seeds.x*.4+.6));\n        float t=time.x*rate*rateShift;\n        float shiftY= mod( t+t*seeds.x+seeds.z*8.0+noiseCd.r*10.20*(seeds.y*2.0-1.0)+noiseCd.b+(-seeds.x+seeds.y)*4.0, 10.0);\n        float life = 1.0-max(0.0,abs(shiftY-seeds.x*.1)*(1.0-(seeds.x*1.0)) );\n        life = 1.0-((shiftY*.001-seeds.x*.2) );\n        \n        pOff.y=shiftY*seeds.y;\n        \n        pOff.y=(pOff.y)+shiftY; \n        vec3 pos= pOff ;\n        \n\n        pos.xz=(noiseCd.rg*noiseCd.r)*(seeds.x)*emberSpread*(life*seeds.zy*(seeds.w*4.0-2.));\n        \n        float yPush = ( life * (life*.5+.5))  * min(1.0,pos.y*.12) * 5.8;\n        pos.xz += windForce * yPush * pos.y + vec2(1.25, .0);\n        pos.y += yPush;\n        \n        \n        \n        float pScalar = max( 0., (1.-length(pos-cameraPosition )*0.017)  );\n        float aMult = min(1.0, pScalar*3.0);\n        vAlpha = (seeds.x*.15+.7) * aMult;\n\n        \n        vAlpha=max(0.0, life*life-seeds.z-seeds.z);\n        float distMult = ( length( pos )*emberFadeDistance );\n        distMult = 1.0 - ( distMult * distMult );\n        vAlpha *= distMult;\n        \n        vec3 doubleCd=texture2D(noiseTexture, sinUV+pos.xz*.3+vec2(0.0,pos.y)).rgb*2.0 ;\n        pos.xz+=doubleCd.rb ;\n        \n        \n        float pScale = pointScale.x * seeds.w * pScalar + 2.0;\n        \n        gl_PointSize = pScale;\n        \n        pos += modelMatrix[3].xyz - vec3(1.0, 0.50, 0.2);\n        vec4 mvPos=viewMatrix * vec4(pos, 1.0);\n        gl_Position = projectionMatrix*mvPos;\n        \n        float cdAge = clamp( 1.0 - life, 0.0, 1.0);\n    \n    //earlyCd, oldCd\n        vCd = mix( earlyCd, oldCd, cdAge )  ;\n        vBrightness = 1.45;\n        \n    } ")}function pxlNav_emberWispsFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n                \n    uniform sampler2D atlasTexture;\n    uniform vec2 time;\n    uniform float rate;\n    \n    varying vec3 vCd;\n    varying vec2 vAtlas;\n    varying vec2 vRot;\n    varying float vAlpha;\n    varying float vBrightness;\n    \n    void main(){\n        vec2 uv=gl_PointCoord;\n\n        vec2 pos = (uv-.5)*.85;\n\n        vec2 rotUV;\n        rotUV.x = vRot.y * pos.x - vRot.x * pos.y;\n        rotUV.y = vRot.x * pos.x + vRot.y * pos.y;\n        rotUV=(rotUV+.5)*.25+vAtlas;\n        \n        vec4 dustCd=texture2D(atlasTexture,rotUV);\n        float alpha=dustCd.a*vAlpha;\n        \n        //dustCd.rgb = 1.0 - (1.0 - dustCd.rgb ) * vBrightness;\n        dustCd.rgb *= vBrightness;\n        \n        vec4 Cd=vec4( dustCd.rgb * vCd * vBrightness, alpha );\n        gl_FragColor=Cd;\n    }"}function pxlNav_dustVert(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:120,v="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return v+="\n                \n    uniform sampler2D noiseTexture;\n    uniform vec2 time;\n    uniform float rate;\n    uniform vec2 pointScale;\n    uniform vec3 positionOffset;\n    uniform vec2 windDir;\n  ",u>0&&(v+="uniform vec3[".concat(u,"] lightPos;")),v+="\n    \n    attribute vec4 seeds;\n    attribute vec2 atlas;\n    \n    varying vec2 vAtlas;\n    varying vec2 vRot;\n    varying float vScalar;\n    varying float vAlpha;\n    \n    #define PROX ".concat(d.toFixed(3),"\n    #define PROX_INV 1.0/").concat((1.8*d).toFixed(3),"\n    \n    #define LIGHT_COUNT ").concat(u,"\n    \n    \n    float colDetect( vec2 pos, vec2 pt, vec2 n1, vec2 n2 ){\n        vec2 ref=pos-pt;\n        float ret = step( dot( ref, n1 ), 0.0 );\n        ret *= step( dot( ref, n2 ), 0.0 );\n        \n        return ret;\n    }\n    \n    \n    void main(){\n        vAtlas=atlas;\n        \n        float rot=seeds.z+time.x*(seeds.z*2.);\n        vRot=vec2( sin(rot), cos(rot) );\n        \n        float t=time.x*rate;\n        \n        vec3 pOff=seeds.xyz * vec3(PROX);\n        \n        // Loop point positions based on camera location\n        float yFract=fract(t+seeds.x);\n        pOff.y+=cameraPosition.y ; \n        pOff.x+=time.x*windDir.x; \n        pOff.z+=time.x*windDir.y; \n        vec3 pos= pOff ;\n        \n        vec3 noiseCd=texture2D(noiseTexture, sin(pos.xz*.05+seeds.xz+time.x*.1)*.5+.5 ).rgb-.5;\n        \n        pos.y = (pos.y-.1)*.45;\n        pos.y+=sin(seeds.x+seeds.z+noiseCd.r*noiseCd.g+noiseCd.b+time.x*.2)*2.;//+noiseCd.r*noiseCd.g*noiseCd.b*20.;\n\n        pos.xz+=(noiseCd.rg*noiseCd.b)*((seeds.w+.75)*4.);\n        vec2 camXZ=cameraPosition.xz;\n        pos.xz= mod( pos.xz-camXZ, PROX) + camXZ - PROX*.5;\n        \n        float pScalar = max( 0., (1.-length(pos-cameraPosition )*PROX_INV)  );\n        float aMult = min(1.0, pScalar*3.0);\n        vAlpha = (seeds.x*.5+.7) * aMult;\n\n  "),u>1?v+="\n          float lightInf = 1.0;\n\n          for(int i = 0; i < LIGHT_COUNT; i++) {\n              vec3 lightVector = normalize(pos - lightPos[i]);\n              lightInf = min(lightInf, length(pos - lightPos[i]) *.05 );\n          }\n          vAlpha*=(1.0-lightInf)*.8+.2;\n    ":1==u&&(v+="\n        vec3 lightVector = normalize(pos - lightPos[0]);\n        float lightInf = length(pos - lightPos[0]) *.02;\n        vAlpha*=(1.0-lightInf)*.8+.2;\n    "),v+="\n        vScalar = pScalar ;\n        //float pScale = pointScale.x * ((seeds.w+.75)*.5) * pScalar + 1.0;\n        float pScale = pointScale.x * (seeds.w*.5+.5)*pScalar + 1.0;\n        pScale *= step( .5, atlas.x )*.5+1.;\n        //pScale = 10.0;\n       \n        gl_PointSize = pScale;\n        \n        pos+=positionOffset;\n        vec4 mvPos=viewMatrix * vec4(pos, 1.0);\n        gl_Position = projectionMatrix*mvPos;\n    }"}function pxlNav_dustFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D atlasTexture;\n    uniform vec2 time;\n    uniform float rate;\n    \n    varying vec2 vAtlas;\n    varying vec2 vRot;\n    varying float vScalar;\n    varying float vAlpha;\n    \n    void main(){\n        vec2 uv=gl_PointCoord;\n\n        vec2 pos = (uv-.5)*.85;\n\n        vec2 rotUV;\n        rotUV.x = vRot.y * pos.x - vRot.x * pos.y;\n        rotUV.y = vRot.x * pos.x + vRot.y * pos.y;\n        rotUV=(rotUV+.5)*.25+vAtlas;\n        \n        vec4 dustCd=texture2D(atlasTexture,rotUV);\n        float alpha=dustCd.a*vAlpha; // *vScalar;\n        vec4 Cd=vec4( dustCd.rgb, alpha );\n\n        gl_FragColor=Cd;\n    }"}function pxlNav_smokeVert(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[8.7,8.4],d="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return d+=" \n    uniform sampler2D noiseTexture;\n    uniform vec2 time;\n    uniform float rate;\n    uniform vec2 pointScale;\n    \n    attribute vec4 seeds;\n    attribute vec2 atlas;\n    \n    varying vec2 vAtlas;\n    varying vec2 vRot;\n    varying float vAlpha;\n    varying float vBrightness;\n    \n    \n    #define PROX 6.0\n    \n    \n    float colDetect( vec2 pos, vec2 pt, vec2 n1, vec2 n2 ){\n        vec2 ref=pos-pt;\n        float ret = step( dot( ref, n1 ), 0.0 );\n        ret *= step( dot( ref, n2 ), 0.0 );\n        \n        return ret;\n    }\n     \n    \n    // Attempted de-Magic-num-ification\n    float baseSpread = 110.0;\n    float innerBulster = -0.110;\n    float smokeDensity = 0.25;\n        \n    void main(){\n        vAtlas=atlas;\n        \n        float rot=seeds.z+time.x*(seeds.z*2.);\n        vRot=vec2( sin(rot), cos(rot) );\n        \n        vec3 pOff=vec3(seeds.z, seeds.y, seeds.w) ;\n        \n        vec2 sinUV=abs(sin(pOff.xz*.5+seeds.zw+time.x*.1)*.5+.5);\n        vec3 noiseCd=texture2D(noiseTexture, sinUV ).rgb*4.5 + 0.50;\n        \n        float t=time.x*rate;\n        float shiftY= mod( t+t*seeds.x+seeds.z*24.0+noiseCd.r+noiseCd.b+(seeds.x+seeds.y)*2.0, 14.0);\n        float life = max(0.0,(shiftY-seeds.x)*0.07142857142857142)*.9+.2;\n        float alphaMult = (1.0-(1.0-life)*(1.0-life))*smokeDensity;\n        \n        pOff.y=shiftY*seeds.y*life - (1.0-life);\n        \n        pOff.y=(pOff.y*.5)+shiftY; \n        vec3 pos= pOff ;\n        \n\n        \n        // Magic numbers!  Boo!!\n        float tightenTip = max(0.0,life-.63)*1.3;\n        tightenTip = 1.0 - (1.0-tightenTip) * (1.0-tightenTip);\n        //tightenTip *= tightenTip;\n        float tightenBase = max(0.0, (1.0-life)*innerBulster);\n        float tightenMid = max(0.0, 0.60 - tightenTip - tightenBase - seeds.x*.2);\n        \n        baseSpread = baseSpread*tightenBase + baseSpread*tightenMid + baseSpread*tightenTip ;\n        \n        pos.xz=(noiseCd.rg*noiseCd.b)*seeds.w*baseSpread*(life*(seeds.zy*.6));\n        \n        // Wind -- Forces\n        //   Magic numbers, yarb!\n        float windInf = life * life * (life*.5+.5);\n        vec2 windDir = vec2( windInf*".concat(u[0],", windInf * ").concat(u[1]," );\n        pos.xz += windDir + vec2(-.5, .0);\n        \n        \n        // Alpha with cam distance inf\n        float pScalar = 1.0-min( 1.0, (length(pos-cameraPosition )*0.004) );\n        pScalar=1.0-(pScalar*pScalar);\n        float aMult = min(1.0, pScalar*2.0);\n        vAlpha = (seeds.x*.5+.7) * aMult;\n\n        \n        // Alpha from gettin' old\n        vAlpha=(1.0-life)*min(1.0,alphaMult);\n        vec3 doubleCd=texture2D(noiseTexture, sinUV+pos.xz*.5+vec2(seeds.y,pos.y)).rgb ;\n        pos.xz=(pos.xz*seeds.xy+doubleCd.rb*10.0)*min(1.0,life+seeds.y);\n        \n        \n        // Draw size, particle scale\n        pScalar = 1.0-(1.0-pScalar)*.75*(1.0-pScalar);\n        float pScale = pointScale.x * seeds.w * 0.006 * pScalar + (200.0+125.0*life*pScalar)*(1.0-pScalar);\n        pScale += 150.0*(clamp(-(pScalar-.45)*10.0,0.0,1.0));\n\n        gl_PointSize = pScale;\n        \n        // Brightness multiplier\n        vBrightness = 1.0-tightenMid*.81 - tightenTip + tightenBase;\n        float originDelta = length(pos)*(-innerBulster);\n        vBrightness *= max(0.0, 1.0-originDelta * life * 0.807);\n        \n        \n        // Add Particle System position\n        pos += modelMatrix[3].xyz;\n        \n        vec4 mvPos=viewMatrix * vec4(pos, 1.0);\n        gl_Position = projectionMatrix*mvPos;\n        \n        \n    }")}function pxlNav_smokeFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n        \n    uniform sampler2D atlasTexture;\n    uniform vec2 time;\n    uniform float rate;\n    \n    varying vec2 vAtlas;\n    varying vec2 vRot;\n    varying float vAlpha;\n    varying float vBrightness;\n    \n    void main(){\n        vec2 uv=gl_PointCoord;\n\n        vec2 pos = (uv-.5)*.85;\n\n        vec2 rotUV;\n        rotUV.x = vRot.y * pos.x - vRot.x * pos.y;\n        rotUV.y = vRot.x * pos.x + vRot.y * pos.y;\n        rotUV=(rotUV+.5)*.25+vAtlas;\n        \n        vec4 dustCd=texture2D(atlasTexture,rotUV);\n        float alpha=dustCd.a*vAlpha;\n        vec4 Cd=vec4( dustCd.rgb, alpha );\n\n        Cd.rgb *= vec3(vBrightness);\n        \n        gl_FragColor=Cd;\n    }"}function pxlNav_snowVert(){var u="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return u+="\n    uniform vec2 time;\n    uniform float rate;\n    uniform float pointScale;\n    \n    attribute vec4 seeds;\n    attribute vec2 atlas;\n    \n    varying vec2 vAtlas;\n    varying vec2 vRot;\n    varying float vScalar;\n    \n    #define PROX 1000.0\n    #define LAND 50.0\n    \n    float colDetect( vec2 pos, vec2 pt, vec2 n1, vec2 n2 ){\n        vec2 ref=pos-pt;\n        float ret = step( dot( ref, n1 ), 0.0 );\n        ret *= step( dot( ref, n2 ), 0.0 );\n        \n        return ret;\n    }\n    \n    \n    void main(){\n        vAtlas=atlas;\n        \n        float rot=seeds.z+time.x*(seeds.z*2.);\n        vRot=vec2( sin(rot), cos(rot) );\n        \n        float t=time.x*rate;\n        \n        vec3 pOff=vec3( seeds.x, 0, seeds.y)* vec3(PROX);\n        \n        // Loop point positions based on camera location\n        float yFract=fract(t+seeds.z);\n        pOff.y=PROX-yFract*(PROX+LAND); \n        vec3 pos= pOff ;\n        vec2 camXZ=cameraPosition.xz;\n        pos.xz= mod( pos.xz-camXZ, PROX) + camXZ - PROX*.5;\n        \n        \n        // Get some roof tops working\n        //   Using opposing points and 2 normals in xz space to determin y floor position\n        // Find rooves from xz pos + dot products\n        float floor=0.0;\n    ",!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&(u+="\n        // -- --\n        vec2 lp1=vec2( -186.0, -1002.0 ); // Point 1\n        vec2 l1n1=vec2(-.1,1.); // Normal 1\n        vec2 l1n2=vec2(1.,-.1); // Normal 2\n        vec2 lp2=vec2( -1101.0, -1720.0 ); // Point 2\n        vec2 l2n1=vec2(.1,-1.1);\n        vec2 l2n2=vec2(-1.,.1);\n        floor = max( floor, 170.0*colDetect( pos.xz, lp1,l1n1,l1n2 ) * colDetect( pos.xz, lp2,l2n1,l2n2 ) ); // Lobby roof\n\n        lp1=vec2( -217.0, 786.0 ); // Point 1\n        l1n1=vec2(.2,-1.); // Normal 1\n        l1n2=vec2(1.,.1); // Normal 2\n        lp2=vec2( -940.0, 1293.0 ); // Point 2\n        l2n1=vec2(-.2,1.);\n        l2n2=vec2(-1.,-.1);\n        floor = max( floor, 500.0*colDetect( pos.xz, lp1,l1n1,l1n2 ) * colDetect( pos.xz, lp2,l2n1,l2n2 ) ); // sunflower roof\n\n        lp1=vec2( 204.028, 56.7629 ); // Point 1\n        l1n1=vec2( 0.152344, -0.988327 ); // Normal 1\n        l1n2=vec2( -0.999862, 0.0165819 ); // Normal 2\n        lp2=vec2( 755.264, 754.843 ); // Point 2\n        l2n1=vec2( -0.160366, 0.987058 );\n        l2n2=vec2( 0.999849, 0.0173488 );\n        floor = max( floor, 150.0*colDetect( pos.xz, lp1,l1n1,l1n2 ) * colDetect( pos.xz, lp2,l2n1,l2n2 ) ); // sunflower roof\n        "),u+="  \n        // Prevent snow drifting after hitting the ground\n        float yLimit=max( floor, pos.y ) * .08 * seeds.z;\n        pos.xz+=vec2( sin(pos.x+yLimit*seeds.x), sin(pos.z+pos.x+yLimit*seeds.y) )*10.; // Snow sway in the sky\n        \n        // Shift Y position per camera height\n        pos.y+=cameraPosition.y-yFract*(cameraPosition.y); \n        pos.y=max( floor+1.5, pos.y );\n        \n        float melt=min(1.0, (pOff.y+LAND-floor)*.02);\n        float pScalar = max( 0., (1.-length(pos-cameraPosition )*0.001) * melt );\n        \n        vScalar = pScalar;\n        float pScale = pointScale * seeds.w * pScalar ;\n        gl_PointSize = pScale;\n        \n        vec4 mvPos=viewMatrix * vec4(pos, 1.0);\n        gl_Position = projectionMatrix*mvPos;\n    }"}function pxlNav_snowFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D snowTexture;\n    uniform vec2 time;\n    uniform float rate;\n    \n    varying vec2 vAtlas;\n    varying vec2 vRot;\n    varying float vScalar;\n    \n    void main(){\n        vec2 uv=gl_PointCoord;\n\n        vec2 pos = uv-.5;\n\n        vec2 rotUV;\n        rotUV.x = vRot.y * pos.x - vRot.x * pos.y;\n        rotUV.y = vRot.x * pos.x + vRot.y * pos.y;\n        rotUV=(rotUV+.5)*.25+vAtlas;\n        \n        float alpha=texture2D(snowTexture,rotUV).r * vScalar;\n        vec4 Cd=vec4( vec3(1.), alpha );\n\n        gl_FragColor=Cd;\n    }"}function pxlNav_worldPositionVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n  varying vec3 pos;\n  \n  void main(){\n    vec3 transformed = vec3( position );\n      vec4 mvPosition = modelViewMatrix  * vec4( transformed, 1.0 );\n    pos=((projectionMatrix * modelMatrix * vec4( transformed-vec3(0.0,0.0,-500.0), 1.0 )).xyz*.0001)*.5+.5;\n    \n    gl_Position = projectionMatrix * mvPosition;\n  }"}function pxlNav_worldPositionFrag(){var u="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return u="#include <packing>\n  "+u,u+="\n    uniform sampler2D diffuse;\n    uniform sampler2D depth;\n    uniform float camNear;\n    uniform float camFar;\n    varying vec3 pos;\n    \n    void main() {\n      \n      vec4 Cd=vec4( pos, 1.0 );\n      gl_FragColor = Cd;\n    }"}function pxlNav_glowPassPostProcess(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D tDiffuse;\n    uniform sampler2D gDiffuse;\n    uniform sampler2D rDiffuse;\n    uniform sampler2D sceneDepth;\n    uniform vec2 time;\n    uniform vec2 ratio;\n    varying vec2 vUv;\n\n        #define PI 3.14159265358979\n        \n    void main() {\n      vec4 Cd=texture2D( tDiffuse, vUv );\n      vec4 gCd=texture2D( gDiffuse, vUv );\n      vec4 rCd=texture2D( rDiffuse, vUv );\n      \n      Cd.rgb=gCd.rgb + gCd.rgb*length(gCd.rgb) + rCd.rgb  + Cd.rgb ;\n\n      Cd.a=1.0;\n      gl_FragColor = Cd;\n    }"}function pxlNav_textureStorePass(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D tDiffuse;\n    uniform sampler2D tDiffusePrev;\n    uniform sampler2D tDiffusePrevRoom;\n    uniform float roomComposer;\n    varying vec2 vUv;\n        \n    void main() {\n      vec4 Cd = texture2D( tDiffusePrev, vUv );\n      vec3 prevRoomCd = texture2D( tDiffusePrevRoom, vUv ).rgb;\n      Cd.rgb=mix( Cd.rgb, prevRoomCd, roomComposer);\n      //Cd.rgb=Cd.rgb + prevRoomCd;\n      Cd.a=1.0;\n      gl_FragColor = Cd;\n    }"}function pxlNav_compLayersPostProcess(){return"\n    uniform sampler2D tDiffuse;\n    uniform sampler2D mtDiffuse;\n    uniform sampler2D sceneDepth;\n    uniform sampler2D noiseTexture;\n    uniform float exposure;\n    uniform vec2 camRotPitch;\n    uniform vec2 time;\n    varying vec2 vUv;\n\n    void main() {\n      vec4 Cd=texture2D(tDiffuse,vUv)*exposure;\n      vec4 mBlurCd=texture2D(mtDiffuse,vUv)*exposure;\n      vec4 depth=texture2D(sceneDepth,vUv);\n      \n  ////////////////////////\n  /*\n      vec2 uv=vUv;\n      float pi=3.14159265358979;\n      float t=-time.x*.007;\n      float pitch=camRotPitch.y;//depth.w*2.0-1.0;\n      float yaw=camRotPitch.x;\n      \n      float distMult=depth.x*2.0;\n      vec2 noiseUV=vec2(fract(uv.x*distMult+t+yaw), fract(uv.y*distMult+pitch));\n      vec3 noiseCd=texture2D(noiseTexture,noiseUV).rgb;\n      noiseUV=vec2(fract(uv.x*distMult+t*.5+yaw), fract(uv.y*.5*distMult+t*.25+pitch));\n      noiseCd.g=texture2D(noiseTexture,noiseUV).g;\n      noiseUV=vec2(fract(uv.x*.8*distMult+t*1.3+yaw), fract(uv.y*.3*distMult+t*.5+ pitch + depth.x*2.0));\n      noiseCd.b=texture2D(noiseTexture,noiseUV).b;\n      float mult=noiseCd.x*noiseCd.y*noiseCd.z*1.3;\n      mult*=max(0.0, 1.0-depth.x) + (1.0-depth.z*.6);\n      \n      float bg=length(depth.rgb)<.02 ? 0.0 : 1.0;\n      float bval=length(bloomCd.rgb);\n      mult= mult*(bg+bval) ;//*(1.0-depth.z);\n      Cd.rgb= mix( Cd.rgb, vec3(mult*.2), mult );\n      */\n      \n      Cd.rgb+=mBlurCd.rgb;\n      Cd.a=1.0;\n      gl_FragColor = Cd;\n    }"}function pxlNav_boxAntiAliasPass(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D tDiffuse;\n    uniform vec2 resUV;\n    uniform float ratio;\n    uniform vec3 gamma;\n    varying vec2 vUv;\n\n        #define AADIV 0.1\n\n    void main() {\n      vec4 Cd=texture2D(tDiffuse,vUv)*2.0;\n            \n            float dist = 1.0;\n      vec2 baseUV=vUv;\n      const int runCount=8;\n      vec2 runDir[runCount];\n      runDir[0]=vec2(1.0, 0.0);\n      runDir[1]=vec2(1.0, 1.0);\n      runDir[2]=vec2(0.0, 1.0);\n      runDir[3]=vec2(-1.0, 1.0);\n      runDir[4]=vec2(-1.0, 0.0);\n      runDir[5]=vec2(-1.0, -1.0);\n      runDir[6]=vec2(0.0, -1.0);\n      runDir[7]=vec2(1.0, -1.0);\n      vec2 curUV;\n      vec3 curCd;\n      for(int s=0; s<runCount; ++s){\n        curUV = baseUV+runDir[s]*(resUV);//*dist);\n        curCd = texture2D(tDiffuse,curUV).rgb;\n                Cd.rgb+=curCd;\n      }\n      Cd.rgb=Cd.rgb*AADIV;\n      Cd.a=1.0;\n      \n      //Cd.rgb = pow(Cd.rgb, vec3(gamma.x));\n      Cd.rgb = vec3(1.0)-(vec3(1.0)-Cd.rgb)*gamma.y + Cd.rgb*(1.0-min(1.0,length(Cd.rgb)))*gamma.z;\n      gl_FragColor = Cd;\n    }"}function pxlNav_crossAntiAliasPass(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D tDiffuse;\n    uniform vec2 resUV;\n    uniform float ratio;\n    uniform vec3 gamma;\n    varying vec2 vUv;\n\n        #define AADIV 0.16666666666666666\n\n    void main() {\n      vec4 Cd=texture2D(tDiffuse,vUv)*2.0;\n            \n            float dist = 1.0;\n      vec2 baseUV=vUv;\n      const int runCount=4;\n      vec2 runDir[runCount];\n      runDir[0]=vec2(1.0, 1.0);\n      runDir[1]=vec2(-1.0, 1.0);\n      runDir[2]=vec2(-1.0, -1.0);\n      runDir[3]=vec2(1.0, -1.0);\n      vec2 curUV;\n      vec3 curCd;\n      for(int s=0; s<runCount; ++s){\n        curUV = baseUV+runDir[s]*(resUV);//*dist);\n        curCd = texture2D(tDiffuse,curUV).rgb;\n                Cd.rgb+=curCd;\n      }\n      Cd.rgb=Cd.rgb*AADIV;\n      Cd.a=1.0;\n      \n      //Cd.rgb = pow(Cd.rgb, vec3(gamma.x));\n      Cd.rgb = vec3(1.0)-(vec3(1.0)-Cd.rgb)*gamma.y + Cd.rgb*(1.0-min(1.0,length(Cd.rgb)))*gamma.z;\n      gl_FragColor = Cd;\n    }"}function pxlNav_directionalBlurPass(u,d,v,x){var y="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return y+="\n        uniform sampler2D tDiffuse;\n        uniform sampler2D pDiffuse;\n        uniform vec2 resUV;\n        varying vec2 vUv;\n  \n        #define PI 3.14159265358979\n        \n        void main() {\n          \n          float dist = 2.0;\n          float fade = 1.0;\n          vec2 baseUV=vUv;\n            \n          const int blurCount=".concat(v,";\n          const int runCount=2;\n          vec2 runDir[runCount];\n          runDir[0]=vec2(").concat(d[0],".0, ").concat(d[1],".0);\n          runDir[1]=vec2(-").concat(d[0],".0, -").concat(d[1],".0);\n          vec2 curUV;\n          vec4 curCd;\n          vec4 blurCd=vec4(.0);\n          for(int b=0; b<blurCount; ++b){\n            dist = 1.0 + float(b)*").concat(x,";\n            fade = (1.0-float(b+1)/float(blurCount+2));\n            //fade = 1.- (1.-fade)*(1.-fade);\n            for(int s=0; s<runCount; ++s){\n              curUV = baseUV+runDir[s]*(resUV*dist);\n              curUV = min( vec2(1.), max( vec2(0.), curUV ));\n              curCd = texture2D(").concat(u,",curUV);\n              curCd.a *= fade*(length(curCd.rgb)*.6);\n              blurCd.r = max( blurCd.r, curCd.r );\n              blurCd.g = max( blurCd.g, curCd.g );\n              blurCd.b = max( blurCd.b, curCd.b );\n              //blurCd.rgb += curCd.rgb;\n              blurCd.a = max( blurCd.a, curCd.a );\n            }\n          }\n          vec4 Cd=blurCd;\n          //Cd.a=.01;\n          gl_FragColor = Cd;\n        }")}function pxlNav_mixBlurShaderPass(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n        uniform sampler2D tDiffuse;\n        uniform sampler2D pDiffuse;\n        uniform vec2 resUV;\n        varying vec2 vUv;\n        \n        #define PI 3.14159265358979\n        \n        void main() {\n\n          float dist = 3.0;\n          float fade = 1.0;\n          vec2 baseUV=vUv;\n          const int blurCount=3;\n          const int runCount=8;\n          vec2 runDir[runCount];\n          runDir[0]=vec2(1.0, 0.0);\n          runDir[1]=vec2(1.0, 1.0);\n          runDir[2]=vec2(0.0, 1.0);\n          runDir[3]=vec2(-1.0, 1.0);\n          runDir[4]=vec2(-1.0, 0.0);\n          runDir[5]=vec2(-1.0, -1.0);\n          runDir[6]=vec2(0.0, -1.0);\n          runDir[7]=vec2(1.0, -1.0);\n          vec2 curUV;\n          vec4 curCd;\n          vec4 scatterCd=vec4(.0);\n          for(int b=0; b<blurCount; ++b){\n            dist = 1.5*(1.0+float(b));\n            fade = .1*(1.0-float(b)/float(blurCount));\n            for(int s=0; s<runCount; ++s){\n              curUV = baseUV+runDir[s]*(resUV*dist);\n              curCd = texture2D(pDiffuse,curUV);\n              curCd.a *= fade;\n              scatterCd.rgb += curCd.rgb;\n              scatterCd.a = max( scatterCd.a, curCd.a );\n            }\n          }\n          vec4 Cd=scatterCd;\n          \n          vec4 blurCd=texture2D(tDiffuse,vUv);\n          blurCd.rgb = normalize( blurCd.rgb );\n          \n          Cd = mix( blurCd, Cd, Cd.a);\n          Cd = texture2D(tDiffuse,vUv);\n          //Cd.a=.01;\n          gl_FragColor = Cd;\n        }"}function pxlNav_motionBlurPostProcess(u,d){var v="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return v+="\n    uniform sampler2D tDiffuse;\n    uniform sampler2D rDiffuse;\n    uniform sampler2D noiseTexture;\n    \n    uniform float exposure;\n    uniform vec2 time;\n    uniform vec3 camRotXYZ;\n    uniform vec2 blurDirCur;\n    uniform vec2 blurDirPrev;\n    varying vec2 vUv;\n\n    vec4 getTexture( sampler2D texelToLinearTexture ) {\n      return mapTexelToLinear( texture2D( texelToLinearTexture , vUv ) );\n    }\n    \n    vec3 directionalBlur(vec3 origCd, sampler2D tex, vec2 uv, vec2 dir, vec2 deltaDir, float dist, float thresh){\n      float perc;\n      float curPerc=1.0;\n      vec2 curUV;\n      float origLength=length(origCd.rgb);\n      vec3 curCd;\n      vec3 retCd=origCd;\n      float delta;\n      float threshTrigger=1.0;\n      float dropoff;\n      float percCurve;\n      float d=dot(dir,deltaDir)*.5+.5;\n      for(int r=0; r<10; ++r){\n        perc=(float(r)/10.0);\n        percCurve=perc*.5;\n        dropoff=(dist*float(r))*perc*d;\n        curUV=uv+normalize(deltaDir*percCurve+dir*(1.0-percCurve))*dropoff;\n        //curUV=uv+dir*dropoff;\n        curCd=texture2D(tex,curUV).rgb;\n        delta=length(curCd.rgb);\n        delta=origLength<delta?1.0-perc*perc:0.0;\n        //delta=1.0-perc*perc;\n        retCd+=curCd.rgb*delta;\n        curPerc+=delta;\n        \n        percCurve*=percCurve;\n        curUV=uv-normalize(-deltaDir*percCurve+dir*(1.0-percCurve))*dropoff*.4;\n        //curUV=uv-dir*dropoff*.4;\n        curCd=texture2D(tex,curUV).rgb;\n        delta=length(curCd.rgb);\n        delta=origLength<delta?1.0-perc*perc:0.0;\n        //delta=1.0-perc*perc;\n        retCd+=curCd.rgb*delta;\n        curPerc+=delta;\n        \n      }\n      return retCd /curPerc;\n    }\n\n    void main() {\n      \n      \n      vec4 bloomCd=getTexture( rDiffuse );\n      float noise=sin(time.x*1.8+vUv.x*length(bloomCd.rgb)*12.523+cos(time.x*.4+vUv.y*length(bloomCd.rgb)*2.352)*1.9)*.4+.8;\n      noise=1.0-min(1.0, max(0.0, noise*sin(time.x*.4+24.512)*3.0+1.0));\n      vec2 noiseUV=vUv*0.1;//+vec2(camRotXYZ.x+time.x*.05,-camRotXYZ.y);\n      vec4 noiseCd=texture2D(noiseTexture,noiseUV);\n      float blurDist=length(blurDirCur);\n      blurDist=min(1.0,blurDist*15.0);\n      //blurDist=(1.0-(1.0-blurDist)*(1.0-blurDist));\n      vec2 blurDir=normalize(blurDirCur);//+(vUv-.5)*2.0);",d||(v+="\n        blurDir=normalize( blurDir + (noiseCd.gb-.5)*(dot(blurDir,noiseCd.gb)*.5+.5) );\n      "),v+="\n      vec2 deltaDir=normalize(blurDirPrev);\n      deltaDir.x+=sin((blurDir.x-deltaDir.x));\n      deltaDir.y+=sin((blurDir.y-deltaDir.y));\n      \n      vec4 bloomAdd=vec4( directionalBlur(bloomCd.rgb, rDiffuse, vUv, blurDir, deltaDir, "+u.y+"*"+(d?"3.0":"5.0")+"*(1.5)*blurDist, .5)*(1.0+exposure*.4), 1.0);\n      vec4 Cd= bloomAdd* ( 0.50+bloomCd)*exposure;//getTexture( rDiffuse ) + bloomAdd;//+ vec4( 1.0 ) * bloomCd + bloomAdd;\n      //Cd.a=bloomAdd.a-bloomCd.a;\n      \n      Cd.a=1.0;\n      gl_FragColor = Cd;\n      \n    }"}function pxlNav_chroAberPostProcess(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D tDiffuse;\n    uniform sampler2D chroAberUVTexture;\n    uniform vec2 ratio;\n    uniform vec2 warpMult;\n        uniform vec2 lKing;\n    varying vec2 vUv;\n\n    void main() {\n      // I don't know, sRGB to Linear. Keeping it Linear doesn't work, PNG encoding to blame\n      vec4 caCd= texture2D( chroAberUVTexture, vUv )-vec4(vec3(0.7294118), 0.5019608);\n      //caCd*=mix( .025, .018, length(caCd.rg)*4.0 );\n      caCd*=mix( lKing.x, lKing.y, length(caCd.rg)*4.0 )+warpMult.x;\n      \n      vec2 bUv=vUv+caCd.rg;\n      vec2 rUv=vUv+caCd.ba;\n      vec2 gUv=vUv+(caCd.rg+caCd.ba);\n      vec4 rCd=texture2D( tDiffuse, rUv );\n      vec4 Cd=texture2D( tDiffuse, gUv );\n      vec4 bCd=texture2D( tDiffuse, bUv );\n      \n      Cd.rgb=vec3( rCd.r, Cd.g, bCd.b );\n      Cd.a=1.0;\n      gl_FragColor = Cd;\n    }"}function pxlNav_lKingPostProcess(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D tDiffuse;\n    uniform sampler2D noiseTexture;\n    uniform vec2 time;\n    uniform vec2 ratio;\n    varying vec2 vUv;\n\n        #define PI 3.14159265358979\n        \n    void main() {\n      vec4 Cd=texture2D( tDiffuse, vUv )*.2;\n      vec4 noiseCd= (texture2D( noiseTexture, vec2( fract(vUv.x*.2-time.x*.02+sin(time.x*.1+vUv.y*PI+Cd.r+Cd.g)),fract( vUv.y*.2+time.x*.01+cos(-time.x*.2+1.15+vUv.x*PI+Cd.g+Cd.b)) ) )-.5)*.025;\n      \n      vec2 bUv=vUv+noiseCd.rg;\n      vec2 rUv=vUv+noiseCd.gb;\n      vec2 gUv=vUv+noiseCd.br;\n      vec4 rCd=texture2D( tDiffuse, rUv );\n      vec4 gCd=texture2D( tDiffuse, gUv );\n      vec4 bCd=texture2D( tDiffuse, bUv );\n      \n      Cd.rgb=vec3( rCd.r, gCd.g, bCd.b );\n      Cd.a=1.0;\n      gl_FragColor = Cd;\n    }"}function pxlNav_iZoomPostProcess(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D tDiffuse;\n    uniform sampler2D tDiffusePrev;\n    uniform sampler2D noiseTexture;\n    uniform vec2 time;\n    uniform vec2 ratio;\n    varying vec2 vUv;\n\n        #define PI 3.14159265358979\n        \n    void main() {\n      vec4 Cd=texture2D( tDiffuse, vUv );\n            vec4 pCd=texture2D( tDiffusePrev, vUv );\n            vec3 dCd=Cd.rgb-pCd.rgb;\n            vec3 b1Cd= texture2D( tDiffuse, vUv-vec2( dCd.rg*.1 ) ).rgb;\n            vec3 b2Cd= texture2D( tDiffusePrev, vUv+vec2( dCd.rg*.1 ) ).rgb;\n            b1Cd=mix( b1Cd, b2Cd, step( length(b1Cd), length(b2Cd) ) );\n            \n            vec4 outCd=vec4(1.0);\n            outCd.rgb= mix(  Cd.rgb, b1Cd, length(dCd) );\n            \n      vec3 noiseCd=texture2D( noiseTexture, fract( vUv*50.0+dCd.rg*.1 + length(Cd.rgb*30.0) + time.x) ).rgb;\n\n            outCd.rgb= mix( vec3(length(outCd.rgb)*.333-length(noiseCd)*.1), outCd.rgb, min(1.0,length(dCd))*.5+.5 );\n            outCd.rgb+= dCd.gbr;\n            \n            \n            \n      outCd.a=1.0;\n      gl_FragColor = outCd;\n    }"}function pxlNav_sFieldPostProcessVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform vec2 time;\n    varying vec2 vUv;\n    varying vec2 vUvShift;\n    varying vec2 starUv;\n    varying float vTimer;\n\n    void main(){\n        vUv=uv;\n        vUvShift=uv-.5;\n        \n        vec2 rUv=vUvShift*0.7071067811865476;\n        vec2 tmpUv=rUv;\n        float rot=time.x*.1;\n        vec2 sinCos=vec2( sin(rot), cos(rot) );\n        rUv.x=sinCos.x*tmpUv.x + sinCos.y*tmpUv.y;\n        rUv.y=sinCos.y*tmpUv.x - sinCos.x*tmpUv.y;\n        rUv=(rUv+.5);\n        \n        float starTimer=sin(time.x*.2)*.1+.1;\n        starUv=mix( vUv, rUv, starTimer);\n        \n        vTimer=time.x*.5;\n        \n        vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);\n        gl_Position = projectionMatrix*modelViewPosition;\n    }"}function pxlNav_sFieldPostProcessFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n        uniform sampler2D tDiffuse;\n        uniform sampler2D starTexture;\n        varying vec2 vUv;\n        varying vec2 vUvShift;\n        varying vec2 starUv;\n        varying float vTimer;\n\n        #define PI 3.14159265358979\n        \n        void main() {\n            float uvDist=length(vUvShift);\n            \n            vec3 starCd=texture2D( starTexture, starUv ).rgb*uvDist;\n            \n            float blender=uvDist*starCd.b * abs((fract(starCd.b*PI+vTimer))*2.0-1.0)*.5;\n            vec2 starBlendUV=starCd.rg*blender;\n            \n            vec2 cdUv = vUv+starBlendUV;\n            vec4 Cd=texture2D( tDiffuse, cdUv );\n            \n            vec3 negCd= mix( Cd.brg, Cd.gbr, length(Cd.rgb-Cd.rgb) );\n            float cdBlender=step(.015,starBlendUV.x*uvDist)+starCd.b;\n            Cd.rgb= mix( Cd.rgb, negCd, cdBlender );\n            \n            gl_FragColor = Cd;\n        }"}function pxlNav_warpPostProcess(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D tDiffuse;\n    uniform sampler2D noiseTexture;\n    uniform sampler2D animTexture;\n    uniform vec2 time;\n    uniform vec2 fader;\n    varying vec2 vUv;\n\n    void main() {\n      vec4 Cd=texture2D( tDiffuse, vUv );\n      vec4 animCd=texture2D( animTexture, vUv );\n      float timer=time.x*.2;\n      vec2 animUV=vec2( mod(animCd.r+Cd.r+Cd.g+timer, 1.0), mod(animCd.g+Cd.g+Cd.b+timer, 1.0) );\n      animCd=texture2D( animTexture, animUV );\n      \n      vec2 noiseUV=animUV+animCd.rg;\n      vec4 noiseCd=texture2D(noiseTexture,noiseUV);\n      noiseCd.rgb=vec3( length( noiseCd.rgb )*.5-.25 );\n      \n      float blend=fader.x*fader.y;\n      Cd=mix( Cd, noiseCd, blend);\n      \n      Cd.a=1.0;\n      Cd.r=1.0;\n      gl_FragColor = Cd;\n    }"}function pxlNav_finalOverlayHeavyShader(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n        uniform sampler2D tDiffuse;\n        uniform sampler2D rDiffuse;\n        uniform sampler2D bloomTexture;\n        uniform sampler2D sceneDepth;\n        uniform sampler2D scenePos;\n        uniform sampler2D noiseTexture;\n        uniform vec3 camPos;\n        uniform vec2 time;\n        uniform vec2 fogMult;\n        uniform vec2 proximityMult;\n        uniform float ratio;\n        uniform float exposure;\n        varying vec2 vUv;\n\n        vec3 fogValue( vec3 worldPos, float time ){\n            float wpDist = worldPos.x+worldPos.z*2.0;\n            vec2 noiseUV = vec2( ((time*.5+wpDist*.60)), (worldPos.y*.7+time*.25 ));\n            vec3 noiseCd = texture2D(noiseTexture,noiseUV).rgb;\n            noiseUV=vec2( ((time*.3+wpDist*.55)), (worldPos.x*.5+time*.35 ));\n            noiseCd.g=texture2D(noiseTexture,noiseUV+vec2(0.0,time)).g;\n            noiseUV=vec2( ((time*1.2+wpDist*.83)), (worldPos.y+time*.15  ));\n            noiseCd.b=texture2D(noiseTexture,noiseUV).b;\n            \n            return noiseCd;\n        }\n\n        #define PROX_WARP 3.14159265358979*.45\n        \n        void main() {\n            vec4 Cd=texture2D(rDiffuse,vUv);\n            float depth=texture2D(sceneDepth,vUv).r;\n            \n            vec3 worldPos = texture2D(scenePos,vUv).rgb;\n            float t = -time.x*.003;\n            vec3 baseNoiseCd=fogValue( worldPos, t );\n            \n            float mult=0.0;\n            vec3 noiseCd;\n            vec3 curNoiseCd;\n            vec3 samplePos;\n            float samples=4.3;//+sin(time.x*.001);\n            float blender;\n            float blenderMax=0.0;\n            for( int x=0; x<=3; ++x){\n                blender=( float(x+1) / samples );\n                samplePos=worldPos*blender;\n                curNoiseCd=fogValue( samplePos, t );\n                noiseCd=max(noiseCd, curNoiseCd * blender );\n                blenderMax+=blender;\n            }\n            noiseCd += baseNoiseCd*.2;\n            mult= noiseCd.x*noiseCd.y*noiseCd.z*1.2;\n            //mult*=mult;\n            \n            // Distance Mapping\n            float proxWarp= cos(( vUv.x-.5 ) * PROX_WARP*ratio );\n            float mDepth= pow( depth, 28.*proxWarp );\n            \n            float fogDap= max(0.0, 1.0-mDepth);\n            fogDap=1.0-fogDap*fogDap;\n            mult*=max(0.0, (worldPos.y-0.04)*1.65) * fogMult.x * fogDap ;\n            \n            \n            Cd.rgb= mix( Cd.rgb, vec3(mult*.7), mult)-mult*.35;\n \n            vec3 bloomCd=texture2D(bloomTexture,vUv).rgb;\n            Cd.rgb+= bloomCd;\n            Cd.rgb*=exposure;\n            \n            // Proximity Draw Over\n            float dProx=  ((mDepth-.5)*-10.);\n            dProx= max(0.0, (1.0-dProx)*step( 0., dProx));\n            float yProxMult= 1.0-min(1.0, max(0.0, (worldPos.y-.5 )*1000.));\n            dProx*= dProx* yProxMult * proximityMult.x;\n            vec3 proxCd = (vec3(.5,.5,.2)*dProx)*.5;\n            Cd.rgb+=proxCd*mult;\n            \n            Cd.a=1.0;\n            gl_FragColor = Cd;\n    }"}function pxlNav_finalOverlayShader(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n        uniform sampler2D tDiffuse;\n        uniform sampler2D rDiffuse;\n        uniform sampler2D bloomTexture;\n        uniform sampler2D sceneDepth;\n        uniform sampler2D scenePos;\n        uniform sampler2D noiseTexture;\n        uniform vec2 time;\n        uniform vec2 fogMult;\n        uniform vec2 proximityMult;\n        uniform vec2 lookAtPerc;\n        uniform vec2 resUV;\n        uniform float ratio;\n        uniform float exposure;\n        varying vec2 vUv;\n\n        #define PROX_WARP 3.14159265358979*.45\n\n        void main() {\n            vec4 Cd=texture2D(rDiffuse,vUv);\n            float depth=texture2D(sceneDepth,vUv).r;\n            \n            vec3 worldPos = texture2D(scenePos,vUv).rgb;\n            float wpDist = worldPos.x+worldPos.z*2.0;\n            float t = -time.x*.003;\n            \n            vec2 noiseUV = vec2( ((t*.5+wpDist*.60)), (worldPos.y*.7+t*.25 ));\n            vec3 noiseCd = texture2D(noiseTexture,noiseUV).rgb;\n            noiseUV=vec2( ((t*.3+wpDist*.55)), (worldPos.x*.5+t*.35 ));\n            noiseCd.g=texture2D(noiseTexture,noiseUV+vec2(0.0,t)).g;\n            noiseUV=vec2( ((t*1.2+wpDist*.83)), (worldPos.y+t*.15  ));\n            noiseCd.b=texture2D(noiseTexture,noiseUV).b;\n            \n            \n            // Distance Mapping\n            float proxWarp= cos(( vUv.x-.5 ) * PROX_WARP*ratio );\n            float mDepth= pow( depth, 28.*proxWarp );\n            \n            float fogDap= max(0.0, 1.0-mDepth);\n            fogDap=1.0-fogDap*fogDap;\n            float mult=noiseCd.x*noiseCd.y*noiseCd.z*1.3;\n            mult*=max(0.0, (worldPos.y-0.04)*1.65) * fogMult.x * fogDap;\n            \n            \n            Cd.rgb= mix( Cd.rgb, vec3(mult), mult)-mult*.4;\n \n            vec3 bloomCd=texture2D(bloomTexture,vUv).rgb;\n            Cd.rgb+= bloomCd;\n            Cd.rgb*=exposure;\n            \n            // Proximity Draw Over\n            float dProx=  ((mDepth-.5)*-10.);\n            dProx= max(0.0, (1.0-dProx)*step( 0., dProx));\n            float yProxMult= 1.0-min(1.0, max(0.0, (worldPos.y-.5 )*1000.));\n            dProx*= dProx* yProxMult * proximityMult.x;\n            vec3 proxCd = (vec3(.5,.5,.2)*dProx)*.5;\n            Cd.rgb+=proxCd*mult;\n            \n            Cd.a=1.0;\n            gl_FragColor = Cd;\n        }"}function pxlNav_finalOverlaySlimShader(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n        uniform sampler2D tDiffuse;\n        uniform sampler2D rDiffuse;\n        uniform sampler2D bloomTexture;\n        uniform sampler2D sceneDepth;\n        uniform vec2 time;\n        uniform vec2 proximityMult;\n        uniform vec2 lookAtPerc;\n        uniform vec2 resUV;\n        uniform float ratio;\n        uniform float exposure;\n        varying vec2 vUv;\n\n        #define PROX_WARP 3.14159265358979*.4\n        #define PI 3.14159265358979\n        \n        vec3 boostHighs( vec3 Cd ){\n            float sat=max(max(Cd.r,Cd.g),Cd.b) - min(min(Cd.r,Cd.g),Cd.b);\n            sat=(1.0-sat);\n            sat=1.0-sat*sat;\n            Cd+=Cd*sat;\n            return Cd;\n        }\n        \n        vec3 boostMids( vec3 Cd ){\n            float sat=max(max(Cd.r,Cd.g),Cd.b) - min(min(Cd.r,Cd.g),Cd.b);\n            sat=sin( sat*PI );\n            Cd+=Cd*sat;\n            return Cd;\n        }\n        \n        void main() {\n            vec4 Cd=texture2D(rDiffuse,vUv);\n            vec2 uv=vUv;\n            \n            vec3 bloomCd=texture2D(bloomTexture,uv).rgb;\n            bloomCd= mix( boostHighs(Cd.rgb), bloomCd,  step( 0.01, length( bloomCd )) );\n            \n            Cd.rgb+= bloomCd;\n\n            // Proximity Draw Over\n            float depth=texture2D(sceneDepth,vUv).r;\n            \n            // Distance Mapping\n            float proxWarp= cos(( vUv.x-.5 ) * PROX_WARP*ratio );\n            float mDepth= pow( depth, 28.*proxWarp );\n            \n            // Proximity Draw Over\n            float dProx=  ((mDepth-.5)*-10.);\n            dProx= max(0.0, (1.0-dProx)*step( 0., dProx));\n            dProx*= dProx * proximityMult.x;\n            vec3 proxCd = (vec3(.5,.5,.2)*dProx)*.5;\n            Cd.rgb+=proxCd;\n            Cd.r=1.0;\n            Cd.a=1.0;\n            gl_FragColor = Cd;\n        }"}function pxlNav_bgScreenVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform vec2 time;\n    \n    varying vec2 vUv;\n    varying vec3 vCamNormal;\n    varying vec3 vWorldNormal;\n    varying vec3 vWorldCross;\n    varying vec3 vSunPos;\n    \n    void main(){\n        vUv=uv;\n        \n        mat4 pvMat=projectionMatrix * viewMatrix;\n        pvMat[3] = vec4(.0, .0, .0, 1.0);\n        mat3 pvRot = inverse( mat3( pvMat ) );\n        vCamNormal= pvRot * vec3( position*.2 + vec3(.0, .0, 1.0));\n        vWorldNormal= normalize( pvRot[2] *vec3(1.,0.,1.));\n        vWorldCross= normalize( pvRot[0]*vec3(1.,0.,1.));\n        \n        float timeRate = time.x * .1;\n        vec3 sunPos = normalize( vec3(.3, 1.0, 1.0) );\n        vec3 sunRef = sunPos;\n        sunPos.y= sin(timeRate) * sunRef.y + cos(timeRate)*sunRef.z;\n        sunPos.z= sin(timeRate) * sunRef.z - cos(timeRate)*sunRef.y;\n        sunPos.x = sin( timeRate ) * .1;\n        \n        vSunPos = normalize( sunPos );\n        \n        vec4 modelViewPosition= vec4(position*2.0 + vec3(.0, .0, 1.0), 1.0);\n        gl_Position = modelViewPosition;\n    }"}function pxlNav_bgScreenFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D noiseTexture;\n    varying vec2 vUv;\n    varying vec3 vCamNormal;\n    varying vec3 vWorldNormal;\n    varying vec3 vWorldCross;\n    varying vec3 vSunPos;\n    \n    void main(){\n        vec4 Cd=vec4( vec3(1.0, .10, .10), 1.0);\n        \n        float sunDot = dot( vSunPos, vCamNormal )*.5 +.5;\n        sunDot *= max(0.0, dot( vSunPos, vec3(.0, 1.0, .0)) );\n        \n        vec2 xOffset = vec2( .0, .0);\n        vec3 nCd=texture2D(noiseTexture,vUv*.1+vSunPos.zy*vec2(.15,.22) + xOffset ).rgb;\n        nCd*=texture2D(noiseTexture,vUv*.1+vSunPos.yx*.2).rgb;\n        sunDot *= nCd.x*nCd.y*nCd.z;\n        nCd= vec3( length( nCd ) );\n        \n        float mixVal= min(1.0, sunDot+(1.-(vWorldNormal.y*.5+.5)));\n        Cd.rgb= mix(vec3(0.0, .20, 1.0)+nCd*vWorldNormal.y, vec3(.0, .0, .0), mixVal);\n        Cd.rgb=mix( vec3(.0), Cd.rgb, vWorldNormal.y );\n        Cd.rgb=vec3(mix( vWorldNormal, vWorldCross, step(.4, vUv.x)));\n        Cd.rgb=vec3(mix( vWorldCross, Cd.rgb, step(vUv.y,.9)));\n        gl_FragColor=Cd;\n    }"}function pxlNav_skyObjectVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform float camFar;\n    uniform vec2 resUV;\n    \n    varying vec2 vUv;\n    varying vec3 vLocalPos;\n    varying vec4 vWorldPos;\n    \n    void main(){\n        vUv=uv;\n        vLocalPos=position;\n        \n        vec3 pos = position;\n        vec4 modelViewPosition=projectionMatrix * vec4(mat3(viewMatrix)*normalize(pos)*camFar, 1.0);\n        gl_Position = modelViewPosition;\n        \n        vWorldPos = modelViewPosition;\n        \n    }"}function pxlNav_skyObjectFrag(){var u="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return u+="     \n    uniform sampler2D diffuse;\n    uniform sampler2D envDiffuse;\n    uniform sampler2D noiseTexture;\n    uniform vec2 time;\n    uniform float camNear;\n    uniform float camFar;\n    uniform vec2 resUV;\n\n    uniform float rate;\n    uniform vec3 fogColor;\n    \n    varying vec2 vUv;\n    varying vec3 vLocalPos;\n    varying vec4 vWorldPos;\n    \n    #define PI 3.14159265358979323\n\n    float fitDepth( float zDepth ){\n        float viewZ = ( camNear * camFar ) / ( ( camFar - camNear ) * zDepth - camFar );\n        return ( viewZ + camNear ) / ( camNear - camFar );\n    }\n    \n    void main(){\n        vec2 uv=vUv;\n        vec2 screenUV=(vec2(vWorldPos.xy/vWorldPos.w))*.5+.5;\n        vec4 Cd=texture2D(diffuse,uv);\n  ",(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Us.OFF)==Us.VAPOR&&(u+="\n\n        \n        vec3 lPos = vLocalPos;\n        lPos.y = abs(lPos.y)*0.05;\n\n        float t = time.x*.6;\n\n        vec2 nUv =  vec2(vUv.x*0.20, vUv.y - t*.0065  - lPos.y );\n        vec3 noiseCd = texture2D( noiseTexture, nUv ).rgb;\n        nUv = ( nUv+noiseCd.rg*(noiseCd.b) + t*.02);\n        noiseCd = texture2D( noiseTexture, nUv ).rgb;\n        noiseCd.rg = noiseCd.rg*2.0-1.0;\n        \n        float zFrag = texture2D( envDiffuse, screenUV ).x;\n        float depth = fitDepth( zFrag );\n        float stencil = zFrag==1.0 ? 1.0 : 0.0;\n        \n        float reachDepth = 0.0 ;\n        \n\n        vec2 baseUV=screenUV;\n        vec2 curUV=vec2(0.0);\n        float curDepth=0.0;\n        float curPerc = 0.0;\n        float dist = 11.0;\n        float blendStep = .4;\n        float blend = 0.0;\n        float uvShift=0.0;\n        for(int s=0; s<5; ++s){\n            uvShift = mix(noiseCd.r, noiseCd.g, (noiseCd.b+float(s)*193.5247))*15.0;\n            curUV = baseUV+vec2(0.0,resUV.y*-(dist+uvShift)  - t*.005 );\n            curDepth = texture2D(envDiffuse,curUV).x ;\n            curDepth = fitDepth( curDepth );\n            curPerc = step( .3, (1.0-curDepth)*7.00 );\n            reachDepth += min(1.0,curDepth)*curPerc;\n            blend += blendStep;\n            dist+=dist*dot(noiseCd.rgb, vec3(0.0,0.0,1.0));\n        }\n        reachDepth *= blend*stencil*3.0;\n\n        vec3 normPos = normalize(vLocalPos);\n        normPos.y = 1.0-min(1.0,(normPos.y)*2.0);\n        normPos.y = normPos.y*normPos.y*normPos.y;\n        depth = clamp(reachDepth+normPos.y, 0.0, 1.0)*.02;\n        \n        float fogMixer = (Cd.r+Cd.g+Cd.b) - (fogColor.r+fogColor.g+fogColor.b) ;\n        vec3 toFogColor = mix( fogColor, Cd.rgb, step(0.0, fogMixer) );\n        float blender = (sin(noiseCd.r*PI+t+uv.x))*max(0.0,1.0-(depth+fogMixer))*.1 ;\n        vec3 baseColor = (toFogColor-min(1.0,blender+ depth*10.0)) ;\n        \n        \n        Cd.rgb = mix(Cd.rgb, baseColor, depth);\n\n    "),u+="\n        // Convert to sRGB\n        Cd.rgb = mix( 12.92 * Cd.rgb, 1.055 * pow(Cd.rgb, vec3(1.0 / 2.4)) - 0.055, step(0.0031308, Cd.rgb) );\n\n        gl_FragColor=Cd;\n    }"}var Js={animated:D,core:E,objects:I,particles:k,rendering:R,scene:O};class pxlNav_ParticleBase{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"particles";this.name=d,this.room=u,this.geometry=null,this.material=null,this.points=null,this.count=-1,this.pscale=new j.Vector2(0,0),this.position=new j.Vector3(0,0,0),this.atlasPath="sprite_dustLiquid.png",this.atlasPath="sprite_dustAtlas.png"}build(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;x||(x=this.elementDuplicator([[0,.75],[0,.5],[.25,.75],[.25,.5]],4)),this.addToScene(u,d,v,x)}setPosition(){for(var u=arguments.length,d=new Array(u),v=0;v<u;v++)d[v]=arguments[v];1===d.length?this.position=d[0]:this.position=new j.Vector3(...d),this.points&&this.points.position.copy(this.position)}addToScene(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4,y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[[0,0]],b=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.count=u,this.pscale.x=d*this.room.pxlEnv.pxlQuality.screenResPerc,this.isInternalTexture=!1;var _=null;b?(_=this.atlasRandomGen,y=x):_=this.atlasArrayPicker,v||(v=this.newMaterial());for(var w=[],S=[],C=[],P=0;P<u;++P)w.push(0,0,0),S.push(Math.random(),Math.random(),2*Math.random()-1,2*Math.random()-1),C.push(..._(y));var A=new j.Float32BufferAttribute(w,3),T=new j.Float32BufferAttribute(S,4),E=new j.Float32BufferAttribute(C,2),D=new j.BufferGeometry;D.setAttribute("position",A),D.setAttribute("seeds",T),D.setAttribute("atlas",E);var I=new j.Points(D,v);return I.sortParticles=!1,I.frustumCulled=!1,this.room.scene.add(I),I.layers.set(1),I.pBaseScale=d,this.room.geoList[this.name]=I,this.geometry=D,this.material=v,this.points=I,I.position.copy(this.position),I}setUserHeight(u){this.pxlEnv.pxlCamera.userScale=u}atlasRandomGen(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,v=1/u;return Array.from({length:d}).map((()=>Math.floor(648405.71*Math.random()%u)*v))}atlasRandomList(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return Array.from({length:u}).map((u=>this.atlasRandomGen(d,v)))}atlasArrayPicker(u){return u[Math.floor(92314.75*Math.random()%u.length)]}dupeArray(u,d){return Array.from({length:d}).fill(u)}elementDuplicator(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;return u.map((u=>this.dupeArray(u,d))).flat(1)}findLightPositions(){var u=[];return this.room.lightList.hasOwnProperty("PointLight")&&(this.room.lightList.PointLight.length,this.room.lightList.PointLight.forEach((d=>{u.push(d.position.clone())}))),u}setAtlasPath(u){this.atlasPath=u,this.isInternalTexture=!1}useInternalAsset(u){this.atlasPath=u,this.isInternalTexture=!0}newMaterial(){var u=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],d=this.findLightPositions(),v={atlasTexture:{type:"t",value:null},noiseTexture:{type:"t",value:null},time:{type:"f",value:this.room.msRunner},pointScale:{type:"f",value:this.pscale},intensity:{type:"f",value:1},rate:{type:"f",value:.035},lightPos:{value:d}},x=this.room.pxlFile.pxlShaderBuilder(v,pxlNav_dustVert(d.length),"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D atlasTexture;\n    uniform vec2 time;\n    uniform float rate;\n    \n    varying vec2 vAtlas;\n    varying vec2 vRot;\n    varying float vScalar;\n    varying float vAlpha;\n    \n    void main(){\n        vec2 uv=gl_PointCoord;\n\n        vec2 pos = (uv-.5)*.85;\n\n        vec2 rotUV;\n        rotUV.x = vRot.y * pos.x - vRot.x * pos.y;\n        rotUV.y = vRot.x * pos.x + vRot.y * pos.y;\n        rotUV=(rotUV+.5)*.25+vAtlas;\n        \n        vec4 dustCd=texture2D(atlasTexture,rotUV);\n        float alpha=dustCd.a*vAlpha; // *vScalar;\n        vec4 Cd=vec4( dustCd.rgb, alpha );\n\n        gl_FragColor=Cd;\n    }");return x.side=j.DoubleSide,x.transparent=!0,this.isInternalTexture?x.uniforms.atlasTexture.value=this.room.pxlEnv.getAssetTexture(this.atlasPath,4,{magFilter:j.NearestFilter,minFilter:j.NearestMipmapNearestFilter}):x.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasPath,4,{magFilter:j.NearestFilter,minFilter:j.NearestMipmapNearestFilter}),x.uniforms.noiseTexture.value=this.room.softNoiseTexture,x.depthTest=!0,x.depthWrite=!1,u&&(this.room.materialList[this.name]=x),x}}var Qs={pxlParticles:{BillowSmoke:class pxlNav_BillowSmoke extends pxlNav_ParticleBase{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"billowSmoke";super(u,d),this.name=d,this.room=u}build(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:56,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;x||(x=[...super.dupeArray([0,0],4),...super.dupeArray([.25,0],4),...super.dupeArray([.5,0],2),...super.dupeArray([.5,.25],2),...super.dupeArray([.5,.5],2),...super.dupeArray([.5,.75],2),...super.dupeArray([.75,.75],4),...super.dupeArray([.75,.25],3),...super.dupeArray([.75,.25],3)]);var y={atlasTexture:{type:"t",value:null},noiseTexture:{type:"t",value:null},time:{type:"f",value:this.room.msRunner},pointScale:{type:"f",value:this.pscale},intensity:{type:"f",value:.8},rate:{type:"f",value:2.85}},b=this.room.pxlFile.pxlShaderBuilder(y,pxlNav_smokeVert(),"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n        \n    uniform sampler2D atlasTexture;\n    uniform vec2 time;\n    uniform float rate;\n    \n    varying vec2 vAtlas;\n    varying vec2 vRot;\n    varying float vAlpha;\n    varying float vBrightness;\n    \n    void main(){\n        vec2 uv=gl_PointCoord;\n\n        vec2 pos = (uv-.5)*.85;\n\n        vec2 rotUV;\n        rotUV.x = vRot.y * pos.x - vRot.x * pos.y;\n        rotUV.y = vRot.x * pos.x + vRot.y * pos.y;\n        rotUV=(rotUV+.5)*.25+vAtlas;\n        \n        vec4 dustCd=texture2D(atlasTexture,rotUV);\n        float alpha=dustCd.a*vAlpha;\n        vec4 Cd=vec4( dustCd.rgb, alpha );\n\n        Cd.rgb *= vec3(vBrightness);\n        \n        gl_FragColor=Cd;\n    }");b.side=j.DoubleSide,b.transparent=!0,b.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasPath,4,{magFilter:j.NearestFilter,minFilter:j.NearestMipmapNearestFilter}),b.uniforms.noiseTexture.value=this.room.softNoiseTexture,b.depthTest=!0,b.depthWrite=!1,this.room.materialList[this.name]=b,super.addToScene(u,d,b,v,x)}},EmberWisps:class pxlNav_EmberWisps extends pxlNav_ParticleBase{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"emberWisps";super(u,d),this.name=d,this.room=u}build(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;x||(x=super.elementDuplicator([[0,.75],[0,.5],[.25,.75],[.25,.5]],4));var y={atlasTexture:{type:"t",value:null},noiseTexture:{type:"t",value:null},time:{type:"f",value:this.room.msRunner},pointScale:{type:"f",value:this.pscale},intensity:{type:"f",value:1},rate:{type:"f",value:5.5}},b=this.room.pxlFile.pxlShaderBuilder(y,pxlNav_emberWispsVert(),"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n                \n    uniform sampler2D atlasTexture;\n    uniform vec2 time;\n    uniform float rate;\n    \n    varying vec3 vCd;\n    varying vec2 vAtlas;\n    varying vec2 vRot;\n    varying float vAlpha;\n    varying float vBrightness;\n    \n    void main(){\n        vec2 uv=gl_PointCoord;\n\n        vec2 pos = (uv-.5)*.85;\n\n        vec2 rotUV;\n        rotUV.x = vRot.y * pos.x - vRot.x * pos.y;\n        rotUV.y = vRot.x * pos.x + vRot.y * pos.y;\n        rotUV=(rotUV+.5)*.25+vAtlas;\n        \n        vec4 dustCd=texture2D(atlasTexture,rotUV);\n        float alpha=dustCd.a*vAlpha;\n        \n        //dustCd.rgb = 1.0 - (1.0 - dustCd.rgb ) * vBrightness;\n        dustCd.rgb *= vBrightness;\n        \n        vec4 Cd=vec4( dustCd.rgb * vCd * vBrightness, alpha );\n        gl_FragColor=Cd;\n    }");b.side=j.DoubleSide,b.transparent=!0,b.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasPath,4,{magFilter:j.NearestFilter,minFilter:j.NearestMipmapNearestFilter}),b.uniforms.noiseTexture.value=this.room.softNoiseTexture,b.depthTest=!0,b.depthWrite=!1,this.room.materialList[this.name]=b,super.addToScene(u,d,b,v,x)}},FloatingDust:class pxlNav_FloatingDust extends pxlNav_ParticleBase{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"floatingDust";super(u,d),this.name=d,this.room=u}build(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:7,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:120,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,0,0],y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[0,1],b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,_=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];b||(b=[...super.dupeArray([0,0],4),...super.dupeArray([.25,0],4),...super.dupeArray([.5,0],2),...super.dupeArray([.5,.25],2),...super.dupeArray([.5,.5],2),...super.dupeArray([.5,.75],2),...super.dupeArray([.75,.75],4),...super.dupeArray([.75,.25],3),...super.dupeArray([.75,.25],3)]);var w=super.findLightPositions();y=new j.Vector2(y[0],y[1]),x=new j.Vector3(x[0],x[1],x[2]);var S={atlasTexture:{type:"t",value:null},noiseTexture:{type:"t",value:null},time:{type:"f",value:this.room.msRunner},pointScale:{type:"f",value:this.pscale},intensity:{type:"f",value:1},rate:{type:"f",value:.035},positionOffset:{type:"v",value:x},windDir:{type:"v",value:y},lightPos:{value:w}},C=this.room.pxlFile.pxlShaderBuilder(S,pxlNav_dustVert(w.length,v),"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D atlasTexture;\n    uniform vec2 time;\n    uniform float rate;\n    \n    varying vec2 vAtlas;\n    varying vec2 vRot;\n    varying float vScalar;\n    varying float vAlpha;\n    \n    void main(){\n        vec2 uv=gl_PointCoord;\n\n        vec2 pos = (uv-.5)*.85;\n\n        vec2 rotUV;\n        rotUV.x = vRot.y * pos.x - vRot.x * pos.y;\n        rotUV.y = vRot.x * pos.x + vRot.y * pos.y;\n        rotUV=(rotUV+.5)*.25+vAtlas;\n        \n        vec4 dustCd=texture2D(atlasTexture,rotUV);\n        float alpha=dustCd.a*vAlpha; // *vScalar;\n        vec4 Cd=vec4( dustCd.rgb, alpha );\n\n        gl_FragColor=Cd;\n    }");C.side=j.DoubleSide,C.transparent=!0,this.isInternalTexture?C.uniforms.atlasTexture.value=this.room.pxlEnv.getAssetTexture(this.atlasPath,4,{magFilter:j.NearestFilter,minFilter:j.NearestMipmapNearestFilter}):C.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasPath,4,{magFilter:j.NearestFilter,minFilter:j.NearestMipmapNearestFilter}),C.uniforms.noiseTexture.value=this.room.softNoiseTexture,C.depthTest=!0,C.depthWrite=!1,this.room.materialList[this.name]=C,super.addToScene(u,d,C,4,b,_)}}}};class pxlNav_RoomEnvironment{constructor(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"CampfireEnvironment",d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,_=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,w=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,C=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null;this.roomName=u,this.pxlFile=v,this.pxlUtils=y,this.pxlAnim=x,this.pxlDevice=b,this.pxlEnv=_,this.booted=!1,this.initScene=!0,this.active=!0,this.assetPath=d+"Assets/",this.mobile=b.mobile,this.sceneFile=this.assetPath+"CampfireEnvironment.fbx",this.animFile=this.assetPath+"Campfire_RabbitDruidA_anim.fbx",this.animClips={},this.animMixer=null,this.spiralizerUniforms={},this.materialList={},this.camInitPos=null,this.camInitLookAt=null,this.camThumbPos=new j.Vector3(0,0,-30),this.camThumbLookAt=new j.Vector3(0,35,-1e3),this.cameraBooted=!1,this.cameraPrevPos=new j.Vector3(0,0,0),this.cameraAimTarget=new j.Object3D(0,0,0),this.camHoldWarpPos=!0,this.camLocation={},this.pxlCamFOV=this.mobile?80:60,this.pxlCamZoom=1,this.pxlCamAspect=1,this.pxlCamNearClipping=5,this.pxlCamFarClipping=1e4,this.fogColor=new j.Color(.01,.02,.05),this.fogExp=7e-4,this.fog=new j.FogExp2(this.fogColor,this.fogExp),this.userAvatarGroup=new j.Group,this.packedTextureMaterial=null,this.coreTextureMaterial=null,this.projectedMaterial=null,this.voidMaterial=null,this.holoMaterial=null,this.aspectRatio=null,this.flag=null,this.initPos=[],this.finalPos=[],this.midPos=new j.Vector3(0,30,-50),this.perspectiveInstances=160,this.startTime=0,this.runTime=new j.Vector2(0,0),this.msRunner=w,this.camera=S,this.autoCamPaths={},this.scene=C,this.lightList={},this.geoList={},this.glassGroup=null,this.glassList=[],this.particleList={},this.portalList={},this.enableRaycast=!1,this.hoverableExists=!1,this.hoverableList=[],this.hoverableObj=null,this.clickableExists=!1,this.clickableList=[],this.clickableObj=null,this.collidersExist=!1,this.colliderActive=!1,this.colliderList={noAxis:[],11:[],"01":[],10:[],"00":[]},this.antiColliderActive=!1,this.antiColliderList={noAxis:[],11:[],"01":[],10:[],"00":[]},this.antiColliderTopActive=!1,this.antiColliderTopList={noAxis:[],11:[],"01":[],10:[],"00":[]},this.roomWarp=[],this.warpPortalTexture=null,this.warpZoneRenderTarget=null,this.worldPosMaterial=null,this.worldPosRenderTarget=null,this.spiralizerPass=null,this.bloomPreState=!1,this.cloud3dTexture=null,this.smoothNoiseTexture=null,this.currentShader=null}init(){this.scene.fog=this.fog,this.scene.background=this.fogColor,this.cloud3dTexture=this.pxlEnv.cloud3dTexture,this.cloud3dTexture.wrapS=j.RepeatWrapping,this.cloud3dTexture.wrapT=j.RepeatWrapping,this.smoothNoiseTexture=this.pxlEnv.softNoiseTexture,this.smoothNoiseTexture.wrapS=j.RepeatWrapping,this.smoothNoiseTexture.wrapT=j.RepeatWrapping}start(){this.booted&&this.resetCamera()}step(){this.runTime.x=this.msRunner.x}stop(){}resize(u,d){}setUserHeight(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.pxlEnv.pxlCamera.userScale=u}resetCamera(){this.pxlEnv.pxlCamera.setTransform(this.camInitPos,this.camInitLookAt)}prepPortalRender(){this.geoList.intro.visible=!1,this.geoList.MainRoomWarp.visible=!1}cleanupPortalRender(){this.geoList.intro.visible=!0,this.geoList.MainRoomWarp.visible=!0}setPortalTexture(u){this.geoList.MainRoomWarp.material.map=u}applyRoomPass(){}getArtistInfo(){return null}setFog(u){}getShaderList(){var u={};return Object.keys(this.materialList).forEach((d=>{u[d]=d})),u}getCurrentShader(){return this.currentShader||Object.keys(this.materialList)[0]}readShader(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null!=this.currentShader&&this.materialList[this.currentShader].hasOwnProperty("uniforms")&&(d||(d=new j.Vector3),this.materialList[this.currentShader].uniforms.sliders.value=d,this.materialList[this.currentShader].needsUpdate=!0),this.currentShader=u,this.materialList[this.currentShader]}setShader(u,d,v){this.emitterList&&this.emitterList[this.currentShader]&&this.emitterList[this.currentShader].Particles.length>0&&this.emitterList[this.currentShader].Particles.forEach((u=>{var x=u.material;x.vertexShader=d,x.fragmentShader=v,x.needsUpdate=!0})),this.materialList[this.currentShader].vertexShader=d,this.materialList[this.currentShader].fragmentShader=v,this.materialList[this.currentShader].needsUpdate=!0}castRay(u,d){if(this.enableRaycast)if(!u&&!this.hoverableExists||u&&!this.clickableExists)this.mouseRayHits=[];else{var v=[];!u&&this.hoverableExists?v=this.hoverableList:u&&this.clickableExists&&(v=this.clickableList);var x=[];if(v.length>0){var y=new j.Vector2(this.pxlDevice.mouseX/this.pxlDevice.sW*2-1,-this.pxlDevice.mouseY/this.pxlDevice.sH*2+1);this.pxlEnv.pxlCamera.objRaycast.setFromCamera(y,this.pxlEnv.pxlCamera.camera),x=this.pxlEnv.pxlCamera.objRaycast.intersectObjects(v)}this.mouseRayHits=x}}toCameraPos(u){if(this.cameraBooted&&this.camLocation.hasOwnProperty(u)){var d=this.mobile?"PositionMobile":"Position",v=this.mobile?"LookAtMobile":"LookAt",x=this.camLocation[u][d],y=this.camLocation[u][v];y||(y=new j.Vector3(0,0,1)).addVectors(x,y),this.pxlEnv.pxlCamera.setTransform(this.camLocation[u][d],this.camLocation[u][v]),this.setUserHeight(this.camInitPos.y)}}fbxPostLoad(){this.toCameraPos("Default");var u=0;if(this.lightList.hasOwnProperty("PointLight")&&(u=this.lightList.PointLight.length),this.geoList.hasOwnProperty("GlowPass")&&this.geoList.GlowPass.length>0&&this.geoList.GlowPass.forEach((u=>{u.layers.set(this.pxlEnv.renderLayerEnum.GLOW)})),this.geoList.Sky_EqRect_Mesh){var d=this.geoList.Sky_EqRect_Mesh.material;d.uniforms&&d.uniforms.envDiffuse&&(d.uniforms.envDiffuse.value=this.scene.renderTarget.depthTexture)}var v=new j.AmbientLight(3158064);this.scene.add(v);var x=Object.keys(this.lightList);if(x.length>0&&x.forEach((u=>{this.lightList[u].forEach((d=>{"DirectionalLight"==u?d.castShadow=!1:"PointLight"==u&&(d.shadow.radius=5,d.shadow.receiveShadow=!0,d.shadow.mapSize.width=512,d.shadow.mapSize.height=512,d.shadow.camera.near=.5,d.shadow.camera.far=35,d.shadow.bias=.025,d.shadow.radius=5)}))})),this.shaderGeoList)for(var y in this.shaderGeoList){var b=this.shaderGeoList[y];if(b.userData&&"pxlPrincipled"==b.userData.Shader){var _=j.UniformsUtils.merge([j.UniformsLib.common,j.UniformsLib.lights,j.UniformsLib.shadowmap,{dTexture:{type:"t",value:null},noiseTexture:{type:"t",value:null},detailTexture:{type:"t",value:null},cdMult:{type:"f",value:1},fogColor:{type:"c",value:this.scene.fog.color}}]),w={USE_MAP:""},S={},C=1==b.userData.castShadow||1==b.userData.receiveShadow,P=!1;b.material.map||(P=b.material.color.clone()),b.userData.ShaderParms&&""!=b.userData.ShaderParms&&(S=JSON.parse(b.userData.ShaderParms));var A=this.pxlFile.pxlShaderBuilder(_,pxlNav_pxlPrincipledVert(C),pxlNav_pxlPrincipledFrag(S,P,!0,!0,C,u),w);A.transparent=!1,A.lights=!0,P||(A.uniforms.dTexture.value=b.material.map),A.uniforms.noiseTexture.value=this.cloud3dTexture,A.uniforms.detailTexture.value=this.pxlEnv.detailNoiseTexture,b.material=A,this.materialList[b.name]=A}}}animPostLoad(u,d){if(this.pxlAnim.hasClip(u,this.animInitCycle)){var v=this.pxlAnim.getMixer(u);this.animMixer=v,this.pxlAnim.playClip(u,this.animInitCycle)}else this.animInitCycle=fallback,this.log("No animation cycle '"+this.animInitCycle+"' found; Using '"+fallback+"' instead")}build(){}onMessage(u,d){if(console.log("Room : "+this.roomName+" - Message Received: "+u),console.log("Message : "+d),"roomwarp"===(u=u.toLowerCase()))this.roomWarp=d;else console.log("-- Message Type Not Recognized -- "),console.log("Room : "+this.roomName),console.log("Message Received: "+u),console.log("Message : "+d)}}var Ks,Ys,$s="0.0.17",er="pxlNav-coreCanvas",tr=window.innerWidth,ir=window.innerHeight;class pxlNav_pxlNav{constructor(u,d,v,x){this._active=!1;u.hasOwnProperty("pxlRoomRoot")&&u.pxlRoomRoot,this.options={loadList:["Cloud3d","SoftNoise","SmoothNoise","WarpAnimTexture"]},this.options=Object.assign(this.options,u);var y=Object.keys(this.options);Object.keys(js).forEach((u=>{y.includes(u)||(this.options[u]=js[u])})),this.verbose=this.options.verbose,this.projectTitle=d,this.startingRoom=v,x.includes(v)||x.push(v),this.roomBootList=x,this.callbacks={},this.uriHashParms=this.findHashParms(),this.mobile=this.isMobile(),this.autoCam=this.getHashParm("autoCam",!1),this.loadPercent=0,this.folderDict={assetRoot:"assets/",guiRoot:"assets/GUI/",roomRoot:"assets/rooms/",vidRoot:"assets/screenContent/"},this.validEvents={booted:"Emitted after the engine has fully booted and is ready to be addressed.",shaderEditorVis:"Returns a [bool]; Emitted when the shader editor is toggled on or off.","roomChange-Start":"Emitted when the room change transition begins.","roomChange-Middle":"Emitted when the room change process occurs mid transition.","roomChange-End":"Returns a [bool]; Emitted when the room change transition ends.",fromRoom:"Returns a custom object; Emitted from your Room code you choose to emit during run time.","device-keydown":"Returns an [int]; The just pressed key.","device-keyup":"Returns an [int]; The just released key.","device-resize":"Returns an [{height:#,width:#}]; Height Width object of the new window size.",pxlNavEventNameHere:"Never emitted; You did some copy'pasta.","":"** NOTE : callbacks get an event object shaped -  **","":"** { 'type' : *eventName*, 'value' : *data* } **","":"",help:"Hello! I'm here to help you!",pingPong:"Send 'ping', Get 'pong'! - pxlNav.trigger('ping');"},this.validEventsKeys=Object.keys(this.validEvents),this.loadEnvAssetFile=!0,this.pxlTimer=new Zs.Timer,this.pxlShaders=Js,this.pxlCookie=new Zs.CookieManager(d,"/"),this.pxlCookie.hasCookie("forceMobile")&&(this.mobile=pxlCookie.parseCookie("forceMobile")),this.pxlQuality=new Zs.QualityController(this.verbose,this.mobile,this.uriHashParms),this.pxlUtils=new Zs.Utils(this.folderDict.assetRoot,this.mobile),this.pxlFile=new Zs.FileIO(this.folderDict),this.pxlExtensions=new Zs.Extensions,this.pxlAudio=new Zs.Audio(this.pxlTimer),this.pxlAutoCam=new Zs.AutoCamera(this.autoCam,this.mobile),this.pxlAutoCam.active=!1,this.pxlUser=new Zs.User,this.pxlEnv=new Zs.Environment(this.options,this.startingRoom,this.mobile),this.pxlDevice=new Zs.Device(d,er,this.mobile,this.autoCam),this.pxlCamera=new Zs.Camera,this.options.staticCamera&&this.pxlCamera.toggleMovement(!1),this.pxlAnim=new Zs.Animation(this.folderDict.assetRoot,this.pxlTimer),this.pxlGuiDraws=new Zs.GUI(this.verbose,d,this.folderDict.assetRoot,this.folderDict.guiRoot),this.pxlQuality.setDependencies(this),this.pxlUtils.setDependencies(this),this.pxlFile.setDependencies(this),this.pxlAudio.setDependencies(this),this.pxlAutoCam.setDependencies(this),this.pxlEnv.setDependencies(this),this.pxlAnim.setDependencies(this),this.pxlDevice.setDependencies(this),this.pxlCamera.setDependencies(this),this.pxlGuiDraws.setDependencies(this),this.pxlGuiDraws.prepLoader(),this.options.hasOwnProperty("loaderPhrases")||(this.options.loaderPhrases=["...loading the pixels..."]),this.pxlGuiDraws.setLoaderPhrases(this.options.loaderPhrases),this.pxlQuality.init()}set active(u){void 0===u&&(u=null),null==u&&(u=!this.pxlTimer.active),1==u?(this.pxlTimer.play(),this.step(!1)):this.pxlTimer.stop()}get active(){return this.pxlTimer.active}start(){this.active=!0}stop(){this.active=!1}init(){this.pxlTimer.init(),this.pxlEnv.boot(),this.pxlQuality.startBenchmark(),this.buildGui().then((()=>{this.tickLoader(),this.bootEnvironment()})).then((()=>{this.tickLoader(),this.bootEngine()})).then((()=>{this.tickLoader(),this.pxlEnv.buildComposers(),this.cameraRunAnimatorMobile(this),this.pxlGuiDraws.stepLoader("postBoot"),this.pxlEnv.mapRender(),this.pxlDevice.setCursor("grab")})).catch((u=>{this.verbose>Fs.VERBOSE_LEVEL.NONE&&(console.error("Error in pxlNavCore.init(); Load level - ",u),console.error(u))})).finally((()=>{this.verbose>Fs.VERBOSE_LEVEL.ERROR&&(console.log("'pxlNavCore' Room Build Promise-Chain Completed; ",this.loadPercent),console.log("-- Starting pxlNav in Room `"+this.pxlEnv.bootRoom+"`")),this.start()}))}buildGui(){return new Promise(((u,d)=>{this.pxlGuiDraws.booted(),this.pxlGuiDraws.pxlNavCanvas=document.getElementById(er),Ks=window.innerWidth*this.pxlQuality.screenResPerc,this.pxlGuiDraws.pxlNavCanvas.width=window.innerWidth,Ys=window.innerHeight*this.pxlQuality.screenResPerc,this.pxlGuiDraws.pxlNavCanvas.height=window.innerHeight,this.pxlDevice.canCursorLock&&(this.pxlGuiDraws.pxlNavCanvas.requestPointerLock=this.pxlGuiDraws.pxlNavCanvas.requestPointerLock||this.pxlGuiDraws.pxlNavCanvas.mozRequestPointerLock||this.pxlGuiDraws.pxlNavCanvas.webkitRequestPointerLock,document.requestPointerLock=this.pxlGuiDraws.pxlNavCanvas.exitPointerLock||this.pxlGuiDraws.pxlNavCanvas.mozExitPointerLock||this.pxlGuiDraws.pxlNavCanvas.webkitExitPointerLock),this.pxlGuiDraws.mapPrepPrompts(),u(!0)}))}isMobile(){var u=!1;return u=/\b(BlackBerry|webOS|iPhone|IEMobile|Android|Windows Phone|iPad|iPod)\b/i.test(navigator.userAgent),u=this.getHashParm("m",u)}findHashParms(){var u={},d=window.location.hash;if(d.length>1)for(var v=(d=d.substring(1)).split("&"),x=0;x<v.length;x++){var y=v[x].split("=");u[y[0]]=y[1]}return u}getHashParm(u,d){return Object.keys(this.uriHashParms).includes(u)?this.uriHashParms[u]:d}tickLoader(){this.loadPercent+=1}bootEngine(){return new Promise(((u,d)=>{for(var v=[],x=0;x<this.roomBootList.length;++x)v.push(this.pxlEnv.loadRoom(this.roomBootList[x]));Promise.all(v).then((()=>{u(!0)}))}))}bootEnvironment(){return new Promise(((u,d)=>{this.pxlEnv.engine=new j.WebGLRenderer({canvas:this.pxlGuiDraws.pxlNavCanvas,powerPreference:"low-power",alpha:!0,antialias:!1,sortObjects:!0,depth:!0});var v={format:j.RGBAFormat,antialias:!1,sortObjects:!0,alpha:!0,type:/(iPad|iPhone|iPod)/g.test(navigator.userAgent)?j.HalfFloatType:j.FloatType};this.pxlEnv.engine.autoClear=!0,j.ColorManagement.enabled=!1,this.pxlEnv.engine.outputColorSpace=j.SRGBColorSpace,this.pxlEnv.engine.debug.checkShaderErrors=!1,this.pxlEnv.engine.debug.checkShaderErrors=!0;this.pxlEnv.engine.setClearColor(this.pxlEnv.fogColor,0),this.pxlEnv.engine.setSize(Ks/this.pxlQuality.screenResPerc,Ys/this.pxlQuality.screenResPerc),this.pxlEnv.engine.setPixelRatio(1),this.options.shadowMapBiasing==Fs.SHADOW_MAP.OFF?this.pxlEnv.engine.shadowMap.enabled=!1:(this.pxlEnv.engine.shadowMap.enabled=!0,this.pxlEnv.engine.shadowMap.type=j.BasicShadowMap),this.pxlEnv.scene=new j.Scene,this.pxlEnv.scene.fog=this.pxlEnv.fog,this.pxlEnv.scene.background=new j.Color("#000000"),this.pxlEnv.scene.renderTarget=new j.WebGLRenderTarget(tr*this.pxlQuality.screenResPerc,ir*this.pxlQuality.screenResPerc,v),this.pxlEnv.scene.renderTarget.texture.format=j.RGBAFormat,this.pxlEnv.scene.renderTarget.texture.minFilter=j.LinearFilter,this.pxlEnv.scene.renderTarget.texture.magFilter=j.LinearFilter,this.pxlEnv.scene.renderTarget.texture.generateMipmaps=!1,this.pxlEnv.scene.renderTarget.depthBuffer=!0,this.pxlEnv.scene.renderTarget.depthTexture=new j.DepthTexture,this.pxlEnv.scene.renderTarget.depthTexture.format=j.DepthFormat,this.pxlEnv.scene.renderTarget.depthTexture.type=j.UnsignedIntType,this.pxlEnv.scene.renderWorldPos=new j.WebGLRenderTarget(tr*this.pxlQuality.screenResPerc,ir*this.pxlQuality.screenResPerc,v),this.pxlEnv.scene.renderWorldPos.texture.format=j.RGBAFormat,this.pxlEnv.scene.renderWorldPos.texture.minFilter=j.NearestFilter,this.pxlEnv.scene.renderWorldPos.texture.magFilter=j.NearestFilter,this.pxlEnv.scene.renderWorldPos.texture.generateMipmaps=!1,v.alpha=!0,this.pxlEnv.scene.renderGlowTarget=new j.WebGLRenderTarget(parseInt(tr*this.pxlQuality.screenResPerc),parseInt(ir*this.pxlQuality.screenResPerc),v),this.pxlEnv.scene.renderGlowTarget.texture.format=j.RGBAFormat,this.pxlEnv.scene.renderGlowTarget.texture.generateMipmaps=!1;var x;this.pxlGuiDraws.pxlNavCanvas.width,this.pxlGuiDraws.pxlNavCanvas.height;if(this.pxlCamera.camera=new j.PerspectiveCamera(this.pxlEnv.pxlCamFOV,1,this.pxlEnv.camNear,this.pxlEnv.camFar),this.pxlAutoCam.camera=this.pxlCamera.camera,this.pxlCamera.cameraAimTarget=new j.Object3D,this.pxlEnv.scene.add(this.pxlCamera.cameraAimTarget),this.pxlCamera.camera.target=this.pxlCamera.cameraAimTarget,this.pxlCamera.camera.layers.enable(1),this.pxlCamera.camera.layers.enable(2),this.pxlEnv.scene.add(this.pxlEnv.userAvatarGroup),this.options.loadList.includes("Cloud3d")&&(this.pxlEnv.cloud3dTexture=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"Noise_Cloud3d.jpg",null,{encoding:j.LinearSRGBColorSpace}),this.pxlEnv.cloud3dTexture.wrapS=j.RepeatWrapping,this.pxlEnv.cloud3dTexture.wrapT=j.RepeatWrapping),this.options.loadList.includes("SoftNoise")&&(this.pxlEnv.softNoiseTexture=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"Noise_Soft3d.jpg"),this.pxlEnv.softNoiseTexture.wrapS=j.RepeatWrapping,this.pxlEnv.softNoiseTexture.wrapT=j.RepeatWrapping),this.options.loadList.includes("SmoothNoise")&&(this.pxlEnv.detailNoiseTexture=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"Noise_UniformSmooth.jpg"),this.pxlEnv.detailNoiseTexture.wrapS=j.RepeatWrapping,this.pxlEnv.detailNoiseTexture.wrapT=j.RepeatWrapping),this.options.loadList.includes("ChromaticAberration")){var y=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"uv_ChromaticAberration.png");y.minFilter=j.LinearFilter,y.magFilter=j.LinearFilter,this.pxlEnv.chroAberUVTexture=y}this.options.loadList.includes("WarpAnimTexture")&&(this.pxlEnv.blockAnimTexture=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"uv_blockPortalWarp.jpg"),this.pxlEnv.blockAnimTexture.minFilter=j.LinearFilter,this.pxlEnv.blockAnimTexture.magFilter=j.LinearFilter),this.options.loadList.includes("MathFuncs")&&(this.pxlEnv.mathFuncsTexture=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"MathFuncs.jpg"),this.pxlEnv.mathFuncsTexture.minFilter=j.LinearFilter,this.pxlEnv.mathFuncsTexture.magFilter=j.LinearFilter);x=function tListIdent(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d={t:[0,0,0],r:[0,0,0],s:[1,1,1]};return null!=u&&(d[u[0]]=u[1]),d}();if(this.mobile&&"_mobile",this.loadEnvAssetFile){var b=this.folderDict.assetRoot+"EnvironmentAssets.fbx";this.pxlFile.loadSceneFBX(b,undefined,x,this.verbose,"EnvironmentAssets",[this.pxlEnv.scene])}this.options.shadowMapBiasing==Fs.SHADOW_MAP.OFF?this.pxlEnv.engine.shadowMap.enabled=!1:(this.pxlEnv.engine.shadowMap.enabled=!0,this.options.shadowMapBiasing==Fs.SHADOW_MAP.BASIC||this.mobile?this.pxlEnv.engine.shadowMap.type=j.BasicShadowMap:this.options.shadowMapBiasing==Fs.SHADOW_MAP.SOFT&&(this.pxlEnv.engine.shadowMap.type=j.PCFSoftShadowMap));var _=new j.AmbientLight(16777215,.05);this.pxlEnv.lightList.push(_),this.pxlEnv.scene.add(_);var w=new j.DirectionalLight(16777215,.1);w.position.set(1e3,550,1200),this.pxlEnv.lightList.push(w),this.pxlEnv.scene.add(w),u(!0)}))}cameraRunAnimatorMobile(u){for(var d=!1,v=Object.keys(u.pxlEnv.geoLoadList),x=0;x<v.length;++x){var y;if(d=(d=0==u.pxlEnv.geoLoadList[v[x]])&&!(null!==(y=u.pxlEnv.roomSceneList[x])&&void 0!==y&&y.booted))break}d?setTimeout((()=>{u.cameraRunAnimatorMobile(u)}),300):u.initRoomList(u)}initRoomList(u){u.pxlGuiDraws.stepLoader("camAnim"),u.pxlCamera.setTransform(u.pxlEnv.camInitPos,u.pxlEnv.camInitLookAt),u.pxlCamera.updateCamera(),u.pxlEnv.buildRoomEnvironments(),u.monitorRoomLoad(u)}monitorRoomLoad(u){for(var d=!1,v=Object.keys(u.pxlEnv.geoLoadList),x=0;x<v.length;++x){var y;if(d=(d=0==u.pxlEnv.geoLoadList[v[x]])&&!(null!==(y=u.pxlEnv.roomSceneList[x])&&void 0!==y&&y.booted))break}d?setTimeout((()=>{u.monitorRoomLoad(u)}),300):(u.pxlQuality.mapAutoQualityUpdate(1,!0),u.runPrepDrawScenes(0,!0,[]))}runPrepDrawScenes(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(u++,v.length>0){if(d){d=!1;var x=v[v.length-1];this.pxlCamera.warpToRoom(x)}if(this.pxlCamera.colliderPrevObjHit=null,this.pxlEnv.mapRender(!1),u%10==0){var y=v.pop();d=!0,this.pxlGuiDraws.stepLoader(y)}requestAnimationFrame((()=>{this.runPrepDrawScenes(u,d,v)}))}else this.pxlGuiDraws.stepLoader("Post Room Prep"),this.pxlNavPrepSettings()}pxlNavPrepSettings(){this.pxlCamera.warpToRoom(this.pxlEnv.bootRoom,!0),this.pxlQuality.endBenchmark(),this.pxlGuiDraws.stepLoader("Nav Settings"),this.startPxlNav()}startPxlNav(){this.pxlTimer.init(),this.pxlTimer.play(),this.pxlGuiDraws.applyCookies(),this.pxlGuiDraws.pxlNavCanvas&&this.pxlGuiDraws.pxlNavCanvas.focus();var u=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom];u.active=!0,u.startTime=this.pxlTimer.msRunner.x,this.pxlEnv.roomPostGuiCalls.forEach((u=>{u.postGuiEvent()})),this.pxlEnv.roomPostGuiCalls=[],this.pxlAutoCam.enabled&&this.pxlGuiDraws.guiToggleVisibility(!1),this.pxlAutoCam.init(),this.pxlDevice.resizeRenderResolution(),this.pxlEnv.mapRender(),this.pxlQuality.setDependentSettings(),this.pxlGuiDraws.stepLoader("Starting...");var d=this;setTimeout((()=>{d.pxlEnv.postBoot(),d.pxlGuiDraws.mapPrompt&&d.pxlGuiDraws.promptFader(d.pxlGuiDraws.mapPrompt,!1,null,!0),d.pxlGuiDraws.mapPromptBG&&d.pxlGuiDraws.promptFader(d.pxlGuiDraws.mapPromptBG,!1,null,!1),d.emit("booted",!0)}),200)}step(){var u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.pxlTimer.active&&(this.pxlTimer.step(),u&&requestAnimationFrame((()=>{this.step()})))}bootTimer(){this.pxlTimer.init(),this.pxlTimer.play()}stopTimer(){this.pxlTimer.stop()}pauseTimer(){this.pxlTimer.pause()}prepPromptFader(u){var d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],v=u;("string"!=typeof v||(v=document.getElementById(v)))&&(v.classList.add("fader"),v.classList.add(d?"visOn":"visOff"),v.style.display=d?"inline-block":"none")}promptFader(u,d){var v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if("string"!=typeof u||(u=document.getElementById(u)))if(u.classList.value.indexOf("fader")<0&&u.classList.add("fader"),d)u.style.display="inline-block",setTimeout((()=>{u.classList.contains("visOff")&&(u.classList.remove("visOff"),u.classList.add("visOn"),null!=v&&(u.setAttribute("fadeOut",clockTime+1e3*v),fadeOutList.push(u)))}),50);else if(u.classList.remove("visOn"),u.classList.add("visOff"),x){["webkitTransitionEnd","otransitionend","oTransitionEnd","msTransitionEnd","transitionend"].forEach((d=>{u.addEventListener(d,(()=>{var d=u.parentNode;d&&d.removeChild(u)}))}))}else setTimeout((()=>{u.classList.contains("visOff")&&(u.style.display="none")}),1e3)}addRooms(u){for(var d=0;d<u.length;++d)this.pxlEnv.roomNameList.includes(u[d])||this.booted||this.roomBootList.push(u[d])}setBootRoom(u,d){console.log(u,d),this.pxlEnv.bootRoom=u,this.pxlEnv.bootLocation=d}setLoaderPhrases(u){this.pxlGuiDraws.setLoaderPhrases(u)}initExtension(u,d,v){this.pxlExtensions.init(u,d,v)}startExtension(u,d,v){this.pxlExtensions.start(u,d,v)}stopExtension(u,d,v){this.pxlExtensions.stop(u,d,v)}extensionStatus(u){return this.pxlExtensions.status(u)}trigger(u){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;switch(u=u.toLowerCase()){case"warptoroom":this.pxlCamera.warpToRoom(d,!0,v);break;case"camera":var x=d.toLowerCase();"roam"==x?this.pxlCamera.toggleMovement(!0):"static"==x&&this.pxlCamera.toggleMovement(!1);break;case"ping":this.emit("pingPong","pong");break;case"roommessage":var y=v.type,b=v.value;null==d&&(d=this.pxlEnv.currentRoom),this.pxlEnv.sendRoomMessage(d,y,b)}}subscribe(u,d){if(this.validEventsKeys.includes(u))if("test"==u)console.log("Test Event : `pxlNav.subscribe( 'test', ... )` was used; subscription list -");else if("pxlNavEventNameHere"==u||"help"==u)"pxlNavEventNameHere"==u?console.warn("Warning : `pxlNav.subscribe( 'pxlNavEventNameHere', ... )` was used; need some help?"):"help"==u&&console.log("Help Requested : `pxlNav.subscribe( 'help', ... )` was used; Subscription items--"),console.log("Valid Event Types : "),this.validEventsKeys.forEach((u=>{console.log("  - ",u," : ",this.validEvents[u])}));else{var v=u.split("-");"device"==v[0]?this.pxlDevice.subscribe(v[1],d):this.callbacks[u]=d}else console.warn("Warning : `pxlNav.subscribe( '"+u+"', ... )` was used; use 'help' for a list of valid events.")}emit(u,d){var v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this.callbacks[u]){var x={type:u,value:d};null!==v&&(x.status=v),this.callbacks[u](x)}}}var sr=T.l$,rr=T.eT,ar=T.vi,nr=T.Bn,or=T.IF,lr=T.uU,hr=T.Z$,ur=T.pL;export{sr as RoomEnvironment,rr as pxlBase,ar as pxlEffects,nr as pxlEnums,or as pxlNav,lr as pxlNavVersion,hr as pxlOptions,ur as pxlShaders};