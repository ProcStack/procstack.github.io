import*as e from"./libs/three/three.module.min.js";import*as t from"./libs/three/FBXLoader.js";import*as i from"./libs/three/EffectComposer.js";import*as s from"./libs/three/RenderPass.js";import*as a from"./libs/three/ShaderPass.js";import*as r from"./libs/three/CopyShader.js";import*as n from"./libs/three/UnrealBloomPass.js";var o,l,h={124:(e,t,i)=>{i.r(t),i.d(t,{ExtensionBase:()=>ExtensionBase});class ExtensionBase{constructor(){this.active=!1,this.verbose=!1,this.callbacks={}}init(){}start(){this.active=!0}pause(){this.stop()}stop(){this.active=!1}subscribe(e,t){this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t)}unsubscribe(e,t){this.callbacks[e]&&(this.callbacks[e]=this.callbacks[e].filter((e=>e!==t)))}emit(e,t){this.callbacks[e]&&this.callbacks[e].forEach((e=>e(t)))}destroy(){this.disable()}}},312:(e,t,i)=>{function asyncGeneratorStep(e,t,i,s,a,r,n){try{var o=e[r](n),l=o.value}catch(e){return void i(e)}o.done?t(l):Promise.resolve(l).then(s,a)}i.r(t),i.d(t,{Extensions:()=>Extensions});var s=["PoseEngine"];class Extensions{constructor(){this.plugins={},this.verbose=!1}init(e,t,i){var s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];!this.plugins[e]||s?this.load(e,((e,s)=>{e?i?i(e):this.verbose&&console.error(e):t&&t(s)})):(this.verbose&&console.log("Extension ".concat(e," already booted, skipping...")),t&&t(this.plugins[e]))}load(e,t){var a=this;return function _asyncToGenerator(e){return function(){var t=this,i=arguments;return new Promise((function(s,a){var r=e.apply(t,i);function _next(e){asyncGeneratorStep(r,s,a,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(r,s,a,_next,_throw,"throw",e)}_next(void 0)}))}}((function*(){if(s.includes(e))try{var r=new((yield i(50)("./".concat(e,".js"))).default);try{a.boot(e,r)}catch(t){console.error("Error (2) Booting extension '".concat(e,"':"),t)}t&&t(null,r)}catch(i){console.error("Error (1) Importing / Parsing extension '".concat(e,"':"),i),t&&t(err,null)}else{var n=new Error("Extension ".concat(e," not found"));console.error(n),t&&t(n,null)}}))()}start(e){var t=this.get(e);t&&t.start()}pause(e){var t=this.get(e);t&&t.pause()}stop(e){var t=this.get(e);t&&t.stop()}status(e){var t=this.get(e);return!!t&&t.active}boot(e,t){this.plugins[e]=t,t.init()}get(e){return this.plugins[e]?this.plugins[e]:(console.warn("Extension ".concat(e," not found")),null)}unload(e){var t=this.get(e);t&&(t.destroy(),delete this.plugins[e])}}},944:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Networking});var s=i(124);class Networking extends s.ExtensionBase{constructor(e){this.status=!1,this.accessToken="",this.jwtToken="",this.socket=io("https://www.www.com",{transports:["websocket"]})}init(){socket.on("event",(e=>{console.log(e)})),socket.on("connect",onConnect),socket.on("disconnect",onDisconnect),socket.on("authenticated",onAuthenticated),socket.on("unauthorized",console.error)}onConnect(){console.log("Successfully connected to the websocket"),socket.emit("authenticate",{method:"jwt",token:this.jwtToken})}onDisconnect(){console.log("Disconnected from websocket"),this.status=!1,onConnect()}onAuthenticated(e){var{channelId:t}=e;console.log("Successfully connected to channel ".concat(t)),this.status=!0}}},153:(e,t,i)=>{i.r(t),i.d(t,{PoseEngine:()=>PoseEngine});var s=i(124);function asyncGeneratorStep(e,t,i,s,a,r,n){try{var o=e[r](n),l=o.value}catch(e){return void i(e)}o.done?t(l):Promise.resolve(l).then(s,a)}class PoseEngine extends s.ExtensionBase{constructor(e){if(this.active=!1,this.verbose=!1,"MediaPipe"!==e)throw new Error("Unknown pose estimation '"+e+"' model");this.model=new MediaPipePose}estimatePose(e){var t=this;return function _asyncToGenerator(e){return function(){var t=this,i=arguments;return new Promise((function(s,a){var r=e.apply(t,i);function _next(e){asyncGeneratorStep(r,s,a,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(r,s,a,_next,_throw,"throw",e)}_next(void 0)}))}}((function*(){return yield t.model.estimate(e)}))()}}},26:(e,t,i)=>{function asyncGeneratorStep(e,t,i,s,a,r,n){try{var o=e[r](n),l=o.value}catch(e){return void i(e)}o.done?t(l):Promise.resolve(l).then(s,a)}function _asyncToGenerator(e){return function(){var t=this,i=arguments;return new Promise((function(s,a){var r=e.apply(t,i);function _next(e){asyncGeneratorStep(r,s,a,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(r,s,a,_next,_throw,"throw",e)}_next(void 0)}))}}i.r(t),i.d(t,{MediaPipePlugin:()=>MediaPipePlugin});class MediaPipePlugin{constructor(){this.workerScriptUrl="./PoseEngine_worker.js",this.worker=null,this.booted=!1}static loadScriptWithProgress(e,t){return _asyncToGenerator((function*(){return new Promise(((i,s)=>{var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="text",a.onprogress=e=>{if(e.lengthComputable&&"function"==typeof t){var i=Math.round(e.loaded/e.total*100);t(i)}},a.onload=()=>{if(200===a.status){var t=document.createElement("script");t.textContent=a.responseText,document.head.appendChild(t),i()}else s(new Error("Failed to load script: ".concat(e)))},a.onerror=()=>s(new Error("Network error while loading: ".concat(e))),a.send()}))}))()}init(e){var t=this;return _asyncToGenerator((function*(){try{console.log("Loading MediaPipe..."),yield MediaPipePlugin.loadScriptWithProgress("https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js",e),t.worker=new Worker(t.workerScriptUrl),t.booted=!0,console.log("MediaPipe Plugin Initialized")}catch(e){console.error("Error initializing MediaPipePlugin:",e)}}))()}sendMessage(e){this.booted?this.worker.postMessage(e):console.warn("MediaPipePlugin is not initialized.")}onMessage(e){this.worker?this.worker.onmessage=t=>e(t.data):console.warn("WebWorker not initialized.")}terminateWorker(){this.worker&&(this.worker.terminate(),this.worker=null,console.log("WebWorker terminated."))}}},852:()=>{function asyncGeneratorStep(e,t,i,s,a,r,n){try{var o=e[r](n),l=o.value}catch(e){return void i(e)}o.done?t(l):Promise.resolve(l).then(s,a)}self.onmessage=function(){var e=function _asyncToGenerator(e){return function(){var t=this,i=arguments;return new Promise((function(s,a){var r=e.apply(t,i);function _next(e){asyncGeneratorStep(r,s,a,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(r,s,a,_next,_throw,"throw",e)}_next(void 0)}))}}((function*(e){var{type:t,data:i}=e.data;if("processFrame"===t){var s=yield poseModel.estimate(imageData);self.postMessage({type:"result",pose:s})}else console.warn("Unknown message type:",t)}));return function(t){return e.apply(this,arguments)}}()},703:(e,t,i)=>{i.r(t),i.d(t,{WebCamera:()=>WebCamera});var s=i(124);class WebCamera extends s.ExtensionBase{constructor(){this.video=document.createElement("video"),this.stream=null,this.isInitialized=!1,this.active=!1}init(e){navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then((t=>{this.stream=t,this.video.srcObject=this.stream,this.video.play(),this.isInitialized=!0,console.log("WebCamera Initialized"),e&&e(null)})).catch((t=>{console.error("Error initializing WebCamera:",t),e&&e(t)}))}start(e){this.isInitialized?(this.active=!0,console.log("WebCamera Started"),e&&e(null)):(console.error("WebCamera is not initialized"),e&&e(new Error("WebCamera is not initialized")))}pause(e){this.stop(e)}stop(e){this.stream?(this.stream.getTracks().forEach((e=>e.stop())),this.video.srcObject=null,this.isInitialized=!1,console.log("WebCamera Stopped"),this.active=!1,e&&e(null)):e&&e(new Error("WebCamera is not initialized"))}}},50:(e,t,i)=>{var s={"./ExtensionBase.js":[124,9,226],"./Extensions.js":[312,9],"./Networking.js":[944,9,226],"./PoseEngine.js":[153,9,226],"./PoseEngine/MediaPipe.js":[26,9,226],"./PoseEngine/PoseEngine_worker.js":[852,7,226],"./WebCam.js":[703,9,226]};function webpackAsyncContext(e){if(!i.o(s,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=s[e],a=t[0];return Promise.all(t.slice(2).map(i.e)).then((()=>i.t(a,16|t[1])))}webpackAsyncContext.keys=()=>Object.keys(s),webpackAsyncContext.id=50,e.exports=webpackAsyncContext},541:e=>{function webpackEmptyAsyncContext(e){return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}webpackEmptyAsyncContext.keys=()=>[],webpackEmptyAsyncContext.resolve=webpackEmptyAsyncContext,webpackEmptyAsyncContext.id=541,e.exports=webpackEmptyAsyncContext}},d={};function __webpack_require__(e){var t=d[e];if(void 0!==t)return t.exports;var i=d[e]={exports:{}};return h[e](i,i.exports,__webpack_require__),i.exports}l=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,__webpack_require__.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var i=Object.create(null);__webpack_require__.r(i);var s={};o=o||[null,l({}),l([]),l(l)];for(var a=2&t&&e;"object"==typeof a&&!~o.indexOf(a);a=l(a))Object.getOwnPropertyNames(a).forEach((t=>s[t]=()=>e[t]));return s.default=()=>e,__webpack_require__.d(i,s),i},__webpack_require__.d=(e,t)=>{for(var i in t)__webpack_require__.o(t,i)&&!__webpack_require__.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},__webpack_require__.e=()=>Promise.resolve(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var c={};__webpack_require__.d(c,{l$:()=>RoomEnvironment,eT:()=>_,vi:()=>I,Bn:()=>pxlEnums,IF:()=>pxlNav,uU:()=>pxlNavVersion,Z$:()=>pxlOptions,pL:()=>O,tk:()=>D});var u={};__webpack_require__.r(u),__webpack_require__.d(u,{camPosVert:()=>camPosVert,defaultShiftVert:()=>defaultShiftVert,defaultVert:()=>defaultVert,discardFrag:()=>discardFrag,shaderHeader:()=>ShaderHeader_shaderHeader});var p={};__webpack_require__.r(p),__webpack_require__.d(p,{animTextureFrag:()=>animTextureFrag,animTextureVert:()=>animTextureVert,clickableBevelFrag:()=>clickableBevelFrag,clickableBevelVert:()=>clickableBevelVert,portalBaseFrag:()=>portalBaseFrag,portalBaseVert:()=>portalBaseVert});var m={};__webpack_require__.r(m),__webpack_require__.d(m,{itemBaseFrag:()=>itemBaseFrag,itemBaseVert:()=>itemBaseVert,itemFrag:()=>itemFrag,itemVert:()=>itemVert,itemZoomFrag:()=>itemZoomFrag,pxlPrincipledFrag:()=>pxlPrincipledFrag,pxlPrincipledVert:()=>pxlPrincipledVert});var v={};__webpack_require__.r(v),__webpack_require__.d(v,{dustFrag:()=>dustFrag,dustVert:()=>dustVert,emberWispsFrag:()=>emberWispsFrag,emberWispsVert:()=>emberWispsVert,smokeFrag:()=>smokeFrag,smokeVert:()=>smokeVert,snowFallFrag:()=>snowFallFrag,snowFallVert:()=>snowFallVert});var g={};__webpack_require__.r(g),__webpack_require__.d(g,{boxAntiAliasPass:()=>boxAntiAliasPass,chroAberPostProcess:()=>chroAberPostProcess,compLayersPostProcess:()=>compLayersPostProcess,crossAntiAliasPass:()=>crossAntiAliasPass,directionalBlurPass:()=>directionalBlurPass,finalOverlayHeavyShader:()=>finalOverlayHeavyShader,finalOverlayShader:()=>finalOverlayShader,finalOverlaySlimShader:()=>finalOverlaySlimShader,glowPassPostProcess:()=>glowPassPostProcess,iZoomPostProcess:()=>iZoomPostProcess,lKingPostProcess:()=>lKingPostProcess,mixBlurShaderPass:()=>mixBlurShaderPass,motionBlurPostProcess:()=>motionBlurPostProcess,sFieldPostProcessFrag:()=>sFieldPostProcessFrag,sFieldPostProcessVert:()=>sFieldPostProcessVert,textureStorePass:()=>textureStorePass,warpPostProcess:()=>warpPostProcess,worldPositionFrag:()=>worldPositionFrag,worldPositionVert:()=>worldPositionVert});var f={};__webpack_require__.r(f),__webpack_require__.d(f,{bgScreenFrag:()=>bgScreenFrag,bgScreenVert:()=>bgScreenVert,skyObjectFrag:()=>skyObjectFrag,skyObjectVert:()=>skyObjectVert});const x=(e=>{var t={};return __webpack_require__.d(t,e),t})({AdditiveBlending:()=>e.AdditiveBlending,AlphaFormat:()=>e.AlphaFormat,AmbientLight:()=>e.AmbientLight,AnimationMixer:()=>e.AnimationMixer,BackSide:()=>e.BackSide,BasicShadowMap:()=>e.BasicShadowMap,Box3:()=>e.Box3,BufferAttribute:()=>e.BufferAttribute,BufferGeometry:()=>e.BufferGeometry,CanvasTexture:()=>e.CanvasTexture,Clock:()=>e.Clock,Color:()=>e.Color,ColorManagement:()=>e.ColorManagement,DepthFormat:()=>e.DepthFormat,DepthTexture:()=>e.DepthTexture,DirectionalLight:()=>e.DirectionalLight,DoubleSide:()=>e.DoubleSide,DynamicDrawUsage:()=>e.DynamicDrawUsage,Euler:()=>e.Euler,Float32BufferAttribute:()=>e.Float32BufferAttribute,FloatType:()=>e.FloatType,FogExp2:()=>e.FogExp2,FrontSide:()=>e.FrontSide,Group:()=>e.Group,HalfFloatType:()=>e.HalfFloatType,ImageLoader:()=>e.ImageLoader,InstancedMesh:()=>e.InstancedMesh,LOD:()=>e.LOD,LinearFilter:()=>e.LinearFilter,LinearSRGBColorSpace:()=>e.LinearSRGBColorSpace,LuminanceFormat:()=>e.LuminanceFormat,Matrix4:()=>e.Matrix4,Mesh:()=>e.Mesh,MeshBasicMaterial:()=>e.MeshBasicMaterial,MeshStandardMaterial:()=>e.MeshStandardMaterial,NearestFilter:()=>e.NearestFilter,NearestMipmapNearestFilter:()=>e.NearestMipmapNearestFilter,Object3D:()=>e.Object3D,PCFSoftShadowMap:()=>e.PCFSoftShadowMap,PerspectiveCamera:()=>e.PerspectiveCamera,Points:()=>e.Points,Quaternion:()=>e.Quaternion,RGBAFormat:()=>e.RGBAFormat,RGBFormat:()=>e.RGBFormat,RGFormat:()=>e.RGFormat,RedFormat:()=>e.RedFormat,RepeatWrapping:()=>e.RepeatWrapping,SRGBColorSpace:()=>e.SRGBColorSpace,Scene:()=>e.Scene,ShaderChunk:()=>e.ShaderChunk,ShaderMaterial:()=>e.ShaderMaterial,Texture:()=>e.Texture,UniformsLib:()=>e.UniformsLib,UniformsUtils:()=>e.UniformsUtils,UnsignedIntType:()=>e.UnsignedIntType,UnsignedShortType:()=>e.UnsignedShortType,Vector2:()=>e.Vector2,Vector3:()=>e.Vector3,Vector4:()=>e.Vector4,VideoTexture:()=>e.VideoTexture,WebGLRenderTarget:()=>e.WebGLRenderTarget,WebGLRenderer:()=>e.WebGLRenderer});const y=(e=>{var t={};return __webpack_require__.d(t,e),t})({FBXLoader:()=>t.FBXLoader});var b={NONE:0,ERROR:1,WARN:2,INFO:3,DEBUG:4},C={OFF:0,LOW:1,MEDIUM:2,HIGH:3},P={SKY:0,SCENE:1,PARTICLES:5,GLOW:6,GLOW_MASK:7},S={OFF:0,VAPOR:1},w={FLOOR:0,WALL:1,WALL_TOP:2,CEILING:3,PORTAL_WARP:4,ROOM_WARP:5,ITEM:6,SCRIPTED:7,HOVERABLE:8,CLICKABLE:9},E={FRONT:0,BACK:1,DOUBLE:2},pxlEnums={VERBOSE_LEVEL:b,ANTI_ALIASING:C,RENDER_LAYER:P,SKY_HAZE:S,SHADOW_MAP:{OFF:0,BASIC:1,SOFT:2},CAMERA_EVENT:{MOVE:0,ROTATE:1,JUMP:2,FALL:3,LANDED:4,COLLISION:5},COLLIDER_TYPE:w,GEOMETRY_SIDE:E,COLOR_SHIFT:{KEEP:0,sRGB_TO_LINEAR:1,LINEAR_TO_sRGB:2,WINDOWS_TO_UNIX:3,UNIX_TO_WINDOWS:4,LINEAR_TO_WINDOWS:5,WINDOWS_TO_LINEAR:6,LINEAR_TO_UNIX:7,UNIX_TO_LINEAR:8},USER_SPEED:{STOP:0,SLOW:1,BASE:2,BOOST:3}};class FileIO{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.pxlTimer=null,this.pxlUtils=null,this.pxlQuality=null,this.pxlEnums=null,this.pxlVideo=null,this.pxlCamera=null,this.pxlAutoCam=null,this.pxlUser=null,this.pxlEnv=null,this.pxlAnim=null,this.pxlDevice=null,this.pxlShaders=null,this.pxlColliders=null,this.verbose=!1,this.pxlOptions={},this.runDebugger=!1,this.assetRoot=this.findInDict(e,"assetRoot","images/assets/"),this.guiRoot=this.findInDict(e,"guiRoot","images/GUI/"),this.roomRoot=this.findInDict(e,"roomRoot","images/rooms/"),this.vidRoot=this.findInDict(e,"vidRoot","images/screenContent/"),this.workerList=[],this.oneTwoPFour=1/2.4,this.twelvePNineTwoDiv=1/12.92,this.onePOFiveFiveDiv=1/1.055}setDependencies(pxlNav){this.pxlTimer=pxlNav.pxlTimer,this.pxlUtils=pxlNav.pxlUtils,this.pxlQuality=pxlNav.pxlQuality,this.pxlEnums=pxlNav.pxlEnums,this.pxlVideo=pxlNav.pxlVideo,this.pxlCamera=pxlNav.pxlCamera,this.pxlAutoCam=pxlNav.pxlAutoCam,this.pxlUser=pxlNav.pxlUser,this.pxlEnv=pxlNav.pxlEnv,this.pxlAnim=pxlNav.pxlAnim,this.pxlDevice=pxlNav.pxlDevice,this.pxlShaders=pxlNav.pxlShaders,this.pxlColliders=pxlNav.pxlColliders,this.pxlOptions=pxlNav.pxlOptions,this.verbose=this.pxlOptions.verbose}log(){if(this.runDebugger||this.verbose>=this.pxlEnums.VERBOSE_LEVEL.DEBUG){console.log("---");for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach((e=>{console.log(e)}))}}toggleDebugger(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e||(e=!this.runDebugger),this.runDebugger=e}findInDict(e,t,i){return e.hasOwnProperty(t)?e[t]:(e[t]=i,i)}convertVertColor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.pxlEnums.COLOR_SHIFT.KEEP;if(e.geometry&&e.geometry.attributes&&e.geometry.attributes.color){for(var i=e.geometry.attributes.color,s=0;s<i.count;++s){var a=(new x.Color).fromBufferAttribute(i,s);this.pxlUtils.convertColor(a,t),i.setXYZ(s,a.r,a.g,a.b)}i.needsUpdate=!0}}checkForUserData(e,t,i){if(i.hasOwnProperty("userData")){if(i.hasOwnProperty("material")&&(i.userData.hasOwnProperty("doubleSided")&&i.userData.doubleSided?i.material.side=x.DoubleSide:i.material.side=x.FrontSide),i.userData.hasOwnProperty("GlowPass")&&i.userData.GlowPass&&(e.geoList.GlowPass||(e.geoList.GlowPass=[]),i.layers.set(this.pxlEnums.RENDER_LAYER.GLOW),e.geoList.GlowPass.push(i)),i.userData.hasOwnProperty("GlowPassMask")&&i.userData.GlowPass&&(e.geoList.GlowPassMask||(e.geoList.GlowPassMask=[]),i.layers.set(this.pxlEnums.RENDER_LAYER.GLOW_MASK),e.geoList.GlowPassMask.push(i)),i.userData.hasOwnProperty("castShadow")&&i.userData.castShadow&&(i.castShadow=!0),i.userData.hasOwnProperty("receiveShadow")&&i.userData.receiveShadow&&(i.receiveShadow=!0),i.userData.hasOwnProperty("Shader")&&""!=i.userData.Shader){i.userData.Shader.trim();e.shaderGeoList||(e.shaderGeoList={}),e.shaderGeoList[i.name]=i}if(i.userData.hasOwnProperty("Emitter")&&""!=i.userData.Emitter&&(e.emitterList||(e.emitterList={}),e.emitterList[i.userData.Emitter]||(e.emitterList[i.userData.Emitter]={},e.emitterList[i.userData.Emitter].Emitter=[],e.emitterList[i.userData.Emitter].Particles=[]),e.emitterList[i.userData.Emitter].Emitter.push(i)),i.userData.hasOwnProperty("Hover")&&i.userData.Hover&&(e.hasHoverables=!0,e.hoverableList.push(i)),i.userData.hasOwnProperty("Click")&&i.userData.Click&&(e.hasClickables=!0,e.clickableList.push(i)),this.checkObjectInstancing(e,t,i),i.userData.hasOwnProperty("Scripted"))e.geoList.hasOwnProperty("Scripted")||(e.geoList.Scripted={}),e.geoList.Scripted[i.name]=i,i.children.forEach((s=>{if(s.name.includes("Geo")){var a=i.position,r=i.rotation,n=i.scale;s.position.set(a.x,a.y,a.z),s.rotation.set(r.x,r.y,r.z),s.scale.set(n.x,n.y,n.z),s.updateMatrix(),s.children.forEach((i=>{this.checkForUserData(e,t,i),"Group"==i.type&&(i.position.set(a.x+i.position.x,a.y+i.position.y,a.z+i.position.z),i.rotation.set(r.x,r.y,r.z),i.scale.set(n.x,n.y,n.z)),i.updateMatrix()}))}else if(s.name.includes("Colliders")){var o=i.position,l=i.rotation,h=i.scale;s.position.set(o.x,o.y,o.z),s.rotation.set(l.x,l.y,l.z),s.scale.set(h.x,h.y,h.z),s.updateMatrix(),s.visible=!1}}))}}checkForMeshSettings(e,t){t.hasOwnProperty("meshSettings")&&t.meshSettings.hasOwnProperty("renderOrder")&&(e.renderOrder=t.meshSettings.renderOrder)}canAppendChildren(e,t){if("Group"!=t.type)return!1;var i=!0;return e.geoList.hasOwnProperty("Scripted")&&e.geoList.Scripted.hasOwnProperty(t.name)&&(i=!1),i}canAddToScene(e,t){var i=!0;return t.hasOwnProperty("userData")&&t.userData.hasOwnProperty("Instance")&&e.hasOwnProperty("baseInstancesNames")&&e.baseInstancesNames.hasOwnProperty(t.userData.Instance)&&(i=!1),i}checkIsGlassLiquid(e,t,i,s){var a=!1;if(i.userData.hasOwnProperty("isGlass")&&i.userData.isGlass&&(a=!0),i.userData.hasOwnProperty("isLiquid")&&i.userData.isLiquid&&(a=!0),!a)return!1;if(this.log("Glass Detected - ",i.name),!e.glassGroup){var r=new x.Group;e.glassGroup=r,t.add(r)}var n=i.material.clone();i.material=n,i.material.transparent=!0,i.material.opacity=.5,i.material.shininess=20,i.material.specular=i.material.color.clone(),i.material.specular.r=.5*i.material.specular.r+.1,i.material.specular.g=.5*i.material.specular.g+.1,i.material.specular.b=.5*i.material.specular.b+.1,i.material.side=x.BackSide,i.material.depthWrite=!1,i.matrixAutoUpdate=!1,i.renderOrder=1+e.glassList.length,e.glassList.push(i),e.glassGroup.add(i);var o=i.geometry.clone(),l=i.material.clone();l.copy(i.material);var h=new x.Mesh(o,l);h.name=i.name+"_Front",h.material.shininess=40,h.material.side=x.FrontSide,h.matrixAutoUpdate=!1,h.renderOrder=1+e.glassList.length;var d=i.position,c=i.rotation,u=i.scale;return h.rotation.set(c.x,c.y,c.z),h.position.set(d.x,d.y,d.z),h.scale.set(u.x,u.y,u.z),h.updateMatrix(),i.parent.add(h),e.glassList.push(h),e.glassGroup.add(h),a}checkObjectInstancing(e,t,i){if(!e.hasOwnProperty("baseInstancesNames")||!e.hasOwnProperty("baseInstancesList"))return!1;if(i.hasOwnProperty("userData")&&i.userData.hasOwnProperty("Instance")&&e.baseInstancesList.hasOwnProperty(i.userData.Instance)){var s=i.name;this.log("Generate Instance - ",s),e.geoList.hasOwnProperty("InstanceObjects")||(e.geoList.InstanceObjects={});var a=new RegExp(/(instlod)\d+/,"i"),r=new RegExp(/\d+/,"i"),n=new RegExp(/(instlod)\d+(dist)/,"i"),o=new RegExp(/(instlod)\d+(skip)/,"i"),l={lod0:{mesh:i,dist:1}},h={mesh:i,instMesh:null,dist:1,skip:0},d=!1,c={};try{Object.keys(i.userData).forEach((e=>{if(a.test(e)){var t=r.exec(e);if(!t||t.length<1)return;t=parseInt(t[0]);var s={};if(c.hasOwnProperty(t)||(c[t]=Object.assign({},h)),s=c[t],n.test(e)){var l=i.userData[e];s.dist=l}else if(o.test(e)){var d=i.userData[e];s.skip=d}else s.instMesh=i.userData[e]}}))}catch(e){this.verbose>=this.pxlEnums.VERBOSE_LEVEL.ERROR&&console.error(e)}for(var u=i.children,p=0;p<u.length;++p)if(u[p].hasOwnProperty("userData"))for(var m=u[p].userData,v=0;v<m.length;++v){var g=m[v],f=a.test(g),y=Object.assign({},h);if(f){var b=r.exec(g);c.hasOwnProperty(b)&&(y=c[b])}if(n.test(g)){var C=m[g];y.dist=C}else if(o.test(g)){var P=m[g];y.skip=P}else y.instMesh=m[g]}var S=Object.keys(l);try{d;for(var w=0;w<S.length;++w){var E=l[S[w]].mesh,D=E.position,M=E.rotation,L=E.scale,T=e.baseInstancesList[E.userData.Instance];if("Mesh"==E.type){var A=new x.Matrix4,k=new x.Vector3,R=new x.Vector3,_=new x.Quaternion,O=new x.Vector3(1,1,1),I=E.geometry.attributes.hasOwnProperty("color"),B=Object.keys(E.userData),G=B.map((e=>e.toLowerCase())),j=!1,U=0,V=1;G.includes("minscale")&&(j=!0,U=E.userData[B[G.indexOf("minscale")]]),G.includes("maxscale")&&(j=!0,V=E.userData[B[G.indexOf("maxscale")]]);for(var F={},H=[],N=0;N<E.geometry.attributes.position.count;++N){k.fromBufferAttribute(E.geometry.attributes.position,N);var W=k.toArray();if(W=this.pxlUtils.flattenArrayToStr(W),!F.hasOwnProperty(W)){R.fromBufferAttribute(E.geometry.attributes.normal,N);var z=new x.Euler(0,2*Math.random()*Math.PI,0);if(_.setFromEuler(z),L=O,I){var K=E.geometry.attributes.color.getX(N);j&&(K=U+(V-U)*K),L=new x.Vector3(K,K,K)}A.compose(k,_,L),H.push(A.clone()),F[W]=!0}}if(H.length>0){var Q=new x.InstancedMesh(T.geometry,T.material,H.length);Q.instanceMatrix.setUsage(x.DynamicDrawUsage),Q.userData=Object.assign({},E.userData),Q.userData.pxlInstanceToMesh=!0,this.checkForMeshSettings(Q,T.material);for(var Y=0;Y<H.length;++Y)Q.setMatrixAt(Y,H[Y]);Q.visible=!0,Q.updateMatrix(),Q.name=s+"Geo",e.geoList.InstanceObjects[s]=Q,E.parent.add(Q),E.visible=!1,E.parent.remove(E)}}else{var X=new x.InstancedMesh(T.geometry,T.material,1);X.instanceMatrix.setUsage(x.DynamicDrawUsage),X.userData=Object.assign({},E.userData),X.userData.pxlInstanceToMesh=!1,this.checkForMeshSettings(X,T.material);var q=!1;if(E.userData.hasOwnProperty("fixInstMatrix")&&(q=!!E.userData.fixInstMatrix),q)X.rotation.set(M.x,M.y,M.z),X.position.set(D.x,D.y,D.z),X.scale.set(L.x,L.y,L.z);else{var J=new x.Matrix4;J.compose(D,(new x.Quaternion).setFromEuler(M),L),X.setMatrixAt(0,J)}X.visible=!0,X.updateMatrix(),X.name=s+"Geo",e.geoList.InstanceObjects[s]=X,E.parent.add(X),E.visible=!1,E.parent.remove(E)}}}catch(e){this.verbose>=this.pxlEnums.VERBOSE_LEVEL.ERROR&&console.error(e)}this.verbose,this.pxlEnums.VERBOSE_LEVEL.DEBUG}}loadSceneFBX(e,t,i,s,a,r){var n=this;""!=a&&(this.pxlEnv.geoLoadListComplete=0,this.pxlEnv.geoLoadList[a]=0);var o=new y.FBXLoader;return o.load(e,(e=>{var t=e.children,i={},s=[];t.forEach(((e,t)=>{var a=e.name.toLowerCase();s.push(a),i[a]=t})),s.forEach((e=>{e.includes("camera")&&(t[i[e]].children.forEach(((e,t)=>{if(e.matrixAutoUpdate=!1,e.name.includes("position")){var i=e.position.clone();this.pxlCamera.cameraPrevPos=i.clone(),this.pxlCamera.camera.position.copy(i),this.pxlCamera.cameraPos.copy(i),this.pxlCamera.camera.updateMatrixWorld(),this.pxlCamera.cameraBooted=!0,this.pxlEnv.camInitPos=i,this.pxlEnv.camThumbPos=this.pxlEnv.camThumbPos.clone().add(i.clone())}else if(e.name.includes("lookat")){var s=e.position.clone();this.pxlCamera.cameraAimTarget.position.copy(s),this.pxlCamera.camera.lookAt(s),this.pxlCamera.camera.updateMatrixWorld(),this.pxlCamera.cameraPrevLookAt=new x.Vector3,this.pxlEnv.camInitLookAt=s,this.pxlEnv.camThumbLookAt=this.pxlEnv.camThumbLookAt.clone().add(s.clone())}else if(e.name.includes("returnposition")){var a=e.position.clone();this.pxlEnv.camReturnPos=a}else if(e.name.includes("returnlookat")){var r=e.position.clone();this.pxlEnv.camReturnLookAt=r}})),this.pxlDevice.touchMouseData.initialQuat=this.pxlCamera.camera.quaternion.clone());if(e.includes("Items"))for(var s=t[i[e]].children,a=null,o=null,l=null,h=null,d=function _loop(){var e=s.pop();"Group"==e.type&&(e.children.forEach((t=>{t.name.includes("Item")?(e.name.includes("LowGravity")?(null==o&&(o=new x.ShaderMaterial({uniforms:{color:{value:t.material.emissive.clone()},alphaMap:{type:"t",value:t.material.map},cloudNoise:{type:"t",value:n.pxlEnv.cloud3dTexture},time:{value:n.pxlTimer.msRunner},intensity:{type:"f",value:1.5},rate:{type:"f",value:n.pxlUser.itemRotateRate}},vertexShader:n.pxlShaders.objects.itemVert(),fragmentShader:n.pxlShaders.objects.itemFrag(),transparent:!0,side:x.DoubleSide,depthTest:!0,depthWrite:!1})),t.material=o):e.name.includes("LizardKing")?(null==l&&((l=t.material.clone()).emissiveMap=l.map,l.emissive=new x.Color(8421504)),t.material=l):e.name.includes("StarField")||e.name.includes("InfinityZoom")&&(null==h&&(h=new x.ShaderMaterial({uniforms:{color:{value:t.material.map},cloudNoise:{type:"t",value:n.pxlEnv.cloud3dTexture},time:{value:n.pxlTimer.msRunner},intensity:{type:"f",value:1},rate:{type:"f",value:n.pxlUser.itemRotateRate}},vertexShader:n.pxlShaders.core.defaultVert(),fragmentShader:n.pxlShaders.objects.itemZoomFrag(),transparent:!0,side:x.DoubleSide,depthTest:!0,depthWrite:!0})),t.material=h),n.pxlUser.itemList[e.name]=t):t.name.includes("ItemBase")&&(null==a&&(a=new x.ShaderMaterial({uniforms:{color:{value:t.material.emissive.clone()},alphaMap:{type:"t",value:t.material.map},cloudNoise:{type:"t",value:n.pxlEnv.cloud3dTexture},time:{value:n.pxlTimer.msRunner},intensity:{type:"f",value:1.5},rate:{type:"f",value:n.pxlUser.itemBaseRotateRate}},vertexShader:n.pxlShaders.objects.itemBaseVert(),fragmentShader:n.pxlShaders.objects.itemBaseFrag(),transparent:!0,side:x.DoubleSide,depthTest:!0,depthWrite:!1})),t.material=a,n.pxlUser.itemBaseList.push(t))})),r[0].add(e),n.pxlUser.itemGroupList[e.name]=e,n.pxlUser.itemListNames.push(e.name))};s.length>0;)d()})),""!=a&&(this.pxlEnv.geoList[a]=e,this.pxlEnv.geoLoadList[a]=1),this.pxlEnv.geoLoadList[a]=1}),void 0,(e=>{""!=a&&(this.pxlEnv.geoLoadList[a]=1)})),o}loadRoomFBX(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.runDebugger=!!a,null==s&&(s=e.getName()),i||(i=e.sceneFile);var r=e.sceneFile,n=e.materialList;this.pxlEnv.geoLoadListComplete=0,this.pxlEnv.geoLoadList[s]=0;var o=e.scene,l=new y.FBXLoader;return l.load(r,(i=>{var a=i.children;if(1==a.length){var r=a[0];r.name.toLowerCase().includes("scene")||(a=r.children,console.warn("-- pxlFile.loadRoomFBX() - Top level Environment Group not found --\n Attempting to use the first child group as FBX Scene\n Make sure your top group holds all sub-groups."))}var l={},h=[];a.forEach(((e,t)=>{var i=e.name.split("_")[0].toLowerCase();h.push(i),l[i]=t}));if(h.indexOf("camera")>-1){var d=[];this.log("Camera - ",a[l.camera]);a[l.camera].children.forEach(((e,t)=>{var i=e.name.toLowerCase();i.includes("position")||i.includes("lookat")||i.includes("returnposition")||i.includes("returnlookat")?(d.push(e),!0):e.children.length>0&&d.push(...e.children)})),d.forEach(((t,i)=>{t.matrixAutoUpdate=!1;var s=t.parent.name.toLowerCase();s==a[l.camera].name.toLowerCase()&&(s="default"),e.camLocation.hasOwnProperty(s)||(e.camLocation[s]={},e.camLocation[s].position=new x.Vector3(0,0,-10),e.camLocation[s].lookat=new x.Vector3(0,0,0));var r=t.name.toLowerCase();if(r.includes("positionmobile")){var n=t.position.clone();e.cameraBooted=!0,e.camInitPos=n,e.camLocation[s].positionmobile=n}else if(r.includes("lookatmobile")){var o=t.position.clone();e.camInitLookAt=o,e.camLocation[s].lookatmobile=o}else if(r.includes("position")){var h=t.position.clone();e.cameraBooted=!0,e.camInitPos=h,e.camLocation[s].position=h}else if(r.includes("lookat")){var d=t.position.clone();e.camInitLookAt=d,e.camLocation[s].lookat=d}else if(r.includes("returnposition")){var c=t.position.clone();e.camReturnPos=c,e.camLocation[s].returnposition=c}else if(r.includes("returnlookat")){var u=t.position.clone();e.camReturnLookAt=u,e.camLocation[s].returnlookat=u}})),Object.keys(e.camLocation).forEach((t=>{var i=e.camLocation[t];i.hasOwnProperty("positionmobile")||(i.positionmobile=i.position),i.hasOwnProperty("lookatmobile")||(i.lookatmobile=i.lookat)}))}if(h.indexOf("AutoCamPaths")>-1){var c=a[l.AutoCamPaths].children;this.log("AutoCamPaths - ",a[l.AutoCamPaths]),this.pxlAutoCam.autoCamPaths[e.getName()]=[];for(var u=function _loop2(){var i=c.pop();if("Group"==i.type){var s={};i.children.forEach((e=>{e.matrixAutoUpdate=!1,s[e.name]=e})),i.visible=!1,i.matrixAutoUpdate=!1,o.add(i),t.pxlAutoCam.autoCamPaths[e.getName()].push(s)}};c.length>0;)u()}if(h.indexOf("instances")>-1&&0==this.pxlQuality.detailLimit){var p=[...a[l.instances].children];if(this.log("Instances - ",a[l.instances]),p.length>0){e.hasOwnProperty("baseInstancesNames")||(e.baseInstancesNames=[]),e.hasOwnProperty("baseInstancesList")||(e.baseInstancesList={});p.forEach(((t,i)=>{if(this.checkForUserData(e,o,t),n.hasOwnProperty(t.name)){var s=null;t.material.map&&(s=t.material.map),t.material=n[t.name],this.checkForMeshSettings(t,t.material),s&&(t.material.uniforms.hasOwnProperty("diffuse")&&(t.material.uniforms.diffuse.value=s),t.material.hasOwnProperty("emissiveMap")&&(t.material.emissiveMap=s,t.material.emissive.r>0&&(t.material.emissiveIntensity=t.material.emissive.r))),t.matrixAutoUpdate=!1}else if(t.material.map&&!t.material.emissiveMap&&t.material.color.r>0){var a=t.material.map;t.material.emissiveMap=a,t.material.emissiveIntensity=.4*t.material.color.r,t.material.emissive=t.material.color.clone()}e.baseInstancesNames.push(t),e.baseInstancesList[t.name]=t}))}}if(h.indexOf("lights")>-1){var m=a[l.lights].children;for(this.log("Lights - ",a[l.lights]);m.length>0;){var v=m.pop();if(m.push(...v.children),v.type.includes("Light")){if(e.hasOwnProperty("lightList")||(e.lightList={}),e.geoList.hasOwnProperty("lights")||(e.geoList.lights=[]),"PointLight"==v.type){v.name.split("_")[0];v.decay=Math.max(1.1,Math.min(3,v.intensity)),v.distance=0==v.distance?1e3*v.intensity:v.distance}e.lightList.hasOwnProperty(v.type)||(e.lightList[v.type]=[]),e.lightList[v.type].push(v),e.geoList.lights.push(v),v.matrixAutoUpdate=!1,o.add(v)}}}if(h.includes("scene")||h.includes("mainscene")){var g=l.scene||l.mainscene,f=[...a[g].children];this.log("MainScene - ",a[g]);for(var y=function _loop3(){var i=f.pop();if(t.log("Cur Object - ",i.name),t.checkForUserData(e,o,i),i.isMesh){!i.userData.hasOwnProperty("Show")||i.userData.Show&&0!=i.userData.Show||(i.visible=!1),i.layers.set(t.pxlEnums.RENDER_LAYER.SCENE),e.geoList[i.name]=i;var s=x.FrontSide;if(i.userData.doubleSided&&(s=x.DoubleSide),n.hasOwnProperty(i.name)){var a=null;i.material.map&&(a=i.material.map),i.material=n[i.name],t.checkForMeshSettings(i,i.material),a&&(i.material.uniforms.hasOwnProperty("diffuse")&&(i.material.uniforms.diffuse.value=a),i.material.hasOwnProperty("emissiveMap")&&(i.material.emissiveMap=a,i.material.emissive.r>0&&(i.material.emissiveIntensity=i.material.emissive.r))),i.matrixAutoUpdate=!1}else{var r=i.material;Array.isArray(i.material)||(r=[i.material]),t.checkIsGlassLiquid(e,o,i,r)||r.forEach((e=>{e.map&&!e.emissiveMap&&e.emissive.r>0&&(e.emissiveMap=e.map,e.emissiveIntensity=e.emissive.r,e.emissive=new x.Color(16777215)),e.side=s})),i.matrixAutoUpdate=!1}}else if(i.type.includes("Light"))e.lightList.hasOwnProperty(i.type)||(e.lightList[i.type]=[]),e.lightList[i.type].push(i);else if("Group"==i.type){if(e.geoList.hasOwnProperty("Scripted"))Object.keys(e.geoList.Scripted);f.push(...i.children)}};f.length>0;)y();o.add(...a[g].children)}if(h.indexOf("glass")>-1){var b=a[l.glass].children;if(this.log("Glass - ",a[l.glass]),b.length>0){if(!e.glassGroup){var C=new x.Group;e.glassGroup=C,o.add(C)}for(;b.length>0;){var P=b.pop();if(b.push(...P.children),P.isMesh){this.checkForUserData(e,o,P);var S=P.material.clone();P.material=S,P.material.transparent=!0,P.material.opacity=.5,P.material.shininess=20,P.material.specular=P.material.color.clone(),P.material.specular.r=.5*P.material.specular.r+.1,P.material.specular.g=.5*P.material.specular.g+.1,P.material.specular.b=.5*P.material.specular.b+.1,P.material.side=x.BackSide,P.material.depthWrite=!1,P.matrixAutoUpdate=!1,P.renderOrder=1,e.glassList.push(P),e.glassGroup.add(P);var w=P.geometry.clone(),E=P.material.clone();E.copy(P.material);var D=new x.Mesh(w,E);D.material.shininess=40,D.material.side=x.FrontSide,D.matrixAutoUpdate=!1,D.renderOrder=2;var M=P.position,L=P.rotation,T=P.scale;D.rotation.set(L.x,L.y,L.z),D.position.set(M.x,M.y,M.z),D.scale.set(T.x,T.y,T.z),D.updateMatrix(),o.add(D),e.glassList.push(D),e.glassGroup.add(D)}}}}if(h.indexOf("colliders")>-1){var A=a[l.colliders];this.log("Colliders - ",a[l.colliders]);var k=A.children;e.collidersExist=k.length>0;for(var R=0;R<k.length;++R)for(var _=k[R].name.toLowerCase(),O=k[R].children;O.length>0;){var I=O.pop();O.push(...I.children),I.isMesh&&(I.visible=!1,"colliderwalls"==_?(e.antiColliderActive=!0,e.antiColliderList.push(I)):"collidertops"==_?(e.antiColliderTopActive=!0,e.antiColliderTopList.push(I)):("roomwarpzone"==_&&(e.hasRoomWarp=!0,e.roomWarp.push(I)),e.colliderActive=!0,e.colliderList.push(I)),I.matrixAutoUpdate=!1,o.add(I),e.geoList[I.name]=I)}e.hasColliderType(this.pxlEnums.COLLIDER_TYPE.FLOOR)?this.pxlColliders.prepColliders(e,this.pxlEnums.COLLIDER_TYPE.FLOOR):e.hasColliderType(this.pxlEnums.COLLIDER_TYPE.WALL)?this.pxlColliders.prepColliders(e,this.pxlEnums.COLLIDER_TYPE.WALL):e.hasColliderType(this.pxlEnums.COLLIDER_TYPE.WALL_TOP)?this.pxlColliders.prepColliders(e,this.pxlEnums.COLLIDER_TYPE.WALL_TOP):e.hasColliderType(this.pxlEnums.COLLIDER_TYPE.ROOM)&&this.pxlColliders.prepColliders(e,this.pxlEnums.COLLIDER_TYPE.ROOM)}if(h.indexOf("portalexit")>-1){var B=a[l.portalexit].children;for(this.log("PortalExit - ",a[l.portalexit]);B.length>0;){var G=B.pop();G.matrixAutoUpdate=!1,e.hasPortalExit=!0,e.portalList[G.name]=G}}if(h.indexOf("flatcolor")>-1){var j=a[l.flatcolor].children;for(this.log("FlatColor - ",a[l.flatcolor]);j.length>0;){var U=j.pop();if(j.push(...U.children),U.isMesh){this.checkForUserData(e,o,U);var V=new MeshBasicMaterial({color:U.material.color.clone()});V.side=x.FrontSide,V.flatShading=!0,U.material=V,U.layers.set(this.pxlEnums.RENDER_LAYER.SCENE),U.matrixAutoUpdate=!1,o.add(U)}}}if(h.indexOf("lambertcolor")>-1){var F=a[l.lambertcolor].children;for(this.log("LambertColor - ",a[l.lambertcolor]);F.length>0;){var H=F.pop();if(F.push(...H.children),H.isMesh){this.checkForUserData(e,o,H);var N=new MeshLambertMaterial;if(H.material.map){var W=H.material.map.clone();N.map=W,N.emissiveMap=W,N.emissiveIntensity=.5,H.material=N}else N.color=H.material.color.clone(),N.emissive=H.material.emissive.clone(),N.side=x.FrontSide,N.flatShading=!0,H.material=N;H.layers.set(this.pxlEnums.RENDER_LAYER.SCENE),H.matrixAutoUpdate=!1,o.add(H)}}}if(h.indexOf("sky")>-1){var z=a[l.sky].children;for(this.log("Sky - ",a[l.sky]);z.length>0;){var K=z.pop();if(z.push(...K.children),K.isMesh){var Q,Y,X,q=null;n.hasOwnProperty(K.name)?(q=n[K.name],this.checkForMeshSettings(K,q)):q=new x.ShaderMaterial({uniforms:{diffuse:{type:"t",value:K.material.map},noiseTexture:{type:"t",value:null},fogColor:{value:o.fog.color},time:{value:this.pxlTimer.msRunner},camNear:{type:"f",value:e.camera.near},camFar:{type:"f",value:.85*e.camera.far},resUV:{value:this.pxlDevice.screenRes}},vertexShader:this.pxlShaders.scene.skyObjectVert(),fragmentShader:this.pxlShaders.scene.skyObjectFrag(this.pxlOptions.skyHaze)}),K.material=q,K.matrixAutoUpdate=!1,K.frustumCulled=!1,K.layers.set(this.pxlEnums.RENDER_LAYER.SKY),K.material.depthTest=!0,K.material.depthWrite=!1,null!==(Q=K.material)&&void 0!==Q&&Q.uniforms.hasOwnProperty("noiseTexture")&&null!=e&&e.cloud3dTexture&&(K.material.uniforms.noiseTexture.value=e.cloud3dTexture),null!==(Y=K.material)&&void 0!==Y&&Y.uniforms.hasOwnProperty("depthTexture")&&null!=o&&null!==(X=o.renderTarget)&&void 0!==X&&X.depthTexture&&(K.material.uniforms.envDiffuse.value=o.renderTarget.depthTexture),e.geoList[K.name]=K,e.materialList[K.name]=q,o.add(K)}}}if(h.indexOf("animatedtextures")>-1){var J=a[l.animatedtextures].children;for(this.log("AnimatedTextures - ",a[l.animatedtextures]);J.length>0;){var Z=J.pop();if(J.push(...Z.children),Z.isMesh){this.checkForUserData(e,o,Z);var $={time:{value:this.pxlTimer.msRunner},glowTexture:{type:"t",value:Z.material.map},cloudNoise:{type:"t",value:this.pxlEnv.cloud3dTexture},glowColor:{value:new x.Vector3(.01,.35,.55)},intensity:{type:"f",value:.35},rate:{type:"f",value:2},freq:{type:"f",value:1}},ee=this.pxlShaders.animated.animTextureVert(),te=this.pxlShaders.animated.animTextureFrag(),ie=new x.ShaderMaterial({uniforms:$,vertexShader:ee,fragmentShader:te,transparent:!0,side:x.FrontSide});Z.material=ie,Z.matrixAutoUpdate=!1,o.add(Z)}}}if(h.indexOf("scrollingtextures")>-1){var se=a[l.scrollingtextures].children;this.log("ScrollingTextures - ",a[l.scrollingtextures]);for(var ae=1;se.length>0;){ae+=1;var re=se.pop();if(se.push(...re.children),re.isMesh){this.checkForUserData(e,o,re);var ne=re.name,oe=.05;ne.indexOf("_")>-1&&(oe=ne.split("_")[1],oe=.01*parseInt(oe));var le=new x.ShaderMaterial({uniforms:{scrollTexture:{type:"t",value:re.material.map},time:{value:this.pxlTimer.msRunner},speed:{value:oe},seed:{type:"f",value:1.1423*ae},boostPerc:{value:1}},vertexShader:this.pxlShaders.animated.scrollingTextureVert(),fragmentShader:this.pxlShaders.animated.scrollingTextureFrag(),transparent:!0,side:x.FrontSide});re.material=le,re.matrixAutoUpdate=!1,o.add(re)}}}if(h.indexOf("userscreens")>-1){var he=a[l.userscreens].children;this.log("UserScreens - ",a[l.userscreens]);for(var de=0,ce=[new x.Vector3(1,0,0),new x.Vector3(0,1,0),new x.Vector3(0,0,1)],ue=[this.assetRoot+"DJ_Vector_Masks_1.jpg",this.assetRoot+"DJ_Vector_Masks_2.jpg",this.assetRoot+"DJ_Vector_Masks_3.jpg"],pe=0,me=0,ve=ce.length;he.length>0;){var ge=he.pop();if(he.push(...ge.children),ge.isMesh){var fe=new x.ShaderMaterial({uniforms:{camExists:{type:"f",value:0},time:{value:this.pxlTimer.msRunner},seed:{type:"f",value:1.1423*de},alpha:{type:"f",value:1},boostPerc:{value:e.userScreenIntensity},scale:{value:new x.Vector2(100,100)},ratio:{value:new x.Vector2(1,1)},videoFeed:{type:"t",value:null},cloudNoise:{type:"t",value:this.pxlEnv.cloud3dTexture},maskChannel:{value:ce[pe]},maskMap:{type:"t",value:this.pxlUtils.loadTexture(ue[me])}},vertexShader:e.userScreenVert,fragmentShader:e.userScreenFrag,transparent:!0,side:x.FrontSide});ge.material=fe,ge.matrixAutoUpdate=!1,e.pxlEnv.camScreenData.screenGeoList.push(ge),o.add(ge),pe=(de+=1)%ve,me=Math.floor(de/3)%ve}}}if(h.indexOf("items")>-1){var xe=a[l.items].children;this.log("Items - ",a[l.items]);for(var ye=function _loop4(){var e=xe.pop();if("Group"==e.type){var i=e.children;i.length>0&&(i.forEach((i=>{if(i.name.includes("Item")){var s=new x.ShaderMaterial({uniforms:{color:{value:i.material.emissive.clone()},alphaMap:{type:"t",value:i.material.map},cloudNoise:{type:"t",value:t.cloud3dTexture},time:{value:t.pxlTimer.msRunner},intensity:{type:"f",value:1.5},rate:{type:"f",value:t.pxlUser.itemRotateRate}},vertexShader:t.pxlShaders.objects.itemVert(),fragmentShader:t.pxlShaders.objects.itemFrag(),transparent:!0,side:x.DoubleSide,depthTest:!0,depthWrite:!1});i.material=s,t.pxlUser.itemList[e.name]=i}else if(i.name.toLowerCase().includes("base")){var a=new x.ShaderMaterial({uniforms:{color:{value:i.material.emissive.clone()},alphaMap:{type:"t",value:i.material.map},cloudNoise:{type:"t",value:t.cloud3dTexture},time:{value:t.pxlTimer.msRunner},intensity:{type:"f",value:1.5},rate:{type:"f",value:t.pxlUser.itemBaseRotateRate}},vertexShader:t.pxlShaders.objects.itemBaseVert(),fragmentShader:t.pxlShaders.objects.itemBaseFrag(),transparent:!0,side:x.DoubleSide,depthTest:!0,depthWrite:!1});i.material=a,t.pxlUser.itemBaseList.push(i)}})),o.add(e),t.pxlUser.itemGroupList[e.name]=e,t.pxlUser.itemListNames.push(e.name))}};xe.length>0;)ye()}if(h.includes("scripted")){var be=a[l.scripted].children;for(this.log("Scripted - ",a[l.scripted]);be.length>0;){var Ce=be.pop();Ce.isMesh&&(e.geoList[Ce.name]=Ce,o.add(Ce))}}if(h.includes("clickable")){var Pe=a[l.clickable];this.log("Clickable - ",a[l.clickable]);for(var Se=Pe.children,we=0;we<Se.length;++we)for(var Ee=Se[we].name,De=Se[we].children;De.length>0;){var Me=De.pop();if(De.push(...Me.children),Me.isMesh)(new MeshBasicMaterial).color=new x.Color(16777215),Me.material.emissive=new x.Color(4473924),Me.material.emissiveMap=Me.material.map,Me.matrixAutoUpdate=!1,e.objectClickableObjectList[Me.name]||(e.objectClickableObjectList[Me.name]={}),e.objectClickableObjectList[Me.name][Ee]=Me,e.objectClickable.push(Me),o.add(Me),"Hover"==Ee&&(Me.visible=!1)}}if(h.includes("markers")){var Le=a[l.markers].children;for(this.log("Markers - ",a[l.markers]);Le.length>0;){var Te=Le.pop();e.marker[Te.name]=Te.position}}this.pxlEnv.geoList[s]=i,this.pxlEnv.geoLoadList[s]=1,e.fbxPostLoad(),this.runDebugger=!1}),null,(e=>{""!=s&&(this.pxlEnv.geoLoadList[s]=1),this.log("Error Loading FBX"),this.log(e),this.runDebugger=!1})),l}loadAnimFBX(e,t,i,s,a){""==t&&(t=e.getName()),this.pxlEnv.geoLoadListComplete=0,this.pxlEnv.geoLoadList[t]=0;var r=e.scene,n=new y.FBXLoader;return n.load(i,(i=>{var n=i.children,o={},l=[];n.forEach(((e,t)=>{var i=e.name.split("_")[0];l.push(i),o[i]=t})),i.traverse((t=>{this.checkForUserData(e,r,t),t.userData.hasOwnProperty("doubleSided")&&t.userData.doubleSided&&(t.material.side=x.DoubleSide)})),this.pxlAnim.initObject(t,i),this.log("Animation FBX - ",l[0]),r.add(i),i.frustumCulled=!1;var h=new y.FBXLoader,d=[];Object.keys(s).forEach((e=>{var i=s[e],a=new Promise(((s,a)=>{h.load(i,(a=>{0==a.animations.length&&(this.log("No animations found in file",i),this.log(a),s()),this.pxlAnim.addClips(t,e,a),this.log("Animation Loaded",e),s()}),null,(e=>{this.log("Animation Load Error"),this.log(e),a(e)}))}));d.push(a)})),Promise.all(d).then((()=>{this.pxlAnim.setStateConnections(t,a),e.geoList[t]=i,this.pxlEnv.geoLoadList[t]=1,e.animPostLoad(t)})).catch((e=>{this.log("Error loading animations",e)}))}),null,(e=>{""!=t&&(this.pxlEnv.geoLoadList[t]=1)})),n}pxlShaderBuilder(e,t,i){var s,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r={diffuse:{type:"t",value:null},time:{value:this.pxlTimer.msRunner}};null!=e&&(r=Object.assign({},r,e));var n={uniforms:r,vertexShader:t,fragmentShader:i};return a&&(n.defines=a),(s=new x.ShaderMaterial(n)).transparent=!0,s.depthTest=!0,s}removeChildren(e){for(var t=0,i=e.children,s=0;s<i.length;++s)"Group"==i[s].type&&(e.remove(i[s]),t++);return t}findMesh(e){for(var t=null,i=e.children,s=0;s<i.length;++s)if("Mesh"==i[s].type){t=i[s];break}return t}getBBoxCentroid(e){try{var t=(new x.Box3).setFromObject(e),i=t.min,s=t.max,a=(new x.Vector3).addVectors(s,i).multiplyScalar(.5);e.userData={bbox:t,centroid:a},null!=mapBookHelper&&mapBookHelper.update()}catch(e){this.verbose>=b.ERROR&&(console.log("- - - - - - - - ERROR - - - - - - - -"),console.log("     Object does not exist.\n           - Error Info -"),console.log(e),console.log("- - - - - - - - - - - - - - - - - - -"))}}loadScript(e){return new Promise(((t,i)=>{var s=document.createElement("script");s.type="text/javascript",s.src=e,s.async=!0,s.onreadystatechange=()=>{t(!0)},s.onload=()=>{t(!0)},document.head.appendChild(s)}))}xmlHttp(){return window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")}static getURLContent(e){return new Promise(((t,i)=>{var s=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");s.open("GET",e),s.onload=e=>{4==s.readyState&&s.status>=200&&s.status<300?t(s.response):t(s.statusText)},s.onerror=()=>i(s.statusText),s.send()}))}getExternalHTML(e,t){if(window.XMLHttpRequest){var i=this.xmlHttp();i.onreadystatechange=function(){4==this.readyState&&200==this.status&&t&&"function"==typeof t&&t(i.responseText)},i.open("GET",e,!0),i.responceType="document",i.send()}else window.open(e,"_blank")}fetchURLStatus(e,t,i){fetch(e,{method:"HEAD"}).then((e=>{t(e.status,i)})).catch((e=>{t(404,i)}))}urlExistsFallback(e){return new Promise(((t,i)=>{var s=this.xmlHttp();s.open("HEAD",e,!0),s.send(),s.onreadystatechange=function(){this.readyState==this.DONE&&t(this.status<400)},s.onerror=e=>{t(!1)},s.ontimeout=e=>{t(!1)}}))}urlExists(e){return new Promise(((t,i)=>{this.urlExistsFallback(e).then((e=>{t(e)}))})).then((e=>e)).catch((e=>!1))}}function asyncGeneratorStep(e,t,i,s,a,r,n){try{var o=e[r](n),l=o.value}catch(e){return void i(e)}o.done?t(l):Promise.resolve(l).then(s,a)}function _asyncToGenerator(e){return function(){var t=this,i=arguments;return new Promise((function(s,a){var r=e.apply(t,i);function _next(e){asyncGeneratorStep(r,s,a,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(r,s,a,_next,_throw,"throw",e)}_next(void 0)}))}}var D={height:{standing:1.75,stepSize:5},movement:{scalar:1,max:10,easing:.55},headBounce:{height:.3,rate:.025,easeIn:.03,easeOut:.95},jump:{impulse:.75,holdMax:2.85,repeatDelay:.08},gravity:{UPS:.3,Max:15.5}},pxlOptions={verbose:pxlEnums.VERBOSE_LEVEL.NONE,fps:{PC:60,Mobile:30},subTickCalculations:!1,pxlRoomRoot:"./pxlRooms",pxlAssetRoot:"./pxlAssets",showOnboarding:!0,staticCamera:!1,autoCamera:!1,allowStaticRotation:!1,userSettings:Object.assign({},D),antiAliasing:pxlEnums.ANTI_ALIASING.LOW,collisionScale:{gridSize:50,gridReference:1e3},shadowMapBiasing:pxlEnums.SHADOW_MAP.BASIC,LoadEnvAssetFile:!1,skyHaze:pxlEnums.SKY_HAZE.OFF,loaderPhrases:["...loading the pixels..."],postProcessPasses:{roomGlowPass:!1,mapComposerWarpPass:!1,chromaticAberrationPass:!1,lizardKingPass:!1,starFieldPass:!1,crystallinePass:!1}};const M=(e=>{var t={};return __webpack_require__.d(t,e),t})({EffectComposer:()=>i.EffectComposer});const L=(e=>{var t={};return __webpack_require__.d(t,e),t})({RenderPass:()=>s.RenderPass});const T=(e=>{var t={};return __webpack_require__.d(t,e),t})({ShaderPass:()=>a.ShaderPass});const A=(e=>{var t={};return __webpack_require__.d(t,e),t})({CopyShader:()=>r.CopyShader});const k=(e=>{var t={};return __webpack_require__.d(t,e),t})({UnrealBloomPass:()=>n.UnrealBloomPass});function Environment_asyncGeneratorStep(e,t,i,s,a,r,n){try{var o=e[r](n),l=o.value}catch(e){return void i(e)}o.done?t(l):Promise.resolve(l).then(s,a)}class SVGUtils{static svgPromise(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a={},r=document.getElementById(t);if(r){null!=i&&r.classList.add(i);var n=Promise.resolve(FileIO.getURLContent(e));return n.then((e=>{r.innerHTML=e,a.svg=r.getElementsByTagName("svg")[0],null!=s&&a.svg.classList.add(s)})),a.promise=n,a}}static svgRawPromise(e){var t={};return Promise.resolve(FileIO.getURLContent(e)).then((e=>{var i=document.createElement("div");i.innerHTML=e,t.svg=i.getElementsByTagName("svg")[0]})),t}static svgIconPromise(e,t,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=this,n={hover:null,mute:null,caret:null,indicator:null,waiting:[],state:null};n.eventType=i;var o=document.getElementById(t);if(o){a?o.classList.add(a):o.classList.add("iconStyle"),n.parent=o.parentNode,n.parent.classList.add("iconHover"),n.parent.addEventListener("click",(e=>{r.iconEvent("click",n,i)}));var l=Promise.resolve(FileIO.getURLContent(e));return l.then((e=>{if(o.innerHTML=e,n.svg=o.getElementsByTagName("svg")[0],n.svg){a?n.svg.classList.add(a):n.svg.classList.add("iconStyle");for(var i=n.svg.children,r=n.svg.getAttribute("xmlns"),l=n.svg.getAttribute("height"),h=n.svg.getAttribute("width"),d=0;d<i.length;++d){var c=i[d];if("speakerIcon"==t){var u=o.getAttribute("xmlns"),p=(parseInt(l),parseInt(h),document.createElementNS(u,"rect"));p.setAttribute("x",-1),p.setAttribute("y",-1),p.setAttribute("fill","white"),p.setAttribute("fill-opacity",0),p.setAttribute("height",l+2),p.setAttribute("width",h+2),p.setAttribute("z-index",-1),o.appendChild(p),n.hover=p,n.svg.setAttribute("fill-opacity",this.toggleOpacity[0])}var m=c.getAttribute("id");if("mute"==m){n.mute=c,n.mute.style.transformOrigin="50% 50%",n.mute.style.filter="alpha(opacity=0)",n.mute.style.opacity="0",n.mute.style.transform="scale(0,0)",n.mute.style.transition="scale 1s, opacity .5s, filter .5s";var v=document.createElement("style");v.type="text/css",v.innerHTML="\n                                @keyframes loadingSpinner{\n                                    0%{\n                                        transform: rotate(0deg);\n                                    }\n                                    100%{\n                                        transform: rotate(360deg);\n                                    }\n                                }\n                            ",n.svg.appendChild(v);var g=Math.max(2,.25*Math.min(l,h)),f=.5*h,x=.5*l,y=document.createElementNS(r,"path");y.setAttribute("d"," M ".concat(f," ").concat(x-g," A ").concat(g," ").concat(g," 0 1 1 ").concat(f-g," ").concat(x," ")),y.setAttribute("stroke","white"),y.setAttribute("stroke-width","2"),y.style.display="none",y.style.transformOrigin="50% 50%",y.style.animation="loadingSpinner 1s linear infinite",y.style.animationDuration="2s",y.style.animationPlayState="paused",n.indicator=y,n.svg.appendChild(y),this.toggleIcon(n,s)}else"caret"==m?(n.caret=c,n.caret.style.transformOrigin="50% 50%",n.caret.style.transition="transform .5s",this.flipIcon(n,!1)):"state"==m?(c.style.display="none",n.state=c):n.waiting.push(c)}var b=document.createElementNS(r,"rect");b.classList.add("iconHover"),b.setAttribute("x",0),b.setAttribute("y",0),b.setAttribute("height",l),b.setAttribute("width",h),n.svg.appendChild(b)}})),n.promise=l,n}}static svgButtonPromise(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if("string"!=typeof t||(t=document.getElementById(t))){var r=this;Promise.resolve(FileIO.getURLContent(e)).then((e=>{t.innerHTML=e;var n=t.getElementsByTagName("svg");if(n.length>0&&(n=n[0],i&&(i="string"==typeof i?[i]:i).forEach((e=>{n.classList.add(e)})),s)){var o=n.getAttribute("xmlns"),l=parseInt(n.getAttribute("height")),h=parseInt(n.getAttribute("width")),d=document.createElementNS(o,"rect");d.setAttribute("x",-1),d.setAttribute("y",-1),d.setAttribute("fill","white"),d.setAttribute("fill-opacity",0),d.setAttribute("height",l+2),d.setAttribute("width",h+2),d.setAttribute("z-index",-1),n.appendChild(d);var c=n.getElementById("state");c&&c.setAttribute("fill-opacity",this.toggleOpacity[0]),a&&(n.onclick=e=>{r.svgCheckClick(e,a)},r.pxlDevice.mobile?(n.ontouchstart=e=>{r.svgStylize(e,!0)},n.ontouchend=e=>{r.svgStylize(e,!1)}):(n.onmouseover=e=>{r.svgStylize(e,!0)},n.onmouseout=e=>{r.svgStylize(e,!1)}))}}))}}}function GUIBase_asyncGeneratorStep(e,t,i,s,a,r,n){try{var o=e[r](n),l=o.value}catch(e){return void i(e)}o.done?t(l):Promise.resolve(l).then(s,a)}function GUIBase_asyncToGenerator(e){return function(){var t=this,i=arguments;return new Promise((function(s,a){var r=e.apply(t,i);function _next(e){GUIBase_asyncGeneratorStep(r,s,a,_next,_throw,"next",e)}function _throw(e){GUIBase_asyncGeneratorStep(r,s,a,_next,_throw,"throw",e)}_next(void 0)}))}}class GUIManager{constructor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Metal-Asylum",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"./assets/",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"./assets/GUI/";this.projectTitle=t,this.verbose=e,this.sW=window.innerWidth,this.sH=window.innerHeight,this.mobile=!1,this.pxlFile=null,this.pxlCookie=null,this.pxlTimer=null,this.pxlAudio=null,this.pxlUtils=null,this.pxlUser=null,this.pxlDevice=null,this.pxlAutoCam=null,this.pxlCamera=null,this.pxlNavCanvas=null,this.pxlQuality=null,this.pxlEnv=null,this.assetRoot=i,this.guiRoot=s,this.introHelpActive=!0,this.branding={title:t,loader:s+".svg",logo:s+".svg",medalion:s+".svg",stack:s+".svg"},this.loaderPhrases=["Loading..."],this.lableBoxSize=40,this.optionWidthRound=10,this.optionWidthAdd=25,this.deviceOptionHeight=[0,300],this.pxlLoader=null,this.pxlLoaderCount=0,this.pxlLoaderTotal=5,this.hudBlock={obj:null,active:!1},this.userControlBlock=null,this.hudVisibility=!0,this.hudIcons={},this.hudElements={},this.guiWindows={},this.msgCount=0,this.hudMedalionBar=null,this.userProfileMessageInput=null,this.userProfileReturnMessage=null,this.userCountObj=null,this.userCountCur=0,this.messageCountObj=null,this.messageCountCur=0,this.chatMessageDisplay=null,this.chatMessageInput=null,this.camChoicesActive=!1,this.micChoicesActive=!1,this.pxlNavData={active:!1,gui:null,height:null,fpsSet:0,fps:null,dl:null,ul:null},this.djPlayerObj=null,this.buildGuiStatus={hud:!1,userTopBar:!1,bottomBar:!1,djPlayer:!1,roomControls:!1,verseList:!1,medalion:!1,loadingBranding:!1},this.settingsFields={changeUsername:!1},this.requestVerseList=!1,this.verseList=[],this.verseUserCounts={},this.verseTitlePrefix="",this.verseTitleSuffix="'s Room",this.multiverseData={fromVerse:null,toVerse:null,electedVerse:null,mitosisState:!1,mitosisBufferTime:15,mitosisTime:0,mitosisUpdateTime:0},this.textDescriptions={chatIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">C</span> )</span><br>chat',pos:[1,-1.5]},multiverseIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">U</span> )</span><br>multiverse<br>selection',pos:[0,-1.3]},djPlayerVolumeParent:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">B</span> )</span><br>music volume',pos:[0,-1.5]},speakerIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">N</span> )</span><br>mute people<br>pick audio output',pos:[0,-1.5]},micIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">M</span> )</span><br>mute/pick<br>mic input',pos:[0,-1.5]},camIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">V</span> )</span><br>enable/pick<br>video input',pos:[0,-1.5]},helpIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">?</span> )</span><br>help &<br>instructions',pos:[0,-1.5]},infoIconParent:{text:'Info <span class="helpHotKeyParent">( <span class="helpHotKey">I</span> )</span>',pos:[-1,0],offset:[-10,0]},settingsIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">G</span> )</span><br>graphics &<br>navigation',pos:[0,-1.5]},muteAllIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">N</span> )</span><br>mute all users',pos:[1,0]},fullScreenIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">F</span> )</span><br>toggle full screen',pos:[-1,0]},videoQualityIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">H</span> )</span><br>video quality settings',pos:[-1,0]},statsIcon:{text:"jitsi connection status; toggle connection ",pos:[1,0]},usersIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">T</span> )</span> user moderator tools',pos:[1,0]},ft2Button:{text:"Environment",pos:[-1,0],offset:[-10,0]},ft3Button:{text:"Invite Friends",pos:[-1,0],offset:[-10,0]},hud_userCount:{text:"# of People",pos:[-1,0],offset:[-10,0]}},this.loading=!0,this.disclaimer=!1,this.mapPrompt=null,this.mapPromptBG=null,this.delayLoadChatWindow=!1,this.renderSettings=null,this.controlSettings=null,this.shaderEditorDisplay=null,this.radioControls=[],this.controlState=[!0,!1,!1,!1],this.controlToggle=[!0,!0,!1,!1],this.buttonPadding=6,this.toggleOpacity=[.6,1],this.qualityText=["Netbook","Laptop","Desktop Computer","Gamer Rig"],this.activeItem=null,this.jmaWindowVis=!1,this.actionPopUp=null,this.ctaLocalDocURL={},this.ctaContentLoading=!1,this.googleDocHTML=null,this.googleDocURL=""}setDependencies(pxlNav){this.pxlFile=pxlNav.pxlFile,this.pxlCookie=pxlNav.pxlCookie,this.pxlTimer=pxlNav.pxlTimer,this.pxlAudio=pxlNav.pxlAudio,this.pxlUtils=pxlNav.pxlUtils,this.pxlUser=pxlNav.pxlUser,this.pxlDevice=pxlNav.pxlDevice,this.pxlAutoCam=pxlNav.pxlAutoCam,this.pxlCamera=pxlNav.pxlCamera,this.pxlNavCanvas=pxlNav.pxlNavCanvas,this.pxlQuality=pxlNav.pxlQuality,this.pxlEnv=pxlNav.pxlEnv,this.mobile=pxlNav.mobile,this.renderSettings=this.pxlCookie.readCookie(this.pxlUser.renderSettingsCookie),this.controlSettings=this.pxlCookie.readCookie(this.pxlUser.controlModeCookie),pxlNav.pxlDevice.subscribe("resize",this.resize.bind(this))}init(){this.cssBuildClasses(),this.buildConsole()}prepLoader(){this.mapPromptBG=document.createElement("div"),this.mapPromptBG.classList.add("mapPromptBackgroundStyle"),document.body.appendChild(this.mapPromptBG),this.mapPrompt=document.createElement("div"),this.mapPrompt.setAttribute("id","mapPrompt"),this.mapPrompt.classList.add("mapPromptStyle"),this.mapPrompt.classList.add("fader"),this.mapPrompt.classList.add("visOn"),this.mapPrompt.innerHTML="\n            <div id=\"loaderLogoBranding\" class='pxlLoaderLogo'></div>\n            <div class='loadStyleParent'>\n              <div id='pxlLoader' class='loadStyle'></div>\n              <div id='pxlLoaderBackground' class='loadStyleBackground'></div>\n            </div>\n            <div id=\"loaderBranding\" class='pxlLoaderTitle'>".concat(this.projectTitle,"</div>\n            <div id=\"loaderMessage\" class='pxlLoaderMessage'></div>\n          "),document.body.appendChild(this.mapPrompt);var e=document.getElementById("loaderMessage");if(e){var t=this.loaderPhrases[Math.floor(Math.random()*this.loaderPhrases.length)];e.innerHTML=t}this.buildGuiStatus.loadingBranding&&SVGUtils.svgPromise(this.branding.loader,"loaderBranding","pxlLoaderTitle","loadBrandingLogo"),this.pxlLoader=document.getElementById("pxlLoader"),this.pxlLoader.style.width="2%";var i=document.createElement("div");i.classList.add("canvasCrashPromptBackgroundStyle"),document.body.appendChild(i);var s,a=document.createElement("div");a.classList.add("canvasCrashPromptStyle"),i.appendChild(a),this.pxlQuality&&(s=0==parseInt(this.pxlQuality.detailLimit)?'Looks like your computer is having a hard time, but we’ve got your fix.\n          <br>Please click <a id="crashLink" class="crashLink">HERE</a> to reload '.concat(this.projectTitle,".\n          <br>If you’re still having issues, drop us a line in the chat."):'Looks like your computer is still having trouble, but we’ve got another fix for ya.\n          <br>Please click <a id="crashLink" class="crashLink">HERE</a> to reload '.concat(this.projectTitle," again.\n          <br>Again, if you’re still having issues, drop us a line in the chat.")),a.innerHTML=s;var r=document.getElementById("crashLink"),n=this;r&&(r.onclick=e=>{n.crashLinkTrigger(e,n)})}stepLoader(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.pxlLoaderCount+=1;var t=Math.min(100,this.pxlLoaderCount/(this.pxlLoaderTotal-1)*100);100==t&&(this.pxlLoader.style.borderRadius="5px"),this.pxlLoader.style.width=t+"%",this.verbose>=b.INFO&&console.log("Loader",this.pxlLoaderCount,this.pxlLoader.style.width,"; "+e)}setLoaderPhrases(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e&&e.length>0&&(t&&(this.loaderPhrases=[]),this.loaderPhrases=this.loaderPhrases.concat(e),this.setLoaderObjMessage())}setLoaderObjMessage(){var e=document.getElementById("loaderMessage");if(e){var t=Math.floor(17391.537193*Math.random()*this.loaderPhrases.length%this.loaderPhrases.length),i=this.loaderPhrases[t];e.innerHTML=i}}booted(){this.buildHudBlock(),this.buildTopBar(),this.buildBottomBar(),this.buildGuiWindowContainer(),this.buildUserControlBlock(),this.buildRawHtml(),this.prepPageDisplay()}step(){var e;this.updateGuiPositions(),null!==(e=this.pxlUser)&&void 0!==e&&e.checkItemWearOff(this.pxlTimer.prevMS)&&this.hideItemHud(),this.pxlNavDataUpdate()}resize(){this.sW=window.innerWidth,this.sH=window.innerHeight,this.resetHelpTextPlacement();["videoinput","audioinput","audiooutput"].forEach((e=>{var t=null,i=null;"videoinput"==e?(t="camChoiceOptionsBlock",i=this.hudIcons.camChoiceIcon):"audioinput"==e?(t="micChoiceOptionsBlock",i=this.hudIcons.micChoiceIcon):"audiooutput"==e&&(t="speakerChoiceOptionsBlock",i=this.hudIcons.speakerChoiceIcon);var s=document.getElementById(t);if(s&&i){var a=s.getBoundingClientRect().width,r=i.parent.getBoundingClientRect();s.style.left=r.x-.5*a,s.style.bottom=this.sH-this.hudBottomBar.getBoundingClientRect().y}})),this.setUserControlPosition(),this.inviteUserPosition(),this.setArtistInfoSizing()}resetHelpTextPlacement(){Object.keys(this.textDescriptions).forEach((e=>{var t=this.textDescriptions[e];if(t){var i=document.getElementById("helpText_"+e);if(!i)return;var s=document.getElementById(e);if(s){var a=t.pos,r=t.offset?t.offset:[0,0],n=s.getBoundingClientRect(),o=i.getBoundingClientRect(),l=0,h=0,d=!1;a[1]<0?(h=n.y+o.height*a[1],d=!0):0==a[1]?h=n.y+.5*n.height-.5*o.height:a[1]>0&&(h=n.y+n.height+o.height*(a[1]-1),d=!0),d?a[0]<0?l=n.x+n.width+o.width*a[0]:0==a[0]?l=n.x+.5*n.width-.5*o.width:a[0]>0&&(l=n.x+n.width*(a[0]-1)):a[0]<0?l=n.x+o.width*a[0]:0==a[0]?l=n.x+.5*n.width-.5*o.width:a[0]>0&&(l=n.x+2*n.width*a[0]),(l+=r[0])+o.width>this.sW-2?l=this.sW-2-o.width:l<2&&(l=2),h+=r[1],i.style.left=l,i.style.top=h}else i.style.display="none"}}))}crashLinkTrigger(e,t){var i=location.search.match(/[a-zA-Z0-9=]+/g),s="?";i.forEach((e=>{var t=e.split("=");"dlimit"==t[0]?s+=t[0]+"="+(parseInt(t[1])+1)+"&":s+=e+"&"})),location.search=s}guiToggleVisibility(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(e=null==e?!this.hudVisibility:e,this.hudVisibility=e,this.hudTopBar&&!this.hudTopBar.origDisplay&&(this.hudTopBar.origDisplay=this.hudTopBar.style.display),this.fastTravelBar&&!this.fastTravelBar.origDisplay&&(this.fastTravelBar.origDisplay=this.fastTravelBar.style.display),this.hudBottomBar&&!this.hudBottomBar.origDisplay&&(this.hudBottomBar.origDisplay=this.hudBottomBar.style.display),e){if(this.hudTopBar&&this.hudTopBar.removeAttribute("style"),this.fastTravelBar&&this.fastTravelBar.removeAttribute("style"),this.hudBottomBar&&this.hudBottomBar.removeAttribute("style"),this.userControlBlock){var t=this.userControlBlock.gui.style.top;this.userControlBlock.gui.removeAttribute("style"),this.userControlBlock.gui.style.top=t}}else this.hudTopBar&&(this.hudTopBar.style.display="none"),this.fastTravelBar&&(this.fastTravelBar.style.display="none"),this.hudBottomBar&&(this.hudBottomBar.style.display="none"),this.userControlBlock&&(this.userControlBlock.gui.style.display="none");this.hudElements.artistInfo&&(this.hudElements.artistInfo.parent.style.display=e?"grid":"none")}cssBuildClasses(){var e=document.createElement("style");e.type="text/css",e.innerHTML="\n\t\t\t.fader{\n\t\t\t\ttransition: opacity .8s, filter .8s;\n\t\t\t}\n\t\t\t.visOn{\n\t\t\t\tfilter:alpha(opacity=100);\n\t\t\t\topacity:1.0;\n\t\t\t}\n\t\t\t.visOff{\n\t\t\t\tfilter:alpha(opacity=0);\n\t\t\t\topacity:0.0;\n\t\t\t}\n\t\t",document.getElementsByTagName("head")[0].appendChild(e)}prepPromptFader(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=e;("string"!=typeof i||(i=document.getElementById(i)))&&(i.classList.add("fader"),i.classList.add(t?"visOn":"visOff"),i.style.display=t?"inline-block":"none")}promptFader(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if("string"!=typeof e||(e=document.getElementById(e)))if(e.classList.value.indexOf("fader")<0&&e.classList.add("fader"),t)e.style.display="inline-block",setTimeout((()=>{e.classList.contains("visOff")&&(e.classList.remove("visOff"),e.classList.add("visOn"),null!=i&&(e.setAttribute("fadeOut",clockTime+1e3*i),fadeOutList.push(e)))}),50);else if(e.classList.remove("visOn"),e.classList.add("visOff"),s){["webkitTransitionEnd","otransitionend","oTransitionEnd","msTransitionEnd","transitionend"].forEach((t=>{e.addEventListener(t,(()=>{var t=e.parentNode;t&&t.removeChild(e)}))}))}else setTimeout((()=>{e.classList.contains("visOff")&&(e.style.display="none")}),1e3)}buildConsole(){var e=document.createElement("div");e.id="consoleBlock",e.classList.add("consoleBlockStyle"),document.body.appendChild(e),this.guiWindows.consoleBlock={active:!1,gui:e}}buildMessageBlock(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Info",i=document.createElement("div");this.msgCount++,i.id="messageBlock-"+this.msgCount,i.classList.add("messageBlockStyle"),i.classList.add("message"+t);var s=this,a=document.createElement("div");a.classList.add("messageCloseBtn"),a.innerHTML="X",a.addEventListener("click",(function(){s.removeMessage(i)}));var r=document.createElement("div");r.classList.add("messageTopBarStyle");var n=document.createElement("div");n.classList.add("messageHeaderStyle"),n.innerHTML=t,r.appendChild(n),r.appendChild(a),i.appendChild(r);var o=document.createElement("div");return o.classList.add("messageContentStyle"),o.innerHTML=e,i.appendChild(o),i}print(e){this.guiWindows.consoleBlock||this.buildConsole(),this.guiWindows.consoleBlock.active||(this.guiWindows.consoleBlock.active=!0,this.promptFader(this.guiWindows.consoleBlock.gui,!0));var t=this.guiWindows.consoleBlock.gui,i=this.buildMessageBlock(e);t.appendChild(i)}buildHudBlock(){if(this.buildGuiStatus.hud){var e=document.createElement("div");e.id="hudBlock",e.classList.add("hudBlockStyle"),this.hudBlock.obj=e,document.body.appendChild(this.hudBlock.obj),this.hudBlock.obj.style.display="none";var t=this;this.hudBlock.obj.addEventListener("click",(e=>{t.toggleHudBlock(!1,!0)}))}}toggleHudBlock(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hudBlock){e=null==e?!this.hudBlock.active:e,this.hudBlock.active=e;var i=!1;e?i="inline-block":this.checkOpenWindows(t)||(i="none",this.pxlNavCanvas&&this.pxlNavCanvas.focus()),this.hudBlock.obj&&this.hudBlock.obj.style&&0!=i&&(this.hudBlock.obj.style.display=i)}}checkOpenWindows(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Object.keys(this.guiWindows),i=!1;return t.forEach((t=>{"chatBoxGui"!=t&&(e&&(this.guiWindows[t].button&&this.flipIcon(this.guiWindows[t].button,!1),this.guiWindows[t].gui&&this.guiWindows[t].active&&(this.guiWindows[t].active=!1,this.promptFader(this.guiWindows[t].gui,!1),"settingsGui"==t&&this.togglePxlNavDataDisplay(!1))),i=i||this.guiWindows[t].active)})),i}checkFocus(){!0===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)&&this.guiWindows.inviteUserGui&&this.guiWindows.inviteUserGui.active&&this.toggleInviteUser(!1)}buildRawHtml(){}buildTopBar(){if(!this.mobile&&this.buildGuiStatus.userTopBar){var e=document.createElement("div");e.id="hud_topBar",e.classList.add("hud_topBarBlockStyle"),this.hudTopBar=e,document.body.appendChild(this.hudTopBar);var t;t='\n\t\t\t<div id="hud_localVideoStyle" class="hud_localVideoStyle"></div>\n\t\t\t<div id="hud_topBarParent" class="hud_topBarParentStyle">\n\t\t<div id="statsIconParent">\n\t\t\t'.concat('<div id="statsIcon"></div></div>\n\t\t<div id="usersIconParent">\n\t\t\t<div id="usersIcon"></div>','\n\t\t</div>\n\t\t<div  class="hud_topBarVSpacerStyle"></div>\n\t\t\t</div>\n\t\t'),e.innerHTML=t,this.hudIcons.statsIcon=SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_stats.svg"),"statsIcon","stats"),this.hudIcons.statsIcon.promise.finally((()=>{})),this.hudIcons.usersIcon=SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_user.svg"),"usersIcon","users");var i=document.createElement("div");i.id="hud_pxlNavData",i.classList.add("hud_pxlNavDataParentStyle"),e.appendChild(i),this.pxlNavData.gui=i;var s=document.createElement("div");s.id="hud_pxlNavData",s.classList.add("hud_pxlNavDataStyle"),i.appendChild(s),t='\n      <div class="hud_pxlNavData_FPS gui_boldText">FPS</div><div class="hud_pxlNavData_FPS">:</div><div id="hud_pxlFPS" class="hud_pxlNavData_FPS"> - </div>\n      <div class="hud_pxlNavData_UL gui_boldText">↑</div><div class="hud_pxlNavData_UL">:</div><div id="hud_pxlUL" class="hud_pxlNavData_UL"> - </div>\n      <div class="hud_pxlNavData_DL gui_boldText">↓</div><div class="hud_pxlNavData_DL">:</div><div id="hud_pxlDL" class="hud_pxlNavData_DL"> - </div>\n    ',s.innerHTML=t,this.pxlNavData.fps=document.getElementById("hud_pxlFPS"),this.pxlNavData.ul=document.getElementById("hud_pxlUL"),this.pxlNavData.dl=document.getElementById("hud_pxlDL")}}buildUserControlBlock(){this.userControlBlock={},this.userControlBlock.activeList=[],this.userControlBlock.userList={},this.userControlBlock.mutedList=[];var e=document.createElement("div");e.classList.add("userControlBlockStyle"),document.body.appendChild(e),this.userControlBlock.gui=e,this.userControlBlock.speakerIcon=null}buildMedalionBar(){if(this.buildGuiStatus.medalion){var e=document.createElement("div");e.id="hud_medalionBar",e.classList.add("hud_medalionIconBlockStyle"),this.hudMedalionBar=e,document.body.appendChild(this.hudMedalionBar);var t='\n        <div id="medalionIconParent" class="hud_speakerIconStyle">\n          <div id="medalionIcon"></div>\n        </div>\n        <div id="medalionTitle" class="medalionTitleStyle">'.concat(this.branding.title,"</div>\n      ");this.hudMedalionBar.innerHTML=t;var i=document.getElementById("medalionIcon"),s=document.getElementById("medalionTitle");i.addEventListener("mouseover",(()=>{s.classList.add("medalionTitleGrowStyle")})),i.addEventListener("mouseout",(()=>{s.classList.remove("medalionTitleGrowStyle")})),this.hudIcons.medalionIcon=SVGUtils.svgIconPromise(this.branding.medalion,"medalionIcon","info",null,"medalionStyle")}}buildBottomBar(){if(this.buildGuiStatus.bottomBar){var e=document.createElement("div");e.id="hud_bottomBar",e.classList.add("hud_bottomBarStyle"),this.hudBottomBar=e,document.body.appendChild(this.hudBottomBar);var t="";if(t+='\n    <div id="hud_chatIconBlock" class="hud_bottomLeftBlockStyle">\n        <div id="settingsIconParent" class="hud_settingsIconStyle">\n          <object id="settingsIcon"></object>\n        </div>\n  <div></div>\n        <div id="helpIconParent" class="hud_helpIconStyle">\n          <object id="helpIcon"></object>\n        </div>\n        ',!this.mobile&&this.buildGuiStatus.verseList&&(t+='<div class="hud_usersIconStyle">\n            <div id="multiverseIcon"></div>\n          </div>\n          <div></div>'),t+="</div>",this.mobile||(t+='\n        <div class="hud_micCamIconsBlockStyle">\n          <div id="speakerIconParent" class="hud_speakerIconStyle">\n            <div id="speakerIcon"></div>\n          </div>\n          <div id="speakerChoiceIconParent" class="hud_speakerChoiceIconStyle">\n            <div id="speakerChoiceOptionsBlock" class="gui_iconButtonPopup">\n            </div>\n            <div id="speakerChoiceIconParent">\n              <div id="speakerChoiceIcon" class="iconCaretStyle"></div>\n            </div>\n          </div>\n          <div class="hud_micCamSpacerStyle"></div>\n          <div id="micIconParent" class="hud_micIconStyle">\n            <div id="micIcon"></div>\n          </div>\n          <div id="micChoiceIconParent" class="hud_micChoiceIconStyle">\n            <div id="micChoiceOptionsBlock" class="gui_iconButtonPopup">\n            </div>\n            <div id="camChoiceIconParent">\n              <div id="micChoiceIcon" class="iconCaretStyle"></div>\n            </div>\n          </div>\n          <div class="hud_micCamSpacerStyle"></div>\n          <div id="camIconParent" class="hud_camIconStyle">\n            <div id="camIcon"></div>\n          </div>\n          <div id="camChoiceIconBlock" class="hud_camChoiceIconStyle">\n            <div id="camChoiceOptionsBlock" class="gui_iconButtonPopup">\n            </div>\n            <div id="camChoiceIconParent">\n              <div id="camChoiceIcon" class="iconCaretStyle"></div>\n            </div>\n          </div>\n        </div>\n        \n        <div id="hud_helpInfoSettingsBlock" class="hud_helpInfoSettingsBlockStyle">\n          <div class="guiVerseHudTitle">\n            <span id="guiVerseTitle"></span>\n          </div>\n          <div></div>\n          <div id="chatIconParent" class="hud_chatIconStyle">\n            <div id="chatIcon"></div>\n          </div>\n          <div id="hud_messageCount" class="hud_userCountStyle hud_messageCountBaseStyle">0</div>\n        </div>\n      '),this.hudBottomBar.innerHTML=t,this.messageCountObj=document.getElementById("hud_messageCount"),this.hudIcons.chatIcon=SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_chat.svg"),"chatIcon","chat"),this.mobile||this.pxlAutoCam.enabled){var i=document.getElementById("hud_chatIconBlock");i.style.gridAutoColumns="max-content max-content auto max-content",i.style.margin="0px 10px"}else{this.hudIcons.multiverseIcon=SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_multiverse.svg"),"multiverseIcon","multiverse"),this.hudIcons.speakerIcon=SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_ProxAudio.svg"),"speakerIcon","speakerToggle",!1),this.hudIcons.speakerChoiceIcon=SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_downcaret.svg"),"speakerChoiceIcon","speakerChoice",!1,"iconCaretStyle"),this.hudIcons.micIcon=SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_mic.svg"),"micIcon","micToggle",!1),this.hudIcons.micChoiceIcon=SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_downcaret.svg"),"micChoiceIcon","micChoice",!1,"iconCaretStyle"),this.hudIcons.camIcon=SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_camera.svg"),"camIcon","camToggle",!1),this.hudIcons.camChoiceIcon=SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_downcaret.svg"),"camChoiceIcon","camChoice",!1,"iconCaretStyle"),this.hudIcons.helpIcon=SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_help.svg"),"helpIcon","help"),this.hudIcons.settingsIcon=SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_settings.svg"),"settingsIcon","settings");document.getElementById("guiVerseTitle")}}}prepArtistInfo(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null!==(e=this.pxlEnv)&&void 0!==e&&e.postIntro&&""!=t){if(!this.hudElements.artistInfo){this.hudElements.artistInfo={},this.hudElements.artistInfo.active=!1;var i=document.createElement("div");i.classList.add("hud_aristInfoParentStyle"),this.hudElements.artistInfo.parent=i;var s=document.createElement("div");s.classList.add("hud_aristInfoButtonStyle"),i.appendChild(s);var a=this;s.onclick=()=>{a.toggleArtistInfo()},this.hudElements.artistInfo.button=s;var r=document.createElement("div");r.classList.add("hud_aristInfoButtonTextStyle"),r.innerHTML="artwork info&nbsp;&nbsp;",s.appendChild(r),this.hudElements.artistInfo.buttonText=r;var n=document.createElement("div");n.classList.add("hud_aristInfoCarrotXStyle"),n.id="artistInfoCarrotX",s.appendChild(n);var o=document.createElement("div");o.classList.add("hud_aristInfoInner"),o.innerHTML=t,i.appendChild(o),this.hudElements.artistInfo.inner=o,document.body.appendChild(i),this.hudElements.artistInfo.closeSvg=SVGUtils.svgPromise("".concat(this.guiRoot,"global/carrotClose_animated.svg"),"artistInfoCarrotX"),this.hudElements.artistInfo.closeSvg.promise.finally((()=>{this.artistInfoButtonPrep()}))}this.toggleArtistInfo(!1),null!=t&&this.hudVisibility&&!this.pxlAutoCam.active?(this.hudElements.artistInfo.parent.style.zIndex=155,this.hudElements.artistInfo.parent.style.display="grid",this.hudElements.artistInfo.inner.innerHTML=t,setTimeout((()=>{this.setArtistInfoSizing()}),20)):(this.hudElements.artistInfo.parent.style.zIndex=-5,this.hudElements.artistInfo.parent.style.display="none")}}artistInfoButtonPrep(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.hudElements.artistInfo.closeSvg.svg;if(t){var i=t.getElementById("carrotToClone_on"),s=t.getElementById("carrotToClone_off");i&&s?(this.hudElements.artistInfo.onAnim=i,this.hudElements.artistInfo.offAnim=s):2==e||setTimeout((()=>{this.artistInfoButtonPrep(e+=1)}),100)}}setArtistInfoSizing(){if(this.hudElements.artistInfo){var e=this.hudElements.artistInfo.inner.clientHeight,t=this.hudElements.artistInfo.inner.clientWidth,i=this.hudElements.artistInfo.button.clientHeight,s=this.hudElements.artistInfo.button.clientWidth;this.hudElements.artistInfo.innerHeight=e,this.hudElements.artistInfo.innerWidth=t,this.hudElements.artistInfo.baseHeight=i,this.hudElements.artistInfo.baseWidth=s,this.hudElements.artistInfo.parent.style.height=e+"px",this.hudElements.artistInfo.parent.style.width=t+"px";var a=this.hudElements.artistInfo.buttonText.clientWidth;this.hudElements.artistInfo.buttonText.maxWidth=a,this.hudElements.artistInfo.buttonText.style.maxWidth=a+"px",this.toggleArtistInfo(this.hudElements.artistInfo.active)}}toggleArtistInfo(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e=null==e?!this.hudElements.artistInfo.active:e,this.hudElements.artistInfo.active=e;var t=this.hudElements.artistInfo.innerHeight,i=Math.min(.3*this.pxlDevice.sW,this.hudElements.artistInfo.innerWidth),s=this.hudElements.artistInfo.baseHeight,a=this.hudElements.artistInfo.baseWidth;this.hudElements.artistInfo.parent.style.maxHeight=e?t+"px":s+"px",this.hudElements.artistInfo.parent.style.maxWidth=e?i+"px":a+"px",this.hudElements.artistInfo.parent.style.padding=e?"5px":"0px";var r=this.hudElements.artistInfo.buttonText.maxWidth;this.hudElements.artistInfo.buttonText.style.maxWidth=e?"0px":r+"px",this.hudElements.artistInfo.buttonText.style.opacity=e?"0":"1",this.hudElements.artistInfo.buttonText.style.filter="alpha(opacity="+(e?"0":"1000")+")",this.hudElements.artistInfo.inner.style.opacity=e?"1":"0",this.hudElements.artistInfo.inner.style.filter="alpha(opacity="+(e?"100":"0")+")",this.hudElements.artistInfo.onAnim&&(e?this.hudElements.artistInfo.onAnim.beginElement():this.hudElements.artistInfo.offAnim.beginElement())}prepPageDisplay(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null!==(e=this.pxlEnv)&&void 0!==e&&e.postIntro&&""!=t){if(!this.hudElements.artistInfo){this.hudElements.artistInfo={},this.hudElements.artistInfo.active=!1;var i=document.createElement("div");i.classList.add("hud_aristInfoParentStyle"),this.hudElements.artistInfo.parent=i;var s=document.createElement("div");s.classList.add("hud_aristInfoButtonStyle"),i.appendChild(s);var a=this;s.onclick=()=>{a.togglePageDisplay()},this.hudElements.artistInfo.button=s;var r=document.createElement("div");r.classList.add("hud_aristInfoButtonTextStyle"),r.innerHTML="artwork info&nbsp;&nbsp;",s.appendChild(r),this.hudElements.artistInfo.buttonText=r;var n=document.createElement("div");n.classList.add("hud_aristInfoCarrotXStyle"),n.id="artistInfoCarrotX",s.appendChild(n);var o=document.createElement("div");o.classList.add("hud_aristInfoInner"),o.innerHTML=t,i.appendChild(o),this.hudElements.artistInfo.inner=o,document.body.appendChild(i)}this.togglePageDisplay(!1),null!=t&&this.hudVisibility&&!this.pxlAutoCam.active?(this.hudElements.artistInfo.parent.style.zIndex=155,this.hudElements.artistInfo.parent.style.display="grid",this.hudElements.artistInfo.inner.innerHTML=t,setTimeout((()=>{this.setArtistInfoSizing()}),20)):(this.hudElements.artistInfo.parent.style.zIndex=-5,this.hudElements.artistInfo.parent.style.display="none")}}setPageToDisplay(){if(this.hudElements.artistInfo){var e=this.hudElements.artistInfo.inner.clientHeight,t=this.hudElements.artistInfo.inner.clientWidth,i=this.hudElements.artistInfo.button.clientHeight,s=this.hudElements.artistInfo.button.clientWidth;this.hudElements.artistInfo.innerHeight=e,this.hudElements.artistInfo.innerWidth=t,this.hudElements.artistInfo.baseHeight=i,this.hudElements.artistInfo.baseWidth=s,this.hudElements.artistInfo.parent.style.height=e+"px",this.hudElements.artistInfo.parent.style.width=t+"px";var a=this.hudElements.artistInfo.buttonText.clientWidth;this.hudElements.artistInfo.buttonText.maxWidth=a,this.hudElements.artistInfo.buttonText.style.maxWidth=a+"px",this.toggleArtistInfo(this.hudElements.artistInfo.active)}}togglePageDisplay(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.hudElements.artistInfo){var t;e=null==e?!this.hudElements.artistInfo.active:e,null!==(t=this.hudElements)&&void 0!==t&&t.artistInfo&&(this.hudElements.artistInfo.active=e);var i=this.hudElements.artistInfo.innerHeight,s=Math.min(.3*this.pxlDevice.sW,this.hudElements.artistInfo.innerWidth),a=this.hudElements.artistInfo.baseHeight,r=this.hudElements.artistInfo.baseWidth;this.hudElements.artistInfo.parent.style.maxHeight=e?i+"px":a+"px",this.hudElements.artistInfo.parent.style.maxWidth=e?s+"px":r+"px",this.hudElements.artistInfo.parent.style.padding=e?"5px":"0px";var n=this.hudElements.artistInfo.buttonText.maxWidth;this.hudElements.artistInfo.buttonText.style.maxWidth=e?"0px":n+"px",this.hudElements.artistInfo.buttonText.style.opacity=e?"0":"1",this.hudElements.artistInfo.buttonText.style.filter="alpha(opacity="+(e?"0":"1000")+")",this.hudElements.artistInfo.inner.style.opacity=e?"1":"0",this.hudElements.artistInfo.inner.style.filter="alpha(opacity="+(e?"100":"0")+")",this.hudElements.artistInfo.onAnim&&(e?this.hudElements.artistInfo.onAnim.beginElement():this.hudElements.artistInfo.offAnim.beginElement())}}iconEvent(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this.hudBlock.obj&&(this.hudBlock.obj.style.display="none"),"click"==e)switch(i){case"chat":this.toggleChatBox();break;case"musicToggle":this.pxlAudio.djPlayerMuteToggle(),this.toggleIcon(t,!this.pxlAudio.djMuted,!0);break;case"userSpeakerToggle":this.setUserControls(t);break;case"speakerToggle":this.toggleIcon(t,!1,!0);break;case"speakerChoice":var s="audiooutput";this.flipIcon(t,this.guiWindows[s]&&this.guiWindows[s].active);break;case"help":var a=!!this.guiWindows.helpGui&&this.guiWindows.helpGui.active;this.checkOpenWindows(!0),this.helpGuiToggle(!a);break;case"info":var r=!!this.guiWindows.infoGui&&this.guiWindows.infoGui.active;this.checkOpenWindows(!0),this.infoGuiToggle(!r);break;case"settings":var n=!!this.guiWindows.settingsGui&&this.guiWindows.settingsGui.active;this.checkOpenWindows(!0),this.settingsGuiToggle(!n);break;case"userProfile":this.toggleUserProfile()}}setMicVolumeLevel(e){this.hudIcons.micIcon.volumeMask||(this.hudIcons.micIcon.volumeMask=document.getElementById("gui_micVolumeMask"),this.hudIcons.micIcon.timer=this.pxlTimer.msRunner.x-1);var t=12-11*e;this.hudIcons.micIcon.volumeMask.setAttribute("y",t)}toggleIcon(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e){if(e.mute.style.filter=t?"alpha(opacity=0)":"alpha(opacity=100)",e.mute.style.opacity=t?"0":"1",e.mute.style.transform=t?"scale(0,0)":"scale(1,1)",["camToggle","speakerToggle"].includes(e.eventType))return;var s={speakerToggle:"speaker",micToggle:"audio",camToggle:"video"}[e.eventType];s&&i&&this.loadingDeviceChange(s,t)}}flipIcon(e,t){e.caret.style.transform="rotate( ".concat(t?"180deg":"0deg"," )")}loadingDeviceChange(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=null;"speaker"==e?i=this.hudIcons.speakerIcon:"audio"==e?i=this.hudIcons.micIcon:"video"==e&&(i=this.hudIcons.camIcon),i.indicator.style.display=t?"inline-block":"none",i.indicator.style.animationPlayState=t?"running":"paused",i.waiting.forEach((e=>{e.setAttribute("fill-opacity",t?".5":"1")})),t&&setTimeout((()=>{this.loadingDeviceChange(e,!1)}),1e3)}djBuildPlayer(){if(this.buildGuiStatus.djPlayer){this.djPlayerObj=document.createElement("div"),this.djPlayerObj.id="djPlayer";var e='\n          <audio id="djStream" playsinline muted>\n            <source src="'+this.pxlAudio.djUrlSource+'"></source>\n          </audio>\n          <table cellpadding=0 cellspacing=5 border=0 style="height:100%;"><tbody><tr>\n              <td align="left">\n                  <div id="djPlayerVol"></div>\n              <  d><td valign="center" align="left" width=100%>\n                  <div id="djPlayerVolumeParent" class="volParent"><div id="djPlayerVolume" class="volSlider"></div></div>\n              <  d><  r>\n          <  body><  able>';this.djPlayerObj.innerHTML=e,document.getElementById("musicControllerBlock").appendChild(this.djPlayerObj),this.hudIcons.musicIcon=SVGUtils.svgIconPromise("".concat(this.guiRoot,"icons/icon_music.svg"),"djPlayerVol","musicToggle",!this.pxlAudio.djMuted),this.pxlAudio.djBuildPlayer()}}buildItemHud(e,t){this.activeItem.innerHTML=t,this.activeItem.style.opacity="1",this.activeItem.style.filter="alpha(opacity=100)",this.activeItem.style.textShadow="1px 1px 3px #000000",setTimeout((()=>{this.activeItem.style.fontSize="1.5em",this.activeItem.style.top=".5%",this.activeItem.style.right="140px",this.activeItem.style.transform="translateX(0%)"}),1500)}hideItemHud(){this.activeItem.innerHTML="",this.activeItem.style.fontSize="3em",this.activeItem.style.top="10%",this.activeItem.style.right="50%",this.activeItem.style.transform="translateX(50%)",this.activeItem.style.opacity="0",this.activeItem.style.filter="alpha(opacity=0)"}mapPrepPrompts(){this.activeItem=document.createElement("div"),this.activeItem.classList.add("activeItemStyle"),document.body.appendChild(this.activeItem)}updateGuiPositions(){if(this.loading){for(var e=this.radioControls.length,t=!1,i=0;i<e;++i){if(!this.radioControls[i][3]){t=!0;break}var s=this.radioControls[i][0],a=this.radioControls[i][2].getBoundingClientRect(),r=a.width+2*this.buttonPadding,n=a.height+2*this.buttonPadding,o=a.top-this.buttonPadding,l=a.left-this.buttonPadding;s.style.width=r,s.style.height=n,s.style.top=o,s.style.left=l,this.radioControls[i][1].style.width=r,this.radioControls[i][1].style.height=n,this.radioControls[i][1].style.top=o,this.radioControls[i][1].style.left=l}this.loading=t}}togglGuiWindow(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];"helpGui"==e?this.helpGuiToggle(t,!1):"infoGui"==e?this.infoGuiToggle(t,!1):"settingsGui"==e&&this.settingsGuiToggle(t,!1)}svgCheckClick(){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e&&("close"!=e?"ft1"!=e&&"ft2"!=e&&("ft3"!=e?"ft4"!=e&&("ft5"!=e||this.pxlAutoCam.toggleAutoCam()):this.toggleInviteUser()):this.toggleGuiWindowContainer(null,!1,!0))}svgStylize(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e){var i=e.path?e.path[1]:e.target.parentNode,s=i.getElementById("state");if(s){var a=t?"white":"none";s.setAttribute("fill",a)}var r=i.getElementById("hover");r&&r.setAttribute("fill",color)}}renderQualitySettings(e){this.pxlQuality.percent=e,this.pxlQuality.screenResPerc=.75*e+.25,this.pxlQuality.mapAutoQualityUpdate(e,!0),this.pxlDevice.resizeRenderResolution()}pxlNavDataUpdate(){var e;this.pxlNavData.active&&null!==(e=this.pxlNavData)&&void 0!==e&&e.fps&&this.pxlTimer.msRunner.x>this.pxlNavData.fpsSet&&(this.pxlNavData.fpsSet=this.pxlTimer.msRunner.x+1,this.pxlNavData.fps.innerText=parseInt(1/this.pxlTimer.msRunner.y))}buildGuiWindowContainer(){var e=document.createElement("div");e.classList.id="guiWindowBackground",e.classList.add("guiWindowBackground"),e.classList.add("fader"),e.classList.add("visOff"),e.style.display="none";var t=this;e.onclick=e=>{t.toggleGuiWindowContainer(e,!1,!0)},this.guiWindowBG=e,document.body.appendChild(e)}toggleGuiWindowContainer(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e){var s=(e.path?e.path[0]:e.target).getAttribute("id");if("guiWindowBackground"!=s){if(!["gui_helpGuiWindow","gui_helpContent","gui_infoGuiWindow","gui_infoContent","gui_settingsGuiWindow","gui_settingsContent"].includes(s))return null}}var a=this.checkOpenWindows(i);this.guiWindowBG&&a==t&&this.promptFader(this.guiWindowBG,t,null,!1),t?this.pxlNavCanvas.blur():this.pxlNavCanvas.focus()}helpGuiBuild(){this.guiWindows.helpGui={},this.guiWindows.helpGui.gui=null,this.guiWindows.helpGui.active=!1;var e=document.createElement("div");e.id="gui_helpGuiWindow",e.classList.add("gui_helpGuiParentStyle"),this.prepPromptFader(e),this.guiWindowBG.appendChild(e);e.innerHTML='\n      <div id="gui_helpContent" class="gui_contentStyle">\n    <div class="gui_body">\n      <div id="gui_helpGui_keyboardParent" class="gui_helpGui_keyboardParent">\n      <div id="gui_helpGui_controlsKeyboard" class="guiPadding settings_sectionHeader">keyboard controls</div>\n      <div class="gui_helpGui_ASDWorUDLR">\n        <div id="gui_helpGui_asdw" class="gui_helpGui_asdw"></div>\n        <div id="gui_helpGui_or" class="gui_helpGui_text">or</div>\n        <div id="gui_helpGui_udlr" class="gui_helpGui_udlr"></div>\n      </div>\n      <div id="gui_helpGui_useKeys" class="gui_helpGui_text" style="display:inline-block;">Use your keyboard <span class="gui_boldText">WASD</span> or<br><span class="gui_boldText">ARROWS</span> keys to move around</div>\n      </div>\n      <div id="gui_helpGui_mouse" class="gui_helpGui_mouse">\n      <div id="gui_helpGui_MouseControls" class="guiPadding settings_sectionHeader">mouse controls</div>\n      <div id="gui_helpGui_MouseOutlined" class="gui_helpGui_mouseOutline"></div>\n      <div id="gui_helpGui_useMouse" class="guiPadding gui_helpGui_text" style="display:inline-block;">To orient your view:<br><span class="gui_boldText">LEFT CLICK</span> and drag your mouse<br><span class="gui_boldText">RIGHT CLICK</span> to lock your mouse</div>\n      </div>\n    </div>\n    <div id="gui_helpGui_hotKeys" class="gui_helpGui_hotKeys">\n            You can change <span class="gui_boldText">Navigation</span> and <span class="gui_boldText">Look controls</span> in the <span class="gui_boldText">Settings (G)</span> <span id="gui_helpGui_settingIcon"></span> menu\n            <br> To show this screen again, open the <span class="gui_boldText">Help (H)</span> screen\n            <br> For additional info, see the <span class="gui_boldText">Info (I)</span> screen\n          </div>\n    <div id="guiHelpFooter" class="gui_footer">\n      <div class="guiButton" id="guiHelpBackButton">close</div>\n    </div>\n    <div class="gui_spacer"></div>\n      </div>\n    ',[[this.guiRoot+"keyboard_asdw.svg","gui_helpGui_asdw","guiKeyDispSVG",!1],[this.guiRoot+"keyboard_udlr.svg","gui_helpGui_udlr","guiKeyDispSVG",!1],[this.guiRoot+"mouse_outline.svg","gui_helpGui_MouseOutlined","guiMouseDispSVG",!1]].forEach((e=>{SVGUtils.svgButtonPromise(...e)}));var t=this;document.getElementById("guiHelpBackButton").onclick=e=>{t.introHelpActive&&(t.introHelpActive=!1,t.pxlEnv.postHelpIntro()),t.svgCheckClick(e,"close")};Object.keys(this.textDescriptions);var i=document.getElementById("gui_helpGui_settingIcon");i&&this.hudIcons.settingsIcon&&(i.innerHTML=this.hudIcons.settingsIcon.svg.parentNode.innerHTML,i.style.position="relative",i.style.top="7.3px",i.style.width="30px",i.style.padding="2px",i.style.cursor="pointer",i.children[0].style.height="26px",i.onclick=()=>{t.iconEvent("click",null,"settings")}),this.guiWindows.helpGui.gui=e,setTimeout((()=>{this.resize()}),50)}helpGuiToggle(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.guiWindows.helpGui||this.helpGuiBuild(),e=null==e?!this.guiWindows.helpGui.active:e,this.guiWindows.helpGui.active=e,this.promptFader(this.guiWindows.helpGui.gui,e),this.toggleGuiWindowContainer(null,e),this.hudBlock.active&&this.toggleHudBlock(e),this.introHelpActive&&!e&&(this.introHelpActive=!1,this.pxlEnv.postHelpIntro()),setTimeout((()=>{this.resetHelpTextPlacement()}),20)}infoGuiBuild(){this.guiWindows.infoGui={},this.guiWindows.infoGui.gui=null,this.guiWindows.infoGui.active=!1;var e=document.createElement("div");e.id="gui_infoGuiWindow",e.classList.add("gui_infoGuiParentStyle"),this.prepPromptFader(e),this.guiWindowBG.appendChild(e);var t="";t+='\n    <div id="gui_infoContent" class="gui_contentInfoStyle">\n  <div class="gui_infoBody">\n    <div id="gui_infoGuiParent" class="gui_infoGuiParent">\n    <br>'.concat(this.projectTitle,'\n    <br>&nbsp;&nbsp; Created by <a href="https://github.com/ProcStack" target="_blank">Kevin Edzenga / ProcStack</a> 2024; 2025\n    <br>\n    <br>If any bugs are found in pxlNav, you can share them on the GitHub issues page:\n    <br>&nbsp;&nbsp; <a href="https://github.com/ProcStack/pxlNav/issues" target="_blank">pxlNav / issues</a>\n    <br>\n    </div>\n  </div>\n  <div id="guiInfoFooter" class="gui_footer">\n    <div class="guiButton" id="guiInfoBackButton">close</div>\n  </div>\n    </div>\n  '),e.innerHTML=t;var i=this;document.getElementById("guiInfoBackButton").onclick=e=>{i.svgCheckClick(e,"close")},this.guiWindows.infoGui.gui=e}infoGuiToggle(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.guiWindows.infoGui||this.infoGuiBuild(),e=null==e?!this.guiWindows.infoGui.active:e,this.guiWindows.infoGui.active=e,this.promptFader(this.guiWindows.infoGui.gui,e),this.toggleGuiWindowContainer(null,e),this.hudBlock.active&&this.toggleHudBlock(e),this.introHelpActive&&!e&&(this.introHelpActive=!1,this.pxlEnv.postHelpIntro())}applyCookies(){this.controlSettings&&(this.controlSettings=this.controlSettings),this.renderSettings&&(this.renderSettings=this.renderSettings)}settingsGuiBuild(){var e=this;this.guiWindows.settingsGui={},this.guiWindows.settingsGui.gui=null,this.guiWindows.settingsGui.active=!1;var t=document.createElement("div");t.id="gui_settingsGuiWindow",t.classList.add("gui_settingsGuiParentStyle"),this.prepPromptFader(t),this.guiWindowBG.appendChild(t);var i="Default";i=i||"";var s='\n    <div id="gui_settingsContent" class="gui_contentSettingsStyle">\n  <div class="gui_settingsBody">\n    <div class="gui_settingsParentGrid">\n    ';this.settingsFields.changeUsername&&(s+='\n        \x3c!-- -- Username -- -- --\x3e\n        <div class="cellMargin settings_icon" id="settings_user"></div>\n        <div class="settings_optionHeader">Username</div>\n        <div class="settings_radio" style="grid-auto-flow: row; justify-content: start;">\n            <div id="guiuserProfileBoxFieldParent" class="gui_userProfileBoxFieldParentStyle">\n              <input type="text" placeholder="Set your username" value="'.concat(i,'" id="settings_usernameInput" class="settings_usernameInput"></input>\n              <input type="button" value="Set" id="settings_sendUsername" class="sendUsername">\n            </div>\n            <div id="settings_usernameResponseMessage" class="usernameResponseMessageStyle"></div>\n        </div>\n      \x3c!-- -- -- -- -- -- --\x3e\n      <div class="settingsGridSpan settingsSpacer"></div>\n      \x3c!-- -- -- -- -- -- --\x3e\n      ')),s+='\n      \x3c!-- -- Left/Right -- -- --\x3e\n    <div class="cellMargin settings_icon" id="settings_left_right"></div>\n    <div class="settings_optionHeader">Left/Right</div>\n    <div class="settings_radio" id="settingsRadioBlock_leftRight">\n      <span>\n      <input type="radio" id="settings_tankTurning" name="settings_leftRight" value="0" hidden>\n      <label for="settings_tankTurning">Turn</label>\n      </span>\n      <span>\n      <input type="radio" id="settings_strafing" name="settings_leftRight" value="1" hidden>\n      <label for="settings_strafing">Strafe</label>\n      </span>\n    </div>\n      \x3c!-- -- Mouse -- -- --\x3e\n    <div class="cellMargin settings_icon" id="settings_mouse"></div>\n    <div class="settings_optionHeader">Mouse Looking</div>\n    <div class="settings_radio" id="settingsRadioBlock_mouse">\n      <span>\n      <input type="radio" id="settings_dragLooking" name="settings_mouse" value="0" hidden>\n      <label for="settings_dragLooking">Native</label>\n      </span>\n      <span>\n      <input type="radio" id="settings_pointLooking" name="settings_mouse" value="1" hidden>\n      <label for="settings_pointLooking">Inverted</label>\n      </span>\n    </div>\n      \x3c!-- -- -- -- -- -- --\x3e\n    <div class="settingsGridSpan settingsSpacer"></div>\n      \x3c!-- -- Graphics Quality -- -- --\x3e\n    <div class="cellMargin settings_icon" id="settings_graphics"></div>\n    <div class="settings_optionHeader">Graphics Quality</div>\n    <div class="settings_radio" id="settingsRadioBlock_graphics">\n      <span>\n      <input type="radio" id="settings_graphicsQuality_low" name="settings_autoQuality" value="0" hidden>\n      <label for="settings_graphicsQuality_low">Low</label>\n      </span>\n      <span>\n      <input type="radio" id="settings_graphicsQuality_med" name="settings_autoQuality" value="1" hidden>\n      <label for="settings_graphicsQuality_med">Medium</label>\n      </span>\n      <span>\n      <input type="radio" id="settings_graphicsQuality_high" name="settings_autoQuality" value="2" hidden>\n      <label for="settings_graphicsQuality_high">High</label>\n      </span>\n      <span>\n      <input type="radio" id="settings_graphicsQuality_custom" name="settings_autoQuality" value="3" hidden>\n      <label for="settings_graphicsQuality_custom">Custom</label>\n      </span>\n    </div>\n      \x3c!-- -- -- -- --\x3e\n      <div class="r7Adv gui_settingsAdvancedParentGrid" id="gui_advancedSettings">\n    \x3c!-- -- -- -- --\x3e\n      <div class="cellMargin settings_icon" id="settings_render"></div>\n      <div class="settings_optionHeader">Render Resolution</div>\n      <div class="settings_radio" id="settingsRadioBlock_resolution">\n      <span>\n        <input type="radio" id="settings_render_25" name="settings_renderPerc" value=".25" hidden>\n        <label for="settings_render_25">25%</label>\n      </span>\n      <span>\n        <input type="radio" id="settings_render_50" name="settings_renderPerc" value=".5" hidden>\n        <label for="settings_render_50">50%</label>\n      </span>\n      <span>\n        <input type="radio" id="settings_render_75" name="settings_renderPerc" value=".75" hidden>\n        <label for="settings_render_75">75%</label>\n      </span>\n      <span>\n        <input type="radio" id="settings_render_100" name="settings_renderPerc" value="1" hidden>\n        <label for="settings_render_100">100%</label>\n      </span>\n      </div>\n    \x3c!-- -- -- -- --\x3e\n      <div class="cellMargin settings_icon" id="settings_fog"></div>\n      <div class="settings_optionHeader">Fog Quality</div>\n      <div class="settings_radio" id="settingsRadioBlock_fog">\n      <span>\n        <input type="radio" id="settings_noRedFog" name="settings_fogLevel" value="0" hidden>\n        <label for="settings_noRedFog">Low</label>\n      </span>\n      <span>\n        <input type="radio" id="settings_cheapResFog" name="settings_fogLevel" value="1" hidden>\n        <label for="settings_cheapResFog">Medium</label>\n      </span>\n      <span>\n        <input type="radio" id="settings_highResFog" name="settings_fogLevel" value="2" hidden>\n        <label for="settings_highResFog">High</label>\n      </span>\n      </div>\n    \x3c!-- -- -- -- --\x3e\n      <div class="cellMargin settings_icon" id="settings_bloom"></div>\n      <div class="settings_optionHeader">Bloom Effects</div>\n      <div class="settings_radio" id="settingsRadioBlock_bloom">\n      <span>\n        <input type="radio" id="settings_noBloom" name="settings_bloomEffects" value="0" hidden>\n        <label for="settings_noBloom">Off</label>\n      </span>\n      <span>\n        <input type="radio" id="settings_bloomActive" name="settings_bloomEffects" value="1" hidden>\n        <label for="settings_bloomActive">On</label>\n      </span>\n      </div>\n    \x3c!-- -- -- -- --\x3e\n      </div>\n    </div>\n      <div class="settingsGridSpan settingsEmptySpacer"></div>\n    </div>\n    <div class="guiSettingsFooterButtons">\n    <div class="guiButton" id="guiSettingsBackButton">close</div>\n    </div>\n  </div>\n    </div>\n  ',t.innerHTML=s,this.guiWindows.settingsGui.gui=t;var a=this;this.qualitySlider=document.getElementById("SettingsGraphicsQualitySlider"),document.getElementById("guiSettingsBackButton").onclick=e=>{a.svgCheckClick(e,"close")},[[this.guiRoot+"settings_user.svg","settings_user",["settings_icon_scale"],!1],[this.guiRoot+"settings_left_right.svg","settings_left_right",["settings_icon"],!1],[this.guiRoot+"settings_mouse.svg","settings_mouse",["settings_icon"],!1],[this.guiRoot+"settings_graphics.svg","settings_graphics",["settings_icon"],!1],[this.guiRoot+"settings_render.svg","settings_render",["settings_icon"],!1],[this.guiRoot+"settings_fog.svg","settings_fog",["settings_icon"],!1],[this.guiRoot+"settings_bloom.svg","settings_bloom",["settingsIconStyle"],!1]].forEach((e=>{SVGUtils.svgButtonPromise(...e)}));var r,n,o=document.getElementById("settings_usernameInput");if(o){o.onkeyup=e=>{a.keyUsernameSet(e)},o.onkeydown=e=>{a.keyDownUsernameSet(e)},this.guiWindows.settingsGui.usernameInput=o,document.getElementById("settings_sendUsername").addEventListener("click",(()=>{a.sendUsernameUpdate(o)}));var l=document.getElementById("settings_usernameResponseMessage");l&&(this.guiWindows.settingsGui.usernameReturn=l)}this.guiWindows.settingsGui.advObj=document.getElementById("gui_advancedSettings"),this.guiWindows.settingsGui.customObj=document.getElementById("settings_graphicsQuality_custom"),n=(r=["settings_graphicsQuality_low","settings_graphicsQuality_med","settings_graphicsQuality_high","settings_graphicsQuality_custom"]).length;for(var h=function _loop(){var t=r[d],i=document.getElementById(t);e.setRadioStyle(i,d,n);var s=parseInt(i.value);i.addEventListener("change",(e=>{a.pxlQuality.setQualityLevel(s),a.setRadioValues()}))},d=0;d<n;++d)h();n=(r=["settings_render_25","settings_render_50","settings_render_75","settings_render_100"]).length;for(var c=function _loop2(){var t=r[u],i=document.getElementById(t);e.setRadioStyle(i,u,n);var s=parseFloat(i.value);i.addEventListener("change",(e=>{a.guiWindows.settingsGui.customObj.checked=!0,a.pxlQuality.setGraphicsSettings({resolution:s}),a.pxlQuality.setQualityCookie(3)}))},u=0;u<n;++u)c();n=(r=["settings_noRedFog","settings_cheapResFog","settings_highResFog"]).length;for(var p=function _loop3(){var t=r[m],i=document.getElementById(t);e.setRadioStyle(i,m,n);var s=i.value;i.addEventListener("change",(e=>{a.guiWindows.settingsGui.customObj.checked=!0,a.pxlQuality.setGraphicsSettings({fog:s}),a.pxlQuality.setQualityCookie(3)}))},m=0;m<n;++m)p();n=(r=["settings_noBloom","settings_bloomActive"]).length;for(var v=function _loop4(){var t=r[g],i=document.getElementById(t);e.setRadioStyle(i,g,n);var s=1==i.value;i.addEventListener("change",(e=>{a.guiWindows.settingsGui.customObj.checked=!0,a.pxlQuality.setGraphicsSettings({bloom:s}),a.pxlQuality.setQualityCookie(3)}))},g=0;g<n;++g)v();n=(r=["settings_tankTurning","settings_strafing"]).length;for(var f=function _loop5(){var t=r[x],i=document.getElementById(t);e.setRadioStyle(i,x,n);var s=1==i.value;i.addEventListener("change",(e=>{a.pxlQuality.setGraphicsSettings({leftRight:s},null)}))},x=0;x<n;++x)f();n=(r=["settings_dragLooking","settings_pointLooking"]).length;for(var y=function _loop6(){var t=r[b],i=document.getElementById(t);e.setRadioStyle(i,b,n);var s=1==i.value;i.addEventListener("change",(e=>{a.pxlQuality.setGraphicsSettings({mouse:s},null)}))},b=0;b<n;++b)y();this.setRadioValues()}setRadioStyle(e,t,i){var s="settings_radio_label_mid";0==t?s="settings_radio_label_start":t==i-1&&(s="settings_radio_label_end"),e.parentNode.children[1].classList.add(s)}setRadioValues(){var e=this.pxlQuality.settings;Object.keys(e).forEach((t=>{var i=document.getElementById("settingsRadioBlock_"+t);if(i){var s="resolution"==t?4*e[t]-1:~~e[t];i.children[s].children[0].checked=!0}}))}settingsGuiAdvObjSizing(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.guiWindows.settingsGui.advObj,i=t.offsetHeight;t.style.maxHeight=(e?i:0)+"px",t.setAttribute("maxHeight",i)}settingsGuiToggle(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.guiWindows.settingsGui||this.settingsGuiBuild(),(t=null==t?!this.guiWindows.settingsGui.active:t)&&null!==(e=this.guiWindows)&&void 0!==e&&null!==(e=e.settingsGui)&&void 0!==e&&e.usernameReturn&&(this.guiWindows.settingsGui.usernameReturn.innerText=""),this.guiWindows.settingsGui.active=t,this.promptFader(this.guiWindows.settingsGui.gui,t),this.toggleGuiWindowContainer(null,t),this.hudBlock.active&&this.toggleHudBlock(t),this.toggleHudBlock(t,!1),this.togglePxlNavDataDisplay(t),this.introHelpActive&&!t&&(this.introHelpActive=!1,this.pxlEnv.postHelpIntro())}togglePxlNavDataDisplay(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null==t&&(t=!!this.guiWindows.settingsGui&&this.guiWindows.settingsGui.active),this.pxlNavData.active=t;var i=this.pxlNavData.height||200;null!==(e=this.pxlNavData)&&void 0!==e&&e.gui&&(this.pxlNavData.gui.style.maxHeight=t?i+"px":"0px",t||(this.pxlNavData.height=this.pxlNavData.gui.offsetHeight))}renderRadius(e){this.pxlEnv.mapGlowPass.strength=Number(e),this.pxlEnv.roomBloomPass.strength=Number(e)}renderThreshold(e){this.pxlEnv.mapGlowPass.threshold=Number(e),this.pxlEnv.roomBloomPass.threshold=Number(e)}renderGlowRadius(e){this.pxlEnv.mapGlowPass.radius=Number(e),this.pxlEnv.roomBloomPass.radius=Number(e)}renderResolution(e){this.pxlQuality.screenResPerc=.75*e+.25,this.pxlDevice.resizeRenderResolution()}inviteUserBuild(){this.guiWindows.inviteUserGui={},this.guiWindows.inviteUserGui.gui=null,this.guiWindows.inviteUserGui.active=!1;var e=document.createElement("div");e.id="gui_inviteUserWindow",e.classList.add("gui_inviteUserParentStyle"),this.prepPromptFader(e),document.body.appendChild(e);var t=window.location+"";t=t.replace(/^https?:\/\//,"");var i="";i+='\n        <div class="gui_inviteUserBody">\n          <div class="iu_urlStyle">'.concat(t,'</div>\n          <div id="iu_copy" class="iu_copyStyle">Copy</div>\n        </div>\n    '),e.innerHTML=i;var s=this.pxlUtils,a=document.getElementById("iu_copy");a.addEventListener("click",(()=>{var e=s.copyRoomUrl();a.innerText=e?"Copied":"Error",a.timeout&&clearTimeout(a.timeout),a.timeout=setTimeout((()=>{a.innerText="Copy",clearTimeout(a.timeout)}),2e3)})),this.guiWindows.inviteUserGui.gui=e}inviteUserPosition(){if(this.guiWindows.inviteUserGui&&this.guiWindows.inviteUserGui.active){var e=document.getElementById("ft3Button").getBoundingClientRect();this.guiWindows.inviteUserGui.gui.style.display="grid",this.guiWindows.inviteUserGui.gui.style.top=e.y,this.guiWindows.inviteUserGui.gui.style.right=this.pxlDevice.sW-e.x+5,this.guiWindows.inviteUserGui.gui.style.minHeight=e.height}}toggleInviteUser(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.guiWindows.inviteUserGui||this.inviteUserBuild(),e=null==e?!this.guiWindows.inviteUserGui.active:e,this.guiWindows.inviteUserGui.active=e,this.promptFader(this.guiWindows.inviteUserGui.gui,e),this.inviteUserPosition()}buildMobileWelcome(){this.guiWindows.mobileGui={},this.guiWindows.mobileGui.gui=null,this.guiWindows.mobileGui.active=!1;var e=document.createElement("div");e.id="gui_mobileWelcomeGuiWindow",e.classList.add("gui_helpGuiParentStyle"),this.prepPromptFader(e),this.guiWindowBG.appendChild(e);var t="";t+='\n    <div id="gui_helpContent" class="gui_contentStyle" style="min-height:45%;">\n  <div class="gui_mobileBody">\n    welcome to\n          <br>'.concat(this.projectTitle,'\n  </div>\n  <div id="guiHelpFooter" class="gui_footer" style="margin-bottom: 4vh;">\n    <div class="guiButton" style="font-weight: 700; font-size: 5vw;" id="guiMobileWelcomeButton">enter</div>\n  </div>\n  <div class="gui_spacer"></div>\n    </div>\n  '),e.innerHTML=t;var i=this;document.getElementById("guiMobileWelcomeButton").onclick=e=>{i.toggleMobileWelcome(!1),i.pxlEnv.postHelpIntro()},this.guiWindows.mobileGui.gui=e}toggleMobileWelcome(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.guiWindows.mobileGui||this.buildMobileWelcome(),e=null==e?!this.guiWindows.mobileGui.active:e,this.guiWindows.mobileGui.active=e,this.promptFader(this.guiWindows.mobileGui.gui,e),this.toggleGuiWindowContainer(null,e),this.hudBlock.active&&this.toggleHudBlock(e)}ctaBuildPopup(){this.ctaContentLoading||(this.googleDocHTML?this.ctaDisplayPopup():(this.ctaContentLoading=!0,this.pxlFile.getURLContent(this.ctaLocalDocURL.blmSupport).then((e=>{this.ctaContentLoading=!1,this.googleDocHTML=e,this.ctaDisplayPopup()}))))}ctaDisplayPopup(){this.actionPopUp&&this.actionPopUp.parentNode.removeChild(this.actionPopUp);var e=this.googleDocHTML;this.actionPopUp=document.createElement("div"),this.actionPopUp.setAttribute("id","ctaPopup"),this.actionPopUp.classList.add("parentGoogleLinkDoc"),this.actionPopUp.classList.add("fader"),this.actionPopUp.classList.add("visOff");var t=document.createElement("div");t.setAttribute("id","ctaPopupInner"),this.actionPopUp.appendChild(t),document.body.appendChild(this.actionPopUp);var i=null;""!=e&&e?(t.innerHTML=e,t.classList.add("iframeGoogleLinkDoc")):((i=document.createElement("iframe")).src="",i.classList.add("iframeGoogleLinkDoc"),t.appendChild(i),i.referrerpolicy="unsafe-url");var s=this;this.actionPopUp.onclick=function(e){"ctaPopup"==e.srcElement.getAttribute("id")&&(s.promptFader(this,!1,null,!0),s.actionPopUp=null)},i?i.onload=function(){setTimeout((()=>{this.promptFader(this.actionPopUp,!0,null,!1)}),100)}:setTimeout((()=>{this.promptFader(this.actionPopUp,!0,null,!1)}),100)}getUserControls(e){if(!e)return[null];var t=e,i=t.userStatusGui,s=t.audio,a=t.audioMuted,r=t.userSoundGui;return{curAvatar:t,curName:t.displayName,curAudio:s,curAudioMuted:a,curGui:i,curNameGui:t.userNameGui,curAudioGui:r,curVerse:t.verse}}setUserControlPosition(){var e=this;return GUIBase_asyncToGenerator((function*(){if(e.userControlBlock){var t=0;if(e.hudTopBar){var i=e.hudTopBar.getBoundingClientRect();t=i.y+i.height}e.userControlBlock.gui.style.top=t+"px"}}))()}buildUserSpeaker(){var e={},t=this.userControlBlock.speakerIcon.svg.cloneNode(!0);t.classList.add("userControlSpeakerStyle"),t.classList.add("userControlSpeakerButtonStyle"),e.gui=t,e.remoteMuted=!1,e.volPrev=0;for(var i=t.children,s=0;s<i.length;++s){var a=i[s],r=a.getAttribute("id");e[r]=a,"mute"==r?a.classList.add("userControlVisStyle"):"button"==r&&a.classList.add("userControlSpeakerButtonStyle")}for(var n=e.volLines.children,o=0;o<n.length;++o){var l=n[o];e[l.getAttribute("id")]=l}n=e.remoteMutedLines.children;for(var h=0;h<n.length;++h){var d=n[h];e[d.getAttribute("id")]=d}return e}addUserControls(e){var t=this;return GUIBase_asyncToGenerator((function*(){var{curAvatar:i,curName:s,curGui:a}=t.getUserControls(e),r=document.createElement("div");r.classList.add("userControlProximityOff"),r.classList.add("userControlParentStyle"),r.classList.add("userControlSpeakerButtonStyle"),t.mobile&&(r.style.display="none");var n=t;r.onclick=()=>{n.setUserControlMute(e)},i.userStatusGui=r,t.userControlBlock.gui.appendChild(r);var o=document.createElement("div");o.classList.add("userControlInnerParentStyle"),r.appendChild(o);var l=document.createElement("div");l.classList.add("userControlSpeakerParentStyle");var h=t.buildUserSpeaker();l.appendChild(h.gui),i.userSoundGui=h,o.appendChild(l);var d=document.createElement("div");d.classList.add("userControlNameStyle"),d.innerText=s,i.userNameGui=d,o.appendChild(d),t.setUserControlColor(e)}))()}setUserControlVolume(e,t){var i=arguments,s=this;return GUIBase_asyncToGenerator((function*(){var a=!(i.length>2&&void 0!==i[2])||i[2];if(s.userControlBlock.activeList.includes(e)){var{curAudioGui:r,curAudioMuted:n}=s.getUserControls(e);!r||n&&0!=t||(r.remoteMuted?t=0:a&&t>0&&(t*=2,t=Math.min(1,Math.max(t,.5*(t+r.volPrev)))),r.volPrev=t,r.volLines.style.opacity=t,r.volLines.style.filter="alpha(opacity="+100*t+")")}}))()}setUserControlMute(e){var t=this;return GUIBase_asyncToGenerator((function*(){var{curAvatar:i,curAudio:s,curAudioMuted:a,curAudioGui:r}=t.getUserControls(e);if(s){var n=!a;n?(t.setUserControlVolume(e,0,!1),r.mute.classList.add("userControlVisible"),s.volume=0,s.muted=!0):(r.mute.classList.remove("userControlVisible"),s.muted=!1,s.volume=1),i.audioMuted=n}}))()}setUserControlRemoteMute(e){var t=arguments,i=this;return GUIBase_asyncToGenerator((function*(){var s=t.length>1&&void 0!==t[1]?t[1]:null,a=!(t.length>2&&void 0!==t[2])||t[2],r=t.length>3&&void 0!==t[3]?t[3]:"#ffffff",{curAudio:n,curAudioGui:o}=i.getUserControls(e);if(o){null==s&&(s=!!n&&n.muted);var l="object"==typeof s?s.muted:s;o.remoteMuted=l,o.base.setAttribute("fill",l?"#ff0000":r),o.remoteMutedLines.style.display=l||!a?"inline-block":"none",o.remoteS1.setAttribute("stroke",a?"#ff0000":r),o.remoteS2.setAttribute("stroke",a?"#ff0000":r),i.setUserControlVolume(e,0,!1)}}))()}setUserControlVis(e){var t=arguments,i=this;return GUIBase_asyncToGenerator((function*(){var s=t.length>1&&void 0!==t[1]?t[1]:null,{curAvatar:a,curGui:r,curAudio:n}=i.getUserControls(e);if(r){var o="userControlProximityOff";if(null==s&&(s=!r.classList.contains(o)),s)r.classList.remove(o),r.style.maxWidth=r.children[0].getBoundingClientRect().width+"px",i.setUserControlVolume(e,0),i.userControlBlock.activeList.includes(e)||i.userControlBlock.activeList.push(e);else{r.classList.add(o),r.style.maxWidth="30px";var l=i.userControlBlock.activeList.indexOf(e);l>-1&&i.userControlBlock.activeList.splice(l,1)}i.userControlBlock.gui.style.padding=0==i.userControlBlock.activeList.length?"0px":"5px"}}))()}deleteUserControlVis(e){var t=this;return GUIBase_asyncToGenerator((function*(){var{curAvatar:i,curGui:s}=t.getUserControls(e);if(s){s.classList.add("userControlProximityOff"),s.style.maxWidth="30px";var a=t.userControlBlock.activeList.indexOf(e);a>-1&&t.userControlBlock.activeList.splice(a,1),t.userControlBlock.gui.style.padding=0==t.userControlBlock.activeList.length?"0px":"5px",s&&s.parentNode.removeChild(s)}}))()}userControlsSwap(e,t){var i=this.userControlBlock.activeList.indexOf(e);i>-1&&(this.userControlBlock.activeList.splice(i,1),this.userControlBlock.activeList.includes(t)||this.userControlBlock.activeList.push(t))}setUserControlColor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,{curAvatar:i,curGui:s,curAudioGui:a,curVerse:r}=this.getUserControls(e),n=!0;null==t&&(t="#ffffff");s.style.color=t,a.base.setAttribute("fill",t),a.mute.setAttribute("stroke",t),a.mid.setAttribute("fill",t),a.max.setAttribute("fill",t),a.volPrev=0,a.volLines.style.opacity=0,a.volLines.style.filter="alpha(opacity=0)";var o=this;i.userStatusGui.onclick=()=>{o.setUserControlMute(e)},this.setUserControlRemoteMute(e,null,n,t)}toggleUserControls(e){if(!e)return null}}class ShaderEditor{constructor(e,t){this.active=!1,this.isEditing=!1,this.name="GLSL Editor",this.type="shaderGui",this.pxlCore=e,this.pxlEnv=e.pxlEnv,this.guiManager=t,this.parent=null,this.gui=null,this.helpGui=null,this.shaderEditorDisplay=null,this.children={},this.uniformsObj=null,this.vertObj=null,this.fragObj=null,this.currentShader=null,this.shaderSliderValues=new x.Vector3,this.editorWidthMinMax={min:30,max:70}}addSlider(e,t,i,s,a,r,n,o){"string"==typeof e&&(e=document.getElementById(e));var l=document.createElement("div");l.style.display="grid",l.style.gridAutoFlow="column",l.style.alignItems="center",l.style.gridAutoColumns="max-content auto max-content",l.innerHTML="<div class='input_sliderLabel'>"+t+" : </div>";var h=document.createElement("input");h.type="range",h.classList.add("input_sliderRange"),h.min=s,h.max=a,h.step=r,h.value=i,l.appendChild(h);var d=document.createElement("input");d.type="number",d.classList.add("gui_defaultInput"),d.classList.add("input_numberInput"),d.value=i,l.appendChild(d),d.onchange=e=>{h.value=e.target.value},h.onchange=e=>{d.value=e.target.value,n(e.target.value,...o)},h.oninput=e=>{d.value=e.target.value,n(e.target.value,...o)},e.appendChild(l)}updateShaderTextFields(){var e,t,i,s,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;a||(a=this.pxlEnv.currentRoom==this.pxlEnv.mainRoom?this.currentShader:this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].getCurrentShader());try{e=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].readShader(a,this.shaderSliderValues)}catch(e){return}t=i=s="Unable To Load";try{for(var r in e.uniforms.sliders={type:"v",value:this.shaderSliderValues},t=JSON.stringify(e.uniforms),i=e.vertexShader,s=e.fragmentShader,t="",e.uniforms){var n="float",o={t:"sampler2D",b:"bool",i:"int",f:"float",v:"vec",c:"vec"};if("object"==(n=typeof e.uniforms[r].value)){if(n="",!e.uniforms[r].value)continue;n="image"in e.uniforms[r].value?"sampler2D":n+"vec"+Object.keys(e.uniforms[r].value).length}else o.hasOwnProperty(e.uniforms[r].type)&&(n="i"==e.uniforms[r].type?"i":""),o.hasOwnProperty(e.uniforms[r].type)&&(n=o[e.uniforms[r].type]);t+="uniform ".concat(n," ").concat(r,";   ")}i=i.replace(/[\t]/g,"  "),s=s.replace(/[\t]/g,"  ")}catch(e){console.log("Error Reading Shader"),console.log(e)}e&&(e.needsUpdate=!0,this.children.uniformsObj.value=t,this.children.vertObj.value=i,this.children.fragObj.value=s)}buildShaderEditor(){var e="shaderGui",t=document.createElement("div");t.id="guiShaderEditorBlock",t.classList.add("gui_shaderEditorBlockStyle"),t.style.transition="max-width .5s ease, opacity .8s, filter .8s",this.pxlEnv.pxlGuiDraws.prepPromptFader(t),this.pxlEnv.pxlGuiDraws.guiWindows[e]={},this.pxlEnv.pxlGuiDraws.guiWindows[e].gui=t,this.pxlEnv.pxlGuiDraws.guiWindows[e].active=!1,this.gui=t;var i=document.createElement("div");i.id="guiShaderHelpBlock",i.classList.add("gui_shaderHelpBlockStyle"),i.style.transition="left .3s ease, opacity .8s, filter .8s",this.pxlEnv.pxlGuiDraws.prepPromptFader(i),this.pxlEnv.pxlGuiDraws.guiWindows[e].help=i,this.helpGui=i;var s=this.pxlEnv.currentRoom,a=this.pxlEnv.roomSceneList[s].geoList,r=Object.keys(a),n="";r.forEach((e=>{if(["Mesh","Points"].includes(a[e].type)&&"ShaderMaterial"==a[e].material.type){var t=e.substring(0,1).toUpperCase()+e.substring(1,e.length);n+="<option value='geo_"+e+"'>"+t+"</option>"}}));this.pxlEnv.pxlGuiDraws.guiWindows[e].currentShader="script_fog";var o='\n    <div id="gui_shaderEditorParent" class="gui_shaderEditorParentStyle">\n      <div id="gui_shaderEditorHeaderBlock" class="gui_shaderEditorHeaderBlock">\n      <div class="gui_shaderEditorOptionBlock">\n        <div class="gui_shaderEditorTitleBlock">\n        <div id="gui_shaderEditorTitleParent" class="gui_shaderEditorTitleParentStyle">\n            <div id="gui_shaderEditorTitle" clsss="gui_shaderEditorTitleStyle">GLSL Shader Editor</div>\n            <div id="gui_shaderEditorHeaderList" clsss="gui_shaderEditorHeaderListStyle">\n              <span id="gui_shaderEditorPulldownHeader" clsss="gui_shaderEditorPulldownHeaderStyle">Edit Shader</span>\n              <select name="shaderEditor_loadShader" id="shaderEditor_loadShader" class="pickerStyle gui_shaderPickerStyle">\n                <option value="script_avatar" '.concat("",'>Avatar</option>\n                <option value="script_fog" ').concat("selected",'>Fog</option>\n                <option value="script_dArrows">Direction Arrows</option>\n                <option value="script_userScreens">User Screens</option>\n                <option value="script_warpZonePortals">Warp Zone Portals</option>\n                <option value="script_lizardking">Item; Lizard King</option>\n                <option value="script_majorTom">Item; Major Tom</option>\n                <option value="script_fractalSubstrate">Item; Fractal Substrate</option>\n                <option value="script_fractalEcho">Item; Fractal Echo Pass</option>\n                ').concat(n,'\n              </select>\n            </div>\n            <div id="gui_shaderEditorFontSize" clsss="gui_shaderEditorFontSizeStyle">\n              <span  style="font-size:.75em;margin-right:5px;">Font Size</span>\n              <span id="gui_shaderEditorFontSmaller" class="shaderEditor_settingsButton">-</span>\n              <span id="gui_shaderEditorFontLarger" class="shaderEditor_settingsButton">+</span>\n              <span class="gui_shaderEditorOptionBarSpacer"> </span>\n              <span id="gui_shaderEditorCloseButton" class="shaderEditor_settingsButton">X</span>\n            </div>\n          </div>\n        </div>\n        <div class="gui_shaderEditorHeaderLine"></div>\n        <div id="guiShaderUserSliders"></div>\n        <div class="gui_shaderEditorHeaderLine"></div>\n      </div>\n      </div>\n      \n      \n      <div id="guiShaderFieldParent" class="gui_shaderEditorFieldParentStyle">\n        <span style=\'height:12px\'>Uniforms -</span>\n        <textarea spellcheck="false" placeholder="Shader Uniforms" rows="3" id="shaderEditor_uniformInput" style="height:unset;" readonly></textarea>\n        <span style=\'height:12px\'>Vertex Shader -</span>\n        <textarea spellcheck="false" placeholder="Vertex Shader" id="shaderEditor_vertInput"></textarea>\n        <span style=\'height:12px\'>Fragment Shader -</span>\n        <textarea spellcheck="false" placeholder="Fragment Shader" id="shaderEditor_fragInput"></textarea>\n      </div>\n      <div id="shader_updateShader" class="shaderEditor_sendMessage">Update Shader</div>\n    </div>\n    '),l="<div class='gui_shaderHelpSpacerStyle'></div>";o+='\n    <div id="gui_shaderHelpBlock" class="gui_shaderHelpBlockStyle">\n      <div class="gui_shaderHelpTitle">:: Keyboard Shortcuts ::</div>\n      '.concat(l,'\n      <span><span class="gui_boldText">Ctrl + Enter</span><br> - Update Shader on Material</span>\n      <br>&nbsp;&nbsp;<span>Returns use existing indent type (Spaces or Tabs)</span>\n      ').concat(l,'\n      <span><span class="gui_boldText">Ctrl + D</span><br> - Duplicate current line</span>\n      ').concat(l,'\n      <span><span class="gui_boldText">Ctrl + K</span><br> - Comment current/selected lines</span>\n      ').concat(l,'\n      <span><span class="gui_boldText">Ctrl + Shift + K</span><br> - Uncomment current/selected lines</span>\n      ').concat(l,"\n      <span><span class=\"gui_boldText\">Ctrl + NumPad {1,2,3}</span><br> - Add selection or '.0' into float(), vec2(), vec3() </span>\n      ").concat(l,'\n      <span><span class="gui_boldText">Ctrl + {Up,Down,Left,Right}</span><br> - Searches for current selection in direction</span>\n      ').concat(l,'\n      <span><span class="gui_boldText">Y</span><br> - To opn/close the Shader Editor</span>\n      ').concat(l,"\n    </div>\n    "),t.innerHTML=o,document.body.appendChild(t);var h=document.getElementById("guiShaderUserSliders");this.parentObj=h;var d=this.shaderSliderValues,c=function sliderSetShader(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];d[i[0]]=e};this.addSlider(h,"sliders.x",0,-1,1,1e-4,c,["x"]),this.addSlider(h,"sliders.y",0,-5,5,.001,c,["y"]),this.addSlider(h,"sliders.z",0,-10,10,.001,c,["z"]),this.children.shaderSliders=h,this.children.shaderParentObj=document.getElementById("shaderEditor_uniformInput").parentNode,this.children.shaderEditor=document.getElementById("gui_shaderEditorParent"),this.children.headerBar=document.getElementById("gui_shaderEditorHeaderBlock"),this.children.titleParentObj=document.getElementById("gui_shaderEditorTitleParent"),this.children.titleObj=document.getElementById("gui_shaderEditorTitle"),this.children.pulldownHeaderObj=document.getElementById("gui_shaderEditorPulldownHeader"),this.children.uniformsObj=document.getElementById("shaderEditor_uniformInput"),this.children.vertObj=document.getElementById("shaderEditor_vertInput"),this.children.fragObj=document.getElementById("shaderEditor_fragInput"),this.children.updateObj=document.getElementById("shader_updateShader"),this.children.helpDiv=document.getElementById("gui_shaderHelpBlock"),this.children.shaderList=document.getElementById("gui_shaderEditorHeaderList"),this.children.shaderFieldParent=document.getElementById("guiShaderFieldParent"),this.shaderEditorDisplay=document.getElementById("shaderEditorDisplay"),this.children.shaderSelect=document.getElementById("shaderEditor_loadShader");var u=document.getElementById("gui_shaderEditorFontSize");u.style.justifySelf="end",u.style.marginTop="2px",u.style.marginRight="3px",u.style.userSelect="none",u.style.display="flex",u.style.alignItems="center";var p=this;this.children.shaderSelect.onchange=e=>{p.updateShaderTextFields(this.children.shaderSelect.value)},document.getElementById("gui_shaderEditorFontSmaller").onclick=e=>{p.shiftFontSize(-.15)},document.getElementById("gui_shaderEditorFontLarger").onclick=e=>{p.shiftFontSize(.15)},document.getElementById("gui_shaderEditorCloseButton").onclick=e=>{p.toggleShaderEditor()},this.children.updateObj.addEventListener("click",(()=>{this.isEditing=!1;var e=document.getElementById("shaderEditor_uniformInput").value,t=document.getElementById("shaderEditor_vertInput"),i=t.value,s=document.getElementById("shaderEditor_fragInput"),a=s.value,r=document.createElement("div");r.innerHTML=e,e=r.innerText,r.innerHTML=i,i=r.innerText,r.innerHTML=a,a=r.innerText,p.pxlEnv.roomSceneList[p.pxlEnv.currentRoom].setShader(e,i,a),t.blur(),s.blur(),p.guiManager.pxlNavCanvas.focus()})),this.children.vertObj.onfocus=e=>{p.focusShaderMessage(e,"vertObj")},this.children.vertObj.onkeydown=e=>{p.keyShaderMessage(e)},this.children.vertObj.onmousedown=e=>{p.mDownShaderMessage(e)},this.children.vertObj.onclick=e=>{p.clickShaderMessage(e)},this.children.vertObj.ondblclick=e=>{p.dblclickShaderMessage(e)},this.children.fragObj.onfocus=e=>{p.focusShaderMessage(e,"fragObj")},this.children.fragObj.onkeydown=e=>{p.keyShaderMessage(e)},this.children.fragObj.onmousedown=e=>{p.mDownShaderMessage(e)},this.children.fragObj.onclick=e=>{p.clickShaderMessage(e)},this.children.fragObj.ondblclick=e=>{p.dblclickShaderMessage(e)},this.mouseX=0,this.mouseY=0,this.prevSelectStart=0,this.prevSelectEnd=0}shiftFontSize(e){var t=document.getElementById("gui_shaderEditorParent");if(t){t.hasAttribute("styleStore")||t.setAttribute("styleStore",1);var i=parseFloat(t.getAttribute("styleStore"))+e;t.setAttribute("styleStore",i),t.style.fontSize=i+"em";var s=document.getElementById("shaderEditor_uniformInput");s&&(s.style.fontSize=i+"em");var a=document.getElementById("shaderEditor_vertInput");a&&(a.style.fontSize=i+"em");var r=document.getElementById("shaderEditor_fragInput");r&&(r.style.fontSize=i+"em"),setTimeout((()=>{this.resizeShaderElements()}),130)}}updateHeaderBar(){this.isEditing?(this.children.titleParentObj.style.fontSize="2.05em",this.children.titleObj.style.fontSize="1.15em"):(this.children.titleParentObj.style.fontSize="1.3em",this.children.titleObj.style.fontSize="1em")}mDownShaderMessage(e){this.mouseX=e.x,this.mouseY=e.y}clickShaderMessage(e){if(!this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.dcActive){var t=Math.abs(this.mouseX-e.x),i=Math.abs(this.mouseY-e.y);if(Math.max(t,i)<5){var s=e.target,a=s.selectionStart,r=s.selectionEnd;parseInt(.5*(a+r));a!=r&&(this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.prevSelectStart=a,this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.prevSelectEnd=r)}}}dblclickShaderMessage(e){var t=this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.prevSelectStart,i=this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.prevSelectEnd,s=e.target,a=(s.selectionStart,s.selectionEnd,s.value.substring(t,i+20)),r=a.match(/[a-zA-Z0-9\.\_\[\]]+/);r&&!a[0].match(/\n/)&&(i=t+r[0].length),s.setSelectionRange(t,i),this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.dcActive=!0,setTimeout((()=>{this.pxlEnv.pxlGuiDraws.guiWindows.shaderGui.dcActive=!1}),500)}keyShaderMessage(e){if(e.repeat)return!1;var t=e.key,i=e.code,s=e.shiftKey,a=e.ctrlKey,r=(e.altKey,i.includes("Numpad"));if(!("Enter"==t||"Tab"==t||"KeyD"==i&&a||"KeyK"==i&&a||r&&a||i.includes("Arrow")&&a))return!1;e.preventDefault();var n=e.target;if("NumpadAdd"==i){var o=window.getComputedStyle(n),l=parseFloat(o.fontSize)+2;return n.style.fontSize=l,!1}if("NumpadSubtract"==i){var h=window.getComputedStyle(n),d=parseFloat(h.fontSize)-2;return n.style.fontSize=d,!1}var c=n.selectionStart,u=n.selectionEnd,p=n.value;if(i.includes("Arrow")){if(c==u)return!1;var m,v,g,f=p.substring(c,u);if("ArrowUp"==i?(v=p.substring(0,c),c=v.search(/.*$/),i="ArrowLeft"):"ArrowDown"==i&&(v=p.substring(u,p.length),u=v.search(/\n/)+u,i="ArrowRight"),"ArrowLeft"==i){m=new RegExp(f+".*","gm");var x=[...(v=p.substring(0,c)).matchAll(f,"g")];if(0==x.length&&0==(x=[...p.matchAll(f,"g")]).length)return!1;g=x.pop().index}if("ArrowRight"==i){m=new RegExp(f,"m"),v=p.substring(u,p.length);var y=m.exec(v);if(y)g=y.index+u;else{if(!(y=m.exec(p)))return!1;g=y.index}}if(g>-1){var b=g+f.length;n.setSelectionRange(g,b);var C=n.getBoundingClientRect(),P=window.getComputedStyle(n).font,S=[p.slice(0,g),"<span id='tmpShaderPosition'>.</span>",p.slice(g)].join("");S=S.replace(/(?:\r\n|\r|\n)/g,"<br>");var w=document.createElement("div");w.style.position="fixed",w.style.width=C.width,w.style.height=C.height,w.style.overflowY="scroll",w.style.font=P,w.innerHTML=S,document.body.appendChild(w);var E=w.querySelector("#tmpShaderPosition").offsetTop-200;document.body.removeChild(w),n.scrollTo(0,E)}return!1}if("Enter"==t&&a)return this.children.updateObj.click(),n.focus(),n.setSelectionRange(c,u),!1;if(r){var D=p.substring(c,u),M=D.length>0,L=p.substr(c-1,1);L=/[\w|\d]/.test(L)&&0==D.length?" ":"";var T=p.substr(u+1,1);T=/[\w|\d]/.test(T)&&0==D.length?" ":"";var A=c+L.length;if("Numpad1"==i){var k="float(";A+=6,D=k+(D=M?D:".0")+")"}else if("Numpad2"==i){var R="vec2(";A+=5,D=R+(D=M?D:".0, .0")+")"}else if("Numpad3"==i){var _="vec3(";A+=5,D=_+(D=M?D:".0, .0, .0")+")"}return D=L+D+T,document.execCommand("insertText",!1,D),M||n.setSelectionRange(A,A),!1}var O=Math.min(c,u),I=p.substr(0,O);if("KeyK"==i){var B,G,j,U=!1;if(c!=u&&(B=I.search(/.*$/),G=u,j=p.substring(B,u),U=/\n/.test(j)),!U){var V=I.search(/[\S\w].*$/);if(-1==V){if(-1==(V=p.substring(O,p.length).search(/(?:[^\s])/)))return!1;V+=O}var F=V,H=F,N="";if(s){if(H+=2,"//"!=p.substr(F,2))return!1;c-=2,u-=2}else{if("//"==p.substr(F,2))return!1;N="//",c+=2,u+=2}return n.setSelectionRange(F,H),document.execCommand("insertText",!1,N),n.setSelectionRange(c,u),!1}if(U){var W=G+p.substring(G,p.length).search(/\n./),z=p.substring(B,W),K=s?-2:2,Q=[...z.matchAll(/[\S\w].*/g)],Y=[],X=c-B,q=G-B;return Q.forEach((e=>{var t=e.index;Y.push(t)})),(Y=Y.reverse()).forEach((e=>{var t=z.substr(e,2);if(s){if("//"!=t)return;z=z.substring(0,e)+z.substring(e+2,z.length)}else{if("//"==t)return;z=z.substring(0,e)+"//"+z.substring(e,z.length)}c+=e<X?K:0,u+=e<q?K:0})),n.setSelectionRange(B,W),document.execCommand("insertText",!1,z),n.setSelectionRange(c,u),!1}return!1}var J=I.split("\n");if("Enter"==t||"Tab"==t){var Z=J.pop();0==Z.length&&(Z=J.pop());var $=Z.replace(/[\S\w].*$/g,""),ee=$="Tab"==t?" "===($=0==$.length?" ":$.substr(0,1))?"  ":"\t":"\n"+$,te=c,ie=u;if("Tab"==t&&c!=u){var se=p.substring(c,u);se=se.split("\n"),ie=te+(ee=(se=s?se.map((e=>""==e?e:e.replace($,""))):se.map((e=>""==e?e:$+e))).join("\n")).length}else ie=te+=ee.length;return document.execCommand("insertText",!1,ee),n.setSelectionRange(te,ie),!1}if("KeyD"==i&&a)if(c==u){var ae=p.split("\n");J.pop();var re=ae[J.length],ne=[...J,re].join("\n").length;re="\n"+re,n.setSelectionRange(ne,ne),document.execCommand("insertText",!1,re),ne=O+re.length,n.setSelectionRange(ne,ne)}else{var oe=p.substring(c,u);n.setSelectionRange(u,u),document.execCommand("insertText",!1,oe),u+=oe.length,n.setSelectionRange(u,u)}return!1}updateShaderList(){var e=this.children.shaderSelect;if(!e)return console.log("No pulldown"),void console.log(this.gui);var t=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].getShaderList(),i=Object.keys(t),s="",a=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].getCurrentShader();i.forEach((e=>{var i=e==a?" selected":"";s+='<option value="'.concat(e,'" ').concat(i,">").concat(t[e],"</option>")})),e.innerHTML=s}resize(e){this.resizeShaderElements()}resizeShaderElements(){var e=0;if(this.hudBottomBar&&(e=this.hudBottomBar.offsetHeight),this.children.headerBar&&(e+=this.children.headerBar.offsetHeight),this.gui){this.gui.style.height=this.guiManager.sH-e;var t=this.children.vertObj.getBoundingClientRect().top,i=this.children.updateObj.getBoundingClientRect().height;i+=40;var s=this.guiManager.sH-i-t;this.children.vertObj.style.maxHeight=.4*s+"px",this.children.vertObj.displayHeight=.4*s,this.children.fragObj.style.maxHeight=.6*s+"px",this.children.fragObj.displayHeight=.6*s,this.children.fieldBodyHeight=s}}toggleShaderEditor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.gui||this.buildShaderEditor(),this.updateShaderList(),this.updateShaderTextFields(this.children.shaderSelect.value),e=null==e?!this.active:e,this.active=e,this.guiManager.promptFader(this.gui,e),this.guiManager.promptFader(this.helpGui,e),this.pxlEnv.emit("shaderEditorVis",e),e?this.guiManager.pxlNavCanvas.addEventListener("mousedown",this.blurShaderEditor.bind(this)):this.guiManager.pxlNavCanvas.removeEventListener("mousedown",this.blurShaderEditor.bind(this)),setTimeout((()=>{this.resizeShaderElements()}),130)}blurShaderEditor(){this.isEditing=!1,document.activeElement.blur(),document.getElementById("guiShaderEditorBlock").style.maxWidth=this.editorWidthMinMax.min+"vw";var e=document.getElementById("gui_shaderHelpBlock");e&&(e.style.left="max("+this.editorWidthMinMax.min+"vw, 430px)");var t=document.getElementById("shaderEditor_loadShader");t&&(t.style.maxWidth="85px"),this.updateHeaderBar(),setTimeout((()=>{this.resizeShaderElements()}),130)}focusShaderMessage(e,t){var i;this.isEditing=!0;var s=this.children,a=s.vertObj.displayHeight,r=s.fragObj.displayHeight,n=Math.max(150,.135*this.guiManager.sH),o=s.fieldBodyHeight-n;a="vertObj"==t?o:n,r="fragObj"==t?o:n,s.vertObj.style.maxHeight=a+"px",s.fragObj.style.maxHeight=r+"px";document.getElementById("gui_shaderEditorParent");this.gui.style.maxWidth=this.editorWidthMinMax.max+"vw",null!==(i=this.children)&&void 0!==i&&i.shaderSelect&&(this.children.shaderSelect.style.maxWidth="225px");var l=document.getElementById("gui_shaderHelpBlock");l&&(l.style.left=this.editorWidthMinMax.max+"vw"),this.updateHeaderBar()}}var R=__webpack_require__(312);function Video_asyncGeneratorStep(e,t,i,s,a,r,n){try{var o=e[r](n),l=o.value}catch(e){return void i(e)}o.done?t(l):Promise.resolve(l).then(s,a)}function Video_asyncToGenerator(e){return function(){var t=this,i=arguments;return new Promise((function(s,a){var r=e.apply(t,i);function _next(e){Video_asyncGeneratorStep(r,s,a,_next,_throw,"next",e)}function _throw(e){Video_asyncGeneratorStep(r,s,a,_next,_throw,"throw",e)}_next(void 0)}))}}var _={Utils:class Utils{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"images/assets/",t=arguments.length>1?arguments[1]:void 0;this.assetRoot=e,this.mobile=t,this.pxlTimer=null,this.verboseLoading=!1,this.texLoader=new x.ImageLoader,this.textLoaderArray=[],this.channelFormats=[x.AlphaFormat,x.RedFormat,x.RGFormat,x.RGBFormat,x.RGBAFormat,x.LuminanceFormat,x.DepthFormat]}get curMS(){return this.pxlTimer.curMS}setDependencies(pxlNav){this.pxlTimer=pxlNav.pxlTimer}updateUrl(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";window.history.replaceState?window.history.replaceState(t,i,e):window.history.pushState(t,i,e)}copyRoomUrl(){var e=window.location,t=document.activeElement,i=document.createElement("textarea");i.value=e,document.body.appendChild(i),i.focus(),i.select();var s=!1;try{s=document.execCommand("copy")?"successful":"unsuccessful"}catch(e){}return document.body.removeChild(i),t.focus(),s}checkInt(e){return e%1==0}degToRad(e){return e*(Math.PI/180)}toHundreths(e){if(!e)return 0;if(Number.isInteger(e))return e;var t=(e+"").split(".");return parseFloat(t[0]+"."+t[1].substr(0,2))}toTenths(e){if(!e)return 0;if(Number.isInteger(e))return e;var t=(e+"").split(".");return parseFloat(t[0]+"."+t[1].substr(0,1))}getDateTime(){var e=new Date;return[(e.getFullYear()+"").padStart(2,"0")+"-"+(e.getMonth()+1+"").padStart(2,"0")+"-"+(e.getDate()+"").padStart(2,"0"),(e.getHours()+"").padStart(2,"0")+":"+(e.getMinutes()+"").padStart(2,"0")+":"+(e.getSeconds()+"").padStart(2,"0")]}cleanStrict(e){var t=document.createElement("div");t.innerHTML=e;var i=(t=t.innerText).match(/([a-zA-Z0-9])\w+/g);return i&&(t=i.join(" ")),t}cleanBasic(e){var t=document.createElement("div");t.innerHTML=e;var i=(t=t.innerText).match(/([a-zA-Z0-9\s\w-+()\[\]])+/g);return i&&(t=i.join("")),t}cleanString(e){var t=document.createElement("div");return t.innerHTML=e,t=t.innerText}toNearestStr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return e.toFixed(t)}arrayToStr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=[];return e.forEach((e=>{i.push(this.toNearestStr(e,t))})),i}flattenArrayToStr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:",";return this.arrayToStr(e,t).join(i)}randomFloat(e,t){return Math.random()*(t-e)+e}screenToNDC(e,t,i,s){var a=e/i*2-1,r=-t/s*2+1;return new x.Vector2(a,r)}componentToHex(e){return e.toString(16).padStart(2,"0")}rgbToHex(e,t,i){return"#"+this.componentToHex(Math.min(255,Math.max(0,Math.round(e))))+this.componentToHex(Math.min(255,Math.max(0,Math.round(t))))+this.componentToHex(Math.min(255,Math.max(0,Math.round(i))))}hexToRgb(e){var t,i,s;return 3==(e="#"==e[0]?e.substr(1,6):e.substr(0,6)).length?(t=e[0]+e[0],i=e[1]+e[1],s=e[2]+e[2]):(t=e[0]+e[1],i=e[2]+e[3],s=e[4]+e[5]),[t=parseInt(t,16),i=parseInt(i,16),s=parseInt(s,16)]}stringToRgb(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=[255,0,0];if(e){for(var a=e.length,r="",n=0;n<a;++n)r+=e[a-1-n].charCodeAt(0).toString(16);var o=r.length;if(o>6){var l=1;"tussin"==e?l=0:"fexofenadine"==e&&(l=-1);var h=Math.max(0,parseInt((o-6)/2+l));r=r.substr(h,6)}s=this.hexToRgb(r)}if(null!=t){var d=Math.max(...s),c=Math.min(...s),u=d*t;s[0]=parseInt(Math.min(255,(s[0]-c)/(d-c)*255+u)),s[1]=parseInt(Math.min(255,(s[1]-c)/(d-c)*255+u)),s[2]=parseInt(Math.min(255,(s[2]-c)/(d-c)*255+u))}return 1==i&&(s[0]=s[0]/255,s[1]=s[1]/255,s[2]=s[2]/255),s}colorTosRGB(e){return"object"==typeof e?(e.hasOwnProperty&&e.hasOwnProperty("r")&&(e.r=this.tosRGB(e.r),e.g=this.tosRGB(e.g),e.b=this.tosRGB(e.b)),e.hasOwnProperty&&e.hasOwnProperty("x")&&(e.x=this.tosRGB(e.x),e.y=this.tosRGB(e.y),e.z=this.tosRGB(e.z)),e):e}tosRGB(e){return e<=.0031308?e*=12.92:e=1.055*Math.pow(e,this.oneTwoPFour)-.055,e}colorToLinear(e){return"object"==typeof e?(e.hasOwnProperty&&e.hasOwnProperty("r")&&(e.r=this.toLinear(e.r),e.g=this.toLinear(e.g),e.b=this.toLinear(e.b)),e.hasOwnProperty&&e.hasOwnProperty("x")&&(e.x=this.toLinear(e.x),e.y=this.toLinear(e.y),e.z=this.toLinear(e.z)),e):e}toLinear(e){return e<=.04045?e*=this.twelvePNineTwoDiv:e=Math.pow((e+.055)*this.onePOFiveFiveDiv,2.4),e}gammaCorrectColor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"2.2",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"1.8";return"object"==typeof e?(e.hasOwnProperty&&e.hasOwnProperty("r")&&(e.r=this.gammaCorrect(e.r,t,i),e.g=this.gammaCorrect(e.g,t,i),e.b=this.gammaCorrect(e.b,t,i)),e.hasOwnProperty&&e.hasOwnProperty("x")&&(e.x=this.gammaCorrect(e.x,t,i),e.y=this.gammaCorrect(e.y,t,i),e.z=this.gammaCorrect(e.z,t,i)),e):e}gammaCorrection(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"2.2",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"1.8",s=Math.pow(e,t);return Math.pow(s,1/i)}convertColor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:COLOR_SHIFT.KEEP;if(t==COLOR_SHIFT.KEEP)return e;var i=e.clone();switch(t){case COLOR_SHIFT.sRGB_TO_LINEAR:i=this.colorTosRGB(i);break;case COLOR_SHIFT.LINEAR_TO_sRGB:i=this.colorToLinear(i);break;case COLOR_SHIFT.WINDOWS_TO_UNIX:i=this.gammaCorrectColor(i,"2.2","1.8");break;case COLOR_SHIFT.UNIX_TO_WINDOWS:i=this.gammaCorrectColor(i,"1.8","2.2");break;case COLOR_SHIFT.LINEAR_TO_WINDOWS:i=this.gammaCorrectColor(i,"1.0","2.2");break;case COLOR_SHIFT.WINDOWS_TO_LINEAR:i=this.gammaCorrectColor(i,"2.2","1.0");break;case COLOR_SHIFT.LINEAR_TO_UNIX:i=this.gammaCorrectColor(i,"1.0","1.8");break;case COLOR_SHIFT.UNIX_TO_LINEAR:i=this.gammaCorrectColor(i,"1.8","1.0")}return i}randomizeArray(e){for(var t=[...e],i=[];t.length>0;){var s=1==t.length?0:parseInt(21*Math.random()*t.length)%t.length;i.push(t.splice(s,1)[0])}return i}getRandom(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1.14;return e[Math.floor(Math.random(t)*e.length)]}applyTransformList(e,t){var i=t.r;e.rotateX(i[0]),e.rotateY(i[1]),e.rotateZ(i[2]),void 0!==t.rOrder&&(e.rotation.order=t.rOrder);var s=t.t;e.position.set(s[0],s[1],s[2]);var a=t.s;e.scale.set(a[0],a[1],a[2]),e.matrixAutoUpdate=!1,e.updateMatrix()}vec2(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new x.Vector2(e,t)}vec3(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return new x.Vector3(e,t,i)}loadTexture(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e.includes("/")||(e=this.assetRoot+e),void 0!==this.textLoaderArray[e])s=this.textLoaderArray[e];else{var s=new x.Texture,a=Object.keys(i);this.texLoader.load(e,(e=>{null!=t&&(s.format=this.channelFormats[t]),s.image=e,s.needsUpdate=!0,a.length>0&&a.forEach((e=>{s[e]=i[e]}))}),void 0,(t=>{console.error(" TextureLoader :: Error loading texture :: "+e),console.error(t)})),this.textLoaderArray[e]=s}return s}getVideoTexture(e){var t=new x.VideoTexture(e);return t.minFilter=x.LinearFilter,t.magFilter=x.LinearFilter,t.format=x.RGBFormat,t}getCanvasTexture(e){var t=new x.CanvasTexture(e);return{texture:t,material:new x.MeshBasicMaterial({map:t})}}},FileIO,QualityController:class QualityController{constructor(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.pxlTimer=null,this.pxlCookie=null,this.pxlDevice=null,this.pxlEnv=null,this.msLog=0,this.prevMS=.001*(new Date).getTime(),this.autoQuality=!1,this.percent=1,this.verbose=e,this.screenResPerc=1,this.mBlurPercMult=t?.65:1,this.bloomPercMult=t?.65:1,this.bufferPercMult=1,this.renderTargetScale=10,this.percentSteps=[.3,.45,.85],this.fpsCounter=new x.Vector3(30,0,.001*(new Date).getTime()),this.countAtLevel=0,this.shiftRate=.01,this.moduleQualityList=[],this.qualityStep=-1,this.qualityMaxSteps=3,this.qualityStepValues=[.25,.5,.75,1],this.benchmarkStart=-1,this.benchmarkTime=-1,this.benchmarkRating=-1,this.benchmarkTimes=[9,17],this.setFromBenchmark=!0,this.benchmarkQuality=1,this.benchmarkQualityRange=[.25,1],this.settingsQualityChoice=null,this.detailLimitOverride=Object.keys(i).includes("dlimit")?i.dlimit:0,this.detailLimit=null!=this.detailLimitOverride?this.detailLimitOverride:0,this.settings={leftRight:!0,mouse:!0,graphics:2,resolution:1,fog:2,bloom:!0,motion:!1},this.settingsLow={resolution:.5,fog:0,bloom:!1,motion:!1},this.settingsMedium={resolution:.75,fog:1,bloom:!0,motion:!1},this.settingsHigh={resolution:1,fog:2,bloom:!0,motion:!1},this.settingsCustom=null}setDependencies(pxlNav){this.pxlTimer=pxlNav.pxlTimer,this.pxlCookie=pxlNav.pxlCookie,this.pxlDevice=pxlNav.pxlDevice,this.pxlEnv=pxlNav.pxlEnv}init(){null!=this.detailLimitOverride?this.detailLimit=this.detailLimitOverride:this.pxlCookie.hasCookie("detailLimit")&&(this.detailLimit=this.pxlCookie.parseCookie("detailLimit")),this.verbose>=b.INFO&&console.log("Graphics Limiting is set to level ",this.detailLimit),this.setFromBenchmark=!this.pxlCookie.parseDict(this.settings),this.pxlCookie.hasCookie("leftRight")&&(this.settings.leftRight=this.pxlCookie.parseCookie("leftRight")),this.pxlCookie.hasCookie("mouse")&&(this.settings.mouse=this.pxlCookie.parseCookie("mouse"));Object.keys(this.settingsHigh);if(this.pxlCookie.hasCookie("qualitySetting")){var e=this.pxlCookie.parseCookie("qualitySetting");this.settings.graphics=e,this.settingsQualityChoice=e}}step(){this.mapFpsQualitCheck()}attachModule(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&this.moduleQualityList.push(e)}startBenchmark(){this.pxlTimer.step(),this.benchmarkStart=this.pxlTimer.curMS}endBenchmark(){this.pxlTimer.step();var e=this.pxlTimer.curMS-this.benchmarkStart;this.benchmarkTime=e,this.benchmarkRating=1-Math.min(1,Math.max(0,(e-this.benchmarkTimes[0])/(this.benchmarkTimes[1]-this.benchmarkTimes[0]))),this.benchmarkQuality=this.benchmarkRating*(this.benchmarkQualityRange[1]-this.benchmarkQualityRange[0])+this.benchmarkQualityRange[0];var t=Math.min(1,Math.max(0,this.benchmarkRating));if(t=Math.ceil(Math.max(.05,t)*this.qualityMaxSteps)-1,this.qualityStep=t,this.setFromBenchmark){this.qualityStep;this.setQualityLevel(this.qualityStep)}else{null==this.settingsQualityChoice&&(this.settingsQualityChoice=3),this.settingsCustom={},Object.keys(this.settingsHigh).forEach((e=>{this.settingsCustom[e]=this.settings[e]}))}this.setDependentSettings()}mapFpsQualitCheck(){if(this.pxlTimer.curMS-this.fpsCounter.z>1){this.fpsCounter.x=this.fpsCounter.y,this.fpsCounter.y=0,this.fpsCounter.z=this.pxlTimer.curMS;var e=1;this.fpsCounter.x<15&&(e=-1);var t=Math.min(1,Math.max(0,this.percent+this.shiftRate*e));this.autoQuality&&this.mapAutoQualityUpdate(t,!1)}this.fpsCounter.y+=1,this.pxlTimer.prevMS=this.pxlTimer.curMS}mapAutoQualityUpdate(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=Math.min(1,Math.max(0,e));t=Math.ceil(Math.max(.05,t)*this.qualityMaxSteps)-1,this.qualityStep=t}setGraphicsSettings(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(null==e)if(0==this.qualityStep)e=this.settingsLow;else if(1==this.qualityStep)e=this.settingsMedium;else{if(2!=this.qualityStep)return;e=this.settingsHigh}3==t&&this.checkCustomDict(),Object.keys(e).forEach((i=>{this.setComponentQuality(i,e[i]),this.settings[i]=e[i],3==t&&(this.settingsCustom[i]=e[i])})),this.setDependentSettings(),this.colliderPrevObjHit=null,null!=t&&(this.settings.graphics=t)}reapplySettings(){Object.keys(this.settingsLow).forEach((e=>{this.setComponentQuality(e,this.settings[e],!1)})),this.setDependentSettings()}setQualityLevel(e){this.pxlDevice.mobile&&(e=1),this.setQualityCookie(e),0==e?this.setLowQuality():1==e?this.setMediumQuality():2==e?this.setHighQuality():3==e&&this.setCustomQuality()}setLowQuality(){this.settingsQualityChoice=0,this.setGraphicsSettings(this.settingsLow,0)}setMediumQuality(){this.settingsQualityChoice=1,this.setGraphicsSettings(this.settingsMedium,1)}setHighQuality(){this.settingsQualityChoice=2,this.setGraphicsSettings(this.settingsHigh,2)}setCustomQuality(){this.checkCustomDict(),this.settingsQualityChoice=3,this.setGraphicsSettings(this.settingsCustom)}checkCustomDict(){if(null==this.settingsCustom){this.settingsCustom={};var e=this.settingsHigh;this.settingsQualityChoice&&(0==this.settingsQualityChoice?e=this.settingsLow:1==this.settingsQualityChoice?e=this.settingsMedium:2==this.settingsQualityChoice&&(e=this.settingsHigh)),Object.assign(this.settingsCustom,e)}}setQualityCookie(e){this.pxlCookie.setCookie("qualitySetting",e)}setComponentQuality(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];switch(e){case"leftRight":case"mouse":this.settings[e]=t;break;case"resolution":this.screenResPerc=t,this.pxlDevice.resizeRenderResolution(),this.settings[e]=t,this.pxlEnv.geoList.snow&&this.pxlEnv.geoList.snow.material&&(this.pxlEnv.geoList.snow.material.uniforms.pointScale.value=this.pxlEnv.geoList.snow.pBaseScale*t);break;case"fog":this.pxlEnv.mapOverlayHeavyPass&&(this.pxlEnv.mapOverlayHeavyPass.enabled=2==t),this.pxlEnv.mapOverlayPass&&(this.pxlEnv.mapOverlayPass.enabled=1==t),this.pxlEnv.mapOverlaySlimPass&&(this.pxlEnv.mapOverlaySlimPass.enabled=0==t),this.pxlEnv.mapBoxAAPass.enabled&&(this.pxlEnv.mapBoxAAPass.enabled=2==t),this.pxlEnv.mapCrossAAPass.enabled&&(this.pxlEnv.mapCrossAAPass.enabled=1==t),this.pxlEnv.portaluserScreenIntensity&&(this.pxlEnv.portaluserScreenIntensity.x=1),this.pxlEnv.userScreenIntensity&&(this.pxlEnv.userScreenIntensity.x=.65,this.pxlEnv.userScreenIntensity.y=0),this.pxlEnv.geoList.HDRView&&(this.pxlEnv.geoList.HDRView.material.uniforms.cdMult.value=0==t?.7:.3),this.settings[e]=t;break;case"bloom":this.pxlEnv.portaluserScreenIntensity.x=t?.4:1,this.pxlEnv.mapGlowPass&&(this.pxlEnv.mapGlowPass.enabled=t),this.pxlEnv.roomBloomPass&&(this.pxlEnv.roomBloomPass.enabled=t),this.pxlEnv.roomGlowPass&&(this.pxlEnv.roomGlowPass.enabled=t),this.pxlEnv.userScreenIntensity&&(this.pxlEnv.userScreenIntensity.x=t?.65:.8,this.pxlEnv.userScreenIntensity.y=t?0:.8),this.pxlEnv.geoList.HDRView&&(this.pxlEnv.geoList.HDRView.material.uniforms.cdMult.value=0==t?.7:.3),this.pxlEnv.mapMotionBlurPass&&(this.pxlEnv.mapMotionBlurPass.enabled=t),this.settings[e]=t;break;case"motion":this.pxlEnv.mapMotionBlurPass&&(this.pxlEnv.mapMotionBlurPass.enabled=t),this.settings[e]=t}i&&this.pxlCookie.setCookie(e,t)}setDependentSettings(){var e,t,i=1,s=0,a=.6,r=!1,n=!1,o=!1,l=!1,h=!1,d=!1;(2==this.settings.fog?(r=!1,n=!0,o=!1,l=!1,h=!0,d=!1,i=.5):1==this.settings.fog?(r=!1,n=!1,o=!0,l=!1,h=!1,d=!0,i=.5):(r=!1,o=!1,l=!0,h=!1,d=!1,i=.4),this.pxlEnv.mapMotionBlurPass&&(this.pxlEnv.mapMotionBlurPass.enabled=r),n&&(this.pxlEnv.mapOverlayHeavyPass.enabled=n),o&&(this.pxlEnv.mapOverlayPass.enabled=o),l&&(this.pxlEnv.mapOverlaySlimPass.enabled=l),h&&(this.pxlEnv.mapBoxAAPass.enabled=h),d&&(this.pxlEnv.mapCrossAAPass.enabled=d),this.settings.bloom)?(this.pxlEnv.mapGlowPass&&(this.pxlEnv.mapGlowPass.enabled=!0),this.pxlEnv.roomBloomPass&&(this.pxlEnv.roomBloomPass.enabled=!0),this.pxlEnv.roomGlowPass&&(this.pxlEnv.roomGlowPass.enabled=!0),this.pxlEnv.userScreenIntensity.x=.65,this.pxlEnv.userScreenIntensity.y=0,s=1,a=.25):(this.pxlEnv.mapGlowPass&&(this.pxlEnv.mapGlowPass.enabled=!1),this.pxlEnv.roomBloomPass&&(this.pxlEnv.roomBloomPass.enabled=!1),this.pxlEnv.roomGlowPass&&(this.pxlEnv.roomGlowPass.enabled=!1),null!==(e=this.pxlEnv)&&void 0!==e&&null!==(e=e.mapComposerGlow)&&void 0!==e&&e.renderTarget2&&(this.pxlEnv.engine.setRenderTarget(this.pxlEnv.mapComposerGlow.renderTarget2),this.pxlEnv.engine.clear()),null!==(t=this.pxlEnv)&&void 0!==t&&null!==(t=t.roomGlowPass)&&void 0!==t&&t.renderTarget2&&(this.pxlEnv.engine.setRenderTarget(this.pxlEnv.roomGlowPass.renderTarget2),this.pxlEnv.engine.clear()),this.pxlEnv.engine.setRenderTarget(null),this.pxlEnv.userScreenIntensity.x=.8,this.pxlEnv.userScreenIntensity.y=0,i=1,s=0,a=.5);var c=this.pxlEnv.geoList.Circular_Gate;c&&(c.material.uniforms.bloomBoost.value=s),this.pxlEnv.geoList.HDRView&&(this.pxlEnv.geoList.HDRView.material.uniforms.cdMult.value=this.settings.bloom?.3:.7);var u=this.pxlEnv.geoList.CirculateGateVideoSphere;u&&(u.material.color.r=a,u.material.color.g=a,u.material.color.b=a),this.pxlEnv.portaluserScreenIntensity&&(this.pxlEnv.portaluserScreenIntensity.x=i),this.pxlEnv.pxlCamera.colliderCurObjHit=null}},CookieManager:class CookieManager{constructor(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pxlNav-",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"/",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30,a="-"==t.substring(-1)?t:t+"-";this.prepend=a,this.verbose=e,this.exp=s,this.path="path="+i,this.deleteDate="expires=Thu, 01 Jan 1970 00:00:01 GMT;",this.sub="_%_"}log(){if(this.verbose>=b.INFO){console.log("-- Cookie Manager --");for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach((e=>{console.log(e)}))}}getExpiration(){var e=new Date;return e.setTime(e.getTime()+24*this.exp*60*60*1e3),"expires="+e.toGMTString()+";"}isEqual(e){return!!this.hasCookie(e)&&(this.log(e),this.readCookie(e)==this.variableToString(e))}getRegexp(e){return new RegExp("(?="+e+").*?((?=;)|(?=$))","g")}getClearCookieRegexp(e){return new RegExp("(?="+e+").*?(?==)","g")}pullData(){var e=document.cookie,t=this.getRegexp(this.prepend),i=e.match(t),s={};return i&&i.forEach((e=>{var t=e.split("=")[0].replace(this.prepend,""),i=e.split("=")[1].replace(this.sub,";");s[t]=i})),s}valueToString(e){var t=typeof e;return isNaN(Number(e))?"string"==t?"'"+e+"'":"boolean"==t?e?"true":"false":null==e?"null":isNaN(Number(e))?"NaN":e:e}variableToString(e){if(Array.isArray(e)){var t=e.map((e=>Array.isArray(e)?this.variableToString(e):this.valueToString(e)));return"["+t.join(",")+"]"}return this.valueToString(e)}hasCookie(e){return document.cookie.includes(this.prepend+e)}readCookie(e){if(this.hasCookie(e)){var t=this.getRegexp(this.prepend+e);return document.cookie.match(t)[0].split("=")[1].replace(this.prepend,"").replace(this.sub,";")}return null}parseCookie(e){if(this.hasCookie(e)){var t=this.getRegexp(this.prepend+e),i=document.cookie.match(t)[0].split("=")[1].replace(this.prepend,"").replace(this.sub,";");return"true"==i?i=!0:"false"==i?i=!1:parseInt(i)==i?i=parseInt(i):parseFloat(i)==i&&(i=parseFloat(i)),i}return null}evalCookie(e){if(e){if(this.hasCookie(e)){var t=this.getRegexp(this.prepend+e);return this.log("Eval Cookie has been limited, responce is: "),this.log(document.cookie.match(t)[0].replace(this.prepend,"").replace(this.sub,";")),!0}return!1}var i=this.getRegexp(this.prepend);return this.log("Eval Cookie has been limited, may error."),document.cookie.match(i).forEach((e=>{e.replace(this.prepend,"").replace(this.sub,";")})),!0}setCookie(e,t){(t=this.variableToString(t)).replace&&t.replace(";",this.sub),document.cookie=this.prepend+e+"="+t+";"+this.getExpiration()+this.path}addDictionary(e){for(var t=Object.keys(e),i=0;i<t.length;++i){var s=e[t[i]];(s=this.variableToString(s)).replace&&s.replace(";",this.sub),document.cookie=this.prepend+t[i]+"="+s+";"+this.getExpiration()+this.path}}parseDict(e){var t=Object.keys(e),i=!1;return t.forEach((t=>{this.hasCookie(t)&&(e[t]=this.parseCookie(t),i=!0)})),i}clearCookie(e){if(e)"string"==typeof e&&(e=[e]),e.forEach((e=>{document.cookie=e+"=;"+this.deleteDate+this.path}));else{var t=this.getClearCookieRegexp(this.prepend);document.cookie.match(t).forEach((e=>{document.cookie=e+"=;"+this.deleteDate+this.path}))}}},Timer:class Timer{constructor(){this.active=!1,this.msRunner=new x.Vector2(0,0),this.msLog=0,this.fpsStats=-1;var e=.001*(new Date).getTime();this._bootMS=e,this._prevWorldMS=e,this._curMS=e,this._prevMS=e,this.deltaTime=0,this.avgDeltaTime=0,this.avgDeltaRate=.7,this._msRate=.001,this.baseRate=.001,this.videoFeeds=[],this.booted=!1}init(){this.booted||(this.prevMS=this.curMS,this.msRunner.x=0,this.msRunner.y=0,this.step(),this.booted=!0)}get runtime(){return this._curMS-this._bootMS}get curMS(){return this._curMS}updateTime(){this._curMS=(new Date).getTime()*this._msRate}get prevMS(){return this._prevMS}set prevMS(e){this._prevMS=e}get runtime(){return this._curMS-this._bootMS}scaleTime(e){this._msRate=this.baseRate*e}start(){this.play()}pause(){return this.active=!this.active,this.active}play(){return this.active=!0,this.active}stop(){return this.active=!1,this.active}toggleMSLog(){this.msLog=(this.msLog+1)%2}step(){var e=this._curMS;if(this.updateTime(),this._curMS!=e){this.prevMS=e,-1!=this.fpsStats&&this.fpsStats.update();var t=this.curMS-this.prevMS;this.avgDeltaTime=this.deltaTime*(1-this.avgDeltaRate)+t*this.avgDeltaRate,this.deltaTime=t,this.msRunner.x+=t>0?t:0,this.msRunner.y=this.avgDeltaTime}else this._curMS=e}getLerpRate(e){return 1-Math.pow(.5,this.deltaTime*e)}getLerpAvgRate(e){return 1-Math.pow(.5,this.avgDeltaTime*e)}},User:class User{constructor(){this.pxlEnums=null,this.pxlEnv=null,this.id=null,this.jmaConnectObj=!1,this.jmaServer=!1,this.jmaRoom=!1,this.jmaUserId=null,this.jmaUserName=null,this.jmaTempUserIdActive=!1,this.welcome=!1,this.tankStrafe=!1,this.invertMouse=!1,this.moveSpeed=1,this.moveSpeedSlow=.5,this.moveSpeedBase=1,this.moveSpeedBoost=2,this.renderSettingsCookie="settings_renderSettings",this.controlModeCookie="settings_controlMode",this.tankStrageCookie="settings_tankStrage",this.invertMouseCookie="settings_invertMouse",this.rootUserCookie="data_userEnlil",this.adminUserCookie="data_userNanna",this.localUserMoved=!1,this.localUserTurned=!1,this.itemRunTime=60,this.itemGroupList=[],this.itemList={},this.itemListNames=[],this.itemBaseList=[],this.itemActiveList=[],this.itemInactiveCmd=[],this.itemActiveTimer=[],this.itemRotateRate=.65,this.itemBaseRotateRate=.1,this.itemBobRate=.35,this.itemBobMag=0,this.mPick=[],this.activeEffects={},this.lowGrav=0,this.lKing=0,this.lKingInactive=[.025,.018],this.lKingActive=[.35,.25],this.lKingWarp=0,this.lizardKingPass=null,this.sField=0,this.sFieldWarp=0,this.starFieldPass=null,this.iZoom=0,this.iZoomWarp=0,this.crystallinePass=null}setDependencies(pxlNav){this.pxlEnums=pxlNav.pxlEnums,this.pxlEnv=pxlNav.pxlEnv}setSlowSpeed(e){e=Math.max(.001,e),this.moveSpeedSlow=e}setBaseSpeed(e){e=Math.max(.001,e),this.moveSpeedBase=e}setBoostSpeed(e){e=Math.max(.001,e),this.moveSpeedBoost=e}setSpeed(e){switch(e){case this.pxlEnums.USER_SPEED.STOP:this.moveSpeed=0;break;case this.pxlEnums.USER_SPEED.SLOW:this.moveSpeed=this.moveSpeedBase*this.moveSpeedSlow;break;case this.pxlEnums.USER_SPEED.BASE:this.moveSpeed=this.moveSpeedBase;break;case this.pxlEnums.USER_SPEED.BOOST:this.moveSpeed=this.moveSpeedBase*this.moveSpeedBoost}}checkItemWearOff(e){if(this.itemActiveList.length>0&&this.itemActiveTimer[0]-e<=0)return this.itemInactiveCmd.shift()(),this.itemActiveTimer.shift(),this.itemActiveList.shift(),!0;return!1}checkItemPickUp(e){return"LowGravity"==e?0==this.lowGrav&&(this.lowGrav=1,!0):"LizardKing"==e?0==this.lKing&&(this.lKing=1,this.lKingWarp.set(...this.lKingActive),this.lizardKingPass.enabled=!0,!0):"StarField"==e?0==this.sField&&(this.sField=1,this.starFieldPass.enabled=!0,!0):"InfinityZoom"==e?0==this.iZoom&&(this.iZoom=1,this.crystallinePass.enabled=!0,!0):void 0}toggleTankRotate(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.tankStrafe=null==e?!this.tankStrafe:e,this.tankStrageText=this.tankStrafe?"Left/Right Rotation":"Left/Right Strafe"}toggleMouseInf(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.invertMouse=null==e?!this.invertMouse:e,this.invertMouseText=this.invertMouse?"Revert Mouse":"Invert Mouse"}toggleFpsStats(){-1==pxlTimer.fpsStats?(pxlTimer.fpsStats=new Stats,document.body.appendChild(pxlTimer.fpsStats.domElement),pxlTimer.fpsStats.update(),this.fpsDisplayText="Hide FPS Stats"):(pxlTimer.fpsStats.domElement.remove(),pxlTimer.fpsStats=-1,this.fpsDisplayText="Display FPS Stats")}},Device:class Device{constructor(e,t,i){this.projectTitle=e,this.pxlCore=t,this.pxlEnv=null,this.pxlEnums=null,this.pxlTimer=null,this.pxlAudio=null,this.pxlUser=null,this.pxlCamera=null,this.pxlAutoCam=null,this.pxlGuiDraws=null,this.pxlQuality=null,this.pxlOptions=null,this.allowCursorSwap=!1,this.longTouchLength=.75;var s=window.innerWidth,a=window.innerHeight;this.sW=s,this.sH=a,this.touchScreen=!1,this.x=.5*s,this.y=.5*a,this.screenRes=new x.Vector2(1/s,1/a),this.screenAspect=new x.Vector2(1,1),this.screenRatio=new x.Vector2(s/a,a/s),this.origRes=new x.Vector2(s,a),this.screenResDeltaPerc=new x.Vector2(1,1),this.mapW=1,this.mapH=1,this.gammaCorrection=new x.Vector3(1,1,1),this.lightShift=new x.Vector2(1,1),this.firefox=/Firefox/i.test(navigator.userAgent),this.mobile=i,this.button=0,this.inputActive=!1,this.startPos=[0,0],this.endPos=[0,0],this.dragCount=0,this.dragTotal=0,this.latched=!1,this.windowHidden=!1,this.mouseX=s/2,this.mouseY=a/2,this.keyDownCount=[0,0,0],this.directionKeyDown=!1,this.directionKeysPressed=[0,0,0,0],this.controlKey=!1,this.objectPercList=[],this.objectPercFuncList={},this.objectPerc={active:!1,object:null,left:0,top:0,width:0,height:0,startX:0,startY:0,offsetX:0,offsetY:0,percX:0,percY:0,offsetPercX:0,offsetPercY:0},this.canCursorLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,this.cursorLockActive=!1,this.cursorRightButtonLockActive=!1,this.gyroGravity=[0,0,0],this.touchMouseData={active:!1,lock:!1,mode:0,updated:0,button:0,dragCount:0,dragTotal:0,startPos:null,moveMult:new x.Vector2(1,1),velocityEase:new x.Vector2(0,0),velocityEasePrev:null,velocity:new x.Vector2(0,0),mBlurVelInf:new x.Vector2(2*this.screenRes.x,2*this.screenRes.y),prevDeltaPos:[0,0,0],endPos:null,latchMatrix:null,netDistance:new x.Vector2(0,0),netDistYPerc:0,curDistance:new x.Vector2(0,0),curFadeOut:new x.Vector2(0,0),curStepDistance:new x.Vector2(0,0),initialQuat:new x.Quaternion,releaseTime:0},this.subscriptableEvents=["keydown","keyup","resize"],this.callbackList={}}setDependencies(pxlNav){this.pxlEnv=pxlNav.pxlEnv,this.pxlEnums=pxlNav.pxlEnums,this.pxlTimer=pxlNav.pxlTimer,this.pxlAudio=pxlNav.pxlAudio,this.pxlUser=pxlNav.pxlUser,this.pxlCamera=pxlNav.pxlCamera,this.pxlAutoCam=pxlNav.pxlAutoCam,this.pxlGuiDraws=pxlNav.pxlGuiDraws,this.pxlQuality=pxlNav.pxlQuality,this.pxlOptions=pxlNav.pxlOptions}init(){this.setGammaCorrection();var e=this;(!this.pxlOptions.staticCamera||this.pxlOptions.allowStaticRotation&&this.pxlOptions.staticCamera)&&(document.addEventListener("mousedown",(t=>{e.onmousedown(e,t)}),!1),document.addEventListener("mousemove",(t=>{e.onmousemove(e,t)}),!1),document.addEventListener("mouseup",(t=>{e.onmouseup(e,t)}),!1),document.addEventListener("touchstart",(function(t){e.touchstart(e,t)}),{passive:!0}),document.addEventListener("touchmove",(function(t){e.touchmove(e,t)}),{passive:!0}),document.addEventListener("touchend",(function(t){e.touchend(e,t)}),{passive:!0})),document.addEventListener("contextmenu",(t=>{e.oncontextmenu(t)}),!1),window.addEventListener("resize",(t=>{e.resizeRenderResolution()}),!1),document.onkeydown=t=>{e.onkeydown(e,t)},document.onkeyup=t=>{e.onkeyup(e,t)};var t=this;document.addEventListener("visibilitychange",this.onVisibilityChange.bind(this),!1),"object"==typeof window.onblur&&(window.onblur=this.resetUserInput.bind(this)),window.addEventListener("beforeunload",(e=>{if(1==t.controlKey)return e.preventDefault(),e.returnValue="Close tab?",t.controlKey=!1,t.mapLockCursor(!1,0),"Close tab?"}))}setGammaCorrection(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null!=e)return this.gammaCorrection.x=1/e,this.gammaCorrection.y=e,void(this.gammaCorrection.z=e);var t=1.5,i=1.1,s=1.2,a=.5;if(window&&window.navigator&&window.navigator.userAgent){var r=window.navigator.userAgent.match(/(windows|win32|win64|wince)/i);if(r&&r.length>0)t=2.2,i=.95,s=1,a=0;else{var n=window.navigator.userAgent.match(/(macintosh|macintel|macppc|mac68k|iphone|ipad|ipod)/i);n&&n.length>0?(t=1.8,i=.9,s=.97,a=.1):(t=1.8,i=.7,s=.96,a=.1)}}this.gammaCorrection.x=1/t,this.gammaCorrection.y=s,this.gammaCorrection.z=a,this.lightShift.x=i}runHiddenCalcs(){this.windowHidden&&setTimeout((()=>{this.runHiddenCalcs()}),100)}onVisibilityChange(){this.windowHidden=document.hidden,this.directionKeysPressed=[0,0,0,0],this.directionKeyDown=!1,this.pxlUser.setSpeed(this.pxlEnums.USER_SPEED.BASE),this.pxlCamera.workerFunc("focus",!document.hidden),this.runHiddenCalcs()}resetUserInput(e){this.directionKeysPressed=[0,0,0,0],this.directionKeyDown=!1,this.pxlUser.setSpeed(this.pxlEnums.USER_SPEED.BASE),this.mapLockCursor(!1,0),this.pxlCamera.camJumpKey(!1),this.pxlCamera.deviceKey("space",!1),this.touchMouseData.active&&(this.touchScreen?this.endTouch(e):this.mapOnUp(e))}onmousemove(e,t){e.mapOnMove(t)}onmousedown(e,t){e.mapOnDown(t)}onmouseup(e,t){e.mapOnUp(t)}oncontextmenu(e){return e.preventDefault(),!1}touchstart(e,t){e.startTouch(t)}touchmove(e,t){e.doTouch(t)}touchend(e,t){e.endTouch(t)}onkeydown(e,t){e.keyDownCall(t)}onkeyup(e,t){e.keyUpCall(t)}get active(){return this.inputActive}set active(e){this.inputActive=!!e}preventDefault(e){(e=e||window.event).preventDefault(e)&&e.preventDefault(e)(),e.returnValue=!1}setCursor(e){if(this.allowCursorSwap){if("activeLatch"==e)this.touchMouseData.button;document.body.style.cursor=e}}getMouseXY(e){if(this.mobile)try{touch=e.touches[0],this.mouseX=touch.pageX,this.mouseY=touch.pageY}catch(e){}else{var t=this.pxlQuality.settings.mouse?-1:1;this.cursorLockActive?(this.mouseX+=(e.movementX||e.mozMovementX||e.webkitMovementX||0)*t,this.mouseY+=(e.movementY||e.mozMovementY||e.webkitMovementY||0)*t):(this.mouseX=e.clientX,this.mouseY=e.clientY)}}mapLockCursor(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if(this.canCursorLock&&!this.mobile){if(2==t?(!e&&this.cursorRightButtonLockActive?this.cursorRightButtonLockActive=!1:e||this.cursorRightButtonLockActive||(this.cursorRightButtonLockActive=!0),e=e||this.cursorRightButtonLockActive):e||(this.cursorRightButtonLockActive=e),1==e){this.pxlGuiDraws.pxlNavCanvas.focus();var i=this.pxlGuiDraws.pxlNavCanvas;i.requestPointerLock=i.requestPointerLock||i.mozRequestPointerLock||i.webkitRequestPointerLock;try{i.requestPointerLock()}catch(e){}}else document.pointerLockElement&&document.exitPointerLock();this.cursorLockActive=e}}mapOnDown(e){var t=e.target;t.getAttribute&&t.getAttribute("id")==this.pxlCore&&this.pxlTimer.active&&(this.pxlGuiDraws.chatMessageInput&&this.pxlGuiDraws.chatMessageInput.blur(),this.pxlGuiDraws.pxlNavCanvas.focus(),this.preventDefault(e),this.touchMouseData.button=e.which,this.touchMouseData.active=!0,this.touchMouseData.mode=this.touchMouseData.button,this.touchMouseData.startPos=new x.Vector2(this.mouseX,this.mouseY),this.touchMouseData.endPos=new x.Vector2(this.mouseX,this.mouseY),this.touchMouseData.curDistance=new x.Vector2(0,0),this.touchMouseData.curStepDistance=new x.Vector2(0,0),this.touchMouseData.dragCount=0,this.pxlAutoCam.touchBlender=!1,this.setCursor("grabbing"),this.mapLockCursor(!0,e.button))}mapOnMove(e){var t=e.target;if(t.getAttribute&&t.getAttribute("id")==this.pxlCore&&this.pxlTimer.active||this.cursorLockActive)if(this.preventDefault(e),this.getMouseXY(e),(this.touchMouseData.active||this.cursorLockActive)&&this.touchMouseData.startPos){this.touchMouseData.dragCount++;var i=this.touchMouseData.endPos.clone();this.touchMouseData.endPos=new x.Vector2(this.mouseX,this.mouseY),this.touchMouseData.curDistance=this.touchMouseData.startPos.clone().sub(this.touchMouseData.endPos),this.touchMouseData.curStepDistance=this.touchMouseData.endPos.clone().sub(i),this.touchMouseData.netDistance.add(this.touchMouseData.curStepDistance.clone()),this.touchMouseData.velocity=this.touchMouseData.velocity.clone().multiplyScalar(3).add(this.touchMouseData.curStepDistance).multiplyScalar(.25),this.touchMouseData.netDistYPerc=8e-4*(this.touchMouseData.netDistance.y+this.touchMouseData.curDistance.y+250),this.touchMouseData.curFadeOut.add(i.sub(this.touchMouseData.endPos))}else this.pxlEnv.hoverUserDetect()}mapOnUp(e){var t=e.target;if(this.pxlAudio.djVolumeParentObj&&(this.pxlAudio.djVolumeParentObj.down=!1),t.getAttribute&&t.getAttribute("id")==this.pxlCore){if(this.pxlGuiDraws.checkFocus(t.getAttribute("id"),!0),!this.mobile)return this.preventDefault(e),this.touchMouseData.dragCount++,this.touchMouseData.dragTotal+=this.touchMouseData.dragCount,this.touchMouseData.active=!1,this.touchMouseData.releaseTime=this.pxlTimer.curMS,this.pxlAutoCam.touchBlender=!0,this.pxlAutoCam.setNextTrigger(),this.touchMouseData.dragCount<9&&this.pxlEnv.clickUserDetect(),this.touchMouseData.endPos=new x.Vector2(this.mouseX,this.mouseY),this.touchMouseData.netDistYPerc=(this.touchMouseData.netDistance.y+250)/1250,this.setCursor("grab"),this.mapLockCursor(!1,e.button),e.preventDefault(),!1;this.pxlAutoCam.getNextPath(!1,1)}}startTouch(e){var t=e.target;if(t.getAttribute&&t.getAttribute("id")==this.pxlCore&&this.pxlTimer.active){this.touchScreen=!0;var i=e.touches[0];this.mouseX=i.pageX,this.mouseY=i.pageY,this.touchMouseData.active=!0,this.touchMouseData.mode=this.touchMouseData.button,this.touchMouseData.startPos=new x.Vector2(this.mouseX,this.mouseY),this.touchMouseData.endPos=new x.Vector2(this.mouseX,this.mouseY),this.touchMouseData.curDistance=new x.Vector2(0,0),this.touchMouseData.curStepDistance=new x.Vector2(0,0),this.touchMouseData.dragCount=0,this.pxlAutoCam.touchBlender=!1,this.touchMouseData.releaseTime=this.pxlTimer.curMS;var s=t.getAttribute("id");if(this.objectPercList.includes(s)){"djPlayerVolume"==s&&(s=(t=this.pxlAudio.djVolumeParentObj).getAttribute("id"));var a=t.getBoundingClientRect();this.objectPerc.active=!0,this.objectPerc.object=t,this.objectPerc.left=a.left,this.objectPerc.top=a.top,this.objectPerc.width=a.width,this.objectPerc.height=a.height,this.objectPerc.startX=this.mouseX-a.left,this.objectPerc.startY=this.mouseY-a.top,this.objectPerc.percX=(this.mouseX-this.objectPerc.left)/this.objectPerc.width,this.objectPerc.percY=(this.mouseY-this.objectPerc.top)/this.objectPerc.height,this.objectPerc.offsetX=0,this.objectPerc.offsetY=0,this.objectPerc.offsetPercX=0,this.objectPerc.offsetPercY=0,this.objectPercFuncList[s]&&this.objectPercFuncList[s](e)}}}doTouch(e){if(this.touchMouseData.active){e.target;var t=e.touches[0];if(this.mouseX=t.pageX,this.mouseY=t.pageY,this.touchMouseData.active){if(this.touchMouseData.dragCount++,void 0!==e.touches[1]){e.touches[1];return void(e.touches.length>1&&this.touchMouseData.dragCount>10&&(this.touchMouseData.lock=!0,t=e.touches[1],this.pxlEnv.setFogHue([this.mouseX,this.mouseY],[t.pageX,t.pageY])))}var i=this.touchMouseData.endPos.clone();this.touchMouseData.endPos=new x.Vector2(this.mouseX,this.mouseY),this.touchMouseData.curDistance=this.touchMouseData.startPos.clone().sub(this.touchMouseData.endPos),this.touchMouseData.curStepDistance=this.touchMouseData.endPos.clone().sub(i),this.touchMouseData.netDistance.add(this.touchMouseData.curStepDistance.clone()),this.touchMouseData.velocity.add(this.touchMouseData.curStepDistance).multiplyScalar(.5),this.touchMouseData.netDistYPerc=(this.touchMouseData.netDistance.y+this.touchMouseData.curDistance.y+250)/1250,this.touchMouseData.curFadeOut.add(i.sub(this.touchMouseData.endPos))}this.objectPerc.active&&(this.objectPerc.percX=(this.mouseX-this.objectPerc.left)/this.objectPerc.width,this.objectPerc.percY=(this.mouseY-this.objectPerc.top)/this.objectPerc.height,this.objectPerc.offsetX=this.mouseX-this.objectPerc.startX,this.objectPerc.offsetY=this.mouseY-this.objectPerc.startY,this.objectPerc.offsetPercX=this.objectPerc.offsetX/this.objectPerc.width,this.objectPerc.offsetPercY=this.objectPerc.offsetY/this.objectPerc.height)}}endTouch(e){if(this.touchMouseData.active)if(this.touchScreen=!1,this.touchMouseData.dragCount++,this.touchMouseData.dragTotal+=this.touchMouseData.dragCount,this.touchMouseData.active=!1,this.touchMouseData.endPos=new x.Vector2(this.mouseX,this.mouseY),this.touchMouseData.netDistYPerc=(this.touchMouseData.netDistance.y+250)/1250,this.touchMouseData.curDistance.multiplyScalar(0),this.touchMouseData.curStepDistance.multiplyScalar(0),this.touchMouseData.releaseTime=this.pxlTimer.curMS,this.touchMouseData.lock)this.touchMouseData.lock=!1;else{this.pxlAutoCam.touchBlender=!0,this.pxlAutoCam.setNextTrigger();var t=e.target;this.touchMouseData.dragCount<10&&t.getAttribute&&t.getAttribute("id")==this.pxlCore&&this.pxlAutoCam.getNextPath(!1,0),this.objectPerc.active=!1,this.pxlAudio.djVolumeParentObj&&(this.pxlAudio.djVolumeParentObj.down=!1)}}keyDownCall(e){var t=this;return _asyncToGenerator((function*(){if(t.emit("keydown",e),e.ctrlKey&&(t.controlKey=!0),null==document.activeElement.type&&t.pxlTimer.active){if(e.repeat)return;var i=e.keyCode||e.which;37!=i&&65!=i||(t.directionKeyDown=!0,t.keyDownCount[0]=t.pxlQuality.fpsCounter.z,t.directionKeysPressed[0]=1,t.pxlCamera.deviceKey(0,!0)),e.ctrlKey&&87==i&&1==t.directionKeysPressed[1]&&e.this.preventDefault(e)(),38!=i&&87!=i||(t.directionKeyDown=!0,t.keyDownCount[1]=t.pxlQuality.fpsCounter.z,t.directionKeysPressed[1]=1,t.pxlCamera.deviceKey(1,!0)),39!=i&&68!=i||(t.directionKeyDown=!0,t.keyDownCount[0]=t.pxlQuality.fpsCounter.z,t.directionKeysPressed[2]=1,t.pxlCamera.deviceKey(2,!0)),40!=i&&83!=i||(t.directionKeyDown=!0,t.keyDownCount[1]=t.pxlQuality.fpsCounter.z,t.directionKeysPressed[3]=1,t.pxlCamera.deviceKey(3,!0)),16!=i&&224!=i||(t.pxlUser.setSpeed(t.pxlEnums.USER_SPEED.BOOST),t.pxlCamera.deviceKey("shift",!0)),32==i&&(t.pxlCamera.camJumpKey(!0),t.pxlCamera.deviceKey("space",!0))}}))()}keyUpCall(e){var t=this;return _asyncToGenerator((function*(){if(t.emit("keyup",e),e.ctrlKey)return t.controlKey=!1,e.preventDefault(),!1;if(null==document.activeElement.type){var i=e.keyCode||e.which,s=e.code||e.which;if(!e.isTrusted)return!1;if(e.ctrlKey||e.altKey||e.code.includes("F"))return e.preventDefault(),!1;if("Backquote"==s)return void t.pxlGuiDraws.guiToggleVisibility();if(89==i&&t.pxlGuiDraws.toggleShaderEditor(),220==i){var a=t.pxlQuality.screenResPerc;t.pxlQuality.screenResPerc=1,t.pxlEnv.mapRender(!1);for(var r=t.pxlGuiDraws.pxlNavCanvas.toDataURL("image/png"),n=atob(r.split(",")[1]),o=n.length,l=new Uint8Array(o),h=0;h<o;++h)l[h]=n.charCodeAt(h);var d=URL.createObjectURL(new Blob([l])),c=new Date,u=c.getDate(),p=c.getMonth()+1,m=c.getFullYear()+"-"+p+"-"+u+"_"+c.getHours()+"-"+c.getMinutes()+"-"+c.getSeconds(),v=document.createElement("a");return v.download=t.projectTitle+"_"+m+".png",v.href=d,document.body.appendChild(v),v.click(),v.parentNode.removeChild(v),t.pxlQuality.screenResPerc=a,void t.pxlEnv.mapRender(!1)}if(t.pxlTimer.active){if(37!=i&&65!=i||(t.directionKeysPressed[0]=0,t.pxlCamera.deviceKey(0,!1)),38!=i&&87!=i||(t.directionKeysPressed[1]=0,t.pxlAutoCam.active&&t.pxlAutoCam.step(!0),t.pxlCamera.deviceKey(1,!1)),39!=i&&68!=i||(t.directionKeysPressed[2]=0,t.pxlCamera.deviceKey(2,!1)),40!=i&&83!=i||(t.directionKeysPressed[3]=0,t.pxlAutoCam.active&&t.pxlAutoCam.setRoom(!0),t.pxlCamera.deviceKey(3,!1)),t.directionKeysPressed.includes(1)||(t.directionKeyDown=!1),16==i||224==i)return t.pxlUser.setSpeed(t.pxlEnums.USER_SPEED.BASE),void t.pxlCamera.deviceKey("shift",!1);if(32==i)return t.pxlCamera.camJumpKey(!1),void t.pxlCamera.deviceKey("space",!1);if(!t.directionKeyDown){if(49==i||97==i)return void t.pxlCamera.fastTravel(0);if(50==i||98==i)return void t.pxlCamera.fastTravel(1);if(51==i||99==i)return void t.pxlCamera.fastTravel(2);if(52==i||100==i)return void t.pxlCamera.fastTravel(3);if(53==i||101==i)return void t.pxlAutoCam.preAutoCamToggle()}var g;if(221==i)return void((null===(g=t.pxlUser)||void 0===g||null===(g=g.itemInactiveCmd)||void 0===g?void 0:g.length)>0&&console.log(t.pxlUser.itemInactiveCmd.pop()))}if(27==i||13==i&&!e.ctrlKey)return t.pxlGuiDraws.toggleHudBlock(!1,!0),void t.pxlGuiDraws.toggleGuiWindowContainer(!1,!1,!0);if(e.altKey||e.ctrlKey||e.shiftKey)return;if(73==i)return void t.pxlGuiDraws.iconEvent("click",t.pxlGuiDraws.hudIcons.infoIcon,"info");if(71==i)return void t.pxlGuiDraws.iconEvent("click",t.pxlGuiDraws.hudIcons.settingsIcon,"settings");if(191==i||72==i)return void t.pxlGuiDraws.iconEvent("click",t.pxlGuiDraws.hudIcons.helpIcon,"help");if(66==i)return void t.pxlGuiDraws.iconEvent("click",t.pxlGuiDraws.hudIcons.musicIcon,"musicToggle");if(78==i)return void t.pxlGuiDraws.iconEvent("click",t.pxlGuiDraws.hudIcons.speakerIcon,"speakerToggle");if(80==i)return t.directionKeysPressed=[0,0,0,0],t.directionKeyDown=!1,t.pxlTimer.pause(),t.pxlTimer.active&&t.pxlEnv.mapRender(),void t.pxlCamera.workerFunc("activeToggle",t.pxlTimer.active)}}))()}resizeRenderResolution(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e=e||window.innerWidth,t=t||window.innerHeight,this.mapW=(this.sW=e)*this.pxlQuality.screenResPerc,this.mapH=(this.sH=t)*this.pxlQuality.screenResPerc,this.screenRes.x=1/this.mapW,this.screenRes.y=1/this.mapH,this.screenRatio.x=this.sW/this.sH,this.screenRatio.y=this.sH/this.sW,this.pxlEnv.geoList.HDRView){var i=this.mapW>this.mapH?1:this.mapW/this.mapH;this.pxlEnv.geoList.HDRView.material.uniforms.ratioU.value=i}if(this.touchMouseData.mBlurVelInf=new x.Vector2(2*this.screenRes.x,2*this.screenRes.y),this.pxlEnv.mapGlowPass){this.pxlEnv.scene.renderTarget.setSize(this.mapW*this.pxlQuality.bufferPercMult,this.mapH*this.pxlQuality.bufferPercMult),this.pxlEnv.scene.renderWorldPos.setSize(this.mapW*this.pxlQuality.bufferPercMult,this.mapH*this.pxlQuality.bufferPercMult),this.pxlEnv.mapComposer&&this.pxlEnv.mapComposer.setSize(this.mapW,this.mapH),this.pxlEnv.mapComposerGlow&&this.pxlEnv.mapComposerGlow.setSize(this.mapW,this.mapH),this.pxlEnv.roomComposer&&this.pxlEnv.roomComposer.setSize(this.mapW,this.mapH),this.pxlEnv.roomGlowPass&&this.pxlEnv.roomGlowPass.setSize(this.mapW*this.pxlQuality.bloomPercMult,this.mapH*this.pxlQuality.bloomPercMult),this.pxlEnv.delayComposer&&this.pxlEnv.delayComposer.setSize(this.mapW,this.mapH),this.pxlEnv.mapGlowPass&&this.pxlEnv.mapGlowPass.setSize(this.mapW*this.pxlQuality.bloomPercMult,this.mapH*this.pxlQuality.bloomPercMult),this.pxlEnv.mapMotionBlurPass&&this.pxlEnv.mapMotionBlurPass.setSize(this.mapW*this.pxlQuality.mBlurPercMult,this.mapH*this.pxlQuality.mBlurPercMult),this.pxlEnv.mapOverlayHeavyPass&&(this.pxlEnv.mapOverlayHeavyPass.setSize(this.mapW,this.mapH),this.pxlEnv.mapOverlayHeavyPass.uniforms.ratio.value=Math.min(1,this.mapW/this.mapH)),this.pxlEnv.mapOverlayPass&&(this.pxlEnv.mapOverlayPass.setSize(this.mapW,this.mapH),this.pxlEnv.mapOverlayPass.uniforms.ratio.value=Math.min(1,this.mapW/this.mapH)),this.pxlEnv.mapOverlaySlimPass&&(this.pxlEnv.mapOverlaySlimPass.setSize(this.mapW,this.mapH),this.pxlEnv.mapOverlaySlimPass.uniforms.ratio.value=Math.min(1,this.mapW/this.mapH)),this.pxlGuiDraws.pxlNavCanvas.width=this.sW,this.pxlGuiDraws.pxlNavCanvas.height=this.sH,this.pxlGuiDraws.loading=!0,this.pxlEnv.engine.setPixelRatio(window.devicePixelRatio*this.pxlQuality.screenResPerc),this.pxlEnv.engine.setSize(this.sW,this.sH);var s=this.mapW/this.mapH;this.pxlCamera.setAspect(s);var a=[this.sW/this.sH,this.sH/this.sW],r=[1,1];r[0]=s>a[0]?1:this.sW/(this.sH*a[0]),r[1]=s>a[1]?this.sH/(this.sW*a[1]):1,r[0]>1?(r[1]*=1/r[0],r[0]=1):r[1]>1&&(r[0]*=1/r[1],r[1]=1),this.screenAspect.x=r[0]*(1/.5**.5),this.screenAspect.y=r[1],this.screenResDeltaPerc.x=this.sW/this.origRes.x,this.screenResDeltaPerc.y=this.sH/this.origRes.y,this.pxlEnv.roomSubList.Lobby&&this.pxlEnv.roomSubList.Lobby.setShaders(),this.pxlEnv.updateCompUniforms(),this.pxlEnv.roomNameList.forEach((e=>{var t;this.pxlEnv.roomSceneList[e].pxlCamAspect=s,null!==(t=this.pxlEnv.roomSceneList[e])&&void 0!==t&&t.resize&&this.pxlEnv.roomSceneList[e].resize(this.mapW,this.mapH)})),this.emit("resize",{width:this.mapW,height:this.mapH,xPixelPerc:this.screenRes.x,yPixelPerc:this.screenRes.y,aspectRatio:s}),this.pxlTimer.active||this.pxlEnv.mapRender(!1)}}subscribe(e,t){this.subscriptableEvents.includes(e)?(this.callbackList[e]||(this.callbackList[e]=[]),this.callbackList[e].push(t)):console.error("Event type not subscribable: ",e)}unsubscribe(e,t){if(this.callbackList[e]){var i=this.callbackList[e].indexOf(t);i>=0&&this.callbackList[e].splice(i,1)}}emit(e,t){this.callbackList.hasOwnProperty(e)&&this.callbackList[e].forEach((e=>{e(t)}))}},Colliders:class Colliders{constructor(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:500;this.pxlEnv=null,this.pxlUtils=null,this.verbose=e,this.delimiter=",",this.roomColliderData={},this.baseGridSize=t,this.degToRad=Math.PI/180,this.epsilon=1e-5,this.colliderBoundsReference=i,this.prevGridKey=""}setDependencies(e){this.pxlEnv=e,this.pxlUtils=e.pxlUtils}log(e){this.verbose>=b.INFO&&console.log(e)}warn(e){this.verbose>=b.WARN&&console.warn(e)}error(e){this.verbose>=b.ERROR&&console.error(e)}init(){}start(){}stop(){}step(){}prepColliders(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w.FLOOR,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(e.hasColliders()){i||(i=this.baseGridSize);var s=1/i;if(t==w.HOVERABLE||t==w.CLICKABLE)return void this.prepInteractables(e,t);var a=e.getName(),r=e.getColliders(t);this.roomColliderData.hasOwnProperty(a)||(this.roomColliderData[a]={}),this.roomColliderData[a].hasOwnProperty(t)||(this.roomColliderData[a][t]={},this.roomColliderData[a][t].helper=null,this.roomColliderData[a][t].count=0,this.roomColliderData[a][t].gridSize=i,this.roomColliderData[a][t].gridSizeInv=s,this.roomColliderData[a][t].faceVerts={},this.roomColliderData[a][t].faceGridGroup={});var n=[],o={min:new x.Vector2(1/0,1/0),max:new x.Vector2(-1/0,-1/0)};r.forEach((e=>{for(var t=e.geometry.attributes.position.array,i=t.length/3,s=0;s<i;++s){var a=new x.Vector2(t[3*s],t[3*s+2]);n.push(a),o.min.min(a),o.max.max(a)}}));var l=o.max.clone().sub(o.min),h=Math.abs(Math.max(l.x,l.z)),d=Math.min(1,h/this.colliderBoundsReference);if(d<1){var c=i;s=1/(i*=d),this.roomColliderData[a][t].gridSize=i,this.roomColliderData[a][t].gridSizeInv=s,this.log("Grid size adjusted for pxlRoom: "+a+"; from "+c+" to "+i+" units; "+d+"%"),this.log("Reference bound set to: "+this.colliderBoundsReference+" units"),this.log("Total pxlRoom bounds found: "+h+" units")}else this.log("-- Grid size unchanged for pxlRoom '"+a+"', collider bounds within reference bounds --");this.log("Collider bounds: {x:"+o.min.x+", y:"+o.min.y+"} -to- {x:"+o.max.x+", y:"+o.max.y+" }");var u=-1,p=0;r.forEach((e=>{u++;for(var i=e.geometry.attributes.position.array,r=i.length/3,n=e.matrixWorld,o=0;o<r;++o){var l=9*o,h=new x.Vector3(i[l],i[l+1],i[l+2]),d=new x.Vector3(i[l+3],i[l+4],i[l+5]),c=new x.Vector3(i[l+6],i[l+7],i[l+8]);if(h.applyMatrix4(n),d.applyMatrix4(n),c.applyMatrix4(n),0!=h.length()||0!=d.length()||0!=c.length()){var m=Math.min(h.x,d.x,c.x),v=Math.max(h.x,d.x,c.x),g=Math.min(h.z,d.z,c.z),f=Math.max(h.z,d.z,c.z),y=Math.floor(m*s),b=Math.floor(v*s),C=Math.floor(g*s),P=Math.floor(f*s);p++;var S=d.clone().sub(h),w=c.clone().sub(h),E=S.clone().cross(w),D=S.dot(S),M=S.dot(w),L=w.dot(w),T=1/(D*L-M*M),A=""!=e.name?e.name:"collider_"+u,k=this.getGridKey(A,"_face_",this.flattenVector3(h),this.flattenVector3(d),this.flattenVector3(c)),R={object:e,name:e.name,key:k,verts:[h,d,c],edge0:S,edge1:w,normal:E,dotE0E0:D,dotE0E1:M,dotE1E1:L,areaInv:T};if(this.roomColliderData[a][t].faceVerts[k]=R,y!=b||C!=P){c.clone().sub(d);for(var _=y;_<=b;++_)for(var O=C;O<=P;++O){this.addFaceToGridLocation(a,t,_,O,k)}}else this.addFaceToGridLocation(a,t,y,C,k)}}}));for(var m=Object.keys(this.roomColliderData[a][t].faceGridGroup),v=0;v<m.length;++v){var g=this.roomColliderData[a][t].faceGridGroup[m[v]];this.roomColliderData[a][t].faceGridGroup[m[v]]=[...new Set(g)]}this.roomColliderData[a][t].count=p,this.log(" -- Collider Count for "+a+" : "+p)}else this.log(" -- No colliders found for room: "+e.getName()),this.log("      If you didn't intend on including collider objects in your FBX, something went wrong. Please check your FBX for unintentional collider user-detail attributes on mainScene objects.")}prepInteractables(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w.HOVERABLE;if(e.hasColliderType(t)){var i=e.getName(),s=e.getColliders(t);if(0!=s.length){this.roomColliderData.hasOwnProperty(i)||(this.roomColliderData[i]={});s.forEach((e=>{0;var s=e.geometry.attributes.position.array,a=s.length/3,r=e.name;if(!this.roomColliderData[i].hasOwnProperty(r)){this.roomColliderData[i][r]={},this.roomColliderData[i][r].hoverable=t==w.HOVERABLE,this.roomColliderData[i][r].clickable=t==w.CLICKABLE,this.roomColliderData[i][r].gridSize=this.baseGridSize,this.roomColliderData[i][r].faceVerts={};for(var n=0;n<a;++n){var o=9*n,l=new x.Vector3(s[o],s[o+1],s[o+2]),h=new x.Vector3(s[o+3],s[o+4],s[o+5]),d=new x.Vector3(s[o+6],s[o+7],s[o+8]),c=h.clone().sub(l),u=d.clone().sub(l),p=c.clone().cross(u),m=this.getGridKey(r,"_",this.flattenVector3(l),this.flattenVector3(h),this.flattenVector3(d)),v={object:e,key:m,verts:[l,h,d],edge0:c,edge1:u,normal:p};this.roomColliderData[i][r].faceVerts[m]=v}}}))}}}isGridEdgeIntersecting(e,t,i,s,a,r){var n=t.x,o=t.z,l=0!==n?(i-e.x)/n:1/0,h=0!==n?(s-e.x)/n:-1/0,d=0!==o?(a-e.z)/o:1/0,c=0!==o?(r-e.z)/o:-1/0,u=Math.max(Math.min(l,h),Math.min(d,c)),p=Math.min(Math.max(l,h),Math.max(d,c));return p>=u&&p>=0&&u<=1}getGridKey(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return t.join(this.delimiter)}flattenVector3(e){return this.getGridKey(this.pxlUtils.toNearestStr(e.x),this.pxlUtils.toNearestStr(e.y),this.pxlUtils.toNearestStr(e.z))}addFaceToGridLocation(e,t,i,s,a){var r=this.getGridKey(i,s);this.roomColliderData[e][t].faceGridGroup[r]||(this.roomColliderData[e][t].faceGridGroup[r]=[]),this.roomColliderData[e][t].faceGridGroup[r].push(a)}castRay(e,t,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w.FLOOR,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:E.DOUBLE;if(!this.roomColliderData.hasOwnProperty(e)||!this.roomColliderData[e].hasOwnProperty(s))return this.error("Room '"+e+"' does not have collider data for type: "+s),this.error(" -- Please register any collider objects with `pxlColliders.prepColliders()` or `pxlColliders.prepInteractables` first -- "),[];var r=this.roomColliderData[e][s],n=1/r.gridSize,o=Math.floor(t.x*n),l=Math.floor(t.z*n),h=this.getGridKey(o,l),d=1,c=1;if(a==E.FRONT?d=0:a==E.BACK&&(c=0),!r.faceGridGroup.hasOwnProperty(h))return[];var u=r.faceGridGroup[h],p={};u.forEach((e=>{var s=r.faceVerts[e],a=s.verts[0],n=s.edge0,o=s.edge1,l=i.clone().cross(o),h=n.dot(l);if(!(h*d>-this.epsilon&&h*c<this.epsilon)){var u=t.clone().sub(a),m=u.dot(l);if(!(m<0||m>h)){var v=u.clone().cross(n),g=i.dot(v);if(!(g<0||m+g>h)){var f=1/h;m*=f,g*=f;var x=f*o.dot(v);if(x>this.epsilon){var y=t.clone().add(i.clone().multiplyScalar(x));p[x]={object:s.object,pos:y,dist:x}}}}}}));var m=Object.keys(p);m.sort();for(var v=[],g=0;g<m.length;++g)v.push(p[m[g]]);if(r.helper){var f=v.length>0?v[0]:-1;this.setHelperActiveFace(e,s,f)}return v}castGravityRay(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w.FLOOR,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this.roomColliderData.hasOwnProperty(e)||!this.roomColliderData[e].hasOwnProperty(i))return[];for(var a=this.roomColliderData[e][i],r=a.gridSize,n=a.faceGridGroup,o=1/r,l=Math.floor(t.x*o),h=Math.floor(t.z*o),d=[this.getGridKey(l-1,h-1),this.getGridKey(l-1,h),this.getGridKey(l,h-1),this.getGridKey(l,h),this.getGridKey(l+1,h),this.getGridKey(l,h+1),this.getGridKey(l+1,h+1)],c=[],u=0;u<d.length;++u)null!=n&&n.hasOwnProperty(d[u])&&c.push(...n[d[u]]);if(0==(c=Object.keys(a.faceVerts)).length)return[];c=[...new Set(c)];for(var p={},m=0;m<c.length;++m){var v=a.faceVerts[c[m]],g=v.verts[0],f=v.verts[1],x=v.verts[2],y=t.clone().sub(g),b=v.normal,C=y.dot(b)/b.dot(b),P=t.clone().sub(b.clone().multiplyScalar(C)),S=x.sub(g),E=f.sub(g),D=P.clone().sub(g),M=S.dot(S),L=S.dot(E),T=S.dot(D),A=E.dot(E),k=E.dot(D),R=M*A-L*L;if(0!=R){var _=(A*T-L*k)*(R=1/(M*A-L*L)),O=(M*k-L*T)*R;if(_>=0&&O>=0&&_+O<1){var I=g.clone().add(S.multiplyScalar(_)).add(E.multiplyScalar(O)),B=t.distanceTo(I),G={object:v.object,pos:I,dist:B};if(p[B]=G,!s)return[G]}}}var j=Object.keys(p);j.sort();for(var U=[],V=0;V<j.length;++V)U.push(p[j[V]]);if(a.helper){var F=U.length>0?U[0]:-1;this.setHelperActiveFace(e,i,F)}return U}castInteractRay(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,x.Vector2)(0,0),a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=new x.Vector3(0,0,0);i.getWorldDirection(r);var n=i.position.clone(),o=i.fov*this.degToRad,l=Math.tan(.5*o),h=i.aspect,d=s.x*h*l,c=s.y*l,u=new x.Vector3(d,c,-1).applyMatrix4(i.matrixWorld).sub(i.position).normalize(),p={};t.forEach((t=>{var i=t.name,s=this.roomColliderData[e][i].faceVerts;Object.keys(s).forEach((e=>{var i=s[e],r=i.verts[0],o=i.verts[1],l=i.verts[2],h=i.edge0,d=i.edge1,c=i.normal,m=c.dot(u);if(!(Math.abs(m)<1e-6)){var v=(c.dot(r)-c.dot(n))/m;if(!(v<0)){var g=n.clone().add(u.clone().multiplyScalar(v)),f=r.clone().sub(g),x=o.clone().sub(g),y=l.clone().sub(g),b=x.clone().cross(y).length(),C=y.clone().cross(f).length(),P=f.clone().cross(x).length(),S=b+C+P,w=b/S,E=C/S,D=P/S;if(w>=0&&w<=1&&E>=0&&E<=1&&D>=0&&D<=1){var M=r.clone().add(h.multiplyScalar(w)).add(d.multiplyScalar(E)),L=n.distanceTo(M);if(p[L]={obj:t,pos:g},!a)return{obj:t,pos:g}}}}}))}));var m=Object.keys(p);m.sort();for(var v={order:[],hits:{},hitCount:0},g=0;g<m.length;++g){var f=p[m[g]].obj,y=p[m[g]].pos,b=f.name;v.order.push(f),v.hits.hasOwnProperty(b)||(v.hits[b]=[]),v.hits[b].push(y),v.hitCount++}return v}toColorId(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:256,i=1/t,s=1/(t*t);return[Math.floor(e*s)%t*i,Math.floor(e*i)%t*i,e%t*i]}getRandomColorIdList(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,t=Array.from({length:e},((e,t)=>t)),i=parseInt(Math.floor(t.length/3));i+=1&i?0:1;for(var s=[],a=0;a<e&&0!=t.length;++a){if(1==t.length){s.push(t.pop());break}var r=i*a%t.length,n=t.splice(r,1);s.push(n[0])}return s}buildHelper(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w.FLOOR,i=e.getName(),s=this.roomColliderData[i][t],a=s.count;this.log("Building helper for "+i+" with "+a+" triangles");var r=new x.BufferGeometry,n=[],o=[],l=[],h=this.getRandomColorIdList(a),d=parseInt(a**.5);Object.keys(s.faceVerts).forEach(((e,t)=>{var i=s.faceVerts[e].verts;n.push(i[0].x,i[0].y+.1,i[0].z),n.push(i[1].x,i[1].y+.1,i[1].z),n.push(i[2].x,i[2].y+.1,i[2].z),l.push(0,0,0);var a=this.toColorId(h[t],d);o.push(...a,...a,...a)}));var c=new Float32Array(n),u=new Float32Array(o),p=new Float32Array(l);r.setAttribute("position",new x.BufferAttribute(c,3)),r.setAttribute("colorId",new x.BufferAttribute(u,3)),r.setAttribute("visibility",new x.BufferAttribute(p,1));var m=new x.ShaderMaterial({uniforms:{visibleFaceId:{value:-1}},vertexShader:"\n        uniform float visibleFaceId;\n\n        attribute vec3 colorId;\n        attribute float visibility;\n\n        varying vec4 vCd;\n        varying float vVisibility;\n\n        void main() {\n          vVisibility = visibility*.5+.5;\n          \n          vCd = vec4( normalize(colorId), 0.50 ); // Pre-calculated Blue for visible face\n          if (visibleFaceId == 1.0) {\n            vCd = vec4( 0.0, 1.0, 0.0, 1.0 ); // Green for visible face\n          }\n\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n      ",fragmentShader:"\n        varying vec4 vCd;\n        varying float vVisibility;\n\n        void main() {\n\n          vec4 Cd = vCd;\n          //Cd.a *= vVisibility;\n          //Cd.rgb = vec3( vVisibility );\n\n          gl_FragColor = Cd;\n        }\n      "});m.side=x.DoubleSide,m.transparent=!0,m.depthTest=!0,m.depthWrite=!1,m.blending=x.AdditiveBlending;var v=new x.Mesh(r,m);return v.renderOrder=2,this.roomColliderData[i][t].helper=v,v}stepHelper(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w.FLOOR,i=e.getName(),s=this.roomColliderData[i][t],a=s.helper,r=s.faceGridGroup,n=1/s.gridSize,o=Math.floor(e.position.x*n),l=Math.floor(e.position.z*n),h=this.getGridKey(o,l);r[h];if(this.prevGridKey!=h)a.geometry.attributes.visibility.array}setHelperActiveFace(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w.FLOOR,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.roomColliderData[e][t].helper.material.uniforms.visibleFaceId.value=i}destroy(e){if(this.objNames.includes(e)){this.animMixer[e].stopAllAction(),delete this.animMixer[e],delete this.objects[e];var t=this.objNames.indexOf(e);this.objNames.splice(t,1)}}},Animation:class Animation{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.pxlEnv=null,this.assetPath=e,this.verbose=!1,this.animInitEntry={rig:null,mesh:null,mixer:null,clips:{},state:null,hasConnection:!1,prevTime:-1,connected:[],connections:{}},this.objNames=[],this.objects={},this.animMixer={},this.msRunner=t,this.clock=new x.Clock}setDependencies(e){this.pxlEnv=e}log(e){this.verbose&&console.log(e)}initObject(e,t){for(var i=null,s=null,a=t.children.length,r=0,n=[...t.children],o=0,l=0,h=0,d=0;r<a;){var c=n[r];switch(c.type){case"Bone":++l,i=c;break;case"Mesh":++o,c.visible=!1;break;case"SkinnedMesh":++h,s=c;break;case"Group":++d,a=(n=n.concat(c.children)).length}++r}var u=!1;if(i||(this.log("Error, No Bone/Rig Root Found; Please move your rig to the scene's root. Grouped rigs aren't supported yet."),u=!0),s||(this.log("Error, No SkinnedMesh Found; Please ensure your rig has a mesh to animate."),u=!0),u)return console.log("Unable to prepare '"+e+"' for animation"),console.log("Group Count: "+d),console.log("Bone Root Found : "+(l>0)),console.log("Bone Count : "+l),console.log("Mesh Count: "+o),void console.log("SkinnedMesh Count: "+h);if(!this.objNames.includes(e)){this.objNames.push(e);var p=Object.assign({},this.animInitEntry);p.rig=i,p.mesh=s,this.animMixer[e]=new x.AnimationMixer(i),p.mixer=this.animMixer[e],this.objects[e]=p;var m=new x.MeshStandardMaterial;m.map=s.material.map,s.material=m}}addClips(e,t,i){if(this.objNames.includes(e)){Object.keys(this.objects[e].clips).includes(t)&&this.log("Warning, '"+t+"' already exists in '"+e+"'");var s=this.animMixer[e].clipAction(i.animations[0]);this.objects[e].clips[t]=s}else this.log("Error, '"+e+"' not found in Animation Manager")}hasClip(e,t){return!!this.objNames.includes(e)&&Object.keys(this.objects[e].clips).includes(t)}getMixer(e){return this.objNames.includes(e)?this.animMixer[e]:null}getRig(e){return this.objNames.includes(e)?this.objects[e].rig:null}getMesh(e){return this.objNames.includes(e)?this.objects[e].mesh:null}playClip(e,t){if(this.objNames.includes(e)&&Object.keys(this.objects[e].clips).includes(t)){var i=this.objects[e].clips[t];this.objects[e].state=t,this.objects[e].prevTime=-1,this.objects[e].hasConnection=this.objects[e].connected.includes(t),this.setWeight(e,t,1,!0),i.reset(),i.play()}}setWeight(e,t,i){var s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.objNames.includes(e)){var a=Object.keys(this.objects[e].clips);if(a.includes(t)){var r=this.objects[e].clips[t];r.enabled=!0,r.setEffectiveTimeScale(1),r.setEffectiveWeight(i),s&&a.forEach((i=>{if(i!=t){var s=this.objects[e].clips[i];s.enabled=!1,s.setEffectiveTimeScale(1),s.setEffectiveWeight(0)}}))}}}setStateConnections(e,t){if(this.objNames.includes(e)){var i=Object.keys(t);this.objects[e].connected=i,this.objects[e].connections=t}}step(e){if(this.objNames.includes(e)){if(!this.objects[e].hasConnection)return void this.animMixer[e].update(this.clock.getDelta());var t=this.objects[e].state;if(t){var i=this.objects[e].clips[t].time;if(this.objects[e].prevTime>i){var s=this.objects[e].connections[t],a=s[Math.floor(Math.random()*s.length)];this.playClip(e,a)}else this.animMixer[e].update(this.clock.getDelta()),this.objects[e].prevTime=i}else this.animMixer[e].update(this.clock.getDelta())}}destroy(e){if(this.objNames.includes(e)){this.animMixer[e].stopAllAction(),delete this.animMixer[e],delete this.objects[e];var t=this.objNames.indexOf(e);this.objNames.splice(t,1)}}},Environment:class Environment{constructor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Default",i=arguments.length>2?arguments[2]:void 0;this.engine=null,this.scene=null,this.parentGroupList={},this.parentGroupList[t]=[],this.parentNameList=[],this.pxlOptions=e,this.prevRenderMS=0,this.nextRenderMS=0,this.fps=i?this.pxlOptions.fps.Mobile:this.pxlOptions.fps.PC,this.renderInterval=1/this.fps;var s="Default";s=this.pxlOptions.hasOwnProperty("pxlRoomName")?this.pxlOptions.pxlRoomName:t,this.pxlRoomAbsRoot=s;var a=s.split("/");a.splice(0,1),a=a.join("/"),s=s.startsWith("./")?s.slice(1):s,this.pxlOptions.hasOwnProperty("pxlRoomRoot")?this.pxlRoomLclRoot=this.pxlOptions.pxlRoomRoot:this.pxlRoomLclRoot="./"+s.split("/").pop().join("/"),this.mainRoom=t,this.bootRoom=t,this.bootLocation=null,this.currentRoom=t,this.roomNameList=[t],this.roomSubList={},this.roomSceneList={},this.roomSceneList[t]=this,this.roomPostGuiCalls=[],this.jmaCheckConnection=!1,this.checkContext=0,this.activeContext=!1,this.warpPortalTextures={},this.warpZoneRenderTarget=null,this.currentAudioZone=0,this.pxlUtils=null,this.pxlEnums=null,this.pxlTimer=null,this.pxlAnim=null,this.pxlColliders=null,this.pxlAutoCam=null,this.pxlAudio=null,this.pxlFile=null,this.pxlVideo=null,this.pxlQuality=null,this.pxlUser=null,this.pxlShaders=null,this.pxlDevice=null,this.pxlCamera=null,this.pxlGuiDraws=null,this.cloud3dTexture=null,this.softNoiseTexture=null,this.detailNoiseTexture=null,this.chroAberUVTexture=null,this.chroAberUVAlpha=null,this.blockAnimTexture=null,this.userScreenIntensity=new x.Vector2(0,.8),this.portaluserScreenIntensity=new x.Vector2(1,0),this.portalMtlRate=.7,this.mobile=i,this.camNear=.1,this.camFar=5e3,this.fogMult=new x.Vector2(0,0),this.fogColor=new x.Color(.07,.07,.1),this.fogColorSky=new x.Color(.1,.1,.12),this.fogExp=3e-4,this.fog=new x.FogExp2(this.fogColor,this.fogExp),this.listener=null,this.posted=!1,this.postIntro=!1,this.camLocation={},this.camInitPos=new x.Vector3(0,15,0),this.camInitLookAt=new x.Vector3(0,15,0),this.camThumbPos=new x.Vector3(0,0,0),this.camThumbLookAt=new x.Vector3(0,20,0),this.camReturnPos=new x.Vector3(0,0,0),this.camReturnLookAt=new x.Vector3(0,0,0),this.camLobbyPos=new x.Vector3(0,15,0),this.camLobbyLookAt=new x.Vector3(0,15,-100),this.pxlCamFOV={PC:60,MOBILE:80},this.pxlCamZoom=1,this.pxlCamAspect=1,this.pxlCamNearClipping=this.camNear,this.pxlCamFarClipping=this.camFar,this.groupList=[],this.geoList=[],this.geoLoadList=[],this.geoLoadListComplete=0,this.lightList=[],this.returnPortalGlowList=[],this.roomWarpVisuals={},this.proximityGeo=null,this.userAvatarGroup=new x.Group,this.warpVisualActive=!1,this.warpVisualMaxTime=[1.5,1],this.warpVisualStartTime=0,this.warpVisualFader=new x.Vector2(0,1),this.warpVisualCmd=null,this.stepShaderFuncArr=[],this.mapMotionBlurPass=null,this.mapCopyMotionBlurPass=null,this.mapOverlayHeavyPass=null,this.mapOverlayPass=null,this.mapOverlaySlimPass=null,this.mapBoxAAPass=null,this.mapCrossAAPass=null,this.mapWorldPosMaterial=null,this.mapGlowPass=null,this.mapGlowMotionBlur=null,this.mapComposer=null,this.mapComposerMotionBlur=null,this.mapComposerBloom=null,this.mapComposerGlow=null,this.chromaticAberrationPass=null,this.chroAberrationRoomPass=null,this.lizardKingPass=null,this.lizardKingRoomPass=null,this.mapComposerWarpPass=null,this.blurScreenMerge=null,this.pxlRenderSettings={exposure:1,mult:1,bloomStrength:.5,bloomThresh:.6,bloomRadius:.05},this.exposureShiftActive=!1,this.delayComposer=null,this.delayPass=null,this.chroAberMult=new x.Vector2(1,0),this.blurDirCur=new x.Vector2(0,0),this.blurDirPrev=new x.Vector2(0,0),this.shaderPasses={},this.roomComposer=null,this.roomRenderPass=null,this.roomBloomPass=null,this.roomGlowPass=null,this.blurComposer=null,this.glowPassMask=new x.Vector2(1,0),this.objectClickable=[],this.objectClickableObjectList={},this.clickablePrevActiveObject=null,this.promoClickable=[],this.promoClickableObjectList={},this.promoPrevActiveObject=null,this.promoClickableLinks={},this.remoteVideoTextureList=[],this.remoteUserNameList=[],this.remoteUserMediaList={},this.remoteUserVideoList=[],this.remoteUserAudioList=[],this.camScreenData={count:0,prevCount:0,checkUserCount:!0,checkVideoStatus:!0,findCamCount:()=>{},videoObjectList:[],screenGeoList:[],screenClickable:[],screenMtlUniforms:[],userDataList:[],camFindInfoList:[]},this.curUserCount=0,this.prevUserCount=0,this.emit=(e,t)=>{}}setDependencies(pxlNav){this.scene=pxlNav.scene,this.pxlUtils=pxlNav.pxlUtils,this.pxlEnums=pxlNav.pxlEnums,this.pxlTimer=pxlNav.pxlTimer,this.pxlAnim=pxlNav.pxlAnim,this.pxlColliders=pxlNav.pxlColliders,this.pxlAutoCam=pxlNav.pxlAutoCam,this.pxlAudio=pxlNav.pxlAudio,this.pxlFile=pxlNav.pxlFile,this.pxlVideo=pxlNav.pxlVideo,this.pxlQuality=pxlNav.pxlQuality,this.pxlUser=pxlNav.pxlUser,this.pxlShaders=pxlNav.pxlShaders,this.pxlDevice=pxlNav.pxlDevice,this.pxlCamera=pxlNav.pxlCamera,this.pxlGuiDraws=pxlNav.pxlGuiDraws,this.emit=pxlNav.emit.bind(pxlNav)}log(e){this.pxlOptions.verbose>b.INFO&&console.log(e)}init(){var e=Object.keys(this.pxlOptions);Object.keys(pxlOptions).forEach((t=>{e.includes(t)||(this.pxlOptions[t]=pxlOptions[t])})),Object.keys(this.roomSubList).forEach((e=>{this.roomSubList[e].init()}))}boot(){}setBootRoom(e,t){this.bootRoom=e,this.bootLocation=t}postBoot(){this.pxlGuiDraws.togglePageDisplay(),this.roomSceneList[this.bootRoom].start(),this.posted=!0,this.pxlOptions.showOnboarding&&(this.pxlDevice.mobile||this.pxlAutoCam.enabled?this.pxlGuiDraws.toggleMobileWelcome(!0):this.pxlGuiDraws.iconEvent("click",this.pxlGuiDraws.hudIcons.helpIcon,"help"))}postHelpIntro(){this.pxlDevice.mobile||this.pxlAutoCam.enabled?(this.pxlCamera.colliderValid=!0,this.pxlCamera.eventCheckStatus=!0,this.pxlCamera.colliderShiftActive=!0,this.pxlCamera.nearestFloorObjName="mobile",this.pxlCamera.colliderCurObjHit="AudioTrigger_2",this.pxlCamera.proximityScaleTrigger=!0,this.exposureShiftActive=!0,this.pxlDevice.mobile||(this.pxlAudio.play(),setTimeout((()=>{this.pxlAudio.initPlay()}),100))):this.pxlCamera.jogServerMemory(),this.postIntro=!0}start(){this.init()}step(){if(this.pxlTimer.step(),this.pxlAudio.step(),this.pxlQuality.step(),this.pxlAutoCam.step()&&this.pxlCamera.step(),this.pxlGuiDraws.step(),this.stepWarpPass(),this.pxlTimer.msRunner.x>this.checkContext&&this.activeContext){this.checkContext=this.pxlTimer.msRunner.x+1;var e=document.createElement("canvas");try{e.getContext("webgl")}catch(e){this.activeContext=!0,this.pxlGuiDraws.pxlNavCanvas.style.display="none"}}this.pxlDevice.mobile&&this.exposureShiftActive}stop(){var e=this;return function Environment_asyncToGenerator(e){return function(){var t=this,i=arguments;return new Promise((function(s,a){var r=e.apply(t,i);function _next(e){Environment_asyncGeneratorStep(r,s,a,_next,_throw,"next",e)}function _throw(e){Environment_asyncGeneratorStep(r,s,a,_next,_throw,"throw",e)}_next(void 0)}))}}((function*(){e.setExposure(0),Object.keys(e.roomSubList).forEach((t=>{e.roomSubList[t].stop()}))}))()}loadRoom(e){return new Promise(((t,i)=>{this.log("Loading Room - ",e);var s="".concat(this.pxlRoomLclRoot,"/").concat(e,"/").concat(e,".js");import(s).then((i=>{var s=new i[e](e,"".concat(this.pxlRoomLclRoot,"/").concat(e,"/"),this.pxlTimer.msRunner,null,null,this.cloud3dTexture);s.setDependencies(this),s.camera=this.pxlCamera.camera,s.scene=new x.Scene,s.userAvatarGroup||(s.userAvatarGroup=new x.Group),s.scene.add(s.userAvatarGroup);var a={format:x.RGBAFormat,antialias:!1,sortObjects:!0,alpha:!0,type:/(iPad|iPhone|iPod)/g.test(navigator.userAgent)?HalfFloatType:x.FloatType};s.scene.renderTarget=new x.WebGLRenderTarget(this.pxlDevice.sW*this.pxlQuality.screenResPerc,this.pxlDevice.sH*this.pxlQuality.screenResPerc,a),s.scene.renderTarget.texture.format=x.RGBAFormat,s.scene.renderTarget.texture.minFilter=x.LinearFilter,s.scene.renderTarget.texture.magFilter=x.LinearFilter,s.scene.renderTarget.texture.generateMipmaps=!1,s.scene.renderTarget.depthBuffer=!0,s.scene.renderTarget.depthTexture=new x.DepthTexture(this.pxlDevice.sW*this.pxlQuality.screenResPerc,this.pxlDevice.sH*this.pxlQuality.screenResPerc),s.scene.renderTarget.depthTexture.format=x.DepthFormat,s.scene.renderTarget.depthTexture.type=x.UnsignedShortType,s.cloud3dTexture=this.cloud3dTexture,this.roomNameList.includes(e)||this.roomNameList.push(e),this.roomSceneList[e]=s,t(!0)})).catch((e=>{this.pxlOptions.verbose>=b.ERROR&&console.log(e),i(e)}))}))}startAllRooms(){this.roomNameList.forEach((e=>{this.startRoom(this.roomSceneList[e])}))}startRoom(e){e.active=!1,e.startTime=this.pxlTimer.msRunner.x}newSubRoom(e){this.roomSubList[e.getName()]=e}addToRooms(e){var t={};return this.roomNameList.forEach((i=>{var s=e.clone();this.roomSceneList[i].scene.add(s),t[i]=s})),t}addToRoomLayers(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i={};return this.roomNameList.forEach((s=>{var a=e.clone();this.roomSceneList[s].scene.add(a),i[s]=a,a.layers.set(t)})),i}addToRoomParents(e,t){var i={};return this.parentNameList.includes(t)||this.parentNameList.push(t),this.roomNameList.forEach((s=>{var a=e.clone();if(this.parentGroupList[s]||(this.parentGroupList[s]={}),!this.parentGroupList[s][t]){var r=new x.Group;this.parentGroupList[s][t]=r,this.roomSceneList[s].scene.add(r)}this.parentGroupList[s][t].add(a),i[s]=a})),i}buildRoomEnvironments(){this.log("Building Room Environments"),this.log(this.roomNameList);this.roomNameList.forEach((e=>{this.roomSceneList[e].init(),this.roomSceneList[e].build&&this.roomSceneList[e].build()}))}getArtistInfo(){return null}setFogHue(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1],i=(this.fog.color.getHSL(),[t[0]-e[0],t[1]-e[1]]),s=Math.abs(.3183098861837907*Math.atan2(i[0],i[1])),a=(i[0]**2+i[1]**2)**.5/Math.max(this.pxlDevice.sW,this.pxlDevice.sH);this.fog.color.setHSL(s,.5*a+.3,.5*a),this.roomSceneList[this.currentRoom]&&this.roomSceneList[this.currentRoom].setFog&&this.roomSceneList[this.currentRoom].setFog(this.fog.color)}readShader(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if("script_fog"==e){if(this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,1==this.mapOverlayHeavyPass.enabled)return this.mapOverlayHeavyPass.material;if(1==this.mapOverlayPass.enabled)return this.mapOverlayPass.material;if(1==this.mapOverlaySlimPass.enabled)return this.mapOverlaySlimPass.material}else{if("script_dArrows"==e)return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.geoList.dArrows[0].material;if("script_userScreens"==e)return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.camScreenData.screenGeoList[0].material;if("script_warpZonePortals"==e)return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.returnPortalGlowList[0].material;if("script_lizardking"==e)return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.lizardKingPass.material;if("script_majorTom"==e)return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.pxlUser.starFieldPass.material;if("script_fractalSubstrate"==e)return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.pxlUser.crystallinePass.material;if("script_fractalEcho"==e)return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.delayPass.material;var t=e.split("_");if(t.shift(),t=t.join("_"),this.geoList[t])return this.pxlGuiDraws.guiWindows.shaderGui.currentShader=e,this.geoList[t].material}}setShader(e,t,i){var s,a=this.pxlGuiDraws.guiWindows.shaderGui.currentShader;if("script_fog"==a)1==this.mapOverlayHeavyPass.enabled?s=this.mapOverlayHeavyPass.material:1==this.mapOverlayPass.enabled?s=this.mapOverlayPass.material:1==this.mapOverlaySlimPass.enabled&&(s=this.mapOverlaySlimPass.material);else{if("script_dArrows"==a)return void this.geoList.dArrows.forEach((e=>{(s=e.material).vertexShader=t,s.fragmentShader=i,s.needsUpdate=!0}));if("script_userScreens"==a)return void this.camScreenData.screenGeoList.forEach((e=>{(s=e.material).vertexShader=t,s.fragmentShader=i,s.needsUpdate=!0}));if("script_warpZonePortals"==a)return void this.returnPortalGlowList.forEach((e=>{(s=e.material).vertexShader=t,s.fragmentShader=i,s.needsUpdate=!0}));if("script_lizardking"==a)s=this.lizardKingPass.material;else if("script_majorTom"==a)s=this.pxlUser.starFieldPass.material;else if("script_fractalSubstrate"==a)s=this.pxlUser.crystallinePass.material;else if("script_fractalEcho"==a)s=this.delayPass.material;else{var r=a.split("_");r.shift(),r=r.join("_"),this.geoList[r]&&(s=this.geoList[r].material)}}s&&(s.vertexShader=t,s.fragmentShader=i,s.needsUpdate=!0)}getAssetTexture(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.log("Get Internal Texture - ",e);var s=this.pxlUtils.assetRoot+e;if(!t){var a=e.split(".").pop().toLowerCase();"jpg"==a||"jpeg"==a?t=3:"png"==a&&(t=4)}return i||(i={encoding:x.LinearSRGBColorSpace,magFilter:x.LinearFilter,minFilter:x.LinearFilter}),this.pxlUtils.loadTexture(s,t,i)}buildBackgroundObject(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=new PlaneBufferGeometry,a={};Object.assign(a,e),null!=t&&"string"==typeof t||(t=this.pxlShaders.scene.bgScreenVert()),null!=i&&"string"==typeof i||(i=this.pxlShaders.scene.bgScreenFrag());var r=this.pxlFile.pxlShaderBuilder(a,t,i);r.side=DoubleSide,r.depthTest=!0,r.depthWrite=!1;var n=new Mesh(s,r);return n.frustumCulled=!1,n}clickUserDetect(){var e=this.roomSceneList[this.currentRoom],t=this.pxlUtils.screenToNDC(this.pxlDevice.mouseX,this.pxlDevice.mouseY,this.pxlDevice.sW,this.pxlDevice.sH),i={};if(e.hasColliderType(w.CLICKABLE)){var s=e.getColliders(w.CLICKABLE);i=this.pxlColliders.castInteractRay(this.currentRoom,s,this.pxlCamera.camera,t)}if(i.hasOwnProperty("order")&&i.order.length>0){var a=i.order[0];this.clickableActions(a.name)}else if(i={},(i=this.pxlColliders.castInteractRay(this.currentRoom,this.promoClickable,this.pxlCamera.camera,t)).hasOwnProperty("order")&&i.order.length>0){var r=i.order[0];this.promoActions(r)}}clickableActions(){"CallToAction"==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)&&this.clickablePrevActiveObject&&(this.pxlGuiDraws.ctaBuildPopup(),this.objectClickableObjectList[this.clickablePrevActiveObject].Inactive.visible=!0,this.objectClickableObjectList[this.clickablePrevActiveObject].Hover.visible=!1,this.clickablePrevActiveObject=null)}promoActions(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=e.userData.video;e.name;this.promoClickableLinks.hasOwnProperty(t)&&window.open(this.promoClickableLinks[t],"_blank").focus()}hoverUserDetect(){var e=this.roomSceneList[this.currentRoom],t=this.pxlUtils.screenToNDC(this.pxlDevice.mouseX,this.pxlDevice.mouseY,this.pxlDevice.sW,this.pxlDevice.sH),i={};if(e.hasColliderType(w.CLICKABLE)||e.hasColliderType(w.HOVERABLE)){var s=[...e.getColliders(w.CLICKABLE),...e.getColliders(w.HOVERABLE)];i=this.pxlColliders.castInteractRay(this.currentRoom,s,this.pxlCamera.camera,t)}if(i.hasOwnProperty("order")&&i.order.length>0){var a=i.order[0];return this.pxlDevice.setCursor("help"),void(this.objectClickableObjectList[a.name]&&(null==this.clickablePrevActiveObject&&(this.clickablePrevActiveObject=a.name),this.objectClickableObjectList[a.name].Inactive.visible=!1,this.objectClickableObjectList[a.name].Hover.visible=!0))}if(this.clickablePrevActiveObject&&(this.objectClickableObjectList[this.clickablePrevActiveObject].Inactive.visible=!0,this.objectClickableObjectList[this.clickablePrevActiveObject].Hover.visible=!1,this.clickablePrevActiveObject=null),this.pxlDevice.setCursor("grab"),i={},(i=this.pxlColliders.castInteractRay(this.currentRoom,this.promoClickable,this.pxlCamera.camera,t)).hasOwnProperty("order")&&i.order.length>0){var r=i.order[0];this.pxlDevice.setCursor("alias"),this.promoClickableObjectList[r.name]&&(null==this.promoPrevActiveObject&&(this.promoPrevActiveObject=r.name),this.promoClickableObjectList[r.name].x=1)}else this.promoPrevActiveObject&&(this.promoClickableObjectList[this.promoPrevActiveObject].x=.1,this.promoPrevActiveObject=null),this.pxlDevice.setCursor("grab")}updateCompUniforms(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&(this.pxlRenderSettings.exposure=e*this.pxlRenderSettings.mult),this.mapOverlayPass&&(this.mapMotionBlurPass.uniforms.exposure.value=this.pxlRenderSettings.exposure,this.mapOverlayHeavyPass.uniforms.exposure.value=this.pxlRenderSettings.exposure,this.mapOverlayPass.uniforms.exposure.value=this.pxlRenderSettings.exposure,this.mapOverlaySlimPass.uniforms.exposure.value=this.pxlRenderSettings.exposure)}sendRoomMessage(e,t,i){this.roomSceneList[e]&&this.roomSceneList[e].onMessage(t,i)}buildComposers(){this.mapWorldPosMaterial=new x.ShaderMaterial({uniforms:{camNear:{type:"f",value:this.pxlCamera.camera.near},camFar:{type:"f",value:this.pxlCamera.camera.far}},vertexShader:this.pxlShaders.rendering.worldPositionVert(),fragmentShader:this.pxlShaders.rendering.worldPositionFrag()}),this.mapWorldPosMaterial.side=x.FrontSide,this.mapWorldPosMaterial.name="mapWorldPosMaterial",this.blurComposer=new M.EffectComposer(this.engine),this.shaderPasses.blurXShaderPass=new T.ShaderPass(new x.ShaderMaterial({uniforms:{time:{value:this.time},tDiffuse:{value:null},pDiffuse:{value:null},resUV:{value:this.pxlDevice.screenRes}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.directionalBlurPass("pDiffuse",[1,0],4,1.8),defines:{}}),"tDiffuse"),this.shaderPasses.blurXShaderPass.material.uniforms.pDiffuse=this.scene.renderGlowTarget.texture,this.shaderPasses.blurXShaderPass.material.transparent=!0,this.shaderPasses.blurXShaderPass.needsSwap=!0,this.shaderPasses.blurXShaderPass.enabled=!1,this.shaderPasses.blurXShaderPass.name="blurXShaderPass",this.blurComposer.addPass(this.shaderPasses.blurXShaderPass),this.shaderPasses.dirBlurCopyPass=new T.ShaderPass(A.CopyShader),this.shaderPasses.dirBlurCopyPass.enabled=!1,this.shaderPasses.dirBlurCopyPass.name="dirBlurCopyPass",this.blurComposer.addPass(this.shaderPasses.dirBlurCopyPass),this.shaderPasses.blurYShaderPass=new T.ShaderPass(new x.ShaderMaterial({uniforms:{time:{value:this.time},tDiffuse:{value:null},pDiffuse:{value:null},resUV:{value:this.pxlDevice.screenRes}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.directionalBlurPass("pDiffuse",[0,1],4,1.3),defines:{}}),"tDiffuse"),this.shaderPasses.blurYShaderPass.material.uniforms.pDiffuse=this.scene.renderGlowTarget.texture,this.shaderPasses.blurYShaderPass.material.transparent=!0,this.shaderPasses.blurYShaderPass.enabled=!1,this.shaderPasses.blurYShaderPass.name="blurYShaderPass",this.blurComposer.addPass(this.shaderPasses.blurYShaderPass),this.shaderPasses.scatterMixShaderPass=new T.ShaderPass(new x.ShaderMaterial({uniforms:{time:{value:this.time},tDiffuse:{value:null},pDiffuse:{value:null},resUV:{value:this.pxlDevice.screenRes}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.mixBlurShaderPass(),defines:{}}),"tDiffuse"),this.shaderPasses.scatterMixShaderPass.material.uniforms.pDiffuse=this.scene.renderGlowTarget.texture,this.shaderPasses.scatterMixShaderPass.material.transparent=!0,this.shaderPasses.scatterMixShaderPass.enabled=!1,this.shaderPasses.scatterMixShaderPass.name="scatterMixShaderPass",this.blurComposer.addPass(this.shaderPasses.scatterMixShaderPass),this.pxlOptions.antiAliasing==C.LOW?this.shaderPasses.scatterMixShaderPass.enabled=!0:this.pxlOptions.antiAliasing==C.MEDIUM?(this.shaderPasses.blurXShaderPass.enabled=!0,this.shaderPasses.dirBlurCopyPass.enabled=!0,this.shaderPasses.blurYShaderPass.enabled=!0):this.pxlOptions.antiAliasing==C.HIGH&&(this.shaderPasses.blurXShaderPass.enabled=!0,this.shaderPasses.dirBlurCopyPass.enabled=!0,this.shaderPasses.blurYShaderPass.enabled=!0,this.shaderPasses.scatterMixShaderPass.enabled=!0),this.mapComposerMotionBlur=new M.EffectComposer(this.engine),this.mapMotionBlurPass=new T.ShaderPass(new x.ShaderMaterial({uniforms:{tDiffuse:{value:null},rDiffuse:{value:null},exposure:{type:"f",value:this.pxlRenderSettings.exposure},time:{value:this.pxlTimer.msRunner},camRotXYZ:{value:this.pxlCamera.camRotXYZ},blurDirCur:{type:"f",value:this.blurDirCur},blurDirPrev:{type:"f",value:this.blurDirPrev},noiseTexture:{value:this.cloud3dTexture}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.motionBlurPostProcess(this.pxlDevice.screenRes,this.pxlDevice.mobile),defines:{}}),"tDiffuse"),this.mapMotionBlurPass.material.uniforms.rDiffuse=this.scene.renderTarget.texture,this.mapMotionBlurPass.needsSwap=!0,this.mapMotionBlurPass.name="mapMotionBlurPass",this.mapComposerMotionBlur.addPass(this.mapMotionBlurPass),this.mapMotionBlurPass.enabled=!1,this.mapComposerMotionBlur.renderToScreen=!1,this.mapComposerGlow=new M.EffectComposer(this.engine);var e=new L.RenderPass(this.scene,this.pxlCamera.camera);this.mapComposerGlow.addPass(e),this.blurScreenMerge=new T.ShaderPass(new x.ShaderMaterial({uniforms:{tDiffuse:{value:null},rDiffuse:{value:null},mtDiffuse:{value:null},exposure:{type:"f",value:this.pxlRenderSettings.exposure}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.compLayersPostProcess(),defines:{}}),"tDiffuse"),this.blurScreenMerge.material.uniforms.rDiffuse=this.scene.renderTarget.texture,this.blurScreenMerge.material.uniforms.mtDiffuse=this.scene.renderTarget.texture,this.blurScreenMerge.needsSwap=!0,this.blurScreenMerge.name="blurScreenMerge",this.mapComposerGlow.addPass(this.blurScreenMerge);var t=new T.ShaderPass(A.CopyShader);t.name="glowCopyPassBlur",this.mapComposerGlow.addPass(t),this.mapComposerGlow.renderToScreen=!1,this.mapComposerGlow.autoClear=!0,this.mapOverlayHeavyPass=new T.ShaderPass(new x.ShaderMaterial({uniforms:{gamma:{type:"f",value:this.pxlDevice.gammaCorrection},exposure:{type:"f",value:this.pxlRenderSettings.exposure},time:{value:this.pxlTimer.msRunner},camPos:{value:this.pxlCamera.camera.position},ratio:{type:"f",value:1},tDiffuse:{value:null},rDiffuse:{value:null},bloomTexture:{value:null},sceneDepth:{value:null},scenePos:{value:null},noiseTexture:{value:this.cloud3dTexture},fogMult:{value:this.fogMult},proximityMult:{value:1}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.finalOverlayHeavyShader(),defines:{}}),"tDiffuse"),this.mapOverlayHeavyPass.material.uniforms.rDiffuse=this.scene.renderTarget.texture,this.mapOverlayHeavyPass.material.uniforms.bloomTexture=this.mapComposerGlow.renderTarget2.texture,this.mapOverlayHeavyPass.material.uniforms.sceneDepth=this.scene.renderTarget.depthTexture,this.mapOverlayHeavyPass.material.uniforms.scenePos=this.scene.renderWorldPos.texture,this.mapOverlayHeavyPass.needsSwap=!0,this.mapOverlayHeavyPass.name="mapOverlayHeavyPass",this.mapOverlayPass=new T.ShaderPass(new x.ShaderMaterial({uniforms:{gamma:{type:"f",value:this.pxlDevice.gammaCorrection},exposure:{type:"f",value:this.pxlRenderSettings.exposure},time:{value:this.pxlTimer.msRunner},camPos:{value:this.pxlCamera.camera.position},ratio:{type:"f",value:1},tDiffuse:{value:null},rDiffuse:{value:null},bloomTexture:{value:null},sceneDepth:{value:null},scenePos:{value:null},noiseTexture:{value:this.cloud3dTexture},fogMult:{value:this.fogMult},proximityMult:{value:1}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.finalOverlayShader(),defines:{}}),"tDiffuse"),this.mapOverlayPass.material.uniforms.rDiffuse=this.scene.renderTarget.texture,this.mapOverlayPass.material.uniforms.bloomTexture=this.mapComposerGlow.renderTarget2.texture,this.mapOverlayPass.material.uniforms.sceneDepth=this.scene.renderTarget.depthTexture,this.mapOverlayPass.material.uniforms.scenePos=this.scene.renderWorldPos.texture,this.mapOverlayPass.needsSwap=!0,this.mapOverlayPass.name="mapOverlayPass",this.mapOverlaySlimPass=new T.ShaderPass(new x.ShaderMaterial({uniforms:{gamma:{type:"f",value:this.pxlDevice.gammaCorrection},exposure:{type:"f",value:this.pxlRenderSettings.exposure},time:{value:this.pxlTimer.msRunner},camPos:{value:this.pxlCamera.camera.position},ratio:{type:"f",value:1},tDiffuse:{value:null},rDiffuse:{value:null},bloomTexture:{value:null},sceneDepth:{value:null},fogMult:{value:this.fogMult},proximityMult:{value:1}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.finalOverlaySlimShader(),defines:{}}),"tDiffuse"),this.mapOverlaySlimPass.material.uniforms.rDiffuse=this.scene.renderTarget.texture,this.mapOverlaySlimPass.material.uniforms.bloomTexture=this.mapComposerGlow.renderTarget2.texture,this.mapOverlaySlimPass.material.uniforms.sceneDepth=this.scene.renderTarget.depthTexture,this.mapOverlaySlimPass.needsSwap=!0,this.mapOverlaySlimPass.name="mapOverlaySlimPass",this.mapGlowPass=new T.ShaderPass(new x.ShaderMaterial({uniforms:{time:{value:this.pxlTimer.msRunner},ratio:{type:"f",value:1},tDiffuse:{value:null},rDiffuse:{value:null},sceneDepth:{value:null}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.glowPassPostProcess(),defines:{}}),"tDiffuse"),this.mapGlowPass.material.uniforms.rDiffuse=this.scene.renderGlowTarget.texture,this.mapGlowPass.material.uniforms.sceneDepth=this.scene.renderTarget.depthTexture,this.mapGlowPass.needsSwap=!0,this.mapGlowPass.name="mapGlowPass",this.mapComposer=new M.EffectComposer(this.engine),this.mapComposer.addPass(this.mapOverlayHeavyPass),this.mapComposer.addPass(this.mapOverlayPass),this.mapComposer.addPass(this.mapOverlaySlimPass),this.mapComposer.addPass(this.mapGlowPass),this.mapOverlayHeavyPass.enabled=!1,this.mapOverlayPass.enabled=!1,this.pxlUser.lKingWarp=new x.Vector2(...this.pxlUser.lKingInactive),this.lizardKingPass=new T.ShaderPass(new x.ShaderMaterial({uniforms:{tDiffuse:{value:null},time:{value:this.pxlTimer.msRunner},ratio:{value:this.pxlDevice.screenRes},noiseTexture:{value:this.cloud3dTexture}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.lKingPostProcess(),defines:{}}),"tDiffuse"),this.pxlUser.lizardKingPass=this.lizardKingPass,this.lizardKingPass.enabled=!1,this.pxlUser.lizardKingPass.name="lizardKingPass",this.pxlUser.starFieldPass=new T.ShaderPass(new x.ShaderMaterial({uniforms:{tDiffuse:{value:null},time:{value:this.pxlTimer.msRunner},ratio:{value:this.pxlDevice.screenRes},noiseTexture:{value:this.cloud3dTexture},starTexture:{value:this.pxlUtils.loadTexture(this.pxlUtils.assetRoot+"uv_starNoise.jpg",null,{encoding:x.LinearSRGBColorSpace})}},vertexShader:this.pxlShaders.rendering.sFieldPostProcessVert(),fragmentShader:this.pxlShaders.rendering.sFieldPostProcessFrag(),defines:{}}),"tDiffuse"),this.pxlUser.starFieldPass.enabled=!1,this.pxlUser.starFieldPass.name="starFieldPass",this.pxlUser.crystallinePass=new T.ShaderPass(new x.ShaderMaterial({uniforms:{tDiffuse:{value:null},tDiffusePrev:{type:"t",value:null},time:{value:this.pxlTimer.msRunner},ratio:{value:this.pxlDevice.screenRes},noiseTexture:{value:this.cloud3dTexture}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.iZoomPostProcess(),defines:{}}),"tDiffuse"),this.pxlUser.crystallinePass.enabled=!1,this.pxlUser.crystallinePass.name="crystallinePass",this.pxlOptions.postProcessPasses.chromaticAberrationPass&&(this.chromaticAberrationPass=new T.ShaderPass(new x.ShaderMaterial({uniforms:{tDiffuse:{value:null},ratio:{value:this.pxlDevice.screenRes},warpMult:{value:this.chroAberMult},chroAberUVTexture:{value:this.chroAberUVTexture},chroAberUVAlpha:{value:this.chroAberUVAlpha},lKing:{value:this.pxlUser.lKingWarp}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.chroAberPostProcess(),defines:{}}),"tDiffuse"),this.chromaticAberrationPass.enabled=!1,this.chromaticAberrationPass.name="chromaticAberrationPass",this.mapComposer.addPass(this.chromaticAberrationPass)),this.pxlOptions.postProcessPasses.lizardKingPass&&this.mapComposer.addPass(this.lizardKingPass),this.pxlOptions.postProcessPasses.starFieldPass&&this.mapComposer.addPass(this.pxlUser.starFieldPass),this.pxlOptions.postProcessPasses.crystallinePass&&this.mapComposer.addPass(this.pxlUser.crystallinePass),this.pxlOptions.postProcessPasses.mapComposerWarpPass&&(this.mapComposerWarpPass=new T.ShaderPass(new x.ShaderMaterial({uniforms:{time:{value:this.pxlTimer.msRunner},fader:{value:this.warpVisualFader},tDiffuse:{value:null},noiseTexture:{value:this.cloud3dTexture},animTexture:{value:this.blockAnimTexture}},vertexShader:this.pxlShaders.core.camPosVert(),fragmentShader:this.pxlShaders.rendering.warpPostProcess(),defines:{}}),"tDiffuse"),this.mapComposerWarpPass.needsSwap=!0,this.mapComposerWarpPass.enabled=!1,this.mapComposerWarpPass.name="mapComposerWarpPass",this.mapComposer.addPass(this.mapComposerWarpPass)),this.mapBoxAAPass=new T.ShaderPass(new x.ShaderMaterial({uniforms:{tDiffuse:{value:null},resUV:{type:"f",value:this.pxlDevice.screenRes},ratio:{type:"f",value:1},gamma:{type:"f",value:this.pxlDevice.gammaCorrection}},vertexShader:this.pxlShaders.core.camPosVert(),fragmentShader:this.pxlShaders.rendering.boxAntiAliasPass(),defines:{}}),"tDiffuse"),this.mapBoxAAPass.enabled=!1,this.mapBoxAAPass.name="mapBoxAAPass",this.mapComposer.addPass(this.mapBoxAAPass),this.mapCrossAAPass=new T.ShaderPass(new x.ShaderMaterial({uniforms:{tDiffuse:{value:null},resUV:{type:"f",value:this.pxlDevice.screenRes},ratio:{type:"f",value:1},gamma:{type:"f",value:this.pxlDevice.gammaCorrection}},vertexShader:this.pxlShaders.core.camPosVert(),fragmentShader:this.pxlShaders.rendering.crossAntiAliasPass(),defines:{}}),"tDiffuse"),this.mapCrossAAPass.enabled=!1,this.mapCrossAAPass.name="mapCrossAAPass",this.mapComposer.addPass(this.mapCrossAAPass),this.mapComposer.autoClear=!0;var i=this.roomSceneList[this.bootRoom].scene;this.roomComposer=new M.EffectComposer(this.engine),this.roomRenderPass=new L.RenderPass(i,this.pxlCamera.camera),this.roomRenderPass.name="roomRenderPass",this.roomComposer.addPass(this.roomRenderPass),this.roomNameList.forEach((e=>{if(e!=this.mainRoom){var t=this.roomSceneList[e].applyRoomPass(this.roomComposer);t&&(t.enabled=!1,this.roomComposer.addPass(t))}})),this.roomBloomPass=new k.UnrealBloomPass(new x.Vector2(.5*this.pxlDevice.mapW,.5*this.pxlDevice.mapH),1.5,.8,.85),this.roomBloomPass.threshold=this.pxlRenderSettings.bloomThresh,this.roomBloomPass.strength=this.pxlRenderSettings.bloomStrength,this.roomBloomPass.radius=this.pxlRenderSettings.bloomRadius,this.roomBloomPass.name="roomBloomPass",this.roomComposer.addPass(this.roomBloomPass),this.pxlOptions.postProcessPasses.roomGlowPass&&(this.roomGlowPass=new T.ShaderPass(new x.ShaderMaterial({uniforms:{time:{value:this.pxlTimer.msRunner},ratio:{type:"f",value:1},tDiffuse:{value:null},gDiffuse:{value:null},rDiffuse:{value:null},sceneDepth:{value:null}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.glowPassPostProcess(),defines:{}}),"tDiffuse"),this.roomGlowPass.material.uniforms.gDiffuse=this.blurComposer.writeBuffer.texture,this.roomGlowPass.material.uniforms.rDiffuse=this.blurComposer.renderTarget2.texture,this.roomGlowPass.material.uniforms.sceneDepth=this.scene.renderTarget.depthTexture,this.roomGlowPass.needsSwap=!0,this.roomGlowPass.name="roomGlowPass",this.roomComposer.addPass(this.roomGlowPass)),this.pxlOptions.postProcessPasses.chromaticAberrationPass&&this.roomComposer.addPass(this.chromaticAberrationPass),this.pxlOptions.postProcessPasses.lizardKingPass&&this.roomComposer.addPass(this.lizardKingPass),this.pxlOptions.postProcessPasses.starFieldPass&&this.roomComposer.addPass(this.pxlUser.starFieldPass),this.pxlOptions.postProcessPasses.crystallinePass&&this.roomComposer.addPass(this.pxlUser.crystallinePass),this.pxlOptions.postProcessPasses.mapComposerWarpPass&&this.roomComposer.addPass(this.mapComposerWarpPass),this.roomComposer.addPass(this.mapCrossAAPass),this.roomComposer.addPass(this.mapBoxAAPass),this.roomComposer.autoClear=!0,this.delayComposer=new M.EffectComposer(this.engine);new L.RenderPass(this.scene,this.pxlCamera.camera);this.delayPass=new T.ShaderPass(new x.ShaderMaterial({uniforms:{tDiffuse:{value:null},roomComposer:{type:"f",value:0},tDiffusePrev:{value:null},tDiffusePrevRoom:{value:null}},vertexShader:this.pxlShaders.core.defaultVert(),fragmentShader:this.pxlShaders.rendering.textureStorePass(),defines:{}}),"tDiffuse"),this.delayPass.material.uniforms.tDiffusePrev=this.mapComposer.renderTarget1.texture,this.delayPass.material.uniforms.tDiffusePrevRoom=this.roomComposer.renderTarget1.texture,this.delayPass.clear=!1,this.delayComposer.addPass(this.delayPass),this.delayComposer.renderToScreen=!1,this.delayComposer.autoClear=!1,this.pxlUser.crystallinePass.uniforms.tDiffusePrev.value=this.delayComposer.renderTarget2.texture}setExposure(e){e*=1,this.pxlCamera.uniformScalars.exposureUniformBase=e,this.updateCompUniforms(e)}stepWarpPass(){if(this.warpVisualActive){var e=(this.pxlTimer.curMS-this.warpVisualStartTime)/this.warpVisualMaxTime[this.pxlCamera.warpType],t=Math.min(1,3*e),i=Math.min(1,3-3*e);1==t&&1==i&&this.pxlCamera.warpActive&&this.pxlCamera.warpCamRun(),this.warpVisualFader.x=t,this.warpVisualFader.y=i,i<=0&&this.stopWarpVisual()}}checkUserVideoStatus(e){}remoteUserUpdateMedia(e){}userRemoveRemoteData(e){}stepShaderValues(){this.stepShaderFuncArr.forEach((e=>{"object"==typeof e?e.step():"string"==typeof e&&(console.log("Does this trigger?"),console.log(e))}))}stepAnimatedObjects(){this.pxlUser.itemListNames.length>0&&this.pxlUser.itemListNames.forEach((e=>{this.pxlUser.itemList[e].rotation.y=this.pxlTimer.msRunner.x*this.pxlUser.itemRotateRate}))}initWarpVisual(e){this.warpVisualActive=!0,this.warpVisualFader.x=0,this.warpVisualFader.y=1,this.warpVisualStartTime=this.pxlTimer.curMS,this.mapComposerWarpPass&&(this.mapComposerWarpPass.enabled=!0)}stopWarpVisual(){this.warpVisualActive=!1,this.warpVisualFader.x=1,this.warpVisualFader.y=0,this.mapComposerWarpPass&&(this.mapComposerWarpPass.enabled=!!this.pxlUser.iZoom)}prepPortalRender(){}cleanupPortalRender(){}setPortalTexture(e,t){this.roomWarpVisuals[t].material.map=e}warpPortalQueue(){return Object.keys(this.roomSceneList).reverse()}getSceneSnapshot(e){var t=this.roomSceneList[e];this.engine.setRenderTarget(t.warpZoneRenderTarget),t.prepPortalRender(),this.engine.render(t.scene||t.scene,this.pxlCamera.camera),t.cleanupPortalRender(),this.engine.setRenderTarget(null)}mapRender(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.pxlTimer.active&&this.step(),this.pxlTimer.curMS>this.nextRenderMS||0==e){this.prevRenderMS=this.nextRenderMS,this.nextRenderMS=this.pxlTimer.curMS+this.renderInterval,this.stepShaderValues(),this.stepAnimatedObjects();var t=this.roomSceneList[this.currentRoom];t&&t.booted&&(t.step(),t.camera.layers.disable(this.pxlEnums.RENDER_LAYER.SKY),this.engine.setRenderTarget(t.scene.renderTarget),this.engine.clear(),this.engine.render(t.scene,t.camera),this.engine.setRenderTarget(null),t.camera.layers.enable(this.pxlEnums.RENDER_LAYER.SKY),this.mapComposerGlow&&(this.pxlQuality.settings.bloom||this.pxlQuality.settings.fog)&&this.mapComposerGlow.render(),this.mapRenderBlurStack(t,t.camera,t.scene,this.scene.renderGlowTarget),this.roomComposer.render()),this.pxlUser.iZoom&&this.delayComposer.render()}else if(this.pxlOptions.subTickCalculations){var i=this.roomSceneList[this.currentRoom];i&&i.booted&&i.step()}this.pxlTimer.active&&e&&requestAnimationFrame((()=>{this.mapRender()}))}mapRenderBlurStack(e,t,i,s){if(this.blurComposer){e.geoList.GlowPass&&(e.geoList.GlowPass.forEach((e=>{if(e.userData.hasOwnProperty("GlowPerc")){var t=e.userData.GlowPerc;e.material.hasOwnProperty("uniforms")&&e.material.uniforms.mult&&(e.material.uniforms.mult.value=t)}})),e.geoList.hasOwnProperty("GlowPassMask")&&e.geoList.GlowPassMask.forEach((e=>{e.material.uniforms&&e.material.uniforms.cdMult&&(e.material.uniforms.cdMult.value=0)}))),t.layers.disable(this.pxlEnums.RENDER_LAYER.SCENE),t.layers.disable(this.pxlEnums.RENDER_LAYER.PARTICLES),t.layers.disable(this.pxlEnums.RENDER_LAYER.SKY),this.engine.setRenderTarget(s);var a=i.background.clone();i.background.set(0),this.engine.setClearColor(0,0),this.engine.render(i,t),i.background.r=a.r,i.background.g=a.g,i.background.b=a.b,t.layers.enable(this.pxlEnums.RENDER_LAYER.SCENE),t.layers.enable(this.pxlEnums.RENDER_LAYER.PARTICLES),t.layers.enable(this.pxlEnums.RENDER_LAYER.SKY),this.engine.setRenderTarget(null),e.geoList.GlowPass&&(e.geoList.GlowPass.forEach((e=>{e.userData.hasOwnProperty("GlowPerc")&&e.material.hasOwnProperty("uniforms")&&e.material.uniforms.mult&&(e.material.uniforms.mult.value=1)})),e.geoList.hasOwnProperty("GlowPassMask")&&e.geoList.GlowPassMask.forEach((e=>{e.material.uniforms&&e.material.uniforms.cdMult&&(e.material.uniforms.cdMult.value=1)}))),this.blurComposer.render(),this.roomBloomPass.enabled=!1}}},GUI:class GUI extends GUIManager{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Metal-Asylum",arguments.length>2&&void 0!==arguments[2]?arguments[2]:"images/assets/",arguments.length>3&&void 0!==arguments[3]?arguments[3]:"images/GUI/"),this.verbose=e,this.lableBoxSize=40,this.optionWidthRound=10,this.optionWidthAdd=25,this.deviceOptionHeight=[0,300],this.ShaderEditor=null,this.pxlLoaderTotal=5,this.hudVisibility=!0,this.camChoicesActive=!1,this.micChoicesActive=!1,this.textDescriptions={chatIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">C</span> )</span><br>chat',pos:[1,-1.5]},multiverseIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">U</span> )</span><br>multiverse<br>selection',pos:[0,-1.3]},djPlayerVolumeParent:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">B</span> )</span><br>music volume',pos:[0,-1.5]},speakerIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">N</span> )</span><br>mute people<br>pick audio output',pos:[0,-1.5]},micIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">M</span> )</span><br>mute/pick<br>mic input',pos:[0,-1.5]},camIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">V</span> )</span><br>enable/pick<br>video input',pos:[0,-1.5]},helpIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">?</span> )</span><br>help &<br>instructions',pos:[0,-1.5]},infoIconParent:{text:'Info <span class="helpHotKeyParent">( <span class="helpHotKey">I</span> )</span>',pos:[-1,0],offset:[-10,0]},settingsIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">G</span> )</span><br>graphics &<br>navigation',pos:[0,-1.5]},muteAllIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">N</span> )</span><br>mute all users',pos:[1,0]},fullScreenIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">F</span> )</span><br>toggle full screen',pos:[-1,0]},videoQualityIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">H</span> )</span><br>video quality settings',pos:[-1,0]},statsIcon:{text:"jitsi connection status; toggle connection ",pos:[1,0]},usersIcon:{text:'<span class="helpHotKeyParent">( <span class="helpHotKey">T</span> )</span> user moderator tools',pos:[1,0]},ft2Button:{text:"Environment",pos:[-1,0],offset:[-10,0]},ft3Button:{text:"Invite Friends",pos:[-1,0],offset:[-10,0]},hud_userCount:{text:"# of People",pos:[-1,0],offset:[-10,0]}},this.activeItem=null,this.actionPopUp=null,this.init()}setDependencies(pxlNav){super.setDependencies(pxlNav),this.ShaderEditor=new ShaderEditor(pxlNav,this)}init(){super.init()}booted(){super.booted()}step(){super.step()}toggleShaderEditor(){this.ShaderEditor.toggleShaderEditor()}resize(e){super.resize(),this.ShaderEditor&&this.ShaderEditor.resize(e)}},Camera:class Camera{constructor(){this.standingHeight=1.75,this.movementScalar=1,this.hasMovementLimit=!0,this.movementMax=10,this.jumpScalar=1,this.userScale=1,this.maxStepHeight=5,this.cameraEasing=[.55,.45],this.touchMaxSensitivity=500,this.cameraJumpImpulse=[.75,1.5],this.cameraMaxJumpHold=[2.85,2],this.gravityCount=0,this.gravityRate=0,this.gravityMax=15.5,this.gravityUPS=[.3,.15],this.pxlAudio=null,this.pxlTimer=null,this.pxlAutoCam=null,this.pxlEnv=null,this.pxlColliders=null,this.pxlUser=null,this.pxlUtils=null,this.pxlDevice=null,this.pxlGuiDraws=null,this.pxlQuality=null,this.pxlOptions=null,this.socket=null,this.camera=null,this.canMove=!0,this.HDRView=!1,this.camUpdated=!0,this.cameraBooted=!1,this.hasMoved=!1,this.hasRotated=!1,this.hasJumped=!1,this.hasJumpLock=!1,this.hasGravity=!1,this.roomStandingHeight={default:this.standingHeight},this.standingHeightGravInfluence=0,this.standingMaxGravityOffset=.5,this.walkBounceSeed=230,this.walkBounceHeight=.3,this.walkBounce=0,this.walkBouncePerc=0,this.walkBounceRate=.025,this.walkBounceEaseIn=.03,this.walkBounceEaseOut=.95,this.posRotEasingThreshold=.01,this.cameraMovement=[0,0],this.cameraMovementEase=.85,this.cameraMoveLength=0,this.cameraMoveLengthMult=.1,this.camPosBlend=.65,this.camRotXYZ=new x.Vector3(0,0,0),this.camRotPitch=new x.Vector2(0,0),this.cameraJumpActive=!1,this.cameraAllowJump=!0,this.cameraJumpHeight=0,this.cameraJumpVelocity=0,this.cameraJumpVelocityEaseOut=.9,this.cameraJumpInAir=!1,this.floorColliderInitialHit=!1,this.colliderValidityChecked=!0,this.nearestFloorHit=new x.Vector3(0,0,0),this.nearestFloorObjName=null,this.nearestFloorHitPrev=new x.Vector3(0,0,0),this.nearestFloorObjNamePrev=null,this.gravitySourceActive=!1,this.gravityDirection=new x.Vector3(0,-1,0),this.gravityEaseOutRate=.5,this.jump=0,this.releaseJumpLockTime=0,this.releaseJumpLockDelay=.08,this.runMain=!0,this.workerActive=!1,this.worker=null,this.workerTransfers=!1,this.workerMessage=()=>{},this.workerFunc=()=>{},this.deviceKey=()=>{},this.portalList={},this.roomWarpZone=[],this.colliderCurObjHit=null,this.colliderPrevObjHit=null,this.colliderValid=!1,this.colliderFail=!1,this.warpActive=!1,this.warpType=0,this.warpObj=null,this.warpTarget=null,this.hotKeyTriggered=!1,this.eventCheckStatus=!1,this.proximityScaleTrigger=!1,this.colliderShiftActive=!0,this.colliderAdjustPerc=0,this.colliderAdjustRate=.02,this.gyroGravity=[0,0,0],this.cameraPose={alpha:null,beta:null,gamma:null,alphaOffset:0,betaOffset:0,gammaOffset:0,orientation:window.orientation||0,pos:[0,0,0],posOffset:[0,0,0],rx:()=>this.beta,ry:()=>this.alpha,rz:()=>this.gamma,accelZeroed:[0,0,0],accelCalibration:10,accelCalDiv:.1,accelCalCount:0,accelTotal:[0,0,0],accelPrev:null,accelDelta:[0,0,0],accelClearDelta:()=>{this.accelDelta=[0,0,0]}},this.uniformScalars={curExp:1,darkBase:.1,brightBase:.5,exposureUniformBase:1},this.cameraPosLookAtNames={default:{pos:"position",lookAt:"lookat"},mobile:{pos:"positionmobile",lookAt:"lookatmobile"},vr:{pos:"positionvr",lookAt:"lookatvr"}},this.cameraPos=new x.Vector3(0,0,0),this.cameraPrevPos=new x.Vector3(0,0,0),this.cameraPrevLookAt=new x.Vector3(0,0,0),this.cameraAim=new x.Vector3(0,0,1),this.cameraAimTarget=new x.Vector3(0,0,0),this.cameraCross=new x.Vector3(1,0,0),this.lookAtTargetActive=new x.Vector3(0,0,0),this.lookAtPerc=new x.Vector2(1,0),this.lookAtLockPerc=0,this.lookAtLockFader=0,this.lookAtLockFadeRate=.01,this.prevQuaternion=new x.Quaternion,this.pi=3.141592653589793,this.touchSensitivityLimits=this.touchMaxSensitivity*this.pi,this.eventCallbacks={},this.init()}setDependencies(pxlNav){this.pxlAudio=pxlNav.pxlAudio,this.pxlTimer=pxlNav.pxlTimer,this.pxlAutoCam=pxlNav.pxlAutoCam,this.pxlEnv=pxlNav.pxlEnv,this.pxlColliders=pxlNav.pxlColliders,this.pxlUser=pxlNav.pxlUser,this.pxlUtils=pxlNav.pxlUtils,this.pxlDevice=pxlNav.pxlDevice,this.pxlGuiDraws=pxlNav.pxlGuiDraws,this.pxlQuality=pxlNav.pxlQuality,this.pxlOptions=pxlNav.pxlOptions,this.socket=pxlNav.socket}log(e){this.verbose>=b.INFO&&console.log(e)}warn(e){this.verbose>=b.WARN&&console.warn(e)}error(e){this.verbose>=b.ERROR&&console.error(e)}init(){}updateMainValues(e){var{gravityRate:t,standingHeightGravInfluence:i,cameraJumpImpulse:s}=e;null!=t&&(this.gravityRate=t),null!=i&&(this.standingHeightGravInfluence=i),null!=s&&(this.cameraJumpVelocity+=s),this.camUpdated=!0}setUserHeight(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";e=Math.max(e,.01),this.roomStandingHeight.hasOwnProperty(t)||(this.roomStandingHeight[t]=this.standingHeight),"default"==t&&(this.standingHeight=e),this.roomStandingHeight[t]=e}setMaxStepHeight(e){e=Math.max(e,.01),this.maxStepHeight=e}setUserScale(e){e=Math.max(e,.01),this.userScale=e}setMovementScalar(e){e=Math.max(e,.01),this.movementScalar=e}setMovementMax(e){e=Math.max(e,.01),this.movementMax=e}setMovementEase(e){e=Math.min(1,Math.max(e,.01)),this.cameraMovementEase=e}setPositionBlend(e){e=Math.min(1,Math.max(e,.01)),this.camPosBlend=e}setInputMovementMult(e){e=Math.max(e,.01),this.cameraMoveLengthMult=e}setJumpScalar(e){e=Math.max(e,.01),this.jumpScalar=e}setJumpImpulse(e){e=Math.max(e,.01),this.cameraJumpImpulse[0]=e}setJumpHoldMax(e){e=Math.max(e,.01),this.cameraMaxJumpHold[0]=e}setJumpRepeatDelay(e){e=Math.max(e,.01),this.releaseJumpLockDelay=e}setCameraRotateEasing(e){Array.isArray(e)||("number"==typeof e?(e=[e,e],this.warn("Warning : Camera.setCameraEasing() expects an array of two numeric values, [PC Easing 0-1, Mobile Easing 0-1]; Default is [.55,.45]")):this.error("Error : Camera.setCameraEasing() unexpected values type; expecting an array of two numeric values, [PC Easing 0-1, Mobile Easing 0-1]; Default is [.55,.45]")),this.cameraEasing=e}setTouchSensitivity(e){e<=0&&(e=1),this.touchMaxSensitivity=e,this.touchSensitivityLimits=this.touchMaxSensitivity*this.pi}setGravityRate(e){e<=0&&(e=1),this.gravityRate=e}setGravityMax(e){e<=0&&(e=1),this.gravityMax=e}setWalkBounceHeight(e){e<=0&&(e=0),this.walkBounceHeight=e}setWalkBounceRate(e){e<=0&&(e=1e-4),this.walkBounceRate=e}setWalkBounceEaseIn(e){e=Math.min(1,Math.max(e,1e-4)),this.walkBounceEaseIn=e}setWalkBounceEaseOut(e){e=Math.min(1,Math.max(e,.01)),this.walkBounceEaseOut=e}setUserSettings(e){e.hasOwnProperty("height")&&(e.height.hasOwnProperty("standing")&&this.setUserHeight(e.height.standing),e.height.hasOwnProperty("stepSize")&&this.setMaxStepHeight(e.height.stepSize)),e.hasOwnProperty("movement")&&(e.movement.hasOwnProperty("scalar")&&this.setMovementScalar(e.movement.scalar),e.movement.hasOwnProperty("max")&&this.setMovementMax(e.movement.max),e.movement.hasOwnProperty("easing")&&this.setMovementEase(e.movement.easing)),e.hasOwnProperty("headBounce")&&(e.headBounce.hasOwnProperty("height")&&this.setWalkBounceHeight(e.headBounce.height),e.headBounce.hasOwnProperty("rate")&&this.setWalkBounceRate(e.headBounce.rate),e.headBounce.hasOwnProperty("easeIn")&&this.setWalkBounceEaseIn(e.headBounce.easeIn),e.headBounce.hasOwnProperty("easeOut")&&this.setWalkBounceEaseOut(e.headBounce.easeOut)),e.hasOwnProperty("jump")&&(e.jump.hasOwnProperty("impulse")&&this.setJumpScalar(e.jump.impulse),e.jump.hasOwnProperty("holdMax")&&this.setJumpHoldMax(e.jump.holdMax),e.jump.hasOwnProperty("repeatDelay")&&this.setJumpRepeatDelay(e.jump.repeatDelay)),e.hasOwnProperty("gravity")&&(e.gravity.hasOwnProperty("UPS")&&this.setGravityRate(e.gravity.UPS),e.gravity.hasOwnProperty("Max")&&this.setGravityMax(e.gravity.Max))}step(){this.pxlDevice.directionKeyDown&&this.updateMovement(this.pxlTimer.prevMS),this.runMain&&(this.hasJumpLock&&this.pxlTimer.runtime>this.releaseJumpLockTime&&(this.hasJumpLock=!1,this.hasGravity=!1,this.cameraAllowJump=!0,this.camInitJump()),this.hasGravity&&this.cameraJumpActive?this.camJump(this.pxlTimer.prevMS):this.cameraJumpVelocity>0&&this.killJumpImpulse(this.pxlTimer.deltaTime)),this.camUpdated=this.camUpdated||this.hasMoved||this.hasRotated||this.hasGravity||0!=this.cameraMovement[0]||0!=this.cameraMovement[1],this.updateCamera(),this.lowQualityUpdates(),this.midQualityUpdates(),this.eventCheck()}eventCheck(){this.colliderValid&&this.eventCheckStatus&&this.eventTrigger(this.nearestFloorObjName)&&this.warpEventTriggered(1,this.nearestFloorObjName)}updateDeviceValues(e){if(!this.pxlQuality.settings.leftRight){var t=-this.cameraMovement[0];this.pxlDevice.touchMouseData.active||(this.pxlDevice.touchMouseData.velocity.x+=t),this.pxlDevice.touchMouseData.netDistance.x+=4*t}if(null!=this.pxlDevice.touchMouseData.velocity&&0==this.pxlDevice.mobile){if(e<this.posRotEasingThreshold)this.pxlDevice.touchMouseData.velocity.multiplyScalar(0);else{var i=this.cameraEasing[this.pxlDevice.mobile?1:0];this.pxlDevice.touchMouseData.velocity.multiplyScalar(i)}this.pxlDevice.touchMouseData.netDistance.add(this.pxlDevice.touchMouseData.velocity.clone().multiply(this.pxlDevice.touchMouseData.moveMult))}}buildDeviceMonitors(){}updateCameraMatrices(){this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.updateWorldMatrix()}resetCameraCalculations(e){this.cameraMovement[0]=0,this.cameraMovement[1]=0,this.pxlDevice.touchMouseData.curFadeOut.multiplyScalar(0),this.pxlDevice.touchMouseData.velocity.multiplyScalar(0),this.pxlDevice.touchMouseData.netDistance.set(0,0),this.camera.position.copy(e),this.updateCameraMatrices(),this.cameraPos.copy(e),this.cameraPrevPos.copy(e),this.colliderCurObjHit=null,this.colliderPrevObjHit=null,this.camUpdated=!0,this.hasMoved=!0}setFOV(e){this.camera.fov=e,this.camera.updateProjectionMatrix(),this.camUpdated=!0}setStats(e,t,i,s){this.camera.near=i,this.camera.far=s,this.setFOV(e)}setAspect(e){this.camera.aspect=e,this.camera.updateProjectionMatrix()}setTransform(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.resetCameraCalculations(e),t&&(this.cameraAimTarget.position.copy(t),this.camera.lookAt(t),this.cameraPrevLookAt.copy(t),this.updateCameraMatrices(),this.pxlDevice.touchMouseData.initialQuat=this.camera.quaternion.clone()),this.resetGravity(),this.camUpdated=!0}setToObj(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.resetCameraCalculations(e.position),t){var i=t.position.clone();this.cameraAimTarget.position.copy(i),this.camera.lookAt(i),this.cameraPrevLookAt.copy(i),this.updateCameraMatrices(),this.pxlDevice.touchMouseData.initialQuat=this.camera.quaternion.clone()}else this.pxlDevice.touchMouseData.initialQuat=e.quaternion.clone(),this.camera.setRotationFromQuaternion(this.pxlDevice.touchMouseData.initialQuat),this.updateCameraMatrices();this.resetGravity(),this.camUpdated=!0,this.hasMoved=!0,this.hasRotated=!0,this.colliderCheck(e.position),this.nearestFloorObjName=null}warpToRoom(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=Object.keys(this.pxlEnv.roomSceneList),a=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom];i=(i=i||"default").toLowerCase();var r=e.toLowerCase(),n=this.pxlEnv.roomSceneList.hasOwnProperty(this.pxlEnv.currentRoom);a&&!s.includes(e)&&a.camLocation.hasOwnProperty(r)?(i=r,e=this.pxlEnv.currentRoom):(n&&this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].stop(),a=this.pxlEnv.roomSceneList[e]);var o=this.pxlEnv.currentRoom,l=!1;n&&this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].hasOwnProperty("camHoldWarpPos")&&(l=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].camHoldWarpPos),this.pxlEnv.currentRoom=e,this.pxlAutoCam.curRoom=e;var h=e==this.pxlEnv.mainRoom;if(this.pxlUser.iZoom){var d=h?this.pxlEnv.roomComposer:this.pxlEnv.mapComposer,c=h?this.pxlEnv.mapComposer:this.pxlEnv.roomComposer;this.pxlEnv.delayPass.uniforms.tDiffusePrev.value=d.renderTarget1.texture,this.pxlEnv.delayPass.uniforms.tDiffusePrevRoom.value=c.renderTarget1.texture,setTimeout((()=>{o!=e&&(h?this.pxlEnv.roomComposer.reset():this.pxlEnv.mapComposer.reset()),setTimeout((()=>{this.pxlEnv.mapComposerWarpPass.needsSwap=!1}),500)}),100)}if(t){if(!a)return void this.warn("pxlCamera.warpToRoom(); pxlRoom not found - "+this.pxlEnv.currentRoom);e!=o&&a.start(),this.pxlEnv.roomRenderPass.scene=a.scene;var u=i.toLowerCase();if(a.camLocation.hasOwnProperty(u)){var p=this.cameraPosLookAtNames.default.pos,m=this.cameraPosLookAtNames.default.lookAt;this.pxlDevice.mobile&&(a.camLocation[u].hasOwnProperty(this.cameraPosLookAtNames.mobile.pos)&&(p=this.cameraPosLookAtNames.mobile.pos),a.camLocation[u].hasOwnProperty(this.cameraPosLookAtNames.mobile.lookAt)&&(m=this.cameraPosLookAtNames.mobile.lookAt));var v=a.camLocation[u][p],g=a.camLocation[u][m];this.setTransform(v,g)}else!a.camInitPos||!a.camInitLookAt||l&&this.pxlEnv.postIntro&&!this.hotKeyTriggered||(this.setTransform(a.camInitPos,a.camInitLookAt),this.hotKeyTriggered=!1)}else l&&this.pxlEnv.postIntro&&!this.hotKeyTriggered||(null!=i?this.setToObj(i):this.setTransform(a.camReturnPos,a.camReturnLookAt),this.hotKeyTriggered=!1);this.pxlGuiDraws.prepArtistInfo(a.getArtistInfo()),this.camUpdated=!0;var f=a.pxlCamFOV[this.pxlDevice.mobile?"MOBILE":"PC"];this.camera.fov=f,this.camera.zoom=a.pxlCamZoom,this.camera.aspect=a.pxlCamAspect,this.camera.near=a.pxlCamNearClipping,this.camera.far=a.pxlCamFarClipping,this.camera.updateProjectionMatrix();var x=this.getUserHeight();this.emitCameraTransforms(this.camera.position.clone(),x,!0),this.canMove&&(this.colliderValid=!1,this.hasGravity=!0),this.pxlAutoCam.checkStatus()}warpToRoomSnapshot(e){this.pxlEnv.currentRoom=e;var t=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom],i=t.pxlCamFOV[this.pxlDevice.mobile?"MOBILE":"PC"];this.camera.fov=i,this.camera.zoom=t.pxlCamZoom,this.camera.aspect=t.pxlCamAspect,this.camera.near=t.pxlCamNearClipping,this.camera.far=t.pxlCamFarClipping,this.camera.updateProjectionMatrix(),this.setTransform(t.camThumbPos,t.camThumbLookAt);var s=this.getUserHeight();this.emitCameraTransforms(this.camera.position.clone(),s,!0)}fastTravel(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.pxlAutoCam.enabled||((this.pxlAutoCam.active||this.pxlAutoCam.autoCamActive)&&this.pxlAutoCam.preAutoCamToggle(),this.hotKeyTriggered=!0,0==e&&this.warpEventTriggered(1,this.pxlEnv.currentRoom,"init"))}camJumpKey(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.camInitJump():(this.cameraJumpActive&&(this.cameraJumpActive=!1),this.cameraAllowJump=!0,this.hasJumpLock=!1)}camInitJump(){this.canMove&&!this.hasGravity&&this.cameraAllowJump&&(this.pxlDevice.keyDownCount[2]=this.pxlTimer.prevMS,this.cameraAllowJump=!1,this.cameraJumpActive=!0,this.cameraJumpInAir=!0,this.hasGravity=!0,this.gravityRate=0,this.cameraJumpVelocity=this.cameraJumpImpulse[this.pxlUser.lowGrav]*this.userScale,this.hasJumpLock&&(this.hasJumpLock=!1,this.nearestFloorHit=this.nearestFloorHitPrev))}camJump(e){var t=e-this.pxlDevice.keyDownCount[2],i=Math.min(1,t/this.cameraMaxJumpHold[this.pxlUser.lowGrav]);if(this.cameraJumpActive){var s=i;1==s?this.cameraJumpActive=!1:(s=(1-s)*(1-s),s*=.5*s+.5),this.cameraJumpVelocity+=Math.max(0,s)*this.cameraJumpImpulse[this.pxlUser.lowGrav]*this.jumpScalar*this.pxlTimer.deltaTime}this.cameraJumpVelocity*=1-i,1==i&&(this.cameraJumpActive=!1)}killJumpImpulse(e){var t=this.cameraJumpVelocity*this.cameraJumpVelocityEaseOut;this.cameraJumpVelocity=t>.1?t:0,this.workerFunc("killJumpImpulse")}updateGravity(e){if(this.runMain){this.gravityRate=Math.max(0,this.gravityRate-this.cameraJumpVelocity);var t=this.gravityUPS[this.pxlUser.lowGrav];if(this.hasGravity&&(this.gravityCount+=2.5*t*e,this.gravityRate=Math.min(1,this.gravityRate+this.gravityMax)*this.gravityCount),0!=this.gravityRate){var i=1;this.hasGravity||(this.gravityRate=this.gravityRate>.01?this.gravityRate*this.gravityEaseOutRate*t*e:0),i=this.gravityRate,i=Math.min(1,i),this.standingHeightGravInfluence=Math.min(1,this.gravityRate/this.gravityMax)*this.standingMaxGravityOffset}}}resetGravity(){this.gravityCount=0,this.gravityRate=0,this.workerFunc("resetGravity"),this.jumpLanding(!1)}jumpLanding(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.cameraJumpActive&&(this.hasJumpLock=!0,this.releaseJumpLockTime=this.pxlTimer.runtime+this.releaseJumpLockDelay),this.gravityCount=0,this.hasGravity=!1,this.cameraJumpVelocity=0,this.cameraJumpInAir=!1,this.cameraJumpActive=!1,e&&this.workerFunc("jumpLanding")}colliderCheck(e){if(!this.canMove)return e;var t=null;if(this.movementBlocked=!1,(this.cameraMoveLength>0||null==this.colliderPrevObjHit||null==this.nearestFloorObjName)&&this.cameraBooted&&this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].collidersExist){this.colliderValidityChecked=!0;var i=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom],s=new x.Vector3(0,-1,0),a=e.clone(),r=150*this.maxStepHeight;a.y+=r+this.maxStepHeight;var n=[];a.x,a.z;if(i.hasColliderType(w.WALL)&&(n=this.pxlColliders.castRay(this.pxlEnv.currentRoom,a,s,w.WALL)),n.length>0)if(i.hitColliders(n,w.WALL),i.hasColliderType(w.WALL_TOP)){var o=this.pxlColliders.castRay(this.pxlEnv.currentRoom,a,s,w.WALL_TOP);o.length>0&&i.hitColliders(o,w.WALL_TOP);for(var l,h,d=-99999,c=(e.y,this.nearestFloorHit),u=!1,p=0;p<o.length;++p){var m=o[p];l=m.object.name;var v=m.pos,g=m.dist,f=v.y<this.maxStepHeight;u=u||f,(g<d&&valid||null==t)&&(t=l,d=g,c=v)}(!u||e.y<c.y&&this.nearestFloorHitPrev.y-c.y>this.maxStepHeight+this.getStandingHeight()&&!this.hasGravity&&e.y+this.maxStepHeight+this.getStandingHeight()<c.y&&this.hasGravity)&&(0==this.cameraMovement[0]&&0==this.cameraMovement[1]||(u=!0,this.hasGravity=!1,this.hasJumpLock=!0),(h=this.cameraPos.clone()).y=Math.min(e.y,h.y),c=e=h,this.hasGravity?c.y=this.nearestFloorHitPrev.y:c.y=this.cameraPos.y,this.cameraJumpActive=!1,this.cameraAllowJump=!0,this.cameraJumpInAir=!1,this.cameraMovement[0]=0,this.cameraMovement[1]=0,this.pxlDevice.touchMouseData.curFadeOut.multiplyScalar(0),this.pxlDevice.touchMouseData.velocity.multiplyScalar(0)),u&&(null==t?(this.nearestFloorHit=this.nearestFloorHitPrev,this.nearestFloorObjName=this.nearestFloorObjNamePrev,Math.abs(e.y-this.nearestFloorHit.y)>this.maxStepHeight+this.getStandingHeight()&&(this.colliderValid=!1,this.hasGravity=!0)):(this.nearestFloorHitPrev=this.nearestFloorHit,this.nearestFloorObjNamePrev=this.nearestFloorObjName,this.nearestFloorHit=c,this.nearestFloorObjName=t))}else this.colliderFail=!0,this.movementBlocked=!0;else{var y=this.maxStepHeight;this.getStandingHeight();if((a=e.clone()).y+=r+this.maxStepHeight,!this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom].hasColliders())return e;if((n=this.pxlColliders.castRay(this.pxlEnv.currentRoom,a,s,w.FLOOR)).length>0){if(n.length>1){var b=Math.abs(n[0].pos.y-e.y);if(b<y)n=[n[0]];else if(b>y&&n[0].pos.y>n[1].pos.y&&n[1].pos.y>e.y-this.maxStepHeight)return e}this.floorColliderInitialHit=!0;for(var C,P=-99999,S=this.nearestFloorHit,E=0;E<n.length;++E){var D,M=n[E],L=M.pos;C=M.object.name;var T=L.distanceTo(e);if(D=T<this.maxStepHeight,(this.portalList[C]||this.roomWarpZone.includes(C))&&D){t=C,S=L;break}this.itemCheck(C,D)||(T<P||null==t)&&(t=C,P=T,S=L)}null==this.nearestFloorObjName&&null!=t&&(this.nearestFloorHitPrev=S,this.nearestFloorObjNamePrev=t,this.nearestFloorHit=S,this.nearestFloorObjName=t),this.nearestFloorHitPrev.y-S.y>this.maxStepHeight+this.getStandingHeight()&&!this.hasGravity?(this.nearestFloorHit=this.nearestFloorHitPrev,this.nearestFloorObjName=this.nearestFloorObjNamePrev,e=t?this.cameraPos.clone():this.cameraPrevPos.clone(),t=this.nearestFloorObjName,this.cameraMovement[0]=0,this.cameraMovement[1]=0,this.pxlDevice.touchMouseData.curFadeOut.multiplyScalar(0),this.pxlDevice.touchMouseData.velocity.multiplyScalar(0)):(this.nearestFloorHitPrev=this.nearestFloorHit,this.nearestFloorObjNamePrev=this.nearestFloorObjName,this.nearestFloorHit=S,this.nearestFloorObjName=t,null==t&&(this.colliderValid=!1,this.hasGravity=!0))}else this.colliderFail=!0,this.movementBlocked=!0,this.colliderValidityChecked=!1,e=this.cameraPos.clone()}}else this.colliderValidityChecked=!1;return this.colliderValidityChecked=!1,e}checkColliderValid(e){this.colliderValidityChecked=!0;var t=this.maxStepHeight+this.gravityRate,i=e.distanceTo(this.nearestFloorHit),s=i<t;return this.colliderValid=s,i}eventTrigger(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!this.canMove)return!1;if(!e)return!1;if(this.portalList[e])return this.warpEventTriggered(0,this.portalList[e]),this.eventCheckStatus=!1,!0;if(this.roomWarpZone.includes(e))return this.warpEventTriggered(1,e),this.eventCheckStatus=!1,!0;if(this.colliderShiftActive=this.colliderCurObjHit!=e||this.colliderShiftActive,this.colliderPrevObjHit=this.colliderCurObjHit,this.colliderCurObjHit=e,this.colliderShiftActive=this.colliderShiftActive||!(1==this.colliderAdjustPerc||0==this.colliderAdjustPerc),this.colliderShiftActive&&this.colliderCurObjHit){var t=1;this.colliderCurObjHit.includes("AudioTrigger")&&(t=-1),this.colliderAdjustPerc=Math.min(1,Math.max(0,this.colliderAdjustPerc+this.colliderAdjustRate*t));var i=1-this.colliderAdjustPerc,s=1;if("AudioTrigger_1"==this.colliderCurObjHit)this.pxlEnv.currentAudioZone=1,s-=i*this.uniformScalars.darkBase,this.uniformScalars.exposureUniformBase=s;else if("AudioTrigger_2"==this.colliderCurObjHit){this.pxlEnv.currentAudioZone=2;s=this.uniformScalars.curExp+i*this.uniformScalars.brightBase*1,this.uniformScalars.exposureUniformBase=s,this.proximityScaleTrigger=!0,this.pxlAudio.setFadeActive(-1)}else this.pxlEnv.currentAudioZone=0,s=s*(1-i)+this.uniformScalars.exposureUniformBase*i;if(this.colliderShiftActive=!(1==this.colliderAdjustPerc||0==this.colliderAdjustPerc),"AudioTrigger_2"==this.colliderPrevObjHit&&this.colliderCurObjHit!=this.colliderPrevObjHit&&(this.proximityScaleTrigger=!0,this.pxlAudio.setFadeActive(1)),this.pxlDevice.mobile&&(s=this.colliderAdjustPerc),this.pxlEnv.updateCompUniforms(s),this.proximityScaleTrigger&&!this.pxlDevice.mobile&&!this.pxlAutoCam.enabled){var a=this.colliderAdjustPerc;a=1-(1-a)*(1-a),this.pxlEnv.fogMult.x=a,this.colliderShiftActive||(this.proximityScaleTrigger=!1)}this.eventCheckStatus=this.colliderShiftActive}}itemCheck(e,t){if(!t)return!1;var i=e.split("_").shift();if(this.pxlUser.itemListNames.includes(e)&&this.pxlUser.checkItemPickUp(i))return this.itemActive(i,e);return!1}itemTrigger(){if(this.pxlUser.itemActiveTimer.length>0)this.pxlUser.itemActiveTimer[0]=this.pxlTimer.curMS;else{0==this.pxlUser.mPick.length&&(this.pxlUser.mPick=this.pxlUtils.randomizeArray(["LizardKing","StarField","InfinityZoom"]));var e=this.pxlUser.mPick.pop();this.pxlUser.checkItemPickUp(e),this.itemActive(e)}}itemActive(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null==e)return!1;var i=this.pxlTimer.prevMS+this.pxlUser.itemRunTime,s="",a="";if("LowGravity"==e)a="Low Gravity",s="this.lowGrav=0;this.itemGroupList['"+t+"'].visible=true;",i=this.pxlTimer.prevMS+this.pxlUser.itemRunTime;else if("LizardKing"==e)a="I am the Lizard King",s="this.lKing=0;this.lKingWarp.set(...this.lKingInactive);this.lizardKingPass.enabled=false;"+(!this.pxlDevice.mobile&&"this.itemGroupList['"+t+"'].visible=true;"),i=this.pxlTimer.prevMS+this.pxlUser.itemRunTime;else if("StarField"==e)a="Major Tom",s="this.sField=0;this.starFieldPass.enabled=false;"+(!this.pxlDevice.mobile&&"this.itemGroupList['"+t+"'].visible=true;"),i=this.pxlTimer.prevMS+this.pxlUser.itemRunTime;else{if("InfinityZoom"!=e)return!1;a="Fractal Substrate",s="this.iZoom=0;this.crystallinePass.enabled=false;"+(!this.pxlDevice.mobile&&"this.itemGroupList['"+t+"'].visible=true;this.pxlEnv.mapComposerWarpPass.needsSwap=true;this.pxlEnv.mapComposerWarpPass.enabled=false;"),i=this.pxlTimer.prevMS+this.pxlUser.itemRunTime,this.pxlEnv.mapComposerWarpPass.needsSwap=!0,setTimeout((()=>{this.pxlEnv.mapComposer.render(),this.pxlEnv.roomComposer.render(),setTimeout((()=>{this.pxlEnv.mapComposerWarpPass.needsSwap=!1,this.pxlEnv.mapComposerWarpPass.enabled=!0}),500)}),500)}return this.pxlGuiDraws.buildItemHud(e,a),this.pxlDevice.mobile||(this.pxlUser.itemGroupList[t].visible=!1),this.pxlUser.itemInactiveCmd.push(s),this.pxlUser.itemActiveTimer.push(i),this.pxlUser.itemActiveList.push(a),!0}toggleMovement(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null==e&&(e=!this.canMove),this.canMove=e,this.hasGravity=e}updateMovement(e){if(this.canMove){var t=[0,0],i=[...this.pxlDevice.directionKeysPressed],s=0,a=0,r=[e-this.pxlDevice.keyDownCount[0],e-this.pxlDevice.keyDownCount[1]],n=this.mobile?1:0;if(i[0]+i[2]==1){s=i[2]-i[0];var o=this.pxlQuality.settings.leftRight?this.cameraEasing[n]:.5*(1-Math.min(1,Math.abs(.3*this.cameraMovement[1])));t[0]=((this.pxlQuality.settings.leftRight?1:6)+r[0]*r[0]*.1)*o,t[0]=Math.min(this.pxlUser.moveSpeed,t[0])*this.movementScalar}else this.pxlDevice.keyDownCount[0]=e;if(i[1]+i[3]==1){a=i[3]-i[1];var l=(1-Math.min(1,Math.abs(.07*this.cameraMovement[0])))*this.cameraEasing[n];t[1]=r[1]*(3*r[1]+2+this.pxlUser.moveSpeed)*.5*l,t[1]=Math.min(this.pxlUser.moveSpeed,t[1])*this.movementScalar}else this.pxlDevice.keyDownCount[1]=e;t[0],t[1];this.hasMovementLimit=!0,this.movementMax=10,this.cameraMovement[0]+=s*t[0],this.cameraMovement[1]+=a*t[1]}}initFrameCamPosition(){var e=this.cameraPos.clone();if(this.cameraBooted){var t;t=new x.Vector3(this.pxlQuality.settings.leftRight?.5*this.cameraMovement[0]:0,0,this.cameraMovement[1]),this.cameraMoveLength=t.length(),t.applyQuaternion(this.camera.quaternion);var i=this.cameraMoveLength*this.cameraMoveLengthMult;if(0!=i){i=i>0?Math.max(.1,i):Math.min(-.1,i),t.normalize().multiply(new x.Vector3(1,0,1)).multiplyScalar(i),e.add(t),this.cameraMovement[0]=Math.abs(this.cameraMovement[0])<this.posRotEasingThreshold?0:this.cameraMovement[0]*this.cameraMovementEase,this.cameraMovement[1]=Math.abs(this.cameraMovement[1])<this.posRotEasingThreshold?0:this.cameraMovement[1]*this.cameraMovementEase,this.hasMoved=!0}e.y=this.cameraPos.y+this.cameraJumpVelocity,this.workerActive&&(this.cameraJumpVelocity=0)}else this.cameraAimTarget.position.set(0,0,0),this.cameraPrevPos=new x.Vector3(e.clone()),this.cameraPrevLookAt=new x.Vector3(0,0,1),this.hasMoved=!0,this.hasRotated=!0;return this.cameraCross=new x.Vector3(1,0,0).applyQuaternion(this.camera.quaternion),e}applyGravity(e){if(this.canMove&&this.hasGravity){this.maxStepHeight,this.gravityRate;if(e.y<this.nearestFloorHit.y){var t=this.nearestFloorHitPrev;e.y=Math.max(t.y,e.y),e.y<0&&(e.x=t.x,e.z=t.z)}else e.y=Math.max(this.nearestFloorHit.y,e.y-this.gravityRate),e.y==this.nearestFloorHit.y&&e.y<this.cameraPrevPos.y&&this.jumpLanding()}else{if(e.distanceTo(this.nearestFloorHit)<this.maxStepHeight)e.y=this.nearestFloorHit.y;else{var i=(e=this.cameraPos.clone()).y>this.nearestFloorHit.y;this.hasGravity=i,this.hasMoved=this.hasMoved||i,this.colliderFail=!i,this.workerFunc("jumpLanding")}}return e}getStandingHeight(){var e=this.standingHeight;return this.roomStandingHeight.hasOwnProperty(this.pxlEnv.currentRoom)&&(e=this.roomStandingHeight[this.pxlEnv.currentRoom]),e*this.userScale}getUserHeight(){var e=Math.min(1,Math.abs(this.cameraMovement[1]));this.walkBouncePerc=this.walkBouncePerc>=1?1:this.walkBouncePerc+this.walkBounceEaseIn*e,this.walkBounce+=e*this.walkBounceRate,this.walkBouncePerc=this.walkBouncePerc*this.walkBounceEaseOut+e,this.walkBouncePerc<.03&&(this.walkBouncePerc=0,this.walkBounce=0,this.walkBounceSeed=2351.3256*Math.random());var t=Math.sin(this.walkBounce+this.walkBounceSeed)*this.walkBouncePerc*this.walkBounceHeight;return this.getStandingHeight()-this.standingHeightGravInfluence+t}camApplyMobileRotation(){if(null!=this.cameraPose.alpha){var e=.017453292519943278,t=2.23606797749979,i=new x.Quaternion,s=this.cameraPose.alpha*e+this.cameraPose.alphaOffset+2.1,a=this.cameraPose.beta*e,r=this.cameraPose.gamma*e,n=new x.Vector3(0,0,1),o=new x.Quaternion,l=new x.Quaternion(-t,0,0,t),h=new x.Euler;h.set(a,s,-r,"YXZ"),i.setFromEuler(h),i.multiply(l),i.multiply(o.setFromAxisAngle(n,-this.cameraPose.orientation)),i.normalize();var d=new x.Quaternion;x.Quaternion.slerp(this.camera.quaternion,i,d,.35);var c=(new x.Euler).setFromQuaternion(d);c.x=Math.max(-.95*Math.PI/2,Math.min(.95*Math.PI/2,c.x)),d.setFromEuler(c),this.camera.setRotationFromQuaternion(d),this.hasRotated=!0}}updateRoamCameraRotation(){if(null==this.cameraPose.alpha){var e=this.pxlDevice.gyroGravity[2];new x.Vector3(0,0,1),new x.Quaternion;this.pxlDevice.touchMouseData.velocity.y=Math.min(this.touchSensitivityLimits,Math.max(-this.touchSensitivityLimits,this.pxlDevice.touchMouseData.velocity.y));var t,i=new x.Euler;this.pxlDevice.mobile?(i.set(this.pxlDevice.touchMouseData.netDistance.y/this.pxlDevice.sH*2,this.pxlDevice.touchMouseData.netDistance.x/this.pxlDevice.sW*2,0,"YXZ"),(t=new x.Quaternion).setFromEuler(i),t=this.pxlDevice.touchMouseData.initialQuat.clone().multiply(t)):(i.set(.005*this.pxlDevice.touchMouseData.velocity.y,.008*this.pxlDevice.touchMouseData.velocity.x+e,0,"YXZ"),(t=new x.Quaternion).setFromEuler(i),t=this.camera.quaternion.clone().multiply(t)),t.normalize();var s=new x.Vector3(0,0,-10).applyQuaternion(t).add(this.camera.position);this.camera.setRotationFromQuaternion(t),this.camera.lookAt(s),this.camera.up.set(0,1,0),this.hasRotated=!0}}updateStaticCameraRotation(){var e=1;this.touchBlender?(e=Math.min(1,Math.max(0,this.pxlTimer.curMS-this.pxlDevice.touchMouseData.releaseTime)),e*=e,this.pxlDevice.touchMouseData.netDistance.multiplyScalar(1-e),this.touchBlender=e<1):this.pxlDevice.touchMouseData.netDistance.multiplyScalar(.5);var t=new x.Euler;t.set(this.pxlDevice.touchMouseData.netDistance.y/this.pxlDevice.sH*2,this.pxlDevice.touchMouseData.netDistance.x/this.pxlDevice.sW*2,0,"YXZ");var i=(new x.Quaternion).clone(this.camera.quaternion);i.setFromEuler(t),(i=this.camera.quaternion.clone().multiply(i)).normalize(),this.touchBlender&&i.slerp(this.camera.quaternion.clone(),e).normalize();var s=new x.Vector3(0,0,-10).applyQuaternion(i).add(this.camera.position);this.camera.setRotationFromQuaternion(i),this.camera.lookAt(s),this.camera.up.set(0,1,0),this.hasRotated=!0}lookAtTargetLock(){if(this.lookAtTargetActive&&this.lookAtTargetActive&&(0!=this.lookAtLockFader&&(this.lookAtLockPerc+=(this.lookAtLockFader+Math.min(1,.001*this.pxlDevice.touchMouseData.velocity.length()))*this.lookAtLockFadeRate,(this.lookAtLockPerc<0||this.lookAtLockPerc>1)&&(this.lookAtLockPerc=this.lookAtLockPerc<0?0:1,this.lookAtLockFader=0),this.lookAtPerc.x=this.lookAtLockPerc),this.lookAtLockPerc>0)){var e=this.camera.quaternion.clone();this.camera.lookAt(this.cameraAimTarget.position);var t=this.camera.quaternion.clone();1==this.lookAtLockPerc?this.camera.setRotationFromQuaternion(t):this.camera.setRotationFromQuaternion(t.slerp(e,.5*Math.cos(this.lookAtLockPerc*pi)+.5)),this.hasRotated=!0}}warpEventTriggered(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"init";this.warpActive||(this.pxlEnv.mapComposerWarpPass.needsSwap=!0,this.warpType=e,this.warpObj=t,this.warpTarget=i,this.warpActive=!0,this.pxlEnv.initWarpVisual(e))}warpCamRun(){if(0==this.warpType)this.setToObj(this.warpObj);else if(1==this.warpType){var e="init"==this.warpTarget;this.warpToRoom(this.warpObj,e,this.warpTarget)}this.pxlEnv.setExposure(this.uniformScalars.exposureUniformBase),this.warpObj=null,this.warpTarget=null,this.warpActive=!1}lowQualityUpdates(){if(this.HDRView){var e=new x.Vector3(0,0,-1).applyQuaternion(this.camera.quaternion),t=e.clone().multiply(new x.Vector3(1,0,1)).normalize();this.camRotPitch.set(.1591549430918955*-Math.atan2(t.x,t.z),.5*e.y)}}midQualityUpdates(){if(this.pxlQuality.settings.motion){var e,t=new x.Vector3(0,0,0);if(t.applyQuaternion(this.camera.quaternion),this.camRotXYZ.multiplyScalar(.8).add(t.multiplyScalar(.2)),this.pxlDevice.mobile){var i=.5*sW,s=.5*sH,a=new x.Vector3(0,0,10),r=new x.Vector3(0,0,10);a.applyQuaternion(this.camera.quaternion.clone()).project(this.camera),r.applyQuaternion(this.prevQuaternion).project(this.camera),a.x=(a.x+1)*i,a.y=-(a.y-1)*s,r.x=(r.x+1)*i,r.y=-(r.y-1)*s;(e=r.clone().sub(a.clone()).multiplyScalar(.6).multiply(new x.Vector3(this.pxlDevice.screenRes.x,this.pxlDevice.screenRes.y,0))).length>.1&&e.normalize().multiplyScalar(.1)}else e=this.pxlDevice.touchMouseData.velocity.clone().multiplyScalar(Math.max(this.pxlDevice.screenRes.x,this.pxlDevice.screenRes.y));var n=new x.Vector2(e.x,-e.y),o=new x.Vector2(0,0).lerpVectors(this.pxlEnv.blurDirPrev,n,.85);this.pxlEnv.blurDirPrev.set(this.pxlEnv.blurDirCur),this.pxlEnv.blurDirCur.set(o)}}emitCameraTransforms(e,t){}jogServerMemory(){var e=this.cameraPos.clone(),t=this.getUserHeight();this.emitCameraTransforms(e,t,!0)}updateCamera(){var e=this.pxlDevice.touchMouseData.velocity.length();if(this.hasRotated=this.hasRotated||e>0,this.camUpdated=this.camUpdated||this.hasRotated,this.pxlDevice.touchMouseData.curFadeOut.multiplyScalar(.7),this.camUpdated){this.camUpdated=!1;var t=!1;this.updateDeviceValues(e),this.prevQuaternion.copy(this.camera.quaternion);var i=this.initFrameCamPosition(),s=this.getUserHeight();if(this.pxlOptions.staticCamera)return this.hasGravity=!1,this.hasMoved=!1,this.pxlOptions.allowStaticRotation&&this.hasRotated&&(this.updateStaticCameraRotation(),this.camera.updateMatrixWorld()),void(this.hasRotated=!1);(this.hasMoved||this.hasGravity)&&(i=this.colliderCheck(i),this.updateGravity(this.pxlTimer.deltaTime),this.colliderValid||this.colliderValidityChecked?this.jump=0:this.jump=this.checkColliderValid(i),this.eventCheckStatus=!0,i=this.applyGravity(i),this.cameraPrevPos=this.cameraPos.clone(),this.cameraPos=i.clone(),t=this.cameraPos.distanceTo(this.cameraPrevPos)>0,i.y+=s+this.cameraJumpHeight,this.camera.position.copy(i)),this.hasRotated&&this.canMove?(this.updateRoamCameraRotation(),t=t||this.hasRotated):this.hasRotated&&(this.updateStaticCameraRotation(),t=t||this.hasRotated),t&&(this.camera.updateMatrixWorld(),this.emitCameraTransforms(i,s)),this.hasMoved=!1,this.hasRotated=!1,this.cameraBooted=!0}}subscribe(e,t){this.callbacks.hasOwnProperty(e)||(this.callbacks[e]=[]),this.callbacks[e].push(t)}emit(e,t){this.callbacks.hasOwnProperty(e)&&this.callbacks[e].forEach((e=>{e(t)}))}},AutoCamera:class AutoCamera{constructor(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.enabled=e,this.active=!1,this.mobile=null,this.pxlTimer=null,this.pxlUtils=null,this.pxlDevice=null,this.pxlAudio=null,this.pxlCamera=null,this.pxlEnv=null,this.camera=null,this.netDistance=new x.Vector2,this.prevCamChange=0,this.nextCamChange=0,this.delayRange=[25,45],this.autoCamActive=!1,this.autoCamMode=0,this.autoCamPaths={},this.resetAutoCam=!0,this.autoCamPrevPos=null,this.autoCamPrevLookAt=null,this.touchBlender=!1,this.autoCamId=0,this.camMode=0,this.curModeCount=0,this.curRoom="",this.curRoomIndex=0,this.curPath=0,this.roomList=[],this.pathCounts={},this.forceNewRoom=!1,this.curRoomCount=0,this.avatarMin=0,this.avatarValid=!1,this.curAvatar=null,this.clusterReturn=!1,this.curCluster=[],this.clusterValid=2,this.clusterRotation=0,this.clusterRotRate=.005}setDependencies(pxlNav){this.pxlTimer=pxlNav.pxlTimer,this.pxlUtils=pxlNav.pxlUtils,this.pxlDevice=pxlNav.pxlDevice,this.pxlAudio=pxlNav.pxlAudio,this.pxlCamera=pxlNav.pxlCamera,this.pxlEnv=pxlNav.pxlEnv,this.camera=pxlNav.pxlCamera.camera}init(){this.active=this.enabled||this.mobile,this.autoCamActive=this.autoCamActive||this.mobile;var{roomList:e,pathCounts:t}=this.getAutoCamData();this.roomList=e,this.curRoom=this.roomList[0],this.pathCounts=t,this.setRoom(!1,!0),this.getNextPath(),this.checkStatus()}step(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(null==this.autoCamActive||null==this.active)return this.autoCamActive=!1,this.active=!1,!0;if(0==this.active){if(!this.autoCamActive)return!0;this.updateAutoCamera()}if((this.pxlTimer.curMS>=this.nextCamChange||e)&&this.active&&!this.pxlDevice.touchMouseData.active){if(!e||!this.enabled){var t=this.checkCamMode();this.setNextTrigger(t)}this.curAvatar=0,this.camera.up.set(0,1,0),this.pxlDevice.touchMouseData.netDistance.multiplyScalar(0),1==this.camMode||2==this.camMode?this.setCamMode(0):(this.curCluster=[],this.stepDroneCam()),this.setAutoCamMode(this.camMode)}return this.updateAutoCamera(),this.applyTouchRotate(),!1}checkCamMode(){var e=this.camMode;return this.camMode=0,this.enabled&&this.active?(this.camMode!=e&&0==this.camMode&&(this.forceNewRoom=!0),1):1}setCamMode(e){1==e.type||2==e.type||(this.camMode=0,this.forceNewRoom=!0),this.step(!0)}stepDroneCam(){var e=!0,t=Math.random(this.nextCamChange),i=this.pathCounts[this.pxlEnv.currentRoom];this.curRoomCount>=2*i&&(this.forceNewRoom=!0),(t<.3||this.forceNewRoom)&&(this.setRoom(),e=!1),this.curRoomCount+=1,this.getNextPath(e)}setRoom(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.active||this.autoCamActive){var i=this.curRoomIndex,s=this.roomList.length;this.pxlEnv.postIntro?t||(e||(i=Math.floor(Math.random()*s))==this.curRoomIndex)&&(i=(i+1)%s):i=0,this.curRoomIndex=i,this.curRoom!=this.roomList[i]&&(this.curRoom=this.roomList[i],this.forceNewRoom=!1,this.curRoomCount=0,this.pxlCamera.warpEventTriggered(1,this.curRoom,"init"))}}setNextTrigger(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=Math.random(this.nextCamChange);t=(this.delayRange[1]-this.delayRange[0])*t+this.delayRange[0],this.nextCamChange=this.pxlTimer.curMS+t*e}getNextPath(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(this.autoCamPaths.hasOwnProperty(this.pxlEnv.currentRoom)){var i=this.autoCamPaths[this.pxlEnv.currentRoom].length;if(this.curPath=(this.curPath+t)%i,e&&0==t){var s=Math.random(this.nextCamChange);s=Math.floor(s*this.autoCamPaths[this.pxlEnv.currentRoom].length),this.curPath==s&&(s=(s+1)%i),this.curPath=s}else this.curPath=this.curPath<0?i-1:this.curPath,this.setNextTrigger(1);this.setAutoCamPath(this.curPath)}}checkStatus(){(this.autoCamActive||this.pxlDevice.mobile||this.active)&&this.toggleAutoCam(!0)}preAutoCamToggle(){this.autoCamActive||"AudioTrigger_2"==this.pxlCamera.colliderCurObjHit&&(this.pxlCamera.proximityScaleTrigger=!0,this.exposureShiftActive=!0),this.toggleAutoCam()}setAutoCamMode(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.autoCamMode=e,1==e&&(this.resetAutoCam=!0)}setPosQuat(e,t){this.camera.quaternion.copy(t),this.camera.position.copy(e),this.pxlCamera.updateCameraMatrices(),this.pxlCamera.camUpdated=!0}toggleAutoCam(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(this.pxlEnv.fogMult.x=1,this.autoCamPaths[this.pxlEnv.currentRoom]){this.curRoom=this.pxlEnv.currentRoom;var i=this.autoCamPaths[this.pxlEnv.currentRoom].length;isNaN(this.autoCamId)&&(this.autoCamId=i-1);var s=this.autoCamActive;if(this.autoCamActive=null==e&&i>0?!this.autoCamActive:e,this.autoCamActive=this.mobile||this.autoCamActive,!s&&this.autoCamActive&&(this.netDistance=(new x.Vector2).copy(this.pxlDevice.touchMouseData.netDistance)),this.pxlDevice.touchMouseData.netDistance.multiplyScalar(0),this.autoCamActive){this.pxlCamera.resetGravity(),this.autoCamId=(this.autoCamId+t)%i,this.autoCamId=this.autoCamId<0?i-1:this.autoCamId;var a=this.autoCamPaths[this.pxlEnv.currentRoom][this.autoCamId];this.totalLoopDuration=a.position.userData.duration;try{this.autoCamPositions=a.position.geometry.attributes.position,this.autoCamLookAt=a.lookAt.geometry.attributes.position,a.up?this.autoCamUp=a.up.geometry.attributes.position:(this.autoCamUp=null,this.camera.up.set(0,1,0)),this.numControlPoints=this.autoCamPositions.array.length/3,this.autoCamStartTime=this.pxlTimer.curMS-this.totalLoopDuration*Math.random()}catch(e){}}else this.setPosQuat(this.pxlCamera.cameraPrevPos.clone(),this.pxlCamera.prevQuaternion.clone()),this.pxlDevice.touchMouseData.netDistance.copy(this.netDistance)}}prevNextAutoCam(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.autoCamActive&&(this.enabled&&this.active&&!t?this.nextCamChange=this.pxlTimer.curMS:this.toggleAutoCam(!0,e))}setAutoCamPath(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.autoCamActive&&(this.autoCamId=e,this.toggleAutoCam(!0,0))}getAutoCamData(){var e=Object.keys(this.autoCamPaths),t={};return e.forEach((e=>{t[e]=this.autoCamPaths[e].length})),{roomList:e,pathCounts:t}}getAutoCamValueFromCurve(e,t,i){var s=e[3*t],a=e[3*t+1],r=e[3*t+2],n=(t+1)%this.numControlPoints,o=e[3*n],l=e[3*n+1],h=e[3*n+2],d=new x.Vector3(s,a,r),c=new x.Vector3(o,l,h);return d.lerp(c,i),d}updateAutoCamera(){if(this.autoCamPositions&&this.autoCamPositions.array){var e=(this.pxlTimer.curMS-this.autoCamStartTime)%this.totalLoopDuration/this.totalLoopDuration;e*=this.numControlPoints-1;var t=Math.floor(e),i=e-t,s=this.getAutoCamValueFromCurve(this.autoCamPositions.array,t,i,!1);this.camera.position.copy(s);var a=this.getAutoCamValueFromCurve(this.autoCamLookAt.array,t,i);if(this.camera.lookAt(a),this.autoCamUp){var r=this.getAutoCamValueFromCurve(this.autoCamUp.array,t,i);r=r.sub(s).normalize(),this.camera.up.copy(r)}}}applyTouchRotate(){var e=1;this.touchBlender?(e=Math.min(1,Math.max(0,this.pxlTimer.curMS-this.pxlDevice.touchMouseData.releaseTime)),e*=e,this.pxlDevice.touchMouseData.netDistance.multiplyScalar(1-e),this.touchBlender=e<1):this.pxlDevice.touchMouseData.netDistance.multiplyScalar(.5);var t=new x.Euler;t.set(this.pxlDevice.touchMouseData.netDistance.y/this.pxlDevice.sH*2,this.pxlDevice.touchMouseData.netDistance.x/this.pxlDevice.sW*2,0,"YXZ");var i=(new x.Quaternion).clone(this.camera.quaternion);i.setFromEuler(t),(i=this.camera.quaternion.clone().multiply(i)).normalize(),this.touchBlender&&i.slerp(this.camera.quaternion.clone(),e).normalize();var s=new x.Vector3(0,0,-10).applyQuaternion(i).add(this.camera.position);this.camera.setRotationFromQuaternion(i),this.camera.lookAt(s),this.camera.up.set(0,1,0)}},Extensions:R.Extensions,MusicUtils:class MusicUtils{constructor(){this.audioObject=null}},Audio:class Audio{constructor(){this.pxlTimer=null,this.pxlVideo=null,this.pxlDevice=null,this.pxlEnv=null,this.pxlGuiDraws=null,this.pxlSocket=null,this.active=!1,this.audioTimer=new x.Vector3(0,0,0),this.audioEq=new x.Vector4(0,0,0,0),this.audioWorker=null,this.audioProcessor=null,this.djUrlSource="//",this.djMuted=!1,this.djAudioVolume=0,this.djAudioVolumeMax=.65,this.djAudioVolumeMin=.25,this.djAudioVolumeScalar=.25,this.djAudioObj=null,this.djTimecodeObj=null,this.djVolumeParentObj=null,this.djVolumeObj=null,this.roomAudioStopped=!0,this.videoStreamObjects=[],this.colliderVolActive=!1,this.isVideoObject=!1,this.activeObject=null,this.fadeActive=!1,this.fadeAdjustRate=.02,this.fadeDir=0,this.fadePerc=0,this.audioContext=null}setDependencies(pxlNav){this.pxlTimer=pxlNav.pxlTimer,this.pxlVideo=pxlNav.pxlVideo,this.pxlDevice=pxlNav.pxlDevice,this.pxlEnv=pxlNav.pxlEnv,this.pxlGuiDraws=pxlNav.pxlGuiDraws,this.pxlSocket=pxlNav.pxlSocket}init(){this.active=!0}postBoot(){if(this.djAudioObj){if(this.pxlEnv.pxlAutoCam.enabled)this.djAudioVolumeMax=1,this.djAudioVolumeMin=0;else if(this.pxlEnv.mobile){var e=this,t=this.djAudioVolumeMax,i=document.getElementById("guiMobileWelcomeButton");function audioClickMonitor(a){setTimeout((()=>{e.djAudioVolume=0,e.djAudioVolumeMax=t,e.djAudioVolumeMin=0,e.djAudioObj.byScript=!0,e.djAudioObj.volume=0,s.play().then((()=>{e.djPlayerMuteToggle(!1),e.setFadeActive(.5)})),i.removeEventListener("click",audioClickMonitor),i.removeEventListener("touchstart",audioClickMonitor)}),500)}i.addEventListener("click",audioClickMonitor),i.addEventListener("touchstart",audioClickMonitor)}this.djAudioVolume=this.pxlEnv.enabled?0:this.djAudioVolumeMin,this.djAudioObj.volume=this.pxlEnv.enabled?0:this.djAudioVolumeMin,this.djPlayerMuteToggle(!1),this.djPlayerAdjustVolume({}),this.djPlayerSetSliderGui();var s=this.djAudioObj;s.setAttribute("autoplay",!0);var a=this;this.djAudioObj.addEventListener("volumechange",(e=>{a.djPlayerSetSliderGui()}),!0)}}start(){}step(){this.djAudioObj&&this.djAudioObj.paused&&(this.djAudioObj.play().catch((e=>{})),this.djAudioObj.muted=this.djMuted||!this.roomAudioStopped),this.fadeAudioEvent()}isPaused(){var e=!0;return this.djAudioObj&&(e=this.djAudioObj.paused),e}pausePlayback(){this.active=this.pxlTimer.active,this.active?this.play():this.stop()}initPlay(){this.pxlVideo.canUnmute("dj")&&!this.isPaused()&&(this.djPlayerMuteToggle(!1),this.setFadeActive(1),this.pxlDevice.mobile&&this.pxlGuiDraws.toggleIcon(this.pxlGuiDraws.hudIcons.musicIcon,!this.djMuted,!0))}play(){if(this.active=!0,this.isVideoObject)this.pxlVideo.setVolume("dj",this.djAudioVolume),this.pxlVideo.setMuted("dj",this.djMuted);else{this.djAudioObj.byScript=!0;var e=this.djAudioObj;e.children[0].setAttribute("src",this.djUrlSource),setTimeout((()=>{e.load(),setTimeout((()=>{e.volume=this.djAudioVolume,e.muted=this.djMuted||!this.roomAudioStopped,e.paused&&e.play()}),20)}),20)}}stop(){if(this.active=!1,this.isVideoObject)this.pxlVideo.setMuted("dj",!0);else{var e=this.djAudioObj;e.children[0].setAttribute("src",""),e.pause(),setTimeout((()=>{e.load()}),20)}}djBuildPlayer(){this.djAudioObj=document.getElementById("djStream"),this.djVolumeParentObj=document.getElementById("djPlayerVolumeParent"),this.djVolumeObj=document.getElementById("djPlayerVolume"),this.djAudioObj.byScript=!1,this.djAudioObj.volume=0,this.djVolumeObj.style.width="0%";var e=this;this.pxlDevice.objectPercList.push("djPlayerVolume"),this.pxlDevice.objectPercList.push("djPlayerVolumeParent"),this.pxlDevice.objectPercFuncList.djPlayerVolumeParent=t=>{e.djPlayerAdjustVolume(t)},this.djVolumeParentObj.down=!1,this.djVolumeParentObj.addEventListener("mousedown",(t=>{e.djVolumeParentObj.down=!0,e.djPlayerAdjustVolume(t)})),this.djVolumeParentObj.addEventListener("mousemove",(t=>{e.djPlayerAdjustVolume(t)})),this.djVolumeParentObj.addEventListener("mouseup",(t=>{e.djVolumeParentObj.down=!1})),this.pxlDevice.mobile&&(this.djVolumeParentObj.style.width="30vw",this.djVolumeParentObj.addEventListener("touchstart",(t=>{e.djVolumeParentObj.down=!0}),{passive:!0}),this.djVolumeParentObj.addEventListener("touchmove",(t=>{e.djPlayerAdjustVolume(t)}),{passive:!0}),this.djVolumeParentObj.addEventListener("touchend",(t=>{e.djVolumeParentObj.down=!1}),{passive:!0})),this.djAudioObj.muted=!0,this.prepAudioProcessor()}prepAudioProcessor(){}stepAudioProcessor(){}recieveAudioProcessor(e){}buildRemoteAudioMixer(e,t){return!1}loadStreamPromise(){var e=this.djAudioObj;return new Promise(((t,i)=>{this.djAudioObj.byScript=!0,e.children[0].setAttribute("src",this.djUrlSource),e.load(),e.muted=this.djMuted||!this.roomAudioStopped})).then((()=>{})).catch((e=>{console.log("error source")}))}djPlayerSetSliderGui(){this.djAudioObj.byScript||!this.pxlEnv.postIntro||this.pxlEnv.pxlAutoCam.enabled?this.djAudioObj.byScript=!1:(this.fadeActive=!1,this.djAudioVolumeMax=this.djAudioVolume,this.djAudioVolumeMin=this.djAudioVolume*this.djAudioVolumeScalar),this.djVolumeObj.style.width=100*this.djAudioVolume*~~!this.djMuted+"%"}djPlayerAdjustVolume(e){if(this.djVolumeParentObj.down||this.djVolumeParentObj.down&&e.touches){var t=this.djVolumeParentObj.offsetWidth,i=0;i=e.touches?this.pxlDevice.objectPerc.percX:e.offsetX/t;var s=Math.max(0,Math.min(1,i));this.djAudioVolume=s,this.djAudioVolumeMax=s,this.djAudioVolumeMin=.1*s,s*=s,this.djAudioObj&&(this.djAudioObj.volume=s),e.touches&&this.djPlayerSetSliderGui()}this.pxlVideo&&this.pxlEnv.posted&&this.pxlVideo.setVolume("dj",this.djAudioVolume)}djPlayerMuteToggle(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.djMuted=null==e?!this.djMuted:e,null!=e&&this.pxlGuiDraws.toggleIcon(this.pxlGuiDraws.hudIcons.musicIcon,!e,!0),this.djAudioObj&&(this.djAudioObj.muted=this.djMuted,this.djAudioObj.byScript=!0,this.djAudioObj.volume=this.djAudioObj.volume),this.pxlVideo&&this.pxlEnv.posted&&this.pxlVideo.setMuted("dj",this.djMuted)}setFadeActive(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.fadeDir!=e&&(this.fadeDir=e,this.fadeActive=!0)}fadeAudioEvent(){if(this.djVolumeParentObj&&!this.djVolumeParentObj.down&&this.fadeActive&&this.pxlEnv.postIntro){if(this.fadePerc+=this.fadeAdjustRate*this.fadeDir,this.fadePerc<0||this.fadePerc>1)return this.fadePerc=1==this.fadeDir?1:0,void(this.fadeActive=!1);var e=(this.djAudioVolumeMax-this.djAudioVolumeMin)*this.fadePerc+this.djAudioVolumeMin;this.djAudioVolume=e,e*=e,this.djAudioObj&&(this.djAudioObj.byScript=!0,this.djAudioObj.volume=e),this.pxlVideo.setVolume("dj",this.djAudioVolume)}}},Video:class Video{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.pxlUtils=t,this.pxlAudio=i,this.pxlFile=s,this.pxlGuiDraws=a,this.pxlEnv=null,this.posted=!1,this.djStreamUrl="",this.performerStreamUrl="",this.screenVideoBlock=null,this.screenVideos={},this.videoStreams={},this.videoStreamFailCount=0,this.videoStreamFailMax=5,this.videoAudioEvent={dj:!1,performer:!1},this.checkForDjStream=!1,this.checkForPerformerStream=!1,this.videoStills={dj:{texture:null,url:e+"SoftNoise_512.jpg"},performer:{texture:null,url:e+"SoftNoise_512.jpg"}}}init(){this.buildVideoBlock(),this.buildPromoVideos()}buildVideoBlock(){if(null==this.screenVideoBlock){var e=document.createElement("div");e.classList.add("videoScreenBlockStyle"),document.body.appendChild(e),this.screenVideoBlock=e}}buildPromoVideos(){[].forEach((e=>{var t=e.name,i=e.type,s=e.intensity,a=e.boost,r=e.file,n=e.landscape,o=this.pxlFile.vidRoot+r,l=document.createElement("video");l.id="screenVideo_"+t+"_"+(n?"port":"land"),l.src=o,l.classList.add("bgMediaAssets"),l.controls=!1,l.muted=!0,l.preload="true",l.setAttribute("autoplay",""),l.setAttribute("muted",""),l.setAttribute("playsinline",""),l.setAttribute("loop",""),this.screenVideoBlock.appendChild(l),this.screenVideos[t]||(this.screenVideos[t]={}),this.screenVideos[t].name=t,this.screenVideos[t].type=i,s&&(this.screenVideos[t].intensity=s),a&&(this.screenVideos[t].boost=a);var h=this.screenVideos[t].file||[];this.screenVideos[t].file?h[~~n]=o:h=[o,o],this.screenVideos[t].file=h;var d=this.pxlUtils.getVideoTexture(l),c=this.screenVideos[t].texture||[];this.screenVideos[t].texture?c[~~n]=d:c=[d,d],this.screenVideos[t].texture=c;var u=[];this.screenVideos[t].videoObjs?u[~~n]=l:u=[l,l],this.screenVideos[t].videoObjs=u}))}boot(){var e=this;return Video_asyncToGenerator((function*(){e.videoAudioEvent.dj?e.buildVideoPlayer("dj"):e.videoStills.dj.texture=e.pxlUtils.loadTexture(e.videoStills.dj.url)}))()}buildVideoPlayer(e){var t=this,i=document.createElement("video");i.id="antibodyDjStream",i.classList.add("bgMediaAssets"),i.controls=!1,i.volume=0,i.muted=!0,i.setAttribute("autoplay","true"),i.setAttribute("playsinline","true"),i.addEventListener("volumechange",(e=>{i.volume=Math.min(i.volume,t.pxlAudio.djAudioVolume)}),!0),this.screenVideoBlock.appendChild(i),this.videoStreams[e]={},this.videoStreams[e].mode=0,this.videoStreams[e].active=!1,this.videoStreams[e].loading=!1,this.videoStreams[e].checkResolve=!1,this.videoStreams[e].prevCheck=this.pxlUtils.curMS+5,this.videoStreams[e].delayCheck=5,this.videoStreams[e].obj=i,this.videoStreams[e].url=this.djStreamUrl,this.videoStreams[e].urlStatus=!1,this.videoStreams[e].player=null,this.videoStreams[e].checkScreens=!1,this.videoStreams[e].activeLevel=-1,this.videoStreams[e].prevFrame=0,this.videoStreams[e].prevFrameCount=0,this.videoStreams[e].canvasObj=null,this.videoStreams[e].videoTexture=this.getTexture(e),this.pxlFile.urlExists(this.djStreamUrl).then((t=>{this.videoStreams[e].urlStatus=t})),this.buildVideoStream(e,!1)}postBoot(e){this.videoStreams[e]&&this.videoStreams[e].urlStatus&&this.load(e,this.videoStreams[e].url),this.posted=!0,this.checkForDjStream=this.videoAudioEvent.dj}step(){var e=!1,t="dj";if(this.videoAudioEvent[t]){var i=this.videoStreams[t];i&&(i.active||this.checkVideoStreamStatus(t),this.pxlUtils.mobile?i.active&&i.videoTexture&&i.checkScreens&&(i.checkScreens=!1,this.setScreensToStreams(1,i.videoTexture)):(e=i.checkScreens,i.checkScreens=!1))}else this.videoStills[t].texture&&this.pxlUtils.mobile&&this.setScreensToStreams(1,this.videoStills[t].texture);return e}setScreensToStreams(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"dj",i=t;"string"==typeof i&&((i=this.getTexture(t))||(e=0,this.videoStreams[t].active=!1,this.videoStreams[t].checkScreens=!0)),this.pxlEnv.camScreenData.screenGeoList.forEach(((t,s)=>{t.material.uniforms.camExists.value=e,t.material.uniforms.videoFeed.value=i}))}isActive(e){var t=!1;return this.videoStreams.hasOwnProperty(e)?this.videoStreams[e].active&&this.videoStreams[e].videoTexture&&(t=!0):t=null!=this.videoStills[e].texture,t}getTexture(e){var t=null;return this.videoAudioEvent[e]?(this.videoStreams[e].videoTexture||(this.videoStreams[e].videoTexture=this.buildVideoTexture(e)),t=this.videoStreams[e].videoTexture):this.videoStills[e].texture&&(t=this.videoStills[e].texture),t}buildVideoTexture(e){return this.disposeVideoTexture(e),this.videoStreams[e].obj&&this.videoStreams[e].player?this.pxlUtils.getVideoTexture(this.videoStreams[e].obj):null}disposeVideoTexture(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.videoStreams[e].videoTexture&&(this.videoStreams[e].videoTexture.dispose(),this.videoStreams[e].videoTexture=null,this.videoStreams[e].checkScreens=null==t||t)}resetvideoTexture(e){this.setScreensToStreams(0,e),this.disposeVideoTexture(e,!1);var t=this.getTexture(e);this.videoStreams[e].videoTexture=t,this.videoStreams[e].checkScreens=!0}resetEnvSettings(e){this.resetvideoTexture(e),this.videoStreams[e].checkScreens=!1}hlsPreflight(){var e=window.MediaSource||window.WebKitMediaSource;e=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"');var t=window.SourceBuffer||window.WebKitSourceBuffer;return t=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove,e&&t}buildVideoStream(e){var t=this;this.videoStreams[e].obj;if("undefined"!=typeof IVSPlayer)this.buildIvsPlayer(e);else{this.pxlFile.loadScript("https://player.live-video.net/1.1.2/amazon-ivs-player.min.js").then((()=>{t.buildIvsPlayer(e)}))}}buildVhsPlayer(e){if(videojs){this.videoStreams[e].mode=1;var t=this.videoStreams[e].obj,i=videojs(t,{controls:!1,autoplay:!0,preload:"auto"});videojs.log.level("off"),videojs.log.level("error"),this.videoStreams[e].player=i;var s=this;i.ready((function(){var e=i.play();e&&e.catch((function(e){document.addEventListener("click",(function vhsClickMonitor(e){var t=i.networkState();1!=t&&2!=t||(i.play(),document.removeEventListener("click",vhsClickMonitor))}))}))})),i.on("play",(t=>{s.ready(e)})),i.on("loadedmetadata",(t=>{s.start(e)})),i.on("waiting",(t=>{var a=i.currentTime(),r=i.duration();r>0&&setTimeout((()=>{var t=i.currentTime(),n=i.duration();a==t&&r==n&&this.pxlFile.urlExists(i.src()).then((t=>{t||s.ended(e)})).catch((()=>{s.ended(e)}))}),500)})),i.on("ended",(t=>{s.ended(e)})),i.on("error",(t=>{s.ended(e)}))}else this.buildFallbackPlayer(e)}buildHlsPlayer(e){if(Hls.isSupported()){this.videoStreams[e].mode=4;var t=this.videoStreams[e].obj,i=new Hls({enableWorker:!0,liveBackBufferLength:900,startLevel:2,stretchShortVideoTrack:!0,nudgeOffset:.5,fragLoadingTimeOut:2e3});i.attachMedia(t),this.videoStreams[e].player=i;var s=this;i.on(Hls.Events.MEDIA_ATTACHED,(function(t){s.ready(e)})),i.on(Hls.Events.BUFFER_CREATED,(function(e){})),i.on(Hls.Events.MANIFEST_PARSED,(function(t){s.start(e)})),i.streamController.onMediaEnded=function(t){s.ended(e)},i.on(Hls.Events.ERROR,(function(t,a){a.fatal?s.ended(e):"bufferFullError"!=a.details&&"bufferAppendingError"!=a.details||i.recoverMediaError()})),i.on(Hls.Events.STREAM_STATE_TRANSITION,(function(t,a){"PARSED"==a.previousState&&"IDLE"==a.nextState&&(s.videoStreams[e].activeLevel=i.currentLevel,-1==i.currentLevel&&setTimeout((()=>{-1==i.currentLevel&&i.recoverMediaError()}),1e3))}))}else this.buildFallbackPlayer(e)}sendModMessage(e,t,i){var s={msg:e,init:t,data:i};this.pxlEnv.pxlSocket.sendErrorMsg(s)}buildFallbackPlayer(e){var t=this.videoStreams[e].obj;this.videoStreams[e].mode=2,t.setAttribute("src",this.videoStreams[e].urlStatus?this.videoStreams[e].url:"");var i=this;t.addEventListener("error",(function(e,t){})),t.addEventListener("loadedmetadata",(function(t){i.ready(e)})),t.addEventListener("canplay",(function(s){t.play(),i.start(e)})),t.addEventListener("suspend",(function(t){i.ended(e)})),t.addEventListener("ended",(function(t){i.ended(e)}))}buildIvsPlayer(e){if(IVSPlayer.isPlayerSupported){this.videoStreams[e].mode=3;var t=this.videoStreams[e].obj,i=IVSPlayer.create();i.attachHTMLVideoElement(t),i.setAutoplay(!0),i.setLogLevel("Error"),this.videoStreams[e].loading=!0,this.videoStreams[e].player=i,this.videoStreams[e].checkScreens=!1;var s=this,a=IVSPlayer.PlayerState;i.addEventListener(a.READY,(t=>{s.ready(e)})),i.addEventListener(a.PLAYING,(t=>{s.start(e)})),i.addEventListener(a.ENDED,(t=>{s.ended(e)}));var r=IVSPlayer.PlayerEventType;i.addEventListener(r.ERROR,((t,i,a,r)=>{s.ended(e,t)}))}else this.buildFallbackPlayer(e)}unload(e){}load(e,t){var i=this.videoStreams[e];if(i)switch(i.mode){case 1:this.videoStreams[e].url=t,i.player.src({type:"application/x-mpegURL",src:t}),i.player.load();break;case 2:i.obj.setAttribute("src",t),i.obj.load();break;case 3:i.player.load(t);break;case 4:i.player&&this.destroyPlayer(e,!0),i.player.attachMedia(this.videoStreams[e].obj);var s=decodeURIComponent(t);i.player.loadSource(s)}}newStream(e){}canUnmute(e){var t=!0;return this.videoStreams[e]&&(t=this.videoStreams[e].active),t}setMuted(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.videoStreams[e];i&&(i.obj.muted=t)}setVolume(e,t){var i=this.videoStreams[e];i&&(i.obj.volume=t)}getStreamState(e){var t=!1,i=this.videoStreams[e];switch(i.mode){case 1:case 2:t=!i.obj.paused;break;case 3:var s=i.player;t=s.core.isLoaded&&!s.core.paused;break;case 4:t=null!=i.player.streamController.lastCurrentTime}return t}checkVideoError(e){var t=this.videoStreams[e];t.active&&4==t.mode&&(0==t.obj.videoWidth?!t.obj.paused&&t.player.streamController.lastCurrentTime>10&&(this.destroyPlayer(e),this.videoStreams[e].active=!1,this.checkForDjStream=!0,this.buildHlsPlayer(e),this.videoStreams[e].player.recoverMediaError()):t.obj.webkitDecodedFrameCount==t.prevFrame?(this.videoStreams[e].prevFrameCount+=1,this.videoStreams[e].prevFrameCount>50&&(this.videoStreams[e].prevFrameCount=0,this.videoStreams[e].player.recoverMediaError(),this.videoStreams[e].player.nextLoadLevel=Math.max(0,this.videoStreams[e].player.currentLevel-1),this.videoStreams[e].player.recoverMediaError())):(this.videoStreams[e].prevFrame=t.obj.webkitDecodedFrameCount,-1!=this.videoStreams[e].player.nextLevel&&(this.videoStreams[e].player.nextLevel=-1),this.videoStreams[e].prevFrameCount=0))}ready(e){this.videoStreams[e].loading=!1,this.videoStreams[e].obj.volume=0,this.videoStreams[e].activeLevel=1}start(e){var t=this.videoStreams[e];if(!t.active){t.obj,t.player;var i=this.getStreamState(e);this.videoStreams[e].active=i,this.videoStreams[e].videoTexture||(this.videoStreams[e].videoTexture=this.getTexture(e)),this.pxlAudio.isVideoObject=!0,this.videoStreamFailCount=0,this.checkForDjStream=!1,this.videoStreams[e].checkScreens=!0,this.pxlAudio.djAudioObj.byScript=!0;var s=this.pxlAudio.djAudioObj;s.children[0].setAttribute("src",""),s.pause(),s.muted=!0,setTimeout((()=>{s.load(),setTimeout((()=>{this.pxlAudio.roomAudioStopped&&(t.obj.volume=this.pxlAudio.djAudioVolume),t.obj.muted=this.pxlAudio.djMuted||!this.pxlAudio.roomAudioStopped,t.obj.click()}),20)}),20)}}restart(e){var t=!1,i=this.videoStreams[e].player,s=this.videoStreams[e].obj;switch(this.videoStreams[e].mode){case 1:case 2:t=!s.paused;break;case 3:t=i.core.isLoaded&&!i.core.paused;break;case 4:t=i.currentLevel>-1}this.videoStreams[e].active=t,this.videoStreams[e].checkScreens=t}ended(e){var t=this.videoStreams[e];if(t.active){this.destroyPlayer(e);var i=4==t.mode?!t.player.liveTracker.atLiveEdge():!t.obj.paused;this.videoStreams[e].active=i,this.checkForDjStream=this.videoAudioEvent.dj,this.pxlAudio.isVideoObject=!1,this.videoStreams[e].checkScreens=!0,this.pxlAudio.roomAudioStopped&&(t.obj.volume=0),t.obj.pause(),t.obj.muted=!0,this.pxlAudio.djAudioObj.byScript=!0;var s=this.pxlAudio.djAudioObj,a=s.children[0];""==a.getAttribute("src")&&(a.setAttribute("src",this.pxlAudio.djUrlSource),s.load(),s.muted=this.pxlAudio.djMuted||!this.pxlAudio.roomAudioStopped,s.play()),this.videoStreams[e].prevCheck=this.pxlUtils.curMS+15,this.videoStreams[e].activeLevel=-1}}error(e,t){var i;i="object"==typeof t?t.type:t;["ErrorNetworkIO","networkError","mediaError","internalException"].includes(i)&&(tmpThis.videoStreams[e].active=!1)}destroyPlayer(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];4==this.videoStreams[e].mode&&(this.videoStreams[e].active||t)&&this.videoStreams[e].player&&this.videoStreams[e].player.detachMedia()}streamState(e){var t=this;return Video_asyncToGenerator((function*(){var i=!0,s=!0;t.videoStreams.dj&&(i=!t.videoStreams.dj.active),t.videoStreams.performer&&(s=!t.videoStreams.performer.active),1==e.hasOwnProperty("dj")&&i&&(t.checkForDjStream=e.dj&&t.videoAudioEvent.dj),1==e.hasOwnProperty("performer")&&s&&(t.checkForPerformerStream=e.performer&&t.videoAudioEvent.performer)}))()}checkVideoStreamStatus(e){var t=this;return Video_asyncToGenerator((function*(){var i=t.videoStreams[e];i&&t.checkForDjStream&&t.posted&&!i.active&&i.prevCheck+i.delayCheck<t.pxlUtils.curMS&&(t.checkForDjStream=!1,t.pxlFile.urlExists(t.videoStreams[e].url).then((i=>{t.videoStreams[e].urlStatus=i,t.checkForDjStream=!i,t.videoStreams[e].prevCheck=t.pxlUtils.curMS,t.videoStreams[e].checkResolve=t.pxlUtils.curMS,i?t.load(e,t.videoStreams[e].url):t.videoStreamFailCount+=1})).catch((i=>{console.log(i),t.videoStreamFailCount+=1,t.checkForDjStream=!0,t.videoStreams[e].prevCheck=t.pxlUtils.curMS})))}))()}}};function ShaderHeader_shaderHeader(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        "}function defaultVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n  varying vec2 vUv;\n  void main(){\n    vUv=uv;\n    vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);\n    gl_Position = projectionMatrix*modelViewPosition;\n  }"}function defaultShiftVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n  varying vec2 vUv;\n  varying vec2 vUvShift;\n  void main(){\n    vUv=uv;\n        vUvShift=uv-.5;\n    vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);\n    gl_Position = projectionMatrix*modelViewPosition;\n  }"}function camPosVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n  varying vec3 camPos;\n  varying vec2 vUv;\n  void main(){\n    vUv=uv;\n    vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);\n    gl_Position = projectionMatrix*modelViewPosition;\n    camPos=(modelViewMatrix*vec4(0.0,0.0,1.0,1.0)).xyz;\n  }"}function discardFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n  void main(){\n    discard;\n    gl_FragColor=vec4(.0,.0,.0,0.0);\n  }"}function animTextureVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n  varying vec2 vUv;\n  void main(){\n    vUv=uv;\n    vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);\n    gl_Position = projectionMatrix*modelViewPosition;\n  }"}function animTextureFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n  uniform vec2 time;\n  uniform float rate;\n  uniform float freq;\n  uniform float intensity;\n  uniform vec3 glowColor;\n  uniform sampler2D glowTexture;\n  varying vec2 vUv;\n  float pi=3.14159265358979;\n  \n  void main(){\n    vec4 glowCd=texture2D(glowTexture, vUv);\n    vec4 Cd=vec4(glowColor,1.0);\n    Cd.rgb*=(cos(glowCd.g*pi*freq+time.x*rate)*.5+.5)*(1.0-glowCd.b)*intensity+glowCd.b;\n    Cd.rgb*=glowCd.r*glowCd.a;\n    gl_FragColor=Cd;\n  }"}function clickableBevelVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform vec2 time;\n    uniform float rate;\n    varying vec3 pos;\n    varying float nDot;\n    varying vec2 vUv;\n    \n    void main(){\n      vUv=uv+vec2(rate*time.x, 0.0);\n      vec3 camDir=normalize( (projectionMatrix*viewMatrix*vec4(0.0,0.0,-1.0,1.0)).xyz );\n      nDot=dot( normal, camDir );\n      \n      pos=position;\n      vec4 modelViewPosition=modelViewMatrix * vec4(pos, 1.0);\n      gl_Position = projectionMatrix*modelViewPosition;\n      \n    }"}function clickableBevelFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D alphaMap;\n    uniform sampler2D cloudNoise;\n    uniform vec2 time;\n    uniform vec2 intensity;\n    uniform float rate;\n    varying vec3 pos;\n    varying float nDot;\n    varying vec2 vUv;\n    \n    void main() {\n      vec4 Cd=vec4( 1.0 );\n      Cd.rgb= mix( vec3(.05,.1,.5), vec3(.3,.5,1.0), intensity.x);\n      \n      vec2 nUV=pos.xy*.01+vec2(time.x*rate*.1, time.x*rate*.1);\n      vec4 noiseCd=texture2D(cloudNoise,nUV);\n      noiseCd.xyz=noiseCd.xyz*2.0-1.0;\n      nUV=vUv+noiseCd.xy*.05;\n      \n      float alpha=texture2D(alphaMap,nUV).r;\n      float blender=(nDot*.5+.5);\n      Cd.rgb=Cd.rgb*(1.0+alpha);//mix( vec3(0.5,0.5,1.0), vec3(0.0,0.2,0.8), blender); // Center Color, Edge Color\n      alpha=1.0-(1.0-alpha)*(1.0-alpha);\n      alpha*=alpha;\n      Cd.a=alpha+alpha;\n      gl_FragColor = Cd;\n    }"}function portalBaseVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n        uniform vec2 time;\n        uniform float rate;\n        varying vec2 shiftUv;\n        varying vec2 wUv;\n        \n        void main(){\n            shiftUv=(uv-.5);\n            \n            float t=time.x*rate;\n            vec2 rot=vec2( sin(t), cos(t) );\n            vec2 rotUV=vec2(0.0);\n            rotUV.x=rot.y*(uv.x-.5) + rot.x*(uv.y-.5);\n            rotUV.y=rot.y*(uv.y-.5) - rot.x*(uv.x-.5);\n            wUv=rotUV+.5;\n            \n            vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix*modelViewPosition;\n            \n        }"}function portalBaseFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n        uniform vec3 color;\n        uniform sampler2D alphaMap;\n        uniform sampler2D cloudNoise;\n        uniform vec2 intensity;\n        varying vec2 shiftUv;\n        varying vec2 wUv;\n        \n        #define TAU 6.28318530717958\n        void main() {\n            float suvLength=length(shiftUv)+.1;\n            vec2 suvSign=sign(shiftUv);\n            \n            vec2 rUv=sin( (suvLength+wUv*10.*shiftUv)*.5 );\n            rUv *= suvLength ;\n            \n            vec4 noiseCd=texture2D(cloudNoise,rUv);\n            vec2 aUv=wUv*(noiseCd.xy*.5+wUv);\n            \n            float alpha=texture2D(alphaMap,aUv).r;\n            \n            vec4 Cd=vec4( color*intensity.x*(1.0+alpha)*mix( noiseCd.rgb, vec3(1.0), alpha), 1.);\n            alpha*=max(0.0, alpha-noiseCd.r*noiseCd.g*noiseCd.b );\n            Cd.a=min(1.0, alpha);\n            \n            gl_FragColor = Cd;\n        }"}function itemBaseVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform vec2 time;\n    uniform float intensity;\n    uniform float rate;\n    varying vec3 pos;\n    varying float nDot;\n    varying vec2 vUv;\n    \n    void main(){\n      vUv=uv+vec2(rate*time.x, 0.0);\n      vec3 camDir=normalize( (projectionMatrix*viewMatrix*vec4(0.0,0.0,-1.0,1.0)).xyz );\n      nDot=dot( normal, camDir );\n      \n      pos=position;\n      vec4 modelViewPosition=modelViewMatrix * vec4(pos, 1.0);\n      gl_Position = projectionMatrix*modelViewPosition;\n      \n    }"}function itemBaseFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform vec3 color;\n    uniform sampler2D alphaMap;\n    uniform sampler2D cloudNoise;\n    uniform vec2 time;\n    uniform float intensity;\n    uniform float rate;\n    varying vec3 pos;\n    varying float nDot;\n    varying vec2 vUv;\n    \n    void main() {\n      vec4 Cd=vec4( color, 1.0);\n      \n      \n      vec2 nUV=pos.xy*.01+vec2(time.x*rate*.1, time.x*rate*.1);\n      vec4 noiseCd=texture2D(cloudNoise,nUV);\n      noiseCd.xyz=noiseCd.xyz*2.0-1.0;\n      nUV=vUv+noiseCd.xy*.05;\n      \n      float alpha=texture2D(alphaMap,nUV).r;\n      float blender=(nDot*.5+.5);\n      Cd.rgb=color*intensity*(1.0+alpha);//mix( vec3(0.5,0.5,1.0), vec3(0.0,0.2,0.8), blender); // Center Color, Edge Color\n      alpha=1.0-(1.0-alpha)*(1.0-alpha);\n      alpha*=alpha;\n      Cd.a=alpha+alpha;\n      gl_FragColor = Cd;\n    }"}function itemVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform vec2 time;\n    uniform float intensity;\n    uniform float rate;\n    varying vec3 pos;\n    varying float nDot;\n    varying vec2 vUv;\n    varying vec2 nUv;\n    \n    void main(){\n      vUv=uv;\n      nUv=uv*.5+vec2(rate*time.x*-.1, 0.0);\n      nUv.x=sin(nUv.x)*.5+.5;\n      vec3 camDir=normalize( (projectionMatrix*viewMatrix*vec4(0.0,0.0,-1.0,1.0)).xyz );\n      nDot=dot( normal, camDir );\n      \n      vec2 nUV=position.xy*.01+vec2(time.x*rate*.1, time.x*rate*.1);\n      vec3 pos=position;\n      vec4 modelViewPosition=modelViewMatrix * vec4(pos, 1.0);\n      gl_Position = projectionMatrix*modelViewPosition;\n      \n    }"}function itemFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform vec3 color;\n    uniform sampler2D alphaMap;\n    uniform vec2 time;\n    uniform float intensity;\n    uniform float rate;\n    uniform sampler2D cloudNoise;\n    varying vec3 pos;\n    varying float nDot;\n    varying vec2 vUv;\n    varying vec2 nUv;\n    \n    void main() {\n      vec4 Cd=vec4( color, 1.0);\n      float alpha=texture2D(alphaMap,vUv).r;\n      float noise=length(texture2D(cloudNoise,nUv).rgb)*.5;\n      float blender=(nDot*.5+.5);\n      Cd.rgb=color*blender;\n      Cd.rgb*=intensity*alpha;\n      Cd.a=blender*alpha+noise*alpha;\n      gl_FragColor = Cd;\n    }"}function itemZoomFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D color;\n    uniform vec2 time;\n    uniform float intensity;\n    uniform sampler2D cloudNoise;\n    varying vec2 vUv;\n    \n    void main() {\n      vec4 Cd=texture2D(color,vUv);\n      Cd.a=Cd.b;\n      Cd.rgb=vec3( Cd.rg*Cd.a, 0.0 );\n      Cd.rgb*=Cd.a* mix(.7, 1.0, gl_FrontFacing);\n      gl_FragColor = Cd;\n    }"}function pxlPrincipledVert(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t="\n    attribute vec3 color;\n    attribute vec3 shading;\n\n    varying float vFlicker;\n    varying vec2 vUv;\n    varying vec3 vCd;\n    varying vec3 vPos;\n    varying vec3 vLocalPos;\n    varying vec3 vN;\n    varying vec3 vLocalN;\n    varying vec3 vShading;\n    ";return e&&(t+="\n        ".concat(x.ShaderChunk.common,"\n        ").concat(x.ShaderChunk.shadowmap_pars_vertex,"\n      ")),t+="\n    \n    void main(){\n        vUv=uv;\n        \n        vShading=shading;\n        \n        vCd=color;\n        \n        vec3 transformed = vec3( position );\n        vec3 objectNormal = vec3( normal );\n        vec3 transformedNormal = objectNormal;\n        \n        \n        vLocalPos = position;\n        vN = (modelViewMatrix * vec4(normal, 0.0)).xyz;\n        vLocalN = ( modelMatrix * vec4(normal, 0.0)).xyz;\n        vec4 mvPos=modelViewMatrix * vec4(position, 1.0);\n        gl_Position = projectionMatrix*mvPos;\n        vPos = mvPos.xyz;\n        \n        ",e&&(t+="\n            ".concat(x.ShaderChunk.worldpos_vertex,"\n            ").concat(x.ShaderChunk.shadowmap_vertex,"\n          ")),t+="\n    }"}function pxlPrincipledFrag(e,t,i,s,a,r){var n=!1,o=1;e.hasOwnProperty("Specular")&&e.Specular>0&&(n=!0,o=e.Specular);var l=!1;e.PointColor&&(l=!0);var h=!0,d="1.0";e.hasOwnProperty("SurfaceNoise")&&(e.SurfaceNoise%1==0&&(d=e.SurfaceNoise+".0"),"0.0"==d&&(h=!1));var c="\n        ";if(t||(c+="uniform sampler2D dTexture;"),c+="\n    \n    uniform sampler2D noiseTexture;\n    uniform sampler2D detailTexture;\n        \n    uniform vec2 time;\n    uniform float cdMult;\n    uniform vec3 fogColor;\n    \n    varying vec2 vUv;\n    varying vec3 vCd;\n    varying vec3 vPos;\n    varying vec3 vLocalPos;\n    varying vec3 vN;\n    varying vec3 vLocalN;\n    varying vec3 vShading;\n    \n    varying float vFlicker;\n    \n    #define PI 3.14159265358979\n    \n    struct PointLight {\n      vec3 color;\n      float decay;\n      float distance;\n      vec3 position;\n    };\n    struct DirLight {\n      vec3 color;\n      vec3 direction;\n    };\n    ",s&&(c+="\n    #if NUM_POINT_LIGHTS > 0\n      uniform PointLight pointLights[NUM_POINT_LIGHTS];\n    #endif\n    #if NUM_DIR_LIGHTS > 0\n      uniform DirLight directionalLights[NUM_DIR_LIGHTS];\n    #endif\n      "),a&&(c+="\n      \n      ".concat(x.ShaderChunk.packing,"\n      \n      #if NUM_POINT_LIGHT_SHADOWS > 0\n          uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n          varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n          struct PointLightShadow {\n              float shadowBias;\n              float shadowNormalBias;\n              float shadowRadius;\n              vec2 shadowMapSize;\n              float shadowCameraNear;\n              float shadowCameraFar;\n          };\n          uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n      #endif\n      float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n          return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n      }\n      vec2 cubeToUV( vec3 v, float texelSizeY ) {\n          vec3 absV = abs( v );\n          float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n          absV *= scaleToCube;\n          v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n          vec2 planar = v.xy;\n          float almostATexel = 1.5 * texelSizeY;\n          float almostOne = 1.0 - almostATexel;\n          if ( absV.z >= almostOne ) {\n              if ( v.z > 0.0 )\n                  planar.x = 4.0 - v.x;\n          } else if ( absV.x >= almostOne ) {\n              float signX = sign( v.x );\n              planar.x = v.z * signX + 2.0 * signX;\n          } else if ( absV.y >= almostOne ) {\n              float signY = sign( v.y );\n              planar.x = v.x + 2.0 * signY + 2.0;\n              planar.y = v.z * signY - 2.0;\n          }\n          return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n      }\n      float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n          vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n          vec3 lightToPosition = shadowCoord.xyz;\n          float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\n           dp += shadowBias;\n          vec3 bd3D = normalize( lightToPosition );\n          #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n              vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n              return (\n                  texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n                  texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n                  texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n                  texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n                  texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n                  texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n                  texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n                  texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n                  texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n              ) * ( .11111111111 ) * (1.0-dp);\n          #else\n              return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) * (1.0-dp);\n          #endif\n      }\n    \n      vec3 directionToLight( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar  ){\n          vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n          vec3 lightToPosition = shadowCoord.xyz;\n          float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\n          dp += shadowBias;\n          vec3 bd3D = normalize( lightToPosition );\n          vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n          return texture2D( pointShadowMap[0], cubeToUV( bd3D, texelSize.y )).rgb;\n      }\n      ")),c+="\n    void main(){\n      ",l)c+="vec3 vertCd = vCd;";else if(t){var toFloatStr=e=>e%1==0?e+".0":e+"",u=toFloatStr(t.r),p=toFloatStr(t.g),m=toFloatStr(t.b);c+="vec3 vertCd = vec3( ".concat(u,", ").concat(p,", ").concat(m," ) ;")}else c+="vec3 vertCd = texture2D(dTexture,vUv).rgb ;";c+="\n        \n        vec4 Cd=vec4( vertCd, 1.0 );\n        float specular = 0.0;\n        ",i&&(c+="\n          float depth = gl_FragCoord.z / gl_FragCoord.w *.0004;\n          Cd.rgb=  mix( Cd.rgb, fogColor, depth );\n          ");var v="",g="",f="";if(h&&("1.0"!=d&&(v="*"+d),c+="\n            float detailMult = (texture2D(detailTexture,vUv*4.0).r)*.5+.5;\n            ",g="+detailMult * (shadowInf*.5+.5) ".concat(v),f="(detailMult+.5) ".concat(v)),s&&(c+="\n          #if NUM_POINT_LIGHTS > 0 || NUM_DIR_LIGHTS > 0\n            vec4 lights = vec4(0.0, 0.0, 0.0, 1.0);\n          #endif\n          \n          #if NUM_POINT_LIGHTS > 0\n            for(int i = 0; i < NUM_POINT_LIGHTS; i++) {\n                vec3 lightVector = normalize(vPos - pointLights[i].position);\n                vec3 lightInf= clamp(dot(-lightVector, vN), 0.0, 1.0) * pointLights[i].color;\n                //lightInf = mix( lightInf, 1.0-(1.0-lightInf)*(1.0-lightInf), .2);\n                float distFalloff =  1.0-min(1.0, length(vPos - pointLights[i].position) * pointLights[i].decay*.008 );\n                lightInf *=  distFalloff;\n                lights.rgb += lightInf;\n                ",n&&(c+="\n                  distFalloff = (dot(vN, normalize(-vPos)) )*distFalloff;\n                  specular += distFalloff;\n                  "),c+="\n            }\n          #endif\n            \n          #if NUM_DIR_LIGHTS > 0\n            for(int i = 0; i < NUM_DIR_LIGHTS; i++) {\n                vec3 lightInf= max(0.0, dot(directionalLights[i].direction, vN)*.65+.35) * directionalLights[i].color;\n                lights.rgb += lightInf;\n            }\n          #endif\n            \n            \n          #if NUM_POINT_LIGHTS > 0 || NUM_DIR_LIGHTS > 0\n            Cd.rgb *= lights.rgb;\n          #endif\n          ",n&&(c+="\n            Cd.rgb += vertCd * specular * ".concat(o,";\n            "))),a){c+="\n          #if NUM_POINT_LIGHT_SHADOWS > 0\n            \n            float shadowInf = 0.0;\n            float detailInf = 0.0;\n            float lShadow = 0.0;\n            int i = 0;\n            ";for(var y=0;y<r;++y)c+="\n                i=".concat(y,";\n                lShadow = getPointShadow( pointShadowMap[").concat(y,"], pointLightShadows[i].shadowMapSize, pointLightShadows[i].shadowBias*.75, pointLightShadows[i].shadowRadius*1.65, vPointShadowCoord[i], pointLightShadows[i].shadowCameraNear, pointLightShadows[i].shadowCameraFar );\n                shadowInf = max( lShadow, shadowInf);\n                ");c+="\n            shadowInf = shadowInf;\n            Cd.rgb*=shadowInf ".concat(g," ;\n            "),h&&(c+="\n              #else\n                Cd.rgb*=".concat(f,";\n              ")),c+="\n          #endif\n          "}else h&&(c+="\n            Cd.rgb*=".concat(f,";\n            "));return c+="\n        Cd*=cdMult;\n        \n        // Convert to sRGB\n        Cd.rgb = mix( 12.92 * Cd.rgb, 1.055 * pow(Cd.rgb, vec3(1.0 / 2.4)) - 0.055, step(0.0031308, Cd.rgb) );\n\n        gl_FragColor=Cd;\n    }"}function emberWispsVert(e){return"\n// Ember Settings\n  const vec3 EmberEarlyCd = vec3( 0.8, 0.5, .1 );\n  const vec3 EmberOldCd = vec3( 0.634, 0.20, 0.20 );\n  const float BaseSpeed = 0.77;\n  const float SpeadInf = 0.7;\n  const float EmberSpread = 5.0;\n  const float EmberFadeDistance = 0.04;\n\n// -- -- --\n  \n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n// -- -- --\n\nuniform sampler2D noiseTexture;\nuniform vec2 time;\nuniform vec3 windDir;\nuniform vec3 offsetPos;\nuniform float rate;\nuniform float pointScale;\nuniform vec3 sliders;  \n\nattribute vec4 seeds;\nattribute vec2 atlas;\n\nvarying vec3 vCd;\nvarying vec2 vAtlas;\nvarying vec2 vRot;\nvarying float vAlpha;\nvarying float vBrightness;\n\n\n\nfloat colDetect( vec2 pos, vec2 pt, vec2 n1, vec2 n2 ){\n    vec2 ref=pos-pt;\n    float ret = step( dot( ref, n1 ), 0.0 );\n    ret *= step( dot( ref, n2 ), 0.0 );\n    \n    return ret;\n}\n\n\nvoid main(){\n    vAtlas=atlas;\n    \n    float rot=seeds.z+time.x*seeds.z*3.;\n    vRot=vec2( sin(rot), cos(rot) );\n    \n    vec3 pOff=vec3(seeds.z, seeds.y, seeds.w) ;\n    \n    vec2 sinUV=abs(sin(pOff.xz*.5+seeds.zw+time.x*.1)*.5+.5);\n    vec3 noiseCd=texture2D(noiseTexture, sinUV ).rgb*4.5 + 0.50;\n    \n    float rateShift = (BaseSpeed*(seeds.x*.4+.6));\n    float t=time.x*rate*rateShift;\n    \n    // Random shift to a cycle y movement\n    float shiftY= mod( t+t*seeds.x+seeds.z*8.0+noiseCd.r*10.20*(seeds.y*2.0-1.0)+noiseCd.b+(-seeds.x+seeds.y)*4.0, 10.0);\n    \n    // Change up ages of embers\n    float lifeFade = shiftY*.1;\n    float fadeDrop = min(1.0, lifeFade*lifeFade*4. ); \n    //\n    float life = 1.0-max(0.0,abs(shiftY-seeds.x*.1)*(1.0-(seeds.x*1.0)) );\n    life = 1.0-((shiftY*.001-seeds.x*.2) );\n    \n    pOff.y=shiftY*seeds.y;\n    \n    pOff.y=(pOff.y)+shiftY; \n    vec3 pos= pOff ;\n    \n\n    float spreadPerc = SpeadInf  * min(1.0, life*1.);\n    pos.xz=(noiseCd.rg*noiseCd.r)*(seeds.x)*(life*seeds.zy*(seeds.w*4.0+1.)) * spreadPerc;\n    pos.xz = mix( pos.xz, normalize( pos.xz ), step(1.0, length(pos.xz)) ) * EmberSpread;\n    \n    \n    // Directional push\n    float yPush = ( life * (life*.5+.5))  * min(1.0,pos.y*.12) * 2.8;\n    pos.xz += windDir.xz * yPush * pos.y*(.5+life*.5);\n    pos.y += yPush;\n    \n    float pToCamLen = length(pos-cameraPosition);\n    float pScalar = max( 0., (1.-pToCamLen *  0.0806 )); // 0.0385\n    pScalar += max(0.0,pToCamLen - 0.4) * 0.005;\n    \n    vAlpha = min(1.0, (seeds.x*.15+.7) * pScalar*3.0 );\n\n    \n    vAlpha=max(0.0, life*life-seeds.z-seeds.z);\n    float distMult = ( length( pos )*EmberFadeDistance );\n    distMult = 1.0 - ( distMult * distMult );\n    vAlpha *= distMult;\n    \n    \n    float pScale = pointScale * seeds.w * pScalar + 2.0;\n    \n    gl_PointSize =  pScale*fadeDrop ;\n    \n    \n    float tightenBase = min( 1.0, pos.y*.2 );\n    pos.xz *= tightenBase*tightenBase;\n    \n    pos += modelMatrix[3].xyz + vec3( -1.76, -0.2269, -0.25);\n    vec4 mvPos=viewMatrix * vec4(pos, 1.0);\n    gl_Position = projectionMatrix*mvPos;\n    \n    float cdAge = clamp( 1.0 - life, 0.0, 1.0);\n    \n    vCd = mix( EmberEarlyCd, EmberOldCd, cdAge )  ;\n    \n    vBrightness = 1.045 + fadeDrop*2.;\n}"}function emberWispsFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D atlasTexture;\n    uniform vec2 time;\n    uniform float rate;\n    \n    varying vec3 vCd;\n    varying vec2 vAtlas;\n    varying vec2 vRot;\n    varying float vAlpha;\n    varying float vBrightness;\n    \n    \n    \n    // -- -- --\n    \n    // Human Eye Adjusted Luminance\n    //   https://en.wikipedia.org/wiki/Grayscale\n    float luma(vec3 color) {\n      return dot( color, vec3(0.2126, 0.7152, 0.0722) );\n    }\n      \n    // -- -- --\n    \n    \n    void main(){\n        vec2 uv=gl_PointCoord;\n\n        vec2 pos = (uv-.5)*.85;\n\n        vec2 rotUV;\n        rotUV.x = vRot.y * pos.x - vRot.x * pos.y;\n        rotUV.y = vRot.x * pos.x + vRot.y * pos.y;\n        rotUV=(rotUV+.5)*.25+vAtlas;\n        \n        \n        vec4 dustCd=texture2D(atlasTexture,rotUV);\n        float alpha= clamp( dustCd.a*vAlpha, 0.0, 1.0) ;\n        \n        dustCd.rgb *= vBrightness;\n        \n        float dirtLuma = luma( dustCd.rgb );\n        vec4 Cd=vec4( dirtLuma * vCd * vBrightness, alpha );\n        \n        gl_FragColor=Cd;\n    }"}function dustVert(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={pOpacity:1,proxDist:200,hasLights:!1,fadeOutScalar:1.59,wanderInf:1,wanderRate:1,wanderFrequency:2.85};if(e&&"object"==typeof e){var i=Object.keys(e);Object.keys(t).forEach((s=>{i.includes(s)||(e[s]=t[s])}))}var toFloatStr=e=>(e+"").includes(".")?e:e+".0",s="\n    // Fade-Out Influence multiplier\n        const float ParticleOpacity = ".concat(toFloatStr(e.pOpacity),";\n        const float FadeOutScalar = ").concat(toFloatStr(e.fadeOutScalar),";\n        const float WanderInf = ").concat(toFloatStr(e.wanderInf),";\n        const float WanderRate = ").concat(toFloatStr(e.wanderRate),";\n        const float WanderFrequency = ").concat(toFloatStr(e.wanderFrequency),";\n\n        #define PROX ").concat(e.proxDist.toFixed(3),"\n        #define PROX_INV 1.0/").concat((.8*e.proxDist).toFixed(3),"\n\n    // -- -- --\n  ");return s+="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ",s+="\n    // -- -- --\n\n    uniform sampler2D noiseTexture;\n    uniform vec2 time;\n    uniform float rate;\n    uniform vec2 pointScale;\n    uniform vec3 positionOffset;\n    uniform vec3 windDir;\n  ",e.hasLights&&(s+="\n  #if NUM_POINT_LIGHTS > 0\n    struct PointLight {\n      vec3 color;\n      float decay;\n      float distance;\n      vec3 position;\n    };\n    uniform PointLight pointLights[NUM_POINT_LIGHTS];\n  #endif\n    "),s+="\n    \n    attribute vec4 seeds;\n    attribute vec2 atlas;\n    \n    varying vec2 vAtlas;\n    varying vec2 vRot;\n    varying float vScalar;\n    varying float vAlpha;\n    \n    \n    // -- -- --\n\n    float colDetect( vec2 pos, vec2 pt, vec2 n1, vec2 n2 ){\n        vec2 ref=pos-pt;\n        float ret = step( dot( ref, n1 ), 0.0 );\n        ret *= step( dot( ref, n2 ), 0.0 );\n        \n        return ret;\n    }\n    \n    vec3 randomVec( vec3 seed ) {\n      return vec3(\n        fract( dot(seed,vec3(12.9898, 78.233, 45.164)) * 43758.5453 ),\n        fract( dot(seed,vec3(93.9898, 67.345, 12.345)) * 43758.5453 ),\n        fract( dot(seed,vec3(54.123, 98.765, 32.123)) * 43758.5453 )\n      );\n    }\n\n    // -- -- --\n    \n    void main(){\n        vAtlas=atlas;\n        \n        float rot=seeds.z+time.x*(seeds.z*2.);\n        vRot=vec2( sin(rot), cos(rot) );\n        \n        float t=time.x*rate*0.;\n        \n        vec3 pOff=seeds.xyz * vec3(PROX);\n        \n        // Loop point positions based on camera location\n        float yFract=fract(t+seeds.x);\n        pOff.xyz += time.x * windDir.xyz; \n        vec3 pos= pOff ;\n        \n        vec3 noiseCd=texture2D(noiseTexture, sin(pos.xz*.05+seeds.xz+time.x*2.1) ).rgb-.5;\n        vec3 noiseCdb=texture2D(noiseTexture, sin((1.0-pos.xz)*.05+seeds.yw+time.x*.1) ).rgb-.5;\n        \n        // -- -- --\n        \n        // Meandering points\n        \n        \n        vec3 randDirA = randomVec( seeds.xyz );\n        vec3 randDirB = randomVec( seeds.wyz );\n        vec3 randDirC = randomVec( seeds.zxy );\n        vec3 randDirBlend = mix( randDirA, randDirB, sin( randDirC * time.x * WanderFrequency ) ) * WanderInf;\n        \n        // -- -- --\n        \n        pos += randDirBlend * sin( seeds.x+seeds.z+noiseCd.r*noiseCd.g*seeds.y+noiseCdb.b + (time.x+seeds.y*10.) * WanderRate * seeds.w*noiseCdb.g ) * WanderRate * ( 5. + seeds.z );\n\n        pos += (noiseCd * noiseCdb ) * 50. * ( (seeds.w+.75)*4.);\n        pos+=positionOffset;\n\n        pos = mod( pos-cameraPosition, PROX) + cameraPosition - PROX*.5;\n        \n        \n        float pScalar = clamp( (1.-length(pos-cameraPosition )*PROX_INV) * FadeOutScalar, 0.0, 1.0  );\n        float aMult = min(1.0, pScalar*3.0);\n        vAlpha = (seeds.x*.5+.7) * aMult;\n\n  ",e.hasLights&&(s+="\n      #if NUM_POINT_LIGHTS > 0\n        float lightInf = 1.0;\n        for(int x = 0; x < NUM_POINT_LIGHTS; ++x ){\n            vec3 lightVector = normalize(pos - pointLights[i]);\n            lightInf = min(lightInf, length(pos - pointLights[i]) *.05 );\n        }\n        vAlpha*=(1.0-lightInf)*.8+.2;\n      #endif\n    "),s+="\n        vScalar = pScalar * ParticleOpacity ;\n        float pScale = pointScale.x * (seeds.w*.5+.5)*pScalar + 1.0;\n        pScale *= step( .5, atlas.x )*.5+1.;\n\n        gl_PointSize = pScale;\n        \n        vec4 mvPos=viewMatrix * vec4(pos, 1.0);\n        gl_Position = projectionMatrix*mvPos;\n    }"}function dustFrag(){var e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\n    uniform sampler2D atlasTexture;\n    uniform sampler2D atlasAlphaTexture;\n    uniform vec2 time;\n    uniform float rate;\n    \n    varying vec2 vAtlas;\n    varying vec2 vRot;\n    varying float vScalar;\n    varying float vAlpha;\n    \n    void main(){\n\n        if( vAlpha < .01 ){\n          discard;\n        }\n\n\n        vec2 uv=gl_PointCoord;\n\n        vec2 pos = (uv-.5)*.85;\n\n        vec2 rotUV;\n        rotUV.x = vRot.y * pos.x - vRot.x * pos.y;\n        rotUV.y = vRot.x * pos.x + vRot.y * pos.y;\n        rotUV=(rotUV+.5)*.25+vAtlas;\n\n      ",e+=arguments.length>0&&void 0!==arguments[0]&&arguments[0]?"\n        vec4 dustCd=vec4(\n                        texture2D(atlasTexture,rotUV).rgb, // rgb\n                        texture2D(atlasAlphaTexture,rotUV).r // alpha\n                      ); \n\n    ":"\n        vec4 dustCd= texture2D(atlasTexture,rotUV);\n\n    ",e+="\n        float alpha = dustCd.a * vAlpha * vScalar;\n        vec4 Cd=vec4( dustCd.rgb, alpha );\n\n        gl_FragColor=Cd;\n    }"}function smokeVert(){return"\n// Billowy goodness!\n  const float BaseSpread = 200.0;\n  const float SmokeBrightness = 0.65;\n  const float InnerBulster = -0.05;\n  const float SmokeDensity = 0.12;\n  const float WindInfluenceBoost = .45;\n\n  const float TightenBaseSpread = 1.0;\n  const float TightenMidSpread = 0.08;\n  const float TightenTipSpread = 0.20;\n\n  // -- -- --\n  \n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n         \n\n  // -- -- --\n         \n    uniform sampler2D noiseTexture;\n    uniform vec2 time;\n    uniform float rate;\n    uniform vec3 windDir;\n    uniform vec3 offsetPos;\n    uniform vec2 pointScale;\n    uniform vec3 sliders;\n    \n    attribute vec4 seeds;\n    attribute vec2 atlas;\n    \n    varying vec2 vAtlas;\n    varying vec2 vRot;\n    varying float vAlpha;\n    varying float vBrightness;\n    \n    \n    #define PROX 6.0\n    \n    \n    float colDetect( vec2 pos, vec2 pt, vec2 n1, vec2 n2 ){\n      vec2 ref=pos-pt;\n      float ret = step( dot( ref, n1 ), 0.0 );\n      ret *= step( dot( ref, n2 ), 0.0 );\n      \n      return ret;\n    }\n     \n        \n    void main(){\n      vAtlas=atlas;\n      \n      float rot=seeds.z+time.x*(seeds.z*2.);\n      vRot=vec2( sin(rot), cos(rot) );\n      \n      vec3 pOff=vec3(seeds.z, seeds.y, seeds.w) ;\n      \n      vec2 sinUV=abs(sin(pOff.xz*.5+seeds.zw+time.x*.1)*.5+.5);\n      vec3 noiseCd=texture2D(noiseTexture, sinUV ).rgb*4.5 + 0.50;\n      \n      float t=time.x*rate;\n      float shiftY= mod( t+t*seeds.x+seeds.z*24.0+noiseCd.r+noiseCd.b+(seeds.x+seeds.y)*2.0, 14.0);\n      float life = max(0.0,(shiftY-seeds.x)*0.07142857142857142)*.9+.2;\n      float alphaMult = (1.0-(1.0-life)*(1.0-life))*SmokeDensity;\n      \n      pOff.y=shiftY*seeds.y*life - (1.0-life);\n      \n      pOff.y=(pOff.y)+shiftY; \n      vec3 pos= pOff ;\n      \n      \n      // Magic numbers!  Boo!!\n      float tightenTip = max(0.0,life-.73);\n      tightenTip = 1.0 - (1.0-tightenTip) * (1.0-tightenTip);\n      //tightenTip *= tightenTip;\n      float tightenBase = max(0.0, (1.0-life)*InnerBulster);\n      float tightenMid = max(0.0, TightenBaseSpread - tightenTip - tightenBase - seeds.x*.2);\n      \n      float curBaseSpread = BaseSpread * tightenBase +\n                            BaseSpread * tightenMid * TightenMidSpread +\n                            BaseSpread * tightenTip * TightenTipSpread ;\n      \n      //pos.xz=clamp((noiseCd.rg*noiseCd.b)*seeds.w, vec2(0.0), vec2(1.0))*curBaseSpread*(life*(seeds.zy*.6));\n      pos.xz=(noiseCd.rg*noiseCd.b)*seeds.w*curBaseSpread*life;\n      \n      // Wind -- Forces\n      //   Magic numbers, yarb!\n      float windInf = life * life * (life*.5+.5);\n      vec2 curWindDir = windInf * windDir.xz ;\n      \n      float yPush = ( life * (life*.5+.5))* min(1.0,pos.y*.12) * .08;\n      pos.xz += curWindDir*life + curWindDir * WindInfluenceBoost + offsetPos.xz ;\n      \n      \n      // Alpha with cam distance inf\n      float pScalar = 1.0-min( 1.0, (length(pos-cameraPosition )*0.004) );\n      pScalar=1.0-(pScalar*pScalar);\n      float aMult = min(1.0, pScalar*2.0);\n      vAlpha = (seeds.x*.5+.7) * aMult;\n\n      \n      // Alpha from gettin' old\n      vAlpha=(1.0-life)*min(1.0,alphaMult);\n      vec3 doubleCd=texture2D(noiseTexture, sinUV+pos.xz*.5+vec2(seeds.y,pos.y)).rgb ;\n      pos.xz=(pos.xz*(0.9+seeds.xy*.2)+doubleCd.rb*10.0)*min(1.0,life+seeds.y);\n      \n      \n      // Draw size, particle scale\n      pScalar = 1.0-(1.0-pScalar)*.75*(1.0-pScalar);\n      float pScale = pointScale.x * seeds.w * 0.6 * pScalar + (175.0+125.0*life*pScalar)*(1.0-pScalar);\n      pScale += 150.0*(clamp(-(pScalar-.45)*10.0,0.0,1.0));\n\n      gl_PointSize = pScale;\n      \n      // Brightness multiplier\n      vBrightness = 1.0-tightenMid*.1 - tightenTip + tightenBase;\n      float originDelta = length(pos)*(-InnerBulster);\n      vBrightness *= max(0.0, 1.0-originDelta * life * 0.807) * SmokeBrightness;\n      \n      \n      // Add Particle System position\n      pos += modelMatrix[3].xyz + vec3( -1.1, 0.0, 0.67);\n      \n      vec4 mvPos=viewMatrix * vec4(pos, 1.0);\n      gl_Position = projectionMatrix*mvPos;\n    }"}function smokeFrag(){var e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\n    // -- -- --\n    \n    uniform sampler2D atlasTexture;\n    uniform sampler2D atlasAlphaTexture;\n    uniform vec2 time;\n    uniform float rate;\n    \n    varying vec2 vAtlas;\n    varying vec2 vRot;\n    varying float vAlpha;\n    varying float vBrightness;\n    \n\n    // -- -- --\n    \n    // Human Eye Adjusted Luminance\n    //   https://en.wikipedia.org/wiki/Grayscale\n    float luma(vec3 color) {\n      return dot( color, vec3(0.2126, 0.7152, 0.0722) );\n    }\n      \n    // -- -- --\n      \n\n    void main(){\n        vec2 uv=gl_PointCoord;\n\n        vec2 pos = (uv-.5)*.85;\n\n        vec2 rotUV;\n        rotUV.x = vRot.y * pos.x - vRot.x * pos.y;\n        rotUV.y = vRot.x * pos.x + vRot.y * pos.y;\n        rotUV=(rotUV+.5)*.25+vAtlas;\n        \n      ",e+=arguments.length>0&&void 0!==arguments[0]&&arguments[0]?"\n        vec4 dustCd=vec4(\n                        texture2D(atlasTexture,rotUV).rgb, // rgb\n                        texture2D(atlasAlphaTexture,rotUV).r // alpha\n                      ); \n\n    ":"\n        vec4 dustCd= texture2D(atlasTexture,rotUV);\n\n    ",e+="\n        float alpha=dustCd.a*vAlpha;\n        vec4 Cd=vec4( dustCd.rgb, alpha );\n\n        float lumaCd = luma( Cd.rgb );\n\n        Cd.rgb = mix( vec3( lumaCd ), Cd.rgb, vBrightness*.2 );\n\n        Cd.rgb *= vec3(vBrightness);\n        //Cd.rgb *= Cd.rgb*.5+.5;\n        \n        gl_FragColor=Cd;\n    }"}function snowFallVert(){var e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="\n    uniform vec2 time;\n    uniform float rate;\n    uniform float pointScale;\n    \n    attribute vec4 seeds;\n    attribute vec2 atlas;\n    \n    varying vec2 vAtlas;\n    varying vec2 vRot;\n    varying float vScalar;\n    \n    #define PROX 1000.0\n    #define LAND 50.0\n    \n    float colDetect( vec2 pos, vec2 pt, vec2 n1, vec2 n2 ){\n        vec2 ref=pos-pt;\n        float ret = step( dot( ref, n1 ), 0.0 );\n        ret *= step( dot( ref, n2 ), 0.0 );\n        \n        return ret;\n    }\n    \n    \n    void main(){\n        vAtlas=atlas;\n        \n        float rot=seeds.z+time.x*(seeds.z*2.);\n        vRot=vec2( sin(rot), cos(rot) );\n        \n        float t=time.x*rate;\n        \n        vec3 pOff=vec3( seeds.x, 0, seeds.y)* vec3(PROX);\n        \n        // Loop point positions based on camera location\n        float yFract=fract(t+seeds.z);\n        pOff.y=PROX-yFract*(PROX+LAND); \n        vec3 pos= pOff ;\n        vec2 camXZ=cameraPosition.xz;\n        pos.xz= mod( pos.xz-camXZ, PROX) + camXZ - PROX*.5;\n        \n        \n        // Get some roof tops working\n        //   Using opposing points and 2 normals in xz space to determin y floor position\n        // Find rooves from xz pos + dot products\n        float floor=0.0;\n    ",!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&(e+="\n        // -- --\n        vec2 lp1=vec2( -186.0, -1002.0 ); // Point 1\n        vec2 l1n1=vec2(-.1,1.); // Normal 1\n        vec2 l1n2=vec2(1.,-.1); // Normal 2\n        vec2 lp2=vec2( -1101.0, -1720.0 ); // Point 2\n        vec2 l2n1=vec2(.1,-1.1);\n        vec2 l2n2=vec2(-1.,.1);\n        floor = max( floor, 170.0*colDetect( pos.xz, lp1,l1n1,l1n2 ) * colDetect( pos.xz, lp2,l2n1,l2n2 ) ); // Lobby roof\n\n        lp1=vec2( -217.0, 786.0 ); // Point 1\n        l1n1=vec2(.2,-1.); // Normal 1\n        l1n2=vec2(1.,.1); // Normal 2\n        lp2=vec2( -940.0, 1293.0 ); // Point 2\n        l2n1=vec2(-.2,1.);\n        l2n2=vec2(-1.,-.1);\n        floor = max( floor, 500.0*colDetect( pos.xz, lp1,l1n1,l1n2 ) * colDetect( pos.xz, lp2,l2n1,l2n2 ) ); // sunflower roof\n\n        lp1=vec2( 204.028, 56.7629 ); // Point 1\n        l1n1=vec2( 0.152344, -0.988327 ); // Normal 1\n        l1n2=vec2( -0.999862, 0.0165819 ); // Normal 2\n        lp2=vec2( 755.264, 754.843 ); // Point 2\n        l2n1=vec2( -0.160366, 0.987058 );\n        l2n2=vec2( 0.999849, 0.0173488 );\n        floor = max( floor, 150.0*colDetect( pos.xz, lp1,l1n1,l1n2 ) * colDetect( pos.xz, lp2,l2n1,l2n2 ) ); // sunflower roof\n        "),e+="  \n        // Prevent snow drifting after hitting the ground\n        float yLimit=max( floor, pos.y ) * .08 * seeds.z;\n        pos.xz+=vec2( sin(pos.x+yLimit*seeds.x), sin(pos.z+pos.x+yLimit*seeds.y) )*10.; // Snow sway in the sky\n        \n        // Shift Y position per camera height\n        pos.y+=cameraPosition.y-yFract*(cameraPosition.y); \n        pos.y=max( floor+1.5, pos.y );\n        \n        float melt=min(1.0, (pOff.y+LAND-floor)*.02);\n        float pScalar = max( 0., (1.-length(pos-cameraPosition )*0.001) * melt );\n        \n        vScalar = pScalar;\n        float pScale = pointScale * seeds.w * pScalar ;\n        gl_PointSize = pScale;\n        \n        vec4 mvPos=viewMatrix * vec4(pos, 1.0);\n        gl_Position = projectionMatrix*mvPos;\n    }"}function snowFallFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D snowTexture;\n    uniform vec2 time;\n    uniform float rate;\n    \n    varying vec2 vAtlas;\n    varying vec2 vRot;\n    varying float vScalar;\n    \n    void main(){\n        vec2 uv=gl_PointCoord;\n\n        vec2 pos = uv-.5;\n\n        vec2 rotUV;\n        rotUV.x = vRot.y * pos.x - vRot.x * pos.y;\n        rotUV.y = vRot.x * pos.x + vRot.y * pos.y;\n        rotUV=(rotUV+.5)*.25+vAtlas;\n        \n        float alpha=texture2D(snowTexture,rotUV).r * vScalar;\n        vec4 Cd=vec4( vec3(1.), alpha );\n\n        gl_FragColor=Cd;\n    }"}function worldPositionVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n  varying vec3 pos;\n  \n  void main(){\n    vec3 transformed = vec3( position );\n      vec4 mvPosition = modelViewMatrix  * vec4( transformed, 1.0 );\n    pos=((projectionMatrix * modelMatrix * vec4( transformed-vec3(0.0,0.0,-500.0), 1.0 )).xyz*.0001)*.5+.5;\n    \n    gl_Position = projectionMatrix * mvPosition;\n  }"}function worldPositionFrag(){var e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e="#include <packing>\n  "+e,e+="\n    uniform sampler2D diffuse;\n    uniform sampler2D depth;\n    uniform float camNear;\n    uniform float camFar;\n    varying vec3 pos;\n    \n    void main() {\n      \n      vec4 Cd=vec4( pos, 1.0 );\n      gl_FragColor = Cd;\n    }"}function glowPassPostProcess(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D tDiffuse;\n    uniform sampler2D gDiffuse;\n    uniform sampler2D rDiffuse;\n    uniform sampler2D sceneDepth;\n    uniform vec2 time;\n    uniform vec2 ratio;\n    varying vec2 vUv;\n\n        #define PI 3.14159265358979\n        \n    void main() {\n      vec4 Cd=texture2D( tDiffuse, vUv );\n      vec4 gCd=texture2D( gDiffuse, vUv );\n      vec4 rCd=texture2D( rDiffuse, vUv );\n      \n      Cd.rgb=gCd.rgb + gCd.rgb*length(gCd.rgb) + rCd.rgb  + Cd.rgb ;\n\n      Cd.a=1.0;\n      gl_FragColor = Cd;\n    }"}function textureStorePass(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D tDiffuse;\n    uniform sampler2D tDiffusePrev;\n    uniform sampler2D tDiffusePrevRoom;\n    uniform float roomComposer;\n    varying vec2 vUv;\n        \n    void main() {\n      vec4 Cd = texture2D( tDiffusePrev, vUv );\n      vec3 prevRoomCd = texture2D( tDiffusePrevRoom, vUv ).rgb;\n      Cd.rgb=mix( Cd.rgb, prevRoomCd, roomComposer);\n      //Cd.rgb=Cd.rgb + prevRoomCd;\n      Cd.a=1.0;\n      gl_FragColor = Cd;\n    }"}function compLayersPostProcess(){return"\n    uniform sampler2D tDiffuse;\n    uniform sampler2D mtDiffuse;\n    uniform sampler2D sceneDepth;\n    uniform sampler2D noiseTexture;\n    uniform float exposure;\n    uniform vec2 camRotPitch;\n    uniform vec2 time;\n    varying vec2 vUv;\n\n    void main() {\n      vec4 Cd=texture2D(tDiffuse,vUv)*exposure;\n      vec4 mBlurCd=texture2D(mtDiffuse,vUv)*exposure;\n      vec4 depth=texture2D(sceneDepth,vUv);\n      \n  ////////////////////////\n  /*\n      vec2 uv=vUv;\n      float pi=3.14159265358979;\n      float t=-time.x*.007;\n      float pitch=camRotPitch.y;//depth.w*2.0-1.0;\n      float yaw=camRotPitch.x;\n      \n      float distMult=depth.x*2.0;\n      vec2 noiseUV=vec2(fract(uv.x*distMult+t+yaw), fract(uv.y*distMult+pitch));\n      vec3 noiseCd=texture2D(noiseTexture,noiseUV).rgb;\n      noiseUV=vec2(fract(uv.x*distMult+t*.5+yaw), fract(uv.y*.5*distMult+t*.25+pitch));\n      noiseCd.g=texture2D(noiseTexture,noiseUV).g;\n      noiseUV=vec2(fract(uv.x*.8*distMult+t*1.3+yaw), fract(uv.y*.3*distMult+t*.5+ pitch + depth.x*2.0));\n      noiseCd.b=texture2D(noiseTexture,noiseUV).b;\n      float mult=noiseCd.x*noiseCd.y*noiseCd.z*1.3;\n      mult*=max(0.0, 1.0-depth.x) + (1.0-depth.z*.6);\n      \n      float bg=length(depth.rgb)<.02 ? 0.0 : 1.0;\n      float bval=length(bloomCd.rgb);\n      mult= mult*(bg+bval) ;//*(1.0-depth.z);\n      Cd.rgb= mix( Cd.rgb, vec3(mult*.2), mult );\n      */\n      \n      Cd.rgb+=mBlurCd.rgb;\n      Cd.a=1.0;\n      gl_FragColor = Cd;\n    }"}function crossAntiAliasPass(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D tDiffuse;\n    uniform vec2 resUV;\n    uniform float ratio;\n    uniform vec3 gamma;\n    varying vec2 vUv;\n\n    // 1/4 ==  0.25\n    //  + 2 center samples, 1/6 ==  0.166...\n    #define AADIV 0.1666666666666666\n    const int runCount = 4;\n    const vec2 runDir[4] = vec2[4](\n                              vec2( -1.0, -1.0 ),\n                              vec2( -1.0, 1.0 ),\n                              vec2( 1.0, -1.0 ),\n                              vec2( 1.0, 1.0 )\n                            );\n\n    void main() {\n      vec4 Cd=texture2D(tDiffuse,vUv)*2.0;\n            \n      float dist = 1.0;\n      vec2 baseUV=vUv;\n      vec2 curUV;\n      vec3 curCd;\n      for(int s=0; s<runCount; ++s){\n        curUV = baseUV+runDir[s]*(resUV);//*dist);\n        curCd = texture2D(tDiffuse,curUV).rgb;\n        Cd.rgb+=curCd;\n      }\n      Cd.rgb=Cd.rgb*AADIV;\n      Cd.a=1.0;\n      \n      //Cd.rgb = pow(Cd.rgb, vec3(gamma.x));\n      Cd.rgb = vec3(1.0)-(vec3(1.0)-Cd.rgb)*gamma.y + Cd.rgb*(1.0-min(1.0,length(Cd.rgb)))*gamma.z;\n      gl_FragColor = Cd;\n    }"}function boxAntiAliasPass(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D tDiffuse;\n    uniform vec2 resUV;\n    uniform float ratio;\n    uniform vec3 gamma;\n    varying vec2 vUv;\n\n    // 1/8 ==  0.125\n    //  + 2 center samples, 1/10 ==  0.1\n    #define AADIV 0.1\n    const int runCount = 8;\n    const vec2 runDir[8] = vec2[8](\n                              vec2( -1.0, -1.0 ),\n                              vec2( -1.0, 1.0 ),\n                              vec2( 1.0, -1.0 ),\n                              vec2( 1.0, 1.0 ),\n\n                              vec2( -1.0, 0.0 ),\n                              vec2( 0.0, -1.0 ),\n                              vec2( 0.0, 1.0 ),\n                              vec2( 1.0, 0.0 )\n                            );\n\n    void main() {\n      vec4 Cd=texture2D(tDiffuse,vUv)*2.0;\n            \n      float dist = 1.0;\n      vec2 baseUV=vUv;\n      vec2 curUV;\n      vec3 curCd;\n      for(int s=0; s<runCount; ++s){\n        curUV = baseUV+runDir[s]*(resUV);//*dist);\n        curCd = texture2D(tDiffuse,curUV).rgb;\n                Cd.rgb+=curCd;\n      }\n      Cd.rgb=Cd.rgb*AADIV;\n      Cd.a=1.0;\n      \n      //Cd.rgb = pow(Cd.rgb, vec3(gamma.x));\n      Cd.rgb = vec3(1.0)-(vec3(1.0)-Cd.rgb)*gamma.y + Cd.rgb*(1.0-min(1.0,length(Cd.rgb)))*gamma.z;\n      gl_FragColor = Cd;\n    }"}function directionalBlurPass(e,t,i,s){var a="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return a+="\n        uniform sampler2D tDiffuse;\n        uniform sampler2D pDiffuse;\n        uniform vec2 resUV;\n        varying vec2 vUv;\n  \n        #define PI 3.14159265358979\n        \n        void main() {\n          \n          float dist = 2.0;\n          float fade = 1.0;\n          vec2 baseUV=vUv;\n            \n          const int blurCount=".concat(i,";\n          const int runCount=2;\n          vec2 runDir[runCount];\n          runDir[0]=vec2(").concat(t[0],".0, ").concat(t[1],".0);\n          runDir[1]=vec2(-").concat(t[0],".0, -").concat(t[1],".0);\n          vec2 curUV;\n          vec4 curCd;\n          vec4 blurCd=vec4(.0);\n          for(int b=0; b<blurCount; ++b){\n            dist = 1.0 + float(b)*").concat(s,";\n            fade = (1.0-float(b+1)/float(blurCount+2));\n            //fade = 1.- (1.-fade)*(1.-fade);\n            for(int s=0; s<runCount; ++s){\n              curUV = baseUV+runDir[s]*(resUV*dist);\n              curUV = min( vec2(1.), max( vec2(0.), curUV ));\n              curCd = texture2D(").concat(e,",curUV);\n              curCd.a *= fade*(length(curCd.rgb)*.6);\n              blurCd.r = max( blurCd.r, curCd.r );\n              blurCd.g = max( blurCd.g, curCd.g );\n              blurCd.b = max( blurCd.b, curCd.b );\n              //blurCd.rgb += curCd.rgb;\n              blurCd.a = max( blurCd.a, curCd.a );\n            }\n          }\n          vec4 Cd=blurCd;\n          //Cd.a=.01;\n          gl_FragColor = Cd;\n        }")}function mixBlurShaderPass(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n        uniform sampler2D tDiffuse;\n        uniform sampler2D pDiffuse;\n        uniform vec2 resUV;\n        varying vec2 vUv;\n        \n        #define PI 3.14159265358979\n        \n        void main() {\n\n          float dist = 3.0;\n          float fade = 1.0;\n          vec2 baseUV=vUv;\n          const int blurCount=3;\n          const int runCount=8;\n          vec2 runDir[runCount];\n          runDir[0]=vec2(1.0, 0.0);\n          runDir[1]=vec2(1.0, 1.0);\n          runDir[2]=vec2(0.0, 1.0);\n          runDir[3]=vec2(-1.0, 1.0);\n          runDir[4]=vec2(-1.0, 0.0);\n          runDir[5]=vec2(-1.0, -1.0);\n          runDir[6]=vec2(0.0, -1.0);\n          runDir[7]=vec2(1.0, -1.0);\n          vec2 curUV;\n          vec4 curCd;\n          vec4 scatterCd=vec4(.0);\n          for(int b=0; b<blurCount; ++b){\n            dist = 1.5*(1.0+float(b));\n            fade = .1*(1.0-float(b)/float(blurCount));\n            for(int s=0; s<runCount; ++s){\n              curUV = baseUV+runDir[s]*(resUV*dist);\n              curCd = texture2D(pDiffuse,curUV);\n              curCd.a *= fade;\n              scatterCd.rgb += curCd.rgb;\n              scatterCd.a = max( scatterCd.a, curCd.a );\n            }\n          }\n          vec4 Cd=scatterCd;\n          \n          vec4 blurCd=texture2D(tDiffuse,vUv);\n          blurCd.rgb = normalize( blurCd.rgb );\n          \n          Cd = mix( blurCd, Cd, Cd.a);\n          Cd = texture2D(tDiffuse,vUv);\n          //Cd.a=.01;\n          gl_FragColor = Cd;\n        }"}function motionBlurPostProcess(e,t){var i="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return i+="\n    uniform sampler2D tDiffuse;\n    uniform sampler2D rDiffuse;\n    uniform sampler2D noiseTexture;\n    \n    uniform float exposure;\n    uniform vec2 time;\n    uniform vec3 camRotXYZ;\n    uniform vec2 blurDirCur;\n    uniform vec2 blurDirPrev;\n    varying vec2 vUv;\n\n    vec4 getTexture( sampler2D texelToLinearTexture ) {\n      return mapTexelToLinear( texture2D( texelToLinearTexture , vUv ) );\n    }\n    \n    vec3 directionalBlur(vec3 origCd, sampler2D tex, vec2 uv, vec2 dir, vec2 deltaDir, float dist, float thresh){\n      float perc;\n      float curPerc=1.0;\n      vec2 curUV;\n      float origLength=length(origCd.rgb);\n      vec3 curCd;\n      vec3 retCd=origCd;\n      float delta;\n      float threshTrigger=1.0;\n      float dropoff;\n      float percCurve;\n      float d=dot(dir,deltaDir)*.5+.5;\n      for(int r=0; r<10; ++r){\n        perc=(float(r)/10.0);\n        percCurve=perc*.5;\n        dropoff=(dist*float(r))*perc*d;\n        curUV=uv+normalize(deltaDir*percCurve+dir*(1.0-percCurve))*dropoff;\n        //curUV=uv+dir*dropoff;\n        curCd=texture2D(tex,curUV).rgb;\n        delta=length(curCd.rgb);\n        delta=origLength<delta?1.0-perc*perc:0.0;\n        //delta=1.0-perc*perc;\n        retCd+=curCd.rgb*delta;\n        curPerc+=delta;\n        \n        percCurve*=percCurve;\n        curUV=uv-normalize(-deltaDir*percCurve+dir*(1.0-percCurve))*dropoff*.4;\n        //curUV=uv-dir*dropoff*.4;\n        curCd=texture2D(tex,curUV).rgb;\n        delta=length(curCd.rgb);\n        delta=origLength<delta?1.0-perc*perc:0.0;\n        //delta=1.0-perc*perc;\n        retCd+=curCd.rgb*delta;\n        curPerc+=delta;\n        \n      }\n      return retCd /curPerc;\n    }\n\n    void main() {\n      \n      \n      vec4 bloomCd=getTexture( rDiffuse );\n      float noise=sin(time.x*1.8+vUv.x*length(bloomCd.rgb)*12.523+cos(time.x*.4+vUv.y*length(bloomCd.rgb)*2.352)*1.9)*.4+.8;\n      noise=1.0-min(1.0, max(0.0, noise*sin(time.x*.4+24.512)*3.0+1.0));\n      vec2 noiseUV=vUv*0.1;//+vec2(camRotXYZ.x+time.x*.05,-camRotXYZ.y);\n      vec4 noiseCd=texture2D(noiseTexture,noiseUV);\n      float blurDist=length(blurDirCur);\n      blurDist=min(1.0,blurDist*15.0);\n      //blurDist=(1.0-(1.0-blurDist)*(1.0-blurDist));\n      vec2 blurDir=normalize(blurDirCur);//+(vUv-.5)*2.0);",t||(i+="\n        blurDir=normalize( blurDir + (noiseCd.gb-.5)*(dot(blurDir,noiseCd.gb)*.5+.5) );\n      "),i+="\n      vec2 deltaDir=normalize(blurDirPrev);\n      deltaDir.x+=sin((blurDir.x-deltaDir.x));\n      deltaDir.y+=sin((blurDir.y-deltaDir.y));\n      \n      vec4 bloomAdd=vec4( directionalBlur(bloomCd.rgb, rDiffuse, vUv, blurDir, deltaDir, "+e.y+"*"+(t?"3.0":"5.0")+"*(1.5)*blurDist, .5)*(1.0+exposure*.4), 1.0);\n      vec4 Cd= bloomAdd* ( 0.50+bloomCd)*exposure;//getTexture( rDiffuse ) + bloomAdd;//+ vec4( 1.0 ) * bloomCd + bloomAdd;\n      //Cd.a=bloomAdd.a-bloomCd.a;\n      \n      Cd.a=1.0;\n      gl_FragColor = Cd;\n      \n    }"}function chroAberPostProcess(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D tDiffuse;\n    uniform sampler2D chroAberUVTexture;\n    uniform sampler2D chroAberUVAlpha;\n    uniform vec2 ratio;\n\n    uniform vec2 warpMult;\n    uniform vec2 lKing;\n    \n    varying vec2 vUv;\n\n    void main() {\n      // I don't know, sRGB to Linear. Keeping it Linear doesn't work, PNG encoding to blame\n      vec4 caCd= vec4( \n        texture2D( chroAberUVTexture, vUv ).rgb - 0.7294118,\n        texture2D( chroAberUVAlpha, vUv ).r - 0.5019608\n      );\n      //caCd*=mix( .025, .018, length(caCd.rg)*4.0 );\n      caCd*=mix( lKing.x, lKing.y, length(caCd.rg)*4.0 )+warpMult.x;\n      \n      vec2 bUv=vUv+caCd.rg;\n      vec2 rUv=vUv+caCd.ba;\n      vec2 gUv=vUv+(caCd.rg+caCd.ba);\n      vec4 rCd=texture2D( tDiffuse, rUv );\n      vec4 Cd=texture2D( tDiffuse, gUv );\n      vec4 bCd=texture2D( tDiffuse, bUv );\n      \n      Cd.rgb=vec3( rCd.r, Cd.g, bCd.b );\n      Cd.a=1.0;\n      gl_FragColor = Cd;\n    }"}function lKingPostProcess(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D tDiffuse;\n    uniform sampler2D noiseTexture;\n    uniform vec2 time;\n    uniform vec2 ratio;\n    varying vec2 vUv;\n\n        #define PI 3.14159265358979\n        \n    void main() {\n      vec4 Cd=texture2D( tDiffuse, vUv )*.2;\n      vec4 noiseCd= (texture2D( noiseTexture, vec2( fract(vUv.x*.2-time.x*.02+sin(time.x*.1+vUv.y*PI+Cd.r+Cd.g)),fract( vUv.y*.2+time.x*.01+cos(-time.x*.2+1.15+vUv.x*PI+Cd.g+Cd.b)) ) )-.5)*.025;\n      \n      vec2 bUv=vUv+noiseCd.rg;\n      vec2 rUv=vUv+noiseCd.gb;\n      vec2 gUv=vUv+noiseCd.br;\n      vec4 rCd=texture2D( tDiffuse, rUv );\n      vec4 gCd=texture2D( tDiffuse, gUv );\n      vec4 bCd=texture2D( tDiffuse, bUv );\n      \n      Cd.rgb=vec3( rCd.r, gCd.g, bCd.b );\n      Cd.a=1.0;\n      gl_FragColor = Cd;\n    }"}function iZoomPostProcess(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D tDiffuse;\n    uniform sampler2D tDiffusePrev;\n    uniform sampler2D noiseTexture;\n    uniform vec2 time;\n    uniform vec2 ratio;\n    varying vec2 vUv;\n\n        #define PI 3.14159265358979\n        \n    void main() {\n      vec4 Cd=texture2D( tDiffuse, vUv );\n            vec4 pCd=texture2D( tDiffusePrev, vUv );\n            vec3 dCd=Cd.rgb-pCd.rgb;\n            vec3 b1Cd= texture2D( tDiffuse, vUv-vec2( dCd.rg*.1 ) ).rgb;\n            vec3 b2Cd= texture2D( tDiffusePrev, vUv+vec2( dCd.rg*.1 ) ).rgb;\n            b1Cd=mix( b1Cd, b2Cd, step( length(b1Cd), length(b2Cd) ) );\n            \n            vec4 outCd=vec4(1.0);\n            outCd.rgb= mix(  Cd.rgb, b1Cd, length(dCd) );\n            \n      vec3 noiseCd=texture2D( noiseTexture, fract( vUv*50.0+dCd.rg*.1 + length(Cd.rgb*30.0) + time.x) ).rgb;\n\n            outCd.rgb= mix( vec3(length(outCd.rgb)*.333-length(noiseCd)*.1), outCd.rgb, min(1.0,length(dCd))*.5+.5 );\n            outCd.rgb+= dCd.gbr;\n            \n            \n            \n      outCd.a=1.0;\n      gl_FragColor = outCd;\n    }"}function sFieldPostProcessVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform vec2 time;\n    varying vec2 vUv;\n    varying vec2 vUvShift;\n    varying vec2 starUv;\n    varying float vTimer;\n\n    void main(){\n        vUv=uv;\n        vUvShift=uv-.5;\n        \n        vec2 rUv=vUvShift*0.7071067811865476;\n        vec2 tmpUv=rUv;\n        float rot=time.x*.1;\n        vec2 sinCos=vec2( sin(rot), cos(rot) );\n        rUv.x=sinCos.x*tmpUv.x + sinCos.y*tmpUv.y;\n        rUv.y=sinCos.y*tmpUv.x - sinCos.x*tmpUv.y;\n        rUv=(rUv+.5);\n        \n        float starTimer=sin(time.x*.2)*.1+.1;\n        starUv=mix( vUv, rUv, starTimer);\n        \n        vTimer=time.x*.5;\n        \n        vec4 modelViewPosition=modelViewMatrix * vec4(position, 1.0);\n        gl_Position = projectionMatrix*modelViewPosition;\n    }"}function sFieldPostProcessFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n        uniform sampler2D tDiffuse;\n        uniform sampler2D starTexture;\n        varying vec2 vUv;\n        varying vec2 vUvShift;\n        varying vec2 starUv;\n        varying float vTimer;\n\n        #define PI 3.14159265358979\n        \n        void main() {\n            float uvDist=length(vUvShift);\n            \n            vec3 starCd=texture2D( starTexture, starUv ).rgb*uvDist;\n            \n            float blender=uvDist*starCd.b * abs((fract(starCd.b*PI+vTimer))*2.0-1.0)*.5;\n            vec2 starBlendUV=starCd.rg*blender;\n            \n            vec2 cdUv = vUv+starBlendUV;\n            vec4 Cd=texture2D( tDiffuse, cdUv );\n            \n            vec3 negCd= mix( Cd.brg, Cd.gbr, length(Cd.rgb-Cd.rgb) );\n            float cdBlender=step(.015,starBlendUV.x*uvDist)+starCd.b;\n            Cd.rgb= mix( Cd.rgb, negCd, cdBlender );\n            \n            gl_FragColor = Cd;\n        }"}function warpPostProcess(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D tDiffuse;\n    uniform sampler2D noiseTexture;\n    uniform sampler2D animTexture;\n    uniform vec2 time;\n    uniform vec2 fader;\n    varying vec2 vUv;\n\n    void main() {\n      vec4 Cd=texture2D( tDiffuse, vUv );\n      vec4 animCd=texture2D( animTexture, vUv );\n      float timer=time.x*.2;\n      vec2 animUV=vec2( mod(animCd.r+Cd.r+Cd.g+timer, 1.0), mod(animCd.g+Cd.g+Cd.b+timer, 1.0) );\n      animCd=texture2D( animTexture, animUV );\n      \n      vec2 noiseUV=animUV+animCd.rg;\n      vec4 noiseCd=texture2D(noiseTexture,noiseUV);\n      noiseCd.rgb=vec3( length( noiseCd.rgb )*.5-.25 );\n      \n      float blend=fader.x*fader.y;\n      Cd=mix( Cd, noiseCd, blend);\n      \n      Cd.a=1.0;\n      Cd.r=1.0;\n      gl_FragColor = Cd;\n    }"}function finalOverlayHeavyShader(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n        uniform sampler2D tDiffuse;\n        uniform sampler2D rDiffuse;\n        uniform sampler2D bloomTexture;\n        uniform sampler2D sceneDepth;\n        uniform sampler2D scenePos;\n        uniform sampler2D noiseTexture;\n        uniform vec3 camPos;\n        uniform vec2 time;\n        uniform vec2 fogMult;\n        uniform vec2 proximityMult;\n        uniform float ratio;\n        uniform float exposure;\n        varying vec2 vUv;\n\n        vec3 fogValue( vec3 worldPos, float time ){\n            float wpDist = worldPos.x+worldPos.z*2.0;\n            vec2 noiseUV = vec2( ((time*.5+wpDist*.60)), (worldPos.y*.7+time*.25 ));\n            vec3 noiseCd = texture2D(noiseTexture,noiseUV).rgb;\n            noiseUV=vec2( ((time*.3+wpDist*.55)), (worldPos.x*.5+time*.35 ));\n            noiseCd.g=texture2D(noiseTexture,noiseUV+vec2(0.0,time)).g;\n            noiseUV=vec2( ((time*1.2+wpDist*.83)), (worldPos.y+time*.15  ));\n            noiseCd.b=texture2D(noiseTexture,noiseUV).b;\n            \n            return noiseCd;\n        }\n\n        #define PROX_WARP 3.14159265358979*.45\n        \n        void main() {\n            vec4 Cd=texture2D(rDiffuse,vUv);\n            float depth=texture2D(sceneDepth,vUv).r;\n            \n            vec3 worldPos = texture2D(scenePos,vUv).rgb;\n            float t = -time.x*.003;\n            vec3 baseNoiseCd=fogValue( worldPos, t );\n            \n            float mult=0.0;\n            vec3 noiseCd;\n            vec3 curNoiseCd;\n            vec3 samplePos;\n            float samples=4.3;//+sin(time.x*.001);\n            float blender;\n            float blenderMax=0.0;\n            for( int x=0; x<=3; ++x){\n                blender=( float(x+1) / samples );\n                samplePos=worldPos*blender;\n                curNoiseCd=fogValue( samplePos, t );\n                noiseCd=max(noiseCd, curNoiseCd * blender );\n                blenderMax+=blender;\n            }\n            noiseCd += baseNoiseCd*.2;\n            mult= noiseCd.x*noiseCd.y*noiseCd.z*1.2;\n            //mult*=mult;\n            \n            // Distance Mapping\n            float proxWarp= cos(( vUv.x-.5 ) * PROX_WARP*ratio );\n            float mDepth= pow( depth, 28.*proxWarp );\n            \n            float fogDap= max(0.0, 1.0-mDepth);\n            fogDap=1.0-fogDap*fogDap;\n            mult*=max(0.0, (worldPos.y-0.04)*1.65) * fogMult.x * fogDap ;\n            \n            \n            Cd.rgb= mix( Cd.rgb, vec3(mult*.7), mult)-mult*.35;\n \n            vec3 bloomCd=texture2D(bloomTexture,vUv).rgb;\n            Cd.rgb+= bloomCd;\n            Cd.rgb*=exposure;\n            \n            // Proximity Draw Over\n            float dProx=  ((mDepth-.5)*-10.);\n            dProx= max(0.0, (1.0-dProx)*step( 0., dProx));\n            float yProxMult= 1.0-min(1.0, max(0.0, (worldPos.y-.5 )*1000.));\n            dProx*= dProx* yProxMult * proximityMult.x;\n            vec3 proxCd = (vec3(.5,.5,.2)*dProx)*.5;\n            Cd.rgb+=proxCd*mult;\n            \n            Cd.a=1.0;\n            gl_FragColor = Cd;\n    }"}function finalOverlayShader(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n        uniform sampler2D tDiffuse;\n        uniform sampler2D rDiffuse;\n        uniform sampler2D bloomTexture;\n        uniform sampler2D sceneDepth;\n        uniform sampler2D scenePos;\n        uniform sampler2D noiseTexture;\n        uniform vec2 time;\n        uniform vec2 fogMult;\n        uniform vec2 proximityMult;\n        uniform vec2 lookAtPerc;\n        uniform vec2 resUV;\n        uniform float ratio;\n        uniform float exposure;\n        varying vec2 vUv;\n\n        #define PROX_WARP 3.14159265358979*.45\n\n        void main() {\n            vec4 Cd=texture2D(rDiffuse,vUv);\n            float depth=texture2D(sceneDepth,vUv).r;\n            \n            vec3 worldPos = texture2D(scenePos,vUv).rgb;\n            float wpDist = worldPos.x+worldPos.z*2.0;\n            float t = -time.x*.003;\n            \n            vec2 noiseUV = vec2( ((t*.5+wpDist*.60)), (worldPos.y*.7+t*.25 ));\n            vec3 noiseCd = texture2D(noiseTexture,noiseUV).rgb;\n            noiseUV=vec2( ((t*.3+wpDist*.55)), (worldPos.x*.5+t*.35 ));\n            noiseCd.g=texture2D(noiseTexture,noiseUV+vec2(0.0,t)).g;\n            noiseUV=vec2( ((t*1.2+wpDist*.83)), (worldPos.y+t*.15  ));\n            noiseCd.b=texture2D(noiseTexture,noiseUV).b;\n            \n            \n            // Distance Mapping\n            float proxWarp= cos(( vUv.x-.5 ) * PROX_WARP*ratio );\n            float mDepth= pow( depth, 28.*proxWarp );\n            \n            float fogDap= max(0.0, 1.0-mDepth);\n            fogDap=1.0-fogDap*fogDap;\n            float mult=noiseCd.x*noiseCd.y*noiseCd.z*1.3;\n            mult*=max(0.0, (worldPos.y-0.04)*1.65) * fogMult.x * fogDap;\n            \n            \n            Cd.rgb= mix( Cd.rgb, vec3(mult), mult)-mult*.4;\n \n            vec3 bloomCd=texture2D(bloomTexture,vUv).rgb;\n            Cd.rgb+= bloomCd;\n            Cd.rgb*=exposure;\n            \n            // Proximity Draw Over\n            float dProx=  ((mDepth-.5)*-10.);\n            dProx= max(0.0, (1.0-dProx)*step( 0., dProx));\n            float yProxMult= 1.0-min(1.0, max(0.0, (worldPos.y-.5 )*1000.));\n            dProx*= dProx* yProxMult * proximityMult.x;\n            vec3 proxCd = (vec3(.5,.5,.2)*dProx)*.5;\n            Cd.rgb+=proxCd*mult;\n            \n            Cd.a=1.0;\n            gl_FragColor = Cd;\n        }"}function finalOverlaySlimShader(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n        uniform sampler2D tDiffuse;\n        uniform sampler2D rDiffuse;\n        uniform sampler2D bloomTexture;\n        uniform sampler2D sceneDepth;\n        uniform vec2 time;\n        uniform vec2 proximityMult;\n        uniform vec2 lookAtPerc;\n        uniform vec2 resUV;\n        uniform float ratio;\n        uniform float exposure;\n        varying vec2 vUv;\n\n        #define PROX_WARP 3.14159265358979*.4\n        #define PI 3.14159265358979\n        \n        vec3 boostHighs( vec3 Cd ){\n            float sat=max(max(Cd.r,Cd.g),Cd.b) - min(min(Cd.r,Cd.g),Cd.b);\n            sat=(1.0-sat);\n            sat=1.0-sat*sat;\n            Cd+=Cd*sat;\n            return Cd;\n        }\n        \n        vec3 boostMids( vec3 Cd ){\n            float sat=max(max(Cd.r,Cd.g),Cd.b) - min(min(Cd.r,Cd.g),Cd.b);\n            sat=sin( sat*PI );\n            Cd+=Cd*sat;\n            return Cd;\n        }\n        \n        void main() {\n            vec4 Cd=texture2D(rDiffuse,vUv);\n            vec2 uv=vUv;\n            \n            vec3 bloomCd=texture2D(bloomTexture,uv).rgb;\n            bloomCd= mix( boostHighs(Cd.rgb), bloomCd,  step( 0.01, length( bloomCd )) );\n            \n            Cd.rgb+= bloomCd;\n\n            // Proximity Draw Over\n            float depth=texture2D(sceneDepth,vUv).r;\n            \n            // Distance Mapping\n            float proxWarp= cos(( vUv.x-.5 ) * PROX_WARP*ratio );\n            float mDepth= pow( depth, 28.*proxWarp );\n            \n            // Proximity Draw Over\n            float dProx=  ((mDepth-.5)*-10.);\n            dProx= max(0.0, (1.0-dProx)*step( 0., dProx));\n            dProx*= dProx * proximityMult.x;\n            vec3 proxCd = (vec3(.5,.5,.2)*dProx)*.5;\n            Cd.rgb+=proxCd;\n            Cd.r=1.0;\n            Cd.a=1.0;\n            gl_FragColor = Cd;\n        }"}function bgScreenVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform vec2 time;\n    \n    varying vec2 vUv;\n    varying vec3 vCamNormal;\n    varying vec3 vWorldNormal;\n    varying vec3 vWorldCross;\n    varying vec3 vSunPos;\n    \n    void main(){\n        vUv=uv;\n        \n        mat4 pvMat=projectionMatrix * viewMatrix;\n        pvMat[3] = vec4(.0, .0, .0, 1.0);\n        mat3 pvRot = inverse( mat3( pvMat ) );\n        vCamNormal= pvRot * vec3( position*.2 + vec3(.0, .0, 1.0));\n        vWorldNormal= normalize( pvRot[2] *vec3(1.,0.,1.));\n        vWorldCross= normalize( pvRot[0]*vec3(1.,0.,1.));\n        \n        float timeRate = time.x * .1;\n        vec3 sunPos = normalize( vec3(.3, 1.0, 1.0) );\n        vec3 sunRef = sunPos;\n        sunPos.y= sin(timeRate) * sunRef.y + cos(timeRate)*sunRef.z;\n        sunPos.z= sin(timeRate) * sunRef.z - cos(timeRate)*sunRef.y;\n        sunPos.x = sin( timeRate ) * .1;\n        \n        vSunPos = normalize( sunPos );\n        \n        vec4 modelViewPosition= vec4(position*2.0 + vec3(.0, .0, 1.0), 1.0);\n        gl_Position = modelViewPosition;\n    }"}function bgScreenFrag(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D noiseTexture;\n    varying vec2 vUv;\n    varying vec3 vCamNormal;\n    varying vec3 vWorldNormal;\n    varying vec3 vWorldCross;\n    varying vec3 vSunPos;\n    \n    void main(){\n        vec4 Cd=vec4( vec3(1.0, .10, .10), 1.0);\n        \n        float sunDot = dot( vSunPos, vCamNormal )*.5 +.5;\n        sunDot *= max(0.0, dot( vSunPos, vec3(.0, 1.0, .0)) );\n        \n        vec2 xOffset = vec2( .0, .0);\n        vec3 nCd=texture2D(noiseTexture,vUv*.1+vSunPos.zy*vec2(.15,.22) + xOffset ).rgb;\n        nCd*=texture2D(noiseTexture,vUv*.1+vSunPos.yx*.2).rgb;\n        sunDot *= nCd.x*nCd.y*nCd.z;\n        nCd= vec3( length( nCd ) );\n        \n        float mixVal= min(1.0, sunDot+(1.-(vWorldNormal.y*.5+.5)));\n        Cd.rgb= mix(vec3(0.0, .20, 1.0)+nCd*vWorldNormal.y, vec3(.0, .0, .0), mixVal);\n        Cd.rgb=mix( vec3(.0), Cd.rgb, vWorldNormal.y );\n        Cd.rgb=vec3(mix( vWorldNormal, vWorldCross, step(.4, vUv.x)));\n        Cd.rgb=vec3(mix( vWorldCross, Cd.rgb, step(vUv.y,.9)));\n        gl_FragColor=Cd;\n    }"}function skyObjectVert(){return"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform float camFar;\n    uniform vec2 resUV;\n    \n    varying vec2 vUv;\n    varying vec3 vN;\n    varying vec3 vLocalPos;\n    varying vec4 vWorldPos;\n    \n    void main(){\n        vUv=uv;\n        vLocalPos=position;\n        vN = normal;\n        \n        vec3 pos = position;\n        vec4 modelViewPosition=projectionMatrix * vec4(mat3(viewMatrix)*normalize(pos)*camFar, 1.0);\n        gl_Position = modelViewPosition;\n        \n        vWorldPos = modelViewPosition;\n        \n    }"}function skyObjectFrag(){var e="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        ";return e+="     \n    uniform sampler2D diffuse;\n    uniform sampler2D noiseTexture;\n    uniform vec2 time;\n    uniform float camNear;\n    uniform float camFar;\n    uniform vec2 resUV;\n\n    uniform float rate;\n    uniform vec3 fogColor;\n    \n    varying vec2 vUv;\n    varying vec3 vN;\n    varying vec3 vLocalPos;\n    varying vec4 vWorldPos;\n    \n    #define PI 3.14159265358979323\n    \n    void main(){\n        vec2 uv=vUv;\n        vec2 screenUV=(vec2(vWorldPos.xy/vWorldPos.w))*.5+.5;\n        vec4 Cd=texture2D(diffuse,uv);\n\n  ",(arguments.length>0&&void 0!==arguments[0]?arguments[0]:S.OFF)==S.VAPOR&&(e+="\n\n        // -- -- -- -- -- -- -- -- --\n        // -- Horizon Vapor Code - -- --\n        // -- -- -- -- -- -- -- -- -- -- --\n\n        vec3 lPos = vLocalPos;\n        lPos.y = abs(lPos.y)*0.05;\n\n        float t = time.x*.6;\n\n        // Duel noise texture sampling\n        //   Creates a flowing vapor effect flowing through the noise texture\n        vec2 nUv =  vec2(vUv.x*0.40, vUv.y*.5 - t*.0065  - vN.y );\n        vec3 noiseBaseCd = texture2D( noiseTexture, nUv ).rgb;\n        nUv = ( nUv*vec2(1.0,.5)+noiseBaseCd.rg*(noiseBaseCd.b) + t*.02);\n        vec3 noiseCd = texture2D( noiseTexture, nUv ).rgb;\n        noiseCd.rg = noiseCd.rg*2.0-1.0;\n        \n        \n        float reachDepth = 0.0 ;\n        \n        // Calculate mask based on the local position\n        //   Assuming for a sky-box / sky-sphere object\n        vec3 normPos = normalize(vLocalPos);\n        normPos.y = 1.0-min(1.0,(normPos.y)*3.0);\n        normPos.y = normPos.y*normPos.y*normPos.y;\n        \n        // Noise-influence of the normal vector to drive the vapoe mask\n        reachDepth =  min(1.0, (vN.y * 1. * noiseCd.x  * max(noiseCd.y, noiseCd.z))) ;\n\n        float vaporMask = clamp(reachDepth+normPos.y * max(.95, noiseBaseCd.x*noiseBaseCd.z+vN.y*.5), 0.0, 1.0)*.1;\n        \n        float fogMixer = (Cd.r+Cd.g+Cd.b) - (fogColor.r+fogColor.g+fogColor.b) ;\n        vec3 toFogColor = mix(  Cd.rgb, fogColor,  fogMixer );\n        float blender = (sin(noiseCd.r*PI+t+uv.x))*max(0.0,1.0-(vaporMask+fogMixer))*.1 ;\n        vec3 baseColor = (toFogColor-min(1.0,blender+ vaporMask*10.0)) ;\n\n        Cd.rgb = mix(Cd.rgb, baseColor, vaporMask * step( -0.10, vN.y ));\n\n        // -- -- -- -- -- -- -- -- -- -- --\n        // -- End of Horizon Vapor -- --\n        // -- -- -- -- -- -- -- -- --\n\n    "),e+="\n\n        gl_FragColor=Cd;\n    }"}var O={animated:p,core:u,objects:m,particles:v,rendering:g,scene:f};class ParticleBase{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"particles";this.name=t,this.room=e,this.geometry=null,this.material=null,this.points=null,this.count=-1,this.pscale=new x.Vector2(0,0),this.position=new x.Vector3(0,0,0),this.atlasPath="sprite_dustAtlas_rgb.jpg",this.atlasAlphaPath="sprite_dustAtlas_alpha.jpg",this.hasAlphaMap=!0,this.shaderSettings={vertCount:1e3,pScale:7,pOpacity:1,proxDist:200,atlasRes:4,atlasPicks:[],randomAtlas:!0,additiveBlend:!1,hasLights:!1,fadeOutScalar:1.59},this.knownKeys=Object.keys(this.shaderSettings)}build(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e&&typeof e===Object){var t=Object.keys(e);this.knownKeys.forEach((i=>{t.includes(i)?this.shaderSettings[i]=e[i]:e[i]=this.shaderSettings[i]}))}(!this.shaderSettings.atlasPicks||this.shaderSettings.atlasPicks.length<1)&&(this.shaderSettings.atlasPicks=this.elementDuplicator([[0,.75],[0,.5],[.25,.75],[.25,.5]],4)),this.addToScene(vertexCount,pScale,atlasRes,atlasPicks)}setPosition(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];1===t.length?this.position=t[0]:this.position=new x.Vector3(...t),this.points&&this.points.position.copy(this.position)}getSettings(){return this.shaderSettings}addToScene(){if(this.shaderSettings){var e=this.shaderSettings.vertCount,t=this.shaderSettings.pScale,i=this.material,s=this.shaderSettings.atlasRes,a=this.shaderSettings.atlasPicks,r=this.shaderSettings.randomAtlas;this.count=e,this.pscale.x=t*this.room.pxlEnv.pxlQuality.screenResPerc;var n=null;r?(n=this.atlasRandomGen,a=s):n=this.atlasArrayPicker,i||(i=this.newMaterial());for(var o=[],l=[],h=[],d=0;d<e;++d)o.push(0,0,0),l.push(Math.random(),2*Math.random()-1,Math.random(),2*Math.random()-1),h.push(...n(a));var c=new x.Float32BufferAttribute(o,3),u=new x.Float32BufferAttribute(l,4),p=new x.Float32BufferAttribute(h,2),m=new x.BufferGeometry;m.setAttribute("position",c),m.setAttribute("seeds",u),m.setAttribute("atlas",p);var v=new x.Points(m,i);return v.sortParticles=!1,v.frustumCulled=!1,this.room.scene.add(v),v.layers.set(1),v.renderOrder=P.PARTICLES,v.pBaseScale=t,this.room.geoList[this.name]=v,this.geometry=m,this.material=i,this.points=v,v.position.copy(this.position),v}console.error("No Shader Settings Found; Somehow deleted?")}setUserHeight(e){this.pxlEnv.pxlCamera.userScale=e}atlasRandomGen(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=1/e;return Array.from({length:t}).map((()=>Math.floor(648405.71*Math.random()%e)*i))}atlasRandomList(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return Array.from({length:e}).map((e=>this.atlasRandomGen(t,i)))}atlasArrayPicker(e){return e[Math.floor(92314.75*Math.random()%e.length)]}dupeArray(e,t){return Array.from({length:t}).fill(e)}elementDuplicator(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;return e.map((e=>this.dupeArray(e,t))).flat(1)}findLightPositions(){var e=[];return this.room.lightList.hasOwnProperty("PointLight")&&(this.room.lightList.PointLight.length,this.room.lightList.PointLight.forEach((t=>{e.push(t.position.clone())}))),e}hasPointLights(){return this.room.lightList.hasOwnProperty("PointLight")}setAtlasPath(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.atlasPath=e,t?(this.atlasAlphaPath=t,this.hasAlphaMap=!0):this.hasAlphaMap=!1}newMaterial(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.hasPointLights(),i={atlasTexture:{type:"t",value:null},noiseTexture:{type:"t",value:null},time:{type:"f",value:this.room.msRunner},pointScale:{type:"f",value:this.pscale},intensity:{type:"f",value:1},rate:{type:"f",value:.035},lightPos:{value:t}};this.hasAlphaMap&&(i.atlasAlphaTexture={type:"t",value:null});var s=this.room.pxlFile.pxlShaderBuilder(i,dustVert(this.shaderSettings),dustFrag(this.hasAlphaMap));return s.transparent=!0,this.hasAlphaMap?(s.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasPath,4,{magFilter:x.NearestFilter,minFilter:x.NearestMipmapNearestFilter}),this.atlasAlphaPath&&(s.uniforms.atlasAlphaTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,1,{magFilter:x.NearestFilter,minFilter:x.NearestMipmapNearestFilter}))):s.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,4,{magFilter:x.NearestFilter,minFilter:x.NearestMipmapNearestFilter}),s.uniforms.noiseTexture.value=this.room.softNoiseTexture,s.depthTest=!0,s.depthWrite=!1,e&&(this.room.materialList[this.name]=s),s}}var I={pxlParticles:{BillowSmoke:class BillowSmoke extends ParticleBase{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"billowSmoke";super(e,t),this.name=t,this.room=e,this.shaderSettings={vertCount:600,pScale:56,pOpacity:1,proxDist:200,atlasRes:4,atlasPicks:[],randomAtlas:!0,additiveBlend:!1,windDir:new x.Vector3(0,0,1),offsetPos:new x.Vector3(0,0,0)},this.knownKeys=Object.keys(this.shaderSettings)}build(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e&&typeof e===Object){var t=Object.keys(e);this.knownKeys.forEach((i=>{t.includes(i)?this.shaderSettings[i]=e[i]:e[i]=this.shaderSettings[i]}))}this.shaderSettings.atlasPicks&&0!=this.shaderSettings.atlasPicks.length||(this.shaderSettings.atlasPicks=[...super.dupeArray([.5,0],2),...super.dupeArray([.5,.25],2),...super.dupeArray([.5,.5],2),...super.dupeArray([.5,.75],2),...super.dupeArray([.75,.75],4),...super.dupeArray([.75,.25],3),...super.dupeArray([.75,.25],3)]);var i={atlasTexture:{type:"t",value:null},noiseTexture:{type:"t",value:null},time:{type:"f",value:this.room.msRunner},windDir:{type:"f",value:e.windDir},offsetPos:{type:"f",value:e.offsetPos},pointScale:{type:"f",value:this.pscale},intensity:{type:"f",value:.8},rate:{type:"f",value:2.85}};this.hasAlphaMap&&(i.atlasAlphaTexture={type:"t",value:null});var s=this.room.pxlFile.pxlShaderBuilder(i,"\n// Billowy goodness!\n  const float BaseSpread = 200.0;\n  const float SmokeBrightness = 0.65;\n  const float InnerBulster = -0.05;\n  const float SmokeDensity = 0.12;\n  const float WindInfluenceBoost = .45;\n\n  const float TightenBaseSpread = 1.0;\n  const float TightenMidSpread = 0.08;\n  const float TightenTipSpread = 0.20;\n\n  // -- -- --\n  \n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n         \n\n  // -- -- --\n         \n    uniform sampler2D noiseTexture;\n    uniform vec2 time;\n    uniform float rate;\n    uniform vec3 windDir;\n    uniform vec3 offsetPos;\n    uniform vec2 pointScale;\n    uniform vec3 sliders;\n    \n    attribute vec4 seeds;\n    attribute vec2 atlas;\n    \n    varying vec2 vAtlas;\n    varying vec2 vRot;\n    varying float vAlpha;\n    varying float vBrightness;\n    \n    \n    #define PROX 6.0\n    \n    \n    float colDetect( vec2 pos, vec2 pt, vec2 n1, vec2 n2 ){\n      vec2 ref=pos-pt;\n      float ret = step( dot( ref, n1 ), 0.0 );\n      ret *= step( dot( ref, n2 ), 0.0 );\n      \n      return ret;\n    }\n     \n        \n    void main(){\n      vAtlas=atlas;\n      \n      float rot=seeds.z+time.x*(seeds.z*2.);\n      vRot=vec2( sin(rot), cos(rot) );\n      \n      vec3 pOff=vec3(seeds.z, seeds.y, seeds.w) ;\n      \n      vec2 sinUV=abs(sin(pOff.xz*.5+seeds.zw+time.x*.1)*.5+.5);\n      vec3 noiseCd=texture2D(noiseTexture, sinUV ).rgb*4.5 + 0.50;\n      \n      float t=time.x*rate;\n      float shiftY= mod( t+t*seeds.x+seeds.z*24.0+noiseCd.r+noiseCd.b+(seeds.x+seeds.y)*2.0, 14.0);\n      float life = max(0.0,(shiftY-seeds.x)*0.07142857142857142)*.9+.2;\n      float alphaMult = (1.0-(1.0-life)*(1.0-life))*SmokeDensity;\n      \n      pOff.y=shiftY*seeds.y*life - (1.0-life);\n      \n      pOff.y=(pOff.y)+shiftY; \n      vec3 pos= pOff ;\n      \n      \n      // Magic numbers!  Boo!!\n      float tightenTip = max(0.0,life-.73);\n      tightenTip = 1.0 - (1.0-tightenTip) * (1.0-tightenTip);\n      //tightenTip *= tightenTip;\n      float tightenBase = max(0.0, (1.0-life)*InnerBulster);\n      float tightenMid = max(0.0, TightenBaseSpread - tightenTip - tightenBase - seeds.x*.2);\n      \n      float curBaseSpread = BaseSpread * tightenBase +\n                            BaseSpread * tightenMid * TightenMidSpread +\n                            BaseSpread * tightenTip * TightenTipSpread ;\n      \n      //pos.xz=clamp((noiseCd.rg*noiseCd.b)*seeds.w, vec2(0.0), vec2(1.0))*curBaseSpread*(life*(seeds.zy*.6));\n      pos.xz=(noiseCd.rg*noiseCd.b)*seeds.w*curBaseSpread*life;\n      \n      // Wind -- Forces\n      //   Magic numbers, yarb!\n      float windInf = life * life * (life*.5+.5);\n      vec2 curWindDir = windInf * windDir.xz ;\n      \n      float yPush = ( life * (life*.5+.5))* min(1.0,pos.y*.12) * .08;\n      pos.xz += curWindDir*life + curWindDir * WindInfluenceBoost + offsetPos.xz ;\n      \n      \n      // Alpha with cam distance inf\n      float pScalar = 1.0-min( 1.0, (length(pos-cameraPosition )*0.004) );\n      pScalar=1.0-(pScalar*pScalar);\n      float aMult = min(1.0, pScalar*2.0);\n      vAlpha = (seeds.x*.5+.7) * aMult;\n\n      \n      // Alpha from gettin' old\n      vAlpha=(1.0-life)*min(1.0,alphaMult);\n      vec3 doubleCd=texture2D(noiseTexture, sinUV+pos.xz*.5+vec2(seeds.y,pos.y)).rgb ;\n      pos.xz=(pos.xz*(0.9+seeds.xy*.2)+doubleCd.rb*10.0)*min(1.0,life+seeds.y);\n      \n      \n      // Draw size, particle scale\n      pScalar = 1.0-(1.0-pScalar)*.75*(1.0-pScalar);\n      float pScale = pointScale.x * seeds.w * 0.6 * pScalar + (175.0+125.0*life*pScalar)*(1.0-pScalar);\n      pScale += 150.0*(clamp(-(pScalar-.45)*10.0,0.0,1.0));\n\n      gl_PointSize = pScale;\n      \n      // Brightness multiplier\n      vBrightness = 1.0-tightenMid*.1 - tightenTip + tightenBase;\n      float originDelta = length(pos)*(-InnerBulster);\n      vBrightness *= max(0.0, 1.0-originDelta * life * 0.807) * SmokeBrightness;\n      \n      \n      // Add Particle System position\n      pos += modelMatrix[3].xyz + vec3( -1.1, 0.0, 0.67);\n      \n      vec4 mvPos=viewMatrix * vec4(pos, 1.0);\n      gl_Position = projectionMatrix*mvPos;\n    }",smokeFrag(this.hasAlphaMap));s.transparent=!0,this.shaderSettings.additiveBlend&&(s.blending=x.AdditiveBlending),this.hasAlphaMap?(s.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasPath,4,{magFilter:x.NearestFilter,minFilter:x.NearestMipmapNearestFilter}),this.atlasAlphaPath&&(s.uniforms.atlasAlphaTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,1,{magFilter:x.NearestFilter,minFilter:x.NearestMipmapNearestFilter}))):s.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,4,{magFilter:x.NearestFilter,minFilter:x.NearestMipmapNearestFilter}),s.uniforms.noiseTexture.value=this.room.softNoiseTexture,s.depthTest=!0,s.depthWrite=!1,this.room.materialList[this.name]=s,this.material=s,super.addToScene()}},EmberWisps:class EmberWisps extends ParticleBase{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"emberWisps";super(e,t),this.name=t,this.room=e,this.shaderSettings={vertCount:600,pScale:7,pOpacity:1,proxDist:200,atlasRes:4,atlasPicks:[],randomAtlas:!0,additiveBlend:!1,windDir:new x.Vector3(0,0,1),offsetPos:new x.Vector3(0,0,0)},this.knownKeys=Object.keys(this.shaderSettings)}build(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e&&typeof e===Object){var t=Object.keys(e);this.knownKeys.forEach((i=>{t.includes(i)?this.shaderSettings[i]=e[i]:e[i]=this.shaderSettings[i]}))}this.shaderSettings.atlasPicks&&0!=this.shaderSettings.atlasPicks.length||(this.shaderSettings.atlasPicks=super.elementDuplicator([[0,.75],[0,.5],[.25,.75],[.25,.5]],4));var i={atlasTexture:{type:"t",value:null},noiseTexture:{type:"t",value:null},time:{type:"f",value:this.room.msRunner},windDir:{type:"v",value:this.shaderSettings.windDir},offsetPos:{type:"v",value:this.shaderSettings.offsetPos},pointScale:{type:"f",value:this.shaderSettings.pScale},intensity:{type:"f",value:1},rate:{type:"f",value:5.5}};this.hasAlphaMap&&(i.atlasAlphaTexture={type:"t",value:null});var s=this.room.pxlFile.pxlShaderBuilder(i,"\n// Ember Settings\n  const vec3 EmberEarlyCd = vec3( 0.8, 0.5, .1 );\n  const vec3 EmberOldCd = vec3( 0.634, 0.20, 0.20 );\n  const float BaseSpeed = 0.77;\n  const float SpeadInf = 0.7;\n  const float EmberSpread = 5.0;\n  const float EmberFadeDistance = 0.04;\n\n// -- -- --\n  \n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n// -- -- --\n\nuniform sampler2D noiseTexture;\nuniform vec2 time;\nuniform vec3 windDir;\nuniform vec3 offsetPos;\nuniform float rate;\nuniform float pointScale;\nuniform vec3 sliders;  \n\nattribute vec4 seeds;\nattribute vec2 atlas;\n\nvarying vec3 vCd;\nvarying vec2 vAtlas;\nvarying vec2 vRot;\nvarying float vAlpha;\nvarying float vBrightness;\n\n\n\nfloat colDetect( vec2 pos, vec2 pt, vec2 n1, vec2 n2 ){\n    vec2 ref=pos-pt;\n    float ret = step( dot( ref, n1 ), 0.0 );\n    ret *= step( dot( ref, n2 ), 0.0 );\n    \n    return ret;\n}\n\n\nvoid main(){\n    vAtlas=atlas;\n    \n    float rot=seeds.z+time.x*seeds.z*3.;\n    vRot=vec2( sin(rot), cos(rot) );\n    \n    vec3 pOff=vec3(seeds.z, seeds.y, seeds.w) ;\n    \n    vec2 sinUV=abs(sin(pOff.xz*.5+seeds.zw+time.x*.1)*.5+.5);\n    vec3 noiseCd=texture2D(noiseTexture, sinUV ).rgb*4.5 + 0.50;\n    \n    float rateShift = (BaseSpeed*(seeds.x*.4+.6));\n    float t=time.x*rate*rateShift;\n    \n    // Random shift to a cycle y movement\n    float shiftY= mod( t+t*seeds.x+seeds.z*8.0+noiseCd.r*10.20*(seeds.y*2.0-1.0)+noiseCd.b+(-seeds.x+seeds.y)*4.0, 10.0);\n    \n    // Change up ages of embers\n    float lifeFade = shiftY*.1;\n    float fadeDrop = min(1.0, lifeFade*lifeFade*4. ); \n    //\n    float life = 1.0-max(0.0,abs(shiftY-seeds.x*.1)*(1.0-(seeds.x*1.0)) );\n    life = 1.0-((shiftY*.001-seeds.x*.2) );\n    \n    pOff.y=shiftY*seeds.y;\n    \n    pOff.y=(pOff.y)+shiftY; \n    vec3 pos= pOff ;\n    \n\n    float spreadPerc = SpeadInf  * min(1.0, life*1.);\n    pos.xz=(noiseCd.rg*noiseCd.r)*(seeds.x)*(life*seeds.zy*(seeds.w*4.0+1.)) * spreadPerc;\n    pos.xz = mix( pos.xz, normalize( pos.xz ), step(1.0, length(pos.xz)) ) * EmberSpread;\n    \n    \n    // Directional push\n    float yPush = ( life * (life*.5+.5))  * min(1.0,pos.y*.12) * 2.8;\n    pos.xz += windDir.xz * yPush * pos.y*(.5+life*.5);\n    pos.y += yPush;\n    \n    float pToCamLen = length(pos-cameraPosition);\n    float pScalar = max( 0., (1.-pToCamLen *  0.0806 )); // 0.0385\n    pScalar += max(0.0,pToCamLen - 0.4) * 0.005;\n    \n    vAlpha = min(1.0, (seeds.x*.15+.7) * pScalar*3.0 );\n\n    \n    vAlpha=max(0.0, life*life-seeds.z-seeds.z);\n    float distMult = ( length( pos )*EmberFadeDistance );\n    distMult = 1.0 - ( distMult * distMult );\n    vAlpha *= distMult;\n    \n    \n    float pScale = pointScale * seeds.w * pScalar + 2.0;\n    \n    gl_PointSize =  pScale*fadeDrop ;\n    \n    \n    float tightenBase = min( 1.0, pos.y*.2 );\n    pos.xz *= tightenBase*tightenBase;\n    \n    pos += modelMatrix[3].xyz + vec3( -1.76, -0.2269, -0.25);\n    vec4 mvPos=viewMatrix * vec4(pos, 1.0);\n    gl_Position = projectionMatrix*mvPos;\n    \n    float cdAge = clamp( 1.0 - life, 0.0, 1.0);\n    \n    vCd = mix( EmberEarlyCd, EmberOldCd, cdAge )  ;\n    \n    vBrightness = 1.045 + fadeDrop*2.;\n}",(this.hasAlphaMap,"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n    #else\n      precision mediump float;\n    #endif\n        \n    uniform sampler2D atlasTexture;\n    uniform vec2 time;\n    uniform float rate;\n    \n    varying vec3 vCd;\n    varying vec2 vAtlas;\n    varying vec2 vRot;\n    varying float vAlpha;\n    varying float vBrightness;\n    \n    \n    \n    // -- -- --\n    \n    // Human Eye Adjusted Luminance\n    //   https://en.wikipedia.org/wiki/Grayscale\n    float luma(vec3 color) {\n      return dot( color, vec3(0.2126, 0.7152, 0.0722) );\n    }\n      \n    // -- -- --\n    \n    \n    void main(){\n        vec2 uv=gl_PointCoord;\n\n        vec2 pos = (uv-.5)*.85;\n\n        vec2 rotUV;\n        rotUV.x = vRot.y * pos.x - vRot.x * pos.y;\n        rotUV.y = vRot.x * pos.x + vRot.y * pos.y;\n        rotUV=(rotUV+.5)*.25+vAtlas;\n        \n        \n        vec4 dustCd=texture2D(atlasTexture,rotUV);\n        float alpha= clamp( dustCd.a*vAlpha, 0.0, 1.0) ;\n        \n        dustCd.rgb *= vBrightness;\n        \n        float dirtLuma = luma( dustCd.rgb );\n        vec4 Cd=vec4( dirtLuma * vCd * vBrightness, alpha );\n        \n        gl_FragColor=Cd;\n    }"));s.side=x.DoubleSide,s.transparent=!0,this.shaderSettings.additiveBlend&&(s.blending=x.AdditiveBlending),this.hasAlphaMap?(s.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasPath,4,{magFilter:x.NearestFilter,minFilter:x.NearestMipmapNearestFilter}),this.atlasAlphaPath&&(s.uniforms.atlasAlphaTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,1,{magFilter:x.NearestFilter,minFilter:x.NearestMipmapNearestFilter}))):s.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,4,{magFilter:x.NearestFilter,minFilter:x.NearestMipmapNearestFilter}),s.uniforms.noiseTexture.value=this.room.softNoiseTexture,s.depthTest=!0,s.depthWrite=!1,this.room.materialList[this.name]=s,this.material=s,super.addToScene()}},FloatingDust:class FloatingDust extends ParticleBase{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"floatingDust";super(e,t),this.name=t,this.room=e,this.material=null,this.shaderSettings={vertCount:1e3,pScale:7,pOpacity:1,proxDist:200,atlasRes:4,atlasPicks:[],randomAtlas:!0,additiveBlend:!1,windDir:new x.Vector3(0,0,1),offsetPos:new x.Vector3(0,0,0),hasLights:!1,fadeOutScalar:1.59,wanderInf:1,wanderRate:1,wanderFrequency:2.85},this.knownKeys=Object.keys(this.shaderSettings)}build(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e&&typeof e===Object){var t=Object.keys(e);this.knownKeys.forEach((i=>{t.includes(i)?this.shaderSettings[i]=e[i]:e[i]=this.shaderSettings[i]}))}(!this.shaderSettings.atlasPicks||this.shaderSettings.atlasPicks.length<1)&&(this.shaderSettings.atlasPicks=[...super.dupeArray([0,0],4),...super.dupeArray([.25,0],4),...super.dupeArray([.5,0],2),...super.dupeArray([.5,.25],2),...super.dupeArray([.5,.5],2),...super.dupeArray([.5,.75],2),...super.dupeArray([.75,.75],4),...super.dupeArray([.75,.25],3),...super.dupeArray([.75,.25],3)]),this.shaderSettings.hasLights=super.hasPointLights();var i=e.windDir;i&&typeof i===Object&&typeof i!==x.Vector3&&3===i.length&&this.shaderSettings.windDir.set(i[0],i[1],i[2]);var s=e.offsetPos;s&&typeof s===Object&&typeof s!==x.Vector3&&3===s.length&&this.shaderSettings.offsetPos.set(s[0],s[1],s[2]);var a={atlasTexture:{type:"t",value:null},atlasAlphaTexture:{type:"t",value:null},noiseTexture:{type:"t",value:null},time:{type:"f",value:this.room.msRunner},pointScale:{type:"f",value:this.pscale},intensity:{type:"f",value:1},rate:{type:"f",value:.035},positionOffset:{type:"v",value:this.shaderSettings.offsetPos},windDir:{type:"v",value:this.shaderSettings.windDir}},r=this.room.pxlFile.pxlShaderBuilder(a,dustVert(this.shaderSettings),dustFrag(this.hasAlphaMap));r.transparent=!0,this.hasAlphaMap?(r.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasPath,4,{magFilter:x.NearestFilter,minFilter:x.NearestMipmapNearestFilter}),this.atlasAlphaPath&&(r.uniforms.atlasAlphaTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,1,{magFilter:x.NearestFilter,minFilter:x.NearestMipmapNearestFilter}))):r.uniforms.atlasTexture.value=this.room.pxlUtils.loadTexture(this.atlasAlphaPath,4,{magFilter:x.NearestFilter,minFilter:x.NearestMipmapNearestFilter}),this.shaderSettings.additiveBlend&&(r.blending=x.AdditiveBlending),r.uniforms.noiseTexture.value=this.room.softNoiseTexture,r.depthTest=!0,r.depthWrite=!1,this.room.materialList[this.name]=r,this.material=r,super.addToScene()}}}};class RoomEnvironment{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"pxlRoomEnvironment",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.roomName=e,this.pxlFile=null,this.pxlUtils=null,this.pxlTimer=null,this.pxlAnim=null,this.pxlColliders=null,this.pxlDevice=null,this.pxlEnv=null,this.booted=!1,this.initScene=!0,this.active=!0,this.assetPath=t+"Assets/",this.mobile=!1,this.sceneFile=null,this.animFile=null,this.animClips={},this.animMixer=null,this.spiralizerUniforms={},this.materialList={},this.camInitPos=null,this.camInitLookAt=null,this.camThumbPos=new x.Vector3(0,0,-30),this.camThumbLookAt=new x.Vector3(0,35,-1e3),this.cameraBooted=!1,this.cameraPrevPos=new x.Vector3(0,0,0),this.cameraAimTarget=new x.Object3D(0,0,0),this.camHoldWarpPos=!0,this.camLocation={},this.pxlCamFOV={PC:60,MOBILE:80},this.pxlCamZoom=1,this.pxlCamAspect=1,this.pxlCamNearClipping=5,this.pxlCamFarClipping=1e4,this.fogColor=new x.Color(.01,.02,.05),this.fogExp=7e-4,this.fog=new x.FogExp2(this.fogColor,this.fogExp),this.userAvatarGroup=new x.Group,this.packedTextureMaterial=null,this.coreTextureMaterial=null,this.projectedMaterial=null,this.voidMaterial=null,this.holoMaterial=null,this.aspectRatio=null,this.flag=null,this.initPos=[],this.finalPos=[],this.midPos=new x.Vector3(0,30,-50),this.perspectiveInstances=160,this.startTime=0,this.runTime=new x.Vector2(0,0),this.msRunner=i,this.camera=s,this.autoCamPaths={},this.scene=a,this.lightList={},this.geoList={},this.glassGroup=null,this.glassList=[],this.particleList={},this.lodList=[],this.enableRaycast=!1,this.hasHoverables=!1,this.hoverableList=[],this.hoverableObj=null,this.hasClickables=!1,this.clickableList=[],this.clickableObj=null,this.collidersExist=!1,this.colliderActive=!1,this.colliderHashMap={},this.colliderList=[],this.antiColliderActive=!1,this.antiColliderList=[],this.antiColliderTopActive=!1,this.antiColliderTopList=[],this.hasPortalExit=!1,this.portalList={},this.hasRoomWarp=!1,this.roomWarp=[],this.warpPortalTexture=null,this.warpZoneRenderTarget=null,this.worldPosMaterial=null,this.worldPosRenderTarget=null,this.spiralizerPass=null,this.bloomPreState=!1,this.cloud3dTexture=null,this.smoothNoiseTexture=null,this.hasHelpers=!1,this.helperObjects={},this.currentShader=null}setDependencies(pxlNav){this.pxlEnv=pxlNav,this.pxlFile=pxlNav.pxlFile,this.pxlAnim=pxlNav.pxlAnim,this.pxlTimer=pxlNav.pxlTimer,this.pxlUtils=pxlNav.pxlUtils,this.pxlDevice=pxlNav.pxlDevice,this.pxlColliders=pxlNav.pxlColliders,this.mobile=pxlNav.mobile,this.cloud3dTexture=this.pxlEnv.cloud3dTexture,this.cloud3dTexture.wrapS=x.RepeatWrapping,this.cloud3dTexture.wrapT=x.RepeatWrapping,this.smoothNoiseTexture=this.pxlEnv.softNoiseTexture,this.smoothNoiseTexture.wrapS=x.RepeatWrapping,this.smoothNoiseTexture.wrapT=x.RepeatWrapping}get deltaTime(){return this.pxlTimer.deltaTime}get avgDeltaTime(){return this.pxlTimer.avgDeltaTime}getLerpRate(e){return this.pxlTimer.getLerpRate(e)}getLerpAvgRate(e){return this.pxlTimer.getLerpAvgRate(e)}init(){this.scene.fog=this.fog,this.scene.background=this.fogColor}start(){this.booted,this.pxlEnv.engine.setClearColor(this.fogColor,0)}step(){this.runTime.x=this.msRunner.x}stop(){}resize(e,t){}setUserHeight(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.pxlEnv.pxlCamera.setUserHeight(e,this.roomName)}resetCamera(){this.pxlEnv.pxlCamera.setTransform(this.camInitPos,this.camInitLookAt)}prepPortalRender(){this.geoList.intro.visible=!1,this.geoList.MainRoomWarp.visible=!1}cleanupPortalRender(){this.geoList.intro.visible=!0,this.geoList.MainRoomWarp.visible=!0}setPortalTexture(e){this.geoList.MainRoomWarp.material.map=e}applyRoomPass(){}getName(){return this.roomName}getArtistInfo(){return null}setFog(e){}getShaderList(){var e={};return Object.keys(this.materialList).forEach((t=>{e[t]=t})),e}getCurrentShader(){return this.currentShader||Object.keys(this.materialList)[0]}readShader(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null!=this.currentShader&&this.materialList[this.currentShader].hasOwnProperty("uniforms")&&(t||(t=new x.Vector3),this.materialList[this.currentShader].uniforms.sliders.value=t,this.materialList[this.currentShader].needsUpdate=!0),this.currentShader=e,this.materialList[this.currentShader]}setShader(e,t,i){this.emitterList&&this.emitterList[this.currentShader]&&this.emitterList[this.currentShader].Particles.length>0&&this.emitterList[this.currentShader].Particles.forEach((e=>{var s=e.material;s.vertexShader=t,s.fragmentShader=i,s.needsUpdate=!0})),this.materialList[this.currentShader].vertexShader=t,this.materialList[this.currentShader].fragmentShader=i,this.materialList[this.currentShader].needsUpdate=!0}castRay(e,t){if(this.enableRaycast)if(!e&&!this.hasHoverables||e&&!this.hasClickables)this.mouseRayHits=[];else{var i=[];!e&&this.hasHoverables?i=this.hoverableList:e&&this.hasClickables&&(i=this.clickableList);var s=[];if(i.length>0){var a=new x.Vector2(this.pxlDevice.mouseX/this.pxlDevice.sW*2-1,-this.pxlDevice.mouseY/this.pxlDevice.sH*2+1);this.pxlEnv.pxlCamera.objRaycast.setFromCamera(a,this.pxlEnv.pxlCamera.camera),s=this.pxlEnv.pxlCamera.objRaycast.intersectObjects(i)}this.mouseRayHits=s}}hitColliders(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).length}hasColliders(){return this.collidersExist}hasColliderType(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w.FLOOR,t=!1;if(!this.hasColliders())return t;switch(e){case w.FLOOR:t=this.colliderActive;break;case w.WALL:t=this.antiColliderActive;break;case w.WALL_TOP:t=this.antiColliderTopActive;break;case w.CEILING:break;case w.PORTAL_WARP:t=this.hasPortalExit;break;case w.ROOM_WARP:t=this.hasRoomWarp;break;case w.ITEM:case w.SCRIPTED:break;case w.HOVERABLE:t=this.hasHoverables;break;case w.CLICKABLE:t=this.hasClickables}return t}getColliders(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w.FLOOR,t=[];if(!this.hasColliders())return t;if(e==w.WALL&&!this.antiColliderActive)return t=this.antiColliderList;if(e==w.WALL_TOP&&!this.antiColliderTopActive)return t=this.antiColliderTopList;if(e==w.PORTAL_WARP&&!this.hasPortalExit)return t=this.portalList;if(e==w.ROOM_WARP&&!this.hasRoomWarp)return t=this.roomWarp;if(e==w.HOVERABLE&&!this.hasHoverables)return t=this.hoverableList;if(e==w.CLICKABLE&&!this.hasClickables)return t=this.clickableList;switch(e){case w.FLOOR:case w.WALL:t=[...this.colliderList];break;case w.WALL_TOP:t=[...this.antiColliderTopList];break;case w.CEILING:break;case w.PORTAL_WARP:t=this.portalList;break;case w.ROOM_WARP:t=this.roomWarp}return t}addColliderHelper(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w.FLOOR;this.hasColliders()&&(this.helperObjects.hasOwnProperty("colliders")?this.helperObjects.colliders.hasOwnProperty(e)||(this.helperObjects.colliders[e]=null):(this.helperObjects.colliders={},this.helperObjects.colliders[e]=null),this.helperObjects.colliders[e]=this.pxlColliders.buildHelper(this,e),this.helperObjects.colliders[e]&&(this.scene.add(this.helperObjects.colliders[e]),this.hasHelpers=!0))}stepColliderHelper(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w.FLOOR;this.hasHelpers&&this.hasColliders()&&this.helperObjects.hasOwnProperty("colliders")&&this.helperObjects.colliders.hasOwnProperty(e)&&this.helperObjects.colliders[e].stepHelper(this,e)}toCameraPos(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";if(e=e.toLowerCase(),this.cameraBooted&&this.camLocation.hasOwnProperty(e)){var t=this.mobile?"positionmobile":"position",i=this.mobile?"lookatmobile":"lookat",s=this.camLocation[e][t],a=this.camLocation[e][i];a||(a=new x.Vector3(0,0,1)).addVectors(s,a),this.pxlEnv.pxlCamera.setTransform(this.camLocation[e][t],this.camLocation[e][i]),this.setUserHeight(this.camInitPos.y)}}fbxPostLoad(){this.booted=!0,this.toCameraPos("Default");var e=0;this.lightList.hasOwnProperty("PointLight")&&(e=this.lightList.PointLight.length);var t=Object.keys(this.lightList);if(t.length>0&&t.forEach((e=>{this.lightList[e].forEach((t=>{"DirectionalLight"==e?t.castShadow=!1:"PointLight"==e&&t.castShadow&&(t.shadow.radius=5,t.shadow.receiveShadow=!0,t.shadow.mapSize.width=512,t.shadow.mapSize.height=512,t.shadow.camera.near=.5,t.shadow.camera.far=35,t.shadow.bias=.025,t.shadow.radius=5)}))})),this.shaderGeoList)for(var i in this.shaderGeoList){var s=this.shaderGeoList[i];if(s.userData&&"pxlPrincipled"==s.userData.Shader){var a=x.UniformsUtils.merge([x.UniformsLib.common,x.UniformsLib.lights,x.UniformsLib.shadowmap,{dTexture:{type:"t",value:null},noiseTexture:{type:"t",value:null},detailTexture:{type:"t",value:null},cdMult:{type:"f",value:1},fogColor:{type:"c",value:this.scene.fog.color}}]),r={USE_MAP:""},n={},o=1==s.userData.castShadow||1==s.userData.receiveShadow,l=!1;s.material.map||(l=s.material.color.clone()),s.userData.ShaderParms&&""!=s.userData.ShaderParms&&(n=JSON.parse(s.userData.ShaderParms));var h=this.pxlFile.pxlShaderBuilder(a,pxlPrincipledVert(o),pxlPrincipledFrag(n,l,!0,!0,o,e),r);h.transparent=!1,h.lights=!0,l||(h.uniforms.dTexture.value=s.material.map),h.uniforms.noiseTexture.value=this.cloud3dTexture,h.uniforms.detailTexture.value=this.pxlEnv.detailNoiseTexture,s.material=h,this.materialList[s.name]=h}}}animPostLoad(e,t){if(this.pxlAnim.hasClip(e,this.animInitCycle)){var i=this.pxlAnim.getMixer(e);this.animMixer=i,this.pxlAnim.playClip(e,this.animInitCycle)}else this.animInitCycle=fallback,this.log("No animation cycle '"+this.animInitCycle+"' found; Using '"+fallback+"' instead")}build(){this.sceneFile&&this.pxlFile.loadRoomFBX(this)}onMessage(e,t){if(console.log("Room : "+this.roomName+" - Message Received: "+e),console.log("Message : "+t),"roomwarp"===(e=e.toLowerCase()))this.roomWarp=t;else console.log("-- Message Type Not Recognized -- "),console.log("Room : "+this.roomName),console.log("Message Received: "+e),console.log("Message : "+t)}}var B,G,pxlNavVersion="0.0.21",j="pxlNav-coreCanvas",U=window.innerWidth,V=window.innerHeight;class pxlNav{constructor(e,t,i,s){this._active=!1;e.hasOwnProperty("pxlRoomRoot")&&e.pxlRoomRoot,this.pxlEnums=pxlEnums,this.assetsToLoadDict={Cloud3d:!0,SoftNoise:!0,SmoothNoise:!0,ChromaticAberration:!1,WarpAnimTexture:!1,MathFuncs:!1},this.knownPostProcessPasses={mapComposerWarpPass:["cloud3dTexture"],chromaticAberrationPass:["ChromaticAberration"],lizardKingPass:["cloud3dTexture"],starFieldPass:["cloud3dTexture"],crystallinePass:["cloud3dTexture"]},this.pxlOptions=Object.assign({},e);var a=Object.keys(this.pxlOptions);Object.keys(pxlOptions).forEach((e=>{a.includes(e)||(this.pxlOptions[e]=pxlOptions[e])})),this.pxlOptions.hasOwnProperty("userSettings")||(this.pxlOptions.userSettings=Object.assign({},D)),this.verbose=this.pxlOptions.verbose,this.projectTitle=t,this.startingRoom=i,s.includes(i)||s.push(i),this.roomBootList=s,this.callbacks={},this.uriHashParms=this.findHashParms(),this.mobile=this.isMobile(),this.autoCam=this.getHashParm("autoCam",!1),this.loadPercent=0,this.folderDict={assetRoot:this.pxlOptions.pxlAssetRoot+"/",guiRoot:this.pxlOptions.pxlAssetRoot+"/GUI/",roomRoot:this.pxlOptions.pxlAssetRoot+"/rooms/",vidRoot:this.pxlOptions.pxlAssetRoot+"/screenContent/"},this.validEvents={booted:"Emitted after the engine has fully booted and is ready to be addressed.",shaderEditorVis:"Returns a [bool]; Emitted when the shader editor is toggled on or off.","roomChange-Start":"Emitted when the room change transition begins.","roomChange-Middle":"Emitted when the room change process occurs mid transition.","roomChange-End":"Returns a [bool]; Emitted when the room change transition ends.",fromRoom:"Returns a custom object; Emitted from your Room code you choose to emit during run time.","device-keydown":"Returns an [int]; The just pressed key.","device-keyup":"Returns an [int]; The just released key.","device-resize":"Returns an [{height:#,width:#}]; Height Width object of the new window size.","camera-move":"Returns a {'pos':vec3(),'dist':float}; Emitted when the camera moves.","camera-rotate":"Returns a [quaternion]; Emitted when the camera rotates.","camera-jump":"Returns a [bool]; Emitted when the camera jumps to a new position.","camera-fall":"Returns a [bool]; Emitted when the camera starts to free-fall / gravity.","camera-landed":"Returns a [bool]; Emitted when the camera lands from a jump / fall.","camera-collision":"Returns a [bool]; Emitted when the camera collides with an object.",pxlNavEventNameHere:"Never emitted; You did some copy'pasta.","":"** NOTE : callbacks get an event object shaped -  **","":"** { 'type' : *eventName*, 'value' : *data* } **","":"",help:"Hello! I'm here to help you!",pingPong:"Send 'ping', Get 'pong'! - pxlNav.trigger('ping');"},this.validEventsKeys=Object.keys(this.validEvents),this.loadEnvAssetFile=!0,this.pxlTimer=new _.Timer,this.pxlShaders=O,this.pxlCookie=new _.CookieManager(this.verbose,t,"/"),this.pxlCookie.hasCookie("forceMobile")&&(this.mobile=pxlCookie.parseCookie("forceMobile")),this.pxlQuality=new _.QualityController(this.verbose,this.mobile,this.uriHashParms),this.pxlUtils=new _.Utils(this.folderDict.assetRoot,this.mobile),this.pxlFile=new _.FileIO(this.folderDict),this.pxlExtensions=new _.Extensions,this.pxlAudio=new _.Audio(this.pxlTimer),this.pxlAutoCam=new _.AutoCamera(this.autoCam,this.mobile),this.pxlAutoCam.active=!1,this.pxlUser=new _.User,this.pxlEnv=new _.Environment(this.pxlOptions,this.startingRoom,this.mobile),this.pxlDevice=new _.Device(t,j,this.mobile,this.autoCam),this.pxlColliders=new _.Colliders(this.verbose,this.pxlOptions.collisionScale.gridSize,this.pxlOptions.collisionScale.gridReference),this.pxlCamera=new _.Camera,this.pxlOptions.staticCamera&&this.pxlCamera.toggleMovement(!1),this.pxlCamera.setUserSettings(this.pxlOptions.userSettings),this.pxlAnim=new _.Animation(this.folderDict.assetRoot,this.pxlTimer),this.pxlGuiDraws=new _.GUI(this.verbose,t,this.folderDict.assetRoot,this.folderDict.guiRoot),this.pxlQuality.setDependencies(this),this.pxlUtils.setDependencies(this),this.pxlFile.setDependencies(this),this.pxlAudio.setDependencies(this),this.pxlAutoCam.setDependencies(this),this.pxlUser.setDependencies(this),this.pxlEnv.setDependencies(this),this.pxlAnim.setDependencies(this),this.pxlDevice.setDependencies(this),this.pxlColliders.setDependencies(this),this.pxlCamera.setDependencies(this),this.pxlGuiDraws.setDependencies(this),this.pxlDevice.init(),this.pxlGuiDraws.prepLoader(),this.pxlOptions.hasOwnProperty("loaderPhrases")||(this.pxlOptions.loaderPhrases=["...loading the pixels..."]),this.pxlGuiDraws.setLoaderPhrases(this.pxlOptions.loaderPhrases),this.verbose>=pxlEnums.VERBOSE_LEVEL.INFO&&(console.log("pxlNav v"+pxlNavVersion+" set to Verbose Info Mode"),console.log("  With Three.js v171"),console.log("Booting pxlNAv...")),this.pxlQuality.init()}set active(e){void 0===e&&(e=null),null==e&&(e=!this.pxlTimer.active),1==e?(this.pxlTimer.play(),this.step(!1)):this.pxlTimer.stop()}get active(){return this.pxlTimer.active}start(){this.active=!0}stop(){this.active=!1}init(){this.pxlTimer.init(),this.pxlEnv.boot(),this.pxlQuality.startBenchmark(),this.checkPxlOptions(),this.buildGui().then((()=>{this.tickLoader(),this.bootEnvironment()})).then((()=>{this.tickLoader(),this.bootEngine()})).then((()=>{this.tickLoader(),this.pxlEnv.buildComposers(),this.cameraRunAnimatorMobile(this),this.pxlGuiDraws.stepLoader("postBoot"),this.pxlEnv.mapRender(),this.pxlDevice.setCursor("grab")})).catch((e=>{this.verbose>pxlEnums.VERBOSE_LEVEL.NONE&&(console.error("Error in pxlNavCore.init(); Load level - ",e),console.error(e))})).finally((()=>{this.verbose>=pxlEnums.VERBOSE_LEVEL.INFO&&(console.log("'pxlNavCore' Room Build Promise-Chain Completed; ",this.loadPercent),console.log("-- Starting pxlNav in Room `"+this.pxlEnv.bootRoom+"`")),this.start()}))}checkPxlOptions(){if(this.pxlOptions.hasOwnProperty("postProcessPasses")){var e=Object.keys(this.pxlOptions.postProcessPasses),t=Object.keys(this.knownPostProcessPasses);e.forEach((e=>{t.includes(e)&&this.pxlOptions.postProcessPasses[e]&&this.knownPostProcessPasses[e].forEach((e=>{this.assetsToLoadDict[e]=!0}))}))}}buildGui(){return new Promise(((e,t)=>{this.pxlGuiDraws.booted(),this.pxlGuiDraws.pxlNavCanvas=document.getElementById(j),B=window.innerWidth*this.pxlQuality.screenResPerc,this.pxlGuiDraws.pxlNavCanvas.width=window.innerWidth,G=window.innerHeight*this.pxlQuality.screenResPerc,this.pxlGuiDraws.pxlNavCanvas.height=window.innerHeight,this.pxlDevice.canCursorLock&&(this.pxlGuiDraws.pxlNavCanvas.requestPointerLock=this.pxlGuiDraws.pxlNavCanvas.requestPointerLock||this.pxlGuiDraws.pxlNavCanvas.mozRequestPointerLock||this.pxlGuiDraws.pxlNavCanvas.webkitRequestPointerLock,document.requestPointerLock=this.pxlGuiDraws.pxlNavCanvas.exitPointerLock||this.pxlGuiDraws.pxlNavCanvas.mozExitPointerLock||this.pxlGuiDraws.pxlNavCanvas.webkitExitPointerLock),this.pxlGuiDraws.mapPrepPrompts(),e(!0)}))}isMobile(){var e=!1;return e=/\b(BlackBerry|webOS|iPhone|IEMobile|Android|Windows Phone|iPad|iPod)\b/i.test(navigator.userAgent),e=this.getHashParm("m",e)}findHashParms(){var e={},t=window.location.hash;if(t.length>1)for(var i=(t=t.substring(1)).split("&"),s=0;s<i.length;s++){var a=i[s].split("=");e[a[0]]=a[1]}return e}getHashParm(e,t){return Object.keys(this.uriHashParms).includes(e)?this.uriHashParms[e]:t}tickLoader(){this.loadPercent+=1}bootEngine(){return new Promise(((e,t)=>{for(var i=[],s=0;s<this.roomBootList.length;++s)i.push(this.pxlEnv.loadRoom(this.roomBootList[s]));Promise.all(i).then((()=>{e(!0)}))}))}bootEnvironment(){return new Promise(((e,t)=>{this.pxlEnv.engine=new x.WebGLRenderer({canvas:this.pxlGuiDraws.pxlNavCanvas,powerPreference:"low-power",alpha:!0,antialias:!1,sortObjects:!0,depth:!0});var i={format:x.RGBAFormat,antialias:!1,sortObjects:!0,alpha:!0,type:/(iPad|iPhone|iPod)/g.test(navigator.userAgent)?x.HalfFloatType:x.FloatType};this.pxlEnv.engine.autoClear=!0,x.ColorManagement.enabled=!1,this.pxlEnv.engine.outputColorSpace=x.SRGBColorSpace,this.pxlEnv.engine.debug.checkShaderErrors=!1,this.pxlEnv.engine.debug.checkShaderErrors=!0;this.pxlEnv.engine.setClearColor(this.pxlEnv.fogColor,0),this.pxlEnv.engine.setSize(B/this.pxlQuality.screenResPerc,G/this.pxlQuality.screenResPerc),this.pxlEnv.engine.setPixelRatio(1),this.pxlOptions.shadowMapBiasing==pxlEnums.SHADOW_MAP.OFF?this.pxlEnv.engine.shadowMap.enabled=!1:(this.pxlEnv.engine.shadowMap.enabled=!0,this.pxlEnv.engine.shadowMap.type=x.BasicShadowMap),this.pxlEnv.scene=new x.Scene,this.pxlEnv.scene.fog=this.pxlEnv.fog,this.pxlEnv.scene.background=new x.Color("#000000"),this.pxlEnv.scene.renderTarget=new x.WebGLRenderTarget(U*this.pxlQuality.screenResPerc,V*this.pxlQuality.screenResPerc,i),this.pxlEnv.scene.renderTarget.texture.format=x.RGBAFormat,this.pxlEnv.scene.renderTarget.texture.minFilter=x.LinearFilter,this.pxlEnv.scene.renderTarget.texture.magFilter=x.LinearFilter,this.pxlEnv.scene.renderTarget.texture.generateMipmaps=!1,this.pxlEnv.scene.renderTarget.depthBuffer=!0,this.pxlEnv.scene.renderTarget.depthTexture=new x.DepthTexture,this.pxlEnv.scene.renderTarget.depthTexture.format=x.DepthFormat,this.pxlEnv.scene.renderTarget.depthTexture.type=x.UnsignedIntType,this.pxlEnv.scene.renderWorldPos=new x.WebGLRenderTarget(U*this.pxlQuality.screenResPerc,V*this.pxlQuality.screenResPerc,i),this.pxlEnv.scene.renderWorldPos.texture.format=x.RGBAFormat,this.pxlEnv.scene.renderWorldPos.texture.minFilter=x.NearestFilter,this.pxlEnv.scene.renderWorldPos.texture.magFilter=x.NearestFilter,this.pxlEnv.scene.renderWorldPos.texture.generateMipmaps=!1,i.alpha=!0,this.pxlEnv.scene.renderGlowTarget=new x.WebGLRenderTarget(parseInt(U*this.pxlQuality.screenResPerc),parseInt(V*this.pxlQuality.screenResPerc),i),this.pxlEnv.scene.renderGlowTarget.texture.format=x.RGBAFormat,this.pxlEnv.scene.renderGlowTarget.texture.generateMipmaps=!1;var s,a=this.pxlEnv.pxlCamFOV[this.pxlDevice.mobile?"MOBILE":"PC"];if(this.pxlCamera.camera=new x.PerspectiveCamera(a,1,this.pxlEnv.camNear,this.pxlEnv.camFar),this.pxlAutoCam.camera=this.pxlCamera.camera,this.pxlCamera.cameraAimTarget=new x.Object3D,this.pxlEnv.scene.add(this.pxlCamera.cameraAimTarget),this.pxlCamera.camera.target=this.pxlCamera.cameraAimTarget,this.pxlCamera.camera.layers.enable(1),this.pxlCamera.camera.layers.enable(2),this.pxlEnv.scene.add(this.pxlEnv.userAvatarGroup),this.assetsToLoadDict.Cloud3d&&(this.pxlEnv.cloud3dTexture=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"Noise_Cloud3d.jpg",null,{encoding:x.LinearSRGBColorSpace}),this.pxlEnv.cloud3dTexture.wrapS=x.RepeatWrapping,this.pxlEnv.cloud3dTexture.wrapT=x.RepeatWrapping),this.assetsToLoadDict.SoftNoise&&(this.pxlEnv.softNoiseTexture=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"Noise_Soft3d.jpg"),this.pxlEnv.softNoiseTexture.wrapS=x.RepeatWrapping,this.pxlEnv.softNoiseTexture.wrapT=x.RepeatWrapping),this.assetsToLoadDict.SmoothNoise&&(this.pxlEnv.detailNoiseTexture=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"Noise_UniformSmooth.jpg"),this.pxlEnv.detailNoiseTexture.wrapS=x.RepeatWrapping,this.pxlEnv.detailNoiseTexture.wrapT=x.RepeatWrapping),this.assetsToLoadDict.ChromaticAberration){var r=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"uv_ChromaticAberration_rgb.jpg");r.minFilter=x.LinearFilter,r.magFilter=x.LinearFilter,this.pxlEnv.chroAberUVTexture=r;var n=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"uv_ChromaticAberration_alpha.jpg");n.minFilter=x.LinearFilter,n.magFilter=x.LinearFilter,this.pxlEnv.chroAberUVAlpha=n}this.assetsToLoadDict.WarpAnimTexture&&(this.pxlEnv.blockAnimTexture=this.pxlUtils.loadTexture(this.folderDict.assetRoot+"uv_blockPortalWarp.jpg"),this.pxlEnv.blockAnimTexture.minFilter=x.LinearFilter,this.pxlEnv.blockAnimTexture.magFilter=x.LinearFilter);s=function tListIdent(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t={t:[0,0,0],r:[0,0,0],s:[1,1,1]};return null!=e&&(t[e[0]]=e[1]),t}();if(this.mobile&&"_mobile",this.loadEnvAssetFile){var o=this.folderDict.assetRoot+"EnvironmentAssets.fbx";this.pxlFile.loadSceneFBX(o,undefined,s,this.verbose,"EnvironmentAssets",[this.pxlEnv.scene])}this.pxlOptions.shadowMapBiasing==pxlEnums.SHADOW_MAP.OFF?this.pxlEnv.engine.shadowMap.enabled=!1:(this.pxlEnv.engine.shadowMap.enabled=!0,this.pxlOptions.shadowMapBiasing==pxlEnums.SHADOW_MAP.BASIC||this.mobile?this.pxlEnv.engine.shadowMap.type=x.BasicShadowMap:this.pxlOptions.shadowMapBiasing==pxlEnums.SHADOW_MAP.SOFT&&(this.pxlEnv.engine.shadowMap.type=x.PCFSoftShadowMap));var l=new x.AmbientLight(16777215,.05);this.pxlEnv.lightList.push(l),this.pxlEnv.scene.add(l);var h=new x.DirectionalLight(16777215,.1);h.position.set(1e3,550,1200),this.pxlEnv.lightList.push(h),this.pxlEnv.scene.add(h),e(!0)}))}cameraRunAnimatorMobile(e){for(var t=!1,i=Object.keys(e.pxlEnv.geoLoadList),s=0;s<i.length;++s){var a;if(t=(t=0==e.pxlEnv.geoLoadList[i[s]])&&!(null!==(a=e.pxlEnv.roomSceneList[s])&&void 0!==a&&a.booted))break}t?setTimeout((()=>{e.cameraRunAnimatorMobile(e)}),300):e.initRoomList(e)}initRoomList(e){e.pxlGuiDraws.stepLoader("camAnim"),e.pxlCamera.setTransform(e.pxlEnv.camInitPos,e.pxlEnv.camInitLookAt),e.pxlCamera.updateCamera(),e.pxlEnv.buildRoomEnvironments(),e.monitorRoomLoad(e)}monitorRoomLoad(e){for(var t=!1,i=Object.keys(e.pxlEnv.geoLoadList),s=0;s<i.length;++s){var a;if(t=(t=0==e.pxlEnv.geoLoadList[i[s]])&&!(null!==(a=e.pxlEnv.roomSceneList[s])&&void 0!==a&&a.booted))break}t?setTimeout((()=>{e.monitorRoomLoad(e)}),300):(e.pxlQuality.mapAutoQualityUpdate(1,!0),e.runPrepDrawScenes(0,!0,[]))}runPrepDrawScenes(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(e++,i.length>0){if(t){t=!1;var s=i[i.length-1];this.pxlCamera.warpToRoom(s)}if(this.pxlCamera.colliderPrevObjHit=null,this.pxlEnv.mapRender(!1),e%10==0){var a=i.pop();t=!0,this.pxlGuiDraws.stepLoader(a)}requestAnimationFrame((()=>{this.runPrepDrawScenes(e,t,i)}))}else this.pxlGuiDraws.stepLoader("Post Room Prep"),this.pxlNavPrepSettings()}pxlNavPrepSettings(){this.pxlCamera.warpToRoom(this.pxlEnv.bootRoom,!0),this.pxlQuality.endBenchmark(),this.pxlGuiDraws.stepLoader("Nav Settings"),this.startPxlNav()}startPxlNav(){this.pxlTimer.init(),this.pxlTimer.play(),this.pxlGuiDraws.applyCookies(),this.pxlGuiDraws.pxlNavCanvas&&this.pxlGuiDraws.pxlNavCanvas.focus();var e=this.pxlEnv.roomSceneList[this.pxlEnv.currentRoom];e.active=!0,e.startTime=this.pxlTimer.msRunner.x,this.pxlEnv.roomPostGuiCalls.forEach((e=>{e.postGuiEvent()})),this.pxlEnv.roomPostGuiCalls=[],this.pxlAutoCam.enabled&&this.pxlGuiDraws.guiToggleVisibility(!1),this.pxlAutoCam.init(),this.pxlDevice.resizeRenderResolution(),this.pxlEnv.mapRender(),this.pxlQuality.setDependentSettings(),this.pxlGuiDraws.stepLoader("Starting...");var t=this;setTimeout((()=>{t.pxlEnv.postBoot(),t.pxlGuiDraws.mapPrompt&&t.pxlGuiDraws.promptFader(t.pxlGuiDraws.mapPrompt,!1,null,!0),t.pxlGuiDraws.mapPromptBG&&t.pxlGuiDraws.promptFader(t.pxlGuiDraws.mapPromptBG,!1,null,!1),t.emit("booted",!0)}),200)}step(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.pxlTimer.active&&(this.pxlTimer.step(),e&&requestAnimationFrame((()=>{this.step()})))}bootTimer(){this.pxlTimer.init(),this.pxlTimer.play()}stopTimer(){this.pxlTimer.stop()}pauseTimer(){this.pxlTimer.pause()}prepPromptFader(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=e;("string"!=typeof i||(i=document.getElementById(i)))&&(i.classList.add("fader"),i.classList.add(t?"visOn":"visOff"),i.style.display=t?"inline-block":"none")}promptFader(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if("string"!=typeof e||(e=document.getElementById(e)))if(e.classList.value.indexOf("fader")<0&&e.classList.add("fader"),t)e.style.display="inline-block",setTimeout((()=>{e.classList.contains("visOff")&&(e.classList.remove("visOff"),e.classList.add("visOn"),null!=i&&(e.setAttribute("fadeOut",clockTime+1e3*i),fadeOutList.push(e)))}),50);else if(e.classList.remove("visOn"),e.classList.add("visOff"),s){["webkitTransitionEnd","otransitionend","oTransitionEnd","msTransitionEnd","transitionend"].forEach((t=>{e.addEventListener(t,(()=>{var t=e.parentNode;t&&t.removeChild(e)}))}))}else setTimeout((()=>{e.classList.contains("visOff")&&(e.style.display="none")}),1e3)}addRooms(e){for(var t=0;t<e.length;++t)this.pxlEnv.roomNameList.includes(e[t])||this.booted||this.roomBootList.push(e[t])}setBootRoom(e,t){this.pxlEnv.bootRoom=e,this.pxlEnv.bootLocation=t}setLoaderPhrases(e){this.pxlGuiDraws.setLoaderPhrases(e)}initExtension(e,t,i){this.pxlExtensions.init(e,t,i)}startExtension(e,t,i){this.pxlExtensions.start(e,t,i)}stopExtension(e,t,i){this.pxlExtensions.stop(e,t,i)}extensionStatus(e){return this.pxlExtensions.status(e)}trigger(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;switch(e=e.toLowerCase()){case"warptoroom":this.pxlCamera.warpToRoom(t,!0,i);break;case"camera":var s=t.toLowerCase();"roam"==s?this.pxlCamera.toggleMovement(!0):"static"==s&&this.pxlCamera.toggleMovement(!1);break;case"ping":this.emit("pingPong","pong");break;case"roommessage":var a=i.type,r=i.value;null==t&&(t=this.pxlEnv.currentRoom),this.pxlEnv.sendRoomMessage(t,a,r)}}subscribe(e,t){if(this.validEventsKeys.includes(e))if("test"==e)console.log("Test Event : `pxlNav.subscribe( 'test', ... )` was used; subscription list -");else if("pxlNavEventNameHere"==e||"help"==e)"pxlNavEventNameHere"==e?console.warn("Warning : `pxlNav.subscribe( 'pxlNavEventNameHere', ... )` was used; need some help?"):"help"==e&&console.log("Help Requested : `pxlNav.subscribe( 'help', ... )` was used; Subscription items--"),console.log("Valid Event Types : "),this.validEventsKeys.forEach((e=>{console.log("  - ",e," : ",this.validEvents[e])}));else{var i=e.split("-");if("device"==i[0])this.pxlDevice.subscribe(i[1],t);else if("camera"==i[0]){var s=pxlEnums.CAMERA_EVENT.MOVE;switch(i[1]){case"move":s=pxlEnums.CAMERA_EVENT.MOVE;break;case"rotate":s=pxlEnums.CAMERA_EVENT.ROTATE;break;case"jump":s=pxlEnums.CAMERA_EVENT.JUMP;break;case"fall":s=pxlEnums.CAMERA_EVENT.FALL;break;case"landed":s=pxlEnums.CAMERA_EVENT.LANDED;break;case"collision":s=pxlEnums.CAMERA_EVENT.COLLISION;break;default:console.warn("Warning : `pxlNav.subscribe( 'camera-"+i[1]+"', ... )` was used; use 'help' for a list of valid events.")}this.pxlCamera.subscribe(s,t)}else this.callbacks[e]=t}else console.warn("Warning : `pxlNav.subscribe( '"+e+"', ... )` was used; use 'help' for a list of valid events.")}emit(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this.callbacks[e]){var s={type:e,value:t};null!==i&&(s.status=i),this.callbacks[e](s)}}}var F=c.l$,H=c.eT,N=c.vi,W=c.Bn,z=c.IF,K=c.uU,Q=c.Z$,Y=c.pL,X=c.tk;export{F as RoomEnvironment,H as pxlBase,N as pxlEffects,W as pxlEnums,z as pxlNav,K as pxlNavVersion,Q as pxlOptions,Y as pxlShaders,X as pxlUserSettings};