export class ProcPages{constructor(){this.mainDiv=null,this.curPage=null,this.curRoom=null,this.curLocation=null,this.defaultPage="Init",this.pageListing={},this.navBarLinks=[],this.navBarObjs={},this.toggleDomEvents={},this.resObjsVis=!0,this.resBasedObjs=[],this.triggerEmitFunc=null,this.pageStyleOverrides={},this.runningTimeouts={},this.domEventStates={ToggleDOM:!1}}hashListener(){window.addEventListener("hashchange",(e=>{let t=this.getHash();t!=this.curPageName&&("Blog"==t&&this.showPage("Blog"),this.changePage(t))}))}setPxlNavVersion(e){"v"!=e[0]&&(e="v"+e);let t=document.getElementById("pxlNavVersion");t&&(t.innerText=e);let s=document.getElementById("pxlNavPageVersion");s&&(s.innerText=e)}init(){this.mainDiv=document.getElementById("procStackGitBlock"),this.navBar=document.getElementById("gitPageNav"),this.navBarLinks=[...this.navBar.getElementsByTagName("a")],this.navBarLinks.forEach((e=>{let t=e.getAttribute("pageName");this.navBarObjs[t]=e})),this.resBasedObjs=[...document.getElementsByClassName("squashInLowRes")],this.contentParent=document.getElementById("gitPageContentParent");let e=[...document.getElementsByName("gitPage")],t=this.getHash();this.findDomUserEvents(),e.forEach((e=>{if(this.prepFader(e),e.hasAttribute("page-style")){let t=e.getAttribute("page-style");t=t.split(";"),t.forEach((t=>{let s=t.split(":");if(2==s.length){let t=e.getAttribute("page-id");this.pageStyleOverrides[t]=this.pageStyleOverrides[t]||{},this.pageStyleOverrides[t][s[0]]=s[1]}}))}let s=null;e.hasAttribute("page-id")?s=e.getAttribute("page-id"):(s=e.id,e.setAttribute("page-id",s)),this.pageListing[s]={},this.pageListing[s].obj=e,this.pageListing[s].room=null,this.pageListing[s].view=null,this.pageListing[s].theme=null,s==t?(this.curPageName=s,this.curPage=e,this.toggleFader(this.curPage,!0)):e.style.display="none"})),this.navBarLinks.forEach((e=>{let s=e.getAttribute("pageName"),i=e.getAttribute("pageTheme"),a=e.getAttribute("pxlRoomName"),n=e.getAttribute("pxlCameraView");this.pageListing.hasOwnProperty(s)&&(this.pageListing[s].room=a,this.pageListing[s].view=n,this.pageListing[s].theme=i,s=s.replace(/(?: |\/|\.|\n)/g,""),s==t&&(this.curRoom=e.getAttribute("pxlRoomName"),this.curLocation=e.getAttribute("pxlCameraView")),e.addEventListener("click",(e=>{e.preventDefault();let t=this.curPage.getAttribute("page-id");s!=t&&(window.location.hash=s,this.changePage(s,a,n))})))})),window.addEventListener("resize",this.onResize.bind(this)),this.setStyleOverrides(),this.hashListener(),setTimeout((()=>{this.checkNavBarSize()}))}setBrowserTheme(e){e?document.querySelector("meta[name='theme-color']").setAttribute("content",e):document.querySelector("meta[name='theme-color']").removeAttribute("content")}findDomUserEvents(){[...document.getElementById("gitPageToggleDOM").children].forEach((e=>{let t=e.getAttribute("pageEvent");this.toggleDomEvents.hasOwnProperty(t)||(this.toggleDomEvents[t]={});let s=parseInt(e.getAttribute("pageValue"));s=!!s,s?this.toggleDomEvents[t].on=e:this.toggleDomEvents[t].off=e,s==this.domEventStates[t]?e.style.display="none":e.style.display="block"})),Object.keys(this.toggleDomEvents).forEach((e=>{let t=this.toggleDomEvents[e];t.hasOwnProperty("on")&&t.hasOwnProperty("off")&&(t.on.addEventListener("click",(t=>{this.toggleDomEvents[e].on.style.display="none",this.toggleDomEvents[e].off.style.display="block",this.toggleMidFader(this.mainDiv,!0)})),t.off.addEventListener("click",(t=>{this.toggleDomEvents[e].off.style.display="none",this.toggleDomEvents[e].on.style.display="block",this.toggleMidFader(this.mainDiv,!1)})))}))}triggerDomEvent(e,t){if(this.toggleDomEvents.hasOwnProperty(e)){let s=this.toggleDomEvents[e];s.hasOwnProperty("on")&&s.hasOwnProperty("off")&&(t?(s.on.style.display="none",s.off.style.display="block"):(s.off.style.display="none",s.on.style.display="block"))}}eventHandler(e){"booted"==e.type?this.postLoad():"shaderEditorVis"==e.type?this.toggleMidFader(this.mainDiv,e.value):"roomChange-Start"==e.type?console.log("Room Change Start"):"roomChange-End"==e.type?console.log("Room Change End"):"pong"==e.type&&console.log("Pong!")}bindTriggerEmits(e){this.triggerEmitFunc=e}unbindTriggerEmits(){this.triggerEmitFunc=null}postLoad(){let e=this.curPage.getAttribute("page-id");if(this.pageListing.hasOwnProperty(e)){let t=this.pageListing[e].room,s=this.pageListing[e].view;this.setBrowserTheme(this.pageListing[e].theme),this.triggerEmitFunc("warpToRoom",t,s)}this.toggleFader(this.mainDiv,!0)}setStyleOverrides(){if(!this.curPage)return;let e=this.curPage.getAttribute("page-id");if(this.pageStyleOverrides.hasOwnProperty(e)){Object.keys(this.pageStyleOverrides[e]).forEach((t=>{let s=document.getElementById(t);if(s){if(s.hasAttribute("pages-default-class")){let e=s.getAttribute("pages-default-class");s.classList.remove(e)}s.classList.add(this.pageStyleOverrides[e][t])}}))}}changePage(e,t=null,s=null){if(e!=this.curPage&&Object.keys(this.pageListing).includes(e)){if(this.toggleFader(this.curPage,!1),null!=this.curPage){let e=this.curPage.getAttribute("page-id");if(this.pageStyleOverrides.hasOwnProperty(e)){Object.keys(this.pageStyleOverrides[e]).forEach((t=>{let s=document.getElementById(t);if(s&&s.classList.contains(this.pageStyleOverrides[e][t])&&(s.classList.remove(this.pageStyleOverrides[e][t]),s.hasAttribute("pages-default-class"))){let e=s.getAttribute("pages-default-class");s.classList.add(e)}}))}}this.domEventStates.ToggleDOM&&(this.toggleMidFader(this.mainDiv,!1),this.triggerDomEvent("ToggleDOM",!1)),this.curPageName=e,this.curPage=this.pageListing[e].obj,this.setBrowserTheme(this.pageListing[e].theme),this.toggleFader(this.curPage,!0),this.setStyleOverrides(),this.curPage.parentElement.scrollTop=0,this.triggerEmitFunc&&null!=t&&(null==s&&(s="init"),this.triggerEmitFunc("warpToRoom",t,s))}}getHash(){let e=window.location.hash;return e=e.replace("#",""),""==e?this.defaultPage:e}onResize(){this.checkNavBarSize()}checkNavBarSize(){let e=window.innerWidth,t=(window.innerHeight,0);this.navBarLinks.forEach((e=>{let s=e.offsetWidth;t+=s})),t+=this.toggleDomEvents.ToggleDOM.on.offsetWidth;let s=.9*this.navBar.offsetWidth,i=.6*this.navBar.offsetWidth;this.resObjsVis&&t>s?(this.resObjsVis=!1,this.resBasedObjs.forEach((e=>{e.style.display="none"}))):!this.resObjsVis&&t<i&&(this.resObjsVis=!0,this.resBasedObjs.forEach((e=>{e.style.display="contents"})));let a=60;if(e<1e3){a+=40*(1-Math.max(0,.001*e*2-1))}this.navBar.style.width=a+"vw"}prepFader(e){"string"==typeof e&&(e=document.getElementById(e)),e&&(e.classList.add("pagesFader"),e.classList.add("pagesVisOff"))}toggleFader(e,t=!1){if("string"==typeof e&&(e=document.getElementById(e)),!e)return;let s=e.getAttribute("page-id");if(t){e.style.display="block",e.classList.add("pagesVisOn"),e.classList.remove("pagesVisOff");let t=this.runningTimeouts[s];t?clearTimeout(t):this.runningTimeouts[s]=null}else{e.classList.add("pagesVisOff"),e.classList.remove("pagesVisOn");let t=setTimeout((()=>{e.style.display="none"}),800);this.runningTimeouts[s]=t}}toggleMidFader(e,t=!1){if("string"==typeof e&&(e=document.getElementById(e)),!e)return;let s=document.getElementsByName("gitPage");t?(this.domEventStates.ToggleDOM=!0,e.style.display="block",e.classList.add("pagesVisMid"),e.classList.remove("pagesVisOn"),s.forEach((e=>{e.style.maxHeight="0px",e.style.minHeight="0px",e.style.padding="0px 10px",e.classList.add("gpcpHiddenStyle"),e.classList.remove("gpcpVisibleStyle"),e.style.border="0px"}))):(this.domEventStates.ToggleDOM=!1,e.classList.add("pagesVisOn"),e.classList.remove("pagesVisMid"),s.forEach((e=>{e.style.maxHeight="",e.style.minHeight="",e.style.padding="",e.classList.add("gpcpVisibleStyle"),e.classList.remove("gpcpHiddenStyle"),e.style.border=""})))}hidePage(e){if(this.navBarObjs.hasOwnProperty(e)){this.navBarObjs[e].style.display="none"}}showPage(e){if(this.navBarObjs.hasOwnProperty(e)){this.navBarObjs[e].style.display="block"}}}