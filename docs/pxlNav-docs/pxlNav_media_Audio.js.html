<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>pxlNav/media/Audio.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://procstack.github.io/Outlet.htm" target="_blank" class="menu-item" id="pxlNav_Example" >pxlNav Example : The Outlet</a></h2><h3>Modules</h3><ul><li><a href="module-pxlNav.html">pxlNav</a></li><li><a href="pxlNav.module_pxlEffects.html">pxlNav.pxlEffects</a></li><li><a href="pxlNav.pxlEffects.module_pxlParticles.html">pxlNav.pxlEffects.pxlParticles</a></li></ul><h3>Classes</h3><ul><li><a href="BillowSmoke.html">BillowSmoke</a><ul class='methods'><li data-type='method'><a href="BillowSmoke.html#build">build</a></li></ul></li><li><a href="EmberWisps.html">EmberWisps</a><ul class='methods'><li data-type='method'><a href="EmberWisps.html#build">build</a></li></ul></li><li><a href="FloatingDust.html">FloatingDust</a><ul class='methods'><li data-type='method'><a href="FloatingDust.html#build">build</a></li></ul></li><li><a href="HeightMap.html">HeightMap</a><ul class='methods'><li data-type='method'><a href="HeightMap.html#build">build</a></li><li data-type='method'><a href="HeightMap.html#setHeightMapPath">setHeightMapPath</a></li><li data-type='method'><a href="HeightMap.html#setSpawnMapPath">setSpawnMapPath</a></li></ul></li><li><a href="ParticleBase.html">ParticleBase</a><ul class='methods'><li data-type='method'><a href="ParticleBase.html#.addToScene">addToScene</a></li><li data-type='method'><a href="ParticleBase.html#.atlasArrayPicker">atlasArrayPicker</a></li><li data-type='method'><a href="ParticleBase.html#.atlasRandomGen">atlasRandomGen</a></li><li data-type='method'><a href="ParticleBase.html#.atlasRandomList">atlasRandomList</a></li><li data-type='method'><a href="ParticleBase.html#.build">build</a></li><li data-type='method'><a href="ParticleBase.html#.dupeArray">dupeArray</a></li><li data-type='method'><a href="ParticleBase.html#.elementDuplicator">elementDuplicator</a></li><li data-type='method'><a href="ParticleBase.html#.getSettings">getSettings</a></li><li data-type='method'><a href="ParticleBase.html#.hasPointLights">hasPointLights</a></li><li data-type='method'><a href="ParticleBase.html#.newMaterial">newMaterial</a></li><li data-type='method'><a href="ParticleBase.html#.setAtlasPath">setAtlasPath</a></li><li data-type='method'><a href="ParticleBase.html#.setPosition">setPosition</a></li></ul></li><li><a href="pxlAnim.html">pxlAnim</a><ul class='methods'><li data-type='method'><a href="pxlAnim.html#.Animation#addClips">Animation#addClips</a></li><li data-type='method'><a href="pxlAnim.html#.Animation#destroy">Animation#destroy</a></li><li data-type='method'><a href="pxlAnim.html#.Animation#getMesh">Animation#getMesh</a></li><li data-type='method'><a href="pxlAnim.html#.Animation#getMixer">Animation#getMixer</a></li><li data-type='method'><a href="pxlAnim.html#.Animation#getRig">Animation#getRig</a></li><li data-type='method'><a href="pxlAnim.html#.Animation#hasClip">Animation#hasClip</a></li><li data-type='method'><a href="pxlAnim.html#.Animation#initObject">Animation#initObject</a></li><li data-type='method'><a href="pxlAnim.html#.Animation#playClip">Animation#playClip</a></li><li data-type='method'><a href="pxlAnim.html#.Animation#setStateConnections">Animation#setStateConnections</a></li><li data-type='method'><a href="pxlAnim.html#.Animation#setWeight">Animation#setWeight</a></li></ul></li><li><a href="pxlCamera.html">pxlCamera</a><ul class='methods'><li data-type='method'><a href="pxlCamera.html#.Camera#setCameraRotateEasing">Camera#setCameraRotateEasing</a></li><li data-type='method'><a href="pxlCamera.html#.Camera#setGravityMax">Camera#setGravityMax</a></li><li data-type='method'><a href="pxlCamera.html#.Camera#setGravityRate">Camera#setGravityRate</a></li><li data-type='method'><a href="pxlCamera.html#.Camera#setInputMovementMult">Camera#setInputMovementMult</a></li><li data-type='method'><a href="pxlCamera.html#.Camera#setJumpHoldMax">Camera#setJumpHoldMax</a></li><li data-type='method'><a href="pxlCamera.html#.Camera#setJumpImpulse">Camera#setJumpImpulse</a></li><li data-type='method'><a href="pxlCamera.html#.Camera#setJumpRepeatDelay">Camera#setJumpRepeatDelay</a></li><li data-type='method'><a href="pxlCamera.html#.Camera#setJumpScalar">Camera#setJumpScalar</a></li><li data-type='method'><a href="pxlCamera.html#.Camera#setMaxStepHeight">Camera#setMaxStepHeight</a></li><li data-type='method'><a href="pxlCamera.html#.Camera#setMovementEase">Camera#setMovementEase</a></li><li data-type='method'><a href="pxlCamera.html#.Camera#setMovementMax">Camera#setMovementMax</a></li><li data-type='method'><a href="pxlCamera.html#.Camera#setMovementScalar">Camera#setMovementScalar</a></li><li data-type='method'><a href="pxlCamera.html#.Camera#setPositionBlend">Camera#setPositionBlend</a></li><li data-type='method'><a href="pxlCamera.html#.Camera#setTouchSensitivity">Camera#setTouchSensitivity</a></li><li data-type='method'><a href="pxlCamera.html#.Camera#setUserHeight">Camera#setUserHeight</a></li><li data-type='method'><a href="pxlCamera.html#.Camera#setUserScale">Camera#setUserScale</a></li><li data-type='method'><a href="pxlCamera.html#.Camera#setUserSettings">Camera#setUserSettings</a></li><li data-type='method'><a href="pxlCamera.html#.Camera#setWalkBounceEaseIn">Camera#setWalkBounceEaseIn</a></li><li data-type='method'><a href="pxlCamera.html#.Camera#setWalkBounceEaseOut">Camera#setWalkBounceEaseOut</a></li><li data-type='method'><a href="pxlCamera.html#.Camera#setWalkBounceHeight">Camera#setWalkBounceHeight</a></li><li data-type='method'><a href="pxlCamera.html#.Camera#setWalkBounceRate">Camera#setWalkBounceRate</a></li></ul></li><li><a href="pxlEnv.html">pxlEnv</a></li><li><a href="pxlHUD.html">pxlHUD</a><ul class='methods'><li data-type='method'><a href="pxlHUD.html#.HUD#addItem">HUD#addItem</a></li><li data-type='method'><a href="pxlHUD.html#.HUD#addToHUD">HUD#addToHUD</a></li><li data-type='method'><a href="pxlHUD.html#.HUD#createButton">HUD#createButton</a></li><li data-type='method'><a href="pxlHUD.html#.HUD#createDragRegion">HUD#createDragRegion</a></li><li data-type='method'><a href="pxlHUD.html#.HUD#createImage">HUD#createImage</a></li><li data-type='method'><a href="pxlHUD.html#.HUD#createRegion">HUD#createRegion</a></li><li data-type='method'><a href="pxlHUD.html#.HUD#createSlider">HUD#createSlider</a></li><li data-type='method'><a href="pxlHUD.html#.HUD#createText">HUD#createText</a></li><li data-type='method'><a href="pxlHUD.html#.HUD#createThumbstick">HUD#createThumbstick</a></li><li data-type='method'><a href="pxlHUD.html#.HUD#emit">HUD#emit</a></li><li data-type='method'><a href="pxlHUD.html#.HUD#subscribe">HUD#subscribe</a></li></ul></li><li><a href="pxlRoom%2520RoomEnvironment.html">pxlRoom RoomEnvironment</a><ul class='methods'><li data-type='method'><a href="pxlRoom%252520RoomEnvironment.html#addColliderHelper">addColliderHelper</a></li><li data-type='method'><a href="pxlRoom%252520RoomEnvironment.html#animPostLoad">animPostLoad</a></li><li data-type='method'><a href="pxlRoom%252520RoomEnvironment.html#applyRoomPass">applyRoomPass</a></li><li data-type='method'><a href="pxlRoom%252520RoomEnvironment.html#build">build</a></li><li data-type='method'><a href="pxlRoom%252520RoomEnvironment.html#castRay">castRay</a></li><li data-type='method'><a href="pxlRoom%252520RoomEnvironment.html#cleanupPortalRender">cleanupPortalRender</a></li><li data-type='method'><a href="pxlRoom%252520RoomEnvironment.html#fbxPostLoad">fbxPostLoad</a></li><li data-type='method'><a href="pxlRoom%252520RoomEnvironment.html#getArtistInfo">getArtistInfo</a></li><li data-type='method'><a href="pxlRoom%252520RoomEnvironment.html#getColliders">getColliders</a></li><li data-type='method'><a href="pxlRoom%252520RoomEnvironment.html#getCurrentShader">getCurrentShader</a></li><li data-type='method'><a href="pxlRoom%252520RoomEnvironment.html#getLerpAvgRate">getLerpAvgRate</a></li><li data-type='method'><a href="pxlRoom%252520RoomEnvironment.html#getLerpRate">getLerpRate</a></li><li data-type='method'><a href="pxlRoom%252520RoomEnvironment.html#getName">getName</a></li><li data-type='method'><a href="pxlRoom%252520RoomEnvironment.html#getShaderList">getShaderList</a></li><li data-type='method'><a href="pxlRoom%252520RoomEnvironment.html#hasColliderType">hasColliderType</a></li><li data-type='method'><a href="pxlRoom%252520RoomEnvironment.html#hasColliders">hasColliders</a></li><li data-type='method'><a href="pxlRoom%252520RoomEnvironment.html#hitColliders">hitColliders</a></li><li data-type='method'><a href="pxlRoom%252520RoomEnvironment.html#init">init</a></li><li data-type='method'><a href="pxlRoom%252520RoomEnvironment.html#onMessage">onMessage</a></li><li data-type='method'><a href="pxlRoom%252520RoomEnvironment.html#prepPortalRender">prepPortalRender</a></li><li data-type='method'><a href="pxlRoom%252520RoomEnvironment.html#readShader">readShader</a></li><li data-type='method'><a href="pxlRoom%252520RoomEnvironment.html#resetCamera">resetCamera</a></li><li data-type='method'><a href="pxlRoom%252520RoomEnvironment.html#resize">resize</a></li><li data-type='method'><a href="pxlRoom%252520RoomEnvironment.html#setDependencies">setDependencies</a></li><li data-type='method'><a href="pxlRoom%252520RoomEnvironment.html#setFog">setFog</a></li><li data-type='method'><a href="pxlRoom%252520RoomEnvironment.html#setPortalTexture">setPortalTexture</a></li><li data-type='method'><a href="pxlRoom%252520RoomEnvironment.html#setShader">setShader</a></li><li data-type='method'><a href="pxlRoom%252520RoomEnvironment.html#setUserHeight">setUserHeight</a></li><li data-type='method'><a href="pxlRoom%252520RoomEnvironment.html#start">start</a></li><li data-type='method'><a href="pxlRoom%252520RoomEnvironment.html#step">step</a></li><li data-type='method'><a href="pxlRoom%252520RoomEnvironment.html#stepColliderHelper">stepColliderHelper</a></li><li data-type='method'><a href="pxlRoom%252520RoomEnvironment.html#stop">stop</a></li><li data-type='method'><a href="pxlRoom%252520RoomEnvironment.html#toCameraPos">toCameraPos</a></li></ul></li></ul><h3>Namespaces</h3><ul><li><a href="pxlAudio.html">pxlAudio</a></li><li><a href="pxlAutoCam.html">pxlAutoCam</a></li><li><a href="pxlColliders.html">pxlColliders</a></li><li><a href="pxlCookie.html">pxlCookie</a></li><li><a href="pxlDevice.html">pxlDevice</a></li><li><a href="pxlFile.html">pxlFile</a></li><li><a href="pxlGuiDraws.html">pxlGuiDraws</a></li><li><a href="pxlQuality.html">pxlQuality</a></li><li><a href="pxlTimer.html">pxlTimer</a></li><li><a href="pxlUser.html">pxlUser</a></li><li><a href="pxlUtils.html">pxlUtils</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">pxlNav/media/Audio.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>
const SoundLibrary = [
	"./sounds/bits.ogg",
	"./sounds/bonus-2.ogg",
	"./sounds/bonus-3.ogg",
	"./sounds/BushesBakedBeans.mp3",
	"./sounds/Cute-Chime-1.mp3",
	"./sounds/funny-blunder.ogg",
	"./sounds/magic-coins.ogg",
	"./sounds/new-message-4.ogg",
	"./sounds/new-message-5.ogg",
	"./sounds/positive-game-sound-3.ogg",
	"./sounds/positive-game-sound-4.ogg",
	"./sounds/positive-win-game-sound-4.ogg",
	"./sounds/the-award-2.ogg"
];

/**
 * @namespace pxlAudio
 * @description Audio handling
 */

// Audio
import { Vector3, Vector4 } from "../../libs/three/three.module.min.js";

export class Audio{
  constructor(){
    this.pxlTimer=null;
    this.pxlVideo=null;
    this.pxlDevice=null;
    this.pxlEnv=null;
    this.pxlGuiDraws=null;
    this.pxlSocket=null;
        
    this.active=false;
    this.audioTimer=new Vector3(0,0,0);
    this.audioEq=new Vector4(0,0,0,0);
    this.audioWorker=null;
    this.audioProcessor=null;
        
    this.djUrlSource="//"; // URL to the audio source
    this.djMuted=false;
    //this.djVolumeMute=null;
    this.djAudioVolume=0;
    this.djAudioVolumeMax=.65; // Initial Max value
    this.djAudioVolumeMin=.25; // Initial Min/Starting value
    this.djAudioVolumeScalar=.25; // Initial Min/Starting value
    
    this.djAudioObj=null;
    this.djTimecodeObj=null;
    this.djVolumeParentObj=null;
    this.djVolumeObj=null;
        
    this.roomAudioStopped=true;
    
    this.videoStreamObjects=[];
        
    this.colliderVolActive=false;
    
    this.isVideoObject=false;
    this.activeObject=null;
    
    
    this.fadeActive=false;
    this.fadeAdjustRate=.02;
    this.fadeDir=0;
    this.fadePerc=0;
    
    this.audioContext = null;
  }
  
  setDependencies( pxlNav ){
    this.pxlTimer=pxlNav.pxlTimer;
    this.pxlVideo=pxlNav.pxlVideo;
    this.pxlDevice=pxlNav.pxlDevice;
    this.pxlEnv=pxlNav.pxlEnv;
    this.pxlGuiDraws=pxlNav.pxlGuiDraws;
    this.pxlSocket=pxlNav.pxlSocket;
  }

  init(){
    this.active=true;
    }
    postBoot(){
        if( this.djAudioObj ){
            if(  this.pxlEnv.pxlAutoCam.enabled ){
                this.djAudioVolumeMax=1;
                this.djAudioVolumeMin=0;
            }else if( this.pxlEnv.mobile ){
                let pa= this;
                let avm=this.djAudioVolumeMax;
                let enter=document.getElementById("guiMobileWelcomeButton");
                function audioClickMonitor(e){
                    setTimeout( ()=>{
                        pa.djAudioVolume=0;
                        pa.djAudioVolumeMax=avm;
                        pa.djAudioVolumeMin=0;
                        pa.djAudioObj.byScript=true;
                        pa.djAudioObj.volume=0;
                        audioObj.play().then(()=>{
                            pa.djPlayerMuteToggle(false);
                            pa.setFadeActive( .5 );
                        });
                        enter.removeEventListener('click', audioClickMonitor);
                        enter.removeEventListener('touchstart', audioClickMonitor);
                    },500);
                }
                enter.addEventListener("click", audioClickMonitor);
                enter.addEventListener("touchstart", audioClickMonitor);
            }
            
            this.djAudioVolume= this.pxlEnv.enabled ? 0 : this.djAudioVolumeMin;
            this.djAudioObj.volume= this.pxlEnv.enabled ? 0 : this.djAudioVolumeMin;
            this.djPlayerMuteToggle(false);
            this.djPlayerAdjustVolume({});
            this.djPlayerSetSliderGui();
            
            let audioObj=this.djAudioObj;
            audioObj.setAttribute("autoplay", true);
            
            let tmpThis=this;
            this.djAudioObj.addEventListener("volumechange", (e)=>{
                tmpThis.djPlayerSetSliderGui();
            }, true);
        }
    }
    
  start(){}
  
  step(){
    if(this.djAudioObj){
      if(this.djAudioObj.paused){
        this.djAudioObj.play().catch((err)=>{});
                this.djAudioObj.muted=this.djMuted || !this.roomAudioStopped;
      }
    }
        // Set music volume on the DJ Audio Object
        this.fadeAudioEvent( );
  }
    isPaused(){
        let status = true;
    if(this.djAudioObj){
      status = this.djAudioObj.paused;
    }
        return status;
    }
    
  pausePlayback(){
    this.active=this.pxlTimer.active;
        
        if( this.active ){
            this.play();
        }else{
            this.stop();
        }
  }
  
    initPlay(){
        if( this.pxlVideo.canUnmute( 'dj' ) &amp;&amp; !this.isPaused() ){
            this.djPlayerMuteToggle(false);
            this.setFadeActive( 1 );
            
            if( this.pxlDevice.mobile ){
                this.pxlGuiDraws.toggleIcon(this.pxlGuiDraws.hudIcons.musicIcon, !this.djMuted, true );
            }
        }
    }
    
  play(){
    this.active=true;
        
        if( this.isVideoObject ){
            this.pxlVideo.setVolume( "dj", this.djAudioVolume );
            this.pxlVideo.setMuted( "dj", this.djMuted );
        }else{
            //loadStreamPromise();
            
            this.djAudioObj.byScript=true;
            let djDevice=this.djAudioObj;
            let djSource=djDevice.children[0];
            djSource.setAttribute("src",this.djUrlSource);
            setTimeout( ()=>{
                djDevice.load();
                setTimeout( ()=>{
                    djDevice.volume=this.djAudioVolume;
                    //djDevice.play();
                    djDevice.muted=this.djMuted || !this.roomAudioStopped;
                    if( djDevice.paused ){
                        djDevice.play();
                    }
                },20);
            },20);
        }
  }
  
  stop(){
    this.active=false;
        
        if( this.isVideoObject ){
            this.pxlVideo.setMuted( "dj", true );
        }else{
            let djDevice=this.djAudioObj;
            let djSource=djDevice.children[0];
            djSource.setAttribute("src","");
            djDevice.pause();
            setTimeout( ()=>{
                djDevice.load();
            },20);
        }
  }
    
  
    djBuildPlayer(){
        
    this.djAudioObj=document.getElementById("djStream");
    this.djVolumeParentObj=document.getElementById("djPlayerVolumeParent");
    this.djVolumeObj=document.getElementById("djPlayerVolume");
    
    this.djAudioObj.byScript=false;
    this.djAudioObj.volume=0;
    this.djVolumeObj.style.width="0%";
        
    let tmpThis=this;
        this.pxlDevice.objectPercList.push("djPlayerVolume");
        this.pxlDevice.objectPercList.push("djPlayerVolumeParent");
        this.pxlDevice.objectPercFuncList["djPlayerVolumeParent"]=(e)=>{tmpThis.djPlayerAdjustVolume(e);};
        
    
    this.djVolumeParentObj.down=false;
        // I think iPhone emits mouse down events, I'll need to test this
        this.djVolumeParentObj.addEventListener("mousedown", (e)=>{tmpThis.djVolumeParentObj.down=true;tmpThis.djPlayerAdjustVolume(e);});
        this.djVolumeParentObj.addEventListener("mousemove", (e)=>{tmpThis.djPlayerAdjustVolume(e);});
        this.djVolumeParentObj.addEventListener("mouseup", (e)=>{tmpThis.djVolumeParentObj.down=false;});
            
        if( this.pxlDevice.mobile ){
            this.djVolumeParentObj.style.width= "30vw";
            this.djVolumeParentObj.addEventListener("touchstart", (e)=>{tmpThis.djVolumeParentObj.down=true;}, {passive : true});
            this.djVolumeParentObj.addEventListener("touchmove", (e)=>{tmpThis.djPlayerAdjustVolume(e);}, {passive : true});
            this.djVolumeParentObj.addEventListener("touchend", (e)=>{tmpThis.djVolumeParentObj.down=false;}, {passive : true});
        }
        this.djAudioObj.muted=true;

        this.prepAudioProcessor();
    }
    
    prepAudioProcessor(){
        /*
        
        // If its not working, likely IE or Sufari
        //   we told em to use chrome, but chances are iPhone users will still use Sufari
        if( this.audioContext.audioWorklet &amp;&amp; AudioWorkletNode ){
            await this.audioContext.audioWorklet.addModule('white-noise-processor.js')
            const whiteNoiseNode = new AudioWorkletNode( this.audioContext, 'white-noise-processor' )
            whiteNoiseNode.connect( this.audioContext.destination )
            
            
  
            var audioInputCtx = new AudioContext();
            var audioDataBufferSeconds=1;
            var audioDataCtx = new OfflineAudioContext(1,audioDataBufferSeconds*44100,44100);
            var analyser;
            var filter = this.audioContext.createBiquadFilter();
            filter.type = 5;
            filter.frequency.value = 440;
            filter.Q.value = 5;
            filter.gain.value = 0;


            let audioDeviceList={};
            let audioForm=null; 
            let mediaStreamSource=null;

            function connectAudioDeviceData(e){
                if(this.audioContext.state == "suspended"){
                    this.audioContext.resume();
                }
                analyser = this.audioContext.createAnalyser();
                analyser.smoothingTimeConstant = 0;
                analyser.fftSize = 512;

            //.captureStream().createWorkerProcessor();

                function(stream) {
                    window.stream=stream;
                    
                    mediaStreamSource = this.audioContext.createMediaStreamSource(window.stream);
                    
                    var scriptNode = this.audioContext.createScriptProcessor(2048,1,1);
                    var bufferSource = this.audioContext.createBufferSource();
                    
                    scriptNode.connect( this.audioContext.destination );
                    //bufferSource.connect( this.audioContext.destination );
                    
                    mediaStreamSource.connect(filter);
                    filter.connect(analyser);
                    
                }
            }  
                
        }
        */
    }
    
    stepAudioProcessor(){
    }
    recieveAudioProcessor( data ){
        //console.log( data );
    }
        
    // ## Intended for Avatar Audio manipulation
    //      Unused currently
  buildRemoteAudioMixer(pID, domObj){
    // Gen audio mixes for bineural
    // ## Cut this down should FPS be hit
        if( false &amp;&amp; domObj instanceof HTMLMediaElement ){
            // for cross browser
            if(this.audioCtx==null){
              const AudioContext = window.AudioContext || window.webkitAudioContext;
              this.audioCtx = new AudioContext();
            }
            // volume
            var gainNode = this.audioCtx.createGain();

            // panning
            //const panner = new StereoPannerNode(this.audioCtx, {pan: 0});
            var panner = this.audioCtx.createStereoPanner();
            
            var curTrack = this.audioCtx.createMediaElementSource(domObj);
            
            // connect to ouput
            curTrack.connect(panner);
            panner.connect(gainNode);
            gainNode.connect(this.audioCtx.destination);
            
            let ret={};
            ret.dest=this.audioCtx.destination;
            ret.ctx=curTrack;
            ret.gainer=gainNode;
            ret.panner=panner;
            //this.jmaActiveBinaural[pID]=ret;    
    }
        return false;
  }
        
    loadStreamPromise(){
        let djDevice=this.djAudioObj;
    return new Promise( (resolve, reject)=>{
            this.djAudioObj.byScript=true;
            let djSource=djDevice.children[0];
            djSource.setAttribute("src",this.djUrlSource);
            djDevice.load();
            //djDevice.play();
            djDevice.muted=this.djMuted || !this.roomAudioStopped ;
    }).then( ()=>{
        }).catch( (err)=>{
            console.log("error source");
        });
    }
    
    djPlayerSetSliderGui(){
        if(this.djAudioObj.byScript || !this.pxlEnv.postIntro || this.pxlEnv.pxlAutoCam.enabled ){
            this.djAudioObj.byScript=false;
        }else{
            this.fadeActive=false;
            this.djAudioVolumeMax=this.djAudioVolume;//tmpThis.djAudioObj.volume;
            this.djAudioVolumeMin=this.djAudioVolume*this.djAudioVolumeScalar;//tmpThis.djAudioObj.volume*.1;
        }
        this.djVolumeObj.style.width=(this.djAudioVolume*100*(~~!this.djMuted))+"%";
    }
    
    
  djPlayerAdjustVolume(e){
    if(this.djVolumeParentObj.down || ( this.djVolumeParentObj.down &amp;&amp; e.touches ) ){
      let pw= this.djVolumeParentObj.offsetWidth;
      let offset=0;
      if( e.touches ){
        offset = this.pxlDevice.objectPerc.percX;
      }else{
        offset = e.offsetX/pw;
      }

      let perc=Math.max(0, Math.min(1, offset));
      this.djAudioVolume=perc;
      this.djAudioVolumeMax=perc;
      this.djAudioVolumeMin=perc*.1;
      perc*=perc;
      if( this.djAudioObj ){
        this.djAudioObj.volume=perc; 
      }

      if( e.touches){
        this.djPlayerSetSliderGui();
      }
      //this.colliderVolAdjust=this.djAudioVolume;
    }
    if( this.pxlVideo &amp;&amp; this.pxlEnv.posted  ){
      this.pxlVideo.setVolume( "dj", this.djAudioVolume );
    }
  }
    
  djPlayerMuteToggle(val=null){
    this.djMuted= val==null ? !this.djMuted : val;

    if( val!=null ){
      this.pxlGuiDraws.toggleIcon(this.pxlGuiDraws.hudIcons.musicIcon, !val, true );
    }

    if( this.djAudioObj ){
      this.djAudioObj.muted=this.djMuted;
      this.djAudioObj.byScript=true;
      this.djAudioObj.volume=this.djAudioObj.volume;
    }
    if( this.pxlVideo &amp;&amp; this.pxlEnv.posted ){
      this.pxlVideo.setMuted( "dj", this.djMuted );
    }
  }
  
  setFadeActive( dir=1 ){
    if( this.fadeDir == dir ){
      return;
    }
    this.fadeDir=dir;
    this.fadeActive=true;
  }
  
  fadeAudioEvent( ){
    if(this.djVolumeParentObj &amp;&amp; !this.djVolumeParentObj.down &amp;&amp; this.fadeActive &amp;&amp; this.pxlEnv.postIntro){
      this.fadePerc+=this.fadeAdjustRate*this.fadeDir;

      if( this.fadePerc&lt;0 || this.fadePerc>1 ){
        this.fadePerc= this.fadeDir == 1 ? 1 : 0;
        this.fadeActive=false;
        return;
      }
      
      let curVolume= (this.djAudioVolumeMax-this.djAudioVolumeMin) * this.fadePerc + this.djAudioVolumeMin;

      this.djAudioVolume=curVolume;
      curVolume*=curVolume;
      
      if( this.djAudioObj ){
        this.djAudioObj.byScript=true;
        this.djAudioObj.volume=curVolume;
      }
      
      this.pxlVideo.setVolume( "dj", this.djAudioVolume );
    }
  }
}</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.4</a> on Mon Mar 03 2025 13:02:09 GMT-0500 (Eastern Standard Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>



    <script src="https://unpkg.com/mermaid/dist/mermaid.js"></script>
    
    <script src="docs-init.js"></script>
    
</body>
</html>
